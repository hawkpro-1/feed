<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Auth0</title>
    <link>https://auth0.com/blog/rss.xml</link>
    <description></description>
    <item>
      <title>Securing Blazor WebAssembly Apps</title>
      <link>https://auth0.com/blog/securing-blazor-webassembly-apps/</link>
      <description>Learn how to secure Blazor WebAssembly applications with Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Blazor allows you to build your WebAssembly (also known as WASM) applications by leveraging the .NET platform. Thanks to <a href="http://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>, you can also easily secure them by adding support for authentication and authorization, as this article will show. Let&#39;s start!</p><h2 id="Building-a-Blazor-WebAssembly-Application">Building a Blazor WebAssembly Application</h2><p>In a previous article, you built <a href="https://auth0.com/blog/what-is-blazor-tutorial-on-building-webapp-with-authentication/" target="_blank" rel="noreferrer noopener">a Blazor application by using the Server Hosting model</a>. It was a simple quiz application that shows a list of questions with multiple answers and assigns you a score based on the correct answers you provide.</p><p>Now you are going to implement the same application by using the WebAssembly hosting model. To learn more <a href="https://auth0.com/blog/what-is-blazor-tutorial-on-building-webapp-with-authentication/#What-is-Blazor-" target="_blank" rel="noreferrer noopener">about Blazor hosting models</a>, please check out the specific section in that mentioned article.</p><p>As explained in that article, the WebAssembly hosting model makes your application be compiled in WebAssembly and run in your browser. However, depending on the structure of your project, you have two options to create your application:</p><ul><li>You may have just the client-side application that will call an existing Web API</li><li>You may have both the client-side application and the Web API application. In this case, the Web API application also serves the Blazor WebAssembly app to the browsers. This option is called <em>ASP.NET Core hosted</em>.</li></ul><p>For this project, you will choose the second option. In fact, you will have the client-side application, which will be responsible for showing the UI and managing the user interaction, and the Web API application, which will provide the quiz to the client.</p><p>To build this application, you need <a href="https://dotnet.microsoft.com/en-us/download/dotnet/6.0" target="_blank" rel="noreferrer noopener">.NET 6.0 SDK</a> or above installed on your machine.</p><p>You create a new Blazor WebAssembly project by typing the following command:</p><pre><code>dotnet new blazorwasm -o QuizManagerClientHosted --hosted</code></pre><blockquote><p><strong>Note</strong>: If you want to create only the client-side application, you have to omit the <code><span>--</span>hosted</code> flag in the previous command.</p></blockquote><p>If you take a look at the <code>QuizManagerClientHosted</code> folder, you will find the folder structure shown below:</p><pre><code>QuizManagerClientHosted
‚îÇ   .gitignore
‚îÇ   QuizManagerClientHosted.sln    
‚îú‚îÄ‚îÄ Client
‚îú‚îÄ‚îÄ Server
‚îî‚îÄ‚îÄ Shared</code></pre><p>Each of these folders contains a .NET project. While the <code>Client</code> and the <code>Server</code> folders are straightforward, you may wonder what the <code>Shared</code> folder contains. It contains a class library project with the code shared by the client-side and the server-side applications. In the case of the application you are going to re-implement, it will contain the data model.</p><p>So, move into the <code>Shared</code> folder and remove the <code>WeatherForecasts<span>.</span>cs</code> file. Create a new file in the <code>Shared</code> folder called <code>QuizItem<span>.</span>cs</code> with the following content:</p><pre><code><span>// Shared/QuizItem.cs</span>

<span>namespace</span> <span>QuizManagerClientHosted<span>.</span>Shared</span><span>;</span>
<span>public</span> <span>class</span> <span>QuizItem</span>
<span>{</span>
  <span>public</span> <span><span>string</span></span> Question <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span>List<span>&lt;</span><span>string</span><span>&gt;</span></span> Choices <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span><span>int</span></span> AnswerIndex <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
  <span>public</span> <span><span>int</span></span> Score <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span>QuizItem</span><span>(</span><span>)</span>
  <span>{</span>
    Choices <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>string</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>This class implements the model for each item of the quiz. It provides a question, a list of possible answers, the zero-based index of the correct answer, and the score assigned when the user gives the correct answer.</p><h3 id="Creating-the-server">Creating the server</h3><p>Move in the <code>Server<span>/</span>Controllers</code> folder and remove the <code>WeatherForecastController<span>.</span>cs</code> file. Then, add in the same folder a new file named <code>QuizController<span>.</span>cs</code> and put the following code inside it:</p><pre><code><span>// Server/Controllers/QuizController.cs</span>

<span>using</span> <span>QuizManagerClientHosted<span>.</span>Shared</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>

<span>namespace</span> <span>QuizManagerClientHosted<span>.</span>Server<span>.</span>Controllers</span><span>;</span>

<span>[</span><span><span>ApiController</span></span><span>]</span>
<span>[</span><span><span>Route</span><span><span>(</span><span>&#34;[controller]&#34;</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>class</span> <span>QuizController</span> <span>:</span> <span><span>ControllerBase</span></span>
<span>{</span>
  <span>private</span> <span>static</span> <span>readonly</span> <span>List<span>&lt;</span>QuizItem<span>&gt;</span></span> Quiz <span>=</span> <span>new</span> <span>List<span>&lt;</span>QuizItem<span>&gt;</span></span> <span>{</span>
    <span>new</span> <span>QuizItem</span>
      <span>{</span>
        Question <span>=</span> <span>&#34;Which of the following is the name of a Leonardo da Vinci&#39;s masterpiece?&#34;</span><span>,</span>
        Choices <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>string</span><span>&gt;</span></span> <span>{</span><span>&#34;Sunflowers&#34;</span><span>,</span> <span>&#34;Mona Lisa&#34;</span><span>,</span> <span>&#34;The Kiss&#34;</span><span>}</span><span>,</span>
        AnswerIndex <span>=</span> <span>1</span><span>,</span>
        Score <span>=</span> <span>3</span>
      <span>}</span><span>,</span>
    <span>new</span> <span>QuizItem</span>
      <span>{</span>
        Question <span>=</span> <span>&#34;Which of the following novels was written by Miguel de Cervantes?&#34;</span><span>,</span>
        Choices <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>string</span><span>&gt;</span></span> <span>{</span><span>&#34;The Ingenious Gentleman Don Quixote of La Mancia&#34;</span><span>,</span> <span>&#34;The Life of Gargantua and of Pantagruel&#34;</span><span>,</span> <span>&#34;One Hundred Years of Solitude&#34;</span><span>}</span><span>,</span>
        AnswerIndex <span>=</span> <span>0</span><span>,</span>
        Score <span>=</span> <span>5</span>
      <span>}</span>
    <span>}</span><span>;</span>

  <span>[</span><span><span>HttpGet</span></span><span>]</span>
  <span>public</span> <span>List<span>&lt;</span>QuizItem<span>&gt;</span></span> <span>Get</span><span>(</span><span>)</span>
  <span>{</span>
    <span>return</span> Quiz<span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>As you can see, this is the Web API version of the <code>QuizService</code> class you created in <a href="https://auth0.com/blog/what-is-blazor-tutorial-on-building-webapp-with-authentication" target="_blank" rel="noreferrer noopener">the Blazor server application</a>. You notice the initialization of the <code>Quiz</code> static variable with a few <code>QuizItem</code> instances and the definition of the <code><span>Get</span><span>(</span><span>)</span></code> action returning that variable.</p><p>For more information on <a href="https://auth0.com/blog/building-aspnet-web-api/" target="_blank" rel="noreferrer noopener">how to create a Web API in ASP.NET Core, see this tutorial</a>.</p><h3 id="Creating-the-client">Creating the client</h3><p>In order to create the Blazor client application, move into the <code>Client<span>/</span>Pages</code> folder and remove the <code>Counter<span>.</span>razor</code> and the <code>FetchData<span>.</span>razor</code> files. Then, add to this folder a file named <code>QuizViewer<span>.</span>razor</code> with the following content:</p><pre><code><span>// Client/Pages/QuizViewer.cs</span>

@page <span>&#34;/quizViewer&#34;</span>
@<span>using</span> QuizManagerClientHosted<span>.</span>Shared
@inject HttpClient Http

<span>&lt;</span>h1<span>&gt;</span>Take your quiz<span>!</span><span>&lt;</span><span>/</span>h1<span>&gt;</span>
<span>&lt;</span>p<span>&gt;</span>Your current score <span>is</span> <span>@currentScore</span><span>&lt;</span><span>/</span>p<span>&gt;</span>

@<span>if</span> <span>(</span>quiz <span>==</span> <span>null</span><span>)</span>
<span>{</span>
  <span>&lt;</span>p<span>&gt;</span><span>&lt;</span>em<span>&gt;</span>Loading<span>..</span><span>.</span><span>&lt;</span><span>/</span>em<span>&gt;</span><span>&lt;</span><span>/</span>p<span>&gt;</span>
<span>}</span>
<span>else</span>
<span>{</span>
  <span><span>int</span></span> quizIndex <span>=</span> <span>0</span><span>;</span>
  @<span>foreach</span> <span>(</span><span><span>var</span></span> quizItem <span>in</span> quiz<span>)</span>
  <span>{</span>
    <span>&lt;</span>section<span>&gt;</span>
    <span>&lt;</span>h3<span>&gt;</span>@quizItem<span>.</span>Question<span>&lt;</span><span>/</span>h3<span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;form-check&#34;</span><span>&gt;</span>
      @<span>{</span>
        <span><span>int</span></span> choiceIndex <span>=</span> <span>0</span><span>;</span>
        quizScores<span>.</span><span>Add</span><span>(</span><span>0</span><span>)</span><span>;</span>
      <span>}</span>
      @<span>foreach</span> <span>(</span><span><span>var</span></span> choice <span>in</span> quizItem<span>.</span>Choices<span>)</span>
      <span>{</span>
        <span><span>int</span></span> currentQuizIndex <span>=</span> quizIndex<span>;</span>
        <span>&lt;</span>input <span>class</span><span>=</span><span>&#34;form-check-input&#34;</span>
          type<span>=</span><span>&#34;radio&#34;</span> 
          name<span>=</span><span>&#34;@quizIndex&#34;</span> 
          <span>value</span><span>=</span><span>&#34;@choiceIndex&#34;</span>
          @onchange<span>=</span><span>&#34;@((eventArgs) =&gt; UpdateScore(Convert.ToInt32(eventArgs.Value), currentQuizIndex))&#34;</span> <span>/</span><span>&gt;</span>@choice
        <span>&lt;</span>br<span>&gt;</span>

        choiceIndex<span>++</span><span>;</span>
      <span>}</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span><span>/</span>section<span>&gt;</span>

    quizIndex<span>++</span><span>;</span>
  <span>}</span>
<span>}</span>

@code <span>{</span>
  <span>List<span>&lt;</span>QuizItem<span>&gt;</span></span> quiz<span>;</span>
  <span>List<span>&lt;</span><span>int</span><span>&gt;</span></span> quizScores <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>int</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
  <span><span>int</span></span> currentScore <span>=</span> <span>0</span><span>;</span>

  <span>protected</span> <span>override</span> <span>async</span> <span>Task</span> <span>OnInitializedAsync</span><span>(</span><span>)</span>
  <span>{</span>
    quiz <span>=</span> <span>await</span> Http<span>.</span><span><span>GetFromJsonAsync</span><span><span>&lt;</span>List<span>&lt;</span>QuizItem<span>&gt;</span><span>&gt;</span></span></span><span>(</span><span>&#34;Quiz&#34;</span><span>)</span><span>;</span>
  <span>}</span>

  <span><span>void</span></span> <span>UpdateScore</span><span>(</span><span><span>int</span></span> chosenAnswerIndex<span>,</span> <span><span>int</span></span> quizIndex<span>)</span>
  <span>{</span>
    <span><span>var</span></span> quizItem <span>=</span> quiz<span>[</span>quizIndex<span>]</span><span>;</span>

    <span>if</span> <span>(</span>chosenAnswerIndex <span>==</span> quizItem<span>.</span>AnswerIndex<span>)</span>
    <span>{</span>
      quizScores<span>[</span>quizIndex<span>]</span> <span>=</span> quizItem<span>.</span>Score<span>;</span>
    <span>}</span>
    <span>else</span>
    <span>{</span>
      quizScores<span>[</span>quizIndex<span>]</span> <span>=</span> <span>0</span><span>;</span>
    <span>}</span>
    currentScore <span>=</span> quizScores<span>.</span><span>Sum</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>The <code>@page</code> directive defines this <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components" target="_blank" rel="noreferrer noopener">Razor component</a> as a page, which is a UI element that is directly reachable through an address (<code><span>/</span>quizViewer</code> in this case) in the Blazor&#39;s routing system. Then, you have the <code>@using</code> directive, which provides access to the shared data model created above (<code>QuizItem<span>.</span>cs</code>). The <code>@inject</code> directive asks the dependency injection system to get an instance of the <code>HttpClient</code> class.</p><p>After these initializations, you find the markup defining the UI. As you can see, this part is a mix of HTML and C# code whose purpose is to build the list of questions with the respective possible answers represented as radio buttons.</p><p>The final block of the component is enclosed in the <code>@code</code> directive. This is where you put the logic of the component. In the case of the <code>QuizViewer</code> component,  you have the <code><span>OnInitializedAsync</span><span>(</span><span>)</span></code>  and the <code><span>UpdateScore</span><span>(</span><span>)</span></code> methods. The first method is called when the component is initialized, and it basically gets the quiz data by invoking the <code>Quiz</code> endpoint of the Web API you created before. The <code><span>UpdateScore</span><span>(</span><span>)</span></code> method is called when the user clicks one of the proposed answers, and it updates the list of the assigned scores according to the answer chosen by the user. In the same method, the value of the current score is computed and assigned to the <code>currentScore</code> variable. The value of this variable is shown above the list of questions, as you can see in the markup.</p><p>To complete your application, replace the content of the <code>NavMenu<span>.</span>razor</code> file in the <code>Client<span>/</span>Shared</code> folder with the following code:</p><pre><code><span>// Shared/NavMenu.razor</span>

<span>&lt;</span>div <span>class</span><span>=</span><span>&#34;top-row ps-3 navbar navbar-dark&#34;</span><span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;container-fluid&#34;</span><span>&gt;</span>
        <span>&lt;</span>a <span>class</span><span>=</span><span>&#34;navbar-brand&#34;</span> href<span>=</span><span>&#34;&#34;</span><span>&gt;</span>QuizManager<span>&lt;</span><span>/</span>a<span>&gt;</span>
        <span>&lt;</span><span>button</span> title<span>=</span><span>&#34;Navigation menu&#34;</span> <span>class</span><span>=</span><span>&#34;navbar-toggler&#34;</span> @onclick<span>=</span><span>&#34;ToggleNavMenu&#34;</span><span>&gt;</span>
            <span>&lt;</span>span <span>class</span><span>=</span><span>&#34;navbar-toggler-icon&#34;</span><span>&gt;</span><span>&lt;</span><span>/</span>span<span>&gt;</span>
        <span>&lt;</span><span>/</span>button<span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
<span>&lt;</span><span>/</span>div<span>&gt;</span>

<span>&lt;</span>div <span>class</span><span>=</span><span>&#34;@NavMenuCssClass&#34;</span> @onclick<span>=</span><span>&#34;ToggleNavMenu&#34;</span><span>&gt;</span>
    <span>&lt;</span>nav <span>class</span><span>=</span><span>&#34;flex-column&#34;</span><span>&gt;</span>
        <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;nav-item px-3&#34;</span><span>&gt;</span>
            <span>&lt;</span>NavLink <span>class</span><span>=</span><span>&#34;nav-link&#34;</span> href<span>=</span><span>&#34;&#34;</span> Match<span>=</span><span>&#34;NavLinkMatch.All&#34;</span><span>&gt;</span>
                <span>&lt;</span>span <span>class</span><span>=</span><span>&#34;oi oi-home&#34;</span> aria<span>-</span>hidden<span>=</span><span>&#34;true&#34;</span><span>&gt;</span><span>&lt;</span><span>/</span>span<span>&gt;</span> Home
            <span>&lt;</span><span>/</span>NavLink<span>&gt;</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>
        <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;nav-item px-3&#34;</span><span>&gt;</span>
            <span>&lt;</span>NavLink <span>class</span><span>=</span><span>&#34;nav-link&#34;</span> href<span>=</span><span>&#34;quizViewer&#34;</span><span>&gt;</span>
                <span>&lt;</span>span <span>class</span><span>=</span><span>&#34;oi oi-list-rich&#34;</span> aria<span>-</span>hidden<span>=</span><span>&#34;true&#34;</span><span>&gt;</span><span>&lt;</span><span>/</span>span<span>&gt;</span> Quiz
            <span>&lt;</span><span>/</span>NavLink<span>&gt;</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span><span>/</span>nav<span>&gt;</span>
<span>&lt;</span><span>/</span>div<span>&gt;</span>

@code <span>{</span>
    <span>private</span> <span><span>bool</span></span> collapseNavMenu <span>=</span> <span>true</span><span>;</span>

    <span>private</span> <span><span>string</span><span>?</span></span> NavMenuCssClass <span>=&gt;</span> collapseNavMenu <span>?</span> <span>&#34;collapse&#34;</span> <span>:</span> <span>null</span><span>;</span>

    <span>private</span> <span><span>void</span></span> <span>ToggleNavMenu</span><span>(</span><span>)</span>
    <span>{</span>
        collapseNavMenu <span>=</span> <span>!</span>collapseNavMenu<span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>As you may have noticed, this code redefines the navigation menu by removing the default items pointing to the <code>Counter</code> and <code>FetchData</code> components and including an item to reach the <code>QuizViewer</code> component.</p><h3 id="Running-your-Blazor-WebAssembly-application">Running your Blazor WebAssembly application</h3><p>Your Blazor WebAssembly application is complete and ready to run.</p><details><summary>‚ö†Ô∏è If you are using a Mac, please, read! ‚ö†Ô∏è</summary><p>At the time of writing, Mac users are affected by an issue when running an ASP.NET Core application via the .NET CLI. You may get the following dialog window when run :</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Io0TQcelmQbkgNnAoXjzm/2bde77c4f9a50bca9c740841dad624a3/keychain-message-mac-issue.png" alt="Keychain message issue in Mac"/></p><p>This is due to <a href="https://github.com/dotnet/sdk/issues/22544" target="_blank" rel="noreferrer noopener">a known issue with the .NET CLI on macOS</a>. The current workaround requires that you open the <code>QuizManagerClientHosted<span>.</span>Server<span>.</span>csproj</code> file and add the <code><span>&lt;</span>UseAppHost<span>&gt;</span><span>false</span><span>&lt;</span><span>/</span>UseAppHost<span>&gt;</span></code> element as shown below:</p><pre><code><span>&lt;!-- QuizManagerClientHosted.Server.csproj --&gt;</span>

<span><span><span>&lt;</span>Project</span> <span>Sdk</span><span><span>=</span><span>&#34;</span>Microsoft.NET.Sdk.Web<span>&#34;</span></span><span>&gt;</span></span>

<span><span><span>&lt;</span>PropertyGroup</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>TargetFramework</span><span>&gt;</span></span>net6.0<span><span><span>&lt;/</span>TargetFramework</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>Nullable</span><span>&gt;</span></span>enable<span><span><span>&lt;/</span>Nullable</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>ImplicitUsings</span><span>&gt;</span></span>enable<span><span><span>&lt;/</span>ImplicitUsings</span><span>&gt;</span></span>
  <span>&lt;!--üëá new element ---&gt;</span>
  <span><span><span>&lt;</span>UseAppHost</span><span>&gt;</span></span>false<span><span><span>&lt;/</span>UseAppHost</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>PropertyGroup</span><span>&gt;</span></span>

<span>&lt;!-- ...existing elements... --&gt;</span>

<span><span><span>&lt;/</span>Project</span><span>&gt;</span></span></code></pre><p>If you use Visual Studio, you are not affected by this issue.</p></details><p>In the root folder of the project, type the following command:</p><pre><code>dotnet run --project Server</code></pre><p>Take a look at your terminal window to get the address your application is listening to. It is in the form <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>&lt;</span><span>YOUR_PORT_NUMBER</span><span>&gt;</span></code>. In my case, I got the address <a href="https://localhost:7291/" target="_blank" rel="noreferrer noopener"><code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7291</span></code></a>, and I will refer to it throughout the article.</p><blockquote><p>Starting with .NET 6.0, any ASP.NET project created through a template is assigned a random port between 5000 and 5300 for HTTP and between 7000 and 7300 for HTTPS. See <a href="https://docs.microsoft.com/en-us/aspnet/core/release-notes/aspnetcore-6.0?view=aspnetcore-6.0#tgp" target="_blank" rel="noreferrer noopener">this document</a> for more information.</p></blockquote><p>Pointing your browser to your application&#39;s address, you should see the following page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1iuH4fcHt0rA0OoTGUdd9P/7ea0a59eebc6358e319e9c3f9f0b59ba/blazor-homepage.png" alt="Blazor App Home page"/></p><p>Clicking the Quiz item on the navigation bar, you should be able to take a simple quiz as shown in the following screenshot:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/K0RnC5N4WNMdaTd0XA7vS/d773f4e01e0a6da995e1ab9f612acb71/blazor-quiz-app.png" alt="Blazor Quiz Page"/></p><p>Even if the look and feel of this application is basically the same as <a href="https://auth0.com/blog/what-is-blazor-tutorial-on-building-webapp-with-authentication" target="_blank" rel="noreferrer noopener">the Blazor Server implementation</a>, the application architecture is quite different. In this case, you have the client side compiled into WebAssembly and running in your browser, while the server side is running in the built-in Web server. In addition, with this architecture, the client and the server interact with classic HTTP requests. You can check this by analyzing the network traffic with the developer tools of your browser.</p><h2 id="Registering-the-Blazor-WASM-App-with-Auth0">Registering the Blazor WASM App with Auth0</h2><p>Now that you have the WebAssembly version of the Quiz Manager application, learn how to secure it. You will use <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a> since it provides an easy way to integrate authentication and authorization without having to deal with the complexity of the underlying technology. To use Auth0, you need to provide some information and configure your application to make the two parties communicate with each other. If you don&#39;t have an Auth0 account yet, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one right now</a>.</p><p>Try out the most powerful authentication platform for free.<a target="_blank" href="https://auth0.com/signup?promo=sup&amp;place=in-blog-banner&amp;type=link&amp;text=get-started&amp;origin=blog">Get started ‚Üí</a></p><p>After accessing the <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a>, move to the <a href="https://manage.auth0.com/#/applications" target="_blank" rel="noreferrer noopener">Applications section</a>, and follow these steps:</p><ol start="1"><li>Click the <em>Create Application</em> button.</li><li>Provide a friendly name for your application (for example, <em>Quiz Blazor WASM Client</em>) and select <em>Single Page Web Applications</em> as the application type.</li><li>Finally, click the <em>Create</em> button.</li></ol><p>After you register the application, move to the <em>Settings</em> tab and take note of your Auth0 <strong>Domain</strong> and your <strong>Client ID</strong>. Then, assign the value <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>&lt;</span><span>YOUR_PORT_NUMBER</span><span>&gt;</span><span>/</span>authentication<span>/</span>login<span>-</span>callback</code> to the <em>Allowed Callback URLs</em> field and the value <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>&lt;</span><span>YOUR_PORT_NUMBER</span><span>&gt;</span></code> to the <em>Allowed Logout URLs</em> field. Replace the <code><span>&lt;</span><span>YOUR_PORT_NUMBER</span><span>&gt;</span></code> placeholder with the actual port number assigned to your application. In my case, those values are <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7291</span><span>/</span>authentication<span>/</span>login<span>-</span>callback</code> and <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7291</span></code>.</p><p>The first value tells Auth0 which URL to call back after users authenticate. The second value tells Auth0 which URL users should be redirected to after they log out.</p><p>Finally, click the <em>Save Changes</em> button to apply them.</p><h2 id="Adding-Support-for-Authentication">Adding Support for Authentication</h2><p>Now, you need to configure your Blazor project by applying some changes to make it aware of Auth0.</p><h3 id="Configure-your-Blazor-app">Configure your Blazor app</h3><p>So, move to the <code>Client<span>/</span>wwwroot</code> folder and create an <code>appsettings<span>.</span>json</code> file with the following content:</p><pre><code><span>{</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Authority&#34;</span><span>:</span> <span>&#34;https://&lt;YOUR_AUTH0_DOMAIN&gt;&#34;</span><span>,</span>
    <span>&#34;ClientId&#34;</span><span>:</span> <span>&#34;&lt;YOUR_CLIENT_ID&gt;&#34;</span>
  <span>}</span>
<span>}</span></code></pre><p>Replace the placeholders <code><span>&lt;</span><span>YOUR_AUTH0_DOMAIN</span><span>&gt;</span></code> and <code><span>&lt;</span><span>YOUR_CLIENT_ID</span><span>&gt;</span></code> with the respective values taken from the Auth0 dashboard.</p><h3 id="Add-support-for-authentication">Add support for authentication</h3><p>Now, add the authentication package to the Blazor client project by running the following command in the <code>Client</code> folder: </p><pre><code>dotnet <span>add</span> package Microsoft.AspNetCore.Components.WebAssembly.Authentication</code></pre><p>After adding the package, still in the <code>Client</code> folder, edit the <code>Program<span>.</span>cs</code> file by changing its content as follows:</p><pre><code><span>// Client/Program.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Web</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Hosting</span><span>;</span>
<span>using</span> <span>QuizManagerClientHosted<span>.</span>Client</span><span>;</span>

<span><span>var</span></span> builder <span>=</span> WebAssemblyHostBuilder<span>.</span><span>CreateDefault</span><span>(</span>args<span>)</span><span>;</span>
builder<span>.</span>RootComponents<span>.</span><span><span>Add</span><span><span>&lt;</span>App<span>&gt;</span></span></span><span>(</span><span>&#34;#app&#34;</span><span>)</span><span>;</span>
builder<span>.</span>RootComponents<span>.</span><span><span>Add</span><span><span>&lt;</span>HeadOutlet<span>&gt;</span></span></span><span>(</span><span>&#34;head::after&#34;</span><span>)</span><span>;</span>

builder<span>.</span>Services<span>.</span><span>AddScoped</span><span>(</span>sp <span>=&gt;</span> <span>new</span> <span>HttpClient</span> <span>{</span> BaseAddress <span>=</span> <span>new</span> <span>Uri</span><span>(</span>builder<span>.</span>HostEnvironment<span>.</span>BaseAddress<span>)</span> <span>}</span><span>)</span><span>;</span>

<span>// üëá new code</span>
builder<span>.</span>Services<span>.</span><span>AddOidcAuthentication</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  builder<span>.</span>Configuration<span>.</span><span>Bind</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> options<span>.</span>ProviderOptions<span>)</span><span>;</span>
  options<span>.</span>ProviderOptions<span>.</span>ResponseType <span>=</span> <span>&#34;code&#34;</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
<span>// üëÜ new code</span>

<span>await</span> builder<span>.</span><span>Build</span><span>(</span><span>)</span><span>.</span><span>RunAsync</span><span>(</span><span>)</span><span>;</span></code></pre><p>You added the call to <code><span>AddOidcAuthentication</span><span>(</span><span>)</span></code> with specific options. In particular, you specified using the parameters from the <code>Auth0</code> section of the <code>appsettings<span>.</span>json</code> configuration file. Also, you specified the type of <a href="https://auth0.com/docs/flows" target="_blank" rel="noreferrer noopener">authentication and authorization flow</a> you want to use; in this specific case, the <a href="https://auth0.com/docs/flows/concepts/auth-code" target="_blank" rel="noreferrer noopener">Authorization Code flow</a> is recommended.</p><p>To complete the implementation of authentication support in your application, open the <code>index<span>.</span>html</code> file under the <code>Client<span>/</span>wwwroot</code> folder and add the reference to the <code>AuthenticationService<span>.</span>js</code> script as shown below:</p><pre><code><span>&lt;!-- Client/wwwroot/index.html --&gt;</span>
<span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>&gt;</span></span>
<span><span><span>&lt;</span>html</span><span>&gt;</span></span>
  <span>&lt;!-- existing markup --&gt;</span>
  <span><span><span>&lt;</span>body</span><span>&gt;</span></span>
    <span>&lt;!-- existing markup --&gt;</span>
    <span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>&#34;</span>_content/Microsoft.AspNetCore.Components.WebAssembly.Authentication/AuthenticationService.js<span>&#34;</span></span><span>&gt;</span></span><span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span>
    <span>&lt;!--üëÜ new addition --&gt;</span>
    <span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>&#34;</span>appsettings.jsons_framework/blazor.webassembly.js<span>&#34;</span></span><span>&gt;</span></span><span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>body</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>html</span><span>&gt;</span></span></code></pre><p>This script is responsible for performing the authentication operations on the WebAssembly client side.</p><h3 id="Adjust-the-UI-of-your-Blazor-app">Adjust the UI of your Blazor app</h3><p>At this point, you prepared the infrastructure for your Blazor app to support authentication. Now you need to make some changes to the UI.</p><p>The first step is to enable support for the authorization <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components" target="_blank" rel="noreferrer noopener">Razor components</a>. So, open the <code>_Imports<span>.</span>razor</code> file in the <code>Client</code> folder and add a reference to the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Authorization</code> and <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</code> namespaces. The content of that file will look as follows:</p><pre><code>@<span>*</span> Client<span>/</span>_Imports<span>.</span>razor <span>*</span>@

@<span>using</span> System<span>.</span>Net<span>.</span>Http
@<span>using</span> System<span>.</span>Net<span>.</span>Http<span>.</span>Json
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Authorization  <span>//üëà new addition</span>
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Authorization             <span>//üëà new addition</span>
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Forms
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Routing
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Web
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Web<span>.</span>Virtualization
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Http
@<span>using</span> Microsoft<span>.</span>JSInterop
@<span>using</span> QuizManagerClientHosted<span>.</span>Client
@<span>using</span> QuizManagerClientHosted<span>.</span>Client<span>.</span>Shared</code></pre><p>Then, open the <code>App<span>.</span>razor</code> file in the same folder and replace its content with the following:</p><pre><code><span>&lt;!-- Client/App.razor --&gt;</span>

<span><span><span>&lt;</span>CascadingAuthenticationState</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>Router</span> <span>AppAssembly</span><span><span>=</span><span>&#34;</span>@typeof(App).Assembly<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>Found</span> <span>Context</span><span><span>=</span><span>&#34;</span>routeData<span>&#34;</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>AuthorizeRouteView</span> <span>RouteData</span><span><span>=</span><span>&#34;</span>@routeData<span>&#34;</span></span> <span>DefaultLayout</span><span><span>=</span><span>&#34;</span>@typeof(MainLayout)<span>&#34;</span></span><span>&gt;</span></span>
                <span><span><span>&lt;</span>Authorizing</span><span>&gt;</span></span>
                    <span><span><span>&lt;</span>p</span><span>&gt;</span></span>Determining session state, please wait...<span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
                <span><span><span>&lt;/</span>Authorizing</span><span>&gt;</span></span>
                <span><span><span>&lt;</span>NotAuthorized</span><span>&gt;</span></span>
                    <span><span><span>&lt;</span>h1</span><span>&gt;</span></span>Sorry<span><span><span>&lt;/</span>h1</span><span>&gt;</span></span>
                    <span><span><span>&lt;</span>p</span><span>&gt;</span></span>You&#39;re not authorized to reach this page. You need to log in.<span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
                <span><span><span>&lt;/</span>NotAuthorized</span><span>&gt;</span></span>
            <span><span><span>&lt;/</span>AuthorizeRouteView</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>FocusOnNavigate</span> <span>RouteData</span><span><span>=</span><span>&#34;</span>@routeData<span>&#34;</span></span> <span>Selector</span><span><span>=</span><span>&#34;</span>h1<span>&#34;</span></span> <span>/&gt;</span></span>
        <span><span><span>&lt;/</span>Found</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>NotFound</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>PageTitle</span><span>&gt;</span></span>Not found<span><span><span>&lt;/</span>PageTitle</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>LayoutView</span> <span>Layout</span><span><span>=</span><span>&#34;</span>@typeof(MainLayout)<span>&#34;</span></span><span>&gt;</span></span>
                <span><span><span>&lt;</span>p</span> <span>role</span><span><span>=</span><span>&#34;</span>alert<span>&#34;</span></span><span>&gt;</span></span>Sorry, there&#39;s nothing at this address.<span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
            <span><span><span>&lt;/</span>LayoutView</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>NotFound</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>Router</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>CascadingAuthenticationState</span><span>&gt;</span></span></code></pre><p>You used the <code>AuthorizeRouteView</code> Blazor component to customize the content according to the user&#39;s authentication status. The <code>CascadingAuthenticationState</code> component will propagate the current authentication state to the inner components so that they can work on it consistently.</p><p>The next step is to create a new <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components" target="_blank" rel="noreferrer noopener">Razor component</a> that allows the user to log in and see their name when authenticated. So, create a new file named <code>AccessControl<span>.</span>razor</code> in the <code>Client<span>/</span>Shared</code> folder with the following content:</p><pre><code>@<span>*</span> Client<span>/</span>Shared<span>/</span>AccessControl<span>.</span>razor <span>*</span>@

@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Authorization
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Authentication

@inject NavigationManager Navigation
@inject SignOutSessionStateManager SignOutManager

<span>&lt;</span>AuthorizeView<span>&gt;</span>
    <span>&lt;</span>Authorized<span>&gt;</span>
        Hello<span>,</span> @context<span>.</span>User<span>.</span>Identity<span>.</span>Name<span>!</span>
        <span>&lt;</span><span>a</span> href<span>=</span><span>&#34;#&#34;</span> @onclick<span>=</span><span>&#34;BeginSignOut&#34;</span><span>&gt;</span>Log <span>out</span><span>&lt;</span><span>/</span>a<span>&gt;</span>
    <span>&lt;</span><span>/</span>Authorized<span>&gt;</span>
    <span>&lt;</span>NotAuthorized<span>&gt;</span>
        <span>&lt;</span><span>a</span> href<span>=</span><span>&#34;authentication/login&#34;</span><span>&gt;</span>Log <span>in</span><span>&lt;</span><span>/</span>a<span>&gt;</span>
    <span>&lt;</span><span>/</span>NotAuthorized<span>&gt;</span>
<span>&lt;</span><span>/</span>AuthorizeView<span>&gt;</span>

@code<span>{</span>
    <span>private</span> <span>async</span> <span>Task</span> <span>BeginSignOut</span><span>(</span><span>MouseEventArgs</span> args<span>)</span>
    <span>{</span>
        <span>await</span> SignOutManager<span>.</span><span>SetSignOutState</span><span>(</span><span>)</span><span>;</span>
        Navigation<span>.</span><span>NavigateTo</span><span>(</span><span>&#34;authentication/logout&#34;</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>The component uses the <code>AuthorizeView</code> component to show different content according to the user&#39;s authentication status. Basically, it shows the <em>Log in</em> link when the user is not authenticated. It shows the name of the user and the <em>Log out</em> link when the user is authenticated.</p><p>Note the URL the user is redirected to when they click the <em>Log out</em> link (<code>authentication<span>/</span>logout</code>). You will learn about that URL in a moment.</p><p>Now, open the <code>MainLayout<span>.</span>razor</code> file in the <code>Shared</code> folder and add the <code>AccessControl</code> component just before the <em>About</em> link. The final code should look like the following:</p><pre><code>@<span>*</span> Client<span>/</span>Shared<span>/</span>MainLayout<span>.</span>razor <span>*</span>@

@inherits LayoutComponentBase

<span>&lt;</span>div <span>class</span><span>=</span><span>&#34;page&#34;</span><span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;sidebar&#34;</span><span>&gt;</span>
        <span>&lt;</span>NavMenu <span>/</span><span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>

    <span>&lt;</span>main<span>&gt;</span>
        <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;top-row px-4&#34;</span><span>&gt;</span>
            <span>&lt;</span>AccessControl <span>/</span><span>&gt;</span>    <span>//üëà new code</span>
            <span>&lt;</span><span>a</span> href<span>=</span><span>&#34;https://docs.microsoft.com/aspnet/&#34;</span> target<span>=</span><span>&#34;_blank&#34;</span><span>&gt;</span>About<span>&lt;</span><span>/</span>a<span>&gt;</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>

        <span>&lt;</span>article <span>class</span><span>=</span><span>&#34;content px-4&#34;</span><span>&gt;</span>
            @Body
        <span>&lt;</span><span>/</span>article<span>&gt;</span>
    <span>&lt;</span><span>/</span>main<span>&gt;</span>
<span>&lt;</span><span>/</span>div<span>&gt;</span></code></pre><p>When you registered your Blazor app with Auth0, you specified a couple of URLs as the allowed URLs for login callback and logout. To manage these URLs, you need to implement a page responsible for handling different authentication stages. For this purpose, create a new <code>Authentication<span>.</span>razor</code> file in the <code>Client<span>/</span>Pages</code> folder with the following code:</p><pre><code>@<span>*</span> Client<span>/</span>Pages<span>/</span>Authentication<span>.</span>razor <span>*</span>@

@page <span>&#34;/authentication/{action}&#34;</span>
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Authentication
@<span>using</span> Microsoft<span>.</span>Extensions<span>.</span>Configuration

@inject NavigationManager Navigation
@inject IConfiguration Configuration

<span>&lt;</span><span>RemoteAuthenticatorView</span> Action<span>=</span><span>&#34;@Action&#34;</span><span>&gt;</span>
    <span>&lt;</span>LogOut<span>&gt;</span>
        @<span>{</span>
            <span><span>var</span></span> authority <span>=</span> <span>(</span><span>string</span><span>)</span>Configuration<span>[</span><span>&#34;Auth0:Authority&#34;</span><span>]</span><span>;</span>
            <span><span>var</span></span> clientId <span>=</span> <span>(</span><span>string</span><span>)</span>Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>

             Navigation<span>.</span><span>NavigateTo</span><span>(</span><span><span>$&#34;</span><span><span>{</span><span>authority</span><span>}</span></span><span>/v2/logout?client_id=</span><span><span>{</span><span>clientId</span><span>}</span></span><span>&#34;</span></span><span>)</span><span>;</span>
        <span>}</span>
    <span>&lt;</span><span>/</span>LogOut<span>&gt;</span>
<span>&lt;</span><span>/</span>RemoteAuthenticatorView<span>&gt;</span>

@code<span>{</span>
    <span>[</span><span><span>Parameter</span></span><span>]</span> <span>public</span> <span><span>string</span></span> Action <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span></code></pre><p>As you can see, this component implements a page containing the <code>RemoteAuthenticatorView</code> component. This component manages the users&#39; authentication status and interacts with the authorization server on the Auth0 side. While the login interaction doesn&#39;t require any specific code, you need to manage the logout transaction. In fact, by design Blazor clears your authentication state on the client side but doesn&#39;t disconnect you from Auth0. To close your session on the Auth0 side, you need to explicitly call the logout endpoint, as shown in the code above.</p><blockquote><p>Disclaimer: At the time of writing, the logout function seems not to be stable due to an apparently Blazor problem. Check out <a href="https://github.com/dotnet/aspnetcore/issues/40046" target="_blank" rel="noreferrer noopener">this issue on the Blazor project&#39;s repository to learn more</a>.</p></blockquote><p>Finally, you need to add the <code>Authorize</code> attribute to the <code>QuizViewer<span>.</span>razor</code> page to protect it from unauthorized access. Open the <code>QuizViewer<span>.</span>razor</code> file in the <code>Pages</code> folder and add the attribute as shown below:</p><pre><code>@<span>*</span> Client<span>/</span>Pages<span>/</span>QuizViewer<span>.</span>razor <span>*</span>@

@page <span>&#34;/quizViewer&#34;</span>
@attribute <span>[</span>Authorize<span>]</span>            <span>//üëà new addition</span>

@<span>using</span> QuizManagerClientHosted<span>.</span>Shared

<span>// ... exisiting code ...</span></code></pre><blockquote><p>Note that the presence of the <code>Authorize</code> attribute on the page doesn&#39;t prevent the client from calling the API on the server. You need to protect the API on the server side as well.</p></blockquote><p>At this point, you can stop your Blazor app, if it is still running, and restart it to test the authentication integration. Once the app is running, by clicking the <em>Quiz</em> menu item, you should see the following screen:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7Lwyrds8bai2wl26T63ZlL/50f3fbda536515d608972fcbf0def159/blazor-unauthenticated-user.png" alt="Blazor app and the unauthenticated user"/></p><p>Note the <em>Log In</em> in the upper right corner. By clicking on it, the <a href="https://auth0.com/docs/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login page</a> is shown, and the authentication process takes place. After authentication, you will be able to access the <em>QuizViewer</em> page.</p><h2 id="Securing-the-API-with-Auth0">Securing the API with Auth0</h2><p>The data shown on the <em>QuizViewer</em> page are loaded from the <code><span>/</span>quiz</code> API implemented in the server project. This API is not protected, so any client could access it. In fact, the Blazor WASM client is able to access it without any problem. However, in a production-ready scenario, you need to protect the API to prevent unauthorized access. Although the API security implementation is out of the scope of this tutorial, you need to perform a few changes to the API in the server project to secure it.</p><p>If you want to learn more about <a href="https://auth0.com/blog/aspnet-web-api-authorization/" target="_blank" rel="noreferrer noopener">protecting Web APIs in .NET, please check out this article</a>.</p><h3 id="Register-the-API">Register the API</h3><p>Like what you did with the Blazor WASM application, you need to register the API with Auth0. So, head your browser to the <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a>, move to the <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">API section</a>, and follow these steps:</p><ol start="1"><li>Click the <em>Create API</em> button.</li><li>Provide a friendly name for your API (for example, <em>Quiz API</em>) and a unique identifier (also known as <em>audience</em>) in the URL format (for example, <em><a href="https://quizapi.com" target="_blank" rel="noreferrer noopener">https://quizapi.com</a></em>).</li><li>Leave the signing algorithm to RS256 and click the <em>Create</em> button.</li></ol><p>This way, Auth0 is aware of your Web API and will allow you to control access.</p><h3 id="Protecting-the-API">Protecting the API</h3><p>In the server project under the <code>Server</code> folder, open the <code>appsettings<span>.</span>json</code> and modify its content as follows:</p><pre><code><span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
    <span>&#34;LogLevel&#34;</span><span>:</span> <span>{</span>
      <span>&#34;Default&#34;</span><span>:</span> <span>&#34;Information&#34;</span><span>,</span>
      <span>&#34;Microsoft.AspNetCore&#34;</span><span>:</span> <span>&#34;Warning&#34;</span>
    <span>}</span>
  <span>}</span><span>,</span>
  <span>&#34;AllowedHosts&#34;</span><span>:</span> <span>&#34;*&#34;</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;&lt;YOUR_AUTH0_DOMAIN&gt;&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;&lt;YOUR_API_IDENTIFIER&gt;&#34;</span>
  <span>}</span>
<span>}</span></code></pre><p>Replace the <code><span>&lt;</span><span>YOUR_AUTH0_DOMAIN</span><span>&gt;</span></code> placeholder with the Auth0 domain value you used for the Blazor WASM client. Also, replace the <code><span>&lt;</span><span>YOUR_API_IDENTIFIER</span><span>&gt;</span></code> placeholder with the unique identifier you defined for your API in the Auth0 Dashboard: it should be <code>https<span>:</span><span>/</span><span>/</span>quizapi<span>.</span>com</code>, if you kept the suggested value.</p><p>Still in the <code>Server</code> folder, run the following command to install the library that will handle the authorization process:</p><pre><code>dotnet <span>add</span> package Microsoft.AspNetCore.Authentication.JwtBearer</code></pre><p>Then, open the <code>Program<span>.</span>cs</code> file and apply the changes shown below:</p><pre><code><span>// Server/Startup.cs</span>

<span>// ... exisiting code ...</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>JwtBearer</span><span>;</span>
<span>//üëÜ new code</span>

<span><span>var</span></span> builder <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>;</span>

<span>// Add services to the container.</span>
<span>//üëá new code</span>
builder<span>.</span>Services<span>.</span><span>AddAuthentication</span><span>(</span>JwtBearerDefaults<span>.</span>AuthenticationScheme<span>)</span>
    <span>.</span><span>AddJwtBearer</span><span>(</span>JwtBearerDefaults<span>.</span>AuthenticationScheme<span>,</span> c <span>=&gt;</span>
    <span>{</span>
        c<span>.</span>Authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>
        c<span>.</span>TokenValidationParameters <span>=</span> <span>new</span> <span>Microsoft<span>.</span>IdentityModel<span>.</span>Tokens<span>.</span>TokenValidationParameters</span>
        <span>{</span>
            ValidAudience <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>,</span>
            ValidIssuer <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span>
        <span>}</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>//üëÜ new code</span>

builder<span>.</span>Services<span>.</span><span>AddControllersWithViews</span><span>(</span><span>)</span><span>;</span>
builder<span>.</span>Services<span>.</span><span>AddRazorPages</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> app <span>=</span> builder<span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

<span>// ... exisiting code ...</span>

app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>

<span>//üëá new code</span>
app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>
<span>//üëÜ new code</span>

app<span>.</span><span>MapRazorPages</span><span>(</span><span>)</span><span>;</span>

<span>// ... exisiting code ...</span></code></pre><p>You added the reference to the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>JwtBearer</code> namespace and added the statements that configure the server to handle the authorization process through Auth0. Finally, you configured the middleware to process authentication and authorization.</p><p>Now, open the <code>QuizController<span>.</span>cs</code> file in the <code>Server<span>/</span>Controllers</code> folder and apply the following changes:</p><pre><code><span>// Server/Controllers/QuizController.cs</span>

<span>using</span> <span>QuizManagerClientHosted<span>.</span>Shared</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</span><span>;</span>  <span>//üëà new addition</span>

<span>namespace</span> <span>QuizManagerClientHosted<span>.</span>Server<span>.</span>Controllers</span><span>;</span>

<span>[</span><span><span>ApiController</span></span><span>]</span>
<span>[</span><span><span>Route</span><span><span>(</span><span>&#34;[controller]&#34;</span><span>)</span></span></span><span>]</span>
<span>[</span><span><span>Authorize</span></span><span>]</span>            <span>//üëà new addition</span>
<span>public</span> <span>class</span> <span>QuizController</span> <span>:</span> <span><span>ControllerBase</span></span>
<span>{</span>
  <span>// ... existing code ...</span>
<span>}</span></code></pre><p>You added the reference to the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</code> namespace and decorated the <code>QuizController</code> class with the <code>Authorize</code> attribute.</p><blockquote><p>Remember: if you want <a href="https://auth0.com/blog/aspnet-web-api-authorization" target="_blank" rel="noreferrer noopener">to learn in depth how to protect your API with Auth0, read this article</a>.</p></blockquote><p>Now your API is protected. To check if everything is working as expected, move to the root of the project and restart it. Then, log in to the application and click the <em>Quiz</em> menu item. This time you shouldn&#39;t be able to display the quiz data. Your screen should be like the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3LvgHWbncfgMgQ8yBlbTl3/bb53b957ad5581a2acc7b9efa1189162/blazor-unauthorized-user.png" alt="Blazor app unauthorized to access the API"/></p><p>If you take a look at the network section of your browser&#39;s developer tool, you will find that the call to the <code><span>/</span>quiz</code> endpoint gets an HTTP 401 status code, as in the following example:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2lsComaCge0ZuDAQa6Pbse/3e16fdec1aee9233acca9a83b27c519f/blazor-app-dev-tools.png" alt="Unauthorized error when calling an API"/></p><p>This confirms that the server prevents unauthorized access to the API.</p><blockquote><a href="https://twitter.com/intent/tweet?text=&#34;Learn%20how%20to%20call%20a%20protected%20API%20with%20Blazor%20WebAssembly.&#34; via @auth0 https://auth0.com/blog/securing-blazor-webassembly-apps" target="_blank" rel="noopener noreferrer"><p>&#34;Learn how to call a protected API with Blazor WebAssembly.&#34;</p><div><p><img alt="Tweet" src="https://cdn.auth0.com/blog/resources/twitter.svg"/></p><h4>Tweet This</h4></div></a></blockquote><h2 id="Calling-the-Protected-API">Calling the Protected API</h2><p>To enable your Blazor WASM application to access the protected API, you need to get an <a href="https://auth0.com/docs/tokens/concepts/access-tokens" target="_blank" rel="noreferrer noopener">access token</a> from Auth0 and provide it along with your API call. You might think to write some code that attaches this token when you make an HTTP request to the server. However, you can centralize the access token attachment to your API calls in a straightforward way.</p><h3 id="Creating-the-HTTP-client">Creating the HTTP client</h3><p>Start by moving to the <code>Client</code> folder and installing the <code>Microsoft<span>.</span>Extensions<span>.</span>Http</code> package with the following command:</p><pre><code>dotnet <span>add</span> package Microsoft.Extensions.Http</code></pre><p>This package allows you to create named HTTP clients and customize their behavior. In your case, you will create an HTTP client that automatically attaches an access token to each HTTP request.</p><p>Open the <code>Program<span>.</span>cs</code> file in the <code>Client</code> folder and add a reference to the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Authentication</code> as shown below:</p><pre><code><span>// Client/Program.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>Web</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Hosting</span><span>;</span>
<span>using</span> <span>QuizManagerClientHosted<span>.</span>Client</span><span>;</span>
<span>//üëá new addition</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Authentication</span><span>;</span>

<span>// ... existing code ...</span></code></pre><p>In the same file, apply the changes pointed out in the following code snippet:</p><pre><code><span>// Client/Program.cs</span>

<span>// ... existing code ...</span>

builder<span>.</span>RootComponents<span>.</span><span><span>Add</span><span><span>&lt;</span>HeadOutlet<span>&gt;</span></span></span><span>(</span><span>&#34;head::after&#34;</span><span>)</span><span>;</span>

<span>//üëá old code</span>
<span>//builder.Services.AddScoped(sp =&gt; new HttpClient { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });</span>

<span>//üëá new code</span>
builder<span>.</span>Services<span>.</span><span>AddHttpClient</span><span>(</span><span>&#34;ServerAPI&#34;</span><span>,</span> 
      client <span>=&gt;</span> client<span>.</span>BaseAddress <span>=</span> <span>new</span> <span>Uri</span><span>(</span>builder<span>.</span>HostEnvironment<span>.</span>BaseAddress<span>)</span><span>)</span>
    <span>.</span><span><span>AddHttpMessageHandler</span><span><span>&lt;</span>BaseAddressAuthorizationMessageHandler<span>&gt;</span></span></span><span>(</span><span>)</span><span>;</span>

builder<span>.</span>Services<span>.</span><span>AddScoped</span><span>(</span>sp <span>=&gt;</span> sp<span>.</span><span><span>GetRequiredService</span><span><span>&lt;</span>IHttpClientFactory<span>&gt;</span></span></span><span>(</span><span>)</span>
  <span>.</span><span>CreateClient</span><span>(</span><span>&#34;ServerAPI&#34;</span><span>)</span><span>)</span><span>;</span>
<span>//üëÜ new code      </span>

<span>// ... existing code ...</span></code></pre><p>You replaced the existing line of code that created an HTTP client with two lines of code. The <code><span>AddHttpClient</span><span>(</span><span>)</span></code> method defines a named <code>HttpClient</code> instance (<code>ServerAPI</code>) with the current server&#39;s address as the base address to use when requesting a resource. Also, the <code>BaseAddressAuthorizationMessageHandler</code> class is added to the <code>HttpClient</code> instance as the HTTP message handler. This class is provided by the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Authentication</code> namespace and is responsible for attaching the access token to any HTTP request to the application&#39;s base URI.</p><p>The actual <code>HttpClient</code> instance is created by the <code><span>CreateClient</span><span>(</span><span>)</span></code> method of the <code>IHttpClientFactory</code> service implementation.</p><h3 id="Specifying-the-API-audience">Specifying the API audience</h3><p>Now, open the <code>appsettings<span>.</span>json</code> file in the <code>Client<span>/</span>wwwroot</code> folder and add the <code>Audience</code> element as shown below:</p><pre><code><span>{</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Authority&#34;</span><span>:</span> <span>&#34;https://&lt;YOUR_AUTH0_DOMAIN&gt;&#34;</span><span>,</span>
    <span>&#34;ClientId&#34;</span><span>:</span> <span>&#34;&lt;YOUR_CLIENT_ID&gt;&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;&lt;YOUR_API_IDENTIFIER&gt;&#34;</span>
  <span>}</span>
<span>}</span></code></pre><p>Replace the <code><span>&lt;</span><span>YOUR_API_IDENTIFIER</span><span>&gt;</span></code> placeholder with the unique identifier you defined for your API in the Auth0 Dashboard (e.g., <code>https<span>:</span><span>/</span><span>/</span>quizapi<span>.</span>com</code>).</p><p>Now, back in the <code>Client<span>/</span>Program<span>.</span>cs</code> file, apply the change highlighted below:</p><pre><code><span>// Client/Program.cs</span>

<span>// ... existing code ...</span>

builder<span>.</span>Services<span>.</span><span>AddOidcAuthentication</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  builder<span>.</span>Configuration<span>.</span><span>Bind</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> options<span>.</span>ProviderOptions<span>)</span><span>;</span>
  options<span>.</span>ProviderOptions<span>.</span>ResponseType <span>=</span> <span>&#34;code&#34;</span><span>;</span>
  <span>//üëá new code</span>
  options<span>.</span>ProviderOptions<span>.</span>AdditionalProviderParameters<span>.</span><span>Add</span><span>(</span><span>&#34;audience&#34;</span><span>,</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

<span>await</span> builder<span>.</span><span>Build</span><span>(</span><span>)</span><span>.</span><span>RunAsync</span><span>(</span><span>)</span><span>;</span></code></pre><p>You added an additional <code>audience</code> parameter to let Auth0 know you want to call the API identified by the <code>Audience</code> setting value.</p><h3 id="Making-the-call">Making the call</h3><p>After this global configuration, you can call the <code>quiz</code> endpoint of your Web API. So, open the <code>QuizViewer<span>.</span>razor</code> file in the <code>Client\Pages</code> folder and change its content as follows:</p><pre><code>@<span>*</span> Client<span>/</span>Pages<span>/</span>QuizViewer<span>.</span>razor <span>*</span>@

@page <span>&#34;/quizViewer&#34;</span>
@attribute <span>[</span>Authorize<span>]</span>

@<span>using</span> QuizManagerClientHosted<span>.</span>Shared
<span>//üëá new code</span>
@<span>using</span> Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Authentication
<span>//üëÜ new code</span>
@inject HttpClient Http


<span>// ... existing code ...</span>
  
@code <span>{</span>
  
    <span>// ... existing code ...</span>
  
    <span>protected</span> <span>override</span> <span>async</span> <span>Task</span> <span>OnInitializedAsync</span><span>(</span><span>)</span>
    <span>{</span>
        <span>//üëá changed code</span>
        <span>try</span>
        <span>{</span>
            quiz <span>=</span> <span>await</span> Http<span>.</span><span><span>GetFromJsonAsync</span><span><span>&lt;</span>List<span>&lt;</span>QuizItem<span>&gt;</span><span>&gt;</span></span></span><span>(</span><span>&#34;quiz&#34;</span><span>)</span><span>;</span>
        <span>}</span>
        <span>catch</span> <span>(</span><span>AccessTokenNotAvailableException</span> exception<span>)</span>
        <span>{</span>
            exception<span>.</span><span>Redirect</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
        <span>//üëÜ changed code</span>
    <span>}</span>
  
  <span>// ... existing code ...</span>
<span>}</span></code></pre><p>You imported the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Components<span>.</span>WebAssembly<span>.</span>Authentication</code> namespace. Then, you simply arranged the <code><span>OnInitializedAsync</span><span>(</span><span>)</span></code> method by wrapping it with a <em>try-catch</em> statement.</p><p>After applying these changes, restart your application, log in, and try to move to the Quiz page. This time you should be able to access your protected API and show the Quiz page.</p><h2 id="Recap">Recap</h2><p>This tutorial guided you in creating and securing a Blazor WebAssembly application by using Auth0. You learned how to build a simple Blazor WebAssembly application and some Razor components. You went through the process of registering your application with Auth0 and enabling it to support authentication. Finally, you protected the API hosted by the server side of your application and called that API passing the access token.</p><p>The full source code of the application secured in this tutorial can be downloaded from <a href="https://github.com/auth0-blog/secure-blazor-wasm-quiz-manager" target="_blank" rel="noreferrer noopener">this GitHub repository</a>.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 31 Mar 2022 00:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Get Started with iOS Authentication using SwiftUI, Part 2: User Profiles</title>
      <link>https://auth0.com/blog/get-started-ios-authentication-swift-swiftui-part-2-user-profiles/</link>
      <description>Learn how to use Auth0 and user profiles to basic information about logged-in users in iOS apps built with SwiftUI.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the previous part of this tutorial, you created a SwiftUI-based iOS app that uses Auth0 for basic login and logout functionality. In this part, you‚Äôll enhance your app by giving it the ability to read the user‚Äôs profile to display their photo, name, and email address when they‚Äôre logged in.</p><h2 id="Display-the-User-s-Profile-Information">Display the User‚Äôs Profile Information</h2><p>The app only ‚Äúknows‚Äù whether the user is logged in or logged out in its current state. It also has information about the user‚Äôs identity, which is encoded in the ID token. Let‚Äôs extract this user information ‚Äî the <em>user profile</em> ‚Äî and use it to display the user‚Äôs name, email address, and picture when the user is logged in. </p><p>When you‚Äôve completed this section, the app‚Äôs ‚Äúlogged in‚Äù screen will look something like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/EYzWjMRx1fIiX9rU4Jd99/0a85c0549351669da425b614b6e82a8f/updated_logged_in_screen.png" alt="The app‚Äôs ‚Äúlogged in‚Äù screen, now displaying the user‚Äôs picture, name, and email address."/></p><h3 id="Create-a-data-structure-for-the-user-profile">Create a data structure for the user profile</h3><p>We&#39;ll need to build a data structure to store it before we can extract the user‚Äôs profile information from the ID token. Let‚Äôs create a <code>struct</code> for that purpose.</p><p>üõ† Create a new Swift file for the <code>struct</code> by right-clicking (or control-clicking) the <strong>SwiftUI Login Demo</strong> folder in Project Explorer and selecting <strong>New File‚Ä¶</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5KGLpG2sKiw4Xqem8zsaC3/92060a8ecc10a5fac799d99eea19711d/create_new_plist_1.png" alt="Xcode screenshot, showing the user selecting ‚ÄúFile -&gt; New File...‚Äù"/></p><p>üõ† In the window that appears, make sure that the <strong>iOS</strong> tab is selected. Select <strong>Swift File</strong>, then click <strong>Next</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1kPgckx5E6oEB8tfrPZUFa/e289b83402d8a06bdecc499ee3197887/create_new_swift_file.png" alt="Xcode screenshot, showing the selection of the ‚ÄúSwift File‚Äù file template.."/></p><p>üõ† Name the file <code>Profile<span>.</span>swift</code> and click <strong>Create</strong> to create the file:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5omkXIcNFgAvsw9lym2TaG/952b1334c717d1965a5c25ad224a6ec4/save_new_swift_file.png" alt="Xcode screenshot, showing the ‚ÄúSave‚Äù dialog box for the Swift file."/></p><p>Now that there‚Äôs a <code>Profile</code> <code>struct</code>, let‚Äôs implement it a little bit at a time.</p><p>üõ† Replace the contents of <code>Profile</code> with the following:</p><pre><code><span>// 1</span>
<span>import</span> <span>JWTDecode</span>


<span>// 2</span>
<span>struct</span> <span>Profile</span> <span>{</span>
  <span>let</span> id<span>:</span> <span>String</span>
  <span>let</span> name<span>:</span> <span>String</span>
  <span>let</span> email<span>:</span> <span>String</span>
  <span>let</span> emailVerified<span>:</span> <span>String</span>
  <span>let</span> picture<span>:</span> <span>String</span>
  <span>let</span> updatedAt<span>:</span> <span>String</span>
<span>}</span></code></pre><p>Here‚Äôs an explanation of the numbered comments in the code above:</p><ol start="1"><li>The ID token‚Äôs format is <a href="https://auth0.com/docs/secure/tokens/json-web-tokens" target="_blank" rel="noreferrer noopener">JWT, or JSON Web Token</a>. The <code>JWTDecode</code> library allows you to decode the token to extract the user profile information it contains.</li><li><p>This code defines <code>Profile</code>, the <code>struct</code> that will decode and store the user profile information in the ID token. It has the following properties, all of which are strings:</p><ul><li><code>id</code>: The user‚Äôs unique identifier</li><li><code>name</code>: The user‚Äôs full name</li><li><code>email</code>: The user‚Äôs email address</li><li><code>emailVerified</code>: <code><span>true</span></code> if the user verified their email address with Auth0, <code><span>false</span></code> otherwise</li><li><code>picture</code>: The URL for the user‚Äôs picture</li><li><code>updatedAt</code>: The date and time when the user profile was last updated</li></ul></li></ol><p>üõ† Add the following after the definition of <code>Profile</code>:</p><pre><code><span>extension</span> <span>Profile</span> <span>{</span>

<span>}</span></code></pre><p>Once again, we‚Äôre using an <code>extension</code> to break a <code>struct</code> into smaller parts that are easier to read and update. This extension will contain methods and variables that act like methods.</p><p>üõ† Add the following variable declaration <em>inside</em> the newly-created <code>extension</code>:</p><pre><code>  <span>static</span> <span>var</span> empty<span>:</span> <span>Self</span> <span>{</span>
    <span>return</span> <span>Profile</span><span>(</span>
      id<span>:</span> <span>&#34;&#34;</span><span>,</span>
      name<span>:</span> <span>&#34;&#34;</span><span>,</span>
      email<span>:</span> <span>&#34;&#34;</span><span>,</span>
      emailVerified<span>:</span> <span>&#34;&#34;</span><span>,</span>
      picture<span>:</span> <span>&#34;&#34;</span><span>,</span>
      updatedAt<span>:</span> <span>&#34;&#34;</span>
    <span>)</span>
  <span>}</span></code></pre><p>This defines <code>empty</code>, a static variable that acts more like a function. It creates a new <code>Profile</code> instance whose properties are all set to empty strings.</p><p>üõ† Add this function to the <code>extension</code> immediately after the declaration for <code>empty</code>:</p><pre><code><span>static</span> <span>func</span> <span>from</span><span>(</span><span>_</span> idToken<span>:</span> <span>String</span><span>)</span> <span>-</span><span>&gt;</span> <span>Self</span> <span>{</span>
  <span>guard</span> 
    <span>let</span> jwt <span>=</span> <span>try</span><span>?</span> <span>decode</span><span>(</span>jwt<span>:</span> idToken<span>)</span><span>,</span>
        <span>let</span> id <span>=</span> jwt<span>.</span>subject<span>,</span>
        <span>let</span> name <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;name&#34;</span><span>)</span><span>.</span>string<span>,</span>
        <span>let</span> email <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;email&#34;</span><span>)</span><span>.</span>string<span>,</span>
        <span>let</span> emailVerified <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;email_verified&#34;</span><span>)</span><span>.</span>boolean<span>,</span>
        <span>let</span> picture <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;picture&#34;</span><span>)</span><span>.</span>string<span>,</span>
        <span>let</span> updatedAt <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;updated_at&#34;</span><span>)</span><span>.</span>string
  <span>else</span> <span>{</span>
    <span>return</span> <span>.</span>empty
  <span>}</span>
  
  <span>return</span> <span>Profile</span><span>(</span>
    id<span>:</span> id<span>,</span>
    name<span>:</span> name<span>,</span>
    email<span>:</span> email<span>,</span>
    emailVerified<span>:</span> <span>String</span><span>(</span>describing<span>:</span> emailVerified<span>)</span><span>,</span>
    picture<span>:</span> picture<span>,</span>
    updatedAt<span>:</span> updatedAt
  <span>)</span>
<span>}</span></code></pre><p>Given an ID token string, the <code><span>from</span><span>(</span><span>)</span></code> function creates a <code>Profile</code> instance. If <code><span>from</span><span>(</span><span>)</span></code> is able to extract claims ‚Äî values about the user‚Äôs identity, which include their name, email address, and the URL for their picture ‚Äî from the ID token, it returns a <code>Profile</code> instance with that information in its properties. Otherwise, it returns a <code>Profile</code> instance with empty properties.</p><h3 id="Update-the-user-interface">Update the user interface</h3><p>Now that there‚Äôs a way to extract information from an ID token, let‚Äôs put it to use. In this step, we‚Äôll make changes to the user interface that will allow it to display the logged-in user‚Äôs name, email address, and picture.</p><p>üõ† Open <code>ContentView</code> and add a new property immediately after the one for <code>isAuthenticated</code>. Note where the comments tell you to add the new code:</p><pre><code>  @<span>State</span> <span>private</span> <span>var</span> isAuthenticated <span>=</span> <span>false</span>
  <span>// üëáüèΩüëáüèΩüëáüèΩ New line of code here!</span>
  @<span>State</span> <span>var</span> userProfile <span>=</span> <span>Profile</span><span>.</span>empty
  <span>// üëÜüèΩüëÜüèΩüëÜüèΩ</span></code></pre><p>This creates <code>userProfile</code>, an instance of <code>Profile</code> that will contain information about the user when they log in. The app will use its properties to display the user‚Äôs name, email address, and picture.</p><p>Since <code>userProfile</code> is marked with the <code>@State</code> attribute, it defines the user interface‚Äôs state. Whenever <code>userProfile</code> or one of its properties changes, the app redraws the user interface to reflect the change.</p><p>üõ† Add user interface elements to the <code>body</code> property to display the user‚Äôs information. Once again, the comments will tell you where to add new code:</p><pre><code>  <span>var</span> body<span>:</span> some <span>View</span> <span>{</span>

    <span>if</span> isAuthenticated <span>{</span>
      
      <span>// 3</span>
      <span>VStack</span> <span>{</span>
        
        <span>// 4</span>
        <span>Text</span><span>(</span><span>&#34;Logged in&#34;</span><span>)</span>
          <span>.</span><span>padding</span><span>(</span><span>)</span>
        
        <span>// üëáüèΩüëáüèΩüëáüèΩ New lines of code here!</span>
        <span>AsyncImage</span><span>(</span>url<span>:</span> <span>URL</span><span>(</span>string<span>:</span> userProfile<span>.</span>picture<span>)</span><span>)</span> <span>{</span> image <span>in</span>
          image
            <span>.</span><span>frame</span><span>(</span>maxWidth<span>:</span> <span>128</span><span>)</span>
        <span>}</span> placeholder<span>:</span> <span>{</span>
          <span>Image</span><span>(</span>systemName<span>:</span> <span>&#34;photo.circle.fill&#34;</span><span>)</span>
            <span>.</span><span>resizable</span><span>(</span><span>)</span>
            <span>.</span><span>scaledToFit</span><span>(</span><span>)</span>
            <span>.</span><span>frame</span><span>(</span>maxWidth<span>:</span> <span>128</span><span>)</span>
            <span>.</span><span>foregroundColor</span><span>(</span><span>.</span>gray<span>)</span>
            <span>.</span><span>opacity</span><span>(</span><span>0.5</span><span>)</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>40</span><span>)</span>
        
        <span>VStack</span> <span>{</span>
          <span>Text</span><span>(</span><span>&#34;Name: <span><span>\(</span>userProfile<span>.</span>name<span>)</span></span>&#34;</span><span>)</span>
          <span>Text</span><span>(</span><span>&#34;Email: <span><span>\(</span>userProfile<span>.</span>email<span>)</span></span>&#34;</span><span>)</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>)</span>
        <span>// üëÜüèΩüëÜüèΩüëÜüèΩ</span>
        
        <span>// 5</span>
        <span>Button</span><span>(</span><span>&#34;Log out&#34;</span><span>)</span> <span>{</span>
          <span>logout</span><span>(</span><span>)</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>)</span>
        
      <span>}</span>
      
    <span>}</span> <span>else</span> <span>{</span>
    
    <span>// The rest of the ‚Äúbody‚Äù property goes here...</span></code></pre><p>The new code adds two new views to <code>ContentView</code>:</p><ol start="1"><li>An <code>AsyncImage</code>, a view that will download the user‚Äôs picture asynchronously and displays it when the download is complete. It uses the <code>placeholder</code> option to display the camera icon from iOS‚Äôs built-in icon collection while downloading the user‚Äôs picture.</li><li>A <code>VStack</code> contains two <code>Text</code> views: one to display the user‚Äôs name and one for the user‚Äôs email address.</li></ol><p>üõ† Scroll to the <code>extension</code> where the methods for <code>ContentView</code> are defined and update <code><span>login</span><span>(</span><span>)</span></code> to extract the user‚Äôs profile information from the ID token. The comments in the code below will tell you where to add the new line:</p><pre><code>  <span>func</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
    <span>Auth0</span> <span>// 1</span>
      <span>.</span><span>webAuth</span><span>(</span><span>)</span> <span>// 2</span>
      <span>.</span>start <span>{</span> result <span>in</span> <span>// 3</span>
        <span>switch</span> result <span>{</span>
          <span>// 4</span>
          <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
            <span>print</span><span>(</span><span>&#34;Failed with: <span><span>\(</span>error<span>)</span></span>&#34;</span><span>)</span>
          <span>// 5</span>
          <span>case</span> <span>.</span><span>success</span><span>(</span><span>let</span> credentials<span>)</span><span>:</span>
            <span>self</span><span>.</span>isAuthenticated <span>=</span> <span>true</span>
            <span>// üëáüèΩüëáüèΩüëáüèΩ New line of code here!</span>
            <span>self</span><span>.</span>userProfile <span>=</span> <span>Profile</span><span>.</span><span>from</span><span>(</span>credentials<span>.</span>idToken<span>)</span>
            <span>// üëÜüèΩüëÜüèΩüëÜüèΩ</span>
            <span>print</span><span>(</span><span>&#34;Credentials: <span><span>\(</span>credentials<span>)</span></span>&#34;</span><span>)</span>
            <span>print</span><span>(</span><span>&#34;ID token: <span><span>\(</span>credentials<span>.</span>idToken<span>)</span></span>&#34;</span><span>)</span>
        <span>}</span>
      <span>}</span>
  <span>}</span></code></pre><p>The newly-added line of code runs after the user logs in and the app receives the ID token. It creates a new <code>Profile</code> instance from the data in the ID token and sets <code>ContentView</code>‚Äôs <code>userProfile</code> property to that instance.</p><h3 id="Run-the-app">Run the app</h3><p>Run the app and confirm that the changes work. When you log in, you should see the user‚Äôs name, email address, and picture.</p><h2 id="Next-Steps">Next Steps</h2><p>You‚Äôve covered a lot of ground in this exercise! Not only did you build an iOS app using the SwiftUI framework, but you also gave it the ability to authenticate users with Auth0.</p><p>You can download a completed project in the <a href="https://github.com/auth0-blog/get-started-ios-authentication-swiftui" target="_blank" rel="noreferrer noopener"><em>get-started-ios-authentication-swiftui</em> repository</a> on the <a href="https://github.com/auth0-blog" target="_blank" rel="noreferrer noopener"><em>Auth0 Blog Samples</em> GitHub account</a>.</p><p>SwiftUI is an expansive topic, and we only scratched its surface in this tutorial. For your next steps in exploring it, you might want to look at these useful resources:</p><ul><li><a href="https://www.hackingwithswift.com/quick-start/swiftui" target="_blank" rel="noreferrer noopener">SwiftUI by Example</a></li><li><a href="https://www.youtube.com/watch?v=VlhcNR7Qrno" target="_blank" rel="noreferrer noopener">Your First SwiftUI App</a></li><li><a href="https://www.youtube.com/playlist?list=PLpGHT1n4-mAsxuRxVPv7kj4-dQYoC3VVu" target="_blank" rel="noreferrer noopener">Stanford University‚Äôs ‚ÄúDeveloping Applications for iOS‚Äù course for Spring 2021</a></li></ul><p>This is the second in a new series of articles on iOS development with Auth0. Future articles will feature deeper dives into authentication and authorization with iOS and Auth0 and alternatives to the standard username-and-password approach. Watch this space!</p></div></div>]]></content:encoded>
      <pubDate>Wed, 30 Mar 2022 14:56:00 +0000</pubDate>
    </item>
    <item>
      <title>Get Started with iOS Authentication using SwiftUI, Part 2: User Profiles</title>
      <link>https://auth0.com/blog/get-started-ios-authentication-swift-swiftui-part-2-user-profiles/</link>
      <description>Learn how to use Auth0 and user profiles to basic information about logged-in users in iOS apps built with SwiftUI.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the previous part of this tutorial, you created a SwiftUI-based iOS app that uses Auth0 for basic login and logout functionality. In this part, you‚Äôll enhance your app by giving it the ability to read the user‚Äôs profile to display their photo, name, and email address when they‚Äôre logged in.</p><h2 id="Display-the-User-s-Profile-Information">Display the User‚Äôs Profile Information</h2><p>The app only ‚Äúknows‚Äù whether the user is logged in or logged out in its current state. It also has information about the user‚Äôs identity, which is encoded in the ID token. Let‚Äôs extract this user information ‚Äî the <em>user profile</em> ‚Äî and use it to display the user‚Äôs name, email address, and picture when the user is logged in. </p><p>When you‚Äôve completed this section, the app‚Äôs ‚Äúlogged in‚Äù screen will look something like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/EYzWjMRx1fIiX9rU4Jd99/0a85c0549351669da425b614b6e82a8f/updated_logged_in_screen.png" alt="The app‚Äôs ‚Äúlogged in‚Äù screen, now displaying the user‚Äôs picture, name, and email address."/></p><h3 id="Create-a-data-structure-for-the-user-profile">Create a data structure for the user profile</h3><p>We&#39;ll need to build a data structure to store it before we can extract the user‚Äôs profile information from the ID token. Let‚Äôs create a <code>struct</code> for that purpose.</p><p>üõ† Create a new Swift file for the <code>struct</code> by right-clicking (or control-clicking) the <strong>SwiftUI Login Demo</strong> folder in Project Explorer and selecting <strong>New File‚Ä¶</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5KGLpG2sKiw4Xqem8zsaC3/92060a8ecc10a5fac799d99eea19711d/create_new_plist_1.png" alt="Xcode screenshot, showing the user selecting ‚ÄúFile -&gt; New File...‚Äù"/></p><p>üõ† In the window that appears, make sure that the <strong>iOS</strong> tab is selected. Select <strong>Swift File</strong>, then click <strong>Next</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1kPgckx5E6oEB8tfrPZUFa/e289b83402d8a06bdecc499ee3197887/create_new_swift_file.png" alt="Xcode screenshot, showing the selection of the ‚ÄúSwift File‚Äù file template.."/></p><p>üõ† Name the file <code>Profile<span>.</span>swift</code> and click <strong>Create</strong> to create the file:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5omkXIcNFgAvsw9lym2TaG/952b1334c717d1965a5c25ad224a6ec4/save_new_swift_file.png" alt="Xcode screenshot, showing the ‚ÄúSave‚Äù dialog box for the Swift file."/></p><p>Now that there‚Äôs a <code>Profile</code> <code>struct</code>, let‚Äôs implement it a little bit at a time.</p><p>üõ† Replace the contents of <code>Profile</code> with the following:</p><pre><code><span>// 1</span>
<span>import</span> <span>JWTDecode</span>


<span>// 2</span>
<span>struct</span> <span>Profile</span> <span>{</span>
  <span>let</span> id<span>:</span> <span>String</span>
  <span>let</span> name<span>:</span> <span>String</span>
  <span>let</span> email<span>:</span> <span>String</span>
  <span>let</span> emailVerified<span>:</span> <span>String</span>
  <span>let</span> picture<span>:</span> <span>String</span>
  <span>let</span> updatedAt<span>:</span> <span>String</span>
<span>}</span></code></pre><p>Here‚Äôs an explanation of the numbered comments in the code above:</p><ol start="1"><li>The ID token‚Äôs format is <a href="https://auth0.com/docs/secure/tokens/json-web-tokens" target="_blank" rel="noreferrer noopener">JWT, or JSON Web Token</a>. The <code>JWTDecode</code> library allows you to decode the token to extract the user profile information it contains.</li><li><p>This code defines <code>Profile</code>, the <code>struct</code> that will decode and store the user profile information in the ID token. It has the following properties, all of which are strings:</p><ul><li><code>id</code>: The user‚Äôs unique identifier</li><li><code>name</code>: The user‚Äôs full name</li><li><code>email</code>: The user‚Äôs email address</li><li><code>emailVerified</code>: <code><span>true</span></code> if the user verified their email address with Auth0, <code><span>false</span></code> otherwise</li><li><code>picture</code>: The URL for the user‚Äôs picture</li><li><code>updatedAt</code>: The date and time when the user profile was last updated</li></ul></li></ol><p>üõ† Add the following after the definition of <code>Profile</code>:</p><pre><code><span>extension</span> <span>Profile</span> <span>{</span>

<span>}</span></code></pre><p>Once again, we‚Äôre using an <code>extension</code> to break a <code>struct</code> into smaller parts that are easier to read and update. This extension will contain methods and variables that act like methods.</p><p>üõ† Add the following variable declaration <em>inside</em> the newly-created <code>extension</code>:</p><pre><code>  <span>static</span> <span>var</span> empty<span>:</span> <span>Self</span> <span>{</span>
    <span>return</span> <span>Profile</span><span>(</span>
      id<span>:</span> <span>&#34;&#34;</span><span>,</span>
      name<span>:</span> <span>&#34;&#34;</span><span>,</span>
      email<span>:</span> <span>&#34;&#34;</span><span>,</span>
      emailVerified<span>:</span> <span>&#34;&#34;</span><span>,</span>
      picture<span>:</span> <span>&#34;&#34;</span><span>,</span>
      updatedAt<span>:</span> <span>&#34;&#34;</span>
    <span>)</span>
  <span>}</span></code></pre><p>This defines <code>empty</code>, a static variable that acts more like a function. It creates a new <code>Profile</code> instance whose properties are all set to empty strings.</p><p>üõ† Add this function to the <code>extension</code> immediately after the declaration for <code>empty</code>:</p><pre><code><span>static</span> <span>func</span> <span>from</span><span>(</span><span>_</span> idToken<span>:</span> <span>String</span><span>)</span> <span>-</span><span>&gt;</span> <span>Self</span> <span>{</span>
  <span>guard</span> 
    <span>let</span> jwt <span>=</span> <span>try</span><span>?</span> <span>decode</span><span>(</span>jwt<span>:</span> idToken<span>)</span><span>,</span>
        <span>let</span> id <span>=</span> jwt<span>.</span>subject<span>,</span>
        <span>let</span> name <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;name&#34;</span><span>)</span><span>.</span>string<span>,</span>
        <span>let</span> email <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;email&#34;</span><span>)</span><span>.</span>string<span>,</span>
        <span>let</span> emailVerified <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;email_verified&#34;</span><span>)</span><span>.</span>boolean<span>,</span>
        <span>let</span> picture <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;picture&#34;</span><span>)</span><span>.</span>string<span>,</span>
        <span>let</span> updatedAt <span>=</span> jwt<span>.</span><span>claim</span><span>(</span>name<span>:</span> <span>&#34;updated_at&#34;</span><span>)</span><span>.</span>string
  <span>else</span> <span>{</span>
    <span>return</span> <span>.</span>empty
  <span>}</span>
  
  <span>return</span> <span>Profile</span><span>(</span>
    id<span>:</span> id<span>,</span>
    name<span>:</span> name<span>,</span>
    email<span>:</span> email<span>,</span>
    emailVerified<span>:</span> <span>String</span><span>(</span>describing<span>:</span> emailVerified<span>)</span><span>,</span>
    picture<span>:</span> picture<span>,</span>
    updatedAt<span>:</span> updatedAt
  <span>)</span>
<span>}</span></code></pre><p>Given an ID token string, the <code><span>from</span><span>(</span><span>)</span></code> function creates a <code>Profile</code> instance. If <code><span>from</span><span>(</span><span>)</span></code> is able to extract claims ‚Äî values about the user‚Äôs identity, which include their name, email address, and the URL for their picture ‚Äî from the ID token, it returns a <code>Profile</code> instance with that information in its properties. Otherwise, it returns a <code>Profile</code> instance with empty properties.</p><h3 id="Update-the-user-interface">Update the user interface</h3><p>Now that there‚Äôs a way to extract information from an ID token, let‚Äôs put it to use. In this step, we‚Äôll make changes to the user interface that will allow it to display the logged-in user‚Äôs name, email address, and picture.</p><p>üõ† Open <code>ContentView</code> and add a new property immediately after the one for <code>isAuthenticated</code>. Note where the comments tell you to add the new code:</p><pre><code>  @<span>State</span> <span>private</span> <span>var</span> isAuthenticated <span>=</span> <span>false</span>
  <span>// üëáüèΩüëáüèΩüëáüèΩ New line of code here!</span>
  @<span>State</span> <span>var</span> userProfile <span>=</span> <span>Profile</span><span>.</span>empty
  <span>// üëÜüèΩüëÜüèΩüëÜüèΩ</span></code></pre><p>This creates <code>userProfile</code>, an instance of <code>Profile</code> that will contain information about the user when they log in. The app will use its properties to display the user‚Äôs name, email address, and picture.</p><p>Since <code>userProfile</code> is marked with the <code>@State</code> attribute, it defines the user interface‚Äôs state. Whenever <code>userProfile</code> or one of its properties changes, the app redraws the user interface to reflect the change.</p><p>üõ† Add user interface elements to the <code>body</code> property to display the user‚Äôs information. Once again, the comments will tell you where to add new code:</p><pre><code>  <span>var</span> body<span>:</span> some <span>View</span> <span>{</span>

    <span>if</span> isAuthenticated <span>{</span>
      
      <span>// 3</span>
      <span>VStack</span> <span>{</span>
        
        <span>// 4</span>
        <span>Text</span><span>(</span><span>&#34;Logged in&#34;</span><span>)</span>
          <span>.</span><span>padding</span><span>(</span><span>)</span>
        
        <span>// üëáüèΩüëáüèΩüëáüèΩ New lines of code here!</span>
        <span>AsyncImage</span><span>(</span>url<span>:</span> <span>URL</span><span>(</span>string<span>:</span> userProfile<span>.</span>picture<span>)</span><span>)</span> <span>{</span> image <span>in</span>
          image
            <span>.</span><span>frame</span><span>(</span>maxWidth<span>:</span> <span>128</span><span>)</span>
        <span>}</span> placeholder<span>:</span> <span>{</span>
          <span>Image</span><span>(</span>systemName<span>:</span> <span>&#34;photo.circle.fill&#34;</span><span>)</span>
            <span>.</span><span>resizable</span><span>(</span><span>)</span>
            <span>.</span><span>scaledToFit</span><span>(</span><span>)</span>
            <span>.</span><span>frame</span><span>(</span>maxWidth<span>:</span> <span>128</span><span>)</span>
            <span>.</span><span>foregroundColor</span><span>(</span><span>.</span>gray<span>)</span>
            <span>.</span><span>opacity</span><span>(</span><span>0.5</span><span>)</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>40</span><span>)</span>
        
        <span>VStack</span> <span>{</span>
          <span>Text</span><span>(</span><span>&#34;Name: <span><span>\(</span>userProfile<span>.</span>name<span>)</span></span>&#34;</span><span>)</span>
          <span>Text</span><span>(</span><span>&#34;Email: <span><span>\(</span>userProfile<span>.</span>email<span>)</span></span>&#34;</span><span>)</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>)</span>
        <span>// üëÜüèΩüëÜüèΩüëÜüèΩ</span>
        
        <span>// 5</span>
        <span>Button</span><span>(</span><span>&#34;Log out&#34;</span><span>)</span> <span>{</span>
          <span>logout</span><span>(</span><span>)</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>)</span>
        
      <span>}</span>
      
    <span>}</span> <span>else</span> <span>{</span>
    
    <span>// The rest of the ‚Äúbody‚Äù property goes here...</span></code></pre><p>The new code adds two new views to <code>ContentView</code>:</p><ol start="1"><li>An <code>AsyncImage</code>, a view that will download the user‚Äôs picture asynchronously and displays it when the download is complete. It uses the <code>placeholder</code> option to display the camera icon from iOS‚Äôs built-in icon collection while downloading the user‚Äôs picture.</li><li>A <code>VStack</code> contains two <code>Text</code> views: one to display the user‚Äôs name and one for the user‚Äôs email address.</li></ol><p>üõ† Scroll to the <code>extension</code> where the methods for <code>ContentView</code> are defined and update <code><span>login</span><span>(</span><span>)</span></code> to extract the user‚Äôs profile information from the ID token. The comments in the code below will tell you where to add the new line:</p><pre><code>  <span>func</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
    <span>Auth0</span> <span>// 1</span>
      <span>.</span><span>webAuth</span><span>(</span><span>)</span> <span>// 2</span>
      <span>.</span>start <span>{</span> result <span>in</span> <span>// 3</span>
        <span>switch</span> result <span>{</span>
          <span>// 4</span>
          <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
            <span>print</span><span>(</span><span>&#34;Failed with: <span><span>\(</span>error<span>)</span></span>&#34;</span><span>)</span>
          <span>// 5</span>
          <span>case</span> <span>.</span><span>success</span><span>(</span><span>let</span> credentials<span>)</span><span>:</span>
            <span>self</span><span>.</span>isAuthenticated <span>=</span> <span>true</span>
            <span>// üëáüèΩüëáüèΩüëáüèΩ New line of code here!</span>
            <span>self</span><span>.</span>userProfile <span>=</span> <span>Profile</span><span>.</span><span>from</span><span>(</span>credentials<span>.</span>idToken<span>)</span>
            <span>// üëÜüèΩüëÜüèΩüëÜüèΩ</span>
            <span>print</span><span>(</span><span>&#34;Credentials: <span><span>\(</span>credentials<span>)</span></span>&#34;</span><span>)</span>
            <span>print</span><span>(</span><span>&#34;ID token: <span><span>\(</span>credentials<span>.</span>idToken<span>)</span></span>&#34;</span><span>)</span>
        <span>}</span>
      <span>}</span>
  <span>}</span></code></pre><p>The newly-added line of code runs after the user logs in and the app receives the ID token. It creates a new <code>Profile</code> instance from the data in the ID token and sets <code>ContentView</code>‚Äôs <code>userProfile</code> property to that instance.</p><h3 id="Run-the-app">Run the app</h3><p>Run the app and confirm that the changes work. When you log in, you should see the user‚Äôs name, email address, and picture.</p><h2 id="Next-Steps">Next Steps</h2><p>You‚Äôve covered a lot of ground in this exercise! Not only did you build an iOS app using the SwiftUI framework, but you also gave it the ability to authenticate users with Auth0.</p><p>You can download a completed project in the <a href="https://github.com/auth0-blog/get-started-ios-authentication-swiftui" target="_blank" rel="noreferrer noopener"><em>get-started-ios-authentication-swiftui</em> repository</a> on the <a href="https://github.com/auth0-blog" target="_blank" rel="noreferrer noopener"><em>Auth0 Blog Samples</em> GitHub account</a>.</p><p>SwiftUI is an expansive topic, and we only scratched its surface in this tutorial. For your next steps in exploring it, you might want to look at these useful resources:</p><ul><li><a href="https://www.hackingwithswift.com/quick-start/swiftui" target="_blank" rel="noreferrer noopener">SwiftUI by Example</a></li><li><a href="https://www.youtube.com/watch?v=VlhcNR7Qrno" target="_blank" rel="noreferrer noopener">Your First SwiftUI App</a></li><li><a href="https://www.youtube.com/playlist?list=PLpGHT1n4-mAsxuRxVPv7kj4-dQYoC3VVu" target="_blank" rel="noreferrer noopener">Stanford University‚Äôs ‚ÄúDeveloping Applications for iOS‚Äù course for Spring 2021</a></li></ul><p>This is the second in a new series of articles on iOS development with Auth0. Future articles will feature deeper dives into authentication and authorization with iOS and Auth0 and alternatives to the standard username-and-password approach. Watch this space!</p></div></div>]]></content:encoded>
      <pubDate>Wed, 30 Mar 2022 14:56:00 +0000</pubDate>
    </item>
    <item>
      <title>Get Started with iOS Authentication using SwiftUI, Part 1: Login and Logout</title>
      <link>https://auth0.com/blog/get-started-ios-authentication-swift-swiftui-part-1-login-logout/</link>
      <description>Learn how to use Auth0 to implement basic login and logout in iOS apps built with SwiftUI.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>If you‚Äôre an iOS developer who‚Äôs new to SwiftUI and authentication with Auth0, you‚Äôre in for a treat. In this tutorial, you‚Äôll build an app in SwiftUI that implements basic login and logout using Auth0!</p><p><strong>This tutorial covers using version 2.0.0 of the Auth0.swift SDK to implement login/logout in an iOS app written using the Swift programming language and the SwiftUI framework.</strong> In the process, you‚Äôll get a quick introduction to the basics of our newly revised Swift SDK and how to use it with Apple‚Äôs SwiftUI framework. You‚Äôll also become familiar with the Auth0 dashboard and learn how to use it to register applications and manage users.</p><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong> </p></blockquote><h2 id="Apple-s-SwiftUI-Framework">Apple‚Äôs SwiftUI Framework</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4jOxDICikkdQLFNtPKaNSp/1356c0c9d7415de3ea7164671699d968/swiftui_logo.png" alt="SwiftUI logo" width="200"/></p><p><a href="https://developer.apple.com/xcode/swiftui/" target="_blank" rel="noreferrer noopener">SwiftUI</a> is a user interface toolkit and ‚Äúthe new way‚Äù for building apps that Apple introduced in 2019. With SwiftUI, you build user interfaces using Swift code with a <em>declarative</em> approach, which means that you specify how the UI should look and behave under different states. You don‚Äôt have to specify how the UI moves between those states ‚Äî it takes care of that for you. If you know <a href="https://reactjs.org/" target="_blank" rel="noreferrer noopener">React</a> programming, you‚Äôll find SwiftUI familiar.</p><p>The SwiftUI approach is quite different from the one used by <a href="https://developer.apple.com/documentation/uikit" target="_blank" rel="noreferrer noopener">UIKit</a>, iOS‚Äô original UI toolkit, which dates back to 2007. With UIKit, you build user interfaces using Interface Builder, a drag-and-drop layout tool to build the app‚Äôs views graphically. You connect UI elements to variables and methods in the app‚Äôs view controllers using outlets and actions. UIKit uses an imperative approach, which means that you define how the program moves between states and how the UI should look and behave in those states.</p><h2 id="Auth0-and-the--Auth0-swift--SDK">Auth0 and the <em>Auth0.swift</em> SDK</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2l2T8DQNjSXDHljZAJxlXa/ac5177aca992db4ab351d96f18a6f859/auth0_shield.png" alt="Auth0 logo" width="200"/></p><p>Adding login and logout to an app may seem like a simple task ‚Äî until you try it. You have to handle the many ways to log in, confirm email addresses and passwords, manage users, and handle security and scalability. Each of these issues has dozens of considerations, risks, issues, and edge cases.</p><p>Auth0 solves this problem. With Auth0 and a few lines of code, your app can have a full-featured system that supports logging in with a username/password combination, single sign-on and social accounts, passwordless login, biometrics, and more. You won‚Äôt have to handle the ‚Äúbehind the scenes‚Äù issues, either! Instead, you can focus on your app‚Äôs main functionality.</p><p><a href="https://auth0.com/docs/libraries/auth0-swift" target="_blank" rel="noreferrer noopener"><em>Auth0.swift</em></a> is the Auth0 SDK for all Apple platforms: not just iOS, but macOS, iPadOS, watchOS, and tvOS. It‚Äôs our third most-used SDK, accounting for 11% of all API requests made to our systems. If you‚Äôre building an Apple device application that needs to authenticate or authorize its users, you need this SDK!</p><p>The newest version of <em>Auth0.swift</em>, version 2.0.0, incorporates what we‚Äôve learned from securing applications on Apple devices over the past five years. If you‚Äôve used earlier versions, you‚Äôll appreciate its updated error handling, support for <a href="https://docs.swift.org/swift-book/LanguageGuide/Concurrency.html" target="_blank" rel="noreferrer noopener">async/await</a> and <a href="https://developer.apple.com/documentation/combine" target="_blank" rel="noreferrer noopener">Combine</a>, improved default configuration, new documentation, and that we removed deprecated methods and legacy features. If you‚Äôre new to Auth0, you‚Äôll be pleasantly surprised at how little code you‚Äôll need to write to add authentication to your apps.</p><h2 id="What-You-ll-Build">What You‚Äôll Build</h2><p>In this tutorial, you‚Äôll build a simple, single-screen iOS app that will allow the user to log in and log out using Auth0. While logged in, the screen will have a different appearance and show the user their name, email address, and photo from their profile.</p><p>In this tutorial, you‚Äôll build a simple, single-screen iOS app that will allow the user to log in and log out using Auth0. While logged in, the screen will have a different appearance and show the user their name, email address, and photo from their profile.</p><p>Instead of building the app from a starter project, you‚Äôll build it ‚Äúfrom scratch,‚Äù starting with selecting <strong>File</strong> ‚Üí <strong>New</strong> ‚Üí <strong>Project‚Ä¶</strong> from Xcode‚Äôs menu bar.</p><h3 id="A-quick-tour-of-the-app">A quick tour of the app</h3><p>When you launch the completed app, you‚Äôll see an logo icon, some status text, the app‚Äôs title, and a <strong>Log In</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2vCUITSZoWh5vx9rvaT23o/7f5a6ba12dd7948f2a93374a485e2abe/starter_app_1.png" alt="The app‚Äôs ‚ÄúLogged out‚Äù screen, featuring the app‚Äôs title, ‚ÄúSwiftUI Login Demo‚Äù and a ‚ÄúLog in‚Äù button."/></p><p>The <strong>Log in</strong> button takes the user to the <a href="https://auth0.com/docs/login/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login screen</a>, which appears in a custom browser window:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6viU0brK9Sf7kefqWhCpcL/3c0ada420ad13f7cf3a952a433412f76/swiftui_app_acreen_2.png" alt="The Auth0 Universal Login web page, with Auth0 logo and ‚Äúemail address‚Äù and ‚Äúpassword‚Äù fields."/></p><p>When you use Auth0 to add login/logout capability to your apps, you delegate authentication to Auth0‚Äôs <a href="https://auth0.com/docs/authenticate/login/auth0-universal-login" target="_blank" rel="noreferrer noopener">Universal Login</a>, a cross-platform webview-based page that supports logging in, signing up for an account, and other authentication flows. In this exercise, you‚Äôll use the default ‚Äúlook and feel‚Äù for the login page, but <a href="https://auth0.com/docs/universal-login/new-experience/universal-login-page-templates" target="_blank" rel="noreferrer noopener">you can customize it to match your app or organization‚Äôs branding</a>.</p><p>If the user logs in successfully, the Universal Login screen and its browser window disappear, and the user returns to the app, which now displays selected information from the user‚Äôs profile, namely their profile photo, name, and email address, as well as a <strong>Log out</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/EYzWjMRx1fIiX9rU4Jd99/0a85c0549351669da425b614b6e82a8f/updated_logged_in_screen.png" alt="The app‚Äôs ‚Äúlogged in‚Äù screen, featuring the text ‚ÄúLogged in‚Äù and displaying the user‚Äôs picture, name, and email address."/></p><p>The <strong>Log out</strong> button logs the user out and returns them to the initial screen.</p><h2 id="Prerequisites">Prerequisites</h2><p>Here‚Äôs a list of the software, hardware, and knowledge you‚Äôll need for this exercise.</p><h3 id="An-Auth0-account">An Auth0 account</h3><p>The app you will write for this article‚Äôs exercise uses Auth0 to provide login and logout functionality. As its developer, you‚Äôll need an Auth0 account. You can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free account</a>, which lets you add authentication for up to 10 applications and 7000 users. This should be enough for evaluating the platform, as well as for prototyping, development, and testing.</p><h3 id="An-iOS-development-setup">An iOS development setup</h3><p>To develop applications for any Apple hardware, you need a Mac computer running Xcode, Apple‚Äôs integrated development environment:</p><ul><li>Most Macs from mid-2013 or later with at least 8 GB RAM (16 GB preferred).</li><li>One of the more recent releases of macOS, preferably <a href="https://apps.apple.com/us/app/macos-big-sur/id1526878132?mt=12" target="_blank" rel="noreferrer noopener">Big Sur</a> or <a href="https://www.apple.com/macos/monterey/" target="_blank" rel="noreferrer noopener">Monterey</a>.</li><li><a href="https://developer.apple.com/xcode/" target="_blank" rel="noreferrer noopener">Xcode</a> version 11.0 (September 2019) or later. When writing this article, I used the current version: version 13.2.1 (13C100), released on December 17, 2021.</li></ul><h3 id="An-iOS-device--virtual-or-real">An iOS device, virtual or real</h3><p>Xcode comes with the Simulator, an application that creates virtual devices that simulate recent models of the iPhone, iPad, and iPod Touch models, all of which run iOS 15.</p><blockquote><p>To install earlier versions of iOS for the Simulator, select <strong>Preferences‚Ä¶</strong> from the <strong>Xcode</strong> menu, followed by the <strong>Components</strong> tab. You‚Äôll see a list of older versions of not just iOS, but watchOS and tvOS as well.</p></blockquote><p>One of the benefits of using the Simulator is that you <em>don‚Äôt</em> need an Apple Developer account ‚Äî free or paid ‚Äî to use it.</p><p>While the Simulator is convenient, there‚Äôs no substitute for an actual physical device. It provides a more realistic testing experience, since you can‚Äôt do certain things on the Simulator, such as motion/tilt sensing and augmented reality. </p><p>To deploy an app directly to a device for testing, you need a free Apple Developer account, which in turn requires an Apple ID. If you don‚Äôt have an Apple ID, <a href="https://appleid.apple.com/account?appId=632&amp;returnUrl=https%3A%2F%2Fdeveloper.apple.com%2Faccount%2F" target="_blank" rel="noreferrer noopener">sign up for one here</a>. Once you have an Apple ID, go to <a href="https://developer.app" target="_blank" rel="noreferrer noopener">developer.apple.com</a>, click the <a href="https://developer.apple.com/account/" target="_blank" rel="noreferrer noopener"><strong>Account</strong></a> at the top of the page, and sign in.   </p><p>You need to register the device in your developer account to deploy apps to it; <a href="https://developer.apple.com/account/resources/devices/list" target="_blank" rel="noreferrer noopener">you do so on this page in the Apple Developer site</a>. You can register up to 100 devices per membership year. You‚Äôll need to provide the device‚Äôs UDID (Unique Device IDentifier), and <a href="https://udid.tech/" target="_blank" rel="noreferrer noopener">you may find this site helpful</a>. Once you‚Äôve registered a device, you can deploy apps directly to it; see <a href="https://developer.apple.com/documentation/xcode/distributing-your-app-to-registered-devices" target="_blank" rel="noreferrer noopener"><em>Distributing Your App to Registered Devices</em></a> for more information.</p><p>To deploy apps to the App Store, you‚Äôll need a paid account. For more details, see the <a href="https://developer.apple.com/programs/enroll/" target="_blank" rel="noreferrer noopener">Apple Developer enrollment page</a>.</p><p>To find out more about running apps on virtual and real iOS devices, start with Apple‚Äôs article, <a href="https://developer.apple.com/documentation/xcode/running-your-app-in-the-simulator-or-on-a-device" target="_blank" rel="noreferrer noopener"><em>Running Your App in the Simulator or on a Device</em></a>.</p><h3 id="Some-knowledge-of-Swift-and--struct-s">Some knowledge of Swift and <code>struct</code>s</h3><p>While not completely necessary, it would help if you were familiar with the Swift programming language and iOS development. If these are new to you, the Swift programming language, or the UIKit framework, try this Apple tutorial: <a href="https://developer.apple.com/tutorials/app-dev-training/getting-started-with-today" target="_blank" rel="noreferrer noopener"><em>Getting Started with Today,</em></a>.</p><p>SwiftUI relies heavily on <code>struct</code>s, so you may find it helpful to review their basics. You may find <em>Hacking with Swift‚Äôs</em> article, <a href="https://www.hackingwithswift.com/quick-start/beginners/how-to-create-your-own-structs" target="_blank" rel="noreferrer noopener"><em>How to create your own structs</em></a>, helpful.</p><h2 id="Make-a-New-SwiftUI-App">Make a New SwiftUI App</h2><p>Let‚Äôs start by building a new SwiftUI app. Once we have a basic app working and you‚Äôve learned about a few SwiftUI interface elements, we‚Äôll incorporate Auth0 authentication and then finish the exercise by adding some user experience flair.</p><h3 id="Start-from-scratch">Start from scratch</h3><p>üõ† Launch Xcode and create a new project by opening the <strong>File</strong> menu and selecting <strong>New</strong> ‚Üí <strong>Project...</strong>.</p><p>Xcode will present this dialog box, where you‚Äôll choose a project template for the app you‚Äôll create. Each template generates the necessary files for different applications, including general-purpose apps, videogames, augmented reality apps, and add-ons that add custom features to iMessage and Safari.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3ODgLadC5ufqPqzgKO54C8/fed4b68956a55076b2350b8c10cdea7b/choose_template.png" alt="Xcode‚Äôs ‚ÄúChoose a template for your new project‚Äù dialog, with ‚ÄúiOS‚Äù and ‚ÄúApp‚Äù selected."/></p><p>üõ† For this exercise, we want to create a general-purpose app for iOS, so select the <strong>iOS</strong> tab, then select <strong>App</strong> project template, which will be at the upper left corner of the collection. Click the <strong>Next</strong> button to confirm the selection.</p><p>Xcode will display the next dialog box, where you‚Äôll give the project its human- and computer-friendly names and specify which programming language and framework you‚Äôll use:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1Ovxubuy744ymhlGzG9weh/89c5147cf335642710aece40e62ec5cc/choose_options.png" alt="Xcode‚Äôs ‚ÄúChoose options for your new project‚Äù dialog, with the  ‚ÄúProduct Name‚Äù field filled with ‚ÄúSwiftUI Login Demo‚Äù."/></p><p>üõ† In this dialog box, do the following:</p><ul><li>Enter a name for the project into the <strong>Product Name</strong> field. For this exercise, I used the name <code>SwiftUI Login Demo</code>.</li><li>Select a team from the <strong>Team</strong> menu. 
If you haven‚Äôt created a development team yet and want to continue with this exercise without going through the process of signing up for an Apple developer account and creating a team, select <strong>None</strong>. This will let you deploy the app to the Simulator but not to a device.</li><li>Enter <code>com<span>.</span>example</code> into the <strong>Organization Identifier</strong> field.</li><li>Select <strong>SwiftUI</strong> from the <strong>Interface</strong> menu.</li><li>Select <strong>Swift</strong> from the <strong>Language</strong> menu.</li><li>Click the <strong>Next</strong> button.</li></ul><p>üõ† Xcode will show one more dialog box ‚Äî this one lets you specify where your project and its files will be stored. Select a location.</p><p>Once you‚Äôve completed the steps above, Xcode will generate the files for your project and display the main window:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1XrrWzO79Gn3TzLuJjIjsJ/37701f5b6d4deca6c8fa65dffaa8cc89/initial_xcode_window.png" alt="The Xcode window displaying the newly created project, with an empty Preview pane."/></p><p>Whenever you create a new SwiftUI project using the App template, Xcode generates a single view named <code>ContentView</code>, whose contents are the first thing you see once it creates the project.</p><p>This is <code>ContentView</code>‚Äôs initial code, annotated with numbered comments:</p><pre><code><span>import</span> <span>SwiftUI</span>  <span>// 1</span>

<span>// 2</span>
<span>struct</span> <span>ContentView</span><span>:</span> <span>View</span> <span>{</span>
  
  <span>// 3</span>
  <span>var</span> body<span>:</span> some <span>View</span> <span>{</span>
    
    <span>// 4</span>
    <span>Text</span><span>(</span><span>&#34;Hello, world!&#34;</span><span>)</span>
      <span>.</span><span>padding</span><span>(</span><span>)</span>
  <span>}</span>
<span>}</span>

<span>// 5</span>
<span>struct</span> <span>ContentView_Previews</span><span>:</span> <span>PreviewProvider</span> <span>{</span>
  <span>static</span> <span>var</span> previews<span>:</span> some <span>View</span> <span>{</span>
    <span>ContentView</span><span>(</span><span>)</span>
  <span>}</span>
<span>}</span></code></pre><p>Here‚Äôs what‚Äôs happening in the code marked by the numbered comments above:</p><ol start="1"><li>Any SwiftUI project file that defines a UI element, whether a whole screen or a single control, must import the SwiftUI library.</li><li>In SwiftUI, every UI element is a view ‚Äî a <code>struct</code> that adopts the <code>View</code> protocol, which defines the functionality that a SwiftUI onscreen element should provide. This particular view, <code>ContentView</code>, defines the app‚Äôs single screen.</li><li>The <code>View</code> protocol has a single requirement: any type that adopts it must have a <code>body</code> property, which defines the UI element‚Äôs appearance and behavior. The <code>body</code> property‚Äôs type is <code>some View</code>, which is <a href="https://www.process-one.net/blog/the-concepts-behind-swiftui-what-is-the-keyword-some-doing/" target="_blank" rel="noreferrer noopener">Swift‚Äôs way of saying ‚Äúsome type that adopts the <code>View</code> protocol</a>.‚Äù Note that <code>body</code>‚Äôs value is determined by a <a href="https://www.appypie.com/closures-swift-how-to" target="_blank" rel="noreferrer noopener">closure</a>, which is a block of code that you can pass to a function.</li><li>You‚Äôve probably figured out that <code>Text</code> is a view for displaying text onscreen. Views can be followed by <em>modifiers</em> ‚Äî methods that change their appearance or behavior. In this case, we‚Äôre adding space between the <code>Text</code> view‚Äôs contents and edges with the <code><span>padding</span><span>(</span><span>)</span></code> modifier.</li><li>When Xcode creates a new file for a view, it generates two <code>struct</code>s: one for the view that appears in the app, and one for a preview that appears in the Xcode editor. This <code>struct</code>, <code>ContentView_Previews</code>, generates a preview of <code>ContentView</code> that allows you to see what it will look like without requiring you to compile and run the app.</li></ol><p>When editing view files, Xcode divides the editing area in the center of its screen into two areas: a code editor and a preview viewer. </p><p>üõ† To see what the app‚Äôs user interface will look like, make a selection from the simulator device menu, then click the <strong>Resume</strong> button in the preview viewer:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5kG3XOQE4EUyNEy0NbMsJ2/f09860c42e01722cd511f5571f081967/select_simulator_device_and_click_resume.png" alt="The Xcode window, with instructions to select a simulator device and click the ‚ÄúResume‚Äù button."/></p><p>You should see something like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6pOLYbPrYnl4o5w6bCpfLK/1a2dff3da2c8670afa72cccff70cafd2/default_app_in_simulator.png" alt="The Xcode window, with the Preview pane displaying a preview of the app."/></p><p>üõ† You can also choose to see the app in action by running it. Select a Simulator device or connect a real device to your computer and click the <strong>Run</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1H4UKWoPWVgKhXub4yczTS/18bcbb01715cdc95017d085468425913/running_the_default_app.png" alt="The Xcode window, with instructions to make sure you‚Äôve selected a simulator device and click the ‚ÄúRun‚Äù¬†button."/></p><p>The Simulator will launch, and you‚Äôll shortly see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6kmQHF60K65RH0tw6RHm13/0fefc68078af348c8aeec0db3262e580/simulator_initial_run.png" alt="The Xcode simulator simulating an iPhone 13. Its screen is blank, except for the sentence ‚ÄúHello, World!‚Äù in the center."/></p><h3 id="Add-state-and-interactivity-to-the-app">Add state and interactivity to the app</h3><p>It‚Äôs time for the app to do more than just display ‚ÄúHello, World!‚Äù Let‚Äôs create the app‚Äôs two states ‚Äî¬†logged out and logged in ‚Äî and provide a way for the user to navigate between them.</p><p>When launched, the app will feature title text and a <strong>Log in</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2vCUITSZoWh5vx9rvaT23o/7f5a6ba12dd7948f2a93374a485e2abe/starter_app_1.png" alt="The app‚Äôs ‚ÄúLogged out‚Äù screen, featuring the app‚Äôs title, ‚ÄúSwiftUI Login Demo‚Äù and a ‚ÄúLog in‚Äù button."/></p><p>Tapping the <strong>Log in</strong> button takes you to this screen, which has the text ‚ÄúLogged in‚Äù and a <strong>Log out</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4uU0WdpCV2zDclRYVQdimA/fb93f1404bdda89c2705f6c767239b4a/starter_app_2.png" alt="The app‚Äôs ‚ÄúLogged in‚Äù screen, featuring the text ‚ÄúLogged in‚Äù and a ‚ÄúLog out‚Äù button."/></p><p>üõ† In Xcode, open the <code>ContentView</code> file and replace the <code>ContentView</code> <code>struct</code> with the following:</p><pre><code><span>struct</span> <span>ContentView</span><span>:</span> <span>View</span> <span>{</span>
  
  <span>// 1</span>
  @<span>State</span> <span>private</span> <span>var</span> isAuthenticated <span>=</span> <span>false</span>


  <span>var</span> body<span>:</span> some <span>View</span> <span>{</span>

    <span>// 2</span>
    <span>if</span> isAuthenticated <span>{</span>
      
      <span>// 3</span>
      <span>VStack</span> <span>{</span>
        
        <span>Text</span><span>(</span><span>&#34;Logged in&#34;</span><span>)</span>
          <span>.</span><span>padding</span><span>(</span><span>)</span>
        
        <span>// 4</span>
        <span>Button</span><span>(</span><span>&#34;Log out&#34;</span><span>)</span> <span>{</span>
          isAuthenticated <span>=</span> <span>false</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>)</span>
        
      <span>}</span>
      
    <span>}</span> <span>else</span> <span>{</span>
    
      <span>// 5</span>
      <span>VStack</span> <span>{</span>
        
        <span>Text</span><span>(</span><span>&#34;SwiftUI Login Demo&#34;</span><span>)</span>
          <span>.</span><span>padding</span><span>(</span><span>)</span>
        
        <span>// 6</span>
        <span>Button</span><span>(</span><span>&#34;Log in&#34;</span><span>)</span> <span>{</span>
          isAuthenticated <span>=</span> <span>true</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>)</span>
        
      <span>}</span>
      
    <span>}</span> <span>// if isAuthenticated</span>
    
  <span>}</span>
  
<span>}</span></code></pre><p>I‚Äôve marked the code with numbered comments, which are explained below:</p><ol start="1"><li>This line declares a new private instance variable, <code>isAuthenticated</code>. It starts with <code>@State</code>, which tells SwiftUI a couple of things about it:
 <ul><li><code>@State</code> informs SwiftUI that this variable is part of the view‚Äôs <em>state</em>, which is the set of variables that affect its appearance and behavior. When the value of any state variable in a view is changed, SwiftUI redraws the view to reflect that change. The value of <code>isAuthenticated</code> will be set to <code><span>true</span></code> if the user is logged in and <code><span>false</span></code> if the user is logged out. Since this value will affect the app‚Äôs appearance, I‚Äôve made it a state variable.</li><li><code>@State</code> also allows the <code>struct</code>‚Äôs methods to change its value. By default, a <code>struct</code>‚Äôs methods can‚Äôt change the values of its variables.</li></ul></li><li>The app should display a different screen depending on the value of <code>isAuthenticated</code>. This <code><span>if</span></code> statement determines the value that will be assigned to <code>body</code>, which determines the onscreen user interface.</li><li>This is the branch of the <code><span>if</span></code> statement that executes if the user is logged in. The result of this branch must be a single view, which is a problem: we want to display <em>two</em> views: some text and the <strong>Log out</strong> button. To work around this limitation, we‚Äôll use a view that acts as a container for other views: <code>VStack</code>, whose name is short for ‚Äúvertical stack.‚Äù It can take up to 10 views, which it displays in a vertical column, with the first view appearing at the top and subsequent views appearing below the topmost view.</li><li>The <code>Button</code> view takes two arguments:
 <ul><li>A string value for the button‚Äôs label: ‚ÄúLogged in‚Äù.</li><li>A closure that defines what should happen when the user presses the button: it changes the value of <code>isAuthenticated</code> to <code><span>false</span></code>. Since <code>isAuthenticated</code> is a state variable, changing its value causes SwiftUI to redraw <code>ContentView</code>. When that happens, the app will execute the other branch of the <code><span>if</span></code> statement.</li></ul></li><li>This is the branch of the <code><span>if</span></code> statement that executes if the user is not logged in. The result of this branch is another <code>VStack</code> ‚Äî this one contains the app‚Äôs title and the <strong>Log in</strong> button.</li><li>This <code>Button</code> view is similar to the one for the <strong>Log in</strong> button, except that it says <strong>Log out</strong> and sets <code>isAuthenticated</code> to <code><span>true</span></code> when pressed.</li></ol><p>üõ† If the <strong>Resume</strong> button is visible in the Preview pane, click it. It will update to display the new user interface.</p><p>üõ† Run the app to see it in action. Click the <strong>Log in</strong> and <strong>Log out</strong> buttons to go from screen to screen.</p><h3 id="Refactor-the-buttons--code">Refactor the buttons‚Äô code</h3><p>As SwiftUI views become more complex, their code often becomes increasingly hard to read. One way to keep them readable is to put code in closures into their own methods.</p><p>üõ† Add this extension to <code>ContentView</code>, between <code>ContentView</code> and <code>ContentView_Previews</code>:</p><pre><code><span>extension</span> <span>ContentView</span> <span>{</span>
  
  <span>func</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
    isAuthenticated <span>=</span> <span>true</span>
  <span>}</span>
  
  <span>func</span> <span>logout</span><span>(</span><span>)</span> <span>{</span>
    isAuthenticated <span>=</span> <span>false</span>
  <span>}</span>
  
<span>}</span></code></pre><p>üõ† Update the code for the <strong>Log out</strong> button in <code>ContentView</code> to the following:</p><pre><code>        <span>Button</span><span>(</span><span>&#34;Log out&#34;</span><span>)</span> <span>{</span>
          <span>logout</span><span>(</span><span>)</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>)</span></code></pre><p>üõ† Update the code for the <strong>Log in</strong> button in <code>ContentView</code> to the following:</p><pre><code>        <span>Button</span><span>(</span><span>&#34;Log in&#34;</span><span>)</span> <span>{</span>
          <span>login</span><span>(</span><span>)</span>
        <span>}</span>
        <span>.</span><span>padding</span><span>(</span><span>)</span></code></pre><p>üõ† Run the app. It will still work the same way, but by extracting the buttons‚Äô closures into their own methods and putting those methods into their own extension, the code will be easier to read and change.</p><h2 id="Set-Up-the-App-to-Integrate-with-Auth0">Set Up the App to Integrate with Auth0</h2><p>Now that you‚Äôve been introduced to a few SwiftUI views and have seen how SwiftUI uses state to configure the user interface, it‚Äôs time to change the app to one that uses Auth0 for user authentication. </p><h3 id="Install-the--Auth0-swift--package">Install the <em>Auth0.swift</em> package</h3><p>Let‚Äôs take on the first part of this task: setting up the app to integrate with Auth0. We‚Äôll do this by adding the <em>Auth0.swift</em> package to the project.</p><p><em>Auth0.swift</em> is a collection of libraries that allow applications written in Swift to make use of Auth0‚Äôs authorization and authentication functionality. It contains these Swift libraries:</p><ul><li><code>Auth0</code>: A toolkit for using <a href="https://auth0.com/docs/api" target="_blank" rel="noreferrer noopener">Auth0‚Äôs APIs</a>, including the <a href="https://auth0.com/docs/api/authentication" target="_blank" rel="noreferrer noopener">Authentication API</a>, which you‚Äôll use to implement login and logout in the app.</li><li><code>JWTDecode</code>: A library for decoding <a href="https://jwt.io/introduction" target="_blank" rel="noreferrer noopener">JWTs (JSON web tokens)</a>.</li><li><code>SimpleKeychain</code>: A wrapper for the <a href="https://developer.apple.com/documentation/security/keychain_services" target="_blank" rel="noreferrer noopener">iOS Keychain</a> useful for securely storing small chunks of data, such as user credentials.</li></ul><p>There are three ways to install <em>Auth0.swift</em>:</p><ol start="1"><li><a href="https://swift.org/package-manager/" target="_blank" rel="noreferrer noopener">Swift Package Manager</a>, Apple‚Äôs dependency manager</li><li><a href="https://cocoapods.org/" target="_blank" rel="noreferrer noopener">Cocoapods</a>, a long-standing third-party package manager first released in 2011 and used in many projects</li><li><a href="https://github.com/Carthage/Carthage" target="_blank" rel="noreferrer noopener">Carthage</a>, another third-party package manager</li></ol><p>I chose to use Swift Package Manager for this tutorial because it‚Äôs built into Xcode and doesn‚Äôt require additional software. If you‚Äôd rather use Cocoapods or Carthage to install <em>Auth0.swift</em>, <a href="https://auth0.com/docs/quickstart/native/ios-swift#install-the-sdk" target="_blank" rel="noreferrer noopener">see these instructions</a>.</p><p>üõ† To start the process of installing the <em>Auth0.swift</em> package, open the <strong>File</strong> menu and select <strong>Add Packages...</strong>. This window will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/100ew69wVN7eru0ygSH43x/33e6c376160781a92e5e072a4de15f3e/install_auth0_package_1.png" alt="The ‚ÄúAdd Packages‚Äù window."/></p><p>üõ† Enter the URL for the <em>Auth0.swift</em> package repository into the window‚Äôs search field:</p><pre><code>https<span>:</span><span>/</span><span>/</span>github<span>.</span>com<span>/</span>auth0<span>/</span>Auth0<span>.</span>swift<span>.</span>git</code></pre><p>Xcode will search online and display any packages it finds at the URL. The search should produce a single result: <em>Auth0.swift</em>.</p><p>üõ† Select the <strong>Auth0.swift</strong> package when it appears in the list. In the <strong>Dependency Rule</strong> menu, select <strong>Up to Next Major Version</strong> and make sure that the version number in the text field to its right os <code><span>2.0</span><span>.0</span></code>, then click <strong>Add Package</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/31e6E1Au6syIpBz9TlFz21/2c1c5a917ed69b2d269b60a45d154804/install_auth0_package_2.png" alt="The ‚ÄúAdd Packages‚Äù window, with instructions for adding the ‚ÄúAuth0.swift‚Äù package."/></p><p>üõ† You‚Äôll be asked to confirm that you want to add the <em>Auth0.swift</em> package. Click <strong>Add Package</strong> to reassure Xcode that yes, you want <em>Auth0.swift</em>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/DgmNEWGaLNYY45YN5yeQI/87847efc55729dcab638062cf418ee2f/install_auth0_package_3.png" alt="The ‚ÄúAdd Packages‚Äù window, with a modal window asking the user to select the packages to add."/></p><p>When <em>Auth0.swift</em> finishes installing, its package will appear in the list under the <strong>Package Dependencies</strong> tab of the project screen. You‚Äôll see <em>Auth0.swift‚Äôs</em> libraries listed in the Project Explorer pane: </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6I5vKsKOPqOuoIbu0WpoTy/0e7aebb51574beb841347a5eb9d81b05/install_auth0_package_4.png" alt="Xcode‚Äôs ‚ÄúPackage Dependencies‚Äù tab."/></p><p>At this point, the functionality contained within <em>Auth0.swift</em> is now available to your app. You‚Äôll start using it once you‚Äôve done all the necessary Auth0 setup.</p><h3 id="Add-a-property-list-to-store-Auth0-credentials">Add a property list to store Auth0 credentials</h3><p>In order to use Auth0 to authenticate users, your app needs to:</p><ul><li>communicate with the appropriate Auth0 <a href="https://auth0.com/docs/get-started/auth0-overview/create-tenants#create-a-tenant-and-domain" target="_blank" rel="noreferrer noopener">tenant</a>, and</li><li>identify itself to that server.</li></ul><p>You do this by providing the app with that tenant‚Äôs identifier, a value known as the <em>domain</em>, and the app‚Äôs identifier, the <em>client ID</em>. <em>Auth0.swift</em> expects to find these values in a property list (a <code><span>.</span>plist</code> file), so let‚Äôs create one.</p><p>üõ† Create a new property list file by right-clicking (or control-clicking) the <strong>SwiftUI Login Demo</strong> folder in Project Explorer and selecting <strong>New File‚Ä¶</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5KGLpG2sKiw4Xqem8zsaC3/92060a8ecc10a5fac799d99eea19711d/create_new_plist_1.png" alt="Xcode screenshot, showing the user selecting ‚ÄúFile -&gt; New File...‚Äù"/></p><p>üõ† In the window that appears, make sure that the <strong>iOS</strong> tab is selected. Scroll down the list of icons until you see the <strong>Property List</strong> icon. Select it, then click <strong>Next</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/50TZKBjTR6ReJdsK98VQnw/ee65a98f22e36cf272e199f203e8abd2/create_new_plist_2.png" alt="Xcode screenshot, showing the selection of the ‚ÄúProperty List‚Äù file template."/></p><p>üõ† Name the file <code>Auth0<span>.</span>plist</code> and click <strong>Create</strong> to create the file:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/am3pLocO8RHtF5aEROzXK/55bb5dd0406854d05270b4f840a54648/create_new_plist_3.png" alt="Xcode screenshot, showing the ‚ÄúSave‚Äù dialog box for the property list."/></p><p>Xcode will display the new <code>Auth0<span>.</span>plist</code> file in a table format. Let‚Äôs add two rows to the table, which will hold the domain and client ID values.</p><p>üõ† Move the cursor over the <strong>Root</strong> row to reveal the <strong>+</strong> button. Click on the <strong>+</strong> button <em>twice</em> to add <em>two</em> rows:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4H8mDfUiIFOSAgB9fjJhFq/e1e3b06dbe83b11766bd0f5faf36d459/create_new_plist_4.png" alt="Xcode screenshot, showing the creation of two new rows in the property list."/></p><p>üõ† Enter the following values into the two rows:</p><ul><li>Row 1:
  <ul><li><strong>Key:</strong> <code>Domain</code></li><li><strong>Type:</strong> <code>String</code></li><li><strong>Value:</strong> Leave this blank for the time being. You‚Äôll get this value from the Auth0 dashboard.</li></ul></li><li>Row 2:
  <ul><li><strong>Key:</strong> <code>ClientId</code></li><li><strong>Type:</strong> <code>String</code></li><li><strong>Value:</strong> Leave this blank for the time being. You‚Äôll get this value from the Auth0 dashboard.</li></ul></li></ul><p>Your <code>Auth0</code> plist file should look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/60Ge68Pws1CRwoJtvUfPTl/cbec84d40dcde9014df4a08b3a86dba1/create_new_plist_5.png" alt="Xcode screenshot, showing the completed property list."/></p><h2 id="Set-Up-Auth0-to-Integrate-with-Your-App">Set Up Auth0 to Integrate with Your App</h2><p>Now that you‚Äôve set up the app to work with Auth0, it‚Äôs time to set up your Auth0 tenant to work with the app. To accomplish this, you‚Äôll do the following:</p><ol start="1"><li>Add the app to your Auth0 dashboard‚Äôs list of registered applications</li><li>Gather two pieces of information that the app will need to delegate login/logout to Auth0: 
 <ul><li>Your tenant‚Äôs domain</li><li>The client ID that Auth0 will assign to the app</li></ul></li><li>Provide Auth0 with the necessary callback URLs to contact the app: one to call at the end of the login process and the other to call at the end of the logout process</li></ol><p>You‚Äôll need an Auth0 account for this step. Once again, <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">you can sign up for an Auth0 account for free!</a> We‚Äôve taken great care to make the process as painless as possible.</p><h3 id="Add-the-app-to-the-Applications-list">Add the app to the Applications list</h3><p>üõ† Log into the Auth0 dashboard and select <strong>Applications</strong> ‚Üí <strong>Applications</strong> from the menu on the left side of the page.</p><p>You will now be on the <strong>Applications</strong> page, which lists all the applications that you have registered with Auth0. Let‚Äôs add your app to the list.</p><p>üõ† Start the process of registering a new app by clicking the <strong>Create application</strong> button near the top right of the page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3WYgeMPVAzoHBoxWKEdoDN/9249d91dff46dc1396c3d54d303de6f8/dashboard_-_create_application.png" alt="The ‚ÄúApplications‚Äù page. The reader is directed to click the ‚ÄúCreate Application‚Äù button."/></p><p>You‚Äôll see this dialog appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/48XqjmIoSHGZDmqLWNtRXF/3c0b5413d23580e079db43c9ed5ee711/dashboard_-_create_application_dialog.png" alt="The ‚ÄúCreate application‚Äù dialog. The application‚Äôs name is set to ‚ÄúiOS Auth‚Äù, and the selected application type is ‚ÄúNative‚Äù."/></p><p>üõ† You‚Äôll need to provide two pieces of information to continue:</p><ul><li>Enter a name for the app in the name field. It might be simplest to use the same name as your Xcode project (if you‚Äôve been following my example, use the name <strong>SwiftUI Login Demo</strong>).</li><li>Specify the application type, which in this case is <strong>Native</strong>.</li></ul><p>üõ† Click <strong>Create</strong>. The <strong>Quick Start</strong> page for the app will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/48nyPyhRSWRdn2vGCdlYoP/1600210c674dd6e6c7daf7c2ee46cc27/quick_start_tab.png" alt="The ‚ÄúQuick Start‚Äù page. It contains several icons, each one representing an operating system or platform."/></p><p>This page provides you with ready-made projects for several different platforms that you can use as the basis for an application that delegates authentication to Auth0. You won‚Äôt be using any of them in this exercise; instead, you‚Äôll make use of a couple of Auth0 libraries and write the code yourself. It‚Äôs more educational ‚Äî and more importantly, <em>fun</em> ‚Äî that way.</p><p>üõ† Click the <strong>Settings</strong> tab, which will take you to this page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/37HtYh1S4r9FCYZfSB0bvB/055ca8a7e14e9da539f11c39c4822154/settings_tab.png" alt="The ‚ÄúApplication‚Äù page‚Äôs ‚ÄúSettings‚Äù tab."/></p><p>You‚Äôre going to do two critical things on this page:</p><ol start="1"><li>Get information that the app needs to know about Auth0, and</li><li>Provide information that Auth0 needs to know about the app.</li></ol><p>Let‚Äôs take care of the first one: Getting the information that the app needs, namely the domain and client ID, which you‚Äôll enter into the property list file you created earlier.</p><p>üõ† Copy the contents of the <strong>Domain</strong> field, then switch to Xcode, open the <code>Auth0</code> property list, and paste the domain value you copied into the <strong>Domain</strong> row‚Äôs <strong>Value</strong> field.</p><p>üõ† Next, go back to the Auth0 dashboard and copy the contents of the <strong>Client ID</strong> field, then switch to Xcode, and paste the domain value you copied into the <strong>ClientId</strong> row‚Äôs <strong>Value</strong> field in the property list.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7mXvwXHQMTzNLWaCktaZKK/4d0f3288d300cf53db4ca20897337c9d/copy_domain_and_clientid_values.png" alt="The Auth0 property list in Xcode, with instructions to copy and paste the ‚ÄúDomain‚Äù and ‚ÄúClient ID‚Äù values into it."/></p><p>üõ† Return to the Auth0 dashboard and scroll down to the <strong>Applications URIs</strong> section:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/55BxLToXj6zXYvxaYLmICP/0998fb3d2e81a9c5a1285849c2a394c4/application_uris_section.png" alt="The ‚ÄúApplication URIs‚Äù section of the ‚ÄúApplication‚Äù page‚Äôs ‚ÄúSettings‚Äù tab."/></p><p>This is where you provide Auth0 with two pieces of information that it needs to know about your app:</p><ol start="1"><li>The <strong>callback URL:</strong> the URL that Auth0 will redirect to after the user successfully logs in. There can be more than one of these.</li><li>The <strong>logout URL:</strong> the URL that Auth0 will redirect to after the user logs out. There can be more than one of these.</li></ol><p>At this point, you‚Äôre probably thinking: ‚ÄúWait a minute ‚Äî I‚Äôm writing a <em>iOS app using SwiftUI</em>. It doesn‚Äôt have <em>web pages</em> that you navigate to using URLs, but <em>Views</em>!‚Äù</p><p>You‚Äôre absolutely right. For native applications, the callback and logout URLs are the same string, and Auth0 sends that string to the app to inform it that a user has logged in or logged out.</p><p>The string that native iOS apps use for both the callback URL and the logout URL follow this format:</p><pre><code><span>{</span><span>BUNDLE_IDENTIFIER</span><span>}</span><span>:</span><span>/</span><span>/</span><span>{</span><span>YOUR_DOMAIN</span><span>}</span><span>/</span>ios<span>/</span><span>{</span><span>BUNDLE_IDENTIFIER</span><span>}</span><span>/</span>callback</code></pre><p>To construct this string, you‚Äôll need your app‚Äôs bundle identifier.</p><p>üõ† In Xcode, click on the project in the Project navigator, click on the project in the <strong>Targets</strong> menu, and select the <strong>General</strong> tab. Copy the bundle identifier value, which you‚Äôll find in the <strong>Bundle Identifier</strong> field in the <strong>Identity</strong> section near the top of the center pane:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/78YuX3Ckyc6dfZ6PAbNDRs/c48010f7de65094c37a1e92aada8248d/bundle_identifier_in_xcode.png" alt="Getting the bundle identifier from Xcode."/></p><p>üõ† Copy the URL format string above and make the following changes to create a new URL:</p><ul><li>Replace <code><span>{</span><span>BUNDLE_IDENTIFIER</span><span>}</span></code> with the bundle identifier you copied. Note that <code><span>{</span><span>BUNDLE_IDENTIFIER</span><span>}</span></code> appears twice in the URL ‚Äî replace it both times.</li><li>Replace <code><span>{</span><span>YOUR_DOMAIN</span><span>}</span></code> with your tenant‚Äôs domain.</li></ul><p>üõ† Enter the URL you just constructed into both the <strong>Allowed Callback URLs</strong> and <strong>Allowed Login URLs</strong> fields. Remember, the same URL goes into both fields.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2OXT7ElyikvL8JNCO3RzFk/658591a0c5a67dc7e8499bb0ea02b7e5/settings_-_put_info.png" alt="The ‚ÄúApplication URIs‚Äù section of the page. The reader is directed to enter the callback URL into ‚ÄúAllowed Callback URLs‚Äù and ‚ÄúAllowed Logout URLs‚Äù."/></p><p>üõ† You‚Äôve done everything you need to do on this page. Scroll down to the bottom of the page and click the <strong>Save Changes</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3w6HT6fNOjiJPOjA5uduzt/bb290473a3ae601b70d7ce6456ac7fc4/settings_-_save_changes.png" alt="The bottom of the page, which features the ‚ÄúSave Changes‚Äù button. An arrow directs the reader to click the button."/></p><h3 id="Create-a-user-if-your-tenant-doesn-t-have-any">Create a user if your tenant doesn‚Äôt have any</h3><p>If you just created an Auth0 account, your tenant won‚Äôt have any user accounts. You‚Äôll need at least one user account to be able to log into the app. Follow these steps to create a user.</p><p>üõ† In the menu on the left side of the Auth0 dashboard, select <strong>User Management</strong>  ‚Üí <strong>Users</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1tivj870qehY6oIaeDolj1/31b0544fab715b7fbded29fb63802a45/select_users_menu_item.png" alt="The bottom of the page now featuring an expanded ‚ÄúUser Management‚Äù menu. An arrow directs the reader to expand the ‚ÄúUsers‚Äù menu item."/></p><p>The <strong>Users</strong> page will appear. It lists all the users registered to your tenant. If there are no users, you‚Äôll see the ‚ÄúYou don‚Äôt have any users yet‚Äù message.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1wCORw3pqSOLt65n48Qr56/7421164d02cfb112350882a4cccb4cca/click_create_user.png" alt="The ‚ÄúUsers‚Äù page. The page says, ‚ÄúYou don‚Äôt have any users yet‚Äù. An arrow directs the reader to click the ‚ÄúCreate User‚Äù button."/></p><p>üõ† Click the <strong>Create User</strong> button to create a new user, which will make this dialog box appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2s3GfTHNKRgts8lcXQJ0SH/6d6d0ca397684be75030d40bb6b94fb5/create_user_dialog.png" alt="The ‚ÄúCreate User‚Äù dialog. It has fields for email and password, as well as a drop-down menu displaying ‚ÄúUsername-Password-Authentication‚Äù."/></p><p>üõ† Enter an email address and password for the user. The only option for the <strong>Connection</strong> will be <strong>Username-Password-Authentication</strong>, so leave it as it is. Make a note of that email address and password ‚Äî you‚Äôll be using them to log in to the app.</p><p>üõ† Click the <strong>Create</strong> button to create the user. The user‚Äôs <strong>Details</strong> page will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3TbGcAFo4e4N1coNCtHYdV/fa830264079fc661cbc683590729e4b1/user_details_page.png" alt="The user‚Äôs ‚ÄúDetails‚Äù page."/></p><p>That takes care of all the setup you need to do within the Auth0 dashboard. It‚Äôs time to go back to Xcode and the app.</p><h2 id="Add-Authentication">Add Authentication</h2><p>With all that setup complete, it‚Äôs time to return to coding. In this step, we‚Äôll convert the app into one that uses Auth0 to log the user in and out.</p><h3 id="Import-the-Auth0-library">Import the Auth0 library</h3><p>üõ† Find this line near the beginning of <code>ContentView</code>...</p><pre><code><span>import</span> <span>SwiftUI</span></code></pre><p>...and add this <code><span>import</span></code> statement immediately after it:</p><pre><code><span>import</span> <span>Auth0</span></code></pre><p>This addition will allow the app to use the <code>Auth0</code> object and its methods and properties.</p><h3 id="Update-the--login----method">Update the <code><span>login</span><span>(</span><span>)</span></code> method</h3><p>The <code><span>login</span><span>(</span><span>)</span></code> method merely <em>simulates</em> the login process. Let‚Äôs make it real.</p><p>üõ† Open <code>ContentView</code> and replace the current <code><span>login</span><span>(</span><span>)</span></code> method with this one:</p><pre><code>  <span>func</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
    <span>Auth0</span> <span>// 1</span>
      <span>.</span><span>webAuth</span><span>(</span><span>)</span> <span>// 2</span>
      <span>.</span>start <span>{</span> result <span>in</span> <span>// 3</span>
        <span>switch</span> result <span>{</span>
          <span>// 4</span>
          <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
            <span>print</span><span>(</span><span>&#34;Failed with: <span><span>\(</span>error<span>)</span></span>&#34;</span><span>)</span>
          <span>// 5</span>
          <span>case</span> <span>.</span><span>success</span><span>(</span><span>let</span> credentials<span>)</span><span>:</span>
            <span>self</span><span>.</span>isAuthenticated <span>=</span> <span>true</span>
            <span>print</span><span>(</span><span>&#34;Credentials: <span><span>\(</span>credentials<span>)</span></span>&#34;</span><span>)</span>
            <span>print</span><span>(</span><span>&#34;ID token: <span><span>\(</span>credentials<span>.</span>idToken<span>)</span></span>&#34;</span><span>)</span>
        <span>}</span> 
      <span>}</span>
  <span>}</span></code></pre><p>The notes below correspond to the numbered comments in the login() method:</p><ol start="1"><li>The Auth0 package‚Äôs <code>Auth0</code> object provides methods for the authentication process. Many of these methods perform one of the necessary steps for authentication, and you can chain these methods together to do different authentication tasks.</li><li><code><span>webAuth</span><span>(</span><span>)</span></code> is the first method in the chain. It creates a <code>WebAuth</code> object, which initiates Universal Login. It required the tenant‚Äôs domain and app‚Äôs client ID, which it collects from the <code>Auth0</code> property list.</li><li><code><span>start</span><span>(</span><span>)</span></code> is the method that presents the login box. It takes a closure whose sole parameter represents the result of the user‚Äôs attempt to log in. The two possible outcomes ‚Äî a failed login and a successful login ‚Äî are handled within the closure.</li><li>We‚Äôre keeping things simple in the failure case. In the case of an unsuccessful login, the app simply prints an error message in the debug console.</li><li>If the user successfully logs in, two things happen:
 <ul><li>The app receives the user‚Äôs credentials, a collection of information about the user. One of these credentials is the <em>ID token</em>, which is proof that the user has been authenticated. For now, the app will simply use <code>credentials</code>‚Äô <code>idToken</code> property to print the ID token to the debug console; in a later revision, it will extract the user‚Äôs name, email address, and picture URL from the token.</li><li>The <code>isAuthenticated</code> state variable is set to <code><span>true</span></code>, and this change causes the UI to update to the ‚Äúlogged in‚Äù view.</li></ul></li></ol><h3 id="Update-the--logout----method">Update the <code><span>logout</span><span>(</span><span>)</span></code> method</h3><p>Just as you did with <code><span>login</span><span>(</span><span>)</span></code>, it‚Äôs time to give the <code><span>logout</span><span>(</span><span>)</span></code> method real functionality.</p><p>üõ† Replace the current <code><span>logout</span><span>(</span><span>)</span></code> method with this one:</p><pre><code>  <span>func</span> <span>logout</span><span>(</span><span>)</span> <span>{</span>
    <span>Auth0</span> <span>// 1</span>
      <span>.</span><span>webAuth</span><span>(</span><span>)</span> <span>// 2</span>
      <span>.</span>clearSession <span>{</span> result <span>in</span> <span>// 3</span>
        <span>switch</span> result <span>{</span>
          <span>// 4</span>
          <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
            <span>print</span><span>(</span><span>&#34;Failed with: <span><span>\(</span>error<span>)</span></span>&#34;</span><span>)</span>
            <span>// 5</span>
          <span>case</span> <span>.</span>success<span>:</span>
            <span>self</span><span>.</span>isAuthenticated <span>=</span> <span>false</span>
        <span>}</span>
      <span>}</span>
  <span>}</span></code></pre><p>The notes below correspond to the numbered comments in the logout() method:</p><ol start="1"><li>We‚Äôre chaining methods from the <code>Auth0</code> object again.</li><li>Just as with <code><span>login</span><span>(</span><span>)</span></code>, <code><span>webAuth</span><span>(</span><span>)</span></code> is the first method in the chain, and once again, we‚Äôre using it to activate Universal Login.</li><li><code><span>clearSession</span><span>(</span><span>)</span></code> does the actual work of logging out. Like the <code><span>start</span><span>(</span><span>)</span></code> method in <code><span>login</span><span>(</span><span>)</span></code>, <code><span>clearSession</span><span>(</span><span>)</span></code> takes a closure with a single parameter that represents the result of that request.</li><li>As with <code><span>login</span><span>(</span><span>)</span></code>, the app just prints an error message if the system can‚Äôt log the user out.</li><li>If the user successfully logs out, the <code>isAuthenticated</code> state variable is set to <code><span>false</span></code>, and this change causes the UI to update to the ‚Äúlogged out‚Äù view.</li></ol><h3 id="Test-the-updated-app">Test the updated app</h3><p>üõ† Run the app to confirm that the app actually authenticates users. This time, when you press the <strong>Log in</strong> button, instead of going directly to the ‚Äúlogged in‚Äù view, you‚Äôll see the Universal Login screen. You‚Äôll need to enter a valid username and password to see that second screen.</p><p>Look at Xcode‚Äôs debug window after you log in. You‚Äôll see the output of the <code><span>login</span><span>(</span><span>)</span></code> method‚Äôs <code><span>print</span><span>(</span><span>)</span></code> functions, which output the contents of the <code>credentials</code> object and its <code>idToken</code> property:</p><pre><code>Credentials<span>:</span> <span>Credentials</span><span>(</span>accessToken<span>:</span> <span>&#34;&lt;REDACTED&gt;&#34;</span><span>,</span> tokenType<span>:</span> <span>&#34;Bearer&#34;</span><span>,</span> idToken<span>:</span> <span>&#34;&lt;REDACTED&gt;&#34;</span><span>,</span> refreshToken<span>:</span> nil<span>,</span> expiresIn<span>:</span> <span>2022</span><span>-</span><span>03</span><span>-</span><span>20</span> <span>04</span><span>:</span><span>38</span><span>:</span><span>25</span> <span>+</span><span>0000</span><span>,</span> scope<span>:</span> <span>Optional</span><span>(</span><span>&#34;openid profile email&#34;</span><span>)</span><span>,</span> recoveryCode<span>:</span> nil<span>)</span>
<span>ID</span> token<span>:</span> eyJhbGciOiJSUzI1NiIsInR5cC<span>...</span></code></pre><p>Note that when the <code><span>print</span><span>(</span><span>)</span></code> function is used to output the contents of <code>credentials</code>, the values of the <code>accessToken</code> and <code>idToken</code> properties are replaced with the string <code><span>&lt;</span><span>REDACTED</span><span>&gt;</span></code>. Ideally, you should remove <code><span>print</span><span>(</span><span>)</span></code> functions from an app when it goes into production, but many developers often forget this step. Malicious parties can use tools to capture the output of <code><span>print</span><span>(</span><span>)</span></code> functions from production apps; this is why <code>Credentials</code> instances redact the values of their <code>accessToken</code> and <code>idToken</code> properties when printed.</p><p><code>credentials</code> has a <code>scope</code> property containing a space-delimited list of  <a href="https://auth0.com/docs/get-started/apis/scopes/openid-connect-scopes" target="_blank" rel="noreferrer noopener">OpenID Connect (OIDC) scopes</a> ‚Äî authorizations for access to details about the user ‚Äî that Auth0 has granted to the app. Unless you specify otherwise, <em>Auth0.swift</em> defaults to requesting the following scopes when logging in a user:</p><ul><li><code>openid</code>: Authorization to use OIDC to verify the user&#39;s identity</li><li><code>profile</code>: Authorization to access the user‚Äôs name information</li><li><code>email</code>:  Authorization to access the user‚Äôs email address</li></ul><p>To confirm that the app received an ID token after logging in the user, we print its value. We‚Äôll use it to get the user‚Äôs name, email address, and picture in the next step.</p><blockquote><p>üö® <strong>Warning:</strong> üö® It‚Äôs fine to print the value of the ID token to the debug console while you‚Äôre learning about the authentication process or building the app. Make sure that you remove <code><span>print</span><span>(</span><span>)</span></code> statements ‚Äî especially those that print sensitive information, such as the ID token ‚Äî before putting them into production!</p></blockquote><p>So far, you‚Äôve created a SwiftUI-based iOS app that uses Auth0 for basic login and logout functionality. In the second part of this tutorial, you‚Äôll give the app the ability to get information about the logged-in user and display it onscreen.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 30 Mar 2022 14:56:00 +0000</pubDate>
    </item>
    <item>
      <title>Social Impact Innovations: National Council for the Blind Ireland</title>
      <link>https://auth0.com/blog/social-impact-innovations-national-council-for-the-blind-ireland/</link>
      <description>Exploring the Impact of Identity for the Visually Impaired</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Since 1931, the National Council for the Blind Ireland has been serving blind or visually impaired persons across Ireland. In fact, NCBI has a proud and long-running legacy as being the first voluntary body dealing with a disability group in the Irish Free State dedicated to supporting, educating, and changing how sight loss is seen in Ireland. </p><p>As the leading vision loss charity in the country serving the approximately 55,000 people who are blind or visually impaired, their rich history and pioneering work have set the precedent in the provision of welfare and educational advancement for disadvantaged people in Ireland. </p><p>Today the team at NCBI continues to raise the bar for innovation in the space through<a href="https://www.ncbi.ie/supporting-you/technology/ncbi-labs/" target="_blank" rel="noreferrer noopener"> NCBI Labs</a>, their technology department. Eager to pursue and bring to life some ideas they had been incubating but mindful of the development cost of such endeavors, NCBI pitched their vision for an application, later named the myNCBI Smart Hub, to The Social Innovation Fund and was awarded capital through their Rethink Ireland fund.</p><p>At its core,<a href="https://www.ncbi.ie/kyran-omahoney-talks-about-the-new-ncbi-smart-hub/" target="_blank" rel="noreferrer noopener"> myNCBI Smart Hub</a> provides users with sight loss a way to leverage smart devices, such as those powered by Amazon‚Äôs Alexa natural language processing system. The myNCBI application was designed specifically for visually impaired users. There is no need to purchase a laptop, speech software, or a separate smart device. The all-in-one myNCBI Smart Hub is ready to use straight away with very little to no guidance with existing devices.</p><p>Using only their voice, NCBI clients can interact with their device, which is integrated with Auth0‚Äôs Customer Identity and Access Management system, to securely login to their NCBI account and connect to the charity‚Äôs full suite of services. NCBI‚Äôs clients can book appointments and get reminders sent to their assistive devices, learn more information about their particular sight loss, and interact directly with myOwn Technology Support.</p><p>Post-launch, myNCBI Smart Hub enabled virtual service access for the thousands of clients of NCBI impacted during the global pandemic. As a result, clients were able to receive uninterrupted support even when lockdowns and stay-at-home mandates were issued. Now that life is returning to a new normal, clients using the myNCBI Smart Hub continue to use the application, if not even more so. The smart hub has introduced a level of efficiency and accessibility that makes daily life for the many users and the NCBI team easier. </p><p>From NCBI Lab‚Äôs development team‚Äôs research, myNCBI Smart Hub technology has never been undertaken before in the disabilities sector amongst sight loss charities. Suffice to say, the potential for this NCBI Lab‚Äôs product could be huge and benefit many others in the years to come.</p><p>This ingenuine use of technology recently earned the team a coveted Spider Award nomination in the Best Use of Disruptive Technology category in 2021 and is slated to be awarded on March 31st, 2022.<a href="https://www.thespiders.ie/" target="_blank" rel="noreferrer noopener"> The Spiders</a> are Ireland‚Äôs most prestigious digital awards ceremony and longest running, dedicated to recognizing companies and individuals driving digital excellence.</p><p>In addition to this recognition, the team has also been nominated in 4 other categories:</p><ul><li>Digital Transformation in Industry &amp; Infrastructure ‚Äì NCBI Digital Transformation Project</li><li>Best in Universal Design ‚Äì ncbi.ie</li><li>Best Podcast ‚Äì<a href="https://www.ncbi.ie/supporting-you/technology/talking-technology-with-ncbi-labs/" target="_blank" rel="noreferrer noopener"> Talking Technology with NCBI Labs</a></li><li>Best Remote Team ‚Äì NCBI Labs</li></ul><p>Regardless of the outcome of the awards, Auth0 is delighted to of played a small part in enabling the NCBI Labs team to bring their vision for this assistive technology application, the myNCBI Smart Hub, to fruition. We look forward to exploring avenues to collaborate and bring safer, unparalleled access to the technology the incredible team at NCBI Labs introduces to the world. </p><p>Cheers &amp; Good Luck, NCBI Labs Team!</p><p>We‚Äôll be rooting for you all from around the globe.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 28 Mar 2022 14:40:00 +0000</pubDate>
    </item>
    <item>
      <title>Marketplace Partner Spotlight: What‚Äôs New from the Last Quarter of 2021</title>
      <link>https://auth0.com/blog/marketplace-partner-spotlight-whats-new-from-the-last-quarter-of-2021/</link>
      <description>Check out the integrations our ecosystem partners are building</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Extensibility is one of our core capabilities at Auth0, which is why we built the Auth0 Marketplace, making it easier than before to discover the integrations you need to solve identity. The Auth0 Marketplace allows us to easily connect customers with our integration partners and allow you to customize a unique identity solution. Our partners are tapping into the nearly endless possibilities for customized integrations, and we‚Äôre excited to see this list continue to grow.</p><p>So to celebrate all the awesome integrations and to inspire you as well, we‚Äôre going to start sharing the newest integrations we‚Äôve launched recently:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2tC5hB4pASo7o9GRBOzEa2/2ee34d4ced457d79f7116c4bb9284615/001_Berbix_Verify.png" alt="Berbix Verify"/></p><h2 id="Berbix-Verify">Berbix Verify</h2><p><strong><a href="https://marketplace.auth0.com/integrations/berbix-verify" target="_blank" rel="noreferrer noopener">Berbix Verify - Instant, automated, and flexible ID verification and biometrics</a></strong><br/>The new<a href="https://www.berbix.com/" target="_blank" rel="noreferrer noopener"> Berbix</a> integration combines authentication and identity verification for a better, more secure customer experience. Berbix provides instant, automated, and flexible ID verification with optional biometric comparisons for a seamless onboarding and re-verification experience. Within a few clicks, you can require identity verification for all users or use a highly flexible integration to target high-risk users or users in specific scenarios. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7PBjRNwT2ocPyi0ylBtOE/bbad139be93fba60312be76a90018249/002_TrueBlue_Identity_Verification.png" alt="TrueBlue"/></p><h2 id="TrueBlue">TrueBlue</h2><p><strong><a href="https://marketplace.auth0.com/integrations/trueblue-actions" target="_blank" rel="noreferrer noopener">TrueBlue - Australian identity verification</a></strong><br/>The<a href="https://www.trueblue.id/" target="_blank" rel="noreferrer noopener"> TrueBlue</a> Actions integration with Auth0 provides Australian-based businesses with the ability to enable secure document identity checks backed by the Australian Department of Home Affairs. With the TrueBlue integration, as users sign up, they receive an identity verification request to submit their details through a custom URL. The documents are then validated by the Department of Home Affairs, without the need to store personal identity documents long term. Using the same Auth0 integration, TrueBlue is currently extending the document types and regions supported.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7gxmmPQjnKHoNGD8W6XO8w/8a1f3ae26409965bcb61f355d765d4af/003_Verified_Biometric_MFA.png" alt="authID.ai"/></p><h2 id="authID-ai-Verified-">authID.ai Verified‚Ñ¢</h2><p><strong><a href="https://marketplace.auth0.com/integrations/verified-biometric-mfa" target="_blank" rel="noreferrer noopener">authID.ai Verified‚Ñ¢ - Biometric MFA</a></strong><br/>The new<a href="https://authid.ai/" target="_blank" rel="noreferrer noopener"> authID.ai</a> Actions integration replaces OTP &amp; KBA with facial biometric authentication to prevent account takeover and fraud. Verified by authID.ai strengthens multi-factor authentication by adding advanced facial biometric authentication to verify the user, not just the device. authID.ai‚Äôs drag-and-drop solution integrates seamlessly with Auth0 to protect user identity with encryption, increase user certainty to stop account takeover and fraud, and reduce customer effort with low-friction authentication.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5UQT5jkbzPBDzr6p4bNzBP/dbb429ab44760f6f850470be7f0a980c/004_Signicat_Express_Auth.png" alt="Signicat Express Auth"/></p><h2 id="Signicat-Express-Auth">Signicat Express Auth</h2><p><strong><a href="https://marketplace.auth0.com/integrations/signicat-express-auth" target="_blank" rel="noreferrer noopener">Signicat Express Auth - Identity services for the European market</a></strong><br/><a href="https://www.signicat.com/" target="_blank" rel="noreferrer noopener">Signicat‚Äôs</a> Express Auth Actions integration provides services for secure authentication using trusted third-party integrations. Following European eIDAS regulations and AML directives, Signicat provides a subset of services integrated in the Auth0 platform enabling customers to access a European market through 30+ electronic identity schemes. The Signicat Express authentication plugin quickly integrates these services into your Auth0 tenant to enable secure authentication for your end users.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5SNX7CgAg8UNfYXKldfPop/692bb3f6a017d05d56606978fc394545/005_Logz.io_Cloud_SIEM.png" alt="Logz.io"/></p><h2 id="Logz-io">Logz.io</h2><p><strong><a href="https://marketplace.auth0.com/integrations/logz-io" target="_blank" rel="noreferrer noopener">Logz.io Cloud SIEM - Cloud native SIEM</a></strong><br/><a href="https://logz.io/" target="_blank" rel="noreferrer noopener">Logz.io</a> Cloud SIEM enables you to centrally monitor workflow logs to quickly identify, investigate, and remediate potential and emerging threats. Using Kibana open source visualizations, combined with AI and Machine Learning-based security analytics, the Logz.io integration allows you to easily inspect and investigate relevant event data. Gain contextual visibility into attacks and drill down into granular user data to alert and respond to threats in real time. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3LRQLTvYkXE8oK2nxbHx7z/2f604165c7b437f1d15fbdf94ae8343d/006_Circle.png" alt="CircleCI"/></p><h2 id="Circle">Circle</h2><p><strong><a href="https://marketplace.auth0.com/integrations/circle" target="_blank" rel="noreferrer noopener">CircleCI - Credential-free cryptographic zero trust authentication</a></strong><br/><a href="https://gocircle.ai/" target="_blank" rel="noreferrer noopener">Circle</a> complements Auth0 in two powerful ways to enhance its value to customers and end users. First, it enables secure continuous credential-free authentication across browsers, applications, and devices. Second, it provides a breakthrough method of delegated Human-in-the-Loop Multi-Factor Authentication (MFA) that uniquely addresses the highest requirements for both privacy and security in identity verification. Unique cryptographic authentication helps eliminate credentials-based attacks while delivering a frictionless customer experience.</p><p>Be on the lookout each month as we announce the latest integrations coming out of our extensive partner ecosystem. In the meantime, check out our current list of partners and integrations at <a href="http://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">marketplace.auth0.com</a>.</p><p>Are you interested in building an integration with us? Visit <a href="http://auth0.com/integrate" target="_blank" rel="noreferrer noopener">auth0.com/integrate</a> to get started.</p></div></div>]]></content:encoded>
      <pubDate>Fri, 25 Mar 2022 14:58:00 +0000</pubDate>
    </item>
    <item>
      <title>Introducing the OAuth 2.0 Express SDK for Protecting APIs with JWT Bearer Tokens</title>
      <link>https://auth0.com/blog/introducing-oauth2-express-sdk-protecting-api-with-jwt/</link>
      <description>Learn how the OAuth 2.0 Express SDK released by Auth0 makes protecting your Express API easier.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Auth0 has released <a href="https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-jwt-bearer</a>, a new <a href="https://expressjs.com/" target="_blank" rel="noreferrer noopener">Express</a> SDK that makes it super easy to protect APIs with JWT Bearer Tokens. Let&#39;s take an overview of its features.</p><h2 id="Why-a-New-Express-SDK-">Why a New Express SDK?</h2><p>Auth0‚Äôs previous advice for protecting Express APIs was with a combination of three SDKs: <a href="https://github.com/auth0/express-jwt" target="_blank" rel="noreferrer noopener">express-jwt</a>, <a href="https://github.com/auth0/express-jwt-authz" target="_blank" rel="noreferrer noopener">express-jwt-authz</a>, and <a href="https://github.com/auth0/node-jwks-rsa" target="_blank" rel="noreferrer noopener">jwks-rsa</a>. And whilst these work well and are popular SDKs, we felt the developer experience could be improved.</p><p>We first wanted to simplify the process of protecting an Express API by reducing the number of dependencies from three to one. This also reduces the install size from ~2 MB to ~500 KB. You can see the benefit by comparing our <a href="https://auth0.com/docs/quickstart/backend/nodejs" target="_blank" rel="noreferrer noopener">QuickStart</a> before and after implementing the new SDK, as shown in the following screenshot:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Mkzs9yeeOboyJkwJIR9Pb/2518cadc35f2e378edbb5cb925f69026/express-sdk-comparison.jpg" alt="SDK code lines comparison"/></p><p>We also wanted to teach the developer community how to protect their APIs with authorization standards like OAuth2.0 rather than a collection of libraries representing token formats, algorithms, and industry abbreviations (<code>jwt</code>, <code>jwks</code>, <code>rsa</code>, and <code>authz</code>).</p><p>This is why the project&#39;s first incarnation, <a href="https://github.com/auth0/express-oauth2-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-bearer</a>, was released experimentally to support our excellent <a href="https://auth0.com/docs/identity-labs/identity-lab-2-calling-api" target="_blank" rel="noreferrer noopener">Identity Labs</a> series (<a href="https://github.com/auth0/express-oauth2-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-bearer</a> will now be deprecated in favor of <a href="https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-jwt-bearer</a>).</p><h2 id="The-Role-of-Standards">The Role of Standards</h2><p><a href="https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-jwt-bearer</a> protects Express APIs using a combination of the well-established <a href="https://datatracker.ietf.org/doc/html/rfc6750" target="_blank" rel="noreferrer noopener">OAuth2 Bearer Token Usage spec</a> and the new specification of <a href="https://datatracker.ietf.org/doc/html/rfc9068" target="_blank" rel="noreferrer noopener">JSON Web Token (JWT) Profile for OAuth 2.0 Access Tokens</a>.</p><p>While there‚Äôs always been a clear path for developers to acquire an Access Token from a request using the Bearer Token Usage spec, they‚Äôve relied on best practice and industry convention when determining how to verify their authenticity.</p><p>With <a href="https://datatracker.ietf.org/doc/html/rfc9068" target="_blank" rel="noreferrer noopener">JSON Web Token (JWT) Profile for OAuth 2.0 Access Tokens spec</a>, they are able to leverage new standards to consume Access Token JWTs in an interoperable manner. <a href="https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-jwt-bearer</a> partially implements the JWT Profile for OAuth 2.0 Access Tokens specification. It implements the full specification when you enable the <code>strict</code> option. Also, it is deeply customizable so that you can use it across a broad range of Identity Providers.</p><h2 id="Protect-an-Express-API-with-JWT-Bearer-Tokens">Protect an Express API with JWT Bearer Tokens</h2><p><a href="https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-jwt-bearer</a> uses a similar mechanism to <a href="https://openid.net/specs/openid-connect-discovery-1_0.html" target="_blank" rel="noreferrer noopener">OpenID Connect Discovery</a> to configure itself, so it‚Äôs easy to set up with minimal effort. In just a few lines of code, you can easily add it to your API to protect it with Access Tokens issued by Auth0, for example.</p><p>To easily protect your Express API with Auth0, start by installing the SDK using npm or yarn, as in the following example:</p><pre><code><span>npm</span> <span>install</span> express-oauth2-jwt-bearer</code></pre><p>You can initialize the SDK in code or via environment variables. For the latter, the minimal <code><span>.</span>env</code> file would look like the following:</p><pre><code><span>ISSUER_BASE_URL</span><span>=</span>https://<span>&lt;</span>YOUR_TENANT<span>&gt;</span>.auth0.com
<span>AUDIENCE</span><span>=</span><span>&lt;</span>YOUR_API_IDENTIFIER<span>&gt;</span></code></pre><p>Replace <code><span>&lt;</span><span>YOUR_TENANT</span><span>&gt;</span></code> and <code><span>&lt;</span><span>YOUR_API_IDENTIFIER</span><span>&gt;</span></code> with the values of your Auth0 tenant name and API identifier that you‚Äôll find in the <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a>. </p><p>Then add the <a href="https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-jwt-bearer</a> middleware to your API like so:</p><pre><code><span>const</span> express <span>=</span> <span>require</span><span>(</span><span>&#39;express&#39;</span><span>)</span><span>;</span>
<span>const</span> <span>{</span> auth <span>}</span> <span>=</span> <span>require</span><span>(</span><span>&#39;express-oauth2-jwt-bearer&#39;</span><span>)</span><span>;</span>
<span>require</span><span>(</span><span>&#39;dotenv&#39;</span><span>)</span><span>.</span><span>config</span><span>(</span><span>)</span><span>;</span> <span>// Load the .env variables</span>

<span>const</span> app <span>=</span> <span>express</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>use</span><span>(</span><span>auth</span><span>(</span><span>)</span><span>)</span><span>;</span>

app<span>.</span><span>get</span><span>(</span><span>&#39;/api/private&#39;</span><span>,</span> <span>(</span><span>req<span>,</span> res</span><span>)</span> <span>=&gt;</span> <span>{</span>
  res<span>.</span><span>json</span><span>(</span><span>{</span> message<span>:</span> <span><span>`</span><span>Hello </span><span><span>${</span>res<span>.</span>auth<span>.</span>payload<span>.</span>sub<span>}</span></span><span>!</span><span>`</span></span> <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

app<span>.</span><span>listen</span><span>(</span><span>3000</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> console<span>.</span><span>log</span><span>(</span><span>&#39;listening at http://localhost:3000&#39;</span><span>)</span><span>)</span></code></pre><p>You can then start your API and test it using curl:</p><pre><code><span>curl</span> http://localhost:3000/api/private <span>\</span>
--header <span>&#39;Authorization: Bearer <span>${YOUR_JWT_ACCESS_TOKEN}</span>&#39;</span></code></pre><p>If you‚Äôre wondering where to get an Access Token from, you can get one for testing purposes from the Test tab of your <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">API configuration in the Auth0 Dashboard</a>, as shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/785NRBn9KBkiML9UF3NGO5/bcd2954c29af6637f783426e7b89ed7c/copy-access-token.png" alt="Copy access token from Auth0 Dashboard"/></p><p>Check out <a href="https://github.com/auth0/express-openid-connect" target="_blank" rel="noreferrer noopener">express-openid-connect</a> to see an example of how to <a href="https://github.com/auth0/express-openid-connect/blob/master/EXAMPLES.md#4-obtaining-access-tokens-to-call-external-apis" target="_blank" rel="noreferrer noopener">programmatically obtain an Access Token to call external APIs</a>.</p><h2 id="Checking-for-Required-Scopes">Checking for Required Scopes</h2><p>If you want to additionally check the Access Token‚Äôs scopes for a specific route you can use the <code>requiredScopes</code> middleware, as shown below:</p><pre><code><span>const</span> express <span>=</span> <span>require</span><span>(</span><span>&#39;express&#39;</span><span>)</span><span>;</span>
<span>const</span> <span>{</span> auth<span>,</span> requiredScopes <span>}</span> <span>=</span> <span>require</span><span>(</span><span>&#39;express-oauth2-jwt-bearer&#39;</span><span>)</span><span>;</span>
<span>require</span><span>(</span><span>&#39;dotenv&#39;</span><span>)</span><span>.</span><span>config</span><span>(</span><span>)</span><span>;</span>

<span>const</span> app <span>=</span> <span>express</span><span>(</span><span>)</span><span>;</span>
<span>const</span> checkJwt <span>=</span> <span>auth</span><span>(</span><span>)</span><span>;</span>

app<span>.</span><span>get</span><span>(</span><span>&#39;/api/private-scoped&#39;</span><span>,</span> checkJwt<span>,</span> <span>requiredScopes</span><span>(</span><span>&#39;read:msg&#39;</span><span>)</span><span>,</span> <span>(</span><span>req<span>,</span> res</span><span>)</span> <span>=&gt;</span> <span>{</span>
  res<span>.</span><span>json</span><span>(</span><span>{</span>
    message<span>:</span> <span>&#39;You need to be authenticated and have a scope of read:messages to see this.&#39;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>You can also check custom claims in the Access Token using <a href="https://auth0.github.io/node-oauth2-jwt-bearer#claimcheck" target="_blank" rel="noreferrer noopener">claimCheck</a>, <a href="https://auth0.github.io/node-oauth2-jwt-bearer#claimequals" target="_blank" rel="noreferrer noopener">claimEquals</a>, and <a href="https://auth0.github.io/node-oauth2-jwt-bearer#claimincludes" target="_blank" rel="noreferrer noopener">claimIncludes</a> (see <a href="https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer#api-documentation" target="_blank" rel="noreferrer noopener">the docs for the full API</a>).</p><h2 id="Under-the-Hood">Under the Hood</h2><p><a href="https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-jwt-bearer</a> is a small <a href="https://expressjs.com/" target="_blank" rel="noreferrer noopener">Express</a> wrapper around two framework agnostic packages:</p><ul><li><a href="https://github.com/auth0/node-oauth2-jwt-bearer/blob/main/packages/oauth2-bearer" target="_blank" rel="noreferrer noopener">oauth2-bearer</a>: it gets Bearer tokens from a request and issues errors per the <a href="https://tools.ietf.org/html/rfc6750" target="_blank" rel="noreferrer noopener">Bearer Token Usage spec</a>.</li><li><a href="https://github.com/auth0/node-oauth2-jwt-bearer/blob/main/packages/access-token-jwt" target="_blank" rel="noreferrer noopener">access-token-jwt</a>: it verifies and decodes Access Token JWTs following the <a href="https://datatracker.ietf.org/doc/html/rfc9068" target="_blank" rel="noreferrer noopener">JWT Profile for OAuth 2.0 Access Tokens spec</a> using the <a href="https://github.com/panva/jose" target="_blank" rel="noreferrer noopener">jose</a> library.</li></ul><p>The following diagram shows the dependencies among these packages:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/78D0oQvCSHj5SUTANEFihw/31924abc24a7841cbb73db1afd297f83/oauth2-express-libraries-dependency.png" alt="OAuth2 Express SDK dependency graph"/></p><h2 id="What-s-Happening-to--express-jwt----express-jwt-authz---and--jwks-rsa--">What‚Äôs Happening to <code>express<span>-</span>jwt</code>, <code>express<span>-</span>jwt<span>-</span>authz</code>, and <code>jwks<span>-</span>rsa</code>?</h2><p><a href="https://github.com/auth0/express-jwt" target="_blank" rel="noreferrer noopener">express-jwt</a>, <a href="https://github.com/auth0/express-jwt-authz" target="_blank" rel="noreferrer noopener">express-jwt-authz</a> and <a href="https://github.com/auth0/node-jwks-rsa" target="_blank" rel="noreferrer noopener">jwks-rsa</a> are well used and loved by many Auth0 customers and remain fully supported. There‚Äôs no need to rush to update your existing apps. We will keep fixing bugs and patching them. We plan to stop adding new features to these SDKs, though, and the bar for the bugs we fix will be tuned accordingly.</p><p>If you are about to start a new Express API project, we recommend using <a href="https://github.com/auth0/node-oauth2-jwt-bearer/tree/main/packages/express-oauth2-jwt-bearer" target="_blank" rel="noreferrer noopener">express-oauth2-jwt-bearer</a>, as it will be our target for all innovation for authorization on the Node.js platform for the foreseeable future.</p><p>Try out the most powerful authentication platform for free.<a target="_blank" href="https://auth0.com/signup?promo=sup&amp;place=in-blog-banner&amp;type=link&amp;text=get-started&amp;origin=blog">Get started ‚Üí</a></p><h2 id="What-s-Next">What‚Äôs Next</h2><p><a href="https://github.com/auth0/node-oauth2-jwt-bearer/blob/main/packages/oauth2-bearer" target="_blank" rel="noreferrer noopener">oauth2-bearer</a> and <a href="https://github.com/auth0/node-oauth2-jwt-bearer/blob/main/packages/access-token-jwt" target="_blank" rel="noreferrer noopener">access-token-jwt</a> are as yet unpublished and currently just share space in the <a href="https://github.com/auth0/node-oauth2-jwt-bearer" target="_blank" rel="noreferrer noopener">node-oauth2-jwt-bearer</a> monorepo. However, you can see how they could easily be used standalone or to create simple wrappers for other Node.js server frameworks like <a href="https://www.simform.com/blog/best-nodejs-frameworks/#Koa" target="_blank" rel="noreferrer noopener">Koa.js</a>, <a href="https://www.simform.com/blog/best-nodejs-frameworks/#Nest" target="_blank" rel="noreferrer noopener">Nest.js</a>, <a href="https://www.simform.com/blog/best-nodejs-frameworks/#Hapi" target="_blank" rel="noreferrer noopener">Hapi.js</a>. You can also use them in a range of serverless platforms, which we‚Äôll be reviewing as part of our roadmap going forward.</p><p>If you have feedback or notice any issues hit us up via the <a href="https://github.com/auth0/node-oauth2-jwt-bearer/issues" target="_blank" rel="noreferrer noopener">issues list</a> or the <a href="https://community.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 community</a>.</p><p>Happy coding!</p></div></div>]]></content:encoded>
      <pubDate>Thu, 24 Mar 2022 15:26:00 +0000</pubDate>
    </item>
    <item>
      <title>4 Ways to Strengthen Identity Authentication for Technical Roles</title>
      <link>https://auth0.com/blog/4-ways-to-strengthen-identity-authentication-for-technical-roles/</link>
      <description>Advanced facial biometrics can enhance Auth0 MFA workflows to provide secure authentication experiences that simplify common challenges for technical roles.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>On a daily basis, CIAM professionals battle data breaches, account compromise, ransomware, and fraud. In 2021, digital fraud rates increased 22%, ransomware rates increased 62%, data breach rates increased 17%, ‚Äî and cybercriminals shifted to softer targets with more valuable data and motivation for ransom payout. Huge shifts in remote work, distance learning, telemedicine, and BYOD trends also added layers of complexity as organizations struggled to protect systems and data.  </p><p>These trends illustrate the complex CIAM challenges facing technical roles in B2B, B2C, and B2E environments. Developers, engineers, systems architects who are responsible for CIAM and fraud prevention will find this post most valuable, as we will discuss how facial biometric authentication can strengthen identity assurance while simplifying challenges in implementation, operations costs, security needs, and CX expectations.  </p><h2 id="Facial-Biometric-Authentication">Facial Biometric Authentication</h2><blockquote><p>Facial Biometric Authentication can help technical roles secure enterprise assets while simplifying the user experience.</p></blockquote><p>Finding the right balance between user convenience, privacy, and security is today‚Äôs biggest challenge for developers. CIAM is a convergence of IAM, fraud detection, and authentication tools that are used for controlling user access by both internal users (your workforce) and external users (your customers). However, according to Gartner, no single tool can deliver on all the identity administration, fraud detection, access management, content management, and analytics needed to build out a holistic solution.</p><p>As a result, technical roles are left cobbling together solutions that may leave gaps in security or may increase friction in user experience that requires additional investment to remedy. Advanced facial biometric authentication seamlessly woven into the Auth0 login workflow can provide the needed balance between a frictionless user experience and protection against password-related fraud, phishing, and account takeover. </p><h2 id="4-Ways-to-Leverage-Auth0-and-Advanced-Facial-Biometric-Authentication-to-Strengthen-CIAM">4 Ways to Leverage Auth0 and Advanced Facial Biometric Authentication to Strengthen CIAM</h2><p>Auth0 simplifies biometric multi-factor authentication for the technical teams responsible for implementing CIAM strategies and tools. This simplification is delivered in four main areas.  </p><ul><li>Easy Implementation with Broad Solution Support</li><li>Operational Efficiency and Cost Reduction</li><li>Improved Security and Fraud Reduction</li><li>Enhanced User Experience</li></ul><h3 id="Easy-Implementation-with-Broad-Solution-Support">Easy Implementation with Broad Solution Support</h3><p>Users today shop, play and work using a broad range of mobile devices and desktop computers, and operating systems. So technical roles need a strong authentication solution that is device-agnostic and capable of supporting everyone interacting with your platform. Biometric authentication that offers portability without being tied to a specific device, an authenticator fob, or an authenticator app also provides the right balance between enhanced platform security and increased user satisfaction and adoption.</p><h3 id="Operational-Efficiency-and-Cost-Reduction">Operational Efficiency and Cost Reduction</h3><p>Operational inefficiencies caused by complex authentication experiences impact customer loyalty and workforce productivity, with negative impacts on revenue and profits as businesses move slower and customers are lost. B2B, B2C, and B2E focused organizations using Auth0 can improve operational efficiencies and reduce related costs with authentication solutions that are applicable for many use cases across multiple devices. To simplify CIAM for technical roles - focus on finding a solution for user authentication that can serve internal, external, and developer use cases. Facial biometrics can support authentication use cases, including online or mobile app login, chat or call center support, as well as strong authentication for valued transactions and account activity. Also, remember solutions that require complex maintenance should be avoided in lieu of a solution that simplifies administration requires no additional hardware, training, or mental burden on behalf of the user. </p><h3 id="Improved-Security-and-Fraud-Reduction">Improved Security and Fraud Reduction</h3><p>Advanced facial biometric authentication reduces the risk of account misuse and takeover by requiring the live face of a registered user as a factor for authentication and a condition for access. Even in the event of password or credential compromise, advanced facial biometrics will stop unauthorized access from occurring. Facial biometric multi-factor authentication addresses many fraud-related concerns, including the ability to stop account takeover and quickly authenticate the validity of transactions flagged for manual review. </p><h3 id="Enhanced-User-Experience">Enhanced User Experience</h3><p>Including advanced facial biometrics as a factor for authentication within your Auth0 workflow delivers a sophisticated digital experience by balancing strong authentication with customer expectations of low friction authentication and easy access. Today‚Äôs users‚Äîwhether they are shopping, working, or banking ‚Äì sitting on the train or at their desks are demanding portability with less friction. Advanced biometric authentication eases the user burden as there is no need to download additional software or employ multiple devices for authentication. </p><h2 id="Conclusion">Conclusion</h2><p>When evaluating CIAM tools to reduce friction in or further secure your MFA workflow, consider Verified CloudConnect‚Äîthe ideal bolt-on integration for Auth0. Verified‚Ñ¢ CloudConnect delivers fortified, in-browser biometric authentication‚Äîsupported across all mobile and desktop devices used to access enterprise data and resources. At login or for any transaction you deem to require additional identity assurance, the Verified browser-based UX adds an additional factor of authentication ‚Äì a live selfie. Verified analysis of the selfie in real-time for biometric matching and liveness, defending user accounts from deep fakes and other spoofing attempts. </p><p>Verified CloudConnect is a flexible, drop-in solution that seamlessly extends the Auth0 Identity Platform to secure B2B, B2C, and B2E environments without additional authentication hardware, mobile apps, or single-use pin-codes. As Gartner has noted ‚Äì no one single vendor can deliver for all aspects of identity and access management. Adding a tool like Verified CloudConnect for Auth0 will improve user experience, thereby increasing user adoption and retention. Deployed easily with a simple line of code, Verified enhances your current security stack while reducing operational costs and overall solution complexity.  </p><p>Ready to get started with Verified CloudConnect for Auth0? Visit <a href="https://marketplace.auth0.com/integrations/verified-biometric-mfa" target="_blank" rel="noreferrer noopener">authID.ai listing</a> on the Auth0 Marketplace for more information.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 23 Mar 2022 20:36:00 +0000</pubDate>
    </item>
    <item>
      <title>What is Blazor? A Tutorial on Building Web Apps with Authentication</title>
      <link>https://auth0.com/blog/what-is-blazor-tutorial-on-building-webapp-with-authentication/</link>
      <description>Learn how to build client-side Web apps using Blazor and how to secure them with Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> This tutorial introduces the Blazor framework by guiding you in building a simple Web application with C#. It will also show you how to integrate your Blazor application with Auth0 in order to secure it. You can find the full application code <a href="https://github.com/auth0-blog/blazor-quiz-manager" target="_blank" rel="noreferrer noopener">in this GitHub repository</a>.</p><h2 id="What-Is-Blazor-">What Is Blazor?</h2><p>Blazor has been gaining in popularity, especially after the <a href="https://auth0.com/blog/exploring-dotnet-core-3-whats-new/" target="_blank" rel="noreferrer noopener">release of .NET Core 3.0</a>, which enriched it with many interesting features. Subsequent versions of .NET consolidated its foundations, and the interest around it is growing so much that Microsoft is betting a lot on its future. But what is Blazor exactly?</p><p><a href="https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor" target="_blank" rel="noreferrer noopener">Blazor</a> is a programming framework to build client-side Web applications with .NET. It allows .NET developers to use their C# and <a href="https://docs.microsoft.com/en-us/aspnet/core/razor-pages" target="_blank" rel="noreferrer noopener">Razor</a> knowledge to build interactive UIs running in the browser. Developing client-side applications with Blazor brings a few benefits to .NET developers:</p><ul><li>They use C# and Razor instead of JavaScript and HTML.</li><li>They can leverage the whole .NET functionalities.</li><li>They can share code across the server and client.</li><li>They can use the .NET development tools they are used to.</li></ul><p>In a nutshell, Blazor promises .NET developers to let them build client Web applications with the development platform they are comfortable with.</p><h3 id="The-hosting-models">The hosting models</h3><p>Blazor provides you with two ways to run your Web client application: <em>Blazor Server</em> and <em>Blazor WebAssembly</em>. These are called <em>hosting models</em>.</p><p>The <em>Blazor Server</em> hosting model runs your application on the server within an ASP.NET Core application. The UI is sent to the browser, but UI updates and event handling are performed on the server side. This is similar to traditional Web applications, but the communication between the client side and the server side happens over a <a href="https://docs.microsoft.com/en-us/aspnet/core/signalr/introduction" target="_blank" rel="noreferrer noopener">SignalR</a> connection. The following picture gives you an idea of the overall architecture of the Blazor Server hosting model:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7tRowtql53bX6b4BO7Vd46/e0ff8a50ccfdcd2e6ccfdddcc6fe39c6/blazor-server-diagram" alt="Blazor Server architecture diagram"/></p><p>The Blazor Server hosting model provides a few benefits, such as a smaller download size of the client app and the compatibility with not recent browsers. However, it has some drawbacks compared to a classic Single Page Application (SPA), like a higher latency due to the roundtrip between the client and the server for most user interactions and the challenging scalability in high traffic scenarios.</p><p>The <em>Blazor WebAssembly</em> hosting model, also known as <em>Blazor WASM</em>, lets your application run entirely on the user&#39;s browser. The full code of the application, including its dependencies and the .NET runtime, is compiled into <a href="https://webassembly.org/" target="_blank" rel="noreferrer noopener">WebAssembly</a>, downloaded by the user&#39;s browser, and locally executed. The following picture describes the hosting model of Blazor WebAssembly:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5aN8vvvYexEGNKGKgzHVtl/cf35c378d6209f2c0be35e97c3b353a9/blazor-webassembly-diagram" alt="Blazor WebAssembly architecture diagram"/></p><p>The benefits provided by the Blazor WebAssembly hosting model are similar to those provided by Single Page Applications. After the download, the application is independent of the server, apart from the needed interactions. Also, you don&#39;t need an ASP.NET Core Web server to host your application. You can use any Web server, since the result of the WebAssembly compilation is just a set of static files.</p><p>On the other side, you should be aware of the drawbacks of this hosting model. The Blazor WebAssembly hosting model requires that <a href="https://caniuse.com/wasm" target="_blank" rel="noreferrer noopener">the browser supports WebAssembly</a>. In addition, the initial download of the application may take some time.</p><blockquote><a href="https://twitter.com/intent/tweet?text=&#34;You%20don&#39;t%20need%20an%20ASP.NET%20Core%20Web%20server%20to%20host%20Blazor%20WebAssembly%20applications.&#34; via @auth0 https://auth0.com/blog/what-is-blazor-tutorial-on-building-webapp-with-authentication" target="_blank" rel="noopener noreferrer"><p>&#34;You don&#39;t need an ASP.NET Core Web server to host Blazor WebAssembly applications.&#34;</p><div><p><img alt="Tweet" src="https://cdn.auth0.com/blog/resources/twitter.svg"/></p><h4>Tweet This</h4></div></a></blockquote><h3 id="Blazor-roadmap">Blazor roadmap</h3><p>Blazor promises a great opportunity for .NET developers. Microsoft&#39;s goals on the Blazor project are very ambitious, especially for Blazor WebAssembly. In their vision, not only will Blazor WebAssembly become the main hosting model, but it will also drive a great revolution in the <strong>development of clients</strong>.</p><p>The <a href="https://visualstudiomagazine.com/articles/2019/09/26/blazor-future.aspx" target="_blank" rel="noreferrer noopener">Blazor WebAssembly hosting model</a> will include Single Page Applications compiled into WebAssembly, Progressive Web Apps, hybrid mobile applications, Electron-based desktop applications, and native applications.</p><h2 id="Prerequisites">Prerequisites</h2><p>Before starting to build your Blazor application, you need to ensure you have installed the right tools on your machine. In particular, you need .NET 6.0 SDK or above. You can check if you have the correct version installed by typing the following command in a terminal window:</p><pre><code>dotnet --version</code></pre><p>You should get the value <code><span>6.0</span><span>.100</span></code> or above as a result. If you don&#39;t, you should <a href="https://dotnet.microsoft.com/download/dotnet/6.0" target="_blank" rel="noreferrer noopener">download the .NET SDK</a> and install it on your machine.</p><p>If you are going to use Visual Studio, be aware that you need to use at least Visual Studio 2019 16.8 or Visual Studio for Mac 8.9.</p><blockquote><p><strong>Note</strong>: If you update Visual Studio to the latest version, you will get the required .NET SDK bundled.</p></blockquote><h2 id="Building-a-Blazor-Server-Application">Building a Blazor Server Application</h2><p>To get started with Blazor, you will build a simple quiz application that shows a list of questions with multiple answers and assigns you a score based on the correct answers you provide. You will create this application using the Blazor Server hosting model. If you are interested in <a href="https://auth0.com/blog/securing-blazor-webassembly-apps/" target="_blank" rel="noreferrer noopener">building and securing the same application by using the Blazor WebAssembly, please check out this article</a>.</p><p>So, create a basic Blazor Server project by typing the following command in a terminal window:</p><pre><code>dotnet new blazorserver -o QuizManager</code></pre><p>This command uses the <code>blazorserver</code> template to generate the project for your application in the <code>QuizManager</code> folder. This newly created folder has a lot of content but, apart from the root folder, the relevant folders that you are going to touch are:</p><ul><li>The <code>Data</code> folder: it contains the models and the services implementing the business logic.</li><li>The <code>Pages</code> folder: this contains the Razor components that generate the HTML views. In particular, this folder contains the <code>_Host<span>.</span>cshtml</code> Razor page, which acts as the starting point of the Web UI.</li><li>The <code>Shared</code> folder: it contains Razor components and other elements shared among pages</li></ul><h3 id="Creating-the-model-and-the-service">Creating the model and the service</h3><p>As a first step, delete the files inside the <code>Data</code> folder. Next, add a <code>QuizItem<span>.</span>cs</code> file into this folder and paste in the following code:</p><pre><code><span>// Data/QuizItem.cs</span>

<span>namespace</span> <span>QuizManager<span>.</span>Data</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>QuizItem</span>
    <span>{</span>
        <span>public</span> <span><span>string</span></span> Question <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span>List<span>&lt;</span><span>string</span><span>&gt;</span></span> Choices <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>int</span></span> AnswerIndex <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>int</span></span> Score <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

        <span>public</span> <span>QuizItem</span><span>(</span><span>)</span>
        <span>{</span>
            Choices <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>string</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><p>This class implements the model for each item of the quiz. It provides a question, a list of possible answers, the zero-based index of the correct answer, and the score assigned when the user gives the correct answer.</p><p>In the same <code>Data</code> folder, add a second file named <code>QuizService<span>.</span>cs</code> with the following content:</p><pre><code><span>// Data/QuizService.cs</span>

<span>namespace</span> <span>QuizManager<span>.</span>Data</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>QuizService</span>
    <span>{</span>
        <span>private</span> <span>static</span> <span>readonly</span> <span>List<span>&lt;</span>QuizItem<span>&gt;</span></span> Quiz<span>;</span>

        <span>static</span> <span>QuizService</span><span>(</span><span>)</span>
        <span>{</span>
            Quiz <span>=</span> <span>new</span> <span>List<span>&lt;</span>QuizItem<span>&gt;</span></span> <span>{</span>
                <span>new</span> <span>QuizItem</span>
                <span>{</span>
                    Question <span>=</span> <span>&#34;Which of the following is the name of a Leonardo da Vinci&#39;s masterpiece?&#34;</span><span>,</span>
                    Choices <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>string</span><span>&gt;</span></span> <span>{</span><span>&#34;Sunflowers&#34;</span><span>,</span> <span>&#34;Mona Lisa&#34;</span><span>,</span> <span>&#34;The Kiss&#34;</span><span>}</span><span>,</span>
                    AnswerIndex <span>=</span> <span>1</span><span>,</span>
                    Score <span>=</span> <span>3</span>
                <span>}</span><span>,</span>
                <span>new</span> <span>QuizItem</span>
                <span>{</span>
                    Question <span>=</span> <span>&#34;Which of the following novels was written by Miguel de Cervantes?&#34;</span><span>,</span>
                    Choices <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>string</span><span>&gt;</span></span> <span>{</span><span>&#34;The Ingenious Gentleman Don Quixote of La Mancia&#34;</span><span>,</span> <span>&#34;The Life of Gargantua and of Pantagruel&#34;</span><span>,</span> <span>&#34;One Hundred Years of Solitude&#34;</span><span>}</span><span>,</span>
                    AnswerIndex <span>=</span> <span>0</span><span>,</span>
                    Score <span>=</span> <span>5</span>
                <span>}</span>
            <span>}</span><span>;</span>
        <span>}</span>

        <span>public</span> <span>Task<span>&lt;</span>List<span>&lt;</span>QuizItem<span>&gt;</span><span>&gt;</span></span> <span>GetQuizAsync</span><span>(</span><span>)</span>
        <span>{</span>
            <span>return</span> Task<span>.</span><span>FromResult</span><span>(</span>Quiz<span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><p>This class defines a quiz as a list of <code>QuizItem</code> instances initialized by the <code><span>QuizService</span><span>(</span><span>)</span></code> constructor. For simplicity, the list is implemented with a static variable, but in a real-world scenario, it should be persisted into a database. The <code><span>GetQuizAsync</span><span>(</span><span>)</span></code> method simply returns the value of the <code>Quiz</code> variable.</p><p>Now, move to the root of your project and edit the <code>Program<span>.</span>cs</code> file by applying the changes shown in the following code:</p><pre><code><span>// Program.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Components</span><span>;</span>
<span>// ...other using clauses...</span>

<span><span>var</span></span> builder <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>;</span>

<span>// Add services to the container.</span>
builder<span>.</span>Services<span>.</span><span>AddRazorPages</span><span>(</span><span>)</span><span>;</span>
builder<span>.</span>Services<span>.</span><span>AddServerSideBlazor</span><span>(</span><span>)</span><span>;</span>
<span>// üëá existing code</span>
<span>//builder.Services.AddSingleton&lt;WeatherForecastService&gt;();</span>
builder<span>.</span>Services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>QuizService<span>&gt;</span></span></span><span>(</span><span>)</span><span>;</span>
<span>// ‚òùÔ∏è new code</span>

<span><span>var</span></span> app <span>=</span> builder<span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

<span>// ...existing code...</span></code></pre><p>With this change, you registered the <code>QuizService</code> service you defined above instead of the service of the sample application coming with the default Blazor project template.</p><h3 id="Creating-Razor-components">Creating Razor components</h3><p>Now that you&#39;ve created the model and the service of the application, it&#39;s time to implement the UI. Blazor leverages <a href="https://docs.microsoft.com/en-us/aspnet/core/mvc/views/razor" target="_blank" rel="noreferrer noopener">Razor</a> as a template processor to produce dynamic HTML. In particular, Blazor uses <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/components" target="_blank" rel="noreferrer noopener">Razor components</a> to build up the application UI. Razor components are self-contained units of markup and code that can be nested and reused even in other projects. They are implemented in file with the <code><span>.</span>razor</code> extension.</p><blockquote><a href="https://twitter.com/intent/tweet?text=&#34;Razor%20components%20are%20the%20basic%20UI%20elements%20in%20a%20Blazor%20application.&#34; via @auth0 https://auth0.com/blog/what-is-blazor-tutorial-on-building-webapp-with-authentication" target="_blank" rel="noopener noreferrer"><p>&#34;Razor components are the basic UI elements in a Blazor application.&#34;</p><div><p><img alt="Tweet" src="https://cdn.auth0.com/blog/resources/twitter.svg"/></p><h4>Tweet This</h4></div></a></blockquote><p>To show the quiz to the user and let them interact with it, you need to implement a specific view as a Razor component. So, move to the <code>Pages</code> folder and remove the <code>Counter<span>.</span>razor</code> and <code>FetchData<span>.</span>razor</code> files. These files belonged to the default sample project. Then, add in the same folder the <code>QuizViewer<span>.</span>razor</code> file with the following content:</p><pre><code><span>// Pages/QuizViewer.razor</span>

 @page <span>&#34;/quizViewer&#34;</span>

 @<span>using</span> QuizManager<span>.</span>Data
 @inject QuizService QuizRepository

 <span>&lt;</span>h1<span>&gt;</span>Take your quiz<span>!</span><span>&lt;</span><span>/</span>h1<span>&gt;</span>
 <span>&lt;</span>p<span>&gt;</span>Your current score <span>is</span> <span>@currentScore</span><span>&lt;</span><span>/</span>p<span>&gt;</span>

@<span>if</span> <span>(</span>quiz <span>==</span> <span>null</span><span>)</span>
<span>{</span>
    <span>&lt;</span>p<span>&gt;</span><span>&lt;</span>em<span>&gt;</span>Loading<span>..</span><span>.</span><span>&lt;</span><span>/</span>em<span>&gt;</span><span>&lt;</span><span>/</span>p<span>&gt;</span>
<span>}</span>
<span>else</span>
<span>{</span>
    <span><span>int</span></span> quizIndex <span>=</span> <span>0</span><span>;</span>
    @<span>foreach</span> <span>(</span><span><span>var</span></span> quizItem <span>in</span> quiz<span>)</span>
    <span>{</span>
        <span>&lt;</span>section<span>&gt;</span>
            <span>&lt;</span>h3<span>&gt;</span>@quizItem<span>.</span>Question<span>&lt;</span><span>/</span>h3<span>&gt;</span>
            <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;form-check&#34;</span><span>&gt;</span>
            @<span>{</span>
                <span><span>int</span></span> choiceIndex <span>=</span> <span>0</span><span>;</span>
                quizScores<span>.</span><span>Add</span><span>(</span><span>0</span><span>)</span><span>;</span>
            <span>}</span>
            @<span>foreach</span> <span>(</span><span><span>var</span></span> choice <span>in</span> quizItem<span>.</span>Choices<span>)</span>
            <span>{</span>
                <span><span>int</span></span> currentQuizIndex <span>=</span> quizIndex<span>;</span>
                <span>&lt;</span>input <span>class</span><span>=</span><span>&#34;form-check-input&#34;</span> type<span>=</span><span>&#34;radio&#34;</span> name<span>=</span><span>&#34;@quizIndex&#34;</span> <span>value</span><span>=</span><span>&#34;@choiceIndex&#34;</span> @onchange<span>=</span><span>&#34;@((eventArgs) =&gt; UpdateScore(Convert.ToInt32(eventArgs.Value), currentQuizIndex))&#34;</span><span>/</span><span>&gt;</span>@choice<span>&lt;</span>br<span>&gt;</span>

                choiceIndex<span>++</span><span>;</span>
            <span>}</span>
            <span>&lt;</span><span>/</span>div<span>&gt;</span>
        <span>&lt;</span><span>/</span>section<span>&gt;</span>

        quizIndex<span>++</span><span>;</span>
    <span>}</span>
<span>}</span>

@code <span>{</span>
    <span>List<span>&lt;</span>QuizItem<span>&gt;</span></span> quiz<span>;</span>
    <span>List<span>&lt;</span><span>int</span><span>&gt;</span></span> quizScores <span>=</span> <span>new</span> <span>List<span>&lt;</span><span>int</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
    <span><span>int</span></span> currentScore <span>=</span> <span>0</span><span>;</span>

    <span>protected</span> <span>override</span> <span>async</span> <span>Task</span> <span>OnInitializedAsync</span><span>(</span><span>)</span>
    <span>{</span>
        quiz <span>=</span> <span>await</span> QuizRepository<span>.</span><span>GetQuizAsync</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span><span>void</span></span> <span>UpdateScore</span><span>(</span><span><span>int</span></span> chosenAnswerIndex<span>,</span> <span><span>int</span></span> quizIndex<span>)</span>
    <span>{</span>
        <span><span>var</span></span> quizItem <span>=</span> quiz<span>[</span>quizIndex<span>]</span><span>;</span>

        <span>if</span> <span>(</span>chosenAnswerIndex <span>==</span> quizItem<span>.</span>AnswerIndex<span>)</span>
        <span>{</span>
            quizScores<span>[</span>quizIndex<span>]</span> <span>=</span> quizItem<span>.</span>Score<span>;</span>
        <span>}</span> <span>else</span>
        <span>{</span>
            quizScores<span>[</span>quizIndex<span>]</span> <span>=</span> <span>0</span><span>;</span>
        <span>}</span>
        currentScore <span>=</span> quizScores<span>.</span><span>Sum</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Take a look at the code of this component. Its first line uses the <code>@page</code> directive to define this component as a page, which is a UI element that is directly reachable through an address (<code><span>/</span>quizViewer</code> in this case) in the Blazor&#39;s routing system. Then, you have the <code>@using</code> directive, which provides access to the <code>QuizManager<span>.</span>Data</code> namespace where you defined the <code>QuizItem</code> model and the <code>QuizService</code> service. The <code>@inject</code> directive asks the dependency injection system to get an instance of the <code>QuizService</code> class mapped to the <code>QuizRepository</code> variable.</p><p>After these initializations, you will find the markup defining the UI. As you can see, this part is a mix of HTML and C# code whose purpose is to build the list of questions with the respective possible answers represented as radio buttons.</p><p>The final block of the component is enclosed in the <code>@code</code> directive. This is where you put the logic of the component. In the case of the <code>QuizViewer</code> component,  you have the <code><span>OnInitializedAsync</span><span>(</span><span>)</span></code>  and the <code><span>UpdateScore</span><span>(</span><span>)</span></code> methods. The first method is called when the component is initialized, and it basically gets the quiz data by invoking the <code><span>GetQuizAsync</span><span>(</span><span>)</span></code> method of the <code>QuizRepository</code> service instance. The <code><span>UpdateScore</span><span>(</span><span>)</span></code> method is called when the user clicks one of the proposed answers, and it updates the list of the assigned scores according to the answer chosen by the user. In the same method, the value of the current score is computed and assigned to the <code>currentScore</code> variable. The value of this variable is shown above the list of questions, as you can see in the markup.</p><p>Now, go to apply the final touch by moving in the <code>Shared</code> folder and replacing the content of the <code>NavMenu<span>.</span>razor</code> file with the following code:</p><pre><code><span>// Shared/NavMenu.razor</span>

<span>&lt;</span>div <span>class</span><span>=</span><span>&#34;top-row ps-3 navbar navbar-dark&#34;</span><span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;container-fluid&#34;</span><span>&gt;</span>
        <span>&lt;</span>a <span>class</span><span>=</span><span>&#34;navbar-brand&#34;</span> href<span>=</span><span>&#34;&#34;</span><span>&gt;</span>QuizManager<span>&lt;</span><span>/</span>a<span>&gt;</span>
        <span>&lt;</span><span>button</span> title<span>=</span><span>&#34;Navigation menu&#34;</span> <span>class</span><span>=</span><span>&#34;navbar-toggler&#34;</span> @onclick<span>=</span><span>&#34;ToggleNavMenu&#34;</span><span>&gt;</span>
            <span>&lt;</span>span <span>class</span><span>=</span><span>&#34;navbar-toggler-icon&#34;</span><span>&gt;</span><span>&lt;</span><span>/</span>span<span>&gt;</span>
        <span>&lt;</span><span>/</span>button<span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
<span>&lt;</span><span>/</span>div<span>&gt;</span>

<span>&lt;</span>div <span>class</span><span>=</span><span>&#34;@NavMenuCssClass&#34;</span> @onclick<span>=</span><span>&#34;ToggleNavMenu&#34;</span><span>&gt;</span>
    <span>&lt;</span>nav <span>class</span><span>=</span><span>&#34;flex-column&#34;</span><span>&gt;</span>
        <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;nav-item px-3&#34;</span><span>&gt;</span>
            <span>&lt;</span>NavLink <span>class</span><span>=</span><span>&#34;nav-link&#34;</span> href<span>=</span><span>&#34;&#34;</span> Match<span>=</span><span>&#34;NavLinkMatch.All&#34;</span><span>&gt;</span>
                <span>&lt;</span>span <span>class</span><span>=</span><span>&#34;oi oi-home&#34;</span> aria<span>-</span>hidden<span>=</span><span>&#34;true&#34;</span><span>&gt;</span><span>&lt;</span><span>/</span>span<span>&gt;</span> Home
            <span>&lt;</span><span>/</span>NavLink<span>&gt;</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>
        <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;nav-item px-3&#34;</span><span>&gt;</span>
            <span>&lt;</span>NavLink <span>class</span><span>=</span><span>&#34;nav-link&#34;</span> href<span>=</span><span>&#34;quizViewer&#34;</span><span>&gt;</span>
                <span>&lt;</span>span <span>class</span><span>=</span><span>&#34;oi oi-list-rich&#34;</span> aria<span>-</span>hidden<span>=</span><span>&#34;true&#34;</span><span>&gt;</span><span>&lt;</span><span>/</span>span<span>&gt;</span> Quiz
            <span>&lt;</span><span>/</span>NavLink<span>&gt;</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span><span>/</span>nav<span>&gt;</span>
<span>&lt;</span><span>/</span>div<span>&gt;</span>

@code <span>{</span>
    <span>private</span> <span><span>bool</span></span> collapseNavMenu <span>=</span> <span>true</span><span>;</span>

    <span>private</span> <span><span>string</span><span>?</span></span> NavMenuCssClass <span>=&gt;</span> collapseNavMenu <span>?</span> <span>&#34;collapse&#34;</span> <span>:</span> <span>null</span><span>;</span>

    <span>private</span> <span><span>void</span></span> <span>ToggleNavMenu</span><span>(</span><span>)</span>
    <span>{</span>
        collapseNavMenu <span>=</span> <span>!</span>collapseNavMenu<span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>The <code>NavMenu<span>.</span>razor</code> file contains the definition of the navigation bar component of the application. The code you put its this file defines a navigation menu of two items: one pointing to the home page and the other to the <code>QuizViewer</code> component.</p><p>You&#39;re not going to change the <em>App</em> component implemented by the <code>App<span>.</span>razor</code> file in the project root folder yet, but it&#39;s still worth taking a look at anyway.</p><pre><code>// App.razor

<span><span><span>&lt;</span>Router</span> <span>AppAssembly</span><span><span>=</span><span>&#34;</span>@typeof(App).Assembly<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>Found</span> <span>Context</span><span><span>=</span><span>&#34;</span>routeData<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>RouteView</span> <span>RouteData</span><span><span>=</span><span>&#34;</span>@routeData<span>&#34;</span></span> <span>DefaultLayout</span><span><span>=</span><span>&#34;</span>@typeof(MainLayout)<span>&#34;</span></span> <span>/&gt;</span></span>
        <span><span><span>&lt;</span>FocusOnNavigate</span> <span>RouteData</span><span><span>=</span><span>&#34;</span>@routeData<span>&#34;</span></span> <span>Selector</span><span><span>=</span><span>&#34;</span>h1<span>&#34;</span></span> <span>/&gt;</span></span>
    <span><span><span>&lt;/</span>Found</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>NotFound</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>PageTitle</span><span>&gt;</span></span>Not found<span><span><span>&lt;/</span>PageTitle</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>LayoutView</span> <span>Layout</span><span><span>=</span><span>&#34;</span>@typeof(MainLayout)<span>&#34;</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>p</span> <span>role</span><span><span>=</span><span>&#34;</span>alert<span>&#34;</span></span><span>&gt;</span></span>Sorry, there&#39;s nothing at this address.<span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>LayoutView</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>NotFound</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>Router</span><span>&gt;</span></span></code></pre><p>This component attaches the Blazor routing system to your application by using the built-in <em>Router</em> component. It enables navigation among the pages of your application, distinguishing when the page is found from when it does not exist. For more information about the Blazor routing system, check the <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/routing" target="_blank" rel="noreferrer noopener">official documentation</a>.</p><details><summary>‚ö†Ô∏è If you are using a Mac, please, read! ‚ö†Ô∏è</summary><p>At the time of writing, Mac users are affected by an issue when running an ASP.NET Core application via the .NET CLI. You may get the following dialog window when run :</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Io0TQcelmQbkgNnAoXjzm/2bde77c4f9a50bca9c740841dad624a3/keychain-message-mac-issue.png" alt="Keychain message issue in Mac"/></p><p>This is due to <a href="https://github.com/dotnet/sdk/issues/22544" target="_blank" rel="noreferrer noopener">a known issue with the .NET CLI on macOS</a>. The current workaround requires that you open the <code>QuizManager<span>.</span>csproj</code> file and add the <code><span>&lt;</span>UseAppHost<span>&gt;</span><span>false</span><span>&lt;</span><span>/</span>UseAppHost<span>&gt;</span></code> element as shown below:</p><pre><code><span>&lt;!-- QuizManager.csproj --&gt;</span>

<span><span><span>&lt;</span>Project</span> <span>Sdk</span><span><span>=</span><span>&#34;</span>Microsoft.NET.Sdk.Web<span>&#34;</span></span><span>&gt;</span></span>

<span><span><span>&lt;</span>PropertyGroup</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>TargetFramework</span><span>&gt;</span></span>net6.0<span><span><span>&lt;/</span>TargetFramework</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>Nullable</span><span>&gt;</span></span>enable<span><span><span>&lt;/</span>Nullable</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>ImplicitUsings</span><span>&gt;</span></span>enable<span><span><span>&lt;/</span>ImplicitUsings</span><span>&gt;</span></span>
  <span>&lt;!--üëá new element ---&gt;</span>
  <span><span><span>&lt;</span>UseAppHost</span><span>&gt;</span></span>false<span><span><span>&lt;/</span>UseAppHost</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>PropertyGroup</span><span>&gt;</span></span>

<span><span><span>&lt;/</span>Project</span><span>&gt;</span></span></code></pre><p>If you use Visual Studio, you are not affected by this issue.</p></details><h3 id="Running-your-Blazor-Server-application">Running your Blazor Server application</h3><p>Now you have your quiz application, so launch it by typing the following command in a terminal window:</p><pre><code>dotnet run</code></pre><blockquote><p>If this is the very first time you run an ASP.NET Core application, you should trust the HTTPS development certificate included in the .NET Core SDK. This task depends on your operating system. Please, take a look at the <a href="https://docs.microsoft.com/en-us/aspnet/core/security/enforcing-ssl?view=aspnetcore-3.0&amp;tabs=visual-studio#trust" target="_blank" rel="noreferrer noopener">official documentation</a> to apply the proper procedure.</p><p>You may also be requested to allow the application to access the developer certificate key.</p></blockquote><p>After a few seconds, you should get your application up and running. Take a look at your terminal window to get the address your application is listening to. In my case, I got the address <a href="https://localhost:7290" target="_blank" rel="noreferrer noopener"><code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7290</span></code></a>, and I will refer to it throughout the article.</p><blockquote><p>Starting with .NET 6.0, any ASP.NET project created through a template is assigned a random port between 5000 and 5300 for HTTP and between 7000 and 7300 for HTTPS. See <a href="https://docs.microsoft.com/en-us/aspnet/core/release-notes/aspnetcore-6.0?view=aspnetcore-6.0#tgp" target="_blank" rel="noreferrer noopener">this document</a> for more information.</p></blockquote><p>So, if you open your browser at that address, you should get access to the home page, as shown by the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Dw7eHdnXOnz9xEAcXGL3A/dd4b4b48f5db82171ce27eecb97add44/blazor-server-home-page.png" alt="Blazor application default home page"/></p><p>Selecting the <em>Quiz</em> item in the navigation menu, you should get the interactive quiz you built so far. It should look like the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5d0gen7BSw1fIqXjLjWWdX/83acaccd02495141db7c653b5496c1ff/blazor-server-quiz-view.png" alt="Quiz view in the Blazor application"/></p><p>If you open the developer tools of your browser, click on the <em>Network</em> tab, and refresh, you will discover that the communication between the client side and the server side of your application doesn&#39;t use HTTP, but it is a bi-directional binary communication managed by SignalR. The following picture shows the WebSocket channel in Chrome developer tools:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3klQMC5GJmJApzMbmDA0a7/727752c284581d03c766f7bbd2e5af53/blazor-server-signalr-communication.png" alt="Blazor server communication based on SignalR"/></p><h2 id="Securing-the-Application-with-Auth0">Securing the Application with Auth0</h2><p>Now you have a working quiz Web application implemented as a Blazor Server application. In order to secure this application, you will learn how to integrate it with <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 services</a>. </p><h3 id="Creating-the-Auth0-application">Creating the Auth0 application</h3><p>The first step to secure your Blazor Server application is to access the <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a> to register your Auth0 application. If you don&#39;t have an Auth0 account, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one now</a>.</p><p>Try out the most powerful authentication platform for free.<a target="_blank" href="https://auth0.com/signup?promo=sup&amp;place=in-blog-banner&amp;type=link&amp;text=get-started&amp;origin=blog">Get started ‚Üí</a></p><p>Once in the dashboard, move to the <a href="https://manage.auth0.com/#/applications" target="_blank" rel="noreferrer noopener">Applications section</a> and follow these steps:</p><ol start="1"><li>Click on <em>Create Application</em>.</li><li>Provide a friendly name for your application (for example, <em>Quiz Blazor Server App</em>) and choose <em>Regular Web Applications</em> as an application type.</li><li>Finally, click the <em>Create</em> button.</li></ol><p>These steps make Auth0 aware of your Blazor application and will allow you to control access.</p><p>After the application has been registered, move to the <em>Settings</em> tab and take note of your Auth0 domain and client id. Then, in the same form, assign the value <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>&lt;</span><span>YOUR_PORT_NUMBER</span><span>&gt;</span><span>/</span>callback</code> to the <em>Allowed Callback URLs</em> field and the value <code>https<span>:</span><span>/</span><span><span>/</span><span>localhost:&lt;YOUR_PORT_NUMBER&gt;</span><span>/</span></span></code> to the <em>Allowed Logout URLs</em> field. Replace the <code><span>&lt;</span><span>YOUR_PORT_NUMBER</span><span>&gt;</span></code> placeholder with the actual port number assigned to your application. In my case, those values are <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7290</span><span>/</span>callback</code> and <code>https<span>:</span><span>/</span><span><span>/</span><span>localhost:7290</span><span>/</span></span></code>.</p><p>The first value tells Auth0 which URL to call back after the user authentication. The second value tells Auth0 which URL a user should be redirected to after their logout.</p><p>Click the <em>Save Changes</em> button to apply them.</p><h3 id="Configuring-your-Blazor-application">Configuring your Blazor application</h3><p>Open the <code>appsettings<span>.</span>json</code> file in the root folder of your Blazor Server project and replace its content with the following:</p><pre><code><span>// appsettings.json</span>
<span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
    <span>&#34;LogLevel&#34;</span><span>:</span> <span>{</span>
      <span>&#34;Default&#34;</span><span>:</span> <span>&#34;Information&#34;</span><span>,</span>
      <span>&#34;Microsoft.AspNetCore&#34;</span><span>:</span> <span>&#34;Warning&#34;</span>
    <span>}</span>
  <span>}</span><span>,</span>
  <span>&#34;AllowedHosts&#34;</span><span>:</span> <span>&#34;*&#34;</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;YOUR_AUTH0_DOMAIN&#34;</span><span>,</span>
    <span>&#34;ClientId&#34;</span><span>:</span> <span>&#34;YOUR_CLIENT_ID&#34;</span>
  <span>}</span>
<span>}</span></code></pre><p>Replace the placeholders <code><span>YOUR_AUTH0_DOMAIN</span></code> and <code><span>YOUR_CLIENT_ID</span></code> with the respective values taken from the Auth0 dashboard.</p><h3 id="Integrating-with-Auth0">Integrating with Auth0</h3><p>Now, install the <a href="https://github.com/auth0/auth0-aspnetcore-authentication" target="_blank" rel="noreferrer noopener">Auth0 ASP.NET Core Authentication SDK</a> by running the following command in your terminal window:</p><pre><code>dotnet <span>add</span> package Auth0.AspNetCore.Authentication</code></pre><p>The Auth0 ASP.NET Core SDK lets you easily integrate <a href="https://auth0.com/docs/authorization/protocols/openid-connect-protocol" target="_blank" rel="noreferrer noopener">OpenID Connect</a>-based authentication in your app without dealing with all its low-level details.</p><p>If you want to learn a bit more, this blog post provides you with <a href="https://auth0.com/blog/exploring-auth0-aspnet-core-authentication-sdk/" target="_blank" rel="noreferrer noopener">an overview of the Auth0 ASP.NET Core SDK</a>.</p><p>After the installation is complete, open the <code>Program<span>.</span>cs</code> file and change its content as follows:</p><pre><code><span>// Program.cs</span>

<span>using</span> <span>QuizManager<span>.</span>Data</span><span>;</span>
<span>using</span> <span>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span> <span>// üëà new code</span>

<span><span>var</span></span> builder <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>;</span>

<span>// üëá new code</span>
builder<span>.</span>Services
    <span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span> <span>{</span>
      options<span>.</span>Domain <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
      options<span>.</span>ClientId <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>// üëÜ new code</span>

<span>// Add services to the container.</span>
builder<span>.</span>Services<span>.</span><span>AddRazorPages</span><span>(</span><span>)</span><span>;</span>

<span>// ...existing code...</span>

app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>

app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span> <span>// üëà new code</span>
app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>  <span>// üëà new code</span>

app<span>.</span><span>MapBlazorHub</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>MapFallbackToPage</span><span>(</span><span>&#34;/_Host&#34;</span><span>)</span><span>;</span>

app<span>.</span><span>Run</span><span>(</span><span>)</span><span>;</span></code></pre><p>Following the highlighted code, you added a reference to the <code>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</code> namespace at the beginning of the file. Then you invoked the <code><span>AddAuth0WebAppAuthentication</span><span>(</span><span>)</span></code> method with the Auth0 domain and client id as arguments. These Auth0 configuration parameters are taken from the <code>appsetting<span>.</span>json</code> configuration file you prepared earlier. Finally, you called the <code><span>UseAuthentication</span><span>(</span><span>)</span></code> and <code><span>UseAuthorization</span><span>(</span><span>)</span></code> methods to enable the authentication and authorization middleware.</p><p>Now your application has the infrastructure to support authentication via Auth0.</p><h3 id="Securing-the-server-side">Securing the server side</h3><p>In order to prevent unauthorized users from accessing the server-side functionalities of your application, you need to protect them. So, open the <code>Index<span>.</span>razor</code> file in the <code>Pages</code> folder and add the <code>Authorize</code> attribute as shown in the following:</p><pre><code><span>// Pages/Index.razor</span>

@page <span>&#34;/&#34;</span>
@attribute <span>[</span>Authorize<span>]</span>

<span>&lt;</span>PageTitle<span>&gt;</span>Index<span>&lt;</span><span>/</span>PageTitle<span>&gt;</span>

<span>&lt;</span>h1<span>&gt;</span>Hello<span>,</span> world<span>!</span><span>&lt;</span><span>/</span>h1<span>&gt;</span>

Welcome to your <span>new</span> app<span>.</span>

<span>&lt;</span><span>SurveyPrompt</span> Title<span>=</span><span>&#34;How is Blazor working for you?&#34;</span> <span>/</span><span>&gt;</span></code></pre><p>Add the same attribute to the <code>QuizViewer<span>.</span>razor</code> component as well:</p><pre><code><span>// Pages/QuizViewer.razor</span>

@page <span>&#34;/quizViewer&#34;</span>
@attribute <span>[</span>Authorize<span>]</span>

 @<span>using</span> QuizManager<span>.</span>Data
 @inject QuizService QuizRepository

<span>// ...existing code...</span></code></pre><p>This ensures that the server-side rendering of your pages is triggered only by authorized users.  </p><h3 id="Creating-login-and-logout-endpoints">Creating login and logout endpoints</h3><p>As said before, in the Blazor Server hosting model, the communication between the client side and the server side does not occur over HTTP, but through SignalR. Since Auth0 uses standard protocols like <a href="https://auth0.com/docs/protocols/oidc" target="_blank" rel="noreferrer noopener">OpenID</a> and <a href="https://auth0.com/docs/protocols/oauth2" target="_blank" rel="noreferrer noopener">OAuth</a>  that rely on HTTP, you need to provide a way to bring those protocols on Blazor.</p><p>To solve this issue, you are going to create two endpoints, <code><span>/</span>login</code> and <code><span>/</span>logout</code>, that redirect requests for login and for logout to Auth0. Two standard <a href="https://docs.microsoft.com/en-us/aspnet/core/razor-pages/" target="_blank" rel="noreferrer noopener">Razor pages</a> respond behind these endpoints.</p><p>So, add the <em>Login</em> razor page to the project by typing the following command in a terminal window:</p><pre><code>dotnet new page --name Login --namespace QuizManager.Pages --output Pages</code></pre><p>This command creates two files in the <code>Pages</code> folder: <code>Login<span>.</span>cshtml</code> and <code>Login<span>.</span>cshtml<span>.</span>cs</code>.</p><p>Open the <code>Login<span>.</span>cshtml<span>.</span>cs</code> file in the <code>Pages</code> folder and replace its content with the following:</p><pre><code><span>// Pages/Login.cshtml.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span>
<span>using</span> <span>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc<span>.</span>RazorPages</span><span>;</span>

<span>namespace</span> <span>QuizManager<span>.</span>Pages</span>
<span>{</span>
  <span>public</span> <span>class</span> <span>LoginModel</span> <span>:</span> <span><span>PageModel</span></span>
  <span>{</span>
    <span>public</span> <span>async</span> <span>Task</span> <span>OnGet</span><span>(</span><span><span>string</span></span> redirectUri<span>)</span>
    <span>{</span>
      <span><span>var</span></span> authenticationProperties <span>=</span> <span>new</span> <span>LoginAuthenticationPropertiesBuilder</span><span>(</span><span>)</span>
          <span>.</span><span>WithRedirectUri</span><span>(</span>redirectUri<span>)</span>
          <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

      <span>await</span> HttpContext<span>.</span><span>ChallengeAsync</span><span>(</span>Auth0Constants<span>.</span>AuthenticationScheme<span>,</span> authenticationProperties<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre><p>This code creates a set of authentication properties required for the login and triggers the authentication process via Auth0.</p><p>Then, add the <em>Logout</em> page by typing the following command:</p><pre><code>dotnet new page --name Logout --namespace QuizManager.Pages --output Pages</code></pre><p>Similarly to the previous case, you will get two new files in the <code>Pages</code> folder: <code>Logout<span>.</span>cshtml</code> and <code>Logout<span>.</span>cshtml<span>.</span>cs</code>.</p><p>Replace the content of the <code>Logout<span>.</span>cshtml<span>.</span>cs</code> file with the following code:</p><pre><code><span>// Pages/Logout.cshtml.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc<span>.</span>RazorPages</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span>
<span>using</span> <span>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>Cookies</span><span>;</span>

<span>namespace</span> <span>QuizManager<span>.</span>Pages</span>
<span>{</span>
  <span>public</span> <span>class</span> <span>LogoutModel</span> <span>:</span> <span><span>PageModel</span></span>
  <span>{</span>
    <span>[</span><span><span>Authorize</span></span><span>]</span>
    <span>public</span> <span>async</span> <span>Task</span> <span>OnGet</span><span>(</span><span>)</span>
    <span>{</span>
      <span><span>var</span></span> authenticationProperties <span>=</span> <span>new</span> <span>LogoutAuthenticationPropertiesBuilder</span><span>(</span><span>)</span>
           <span>.</span><span>WithRedirectUri</span><span>(</span><span>&#34;/&#34;</span><span>)</span>
           <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

      <span>await</span> HttpContext<span>.</span><span>SignOutAsync</span><span>(</span>Auth0Constants<span>.</span>AuthenticationScheme<span>,</span> authenticationProperties<span>)</span><span>;</span>
      <span>await</span> HttpContext<span>.</span><span>SignOutAsync</span><span>(</span>CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre><p>This code closes the user&#39;s session on your Blazor application and on Auth0.</p><h3 id="Securing-the-client-side">Securing the client side</h3><p>Now, you have to secure the client side of your Blazor application, so that the users see different content when they are logged in or not.</p><p>Open the <code>App<span>.</span>razor</code> file in the root folder of the project and replace its content with the following markup:</p><pre><code>// App.razor

<span><span><span>&lt;</span>CascadingAuthenticationState</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>Router</span> <span>AppAssembly</span><span><span>=</span><span>&#34;</span>@typeof(App).Assembly<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>Found</span> <span>Context</span><span><span>=</span><span>&#34;</span>routeData<span>&#34;</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>AuthorizeRouteView</span> <span>RouteData</span><span><span>=</span><span>&#34;</span>@routeData<span>&#34;</span></span> <span>DefaultLayout</span><span><span>=</span><span>&#34;</span>@typeof(MainLayout)<span>&#34;</span></span><span>&gt;</span></span>
                <span><span><span>&lt;</span>Authorizing</span><span>&gt;</span></span>
                    <span><span><span>&lt;</span>p</span><span>&gt;</span></span>Determining session state, please wait...<span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
                <span><span><span>&lt;/</span>Authorizing</span><span>&gt;</span></span>
                <span><span><span>&lt;</span>NotAuthorized</span><span>&gt;</span></span>
                    <span><span><span>&lt;</span>h1</span><span>&gt;</span></span>Sorry<span><span><span>&lt;/</span>h1</span><span>&gt;</span></span>
                    <span><span><span>&lt;</span>p</span><span>&gt;</span></span>You&#39;re not authorized to reach this page. You need to log in.<span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
                <span><span><span>&lt;/</span>NotAuthorized</span><span>&gt;</span></span>
            <span><span><span>&lt;/</span>AuthorizeRouteView</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>FocusOnNavigate</span> <span>RouteData</span><span><span>=</span><span>&#34;</span>@routeData<span>&#34;</span></span> <span>Selector</span><span><span>=</span><span>&#34;</span>h1<span>&#34;</span></span> <span>/&gt;</span></span>
        <span><span><span>&lt;/</span>Found</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>NotFound</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>PageTitle</span><span>&gt;</span></span>Not found<span><span><span>&lt;/</span>PageTitle</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>LayoutView</span> <span>Layout</span><span><span>=</span><span>&#34;</span>@typeof(MainLayout)<span>&#34;</span></span><span>&gt;</span></span>
                <span><span><span>&lt;</span>p</span> <span>role</span><span><span>=</span><span>&#34;</span>alert<span>&#34;</span></span><span>&gt;</span></span>Sorry, there&#39;s nothing at this address.<span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
            <span><span><span>&lt;/</span>LayoutView</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>NotFound</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>Router</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>CascadingAuthenticationState</span><span>&gt;</span></span></code></pre><p>Here you are using the <code>AuthorizeRouteView</code> component, which displays the associated component only if the user is authorized. In practice, the content of the <code>MainLayout</code> component will be shown only to authorized users. If the user is not authorized, they will see the content wrapped by the <code>NotAuthorized</code> component. If the authorization is in progress, the user will see the content inside the <code>Authorizing</code> component. The <code>CascadingAuthenticationState</code> component will propagate the current authentication state to the inner components so that they can work on it consistently.</p><blockquote><a href="https://twitter.com/intent/tweet?text=&#34;The%20AuthorizeRouteView%20component%20allows%20you%20to%20control%20access%20to%20the%20UI%20parts%20of%20your%20Blazor%20application.&#34; via @auth0 https://auth0.com/blog/what-is-blazor-tutorial-on-building-webapp-with-authentication" target="_blank" rel="noopener noreferrer"><p>&#34;The AuthorizeRouteView component allows you to control access to the UI parts of your Blazor application.&#34;</p><div><p><img alt="Tweet" src="https://cdn.auth0.com/blog/resources/twitter.svg"/></p><h4>Tweet This</h4></div></a></blockquote><p>At this point, make sure you&#39;re in the <code>QuizManager</code> folder and run <code>dotnet run</code> in your terminal. When a user tries to access your application, they will see just the not authorized message, as shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2iODo9k8BvnJZ1M2dS4ix5/4bf341cf0693b81573bd32b03f9c6e8f/blazor-unauthorized-view.png" alt="Unauthorized view in Blazor application"/></p><p>So, you need a way to let users authenticate. Create a razor component for this purpose by adding an <code>AccessControl<span>.</span>razor</code> file in the <code>Shared</code> folder with the following content:</p><pre><code>// Shared/AccessControl.razor

<span><span><span>&lt;</span>AuthorizeView</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>Authorized</span><span>&gt;</span></span>        
        <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>logout<span>&#34;</span></span><span>&gt;</span></span>Log out<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>Authorized</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>NotAuthorized</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>login?redirectUri=/<span>&#34;</span></span><span>&gt;</span></span>Log in<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>NotAuthorized</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>AuthorizeView</span><span>&gt;</span></span></code></pre><p>This component uses the <code>Authorized</code> component to let the authorized users see the <em>Log out</em> link and the <code>NotAuthorized</code> component to let the unauthorized users access the <em>Log in</em> link. Both links point to the endpoints you created before. In particular, the <em>Log in</em> link specifies the home page as the URI where to redirect users after authentication.</p><p>The final step is to put this component in the top bar of your Blazor application. So, replace the content of the <code>MainLayout<span>.</span>razor</code> file with the following content:</p><pre><code>// Shared/MainLayout.razor

@inherits LayoutComponentBase

<span><span><span>&lt;</span>PageTitle</span><span>&gt;</span></span>QuizManager<span><span><span>&lt;/</span>PageTitle</span><span>&gt;</span></span>

<span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>page<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>sidebar<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>NavMenu</span> <span>/&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>

    <span><span><span>&lt;</span>main</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>top-row px-4<span>&#34;</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>AccessControl</span> <span>/&gt;</span></span>    //üëà new markup
            <span><span><span>&lt;</span>a</span> <span>href</span><span><span>=</span><span>&#34;</span>https://docs.microsoft.com/aspnet/<span>&#34;</span></span> <span>target</span><span><span>=</span><span>&#34;</span>_blank<span>&#34;</span></span><span>&gt;</span></span>About<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>

        <span><span><span>&lt;</span>article</span> <span>class</span><span><span>=</span><span>&#34;</span>content px-4<span>&#34;</span></span><span>&gt;</span></span>
            @Body
        <span><span><span>&lt;/</span>article</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>main</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span></code></pre><p>As you can see, the only difference is the addition of the <code>AccessControl</code> component just before the <em>About</em> link.</p><p>Now, your Blazor application is accessible just to authorized users. When users click the <em>Log in</em> link, they will be redirected to the <a href="https://auth0.com/docs/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login page</a> for authentication. After authentication completes, they will be back to the home page of your application and will be able to take their quiz.</p><h2 id="Accessing-the-User-Profile">Accessing the User Profile</h2><p>Once you add authentication to your Blazor Server application, you may need to access some information about the authenticated user, such as their name and picture. By default, the Auth0 ASP.NET Core Authentication SDK takes care of getting this information for you during the authentication process.</p><p>To show the user&#39;s name and picture on a page, change the content of the <code>Index<span>.</span>razor</code> component as follows:</p><pre><code><span>// Pages/Index.razor</span>

@page <span>&#34;/&#34;</span>
@inject AuthenticationStateProvider AuthState
@attribute <span>[</span>Authorize<span>]</span>

<span>&lt;</span>PageTitle<span>&gt;</span>Quiz Manager<span>&lt;</span><span>/</span>PageTitle<span>&gt;</span>

<span>&lt;</span>h1<span>&gt;</span>Welcome<span>,</span> @Username<span>!</span><span>&lt;</span><span>/</span>h1<span>&gt;</span>
You can only see <span>this</span> content <span>if</span> you&#39;re authenticated<span>.</span>
<span>&lt;</span>br <span>/</span><span>&gt;</span>
<span>&lt;</span><span>img</span> src<span>=</span><span>&#34;@Picture&#34;</span><span>&gt;</span>

@code <span>{</span> 
  <span>private</span> <span><span>string</span></span> Username <span>=</span> <span>&#34;Anonymous User&#34;</span><span>;</span>
  <span>private</span> <span><span>string</span></span> Picture <span>=</span> <span>&#34;&#34;</span><span>;</span>

  <span>protected</span> <span>override</span> <span>async</span> <span>Task</span> <span>OnInitializedAsync</span><span>(</span><span>)</span>
  <span>{</span>
    <span><span>var</span></span> state <span>=</span> <span>await</span> AuthState<span>.</span><span>GetAuthenticationStateAsync</span><span>(</span><span>)</span><span>;</span>

    Username <span>=</span> state<span>.</span>User<span>.</span>Identity<span>.</span>Name<span>??</span> <span>string</span><span>.</span>Empty<span>;</span>

    Picture <span>=</span> state<span>.</span>User<span>.</span>Claims
                <span>.</span><span>Where</span><span>(</span>c <span>=&gt;</span> c<span>.</span>Type<span>.</span><span>Equals</span><span>(</span><span>&#34;picture&#34;</span><span>)</span><span>)</span>
                <span>.</span><span>Select</span><span>(</span>c <span>=&gt;</span> c<span>.</span>Value<span>)</span>
                <span>.</span><span>FirstOrDefault</span><span>(</span><span>)</span> <span>??</span> <span>string</span><span>.</span>Empty<span>;</span>

    <span>await</span> <span>base</span><span>.</span><span>OnInitializedAsync</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>In this new version of the component, you injected the <code>AuthenticationStateProvider</code>, which provides you with information about the current authentication state. You get the actual authentication state in the code block by using its <code><span>GetAuthenticationStateAsync</span><span>(</span><span>)</span></code> method. Thanks to the authentication state, you can extract the name and the picture of the current user ad assign them to the <code>Username</code> and <code>Picture</code> variables. These are the variables you use in the component&#39;s markup to customize this view.</p><p>At this point, you can run your application, log in, and get a home page similar to the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1xkWBOsEVuWyYsXUXPADlp/29190d07310f928de6728f518c537ade/blazor-user-profile.png" alt="Blazor user profile"/></p><h2 id="Recap">Recap</h2><p>This article introduced the basics of Blazor, the programming framework that allows you to build Web client applications by using C# and the .NET platform. You learned about the two hosting models, Blazor Server and Blazor WebAssembly, and built a quiz manager application using the Blazor Server hosting model.</p><p>Finally, you secured the Blazor Server application by integrating it with Auth0.</p><p>The full source code of the application built throughout the article can be downloaded from <a href="https://github.com/auth0-blog/blazor-quiz-manager" target="_blank" rel="noreferrer noopener">this GitHub repository</a>.</p><p>You can continue learning <a href="https://auth0.com/blog/securing-blazor-webassembly-apps/" target="_blank" rel="noreferrer noopener">how to build and secure a Blazor WebAssembly application by reading this article</a>.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 21 Mar 2022 06:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Introducing the Brand-New Auth0 Vue SDK</title>
      <link>https://auth0.com/blog/introducing-auth0-vue-sdk/</link>
      <description>Learn about the essential features of the Auth0 Vue SDK and how it helps developers secure Vue 3 apps.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Today, we are announcing the release of the <a href="https://www.npmjs.com/package/@auth0/auth0-vue" target="_blank" rel="noreferrer noopener">Auth0 Vue SDK</a>, a new SDK that makes it easy to integrate Auth0 with any Vue 3 apps. This new SDK only supports Vue 3 apps. To secure Vue 2 (Vue.js) apps, developers can use the <a href="https://auth0.com/docs/libraries/auth0-single-page-app-sdk" target="_blank" rel="noreferrer noopener">Auth0 SPA SDK</a> instead.</p><p><a href="https://vuejs.org/" target="_blank" rel="noreferrer noopener">Vue.js</a> is a progressive JavaScript framework designed for building user interfaces using HTML, JavaScript, and CSS. It makes building apps for the modern web easy while providing developers with a lot of flexibility.</p><p>The Auth0 Developer Experience team designed the new <a href="https://github.com/auth0/auth0-vue" target="_blank" rel="noreferrer noopener">Auth0 Vue SDK</a> to follow idiomatic patterns that are familiar to Vue developers. The Vue SDK abstracts the features of the <a href="https://github.com/auth0/auth0-spa-js" target="_blank" rel="noreferrer noopener">Auth0 SPA SDK</a> into a Vue plugin that developers can consume in Vue 3 components either using the Options API or the new Composition API.</p><p>Starting today, Vue developers can:</p><ul><li><a href="https://www.npmjs.com/package/@auth0/auth0-vue" target="_blank" rel="noreferrer noopener">Install the <code>auth0<span>-</span>vue</code> package from <code>npm</code></a></li><li><a href="https://github.com/auth0/auth0-vue" target="_blank" rel="noreferrer noopener">View the Auth0 Vue SDK source code on GitHub</a></li><li><a href="https://auth0.com/docs/quickstart/spa/vuejs" target="_blank" rel="noreferrer noopener">Read and follow the quickstart</a></li><li><a href="https://github.com/auth0-samples/auth0-vue-samples" target="_blank" rel="noreferrer noopener">Grab the sample apps</a></li></ul><h2 id="Auth0-Vue-SDK-Features">Auth0 Vue SDK Features</h2><p>This new Auth0 Vue SDK arrives at a great time as Evan You announced on February 7th, 2020, that <a href="https://blog.vuejs.org/posts/vue-3-as-the-new-default.html" target="_blank" rel="noreferrer noopener">Vue 3 is now the default version of Vue</a>. As such, the Auth0 Vue SDK fully supports Vue 3 along with the Options API and the Composition API. The SDK also provides full TypeScript support.</p><p>Here‚Äôs a breakdown of the essential features that developers can enjoy when using the new Auth0 Vue SDK:</p><ul><li>Quick implementation of login and logout functionality into Vue 3 apps using the <a href="https://auth0.com/docs/authenticate/login/auth0-universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login</a> page.</li><li>Easy access to profile information about the logged-in user.</li><li>Availability of access tokens to retrieve protected user data from an external API.</li><li>Simple mechanism to protect Vue 3 routes using a router guard from the SDK with the <a href="https://next.router.vuejs.org/" target="_blank" rel="noreferrer noopener">Vue Router</a>.</li></ul><h2 id="Vue-2-Auth0-SDK-Support">Vue 2 Auth0 SDK Support</h2><p>The new Auth0 Vue SDK only works with Vue 3. If you‚Äôre working on an app that uses Vue 2, you can use the <a href="https://auth0.com/docs/libraries/auth0-single-page-app-sdk" target="_blank" rel="noreferrer noopener">Auth0 SPA SDK</a> instead to implement authentication in your application.</p><p>To see the integration of Vue.js (Vue 2) with the Auth0 SPA SDK in action, take a look at the <a href="https://auth0.com/developers/hub/code-samples/spa/vue-javascript/basic-authentication" target="_blank" rel="noreferrer noopener">&#34;Vue.js/JavaScript Authentication&#34; code sample</a> from the 
 <a href="https://auth0.com/developers/hub/code-samples/spa/vue-javascript" target="_blank" rel="noreferrer noopener">Auth0 Developer Hub</a>!</p><h2 id="Integrate-Auth0-Vue-into-Your-Vue-3-Application">Integrate Auth0 Vue into Your Vue 3 Application</h2><p>You can quickly integrate the Auth0 Vue SDK with your Vue 3 application by following a few steps.</p><p>If you don‚Äôt already have an Auth0 application to work with, create a Single Page Application in your <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a> and configure the following URLs for your application under <strong>Application URLs</strong>:</p><ul><li><strong>Allowed Callback URLs</strong>: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span></code></li><li><strong>Allowed Logout URLs</strong>: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span></code></li><li><strong>Allowed Web Origins</strong>: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span></code></li></ul><p>You can replace <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span></code> with the root URL of your application.</p><p>Take note of the <strong>Client ID</strong> and <strong>Domain</strong>, as you will need those in the next step.</p><p>Install the Auth0 Vue SDK from npm:</p><pre><code><span>npm</span> <span>install</span> @aut0/auth0-vue</code></pre><p>Import the Vue plugin and use the <code>createAuth0</code> function to register it with your Vue 3 app:</p><pre><code><span>import</span> <span>{</span> createAuth0 <span>}</span> <span>from</span> <span>&#39;@auth0/auth0-vue&#39;</span><span>;</span>

<span>const</span> app <span>=</span> <span>createApp</span><span>(</span>App<span>)</span><span>;</span>

app<span>.</span><span>use</span><span>(</span>
  <span>createAuth0</span><span>(</span><span>{</span>
    domain<span>:</span> <span>&#39;&lt;YOUR AUTH0 DOMAIN&gt;&#39;</span><span>,</span>
    client_id<span>:</span> <span>&#39;&lt;YOUR AUTH0 CLIENT ID&gt;&#39;</span><span>,</span>
    redirect_uri<span>:</span> window<span>.</span>location<span>.</span>origin<span>,</span>
  <span>}</span><span>)</span><span>,</span>
<span>)</span><span>;</span>

app<span>.</span><span>mount</span><span>(</span><span>&#39;#app&#39;</span><span>)</span><span>;</span></code></pre><p>Replace the <code><span>&lt;</span><span>YOUR</span> <span>AUTH0</span> <span>DOMAIN</span><span>&gt;</span></code> and <code><span>&lt;</span><span>YOUR</span> <span>AUTH0</span> <span>CLIENT</span> <span>ID</span><span>&gt;</span></code> placeholders with the actual <strong>Client ID</strong> and <strong>Domain</strong> values you got from the Auth0 dashboard.
Create a <code>LoginButton<span>.</span>vue</code> component and use the Auth0 Vue SDK to log the user in. Here‚Äôs an example using a <a href="https://vuejs.org/guide/scaling-up/sfc.html" target="_blank" rel="noreferrer noopener">Single File Component</a> and the Composition API:</p><pre><code><span>// LoginButton.vue</span>
<span>&lt;</span>template<span>&gt;</span>
  <span>&lt;</span>button @click<span>=</span><span>&#34;login&#34;</span><span>&gt;</span>Log <span>in</span><span>&lt;</span><span>/</span>button<span>&gt;</span>
<span>&lt;</span><span>/</span>template<span>&gt;</span>

<span>&lt;</span>script<span>&gt;</span>
<span>import</span> <span>{</span> useAuth0 <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-vue&#34;</span><span>;</span>

<span>export</span> <span>default</span> <span>{</span>
  <span>setup</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> <span>{</span> loginWithRedirect <span>}</span> <span>=</span> <span>useAuth0</span><span>(</span><span>)</span><span>;</span>

    <span>return</span> <span>{</span>
      <span>login</span><span>(</span><span>)</span> <span>{</span>
        <span>loginWithRedirect</span><span>(</span><span>)</span><span>;</span>
      <span>}</span><span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>,</span>
<span>}</span><span>;</span>
<span>&lt;</span><span>/</span>script<span>&gt;</span></code></pre><p>If you prefer to use the Options API, the same thing can be achieved using the <code>$auth0</code> accessor:</p><pre><code><span>&lt;</span>template<span>&gt;</span>
  <span>&lt;</span>button @click<span>=</span><span>&#34;login&#34;</span><span>&gt;</span>Log <span>in</span><span>&lt;</span><span>/</span>button<span>&gt;</span>
<span>&lt;</span><span>/</span>template<span>&gt;</span>

<span>&lt;</span>script<span>&gt;</span>
<span>export</span> <span>default</span> <span>{</span>
  methods<span>:</span> <span>{</span>
    <span>login</span><span>(</span><span>)</span> <span>{</span>
      <span>this</span><span>.</span>$auth0<span>.</span><span>loginWithRedirect</span><span>(</span><span>)</span><span>;</span>
    <span>}</span><span>,</span>
  <span>}</span><span>,</span>
<span>}</span><span>;</span>
<span>&lt;</span><span>/</span>script<span>&gt;</span></code></pre><p>Add a <code>LoginComponent</code> to your app, start it up, and click the button to see the magic of authentication!</p><p>Please check out <a href="https://auth0.com/docs/quickstart/spa/vuejs" target="_blank" rel="noreferrer noopener">the Quickstart</a> for more things you can do with the SDK and the <a href="http://github.com/auth0/auth0-vue" target="_blank" rel="noreferrer noopener">repository on GitHub</a> for a more detailed description of the setup and usage of the SDK.</p><p>Enjoy!</p></div></div>]]></content:encoded>
      <pubDate>Thu, 17 Mar 2022 16:13:00 +0000</pubDate>
    </item>
    <item>
      <title>Authenticating Users in Your VR Apps</title>
      <link>https://auth0.com/blog/authenticating-users-in-your-vr-apps/</link>
      <description>Join Auth0‚Äôs open discussion on IdP-neutral experiences</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> Despite the recent spike in adoption, VR (Virtual Reality)  is still a new medium. Many VR apps handle user authentication poorly, leaving users frustrated when trying to sign in to new apps. As part of our research for improving the developer and the user experience for VR authentication, we propose an incremental improvement approach for user authentication experience for VR and open the discussion on what it will take to achieve better IdP-neutral experiences.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6vQj9zOTzDRYSLfaU5QPz4/ecd2d02a29146a32a65bfe7a5d2290b4/VR_Authentication_Separator_01.jpg" alt="VR"/></p><h2 id="VR-Is-Accelerating--AR-Is-Next">VR Is Accelerating; AR Is Next</h2><p>It‚Äôs not very common for sci-fi tropes to actually come true in our lifetimes (‚Äúwhere is my flying car?‚Äù), but it looks like it‚Äôs happening to Virtual Reality (VR).</p><p>Thirty years ago, VR was a thing <a href="https://en.wikipedia.org/wiki/Snow_Crash" target="_blank" rel="noreferrer noopener">on the pages of Neal Stephenson</a> or at <a href="https://www.imdb.com/title/tt0104692/" target="_blank" rel="noreferrer noopener">the movies</a>. The Oculus Quest 2, a standalone VR headset priced at less than half of a modern gaming console, was <a href="https://uploadvr.com/vr-player-sales-numbers-christmas-2021/" target="_blank" rel="noreferrer noopener">one of the must-have gadgets of the holiday season 2021</a> ‚Äî  accelerating a run that <a href="https://www.theverge.com/2021/11/16/22785469/meta-oculus-quest-2-10-million-units-sold-qualcomm-xr2" target="_blank" rel="noreferrer noopener">has been going strong</a> since its release date. With Meta‚Äôs <a href="https://www.nytimes.com/2022/02/02/technology/meta-facebook-earnings-metaverse.html" target="_blank" rel="noreferrer noopener">increasing investment in the Metaverse</a>, this adoption is only likely to continue.</p><p>The distribution and price point have been an absolute boon for developers, in particular for <a href="https://uploadvr.com/beat-saber-100-million-revenue/" target="_blank" rel="noreferrer noopener">game developers</a>, who are increasingly targeting VR users with their products. The COVID-19 pandemic resulted in forced isolation, social distancing, and increased remote work, all of which inspired a brand new wave of immersive collaboration and social networking tools (<a href="https://www.oculus.com/workrooms/" target="_blank" rel="noreferrer noopener">Workrooms</a> and <a href="https://www.oculus.com/horizon-worlds/" target="_blank" rel="noreferrer noopener">Horizon</a> are just two examples of the many apps in those new categories). Job training, fitness, even therapy are among the other categories emerging as applications that can really benefit from the new medium.</p><p>There are signs suggesting that this is only the beginning. Meta seems to be on top of today‚Äôs VR market, but it‚Äôs clear that they will soon face formidable competitors. Apple, Google, and Snapchat are reported to be working on VR and augmented reality (AR) headsets of their own. </p><p>AR has the potential to be an even bigger revolution than smartphones, bringing a semantic layer on top of everyday reality, and today‚Äôs development tools for VR can be used to target AR as well. It‚Äôs no wonder that new VR applications are proliferating in greater numbers every day.</p><h2 id="Authentication-in-Today-s-VR-Apps">Authentication in Today‚Äôs VR Apps</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5QsE9ukCu08loeF2EDwOcK/b11bca059ca67b1f59bd1a530e42f265/Uploaded_from_Authenticating_Users_in_Your_VR_Apps" alt="Authentication"/></p><p>At first glance, one might think that developing apps for VR is a big technical challenge. As it turns out, developing an app that can run on a VR headset is surprisingly easy.</p><p>VR headsets were first popularized and remain primarily used as gaming devices with a blossoming developer community. The gaming industry created extraordinary tools such as the <a href="https://unity.com/" target="_blank" rel="noreferrer noopener">Unity game engine</a> and development platform. Unity began in 2005 and is now a comprehensive ecosystem with creator tools, a vibrant community, and abundant content that makes it easy (and free for indie developers) to create 3D games targeting PC, consoles, iOS, and Android.</p><p>VR headset manufacturers such as Meta and Google (Google pioneered the <a href="https://developers.google.com/cardboard/develop/unity/quickstart" target="_blank" rel="noreferrer noopener">cardboard headset class</a>) leveraged Unity‚Äôs popularity, releasing SDKs that make it very easy to retarget existing and new apps to their hardware and expose the special capabilities of the VR environment through primitives compatible with the Unity API.</p><p>Having the tools to easily make an existing app run in VR, however, doesn‚Äôt necessarily mean that its experience in VR will be good as-is! Let‚Äôs pick a concrete example: the authentication experience. </p><p>Games and apps originally designed to run on a desktop can rely on a vastly different arsenal of affordances: full keyboards, password managers, the ability to switch between your app and a system browser... all those things are either problematic or impossible in VR at the moment.</p><div><p><img src="https://fast.wistia.com/embed/medias/fj6ynu3c7l/swatch" alt=""/></p></div><p>A typical experience today: you put your headset on, use one controller or basic hand tracking to open an app for the first time, and you are prompted by a floating username and password dialog. Imagine you have a large poster in front of you, right under that dialog, with the picture of a keyboard. To type, you have to point at each key with a laser pointer and pull a trigger. Think about the length and complexity of the passwords you normally use and imagine having to type those using that technique. What‚Äôs worse, if you use a password manager, you are unlikely to even know the password. The result is a very tedious process requiring several cycles of lookup and error-prone input, which can leave the user frustrated right when the enthusiasm for a new game should be at its highest.</p><p>It is very likely that some of those VR dialogs are literally the same classes developed for the desktop versions of the app, given that the password characters are shielded by asterisks ‚Äî a measure that makes no sense in VR, given that no one will be peeking above your shoulder. As an industry, we can definitely do better than that.</p><blockquote><a href="https://twitter.com/intent/tweet?text=&#34;It%20is%20abundantly%20clear%20that%20a%20viable%20vendor-neutral%20authentication%20experience%20for%20VR%20apps%20is%20necessary%20to%20maximize%20market%20reach%20and%20simplify%20the%20user%20experience.&#34; via @auth0 https://auth0.com/blog/authenticating-users-in-your-vr-apps" target="_blank" rel="noopener noreferrer"><p>&#34;It is abundantly clear that a viable vendor-neutral authentication experience for VR apps is necessary to maximize market reach and simplify the user experience.&#34;</p><div><p><img alt="Tweet" src="https://cdn.auth0.com/blog/resources/twitter.svg"/></p><h4>Tweet This</h4></div></a></blockquote><p>Apps developed for a particular VR ecosystem can leverage the accounting system imposed by the manufacturer (e.g., Oculus users must use a Facebook account to interact with the store, notifications, etc.), and in that case, the app can usually SSO with that account. On the other hand, apps are often multiplatform, requiring the use of more portable identities ‚Äî and many users won‚Äôt tolerate being forced into specific account choices, as illustrated by the <a href="https://www.forbes.com/sites/kateoflahertyuk/2021/07/04/facebook-just-gave-1-million-oculus-users-a-reason-to-leave/?sh=21d0007676f5" target="_blank" rel="noreferrer noopener">fierce Facebook backlash</a>. When they announced the aforementioned policy. It is abundantly clear that a viable vendor-neutral authentication experience for VR apps is necessary to maximize market reach and simplify the user experience.</p><h2 id="An-Incremental-Improvement--The-OAuth-2-Device-Grant">An Incremental Improvement: The OAuth 2 Device Grant</h2><p>No full keyboard, no password managers, no browser‚Ä¶ does that sound familiar? That‚Äôs right, Smart TVs and set-top boxes! As an industry, we already faced the problem of performing user authentication on input-constrained devices when Smart TVs began natively supporting apps like Netflix, Prime Video, and other meant-for-the web streaming services. A popular solution that emerged in that scenario is the <a href="https://datatracker.ietf.org/doc/html/rfc8628" target="_blank" rel="noreferrer noopener">OAuth 2 device grant</a>. You can find a simple explanation of the flow <a href="https://auth0.com/device-flow/" target="_blank" rel="noreferrer noopener">here</a>. </p><p>In a nutshell, the input-constrained device (let‚Äôs call it A) that needs the user to authenticate provides a random code and a URL and starts polling an authentication service in the background. The user grabs a fully capable device (typically a smartphone or a laptop; let‚Äôs call it B), opens a browser, navigates to the supplied URL, enters the code, and performs whatever authentication is required without the restrictions that would have made the operation hard or impossible on device A. As soon as the user is authenticated on device B, device A automatically receives the necessary tokens, stops polling, and voila! Your Smart TV can now access your Netflix subscription on your behalf.</p><p>Our Auth0 Lab team wondered if we could use the same mechanism to perform authentication in VR, where A is the VR headset and B is your phone or computer. We tried it out and learned that, yes, we can! Given that the OAuth2 device grant is an established standard, the solution could also work with any service supporting it- nicely aligning with our vendor-neutral goals.</p><p>Here‚Äôs a quick video demonstrating the approach in action:</p><div><p><img src="https://fast.wistia.com/embed/medias/ytronwej0y/swatch" alt=""/></p></div><p>Pretty cool, huh? There is, unfortunately, a minor complication: whereas your smart TV and your phone (let‚Äôs pick that as our sample authentication device) are both in your living room, your VR app and your phone live in quite literally different realities. The code and URL prompt of the device grant are displayed by your headset, but while you are wearing it, you can‚Äôt really see your phone, not well enough to open a browser, navigate to a URL and enter a code. </p><p>To do all that, you have to lift the headset and look at the phone directly. And given that neither the URL nor the code are particularly short, you might need to do it more than once before you‚Äôll be done. That is very far from ideal. </p><p>However, let‚Äôs remember what our baseline is: having to laser-pointer in VR a long, complicated password we don‚Äôt know by heart. That would also require us to peek outside of the headset multiple times to read that password from our phone, probably more times given the length and random nature of passwords, and enter it through a far more awkward input method (e.g., every special character or uppercase letter requires at least lasering the shift key before hitting the actual key) than you‚Äôd do entering a short URL and code in your phone. It bears restating: the device code grant in VR isn‚Äôt an ideal, ultimate solution, but we believe that it could offer an incrementally better experience than the current use of passwords. </p><h2 id="The-Experiment--The-Auth0-Unity-SDK">The Experiment: The Auth0 Unity SDK</h2><p>In the typical pragmatic Auth0 style, we decided we wanted to get our hands dirty with the approach and make it easy for you to do the same. Our Auth0 Lab team put together an experimental SDK (Software Development Kit), the Auth0 Lab Unity SDK, that makes it easy to add device grant style authentication to your VR apps (and to Unity apps in general).</p><p>Here‚Äôs what the development experience looks like:</p><ul><li>Let&#39;s assume you already have your Unity app with the Oculus integration in place.</li><li>You start by downloading the unity package from Github: <a href="https://github.com/auth0-lab/auth0-unity" target="_blank" rel="noreferrer noopener">https://github.com/auth0-lab/auth0-unity</a>.</li><li>Then you import it as a Custom Package (see Option 2 of Setup in the Github Readme).</li><li>Once imported, you&#39;ll find the Auth0 Lab Unity SDK content in your assets under the AuthO folder.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5lksYXy0FQsVL9co8y9d4e/984468d2b1ac780a2a322400fe804265/Uploaded_from_Authenticating_Users_in_Your_VR_Apps" alt="Experiment"/></p><p>Put simply; the Auth0 Unity SDK packs the Auth0 .NET client SDK, some scripts that make it easy to handle the device flow and token persistence/lifecycle via Unity, and ready to use prefabs that make it a breeze to add the authentication experience in VR.</p><p>The easiest prefab to use is <code>DeviceFlowPrompt</code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1mGFE6Wg2Ijcpi4geUySpi/7981d2f3ad7f44e7687bb09428192516/Uploaded_from_Authenticating_Users_in_Your_VR_Apps" alt="Experiment"/></p><p>The <code>DeviceFlowPrompt</code> prefab contains a canvas and all the basic UX elements you need to initiate the device grant experience, all wired up to the underlying token request, validation, and storage logic. All you need to do from the scene perspective is to decide when to activate it and wire it up to your camera and UI interaction elements.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/tf40JMEih8e6NkWxX1tfk/977624021d06592fca7c931f6b8b9063/Uploaded_from_Authenticating_Users_in_Your_VR_Apps" alt="Experiment"/></p><p>From the identity setup perspective, all you need to do is to configure the SDK with the domain of your Auth0 tenant and the client id of your app. You do so by filling the blanks in the <code>AuthManager<span>.</span>cs</code> script:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3wClaqEAdpI3zA6uLZTiu8/67ea8889fac91cd2f07d5260d1906e23/Uploaded_from_Authenticating_Users_in_Your_VR_Apps" alt="Experiment"/></p><p>...and that‚Äôs all there is to it! </p><blockquote><a href="https://twitter.com/intent/tweet?text=&#34;In%20just%20a%20couple%20of%20steps%2C%20you%20can%20initiate%20authentication%20from%20within%20your%20VR%20app%2C%20signing%20in%20with%20any%20identity%20provider%20you%20configured%20for%20your%20app%20in%20the%20Auth0%20tenant.&#34; via @auth0 https://auth0.com/blog/authenticating-users-in-your-vr-apps" target="_blank" rel="noopener noreferrer"><p>&#34;In just a couple of steps, you can initiate authentication from within your VR app, signing in with any identity provider you configured for your app in the Auth0 tenant.&#34;</p><div><p><img alt="Tweet" src="https://cdn.auth0.com/blog/resources/twitter.svg"/></p><h4>Tweet This</h4></div></a></blockquote><p>The Auth0 Lab Unity SDK will persist your tokens and make them available, alongside user claims, whenever you reopen your app ‚Äî the SDK will ensure that tokens are still valid, will automatically retrieve fresh ones via refresh tokens, and in general, keep offering identity related functions until you hit sign out.</p><p>If you want to exercise more control over the look and feel of the authentication dialog, or if you want to target non-VR Unity apps, all you need to do is to use the other prefab, <code>DeviceFlowRaw</code>, or work with scripts directly. The <a href="https://github.com/auth0-lab/auth0-unity-sdk" target="_blank" rel="noreferrer noopener">Auth0 Lab Unity SDK readme on github</a> has more details.</p><h2 id="Next-Steps">Next Steps</h2><p>VR and AR are very important platforms, with huge disruption potential for both consumer and enterprise markets. Although it‚Äôs still relatively early, the development tools used to target those platforms are well established ‚Äî hence we wanted to start a conversation about authentication in that space in very concrete terms by offering the experimental Auth0 Lab Unity SDK for you to experience firsthand opportunities and limitations of tooling today. </p><p>The Auth0 Lab has a <a href="http://discord.gg/XbQpZSF2Ys" target="_blank" rel="noreferrer noopener">discord server</a> where we have conversations about our experiments, and we hope you will <a href="http://discord.gg/XbQpZSF2Ys" target="_blank" rel="noreferrer noopener">join us there</a> to discuss IdP-neutral authentication in VR and in Unity in general.</p><p>The device grant is an incremental improvement in respect to having to laser-point a password you don‚Äôt know on a virtual billboard, but it‚Äôs also clear that it ought not to be the endgame when it comes to authentication experience in VR. Entering a validation URL and a code in the phone is not a great experience, even if you manage to do so without taking the headset off by looking through the nose gap.</p><p>We can expect improvements in the VR password experience, such as roaming password managers and better system browser integration, but those will be partial solutions as well.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/24nEvUEvlu7WsrvtqHNOZS/0c785a67498d458ebc14daaec652560d/VR_Authentication_Separator_02.jpg" alt="VR"/></p><p>Alternatives available today, such as magic links, codes, etc., all suffer from the same flaw- they don‚Äôt enforce proximity between the headset and the authenticating device, raising the risk of phishing-related abuses.</p><p>Bluetooth and (eventually) NFC are technically viable to initiate authentication from the headset to an authenticating device, but without a standard profile that would require a dedicated app on the authenticating device, limiting adoption and interoperability. The pressure toward proprietary, integrated stack solutions is very strong in this phase of the technology foundations of the metaverse, but we believe ‚Äîas always ‚Äî in the power of open standards as a tool to help everyone benefit. Our hope is that by providing the tools to easily add authentication in VR apps with what‚Äôs possible today, we will facilitate the requirements gathering and discussion of what we want the experience to be tomorrow.</p><p>Now the ball is in your court. Is IdP-neutral authentication needed in VR? How should authentication in VR evolve? Let‚Äôs start a <a href="http://discord.gg/XbQpZSF2Ys" target="_blank" rel="noreferrer noopener">conversation</a>. We can‚Äôt wait to see what innovative, amazing experiences you‚Äôll create in this new medium!</p></div></div>]]></content:encoded>
      <pubDate>Wed, 16 Mar 2022 18:13:00 +0000</pubDate>
    </item>
    <item>
      <title>Celebrating AmeriCorps Week - What It‚Äôs Meant to Me</title>
      <link>https://auth0.com/blog/celebrating-americorps-week-what-it-s-meant-to-me/</link>
      <description>Expansion Year(s): 10 years post AmeriCorps</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><blockquote><p>Jessica Keaton, our Social Impact Employee Programs and Engagement leader is kicking off a series about the Auth0.org team and how we got here. I hope it‚Äôs both interesting and motivational for individuals looking to apply their skills from other professional backgrounds into roles and programs focused on contributing positively to society and the world.
<em>- Peter Wheeler</em></p></blockquote><p>‚ÄúYou‚Äôll never get back on track if you take a gap year.‚Äù I rolled my eyes, hearing this sentiment after sharing news that I would be joining AmeriCorps National Service after college. I was determined to give back through national service. My year turned into two and yielded a wide swath of learnings, and spoiler alert: I was better off for it! </p><h2 id="Getting-Things-Done">Getting Things Done</h2><p>As a member of the AmeriCorps St. Louis Emergency Response Team, I learned how to chainsaw and cut down trees to preserve national parks. I fought wildland fires and worked to save structures from destruction. I responded to natural disasters as they hit across the country. All of these experiences were things I never believed I would do in my lifetime. By virtue of stepping outside my comfort zone, I was able to expand my knowledge base, my worldview, and my skill set in one fell swoop. I fiercely collaborated and worked with my teammates to keep everyone safe to work on ‚Äúgetting things done‚Äù- my favorite AmeriCorps saying. </p><h2 id="Relearning-Education---A-New-Approach">Relearning Education / A New Approach</h2><p>My second year allowed me to get things done in a different but equally impactful setting; I taught literacy to kindergarten students on the Education Team. I quickly learned that students carry much more to a school than just their backpacks, and this ultimately inspired my decision to pursue a graduate degree in social work. A small group of AmeriCorps members worked together in a converted room at the school and helped as many students as our days would allow. My colleague had a student that was experiencing separation anxiety when her mother would drop her off at school. She tried a slew of things, but nothing seemed to stop her crying each morning and much into the day, which was taking a devastating toll on her learning time. One day, my colleague walked in with a small figurine. We all asked her what it was and why she brought it to work. She explained, ‚ÄúI thought if I made a doll that looked like my student‚Äôs mom, she would have something to remind her of home during the school day.‚Äù This incredibly thoughtful gesture worked for the student, and she slowly was able to transition from home to school quicker and engage with learning better. </p><h2 id="Applying-What-I-Learned">Applying What I Learned</h2><p>The experiences I had with AmeriCorps still translate into my day-to-day interactions in the workforce. I take these learnings with me as I navigate life and work:</p><ul><li><em>You can achieve more than you think you can.</em> From being someone who had never gone on a hike to hiking 14+ miles a day starts with just one step. Cultivate your growth mindset, and you‚Äôll flourish in the face of adversity.</li><li><em>When you think you‚Äôve exhausted all of your options, try one more thing.</em> Tenacity will help you continue on even when others have given up. One more thing could be opening 15 cans of vegetables and beans and putting them into a pot for a low-cost team dinner. (I‚Äôve done that, and it turned out surprisingly delicious)</li><li><em>Your team is your extra lifeline through the good and the bad.</em> You stand together eating smoke on the fire line, but you also stand together enjoying the hot springs on your off day.</li><li><em>Meet people where they are.</em> The doll worked because it was tangible for the kindergarten student to understand and enjoy. I imagine she also felt seen and cared for. Imagine if that translated into our work lives? We would all be unstoppable!</li></ul><p>My experiences are not unique-there are millions of changemakers giving their all to support the communities they serve. I‚Äôve shifted the term from gap year to expansion year. My mind and life was expanded exponentially through the work I completed, the people I met, and the lessons I learned. AmeriCorps will always hold a special place in my heart and my story. </p><h2 id="How-You-Can-Get-Things-Done">How You Can Get Things Done</h2><p>If you are considering an expansion year, this is your sign to join the thousands of<a href="https://americorps.gov/" target="_blank" rel="noreferrer noopener"> AmeriCorps</a> volunteers. If you‚Äôve served or are serving with AmeriCorps, share your #expansionyear story, so we can celebrate you! </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3DDQJWyUSYDWq2XOgq4cNp/48408a39d0c9caeb03c5089ab2cbafd5/04.png" alt="AmeriCorps"/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/imzTM9980KjN7JOlfnurs/b775ce09dcbd477e287a5e5c3683aaca/05.jpg" alt="AmeriCorps"/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1vPtygIFcG59QmocyOwOpd/dcc721b8712222f116ed9be1e32cabc0/06.jpg" alt="AmeriCorps"/></p></div></div>]]></content:encoded>
      <pubDate>Tue, 15 Mar 2022 16:15:00 +0000</pubDate>
    </item>
    <item>
      <title>Introducing Spring Native for JHipster: Serverless Full-Stack Made Easy</title>
      <link>https://auth0.com/blog/spring-native-jhipster/</link>
      <description>The newly released JHipster Native blueprint allows you to generate springboot projects with Spring Native support.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Over the years, I‚Äôve developed a lot of Java applications. I started writing Java code in the late 90s and spent several years doing Java before I tried another server-side language. I was impressed when I first tried building apps in Ruby on Rails, Python, and Node.js - they all started super-fast!</p><p>Starting fast is cool, but we in the Java community have often asked, does it perform over time? The Java Virtual Machine is famous for performance and optimization over time.</p><p>I scoffed at serverless when it first came out. Mostly because I was a Java developer, and my apps didn‚Äôt start in milliseconds. They also used a whole lotta memory, and there was no hope in sight.</p><p>Then, along came <a href="https://www.graalvm.org/" target="_blank" rel="noreferrer noopener">GraalVM</a>. It‚Äôs gained support from many Java frameworks in the last few years and has made their apps start in milliseconds!</p><p>Today, I‚Äôm proud to announce that this same capability is now available for your JHipster 7+ apps!</p><p><strong>Prerequisites</strong>:</p><ul><li><a href="https://sdkman.io/" target="_blank" rel="noreferrer noopener">Java 17 with GraalVM</a>+</li><li><a href="https://docs.docker.com/desktop/#download-and-install" target="_blank" rel="noreferrer noopener">Docker Desktop</a></li></ul><br/><h2 id="Why-Should-You-Care-about-Serverless-">Why Should You Care about Serverless?</h2><p>From <a href="https://www.ibm.com/cloud/learn/serverless" target="_blank" rel="noreferrer noopener">IBM‚Äôs What is Serverless computing?</a></p><blockquote><p>Serverless is a cloud execution model that enables a simpler, more cost-effective way to build and operate cloud-native applications.</p></blockquote><p>That‚Äôs it!</p><p>For companies with high traffic and large cloud bills, serverless makes sense. They can save millions of dollars a month.</p><h2 id="GraalVM-Allows-Serverless-Java-for-Everyone-">GraalVM Allows Serverless Java for Everyone!</h2><p>I‚Äôve been playing with GraalVM and the Java frameworks that support it for around 18 months. After doing a lot of research, I blogged about <a href="https://developer.okta.com/blog/2021/06/18/native-java-framework-comparison" target="_blank" rel="noreferrer noopener">building native Java apps with Micronaut, Quarkus, and Spring Boot</a>.</p><p>In September 2021, I did a talk with Josh Long about Spring Native with JHipster at the San Francisco JUG.</p><blockquote><p lang="en" dir="ltr">Let the games begin with <a href="https://twitter.com/starbuxman?ref_src=twsrc%5Etfw" target="_blank" rel="noreferrer noopener">@starbuxman</a>! <a href="https://twitter.com/hashtag/Java?src=hash&amp;amp;ref_src=twsrc%5Etfw" target="_blank" rel="noreferrer noopener">#Java

</a><a href="https://twitter.com/hashtag/SpringNative?src=hash&amp;amp;ref_src=twsrc%5Etfw" target="_blank" rel="noreferrer noopener">#SpringNative

</a><a href="https://twitter.com/hashtag/JHipster?src=hash&amp;amp;ref_src=twsrc%5Etfw" target="_blank" rel="noreferrer noopener">#JHipster

</a><a href="https://t.co/0KSRTd89e5" target="_blank" rel="noreferrer noopener">pic.twitter.com/0KSRTd89e5</a></p><p>‚Äî Matt Raible (@mraible) <a href="https://twitter.com/mraible/status/1442698739563446276?ref_src=twsrc%5Etfw" target="_blank" rel="noreferrer noopener">September 28, 2021</a></p></blockquote><p>I flew out on a Monday; we got everything working by Wednesday afternoon and then spoke about our experience on Wednesday night. I wrote about it in <a href="https://www.linkedin.com/pulse/jhipster-works-spring-native-matt-raible/" target="_blank" rel="noreferrer noopener">JHipster Works with Spring Native!</a> on LinkedIn and created a <a href="https://github.com/jhipster/generator-jhipster/issues/16498" target="_blank" rel="noreferrer noopener">JHipster issue</a> to automate our learnings.</p><h2 id="What-is-Spring-Native-">What is Spring Native?</h2><p>Spring Native provides an API to configure Spring Boot and GraalVM, so classes that are not easily discoverable become recognizable. For example, those that are instantiated using reflection. It‚Äôs a really slick extension to Spring Boot and will likely disappear with Spring Boot 3 because it‚Äôll be native by default.</p><p>As a result of our successful <a href="https://youtu.be/F9oydL_MndA" target="_blank" rel="noreferrer noopener">presentation at the SF JUG</a>, Josh and I were invited to speak at the Garden State JUG in December. We laid low for a few months and rekindled our research in December. I wrote about it in <a href="https://www.linkedin.com/pulse/jhipster-works-spring-native-part-2-matt-raible/" target="_blank" rel="noreferrer noopener">JHipster works with Spring Native, Part 2!</a></p><h2 id="---Announcing-the-JHipster-Native-Blueprint-">üî• Announcing the JHipster Native Blueprint!</h2><p>In late January 2022, we (the JHipster team) upgraded JHipster to use Spring Boot 2.6 and released version <a href="https://www.jhipster.tech/2022/01/23/jhipster-release-7.6.0.html" target="_blank" rel="noreferrer noopener">7.6.0</a>.</p><p>In early February, I updated <a href="https://github.com/mraible/spring-native-examples" target="_blank" rel="noreferrer noopener">the Spring Native with JHipster examples</a> that Josh and I‚Äôd been using for research. I was ready to start automating the Spring Native integration using a JHipster module. When <a href="https://github.com/jhipster/generator-jhipster/issues/16498#issuecomment-1030263905" target="_blank" rel="noreferrer noopener">I asked the JHipster team</a> about the best way to implement it, <a href="https://github.com/mshima" target="_blank" rel="noreferrer noopener">Marcelo Shima</a> volunteered to create the initial blueprint.</p><p>This was on a Friday afternoon (Mountain Time or MT). By the next morning, Marcelo had the MVP finished and provided steps to reproduce our examples. üò≥</p><p>I was amazed! I remember telling (my partner) Trish that he‚Äôd done a week‚Äôs worth of (my estimated) work in a matter of hours.</p><p>Today, I‚Äôm proud to announce the <a href="https://github.com/jhipster/generator-jhipster-native" target="_blank" rel="noreferrer noopener">JHipster Native blueprint</a> is available! Here‚Äôs how to use it:</p><pre><code>npm install <span>-</span>g generator<span>-</span>jhipster<span>-</span>native@<span>1.0</span>
jhipster<span>-</span>native</code></pre><p>This will generate a JHipster app and integrate GraalVM automatically. You can build and run a native image with the following commands:</p><pre><code><span>.</span><span>/</span>mvnw <span>package</span> <span>-</span>Pnative<span>,</span>prod <span>-</span>DskipTests
npm run ci<span>:</span>e2e<span>:</span>prepare # start docker dependencies
<span>.</span><span>/</span>target<span>/</span>native<span>-</span>executable</code></pre><p>Gradle is not currently an option, but it can be if we add support to the JHipster Native blueprint.</p><h2 id="Go-Native-with-Spring-Native-and-GraalVM">Go Native with Spring Native and GraalVM</h2><p>To see Spring Native + JHipster in action, let‚Äôs look at a <a href="https://auth0.com/blog/full-stack-java-with-react-spring-boot-and-jhipster/" target="_blank" rel="noreferrer noopener">previous JHipster app I created for the Auth0 blog</a>. First, clone the example:</p><pre><code>git clone https<span>:</span><span>/</span><span>/</span>github<span>.</span>com<span>/</span>oktadev<span>/</span>auth0<span>-</span>full<span>-</span>stack<span>-</span>java<span>-</span>example<span>.</span>git jhipster<span>-</span>native
cd jhipster<span>-</span>native</code></pre><p>Want results right away? Clone the <code>spring<span>-</span>native</code> branch with the changes below already made:</p><pre><code>git clone <span>-</span>b spring<span>-</span>native https<span>:</span><span>/</span><span>/</span>github<span>.</span>com<span>/</span>oktadev<span>/</span>auth0<span>-</span>full<span>-</span>stack<span>-</span>java<span>-</span>example<span>.</span>git jhipster<span>-</span>native</code></pre><p>Then, skip to the <a href="#Configure-Your-OpenID-Connect-Identity-Provider">Configure your OpenID Connect identity provider</a> section to continue.</p><p>Install JHipster 7.7.0 and the JHipster Native blueprint:</p><pre><code>npm i <span>-</span>g generator<span>-</span>jhipster@<span>7.7</span>
npm i <span>-</span>g generator<span>-</span>jhipster<span>-</span>native@<span>1.0</span></code></pre><p>Then, remove all the existing project files and regenerate them. The <code>jhipster<span>-</span>native</code> command includes parameters to disable caching because it‚Äôs not supported by Spring Native yet.</p><pre><code>rm <span>-</span>rf <span>*</span>
jhipster<span>-</span>native <span>--</span><span>with</span><span>-</span>entities <span>--</span>cache<span>-</span>provider no <span>--</span>no<span>-</span>enable<span>-</span>hibernate<span>-</span>cache
# When prompted to overwrite <span>.</span>gitignore<span>,</span> type <span>&#34;a&#34;</span> to overwrite all files</code></pre><p>If you open the project in IntelliJ IDEA, you can use the <strong>Commit Tools Window</strong> (‚åò+0 on macOS or Ctrl+0 on Linux/Windows) to view files that changed.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6WXqAwFxjy0G0983LRBonL/fa7aa51acef38b8d26918622b495cfba/01-commit-tools-window.jpeg" alt="JHipster"/></p><p>Next, run the following <code>git checkout</code> commands to restore the files that were modified in the original example.</p><pre><code>git checkout <span>.</span>gitignore
git checkout <span>README</span><span>.</span>md
git checkout demo<span>.</span>adoc
git checkout flickr2<span>.</span>jdl
git checkout screenshots
git checkout src<span>/</span>main<span>/</span>webapp<span>/</span>app<span>/</span>entities<span>/</span>photo<span>/</span>photo<span>.</span>tsx
git checkout src<span>/</span>main<span>/</span>webapp<span>/</span>app<span>/</span>entities<span>/</span>photo<span>/</span>photo<span>-</span>update<span>.</span>tsx
git checkout src<span>/</span>main<span>/</span>java<span>/</span>com<span>/</span>auth0<span>/</span>flickr2<span>/</span>config<span>/</span>SecurityConfiguration<span>.</span>java
git checkout src<span>/</span>main<span>/</span>resources<span>/</span>config<span>/</span>application<span>-</span>heroku<span>.</span>yml
git checkout src<span>/</span>main<span>/</span>resources<span>/</span>config<span>/</span>bootstrap<span>-</span>heroku<span>.</span>yml
git checkout Procfile
git checkout system<span>.</span>properties</code></pre><p>If you‚Äôd rather not use the command line, you can right-click on each file and select <strong>Rollback</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1qtRcpu4RZIK3bmyW4Iijr/5a9df8c695d23e3cd01a13eba0867d44/02-rollback-commit.png" alt="JHipster"/></p><p>If you ran the <code>git checkout</code> commands, there are several changes I made in the first tutorial that‚Äôll need to be re-applied:</p><ol start="1"><li>In <code>src<span>/</span>main<span>/</span>resources<span>/</span>config<span>/</span>application<span>-</span>dev<span>.</span>yml</code>, remove the <code>faker</code> profile for Liquibase.</li><li>In <code>pom<span>.</span>xml</code>, re-add Drew Noake‚Äôs <code>metadata<span>-</span>extractor</code> library:</li></ol><pre><code>    <span>&lt;</span>groupId<span>&gt;</span>com<span>.</span>drewnoakes<span>&lt;</span><span>/</span>groupId<span>&gt;</span>
    <span>&lt;</span>artifactId<span>&gt;</span>metadata<span>-</span>extractor<span>&lt;</span><span>/</span>artifactId<span>&gt;</span>
    <span>&lt;</span>version<span>&gt;</span><span>2.16</span><span>.0</span><span>&lt;</span><span>/</span>version<span>&gt;</span></code></pre><ol start="3"><li>Next, modify the <code><span>createPhoto</span><span>(</span><span>)</span></code> method in <code>src<span>/</span>main<span>/</span>java<span>/</span>com<span>/</span>auth0<span>/</span>flickr2<span>/</span>web<span>/</span>rest<span>/</span>PhotoResource<span>.</span>java</code> to set the metadata when an image is uploaded.</li></ol><pre><code><span>import</span> com<span>.</span>drew<span>.</span>imaging<span>.</span>ImageMetadataReader<span>;</span>
<span>import</span> com<span>.</span>drew<span>.</span>imaging<span>.</span>ImageProcessingException<span>;</span>
<span>import</span> com<span>.</span>drew<span>.</span>metadata<span>.</span>Metadata<span>;</span>
<span>import</span> com<span>.</span>drew<span>.</span>metadata<span>.</span>MetadataException<span>;</span>
<span>import</span> com<span>.</span>drew<span>.</span>metadata<span>.</span>exif<span>.</span>ExifSubIFDDirectory<span>;</span>
<span>import</span> com<span>.</span>drew<span>.</span>metadata<span>.</span>jpeg<span>.</span>JpegDirectory<span>;</span>

<span>import</span> javax<span>.</span>xml<span>.</span>bind<span>.</span>DatatypeConverter<span>;</span>
<span>import</span> java<span>.</span>io<span>.</span>BufferedInputStream<span>;</span>
<span>import</span> java<span>.</span>io<span>.</span>ByteArrayInputStream<span>;</span>
<span>import</span> java<span>.</span>io<span>.</span>IOException<span>;</span>
<span>import</span> java<span>.</span>io<span>.</span>InputStream<span>;</span>

<span>import</span> java<span>.</span>time<span>.</span>Instant<span>;</span>
<span>import</span> java<span>.</span>util<span>.</span>Date<span>;</span>

<span>public</span> <span>class</span> <span>PhotoResource</span> <span>{</span>
    <span>...</span>

    <span>public</span> ResponseEntity<span>&lt;</span>Photo<span>&gt;</span> <span>createPhoto</span><span>(</span>@Valid @RequestBody Photo photo<span>)</span> throws Exception <span>{</span>
        log<span>.</span><span>debug</span><span>(</span><span>&#34;REST request to save Photo : {}&#34;</span><span>,</span> photo<span>)</span><span>;</span>
        <span>if</span> <span>(</span>photo<span>.</span><span>getId</span><span>(</span><span>)</span> <span>!=</span> <span>null</span><span>)</span> <span>{</span> <span>...</span> <span>}</span>

        <span>try</span> <span>{</span>
            photo <span>=</span> <span>setMetadata</span><span>(</span>photo<span>)</span><span>;</span>
        <span>}</span> <span>catch</span> <span>(</span>ImageProcessingException <span>|</span> IOException <span>|</span> MetadataException ipe<span>)</span> <span>{</span>
            log<span>.</span><span>error</span><span>(</span>ipe<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>}</span>

        Photo result <span>=</span> photoRepository<span>.</span><span>save</span><span>(</span>photo<span>)</span><span>;</span>
        <span>...</span>
    <span>}</span>

    <span>private</span> Photo <span>setMetadata</span><span>(</span>Photo photo<span>)</span> throws ImageProcessingException<span>,</span> IOException<span>,</span> MetadataException <span>{</span>
        String str <span>=</span> DatatypeConverter<span>.</span><span>printBase64Binary</span><span>(</span>photo<span>.</span><span>getImage</span><span>(</span><span>)</span><span>)</span><span>;</span>
        byte<span>[</span><span>]</span> data2 <span>=</span> DatatypeConverter<span>.</span><span>parseBase64Binary</span><span>(</span>str<span>)</span><span>;</span>
        InputStream inputStream <span>=</span> <span>new</span> <span>ByteArrayInputStream</span><span>(</span>data2<span>)</span><span>;</span>
        BufferedInputStream bis <span>=</span> <span>new</span> <span>BufferedInputStream</span><span>(</span>inputStream<span>)</span><span>;</span>
        Metadata metadata <span>=</span> ImageMetadataReader<span>.</span><span>readMetadata</span><span>(</span>bis<span>)</span><span>;</span>
        ExifSubIFDDirectory directory <span>=</span> metadata<span>.</span><span>getFirstDirectoryOfType</span><span>(</span>ExifSubIFDDirectory<span>.</span>class<span>)</span><span>;</span>

        <span>if</span> <span>(</span>directory <span>!=</span> <span>null</span><span>)</span> <span>{</span>
            Date date <span>=</span> directory<span>.</span><span>getDateDigitized</span><span>(</span><span>)</span><span>;</span>
            <span>if</span> <span>(</span>date <span>!=</span> <span>null</span><span>)</span> <span>{</span>
                photo<span>.</span><span>setTaken</span><span>(</span>date<span>.</span><span>toInstant</span><span>(</span><span>)</span><span>)</span><span>;</span>
            <span>}</span>
        <span>}</span>

        <span>if</span> <span>(</span>photo<span>.</span><span>getTaken</span><span>(</span><span>)</span> <span>==</span> <span>null</span><span>)</span> <span>{</span>
            log<span>.</span><span>debug</span><span>(</span><span>&#34;Photo EXIF date digitized not available, setting taken on date to now...&#34;</span><span>)</span><span>;</span>
            photo<span>.</span><span>setTaken</span><span>(</span>Instant<span>.</span><span>now</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>}</span>

        photo<span>.</span><span>setUploaded</span><span>(</span>Instant<span>.</span><span>now</span><span>(</span><span>)</span><span>)</span><span>;</span>

        JpegDirectory jpgDirectory <span>=</span> metadata<span>.</span><span>getFirstDirectoryOfType</span><span>(</span>JpegDirectory<span>.</span>class<span>)</span><span>;</span>
        <span>if</span> <span>(</span>jpgDirectory <span>!=</span> <span>null</span><span>)</span> <span>{</span>
            photo<span>.</span><span>setHeight</span><span>(</span>jpgDirectory<span>.</span><span>getImageHeight</span><span>(</span><span>)</span><span>)</span><span>;</span>
            photo<span>.</span><span>setWidth</span><span>(</span>jpgDirectory<span>.</span><span>getImageWidth</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>}</span>

        <span>return</span> photo<span>;</span>
    <span>}</span>
    <span>...</span></code></pre><ol start="4"><li>Install the React libraries needed:</li></ol><pre><code>npm i react<span>-</span>photo<span>-</span>gallery@<span>8</span> <span>--</span>force`
npm i react<span>-</span>images</code></pre><ol start="5"><li>In <code>src<span>/</span>test<span>/</span>javascript<span>/</span>cypress<span>/</span>integration<span>/</span>entity<span>/</span>photo<span>.</span>spec<span>.</span>ts</code>, remove the code that sets the calculated data in the <code>should create an instance <span>of</span> Photo</code> test:</li></ol><pre><code>cy<span>.</span><span>get</span><span>(</span><span><span>`</span><span>[data-cy=&#34;height&#34;]</span><span>`</span></span><span>)</span><span>.</span><span>type</span><span>(</span><span>&#39;99459&#39;</span><span>)</span><span>.</span><span>should</span><span>(</span><span>&#39;have.value&#39;</span><span>,</span> <span>&#39;99459&#39;</span><span>)</span><span>;</span>
cy<span>.</span><span>get</span><span>(</span><span><span>`</span><span>[data-cy=&#34;width&#34;]</span><span>`</span></span><span>)</span><span>.</span><span>type</span><span>(</span><span>&#39;61514&#39;</span><span>)</span><span>.</span><span>should</span><span>(</span><span>&#39;have.value&#39;</span><span>,</span> <span>&#39;61514&#39;</span><span>)</span><span>;</span>
cy<span>.</span><span>get</span><span>(</span><span><span>`</span><span>[data-cy=&#34;taken&#34;]</span><span>`</span></span><span>)</span><span>.</span><span>type</span><span>(</span><span>&#39;2021-10-11T16:46&#39;</span><span>)</span><span>.</span><span>should</span><span>(</span><span>&#39;have.value&#39;</span><span>,</span> <span>&#39;2021-10-11T16:46&#39;</span><span>)</span><span>;</span>
cy<span>.</span><span>get</span><span>(</span><span><span>`</span><span>[data-cy=&#34;uploaded&#34;]</span><span>`</span></span><span>)</span><span>.</span><span>type</span><span>(</span><span>&#39;2021-10-11T15:23&#39;</span><span>)</span><span>.</span><span>should</span><span>(</span><span>&#39;have.value&#39;</span><span>,</span> <span>&#39;2021-10-11T15:23&#39;</span><span>)</span><span>;</span></code></pre><p>Then, you‚Äôll need to add type hints for Drew Noake‚Äôs EXIF processing library in <code>src<span>/</span>main<span>/</span>java<span>/</span>com<span>/</span>auth0<span>/</span>flickr2<span>/</span>Flickr2App<span>.</span>java</code>:</p><pre><code>@org<span>.</span>springframework<span>.</span>nativex<span>.</span>hint<span>.</span><span>TypeHint</span><span>(</span>
    types <span>=</span> <span>{</span>
        <span>...</span>
        com<span>.</span>drew<span>.</span>metadata<span>.</span>exif<span>.</span>ExifIFD0Directory<span>.</span>class<span>,</span>
        com<span>.</span>drew<span>.</span>metadata<span>.</span>exif<span>.</span>ExifSubIFDDirectory<span>.</span>class<span>,</span>
        com<span>.</span>drew<span>.</span>metadata<span>.</span>exif<span>.</span>ExifThumbnailDirectory<span>.</span>class<span>,</span>
        com<span>.</span>drew<span>.</span>metadata<span>.</span>exif<span>.</span>makernotes<span>.</span>AppleMakernoteDirectory<span>.</span>class<span>,</span>
        com<span>.</span>drew<span>.</span>metadata<span>.</span>exif<span>.</span>GpsDirectory<span>.</span>class<span>,</span>
<span>}</span><span>)</span>
@org<span>.</span>springframework<span>.</span>nativex<span>.</span>hint<span>.</span><span>NativeHint</span><span>(</span>options <span>=</span> <span>&#34;-H:+AddAllCharsets&#34;</span><span>)</span></code></pre><p>The <code>@<span>NativeHint</span><span>(</span>options <span>=</span> ‚Äú<span>-</span><span>H</span><span>:</span><span>+</span>AddAllCharsets‚Äù<span>)</span></code> solves the following exception that happens when you upload a photo:</p><pre><code>Caused by<span>:</span> java<span>.</span>nio<span>.</span>charset<span>.</span>UnsupportedCharsetException<span>:</span> Cp1252
    at java<span>.</span>nio<span>.</span>charset<span>.</span>Charset<span>.</span><span>forName</span><span>(</span>Charset<span>.</span>java<span>:</span><span>528</span><span>)</span> <span>~</span><span>[</span>native<span>-</span>executable<span>:</span>na<span>]</span>
    at com<span>.</span>drew<span>.</span>lang<span>.</span>Charsets<span>.</span><span>&lt;</span>clinit<span>&gt;</span><span>(</span>Charsets<span>.</span>java<span>:</span><span>40</span><span>)</span> <span>~</span><span>[</span>na<span>:</span>na<span>]</span></code></pre><p>Once you‚Äôve made all the changes (or cloned the <code>spring<span>-</span>native</code> branch), you can build your hip native binary.</p><h3 id="Build-a-Native-JHipster-App">Build a Native JHipster App</h3><p>You will need a JDK with GraalVM and its <code>native<span>-</span>image</code> compiler. Using SDKMAN, run the following command and set it as the default:</p><pre><code>sdk install java <span>21.3</span><span>.0</span><span>.</span>r17<span>-</span>grl</code></pre><p>Add the native extension to the JDK:</p><pre><code>gu install native<span>-</span>image</code></pre><p>Then, use Maven to build the project. Skip tests since there‚Äôs no support for Mockito at this time.</p><pre><code><span>.</span><span>/</span>mvnw <span>package</span> <span>-</span>Pnative<span>,</span>prod <span>-</span>DskipTests</code></pre><p>This process will take a few minutes to complete.</p><h2 id="Configure-Your-OpenID-Connect-Identity-Provider">Configure Your OpenID Connect Identity Provider</h2><p>When you generate a JHipster app with OAuth 2.0 / OIDC for authentication, it defaults to using Keycloak. It creates a <code>src<span>/</span>main<span>/</span>docker<span>/</span>keycloak<span>.</span>yml</code> file for Docker Compose, as well as a <code>src<span>/</span>main<span>/</span>docker<span>/</span>realm<span>-</span>config</code> directory with files to auto-create users and OIDC clients.</p><p>If you want to use Keycloak for your running app, start it with the following command:</p><pre><code>docker<span>-</span>compose <span>-</span>f src<span>/</span>main<span>/</span>docker<span>/</span>keycloak<span>.</span>yml up <span>-</span>d</code></pre><p>If you‚Äôd rather use Okta or Auth0, that‚Äôs possible too!</p><h4 id="Use-Okta-as-your-identity-provider">Use Okta as your identity provider</h4><p>Before you begin, you‚Äôll need a free Okta developer account. Install the <a href="https://cli.okta.com/" target="_blank" rel="noreferrer noopener">Okta CLI</a> and run <code>okta register</code>to sign up for a new account. If you already have an account, run <code>okta login</code>. Then, run <code>okta apps create jhipster</code>. Select the default app name, or change it as you see fit. Accept the default Redirect URI values provided for you.</p><details><summary>What does the Okta CLI do?</summary><p>The Okta CLI streamlines configuring a JHipster app and does several things for you:</p><ol start="1"><li>Creates an OIDC app with the correct redirect URIs:
<ul><li>login: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>login<span>/</span>oauth2<span>/</span>code<span>/</span>oidc</code> and <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8761</span><span>/</span>login<span>/</span>oauth2<span>/</span>code<span>/</span>oidc</code></li><li>logout: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span></code> and <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8761</span></code></li></ul></li><li>Creates <code><span>ROLE_ADMIN</span></code> and <code><span>ROLE_USER</span></code> groups that JHipster expects</li><li>Adds your current user to the <code><span>ROLE_ADMIN</span></code> and <code><span>ROLE_USER</span></code> groups</li><li>Creates a <code>groups</code> claim in your default authorization server and adds the user‚Äôs groups to it</li></ol><p><strong>NOTE</strong>: The <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8761</span><span>*</span></code> redirect URIs are for the JHipster Registry, which is often used when creating microservices with JHipster. The Okta CLI adds these by default.</p></details><p>You will see output like the following when it‚Äôs finished:</p><pre><code>Okta application configuration has been written to<span>:</span> <span>/</span>path<span>/</span>to<span>/</span>app<span>/</span><span>.</span>okta<span>.</span>env</code></pre><p>Run <code>cat <span>.</span>okta<span>.</span>env</code> (or <code>type <span>.</span>okta<span>.</span>env</code> on Windows) to see the issuer and credentials for your app. It will look like this (except the placeholder values will be populated):</p><pre><code><span>export</span> <span>SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_OIDC_ISSUER_URI</span><span>=</span><span>&#34;https://{yourOktaDomain}/oauth2/default&#34;</span>
<span>export</span> <span>SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_ID</span><span>=</span><span>&#34;{clientId}&#34;</span>
<span>export</span> <span>SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_SECRET</span><span>=</span><span>&#34;{clientSecret}&#34;</span></code></pre><p><strong>NOTE</strong>: You can also use the Okta Admin Console to create your app. See <a href="https://www.jhipster.tech/security/#okta" target="_blank" rel="noreferrer noopener">Create a JHipster App on Okta</a> for more information.</p><p>You‚Äôll need to source the <code><span>.</span>okta<span>.</span>env</code> file the Okta CLI creates to override the default Spring Security settings.</p><pre><code>source <span>.</span>okta<span>.</span>env</code></pre><p>If you‚Äôre on Windows, you can modify this file to use <code>set</code> instead of <code><span>export</span></code> and rename it to <code>okta<span>.</span>bat</code>. Then, run it with <code>okta<span>.</span>bat</code> from the command line.</p><p>Modify your existing <code><span>.</span>gitignore</code> file to have <code><span>*</span><span>.</span>env</code> so you don‚Äôt accidentally check in your secrets!</p><p><em>Skip to <a href="https://developer.okta.com/blog/2022/03/03/spring-native-jhipster#run-your-native-jhipster-app" target="_blank" rel="noreferrer noopener">Run your native JHipster app</a> if you‚Äôve configured your app for Okta and just want to see it running.</em></p><h4 id="Use-Auth0-as-your-identity-provider">Use Auth0 as your identity provider</h4><p>To switch from Keycloak to Auth0, override the Spring Security OAuth properties. You don‚Äôt even need to write any code!</p><p>To see how it works, create a <code><span>.</span>auth0<span>.</span>env</code> file in the root of your project, and fill it with the code below to override the default OIDC settings:</p><pre><code><span>export</span> <span>SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_OIDC_ISSUER_URI</span><span>=</span>https<span>:</span><span>/</span><span><span>/</span><span>&lt;your-auth0-domain&gt;</span><span>/</span></span>
<span>export</span> <span>SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_ID</span><span>=</span><span>&lt;</span>your<span>-</span>client<span>-</span>id<span>&gt;</span>
<span>export</span> <span>SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_SECRET</span><span>=</span><span>&lt;</span>your<span>-</span>client<span>-</span>secret<span>&gt;</span>
<span>export</span> <span>JHIPSTER_SECURITY_OAUTH2_AUDIENCE</span><span>=</span>https<span>:</span><span>/</span><span>/</span><span>&lt;</span>your<span>-</span>auth0<span>-</span>domain<span>&gt;</span><span>/</span>api<span>/</span>v2<span>/</span></code></pre><p>You‚Äôll need to create a new web application in Auth0 and fill in the <code><span>&amp;</span>lt<span>;</span>‚Ä¶‚Äã<span>&gt;</span></code> placeholders before this works.</p><h5 id="Create-an-OpenID-Connect-app-on-Auth0">Create an OpenID Connect app on Auth0</h5><p>Log in to your Auth0 account (or <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">sign up</a> if you don‚Äôt have an account). You should have a unique domain like <code>dev<span>-</span>xxx<span>.</span>eu<span>.</span>auth0<span>.</span>com</code>.</p><p>Press the <strong>Create Application</strong> button in the <a href="https://manage.auth0.com/#/applications" target="_blank" rel="noreferrer noopener">Applications section</a>. Use a name like <code>JHipster Native<span>!</span></code>, select <code>Regular Web Applications</code>, and click <strong>Create</strong>.</p><p>Switch to the <strong>Settings</strong> tab and configure your application settings:</p><ul><li>Allowed Callback URLs: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>login<span>/</span>oauth2<span>/</span>code<span>/</span>oidc</code></li><li>Allowed Logout URLs: <code>http<span>:</span><span>/</span><span><span>/</span><span>localhost:8080</span><span>/</span></span></code></li></ul><p>Scroll to the bottom and click <strong>Save Changes</strong>.</p><p>Copy your Auth0 domain, client ID, and client secret into the <code><span>.</span>auth0<span>.</span>env</code> file you created earlier. Then, run <code>source <span>.</span>auth0<span>.</span>env</code>.</p><p>In the <a href="https://manage.auth0.com/#/roles" target="_blank" rel="noreferrer noopener">roles</a> section, create new roles named <code><span>ROLE_ADMIN</span></code> and <code><span>ROLE_USER</span></code>.</p><p>Create a new user account in the <a href="https://manage.auth0.com/#/users" target="_blank" rel="noreferrer noopener">users</a> section. Click on the <strong>Role</strong> tab to assign the roles you just created to the new account.</p><p><em>Make sure your new user‚Äôs email is verified before attempting to log in!</em></p><p>Next, head to <strong>Auth Pipeline</strong> &gt; <strong>Rules</strong> &gt; <strong>Create</strong>. Select the <code>Empty rule</code> template. Provide a meaningful name like <code>Group claims</code> and replace the Script content with the following.</p><pre><code><span>function</span><span>(</span><span>user<span>,</span> context<span>,</span> callback</span><span>)</span> <span>{</span>
  user<span>.</span>preferred_username <span>=</span> user<span>.</span>email<span>;</span>
  <span>const</span> roles <span>=</span> <span>(</span>context<span>.</span>authorization <span>||</span> <span>{</span><span>}</span><span>)</span><span>.</span>roles<span>;</span>
  <span>function</span> <span>prepareCustomClaimKey</span><span>(</span><span>claim</span><span>)</span> <span>{</span>
    <span>return</span> <span><span>`</span><span>https://www.jhipster.tech/</span><span><span>${</span>claim<span>}</span></span><span>`</span></span><span>;</span>
  <span>}</span>
  <span>const</span> rolesClaim <span>=</span> <span>prepareCustomClaimKey</span><span>(</span><span>&#39;roles&#39;</span><span>)</span><span>;</span>
  <span>if</span> <span>(</span>context<span>.</span>idToken<span>)</span> <span>{</span>
    context<span>.</span>idToken<span>[</span>rolesClaim<span>]</span> <span>=</span> roles<span>;</span>
  <span>}</span>
  <span>if</span> <span>(</span>context<span>.</span>accessToken<span>)</span> <span>{</span>
    context<span>.</span>accessToken<span>[</span>rolesClaim<span>]</span> <span>=</span> roles<span>;</span>
  <span>}</span>
  <span>callback</span><span>(</span><span>null</span><span>,</span> user<span>,</span> context<span>)</span><span>;</span>
<span>}</span></code></pre><p>This code is adding the user‚Äôs roles to a custom claim (prefixed with <code>https<span>:</span><span>/</span><span>/</span>www<span>.</span>jhipster<span>.</span>tech<span>/</span>roles</code>). Click <strong>Save changes</strong> to continue.</p><p>Want to have all these steps automated for you? Add a üëç to <a href="https://github.com/auth0/auth0-cli/issues/351" target="_blank" rel="noreferrer noopener">issue #351</a> in the Auth0 CLI project.</p><h2 id="Run-Your-Native-JHipster-App">Run Your Native JHipster App</h2><p>After you‚Äôve built your app, it will be available in <code>target<span>/</span>native<span>-</span>executable</code>. Start Keycloak or source your Okta/Auth0 settings. Then, run the following commands:</p><pre><code>npm run ci<span>:</span>e2e<span>:</span>prepare # start docker dependencies
<span>.</span><span>/</span>target<span>/</span>native<span>-</span>executable</code></pre><p>It should start in under a second!</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7hcqDPxwMZ4UsTkeObTHHT/4096eb81b457c88d4b44a285ec68658c/03-native-start.png" alt="JHipster"/></p><h2 id="What-Does-the-JHipster-Native-Blueprint-Do-">What Does the JHipster Native Blueprint Do?</h2><p>The JHipster Native plugin integrates Spring Native into a JHipster project based on <a href="https://github.com/mraible/spring-native-examples#readme" target="_blank" rel="noreferrer noopener">findings from the research by Josh Long and me</a>. I documented our findings in September and December 2021.</p><ul><li>Sep 30, 2021: <a href="https://www.linkedin.com/pulse/jhipster-works-spring-native-matt-raible/" target="_blank" rel="noreferrer noopener">JHipster Works with Spring Native!</a></li><li>Dec 14, 2021: <a href="https://www.linkedin.com/pulse/jhipster-works-spring-native-part-2-matt-raible/" target="_blank" rel="noreferrer noopener">JHipster works with Spring Native, Part 2!</a></li></ul><p>The unexpected thing is one of the hardest problems we had to solve was with JPA and relationships. In JVM mode, everything worked fine. When running in native mode, <a href="https://github.com/jhipster/generator-jhipster/issues/17794" target="_blank" rel="noreferrer noopener">there was an exception</a>. The solution took days to figure out but was quite simple to fix: I just had to add a type hint for <code>java<span>.</span>util<span>.</span>HashSet<span>.</span>class</code>. ü§Ø</p><p>During this experience, I was surprised to find that Spring Native <a href="https://github.com/spring-projects-experimental/spring-native/issues/465" target="_blank" rel="noreferrer noopener">doesn‚Äôt support caching yet</a>. I believe this support will be added by the community soon. In the meantime, if you‚Äôre looking to start/stop your infra as fast as possible, you probably don‚Äôt care about caching. Caching is made for long-lived, JVM-strong, JVM-loving apps.</p><h2 id="What-s-the-Performance-Like-">What‚Äôs the Performance Like?</h2><p>The native binary starts in just over 500ms (581ms) on my 2019 MacBook Pro with a 2.4 GHz 8-Core Intel Core i9 processor and 64 GB of RAM.</p><p>If I start it in JVM mode with Maven, it takes just under five seconds.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/742uDAmJxwrU9qGUonCrh8/7bd45b645ad4c43b07c784a58982fbe3/04-jvm-start.png" alt="JHipster"/></p><p>As far as build time goes, Spring Native says:
<code>Finished generating ‚Äònative<span>-</span>executable‚Äô <span>in</span> <span>3</span>m <span>10</span>s<span>.</span></code></p><p>If I build a Docker image with the native binary:
<code>mvn spring<span>-</span>boot<span>:</span>build<span>-</span>image <span>-</span>Pprod</code></p><p>It takes a while the first time:
<code>Total time<span>:</span>  <span>06</span><span>:</span><span>30</span> min</code></p><p>And it‚Äôs slightly faster the second time:
<code>Total time<span>:</span>  <span>06</span><span>:</span><span>18</span> min</code></p><p>The amount of memory used after starting: <code><span>180</span> <span>MB</span></code>.
The amount of memory used after running <code>npm run e2e</code>: <code><span>196</span> <span>MB</span></code>.
In the interest of full disclosure, here‚Äôs the command I used to measure the amount of memory used:</p><pre><code>ps <span>-</span>o pid<span>,</span>rss<span>,</span>command <span>|</span> grep <span>--</span>color native <span>|</span> awk <span>&#39;{$2=int($2/1024)&#34; MB&#34;;}{ print;}&#39;</span></code></pre><p>What about the M1 Max? That‚Äôs <a href="https://twitter.com/mraible/status/1494417051137585152" target="_blank" rel="noreferrer noopener">not an option yet</a>, but <a href="https://github.com/oracle/graal/issues/2666#issuecomment-1057819284" target="_blank" rel="noreferrer noopener">could be in the next release of GraalVM</a>.</p><h2 id="Learn-More-about-GraalVM-and-Spring-Native">Learn More about GraalVM and Spring Native</h2><p>I hope you‚Äôve enjoyed learning how to make JHipster work with Spring Native and GraalVM. It‚Äôs still a work-in-progress. Startup time isn‚Äôt the end-all-be-all metric, but it is important in a serverless environment.</p><p>You can find the source code for this example on GitHub in the <a href="https://github.com/oktadev/auth0-full-stack-java-example/tree/spring-native" target="_blank" rel="noreferrer noopener">@oktadev/auth0-full-stack-java-example repository</a>. The source for the JHipster Native blueprint is in the <a href="https://github.com/jhipster/generator-jhipster-native" target="_blank" rel="noreferrer noopener">@jhipster/generator-jhipster-native repository</a>.</p><p>JHipster also has Micronaut and Quarkus blueprints. However, their native support is currently a work-in-progress. I hope to help improve them in the next few months.</p><ul><li><a href="https://github.com/jhipster/generator-jhipster-quarkus/issues/222" target="_blank" rel="noreferrer noopener">JHipster Quarkus can‚Äôt build native image</a></li><li><a href="https://github.com/jhipster/generator-jhipster-micronaut/issues/115" target="_blank" rel="noreferrer noopener">JHipster Micronaut can‚Äôt build native image</a></li></ul><p>If you liked this post, there‚Äôs a good chance you‚Äôll like similar ones:</p><ul><li><a href="https://developer.okta.com/blog/2019/11/27/graalvm-java-binaries" target="_blank" rel="noreferrer noopener">Watch GraalVM turn your Java into binaries</a></li><li><a href="https://developer.okta.com/blog/2021/09/16/spring-native-okta-starter" target="_blank" rel="noreferrer noopener">Spring Native in Action with the Okta Spring Boot Starter</a></li><li><a href="https://developer.okta.com/blog/2021/06/18/native-java-framework-comparison" target="_blank" rel="noreferrer noopener">Build Native Java Apps with Micronaut, Quarkus, and Spring Boot</a></li><li><a href="https://developer.okta.com/blog/2022/01/06/native-java-helidon" target="_blank" rel="noreferrer noopener">Build REST APIs and Native Java Apps with Helidon</a></li></ul><p>If you have questions, please ask them in the comments below! If you‚Äôre into social media, follow us: <a href="https://twitter.com/oktadev" target="_blank" rel="noreferrer noopener">@oktadev on Twitter</a>, <a href="https://www.linkedin.com/company/oktadev" target="_blank" rel="noreferrer noopener">Okta for Developers on LinkedIn</a>, and <a href="https://www.facebook.com/oktadevelopers" target="_blank" rel="noreferrer noopener">OktaDev</a> on Facebook. If you like learning via video, subscribe to <a href="https://youtube.com/oktadev" target="_blank" rel="noreferrer noopener">our YouTube channel</a>.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 09 Mar 2022 15:02:00 +0000</pubDate>
    </item>
    <item>
      <title>Using HTTPS in Your Development Environment</title>
      <link>https://auth0.com/blog/using-https-in-your-development-environment/</link>
      <description>Why should you use HTTPS for development? How can you set it up? This article will explain (almost) everything.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>The HTTPS protocol is mandatory for any website or web application. It guarantees trust and security, and its wide adoption is due to <a href="https://www.eff.org/encrypt-the-web" target="_blank" rel="noreferrer noopener">the effort of browser providers and other supporters</a>. However, many developers still use HTTP in their development environment. Why should you switch to HTTPS if it&#39;s not a production environment? Let&#39;s discuss.</p><h2 id="Why-Use-HTTPS-During-Local-Development-">Why Use HTTPS During Local Development?</h2><p>Hopefully, you use HTTPS in your production environment since security is a primary concern for your web application. But why should you enable HTTPS in your local development environment? You are comfortable with your <code>http<span>:</span><span>/</span><span>/</span>localhost</code>. What are the security concerns in your local environment?</p><blockquote><p>Check out <a href="https://auth0.com/blog/using-https/" target="_blank" rel="noreferrer noopener">this blog post to learn more about how HTTPS works</a>.</p></blockquote><p>There are different reasons to enable HTTPS, even for your localhost. Let&#39;s take a look at some of them.</p><h3 id="Environment-parity">Environment parity</h3><p>The first and perhaps most logical reason is that <strong>the development environment should be similar to the production environment</strong>. This is one of the main principles of modern software development and deployment. It&#39;s one of the tenets of the <a href="https://12factor.net/" target="_blank" rel="noreferrer noopener">twelve-factor methodology</a>: <a href="https://12factor.net/dev-prod-parity" target="_blank" rel="noreferrer noopener">dev/prod parity</a>. Having development and production environments configured similarly helps reduce the risk of experiencing issues in production that you cannot find in development.</p><p>For example, suppose you are using a JavaScript library from an HTTP-based CDN. Everything works as expected in your local development environment. However, in your HTTPS-based production environment, things may go differently. You have <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Mixed_content" target="_blank" rel="noreferrer noopener">mixed content</a> in your pages, i.e., your page is composed of content delivered through HTTPS and content delivered through HTTP. Browsers may refuse to load an HTTP-based resource from an HTTPS-based page. This is a security measure to <a href="https://auth0.com/blog/preventing-https-downgrade-attacks/" target="_blank" rel="noreferrer noopener">prevent HTTPS downgrade attacks</a>. It is just a simple example of an issue you can get only in your production environment. Other hard to detect problems could arise if you keep different protocols in the two environments.</p><h3 id="Strong-security-policies">Strong security policies</h3><p>Enabling HTTPS in your production environment isn&#39;t enough to keep security for your application and the data it handles. I mentioned earlier the HTTPS downgrade risks your application may be exposed to. To enforce your application avoiding mixed content and blocking insecure requests, you should use <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" target="_blank" rel="noreferrer noopener">Content Security Policy (CSP)</a>. This standard security layer helps mitigate certain types of attacks. In particular, it prevents possible unintentional protocol switches.</p><blockquote><p>To learn more about Content Security Policy (CSP), check out <a href="https://auth0.com/blog/preventing-https-downgrade-attacks/" target="_blank" rel="noreferrer noopener">this article explaining how to prevent protocol switches</a> and <a href="https://auth0.com/blog/defending-against-xss-with-csp/" target="_blank" rel="noreferrer noopener">this one about preventing XSS attacks</a>.</p></blockquote><p>If you use CSP to prevent your application from switching from HTTPS to HTTP, you need to use HTTPS in both production and development environments. The CSP directives wouldn&#39;t work in an HTTP-based environment. In other words, if you care about your application security in production, you can&#39;t help but use HTTPS even in your development environment.</p><h3 id="Using-specific-browser-features">Using specific browser features</h3><p>If you want to use some advanced features supported by modern browsers, you need to use HTTPS in your local development environment. This applies to <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" target="_blank" rel="noreferrer noopener">service workers</a>, <a href="https://en.wikipedia.org/wiki/Secure_cookie" target="_blank" rel="noreferrer noopener">secure cookies</a>, or <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#cookie_prefixes" target="_blank" rel="noreferrer noopener">prefixed cookies</a>, for example.</p><p>Some browsers allow you to use plain HTTP by explicitly specifying <code>localhost</code> or <code><span>127.0</span><span>.0</span><span>.1</span></code> as the host name while testing a service worker. However, this violates the <a href="#Environment-parity">environment parity principle discussed earlier</a>. In addition, it is <a href="https://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features/" target="_blank" rel="noreferrer noopener">strongly discouraged by browser manufacturers</a>.</p><h3 id="Custom-hostname">Custom hostname</h3><p>Usually, you use <code>localhost</code> as the name for your local machine. This is a reserved name and is mapped to the <code><span>127.0</span><span>.0</span><span>.1</span></code> IP address. Browsers treat it in a special way, especially in terms of security.</p><p>However, there are situations where you may need to use a custom hostname, such as <code>myapplication</code> or <code>myhost<span>.</span>dev</code> or something else. For example, you can use a custom hostname to rely on meaningful names to distinguish multiple development environments. You can do it by editing <a href="https://en.wikipedia.org/wiki/Hosts_(file" target="_blank" rel="noreferrer noopener">your machine&#39;s <code>hosts</code> file</a>).</p><blockquote><p>Warning: changing the content of your <code>hosts</code> file may create access problems to certain Internet domains.</p></blockquote><p>In this case, your browser won&#39;t consider it a secure site, but it will when you enable HTTPS.</p><h3 id="Other-reasons">Other reasons</h3><p>So far, you have learned about the most common reasons you should enable HTTPS in your development environment, but there are many more. For example, if you want to use <a href="https://en.wikipedia.org/wiki/HTTP/2" target="_blank" rel="noreferrer noopener">HTTP/2</a> or if your third-party library explicitly requires HTTPS.</p><p>There are several reasons to change to HTTPS in your local development, but after all, the environment parity principle is the primary reason.</p><p>Some may think to start a new project with HTTP support and switch to HTTPS later when the project has grown. This approach is based on the common thought that switching from HTTP to HTTPS is painless. Learn about some of the issues that Stack Overflow ran into by reading <a href="https://nickcraver.com/blog/2017/05/22/https-on-stack-overflow/" target="_blank" rel="noreferrer noopener">the story of their migration</a>.</p><h2 id="How-Does-HTTPS-in-Localhost-Work-">How Does HTTPS in Localhost Work?</h2><p>The HTTPS protocol is an extension of HTTP. In HTTPS, the server and the client exchange encrypted data using the <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank" rel="noreferrer noopener">Transport Layer Security (TLS)</a> protocol.</p><p>You don&#39;t need to understand every little detail of the encryption mechanism for the purpose of this article, but a little basic terminology is necessary for what you&#39;ll be doing next. For example, you need to know that data exchanged between the client and the server is encrypted using the <a href="https://en.wikipedia.org/wiki/Public-key_cryptography" target="_blank" rel="noreferrer noopener">Public-Key Cryptography</a>, which is based on a private and public key pair. The server provides the client with its public key through a digital certificate issued by a Certificate Authority.</p><details><summary>Learn more on encryption and certificates</summary><p>The HTTPS encryption mechanism is based on <a href="https://en.wikipedia.org/wiki/Public-key_cryptography" target="_blank" rel="noreferrer noopener">Public-Key Cryptography</a>, and the whole infrastructure to guarantee trust and security is based on the <a href="https://en.wikipedia.org/wiki/Public_key_infrastructure" target="_blank" rel="noreferrer noopener">Public-Key Infrastructure (PKI)</a>.</p><p>Without going into details, to enable HTTPS, a web server needs a private key and a public key to set up encrypted communication with clients. The public key is included in a digital certificate issued by a <a href="https://en.wikipedia.org/wiki/Certificate_authority" target="_blank" rel="noreferrer noopener">Certificate Authority (CA)</a>, which guarantees that it belongs to that server with that specific domain name.</p><p>Check out <a href="https://auth0.com/blog/how-to-explain-public-key-cryptography-digital-signatures-to-anyone/" target="_blank" rel="noreferrer noopener">this article if you want to have a high-level overview of Public-Key Cryptography</a>.</p></details><p>When your browser reaches out to an HTTPS-enabled web server, it receives the server&#39;s digital certificate, which contains the server&#39;s public key. The first thing the browser does is check that the server&#39;s domain name matches the domain name in the certificate. This validation ensures that the public key comes from a trusted source. The browser also checks other things, such as the certificate expiration date and the Certificate Authority that issued that certificate.</p><p>In a production environment, you need a certificate issued by a real Certificate Authority. However, you can be more relaxed in a development environment and create your own certificate, known as your <a href="https://en.wikipedia.org/wiki/Self-signed_certificate" target="_blank" rel="noreferrer noopener">self-signed certificate</a>.</p><h2 id="A-Practical-Example--Node-and-HTTPS">A Practical Example: Node and HTTPS</h2><p>Now you have a high-level vision of what you need to enable HTTPS in your development environment. Let&#39;s put these concepts into practice by setting up a basic example using Node.js.</p><p>Each development framework may have its own procedures or tools. Please, check out your framework&#39;s documentation for specific information. One thing that stays the same in all frameworks is the need for a private and public key pair and a certificate for the public key.</p><h3 id="Creating-the-certificate">Creating the certificate</h3><p>Earlier you read that you could create your own certificate for your development environment. But how can you do it? The best-known and most powerful tool is probably <a href="https://www.openssl.org/" target="_blank" rel="noreferrer noopener">OpenSSL</a>. However, it requires a good knowledge  of Public-Key Infrastructure concepts. In most cases, you don&#39;t have advanced requirements for your HTTPS environment. So, using a simple tool like <a href="https://github.com/FiloSottile/mkcert" target="_blank" rel="noreferrer noopener">mkcert</a> is a great choice.</p><p>Install <code>mkcert</code> in your machine following <a href="https://github.com/FiloSottile/mkcert#installation" target="_blank" rel="noreferrer noopener">the instructions for your operating system</a>.</p><p>The first time you use <code>mkcert</code>, you must run the following command to install a local Certificate Authority:</p><pre><code>mkcert -install</code></pre><p>When running this command, you may notice a warning message like the following:</p><pre><code>Warning: <span>&#34;certutil&#34;</span> is not available, so the CA can&#39;t be automatically installed <span>in</span> Firefox<span>!</span> ‚ö†Ô∏è
Install <span>&#34;certutil&#34;</span> with <span>&#34;brew install nss&#34;</span> and re-run <span>&#34;mkcert -install&#34;</span> üëà</code></pre><p>This is related to supporting the <a href="https://support.mozilla.org/en-US/kb/setting-certificate-authorities-firefox" target="_blank" rel="noreferrer noopener">trust store in Firefox</a>. If you are not using Firefox, you can ignore this message.</p><blockquote><p>Installing a local CA avoids your browser complaining that it does not trust the certificate you are about to create.</p></blockquote><p>Once you install your local CA, you are ready to create a certificate and a key pair for your development environment.</p><p>I suggest you create a folder to put your Node.js project and the certificate. Say you named this folder <code>my<span>-</span>secure<span>-</span>app</code>, move to this folder and run the following command:</p><pre><code>mkcert localhost</code></pre><p>After the command runs, you will find two files in your folder:</p><ul><li><code>localhost<span>-</span>key<span>.</span>pem</code>, which is the file containing your private key,</li><li><code>localhost<span>.</span>pem</code>, which is the certificate containing the public key.</li></ul><p>The certificate you have generated assures your browser that the public key it will receive is from the server named <code>localhost</code>. You can choose a different name instead of localhost when you generate your certificate. Just remember to register that name in your <code>hosts</code> file as a custom domain.</p><h3 id="Setting-up-the-HTTPS-server-with-Node-js">Setting up the HTTPS server with Node.js</h3><p>It&#39;s time to build your HTTPS-enabled server with Node.js.</p><p>In the same folder where you put the key and certificate files, create a <code>server<span>.</span>js</code> file with the following content:</p><pre><code><span>const</span> https <span>=</span> <span>require</span><span>(</span><span>&#39;https&#39;</span><span>)</span><span>;</span>
<span>const</span> fs <span>=</span> <span>require</span><span>(</span><span>&#39;fs&#39;</span><span>)</span><span>;</span>

<span>const</span> options <span>=</span> <span>{</span>
  key<span>:</span> fs<span>.</span><span>readFileSync</span><span>(</span><span>&#39;localhost-key.pem&#39;</span><span>)</span><span>,</span>
  cert<span>:</span> fs<span>.</span><span>readFileSync</span><span>(</span><span>&#39;localhost.pem&#39;</span><span>)</span>
<span>}</span><span>;</span>

https<span>.</span><span>createServer</span><span>(</span>options<span>,</span> <span>function</span> <span>(</span><span>req<span>,</span> res</span><span>)</span> <span>{</span>
  res<span>.</span><span>writeHead</span><span>(</span><span>200</span><span>)</span><span>;</span>
  res<span>.</span><span>end</span><span>(</span><span>&#34;I&#39;m HTTPS-enabled!&#34;</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>.</span><span>listen</span><span>(</span><span>8080</span><span>)</span><span>;</span>

console<span>.</span><span>log</span><span>(</span><span>&#34;The server is listening to port 8080 with HTTPS enabled.&#34;</span><span>)</span><span>;</span></code></pre><p>The first line of the file imports the <code>https</code> module, which is the key to this implementation. The <code>options</code> constant gets the values of the private key and the certificate from the respective files. Finally, you create a server based on these options and listening to the <code><span>8080</span></code> port. That&#39;s all!</p><p>Run the server with the following command:</p><pre><code>node server.js</code></pre><p>Then, head your browser to <a href="http://localhost:8080" target="_blank" rel="noreferrer noopener">http://localhost:8080</a>. You&#39;ll get a screen like the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7B91nkhBvOnA4qafbvOUyD/da7b2b6c1610d71195cc650a736a7ef7/http-request-to-https-server.png" alt="HTTP request to HTTPS server"/></p><p>This screen tells you that the server does not initialize a plain HTTP communication. If you change that address to <a href="https://localhost:8080" target="_blank" rel="noreferrer noopener">https://localhost:8080</a>, you will get the following page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/46O94lRU5E4fSsYIxLfyyg/b5536bbe90c7534c52d4ea65e2358549/successful-https-request.png" alt="Successful HTTPS request"/></p><p>This time the server replied to your request as expected. You are ready to develop your application using HTTPS.</p><p>Try out the most powerful authentication platform for free.<a target="_blank" href="https://auth0.com/signup?promo=sup&amp;place=in-blog-banner&amp;type=link&amp;text=get-started&amp;origin=blog">Get started ‚Üí</a></p><h2 id="Summary">Summary</h2><p>Throughout this article, you learned a few reasons why it&#39;s a good practice to use HTTPS in your development environment. Beyond the necessity of having a development environment similar to the production environment, some browser features may require HTTPS.</p><p>You learned that you need a pair of cryptographic keys and a certificate to enable HTTPS in your development web server. Finally, you saw how to create a simple Node.js server that uses HTTPS.</p><p>I hope that you now have the initial understanding of how to configure and set up HTTPS in your local development environment. If you have any questions, please reach out to me using the comments below. I&#39;ll be happy to answer your questions about this fascinating topic. Let&#39;s make the Internet safer by using HTTPS everywhere!</p></div></div>]]></content:encoded>
      <pubDate>Mon, 07 Mar 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Encoding, Encryption, and Hashing</title>
      <link>https://auth0.com/blog/encoding-encryption-hashing/</link>
      <description>Encoding, Encryption, and Hashing have different goals and shouldn&#39;t be confused. Learn the differences.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Sometimes people use the terms encryption and encoding interchangeably. Also, often hashing is called into play as an encryption mechanism. Confusing these concepts may lead to misunderstandings in the way security is implemented.</p><p>Let&#39;s take a high-level overview of these concepts and clarify the differences.</p><p>If you prefer watching videos, here is a video version of this article:</p><p><iframe src="https://www.youtube.com/embed/-bAnBzvMLig" frameborder="0" allowfullscreen=""></iframe></p><h2 id="What-Is-Encoding-">What Is Encoding?</h2><p>Let&#39;s start with encoding. You can define it as <strong>a technique to transform data from one format to another so that it can be understood and consumed by different systems</strong>.</p><p>Basically, encoding has to do with information representation. When you have some information, say the <a href="https://en.wikipedia.org/wiki/Kryptonite" target="_blank" rel="noreferrer noopener">name of the mineral that weakens Superman</a>, you can represent it through letters, as in <em>kryptonite</em>. This is a handy representation for humans but not so easy for being manipulated by computers. What usually happens, in this case, is the transformation of this sequence of characters into a sequence of bits like this:</p><pre><code><span>01101011</span> <span>01110010</span> <span>01111001</span> <span>01110000</span> <span>01110100</span>
<span>01101111</span> <span>01101110</span> <span>01101001</span> <span>01110100</span> <span>01100101</span></code></pre><p>You have two representations for the same information. The letter-based representation is usually understood by <em>human systems</em>; the bit-based representation is more suitable for computer systems. Commonly, you say that the sequence of letters has been <em>encoded</em> into a sequence of bits.</p><p>So, encoding is just a transformation from one data representation to another, keeping the same information. Usually, it involves a conversion table, such as an <a href="https://en.wikipedia.org/wiki/ASCII" target="_blank" rel="noreferrer noopener">ASCII table</a> in our example, that maps a representation item in one system to the corresponding representation item in the other system.</p><p>You can find several encoding mechanisms out there. To mention just a few in the character encoding space, apart from the dear old ASCII, you have:</p><ul><li><a href="https://en.wikipedia.org/wiki/Unicode" target="_blank" rel="noreferrer noopener">Unicode</a>, which allows you to represent more complex items than letters, such as emoji and other symbols.</li><li><a href="https://en.wikipedia.org/wiki/Base64" target="_blank" rel="noreferrer noopener">Base64</a>, which lets you represent binary data, such as an image, through text.</li><li><a href="https://en.wikipedia.org/wiki/Percent-encoding" target="_blank" rel="noreferrer noopener">URL encoding</a>, useful to represent arbitrary data in an URL, where some characters are reserved or cannot be used (think of spaces or colons, for example).</li></ul><p>Consider <a href="https://jwt.io/introduction" target="_blank" rel="noreferrer noopener">JSON Web Tokens (JWT)</a>, for example. The three parts that compose a token are encoded using <a href="https://www.rfc-editor.org/rfc/rfc4648#section-5" target="_blank" rel="noreferrer noopener">Base64-URL</a>, a variant of Base64 encoding combined with URL encoding. The following is an example of encoded JWT:</p><pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<span>.</span>eyJpc3MiOiJodHRwOi8vbXktZG9tYWluLmF1dGgwLmNvbSIsInN1YiI6ImF1dGgwfDEyMzQ1NiIsImF1ZCI6IjEyMzRhYmNkZWYiLCJleHAiOjEzMTEyODE5NzAsImlhdCI6MTMxMTI4MDk3MCwibmFtZSI6IkphbmUgRG9lIiwiZ2l2ZW5fbmFtZSI6IkphbmUiLCJmYW1pbHlfbmFtZSI6IkRvZSJ9<span>.</span>bql<span>-</span>jxlG9B_bielkqOnjTY9Di9FillFb6IMQINXoYsw</code></pre><p>You can see the decoded version of this JWT using the <a href="https://jwt.io/?id_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwOi8vbXktZG9tYWluLmF1dGgwLmNvbSIsInN1YiI6ImF1dGgwfDEyMzQ1NiIsImF1ZCI6IjEyMzRhYmNkZWYiLCJleHAiOjEzMTEyODE5NzAsImlhdCI6MTMxMTI4MDk3MCwibmFtZSI6IkphbmUgRG9lIiwiZ2l2ZW5fbmFtZSI6IkphbmUiLCJmYW1pbHlfbmFtZSI6IkRvZSJ9.bql-jxlG9B_bielkqOnjTY9Di9FillFb6IMQINXoYsw" target="_blank" rel="noreferrer noopener">jwt.io</a> debugger.</p><p>This encoding mechanism allows the token to be easily passed in HTML and HTTP environments without fear of clashes with reserved or unrepresentable characters. If you want to learn more about JWTs, you can download <a href="https://auth0.com/resources/ebooks/jwt-handbook" target="_blank" rel="noreferrer noopener">the JWT Handbook</a>.</p><p>Encoding ensures <strong>interoperability</strong> between systems. It allows systems that use different data representations to share information.</p><p>Encoding has <strong>no security purpose</strong>. Anyone who knows the conversion algorithm can encode and decode data. The conversion algorithm is not kept secret. On the contrary, it is public in order to facilitate interoperability between systems.</p><p>Finally, encoding is a <strong>reversible process</strong>. You can transform a piece of data from one representation to another and then go back to the original representation without information loss.</p><blockquote><p>&#34;Every decoding is another encoding..&#34;</p><p>‚Äî David Lodge</p></blockquote><h2 id="What-Is-Encryption-">What Is Encryption?</h2><p>Encryption is <strong>a technique that makes your data unreadable and hard to decode for an unauthorized user</strong>.</p><p>So, basically, encryption is a mechanism that transforms data into a different representation so that prying eyes cannot understand it. Wait! Isn&#39;t this transformation the same as encoding after all? ü§î</p><p>How can a human being understand that the following sequence of bits represents the word <em>kryptonite</em>?</p><pre><code><span>01101011</span> <span>01110010</span> <span>01111001</span> <span>01110000</span> <span>01110100</span>
<span>01101111</span> <span>01101110</span> <span>01101001</span> <span>01110100</span> <span>01100101</span></code></pre><p>In fact, the question is not far-fetched. In a way, encryption is a form of encoding. It transforms data from one representation to another. For this reason, sometimes, people use the terms encryption and encoding interchangeably. However, the purpose of encryption is different from the encoding&#39;s one.</p><p>Look at the definition above. The encryption technique aims at making data <strong>unreadable and hard to decode</strong>. If you think about it for a moment, it is the opposite reason of pure encoding: encoding aims at making data as much understandable as possible across systems while encryption tries to make it undecipherable, unless you are authorized.</p><p>The main goal of encryption is to ensure <strong>data confidentiality</strong>, i.e., protecting data from being accessed by unauthorized parties.</p><p>So, while encoding makes its conversion algorithms as public as possible, encryption should keep such algorithms private. Actually, it&#39;s not really like that. Relying on secret algorithms is not the best choice to protect data in the long run. Better solutions rely on well-known algorithms whose data transformation is based on sequences of numbers or letters called <em>keys</em>.</p><blockquote><p>Do not create your own encryption algorithm unless you are a Math expert with a long experience in the cryptography field.</p></blockquote><p>The best mechanisms to encrypt data are based on mathematical algorithms that can be solved only with the possession of a key or with advanced computational power. Two families of key-based encryption algorithms exist:</p><ul><li><strong>Symmetric-key algorithms</strong>: these algorithms use the same key to encrypt and decrypt data. The <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" target="_blank" rel="noreferrer noopener">Advanced Encryption Standard</a> (AES) algorithm is an example of this family&#39;s algorithms.</li><li><strong>Asymmetric-key algorithms</strong>: these algorithms use different keys to encrypt and decrypt data. The two keys are bound by a complex mathematical relationship. <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem%29" target="_blank" rel="noreferrer noopener">RSA</a> is an example of an algorithm in this family. Check out <a href="https://auth0.com/blog/how-to-explain-public-key-cryptography-digital-signatures-to-anyone/" target="_blank" rel="noreferrer noopener">this blog post for a gentle introduction to asymmetric-key algorithms</a>.</li></ul><p>Like pure encoding, encryption is a <strong>reversible process</strong> as well, although just for authorized people. Authorized people are the ones in possession of a decryption key.</p><p>The challenge of authorized versus unauthorized people is to make data decryption without the key as hard as possible. This leads to applying a mix of cautions such as complex mathematical relationships between the keys, keeping them secret, changing them frequently, and so on.</p><blockquote><p>&#34;Anyone, from the most clueless amateur to the best cryptographer, can create an algorithm that he himself can&#39;t break.&#34;</p><p>‚Äî Bruce Schneier</p></blockquote><h2 id="What-Is-Hashing-">What Is Hashing?</h2><p>Let&#39;s take a look at hashing now. Basically, it&#39;s <strong>a technique to generate a unique fixed-length string (hash) strictly depending on the specific input data</strong>.</p><p>Since the generated hash depends on the specific input data, any small change to the input data generates a different hash. So, having the hash of a given piece of data, you can verify if that data has been altered by calculating its hash and comparing it with the one you already have. In other words, hashing <strong>ensures data integrity</strong>.</p><p>Suppose you like <a href="https://en.wikipedia.org/wiki/Lex_Luthor" target="_blank" rel="noreferrer noopener">Lex Luthor</a>&#39;s sarcastic line, <em>That&#39;s Kryptonite, Superman. Little souvenir from the old home town</em>. You like it so much that you want it to always be quoted in exactly this way. No character changed.</p><p>You calculate its hash string as follows:</p><pre><code><span>7633</span>bbb5bd637575809f0ccbc7db45240255d9637eac38b69d60f0d3d5c4a465</code></pre><blockquote><p>By the way, I used <a href="https://en.wikipedia.org/wiki/SHA-2" target="_blank" rel="noreferrer noopener">SHA-256</a> as the algorithm to calculate that hash string. But don&#39;t mind about this. I&#39;ll spend a few words on algorithms in a moment.</p></blockquote><p>Assume someone writes that quote slightly different, such as, <em>That&#39;s kryptonite, Superman. Little souvenir from the old home town</em>. The following is the hash of this second version:</p><pre><code><span>75</span>ae6980bdb589ad7b555548159837a447ece0fc21348a53afc1ecdf62687153</code></pre><p>You can see that the two hashes are different just by looking at the first characters. This tells you that the two sentences are not written the same way. Did you notice the difference between the two sentences? The second version has a lower-case k instead of the capital K in <em>kryptonite</em>.</p><p>You may say: why do you compare the two hash strings when you could compare the two sentences? Good point! Imagine that you have a document of thousands of words or a high-quality picture instead of a sentence. In that case, comparing the hash strings is more effective than comparing the whole media.</p><p>So, how can you get a hash? A hashing algorithm must have the following features:</p><ol start="1"><li>The resulting hash has a fixed length.</li><li>The same input always produces the same output.</li><li>Multiple different inputs <em>should not</em> produce the same output.</li><li>It must not be possible to obtain the input from the output data.</li><li>Any change to the input data implies a different resulting hash.</li></ol><p>As you can see, point 4 implies that hashing is <strong>not a reversible process</strong>, unlike encoding and encryption. Also, point 3 seems to say that, while you should get different hashes for distinct input data, it can&#39;t be guaranteed. Actually, this point makes the difference between hashing algorithms. For example, <a href="https://en.wikipedia.org/wiki/MD5" target="_blank" rel="noreferrer noopener">MD5</a> has been a very common hashing algorithm in the past, but <a href="https://www.kb.cert.org/vuls/id/836068" target="_blank" rel="noreferrer noopener">in 2008 it was deprecated</a> due to <a href="https://en.wikipedia.org/wiki/Collision_resistance" target="_blank" rel="noreferrer noopener">collision detection</a>. The same happened to some early algorithms of the <a href="https://en.wikipedia.org/wiki/Secure_Hash_Algorithms" target="_blank" rel="noreferrer noopener">Secure Hashing Algorithms (SHA) family</a>. </p><p>Try out the most powerful authentication platform for free.<a target="_blank" href="https://auth0.com/signup?promo=sup&amp;place=in-blog-banner&amp;type=link&amp;text=get-started&amp;origin=blog">Get started ‚Üí</a></p><p>As you&#39;ve seen, encoding, hashing, and encryption have their specific purposes and features. Confusing their capabilities and roles in your system may lead to disastrous consequences.</p><p>For example, you may think that encrypting passwords is the best security option. Actually, it&#39;s a very bad idea. That&#39;s what <a href="https://nakedsecurity.sophos.com/2013/11/04/anatomy-of-a-password-disaster-adobes-giant-sized-cryptographic-blunder/" target="_blank" rel="noreferrer noopener">the Adobe engineers learned in a data breach in 2013</a>. The attackers who got access to their user database could break the encryption algorithm. Remember that encryption is a reversible process. Even if they don&#39;t have the decryption key, they may have enough time to guess it. Adobe reset users&#39; passwords as a countermeasure, but you know users use the same password for multiple services. So, even if access to Adobe services may be safe, access to other websites was potentially compromised.</p><p>They should have used hashing instead of encryption to store users passwords securely. You know that hashing is not a reversible process. Attackers can&#39;t determine the password from which the hash was generated. But also, simply relying on hashing is not the best option, as <a href="https://www.computerworld.com/article/2504078/hackers-crack-more-than-60--of-breached-linkedin-passwords.html" target="_blank" rel="noreferrer noopener">the LinkedIn breach</a> teaches us.</p><p>I know, it&#39;s a hard world! üôÑ</p><p>If you want, you can learn more about <a href="https://auth0.com/blog/hashing-passwords-one-way-road-to-security/" target="_blank" rel="noreferrer noopener">storing passwords using hashing</a> and <a href="https://auth0.com/blog/adding-salt-to-hashing-a-better-way-to-store-passwords/" target="_blank" rel="noreferrer noopener">how to use salt to store them properly</a>. Also, for a more <a href="https://auth0.com/blog/how-secure-are-encryption-hashing-encoding-and-obfuscation/" target="_blank" rel="noreferrer noopener">technical comparison of encoding, encryption, and hashing, read this article</a>.</p><h2 id="Summary">Summary</h2><p>Now you know the difference between encoding, encryption, and hashing. To briefly recap what you learned throughout this article, take a look at the following cheat sheet:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/32RHwyEORRBB8sbu5EZgdz/e706f821fe5e309fc410d7a56acee7d3/encoding-encryption-hasing-cheat-sheet.png" alt="Encoding, encryption, and hashing comparison"/></p></div></div>]]></content:encoded>
      <pubDate>Wed, 02 Mar 2022 17:19:00 +0000</pubDate>
    </item>
    <item>
      <title>Identity is the First Step Towards Enterprise Readiness</title>
      <link>https://auth0.com/blog/identity-is-the-first-step-towards-enterprise-readiness/</link>
      <description>How identity can help startups scale up-market to win bigger deals.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Most (not all) founders at Business-to-Business (B2B) and Software-as-a-Service (SaaS) startups dream of becoming the next industry-defining enterprise application like Salesforce, Slack, or Atlassian.</p><p>To have millions of daily active users, billions of dollars in market capitalization, and the comfort of being a staple in the technology stack of another business, is a revered status that <a href="https://auth0.com/blog/so-you-want-to-be-a-unicorn/" target="_blank" rel="noreferrer noopener">fuels the ambition of hungry startups</a>.  </p><p>An important step to attaining such scale is the difficult journey of moving upmarket to acquire enterprise customers. From both a go-to-market (GTM) and product perspective, enterprise customers come with their own unique set of <a href="https://www.enterpriseready.io/" target="_blank" rel="noreferrer noopener">requirements</a>, which can overwhelm even the most disciplined teams. As a burgeoning startup, pursuing these opportunities may feel like a double-edged sword.</p><p>On the one hand, adding a large, recognizable brand to your customer base would improve your company‚Äôs standing in the market. On the other, it would mean diverting most (if not all) development resources towards building capabilities that aren‚Äôt central to your business‚Äôs core value proposition.</p><p>The good news is that business customer identity solutions can help provide startup teams with the necessary tools to incorporate standard enterprise-ready capabilities early on in their product development, thus unlocking future growth. In doing so, identity can support GTM motions without bogging down technical teams in the long run. </p><h2 id="670-Billion-Reasons-to-Move-Upmarket">670 Billion Reasons to Move Upmarket</h2><p>The enterprise market is an attractive space for SaaS companies for one main reason: there‚Äôs a lot of money on the table.</p><p>Digital transformation continues to change the way businesses operate, particularly related to the adoption of cloud applications. Investments into SaaS products were up <a href="https://www.blissfully.com/saas-trends/2020-annual-report/" target="_blank" rel="noreferrer noopener">50% in 2020</a> compared to the previous year and showed no signs of slowing down. <a href="https://www.gartner.com/en/newsroom/press-releases/2022-01-18-gartner-forecasts-worldwide-it-spending-to-grow-five-point-1-percent-in-2022" target="_blank" rel="noreferrer noopener">According to a Gartner¬Æ</a> report, worldwide spending on Enterprise Software is projected to reach almost 670 billion dollars this year alone, representing an 11% growth rate. </p><p>For startups, entering this segment of the market not only signals a level of product maturity but also supports long-term, sustainable growth by widening the total addressable market (TAM) of the business and increasing profitability in a few ways. </p><p>First, the average selling price (ASP) for an enterprise customer is typically much larger than others. As an example, let‚Äôs consider Shopify, the Canadian E-commerce company that helps businesses sell, ship, and process payments online. Their core platform, geared towards small and medium-sized businesses (SMB), has an upper price point of $299/month. In stark contrast, Shopify Plus, their enterprise offering, is nearly ten times that, starting at $2000/month. This is why enterprise deals can grow revenues from <a href="https://www.saastr.com/why-tilting-just-a-smidge-from-self-service-can-grow-your-revenue-30x/" target="_blank" rel="noreferrer noopener">10 to 30</a> times the original product‚Äôs value depending on the market, product, and offers. </p><p>Secondly, enterprise clients are <a href="https://www.cmswire.com/analytics/enterprise-saas-churn-rates-whats-acceptable/#:~:text=According%20to%20Lincoln%20Murphy%20of,would%20be%20approximately%200.4%20percent." target="_blank" rel="noreferrer noopener">less likely to churn</a> from your service. Due to the higher ASP, longer contract lengths, and less price sensitivity, the average churn for enterprise customers can range anywhere from 1% to 5% compared to the 20% - 25% churn seen from their SMB counterparts. </p><p>Finally, adding a recognizable brand to your customer base exerts a form of gravity that other GTM teams can leverage as it signals a degree of credibility for your offering. As an example, look at the customers cited on your favorite SaaS applications home page. You‚Äôll likely find larger, established companies. For what it‚Äôs worth, AMD, Pfizer, and American Airlines are just a few of the global brands you‚Äôll find on the Auth0 <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">home page</a>. </p><p>When you combine all of those factors, the benefit on pipeline generation, top-line revenue, and net dollar retention paint a compelling picture of the financial benefit of moving upmarket. </p><h2 id="The-Challenges-of-Building-for-Enterprise">The Challenges of Building for Enterprise</h2><p>The natural question is if the enterprise space is so lucrative, why doesn‚Äôt every company race towards it like their valuation depends on it? </p><p>Though a SaaS company may demonstrate market viability with its customers in the SMB segment, the needs of the enterprise are significantly more complex, often stressing functionality around user provisioning, administration, and security at scale. They‚Äôre inherently risk-averse and rely on well-established patterns to vet the security of the SaaS applications they adopt. Common requirements of doing business with larger customers include: </p><ul><li><strong>Single Sign-On ‚Äî</strong> so that administrators can easily manage user provisioning and de-provisioning via their own IdP while making it simple for employees to access an application.</li><li><strong>Multi-Factor Authentication ‚Äî</strong> to align with security policies and validate the owner of the account is the one actually trying to access the application.</li><li><strong>Role-Based Access Control (RBAC) ‚Äî</strong> so that appropriate levels of user permissions can be granted throughout an application.</li><li><strong>Compliance Accreditations ‚Äî</strong> certifications such as <a href="https://auth0.com/blog/soc-2-compliance-and-certification-what-saas-businesses-need-to-know/" target="_blank" rel="noreferrer noopener">SOC2</a>, <a href="https://auth0.com/blog/what-is-iso-27001-2013-a-guide-for-businesses/" target="_blank" rel="noreferrer noopener">ISO27001</a>, and <a href="https://auth0.com/blog/what-is-pci-a-business-guide-to-compliance/" target="_blank" rel="noreferrer noopener">PCI</a> DSS that are granted by a third party and assert a professional standard.</li><li><strong>Data Privacy Compliance ‚Äî</strong> adherence to privacy laws and regulations such as GDRP, LGPD, APPI, and CCPA.</li></ul><p>It‚Äôs not <em>impossible</em> to build these capabilities with developers in-house, but it is challenging and requires subject matter expertise in identity, security, and protocols. </p><p>However, just because developers <em>can</em> build something doesn‚Äôt mean they <em>should</em>. When it comes to platform capabilities like authentication, startups should weigh their decision against two key criteria:</p><ol start="1"><li>The opportunity cost of doing it yourself</li><li>The potential cost of getting it wrong</li></ol><p>B2B buyers have never had more options for the SaaS solutions they adopt. Consider the marketing technology landscape, with over <a href="https://chiefmartec.com/2020/04/marketing-technology-landscape-2020-martech-5000/" target="_blank" rel="noreferrer noopener">8,000 products</a> that promise some variation of the same value proposition. Building a single sign-on solution from scratch might meet the requirements of the enterprise customer you‚Äôre trying to close a deal with, but it also takes away from your team‚Äôs ability to work on the core customer problems your technology aims to solve. While you‚Äôre bogged down learning the nuances of SAML protocols, competitors can double down on product innovation and focus on delivering differentiated value from your offering. </p><p>Additionally, putting the responsibility of building mission-critical infrastructure onto developers whose core expertise lies outside of security is a risky proposition because the financial and social costs of getting it wrong are severe. Identity is increasingly becoming a target for bad actors. According to Verizon‚Äôs 2021 Data Breach Investigations Report, <a href="https://www.verizon.com/business/resources/reports/dbir/" target="_blank" rel="noreferrer noopener">80% of web application breaches</a> involves using stolen credentials. On average, credential stuffing attacks cost businesses upwards of <a href="https://www.information-age.com/credential-stuffing-123482099/" target="_blank" rel="noreferrer noopener">4 million dollars</a> a year. Sifting through protocols and leveraging open source code‚Äîwhich has also been shown to have <a href="https://www.sonatype.com/resources/white-paper-state-of-the-software-supply-chain-2020" target="_blank" rel="noreferrer noopener">vulnerabilities</a>‚Äîmight feel like an easy option, but it‚Äôs highly stressful for internal teams, requires constant attention in the form of maintenance, and if something does go wrong, it can leave your business in tatters. </p><h2 id="Becoming--Identity--Ready-to-Fuel-Growth">Becoming <em>Identity</em> Ready to Fuel Growth</h2><p>Your identity platform should be a crucial tool in your efforts to grow and land larger customers. Auth0‚Äôs Business Customer Identity solution is purpose-built for the unique needs of B2B SaaS organizations. With it, customer requirements around Enterprise SSO and Multi-Factor Authentication are available out-of-the-box. Coupled with our high availability cloud services that ensure a <a href="https://status.auth0.com/" target="_blank" rel="noreferrer noopener">99.99%</a> SLA, you‚Äôll have another great reason for that larger customer to sign on the dotted line.</p><p>Development teams can quickly implement Auth0 into your application with well-documented APIs and SDKs. In fact, many of our customers go live in <a href="https://auth0.com/case-studies/innit-inc/" target="_blank" rel="noreferrer noopener">less than a month</a> and have been able to <a href="https://auth0.com/resources/whitepapers/how-development-teams-purchase-saas?utm_content=dsa&amp;gclid=Cj0KCQiAosmPBhCPARIsAHOen-NkJJirZcFB7dOkaSL7_S3nBwgTP9G1yZ-pxJ0pK8Eal8ZKRncqI_IaAszlEALw_wcB" target="_blank" rel="noreferrer noopener">shorten their time to market</a> for other key product capabilities. </p><p>You‚Äôll also have the peace of mind of having an on-demand, identity security system in place. Secure the data of your business customers by quickly adding protection against some of the most common attacks on identity systems out of the box. From bot attacks to credential stuffing, Auth0 takes the burden of identity security off your internal teams so that they can focus on shipping new features for your product.</p><p>Importantly, all of this can be managed programmatically and at scale using Auth0 Organizations, which can help you represent all your business customers in your multi-tenant application.  </p><p>If you‚Äôre interested in learning how other SaaS businesses used Auth0 to move upmarket and nab larger customers, check out our <a href="https://auth0.com/case-studies/sendoso/" target="_blank" rel="noreferrer noopener">Sendoso case study</a>. </p><h2 id="Gartner-Trademark">Gartner Trademark</h2><p>GARTNER is a registered trademark and service mark of Gartner, Inc. and/or its affiliates in the U.S. and internationally and is used herein with permission. All rights reserved.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Wed, 02 Mar 2022 14:59:00 +0000</pubDate>
    </item>
    <item>
      <title>Enable Fingerprint Authentication with Auth0</title>
      <link>https://auth0.com/blog/enable-fingerprint-authentication-with-auth0/</link>
      <description>Learn how to enable fingerprint authentication for login with Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Over the years, how you prove your identity and login to websites has changed. From using only a password, using a password plus a code sent your mobile device, using authenticator apps, to even going <em>passwordless</em> by having an email sent to you and logging in there. Each iteration is an attempt to keep your identity safe and secure. </p><p>WebAuthn was announced as the recommended standard for passwordless login in recent years. WebAuthn is a browser-based API that allows secure user authentication by using registered devices (phones, laptops, etc.) as authentication factors. This blog post will show you how fast you can enable device biometrics for your users to log in using the Auth0 dashboard.</p><h2 id="What-You-ll-Need">What You&#39;ll Need</h2><p>To enable and test out fingerprint authentication, you will need a few things:</p><ul><li><strong>Auth0 Account.</strong> Sign up for a <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">free Auth0 account</a> if you don&#39;t have one.</li><li><strong>Any application that uses your Auth0 tenant to provide Universal Login.</strong> Any web-based, mobile, or desktop application will do, just as long as it is one of your tenant&#39;s applications. If you don&#39;t have any applications that use Auth0 for authentication, you can download one from the <a href="https://auth0.com/docs/quickstarts/" target="_blank" rel="noreferrer noopener">Auth0 Quickstarts</a> page.</li><li><strong>WebAuthn Compatible Device</strong> A computer or smartphone with biometrics built-in (Touch ID on Mac, for example).</li></ul><h2 id="Enable-Biometric-Login-Flow">Enable Biometric Login Flow</h2><p>On the left-side menu of the Auth0 dashboard, click <strong>Authentication&gt;Authentication Profile</strong>. The <em>Authentication Profile</em> page is where you choose how users will authenticate their identity when logging in to your application. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/646bZGVEd7cE2iyRioHonq/ac74ca497a3f913cecdeedc05f9a1abc/auth0_dashbord.png" alt="Auth0 Dashboard Side Menu"/></p><p>You&#39;ll have the option to choose between three different login flows:</p><ul><li><strong>Identifier + Password</strong> <ul><li>a single login screen that asks for the username and password.</li></ul></li><li><strong>Identifier + First</strong> <ul><li>has two screens. One for the users to enter an identifier, then another screen for the password.</li></ul></li><li><strong>Identifier First + Biometrics</strong> <ul><li>allows users to sign in using face or fingerprint recognition instead of a password.</li></ul></li></ul><p>Click <strong>Identifier First + Biometrics</strong> then click <strong>Save</strong>. This sets the login box to ask for an identifier first, like an email address, then ask for the biometrics identifier like a fingerprint. </p><p>After a device is registered for authentication, this creates a secure relationship between the application and the device, allowing users to login in a secure manner. Click <strong>Confirm</strong> on to enable Webauthn device biometrics.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/54D7A7i1R4hSgrTsvu9MVK/cdfeb155c3eed9fad84be4cb7e73c0b7/webauthn_confirmation.png" alt="WebAutn Device Biometrics Confirmation Modal"/></p><p>The following user who logs in or signs up will be prompted to enroll their device for quick and secure login. Let&#39;s test out this flow from the users&#39; perspective.</p><blockquote><p>Learn more about WebAuthn and test out using hardware authentication with the interactive demo on <a href="https://webauthn.me/" target="_blank" rel="noreferrer noopener">webauthn.me</a>. A site maintained by Auth0.</p></blockquote><h2 id="Test-WebAuthn-Enrollment">Test WebAuthn Enrollment</h2><p>The fastest way to test this is right on the <em>Authentication Profile</em> page. In the upper right-hand corner, click <strong>Try</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/155RocmMWOUTnwRI6vYDqP/f5cde8f2a017d5a37b154538edf97f9a/try_button.png" alt="Auth0 Dashboard Authentication Profile Page"/></p><p>This will bring up the Auth0 universal login box. You&#39;ll log in with a username and password as normal. Once those credentials are verified, you&#39;ll be met with the &#34;Login in faster on this device&#34; prompt. Which lets you know that you use your fingerprint or face recognition to log in. Click <strong>Continue</strong></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6nQuQcDC6aLDDJBGSvIieK/3180262b363896a99d371c0229cc28c4/Screen_Shot_2022-02-23_at_4.37.39_PM.png" alt="Auth0 Long In Faster Screen"/></p><p>Clicking continue brings up a prompt from your device alerting you that your browser is trying to verify your identity. You then register your fingerprint using something like Touch ID if you&#39;re using a Mac.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/45MRt2zzkxol16HSy8aNuy/9daf52c856f8d176182c90f719007ff4/Screen_Shot_2022-02-23_at_4.38.15_PM.png" alt="macOS Touch ID prompt"/></p><p>Finally, it will ask you to name your device; click <strong>Continue</strong> the next screen lets you know that the device is successfully registered. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6eEg5vwZoXM4ApVeHFhpMv/dfd5b6d077af23b74f1889f689c31d46/Screen_Shot_2022-02-24_at_11.51.43_AM.png" alt="Device Registered Confirmation Page"/></p><p>Once a device is registered, the user will no longer log in with a password. They will enter their email address and log in with their fingerprint! How cool is that?</p><blockquote><p>Users can still log in with their password as a backup. </p></blockquote><h2 id="Benefits-of-WebAuthn">Benefits of WebAuthn</h2><p>Using WebAuthn for passwordless login has many benefits. </p><ul><li>Customers don&#39;t have to worry about remembering passwords or requesting passcodes to be sent to a separate device</li><li>Removes barriers to customers to sign in/up for applications</li><li>Lower risks of impersonating identity because it&#39;s hard to steal a device where the biometrics are stored.</li><li>Maintain customer trust by using a secure authentication method</li></ul><h2 id="Conclusion">Conclusion</h2><p>Moving towards more advanced authentication methods like WebAuthn is a great way to delight your users and build trust in your company. Keeping users safe from potential security exploits is a hard job. Data breaches are becoming common. Auth0 is staying up to date with web security standards and creating solutions that integrate seamlessly into your application. </p><p>To learn more about WebAuthn and how to use it with Auth0, check out the <a href="https://auth0.com/docs/secure/multi-factor-authentication/fido-authentication-with-webauthn" target="_blank" rel="noreferrer noopener">FIDO Authentication with WebAuthn Docs</a></p></div></div>]]></content:encoded>
      <pubDate>Mon, 28 Feb 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Customize Auth0 Universal Login with Auth0 CLI</title>
      <link>https://auth0.com/blog/customize-auth0-universal-login-with-auth0-cli/</link>
      <description>Use the Auth0 CLI to customize the colors of the Universal Login page.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Your login screen is the very first thing people see before they enter their personal information on your website. You want to give the best impression possible. Securing their data with Auth0 is a great first step. It also leads to a login page branded with the colors and the logo of Auth0. Don&#39;t get me wrong, the branding looks excellent, but the inconsistent branding can startle some users.</p><p>Today you&#39;ll learn how to use the <a href="https://github.com/auth0/auth0-cli" target="_blank" rel="noreferrer noopener">Auth0 CLI</a> to customize your login page without leaving your terminal.</p><h2 id="What-You-ll-Need">What You&#39;ll Need</h2><p>You need a couple of things in place to follow along with this tutorial: </p><ul><li><p><strong>Auth0 Account.</strong> If you do not have one, you can sign up for a <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">free Auth0 account</a>.</p></li><li><p><strong>Application in your Auth0 tenant.</strong> If you don&#39;t have an application in your Auth0 dashboard, don&#39;t worry; I will show you how to download one of Auth0&#39;s quickstarts.</p></li></ul><h2 id="What-Is-the-Auth0-CLI">What Is the Auth0 CLI</h2><p>Auth0 wants to create tools that make developers&#39; work more manageable since we are a  developer-first company. With the CLI, we&#39;re reducing the number of steps and clicking around you have to do on the Auth0 Dashboard and keeping your workflow in the terminal. </p><p>This allows you to set up your applications faster, test logging in, get error log information, and more within the terminal. I&#39;m blown away by how many features are packed in this tool. Today, I&#39;ll show how to update an application&#39;s login page in your Auth0 Dashboard.</p><blockquote><p>Get an introduction to the Auth0 CLI by reading <a href="https://auth0.com/blog/introducing-auth0-cli/" target="_blank" rel="noreferrer noopener">this blog post</a>.</p></blockquote><h2 id="Install-the-Auth0-CLI">Install the Auth0 CLI</h2><p>You can install the Auth0 CLI on macOS, Windows, and Linux. Here are the commands for each:</p><h3 id="macOS-with-Homebrew">macOS with Homebrew</h3><pre><code>brew tap auth0/auth0-cli <span>&amp;&amp;</span> brew <span>install</span> auth0</code></pre><h3 id="Windows-manual-installation">Windows manual installation</h3><ul><li>Download the Windows binary from the latest release: <a href="https://github.com/auth0/auth0-cli/releases/latest/" target="_blank" rel="noreferrer noopener">https://github.com/auth0/auth0-cli/releases/latest/</a></li><li>Extract</li><li>Run <code>auth0<span>.</span>exe</code></li></ul><h3 id="Linux-with-Homebrew">Linux with Homebrew</h3><pre><code> brew tap auth0/auth0-cli <span>&amp;&amp;</span> brew <span>install</span> auth0</code></pre><p>I always like to double-check after I install new tools. With the newly available <code>auth0</code> command, type <code>auth0 <span>-</span>v</code> to check the version and confirm the installation. The next thing you need is to sign to your Auth0 account and authenticate the CLI.</p><h3 id="Connect-CLI-and-login-to-Auth0-account">Connect CLI and login to Auth0 account</h3><p>Sign in to your Auth0 account from the CLI by typing:</p><pre><code>auth0 login
‚ú™ Welcome to the Auth0 CLI üéä

If you don&#39;t have an account, please go to https://auth0.com/signup

Your Device Confirmation code is: JKHH-QKFM

 ‚ñ∏ Press Enter to <span>open</span> the browser to log <span>in</span> or ^C to quit<span>..</span>.</code></pre><p>You&#39;ll get welcomed to the Auth0 CLI, and you&#39;ll get a confirmation code. Press <strong>Enter</strong> on your keyboard. This will open a page in your browser asking you to verify the code on this page matches the one on the CLI. Click <strong>Confirm</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/44GTGeMlFm6LTsdejiHGyl/fa7b4b313b99a3af9276a7e8f07a0ab4/device-confifmation.png" alt="Auth0 CLI Device Confirmation Page"/></p><p>Next, you meet the <em>Authorize App</em> page. You can choose which Auth0 tenant you want to log in to if you have more than one. You&#39;ll see a long list of permissions that the Auth0 CLI wants to have on your account. Scroll down and click <strong>Accept</strong></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2jFFU4iSSeFng3B18oPWH3/d5b71fc09e702d7d59cba32c2848a0c0/auth-cli.png" alt="Auth0 Authorize App Page"/></p><p>Back in your terminal, you&#39;ll see a message that you&#39;re logged in successfully. </p><pre><code>Waiting <span>for</span> login to complete <span>in</span> browser<span>..</span>. <span>done</span>

 ‚ñ∏    Successfully logged in.
 ‚ñ∏    Tenant: YOUR_AUTH0_DOMAIN.us.auth0.com</code></pre><p>If you already have an application in your Auth0 tenant, you can skip to <strong><a href="#Edit-the-Universal-Login-Page">Edit the Universal Login Page</a></strong>.</p><h3 id="Create-a-new-application-with-Auth0-quickstart">Create a new application with Auth0 quickstart</h3><p>If you don&#39;t have an application registered in the Auth0 Dashboard, you can create one from the CLI. Run the following command:</p><pre><code>auth0 app create</code></pre><p>The CLI will ask you to name your application and write a description for it. Then, you&#39;ll be asked to choose a type in this example, I&#39;ll a React application, so select <strong>Single Page Application</strong>. After that, you&#39;ll be asked to enter <em>Allowed Callback URL</em> then <em>Configure Logout URLs</em> enter <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>3000</span></code> to follow along with this example. You&#39;ll get a message confirming you created your new application successfully.</p><pre><code> Name: New CLI app
 Description: testing this out
 Type: Regular Web Application
 Allowed Logout URLs: http://localhost:3000</code></pre><p>Now that you&#39;re logged and have an application created, you can edit the login page.</p><h2 id="Edit-the-Universal-Login-Page">Edit the Universal Login Page</h2><p>There are two ways to edit the login page. One way requires a custom domain on your Auth0 account because it sets up a custom page template with custom HTML and JavaScript. </p><p>The second option lets you only update the colors and logos. This post will show you the latter.</p><blockquote><p>Custom domains is an Auth0 paid feature that lets you use your own domain name on the login page. Learn more about them by <a href="https://auth0.com/docs/customize/custom-domains" target="_blank" rel="noreferrer noopener">checking out the Custom Domain docs</a></p></blockquote><p>Run the <code>branding update</code> command to customize the colors and logo.</p><pre><code>auth0 branding update</code></pre><p>The first prompt that you&#39;ll get will ask for the accent color. It will take hex color code. I&#39;m going to use this lovely shade of purple <code>#<span>664</span>EAE</code></p><p>The following prompt is for the background color. This changes the color of the <em>Login</em> button. The default is black; I will use <code>#<span>FFF</span></code> for white.</p><pre><code>Accent Color: <span>[</span>? <span>for</span> help<span>]</span> <span>#664EAE</span>
Background Color: <span>[</span>? <span>for</span> help<span>]</span> <span>#FFF</span></code></pre><p>After that, you&#39;ll get a message in the terminal saying your tenants&#39; branding is updated.</p><p>Below that, you&#39;ll see some other options you can update as well. Like the favicon and the logo:</p><pre><code> ACCENT COLOR <span>#664EAE </span>
 BACKGROUND COLOR <span>#FFF </span>
 LOGO URL 
 FAVICON URL 
 CUSTOM FONT URL</code></pre><p>Let&#39;s replace the Auth0 logo with yours. Make sure that the logo URL uses the <code>https</code> scheme.</p><p>To update the logo, run the <code>auth0 branding update</code> command, but this time add the <code><span>--</span>logo</code> flag with the URL for the logo:</p><pre><code>auth0 branding update --logo <span>&#34;https://URL_OF_LOGO&#34;</span></code></pre><p>You&#39;ll then see another message confirming that the branding for this Auth0 domain has been updated.</p><pre><code><span>==</span><span>=</span> YOUR_AUTH0_DOMAIN.auth0.com branding updated</code></pre><p>You&#39;ll probably want to see the beautiful login page. Right? You can do that right from the command line without running your whole app.</p><h2 id="Test-the-New-Login-Screen">Test the New Login Screen</h2><p>Testing out logins on the Auth0 dashboard is a fast process. With just two clicks on the mouse, you could have a login screen for your account up and running.</p><p>It&#39;s even faster with the CLI. First, enter the <code>auth0</code> test command with the <code>login</code> option. Next, you&#39;re asked to select which application you want to test. Then, you are asked to choose a domain. Finally, you&#39;re asked, <code>Do you wish to proceed<span>?</span></code>. Type <code><span>Y</span></code> for yes:</p><pre><code><span>&gt;</span> auth0 <span>test</span> login
 Client ID: Testing CLI <span>(</span>Eo2zq27soy4CzgCugBGGLGub3kkWvf3c<span>)</span>
 Custom Domain: none <span>(</span>use dev-training-test.us.auth0.com<span>)</span>
 ‚ñ∏ A browser window will <span>open</span> to begin this client&#39;s login flow.
 ‚ñ∏ Once login is complete, you can <span>return</span> to the CLI to view user profile information and tokens.

 Do you wish to proceed? Yes</code></pre><p>After that, a browser window will open, and you&#39;ll see your new custom login page! </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7suWtKxX7i3N3pF6OIQamW/75c6e9c156ab5aef8018ddc7ca515f42/custom_login.png" alt="Auth0 Custom Login Page"/></p><h2 id="Summary">Summary</h2><p>The Auth0 CLI takes several features from the Auth0 dashboard and puts them right at your fingertips. </p><p>It can handle logging in and connecting to your Auth0 account. 
You can create and configure new applications. 
You can even update the colors and preview the login page! </p><p>You can use all these features and more without leaving your terminal.</p><p>The Auth0 CLI has even more features to explore that will improve your workflow! You can find out other commands and features by reading the <a href="https://auth0.github.io/auth0-cli/" target="_blank" rel="noreferrer noopener">Auth CLI docs</a>.</p><p>Let me know in the comments what you find out!</p></div></div>]]></content:encoded>
      <pubDate>Fri, 25 Feb 2022 14:52:00 +0000</pubDate>
    </item>
    <item>
      <title>What is GovTech?</title>
      <link>https://auth0.com/blog/what-is-govtech/</link>
      <description>Consumers expect seamless, high-value digital experiences, including with the public sector.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>What does it mean to build digital services that citizens both use and trust? From the local to the national, generating effective digital transformation and <a href="https://www.sciencedirect.com/science/article/pii/S0740624X18304131" target="_blank" rel="noreferrer noopener">getting citizens onboard with digital public services</a> has been a challenge. The promise of digital government has often been muddled by institutional inertia and perceptions of government as slow-moving and bureaucratic. At the same time, positive initiatives, such as the <a href="https://ec.europa.eu/newsroom/document.cfm?doc_id=47559" target="_blank" rel="noreferrer noopener">Tallinn Declaration on eGovernment</a>, which embrace objectives as wide-ranging as improved service delivery, greater efficiency, increased transparency, interoperability, and citizen satisfaction, have begun to remove entrenched ambivalence about e-government. Modern GovTech is where these barriers collide, creating the opportunity to address newly accelerated consumer demand in the face of private-sector conveniences and the <a href="https://www2.deloitte.com/us/en/insights/industry/public-sector/government-digital-transformation-strategy.html" target="_blank" rel="noreferrer noopener">consequences of the Covid-19 pandemic</a>. </p><p>GovTech, according to public sector entities such as <a href="https://www.worldbank.org/en/programs/govtech" target="_blank" rel="noreferrer noopener">the World Bank</a>, is a technology-based ‚Äúgovernment approach to public sector modernization.‚Äù The same definition emphasizes three core areas for modernization: universal accessibility, citizen-centric services, the delivery of efficient and transparent government systems, and finally, digital transformation, all of which rely on overcoming long-cited barriers to adoption and success, such as <a href="https://doi.org/10.1145/2096140.2096142" target="_blank" rel="noreferrer noopener">citizens‚Äô willingness to use and trust services</a>.</p><p>GovTechs, an umbrella term for technology-based solutions (and the companies behind them) that power the technical aspects of digital transformation, can be a bridge between use and trust and learning to <a href="https://www.mckinsey.com/industries/public-and-social-sector/our-insights/building-the-tech-enabled-government-of-the-future-a-day-1-list-of-common-pitfalls" target="_blank" rel="noreferrer noopener">see citizens as customers</a>.</p><h2 id="Changing-User-Expectations">Changing User Expectations</h2><p>In a pure consumer context, choice and convenience rule: you can easily go online and search, comparison shop, and buy a desired product in a few clicks without thinking about any of the complexity of the transaction. Consumers naturally transfer their positive consumer expectations to all of their digital experiences,<a href="https://www.mckinsey.com/industries/public-and-social-sector/our-insights/digital-public-services-how-to-achieve-fast-transformation-at-scale" target="_blank" rel="noreferrer noopener"> according to McKinsey, raising the bar for government entities</a>. </p><p>But how many consumers have enjoyed the convenience of one-click (or similarly easy) citizen services, such as reviewing and paying utility bills, filing income taxes, or having a streamlined, one-stop car-and-driver licensing experience? Or, for example, registering for unemployment benefits digitally, making the physical queue at the unemployment office shorter and more efficient for those going through the process in person? </p><p>Rapid change has led to the expectation that public sector services offer private-sector-rivaling availability, choice, and convenience, which overrides previous consumer doubts about public sector readiness. </p><p>Driving GovTech strategy in complex public sector environments demands a delicate balance between overarching strategic questions and the nitty-gritty of implementation. For example, this balance could be examining the<a href="https://www.accenture.com/_acnmedia/pdf-90/accenture-govtech-pov.pdf" target="_blank" rel="noreferrer noopener"> underpinnings of transformation</a> strategically, such as public expectations, financial considerations, accessibility, demographics, and sustainability, against the competing operational demands of introducing new technology into hierarchical, political, and often change-resistant environments. Practically, such implementations involve extensive political and stakeholder management and support, consideration of legacy investments and programs, and a well-defined plan for rolling out proposed changes and the downstream effects these may have, whether positive or negative. </p><p>Ultimately, the strategy for selecting and implementing GovTech solutions and providers rests with public sector employees who are responsible for the strategic and tactical approaches described and for meeting consumers‚Äô increasingly private-sector-style expectations. This is redefining how governments interact with citizens. </p><p>Three core considerations highlight how uniquely demanding delivering on these expectations can be for government agencies:</p><h3 id="1--Deliver-on-citizens--demands-and-expectations-">1. Deliver on citizens‚Äô demands and expectations.</h3><p>Government digital transformation is different from its private-sector counterpart. Historically,<a href="http://dx.doi.org/10.4018/IJIDE.2019010102" target="_blank" rel="noreferrer noopener">how consumers perceive and use public and private sector services has differed</a>. However, societal changes stemming from the Covid-19 pandemic and the attendant shift to living life almost 100% online have resulted in heightened citizen expectations for public services to be available digitally in the same way as online shopping and food delivery. As a result, old barriers against citizens&#39; willingness and ability to use e-gov services have declined significantly. </p><h3 id="2--Balance-privacy-and-user-experience-">2. Balance privacy and user experience.</h3><p>More fundamentally, the private sector is driven by consumer demand and choice, incentivized by increasing profit and reducing cost. While the public sector shares these concerns, because citizens often do not have a choice in deciding whether to interact with the government, the government‚Äôs primary aim is to provide services to citizens efficiently while building trust, safeguarding citizens‚Äô data privacy, and ensuring compliance with regulations, mandates, and standards to which government agencies are tied. Trust remains an important issue for consumer-citizens, who<a href="https://www.ey.com/en_no/government-public-sector/how-can-digital-government-connect-citizens-without-leaving-the-disconnected-behind" target="_blank" rel="noreferrer noopener"> perceive a level of risk in exposing their private data to public entities in ways they don‚Äôt when dealing with private entities</a>. For public sector agencies, privacy concerns have historically taken precedence over user experience, but they need to prioritize privacy and security over user experience and convenience is beginning to change as GovTechs offer secure solutions leveraging modern infrastructure and economies of scale that facilitate both outcomes at a lower overall cost.</p><h3 id="3--Make-public-services-accessible-to-all-citizens-">3. Make public services accessible to all citizens.</h3><p>The rapid digitization of society champions convenience above all, but digital-only approaches can create <a href="https://www.openaccessgovernment.org/accessibility-making-government-work-better/55530/" target="_blank" rel="noreferrer noopener">accessibility blindspots</a> and <a href="https://www.ey.com/en_au/government-public-sector/how-can-clever-governments-choose-to-close-the-digital-divide" target="_blank" rel="noreferrer noopener">exacerbate the digital divide</a>. Government agencies must serve <em>all</em> citizens, which means designing for everyone or else disenfranchise citizens who do not have access to digital services, devices, or connectivity. </p><h2 id="How-Can-GovTech-Enable-These-Citizen-Experiences-">How Can GovTech Enable These Citizen Experiences?</h2><p>Government agencies want to deliver on these citizen expectations because the agency benefits by achieving its mission, improving efficiency, and reaching all of its citizens ‚Äî ultimately benefiting citizens. </p><p>‚ÄúA valuable function of government is providing all constituents with equal opportunity to access different services. By enhancing government with modern technologies, citizens are presented with multiple paths to the same services. These paths can now be both digital and in-person avenues, allowing the government to be more efficient in providing the right access to the right group of people,‚Äù Auth0‚Äôs Jeet Shah, Identity Architect, and Senior Solutions Engineer explains. ‚ÄúGovTechs introduce options for how citizens are served, allowing governments to dedicate resources more effectively. Citizens who prefer interacting with their governments online allow in-person services to be more accessible and can ultimately improve the quality. GovTech vendors and what they provide to governments ultimately leads to better services for all constituents.‚Äù </p><p>GovTech grows from two branches: the first is the services governments offer to their citizens, the second is the vendors that enable those services. Governments furnish services in line with citizen expectations, which brings together these two branches.</p><h3 id="Government-services-to-citizens--Focus-on-usability-and-trust">Government services to citizens: Focus on usability and trust</h3><p>At the heart of delivering efficient public services is the ability to unify disparate, siloed departments and functions under a single sign-in. Forcing citizens to keep track of and maintain access to multiple portals and sites creates friction and disincentivizes use while also introducing the greater potential for security vulnerabilities and data privacy breaches. </p><p>At the same time, maintaining this fractured setup is less efficient, potentially open to fraud, and forfeits opportunities for fostering citizen trust and personalizing user experiences. For example, imagine being able to offer all citizen services through a centralized digital portal or app with a single sign-on experience. From license renewal to viewing existing permits to paying bills, governments can leverage GovTech that enable these features and gather user analytics simultaneously to feedback into personalization efforts and a deeper understanding of citizen needs and wants.</p><h2 id="Identity-Jumpstarts-GovTech-Services">Identity Jumpstarts GovTech Services</h2><p><a href="https://doi.org/10.1007/978-3-030-57599-1_4" target="_blank" rel="noreferrer noopener">Various barriers have slowed technology-driven public sector transformation</a> over the past two decades. Many of these barriers, such as embedded organizational and cultural issues, existing processes, and legacy structures and infrastructure, persist regardless of technology. The impetus to accelerate the pace of change, however, has positioned GovTech to play a key role in helping to overcome some of these barriers. </p><p>Identity enables all levels of government to bring their services to more citizens via the channels they prefer and already have access to. If the barrier faced is the difficulty of use, unified identity simplifies usability for both the government agency and the citizen user. If the barrier is trust, secure and transparent identity technologies can breakthrough. </p><h3 id="Vendor-service-enablers--Auth0-for-unifying-identity">Vendor service enablers: Auth0 for unifying identity</h3><p>Auth0 is a GovTech vendor that, in this case, acts as an umbrella, freeing government agencies from service and platform fragmentation by bringing them together under a single, flexible sign-on solution. By reducing infrastructural complexity and providing options government agencies can use to offer services across multiple vectors, Auth0 helps public sector entities to expand the base of citizens who can access their services. </p><p>By doing the heavy lifting of the platform and digital identity consolidation, Auth0 enables governments to reorganize and reprioritize resource allocation for more efficient processes ‚Äì dedicating resources to digitizing what is possible and improving those that cannot be digitized.</p><p>If you‚Äôd like to learn more about how identity can accelerate digital change and invite citizens along for the journey, please get in touch with the <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">team at Auth0</a>.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 24 Feb 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Unified Login Flows and Data Location Choices in DACH</title>
      <link>https://auth0.com/blog/unified-login-flows-and-data-location-choices-in-dach/</link>
      <description>Companies in the DACH region use Auth0 to streamline their login flows and consolidate their user data</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Customers expect a great user experience (UX) from their web apps. They also expect the companies behind those apps to keep their personal data private and secure. The challenge for businesses in this environment is how to create a low-friction customer experience (CX) while seamlessly integrating the necessary security features, privacy features, and data flows. Data from <a href="https://info.auth0.com/erwartungen-und-realitat.html" target="_blank" rel="noreferrer noopener">Auth0‚Äôs global survey</a>, including more than 2,000 consumers and 200 IT/marketing decision-makers in Germany, shows that in the DACH region, there are some mismatches between these two forces.</p><p>Nearly one-third of German consumers (31%) are more likely to sign up if an app offers biometric authentication. Yet a mere 17% of German businesses offer it. Similarly, 40% of German consumers are more likely to sign up if they can use Multi-factor Authentication (MFA), but only one in four businesses (27%) offer that security feature. These consumers also cited lengthy login and sign-up forms (42%) and entering personal information (38%) as their top frustrations with the sign-up process for new applications.</p><p>The question companies in Germany, Austria, and Switzerland need to answer is, ‚Äúhow do we address these mismatches when designing customer-facing web applications?‚Äù We‚Äôve been looking at various ways Auth0 can assist in this process with our series on customer identity and access management (CIAM) in Central Europe. We‚Äôve looked at how a robust CIAM solution can help bridge the gap between legacy and cloud-native infrastructure, as well as how organizations can have options to support their data residency needs when partnering with an identity as a service (IDaaS) provider. In this post, we‚Äôre going to discuss how three particular businesses are doing all of that, and more, with the help of Auth0.</p><ul><li><a href="https://auth0.com/blog/bridging-legacy-systems-and-digital-transformation-with-ciam" target="_blank" rel="noreferrer noopener">Bridging Legacy Systems and Digital Transformation with CIAM</a></li><li><a href="https://auth0.com/blog/centralize-identity-for-security-and-customer-experience" target="_blank" rel="noreferrer noopener">Centralize Identity For Security and Customer Experience</a></li></ul><h2 id="Using-Auth0-to-Bridge-the-Legacy-cloud-Gap">Using Auth0 to Bridge the Legacy-cloud Gap</h2><p>According to a <a href="https://www.mckinsey.com/business-functions/strategy-and-corporate-finance/our-insights/how-covid-19-has-pushed-companies-over-the-technology-tipping-point-and-transformed-business-forever" target="_blank" rel="noreferrer noopener">recent study by McKinsey</a>, the COVID-19 pandemic accelerated the digitization of customer interactions by three years for companies in Europe. The same study found an impressive seven-year acceleration when it asked about services being digitized. While this trend started before the COVID-19 pandemic, that global event certainly sped things up for many organizations. What many are discovering is that it can be complicated to develop a single CIAM tool that can connect customers to both legacy on-prem systems and those they have already migrated to the cloud.</p><p>Auth0‚Äôs extensibility, along with the ease of integration provided by <a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a> and low-code <a href="https://auth0.com/actions" target="_blank" rel="noreferrer noopener">Actions</a>, simplifies the process of closing this gap. Rather than developing in-house identity solutions that only work on a single asset, which leads to siloed customer data and authentication systems that are difficult to maintain, Auth0 gives you a single intuitive login box that‚Äôs connected to whatever systems a customer is supposed to have access to. And you get a single source of truth (SSoT) for your customer data, aiding in regulatory compliance as it simplifies your access to that data.</p><h2 id="Offloading-IDaaS-While-Maintaining-Control-Over-Your-Data">Offloading IDaaS While Maintaining Control Over Your Data</h2><p>The second challenge is easier to address when you have that SSoT for your customer data in place. By bringing all of your properties under one CIAM solution, you‚Äôre able to store all user data in a single database. And in the case of Auth0 in DACH, that database can be located in an AWS facility in Frankfurt for public cloud options, and we also offer <a href="https://auth0.com/blog/auth0-on-microsoft-azure-as-a-private-cloud-deployment-option/" target="_blank" rel="noreferrer noopener">private cloud deployments on Microsoft Azure</a> and AWS infrastructure. Multiple cloud deployment options, along with our <a href="https://auth0.com/docs/compliance/gdpr" target="_blank" rel="noreferrer noopener">expertise in privacy regulations</a> in the region, mean you have a greater set of tools at your fingertips, giving you choices about where and how your data is stored. </p><p>CIAM is a need that crosses industry verticals and markets, so we‚Äôre going to look at three organizations that span the business world in the DACH region: energy provider Energie Baden-Wurttemberg (EnBW), infrastructure leader Siemens, and travel platform HolidayCheck.</p><h2 id="EnBW--Expanding-Their-Reach-While-Staying-Close-to-Their-Customers">EnBW: Expanding Their Reach While Staying Close to Their Customers</h2><p>Energie Baden-Wurttemberg, or <a href="https://auth0.com/blog/enbw-uses-auth0-to-improve-its-customer-experience/" target="_blank" rel="noreferrer noopener">EnBW</a>, is one of the largest energy companies in Germany and in Europe, serving millions of customers daily. Their menu of services includes gas, water, electricity, and a growing number of ancillary services. They‚Äôre experiencing solid growth and found themselves needing to consolidate identity for both their business and private customers.</p><p>EnBW needed to streamline their login process by consolidating decentralized login interfaces and ensuring their customers understood everything they were doing to ensure the security and privacy of that data. All while providing a seamless user experience across platforms. Auth0 <a href="https://auth0.com/extensibility" target="_blank" rel="noreferrer noopener">extensibility</a> and <a href="https://auth0.com/docs/integrations" target="_blank" rel="noreferrer noopener">integrations</a> allowed them to create a single, unified login experience whether the customer was a business or individual homeowner, and regardless of whether they needed to pay a gas bill or ask a question about their water service. As they looked at their expansion plans, the digitization team at EnBW saw the need for an identity solution that would help them move closer to their customers while they continued to grow their service offerings.</p><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúDigital transformation is more than just an isolated project or the development of an app. Rather, it is a matter of laying a long-term technical foundation for improving proximity to the customer. By using the Auth0 solution, we are able to do just that. This enables us to offer a consistent customer experience across all digital services...‚Äù</p><p>Florian Riedl</p><p>Head of Digitisation</p><p>EnBW</p></div><p>Local data storage options was one consideration for EnBW when they built their strategy for maintaining proximity to their customers. Auth0‚Äôs certifications and regulatory expertise, along with the ability to store data locally at an AWS data center in Frankfurt, provide EnBW with verification to show their customers while ensuring the company has easy access to downloading their own data for their compliance audit requirements.</p><h2 id="Siemens-ID--Powered-by-Auth0">Siemens ID: Powered by Auth0</h2><p>As part of their recent pivot to adopting a more sustainable growth model, international infrastructure and manufacturing automation leader <a href="https://auth0.com/case-studies/siemens/" target="_blank" rel="noreferrer noopener">Siemens</a> understood they were going to need an identity solution that could scale with them. With a history going back over 170 years, they already had an extensive ecosystem of back-office systems, front-end services, and web applications that all needed to be consolidated under a new identity platform. </p><p>Prior to their pivot, Siemens was applying internal policies to external accounts. This set-up caused confusion on the part of partners and customers, was prone to breaking down and led to problems related to <a href="https://auth0.com/blog/what-is-broken-authentication/" target="_blank" rel="noreferrer noopener">broken authentication</a>. The goal for their identity project was to create a uniform login experience for their customers and partners with a single IDaaS solution. Bringing everyone under one log-in system would allow Siemens better control over who had access to what data and put an end to their authentication problems.</p><p>For help, Siemens turned to Auth0. They were drawn in by our extensibility, customizability, and centralized control over their <a href="https://auth0.com/blog/using-auth0-for-b2b-multi-and-single-tenant-saas-solutions/" target="_blank" rel="noreferrer noopener">multi-tenant</a> setup. The latter means that each division within Siemens retains control over the customer experience for their product, yet all user data ends up in the same centralized data store. This ability helped sell the project when it came time to get buy-in from new product teams. </p><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúWhen Auth0 stepped in, we could improve the processes around identity management, reducing efforts while increasing the acceptance of the internal stakeholders.‚Äù</p><p>Hugo Francisco</p><p>Service Owner</p><p>Siemens ID</p></div><h2 id="HolidayCheck-Uses-Auth0-to-Increase-User-Trust">HolidayCheck Uses Auth0 to Increase User Trust</h2><p>Providing trustworthy reviews (9 million and counting) of hotels and other destinations to their user base of 13+ million monthly visitors is what <a href="https://auth0.com/case-studies/holidaycheck/" target="_blank" rel="noreferrer noopener">HolidayCheck</a> is all about. They also host over 10 million holiday pictures submitted by their dedicated users. And all of this user-generated content (UGC) needs to be available regardless of the platform the customer uses, whether a smartphone, tablet or laptop. With so much UGC, HolidayCheck knows that trust is a key component of their success.</p><p>This is why HolidayCheck partnered with Auth0 to develop an IDaaS solution that would engender trust in those users. Trust that a review or photo is from who it claims to be from and that those users are who they say they are. That trust needed to extend to the value HolidayCheck puts on their users and have the privacy of their data top of mind at all times. The security of their UGC is of paramount importance to HolidayCheck, and Auth0‚Äôs deep knowledge of regulations that are important to customers in the DACH region was another reassuring factor for their decision-makers.</p><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúI think this is what we at HolidayCheck stand for: to provide the best information so that you don&#39;t get any bad surprises. Knowing that a real, verified person is behind the content is a big benefit.‚Äù</p><p>Bjorn Zadadlo</p><p>Director of Technology</p><p>HolidayCheck</p></div><p>Prior to partnering with Auth0, HolidayCheck used an in-house identity solution. They soon understood how resource-intensive maintenance and support had become, along with how low the ROI on those expenses was. This led them to search out a secure, private IDaaS solution that would deliver the same great CX their customers had come to expect. </p><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúIf authentication works well and reliably and becomes very low friction for the user, that just means to the user that you&#39;re building a well-working website. It&#39;s important that users can also trust you with providing their data. That&#39;s what you&#39;re doing with login or identity management: you&#39;re providing data to a company, and you usually don&#39;t do that if you don&#39;t trust them.‚Äù</p><p>Stefan Lau</p><p>Software Developer</p><p>HolidayCheck</p></div><p>The partnership with Auth0 brought them the right combination of these features while allowing their expert development teams to focus on delighting their customers with new site-wide features while we handled the authentication service, support, and maintenance.</p><h2 id="Organizations-Across-the-DACH-Region-Trust-Auth0-With-Their-Identity-Needs">Organizations Across the DACH Region Trust Auth0 With Their Identity Needs</h2><p>Maybe you‚Äôre expanding your portfolio of web applications and need an identity solution that can bridge the gap between legacy and modern cloud-based infrastructure while you iterate a migration strategy. Or perhaps you‚Äôre looking to centralize your identity management with a single log-in box that connects your diverse user base to whichever property they need while keeping your customer data private and secure. Whatever your situation, Auth0 can help. <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">Reach out to our DACH team</a> to learn more about how you can put our expertise to work serving your customers today.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 21 Feb 2022 15:08:00 +0000</pubDate>
    </item>
    <item>
      <title>Limit User Registration to Specific Dates with Auth0 Actions</title>
      <link>https://auth0.com/blog/limit-user-registration-to-specific-dates-with-auth0-actions/</link>
      <description>With Auth0‚Äôs Actions, it‚Äôs easy to ensure that users can sign up for an account only between a specific start date and end date.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Some applications have a limited lifetime. A website or app for limited-time events such as a conference, convention, or concert will only be useful when the event takes place. Since there‚Äôs no point in allowing people to sign up for an account after the event is over, you may want to limit registration to a specific set of dates.</p><p>It usually takes a considerable amount of work to limit the dates when new users could register an account. However, if you‚Äôre using Auth0 to authenticate your users, this task became a lot easier thanks to Actions!</p><p>Actions are a new feature that allows you to extend Auth0 beyond what it can do ‚Äúout of the box‚Äù. They‚Äôre Node.js functions that you can add to various flows within Auth0‚Äôs processes, including logging in, changing passwords, and signing up for a new account. You write and store these functions in the Auth0 dashboard, where they‚Äôre part of your tenant‚Äôs settings, and Auth0‚Äôs servers execute them.</p><p>In this article‚Äôs exercise, you‚Äôll learn how to write an Action that limits when users can sign up for an account for a specific application. If a user signs up for an account outside the defined valid registration period, their attempt to sign up will be canceled, and they will see a message explaining why.</p><h2 id="Prerequisites">Prerequisites</h2><p>You‚Äôll need the following for this exercise:</p><ul><li><strong>Auth0 account:</strong> Actions are an Auth0 feature, which means you need an Auth0 account to use them. <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">You can sign up for free,</a> and the process is pretty painless.</li><li><strong>Any application that uses your Auth0 tenant to provide Universal Login.</strong> Any web-based, mobile, or desktop application will do, just as long as it is one of your tenant‚Äôs applications. You‚Äôll need it to log in and see how defining Actions changes how login works. If you don‚Äôt have any applications that use Auth0 for authentication, you can download one from the <a href="https://auth0.com/docs/quickstarts/" target="_blank" rel="noreferrer noopener">Auth0 Quickstarts</a> page.</li></ul><h2 id="Create-a-New-Action">Create a New Action</h2><p>The first step in creating a new Action is navigating to the appropriate authentication flow. Do this by selecting <strong>Actions</strong> from the left-side menu, then select <strong>Flows</strong> from the sub-menu that appears:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6Fm12KNWxp84G1d0fo7Mwe/5a5e2ed7081685188631b9bd24210534/select_actions_then_select_flows.png" alt="The Auth0 dashboard‚Äôs ‚ÄúGetting Started‚Äù page, with instructions to select ‚ÄúActions‚Äù and ‚ÄúFlows‚Äù from the left side menu."/></p><p>You‚Äôll be at the <em>Choose Flow</em> page, where you can select the flow for your Action. In this case, we want to create an Action that runs immediately after the user submits an email address and password to sign up for an account. Do this by selecting the <strong>Pre User Registration</strong> flow:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1FuLu1sJEPZAkqr1NrCrs7/8687dc2967b23e8a8047e98fdcdb9b72/select_pre_user_registration.png" alt="The ‚ÄúChoose Flow‚Äù page, with an instruction to select ‚ÄúPre User Registration‚Äù."/></p><p>This will take you to the <em>Pre User Registration</em> flow page, which contains a flowchart depicting the pre-user registration flow in the center of the page, and a column labeled <em>Add Action</em>, which lists Actions you can add to the flow.</p><p>It‚Äôs time to create an Action to add to the flow. Do this by clicking the <strong>+</strong> button in the <em>Add Action</em> column, then select <strong>Build Custom</strong> from the menu that appears:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6oAnPkD7GIzbH7Xum2x4ra/03191b4a3cd51bbdc39e1cc073b65c6e/click_the_plus_button_then_build_custom.png" alt="The ‚ÄúPre User Registration‚Äù page, with instructions to click the ‚Äú+‚Äù button, then select ‚ÄúBuild Custom‚Äù."/></p><p>The <em>Create Action</em> dialog box will appear. Give the Action an appropriate name in the <strong>Name</strong> field. I chose <strong>Limit App 001 registration to Jan 2022</strong>. Leave the <strong>Trigger</strong> and <strong>Runtime</strong> menus at their default settings, and click the <strong>Create</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/185ogMV4v4tNO9darSqBPj/94ed284bac44add5983108887c3611f0/create_action.png" alt="The ‚ÄúCreate Action‚Äù dialog box."/></p><p>You‚Äôll be taken to the code editor for your newly created Action:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4s2yJTUGUYJvQGWr7khSdV/389419f0fa32a28ff1968e33d4dfb1f9/code_editor.png" alt="The code editor for the newly created Action."/></p><h2 id="Write-Code-for-the-Action">Write Code for the Action</h2><p>Let‚Äôs write a quick specification for the Action before we code it.</p><p>The Action should:</p><ul><li>Only affect sign-ups for a given application. In this exercise, we‚Äôll call it ‚ÄúApp 001‚Äù. It should not affect sign-ups for any other applications in the tenant.</li><li>Limit registration so that users can sign up for an account only between a given start date and end date. For this exercise, let‚Äôs limit registration to January 2022.</li><li>If a user tries to sign up before or after the registration period above, their attempt should fail, and they should be shown a message explaining why.</li></ul><p>Here‚Äôs the code that implements that specification. It limits registration to the month of January 2022. You should adjust the start and end dates for the registration period as you see fit:</p><pre><code>exports<span>.</span><span>onExecutePreUserRegistration</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>if</span> <span>(</span>event<span>.</span>client<span>.</span>client_id <span>===</span> <span>/* CLIENT ID GOES HERE */</span><span>)</span> <span>{</span>
    <span>// Remember, Date objects are GMT by default!</span>
    <span>const</span> startDate <span>=</span> <span>new</span> <span>Date</span><span>(</span><span>/* START DATE/TIME GOES HERE */</span><span>)</span> 
    <span>const</span> endDate <span>=</span> <span>new</span> <span>Date</span><span>(</span><span>/* END DATE/TIME GOES HERE */</span><span>)</span>
    <span>const</span> now <span>=</span> <span>new</span> <span>Date</span><span>(</span><span>)</span>

    <span>if</span> <span>(</span>now <span>&lt;</span> startDate <span>||</span> now <span>&gt;</span> endDate<span>)</span> <span>{</span>
      <span>const</span> <span>LOG_MESSAGE</span> <span>=</span> <span>&#34;APP 001 registration outside January 2022&#34;</span>
      <span>const</span> <span>USER_MESSAGE</span> <span>=</span> <span>&#34;Registration for this app is limited to January 2022.&#34;</span>
      api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span>LOG_MESSAGE</span><span>,</span> <span>USER_MESSAGE</span><span>)</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre><p>You‚Äôll need to customize the code above for your situation:</p><ul><li>Replace the <code><span>/* CLIENT ID GOES HERE */</span></code> comment with the application‚Äôs client ID that this Action should apply to. The Auth0 dashboard‚Äôs <em>Applications</em> list (select <strong>Applications</strong> ‚Üí <strong>Applications</strong> from the menu on the left side of the page) shows the client ID of every application in your tenant.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3p7mcb0rAUFt1zl8eSV8Uf/2234916fcfe8217c85d685fdd20fe10d/copy_client_id.png" alt="Copying a client ID from the ‚ÄúApplications‚Äù page."/></p><ul><li>Replace the <code><span>/* START DATE/TIME GOES HERE */</span></code> comment with the date and time of the start of the valid registration period. Since we want to limit registration to January 2022, use a start date value of ‚Äú2021-01-01T00:00:00‚Äù.</li><li>Replace the <code><span>/* END DATE/TIME GOES HERE */</span></code> comment with the date and time of the start of the valid registration period. For this exercise, use an end date value of ‚Äú2021-01-31T23:59:59‚Äù.</li></ul><p>Auth0 calls the <code><span>onExecutePreUserRegistration</span><span>(</span><span>)</span></code> function just after the user has provided an email address and password to sign up for an account but before the account is created. Any code entered into this function can examine the credentials provided by the user or use any other information to decide if the registration should take place or be canceled.</p><p><code><span>onExecutePreUserRegistration</span><span>(</span><span>)</span></code> takes two parameters, whose properties you can use to perform tasks prior to the user being registered:</p><ol start="1"><li><code>event</code>: An object that contains details about the request to register a new user. The Action uses <code>event</code> ‚Äôs <code>client<span>.</span>client_id</code> property to identify the application that triggered it. Remember, the limited registration period should apply only to App 001.</li><li><code>api</code>: An object with methods that you can use to change the behavior of the Pre User Registration flow. The Action uses <code>api</code>‚Äôs <code>access<span>.</span><span>deny</span><span>(</span><span>)</span></code> method to cancel registration. <code>access<span>.</span><span>deny</span><span>(</span><span>)</span></code> has two parameters:
<ul><li><code>reason</code>: A string containing an <em>internal-facing</em> reason why registration is being canceled. This value will appear in your tenant‚Äôs logs.</li><li><code>userMessage</code>: A string containing an <em>external-facing</em> reason why registration is being canceled. This value will be displayed to the user to explain why they can‚Äôt sign up for a new account.</li></ul></li></ol><p>With the code entered, click the <strong>Deploy</strong> button to save it. </p><h2 id="Add-the-Action-to-the-Flow">Add the Action to the Flow</h2><p>Now that you now have a working Action, it‚Äôs time to incorporate it into the flow.</p><p>Go back to the <em>Pre User Registration</em> page. There are a couple of ways to do this:</p><ul><li>Select <strong>Actions</strong> ‚Üí <strong>Flows</strong> from the menu on the left side of the page, then click on <strong>Pre User Registration</strong>.</li><li>If it‚Äôs onscreen, click on the <strong>Back to Flow</strong> link. It will be near the upper left corner of the code editor).</li></ul><p>Once you‚Äôre on the <em>Pre User Registration</em> page, you should see the Action you just created in the <em>Add Action</em> column:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7fNARXSPtCo7Gt0gwinM9h/682c304760f28e3dc3c250f484885b44/pre_user_registration_flow_1.png" alt="The ‚ÄúPre User Registration‚Äù flow, with an instruction to start dragging the newly-created action."/></p><p>Drag the Action into the flow, as shown in the screenshots above and below.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/p6eeehO3r4ZHl2kMrRSSu/90a3d139cca604a9c7430ead524dc1e1/pre_user_registration_flow_2.png" alt="The ‚ÄúPre User Registration‚Äù flow, with an instruction to drag the newly-created action into the flow."/></p><p>Click the <strong>Apply</strong> button near the upper right corner of the page. The change you just made to the flow will not take effect until you do so.</p><h2 id="Try-to-Sign-Up-for-an-Account">Try to Sign Up for an Account</h2><p>At this point, your Action is now part of the Pre User Registration flow. Whenever a user submits their email address and password to sign up for a new account, your Action will be triggered and execute its code.</p><p>Run the app that you wrote the Action for. Sign up for a new account instead of logging in when you reach the login screen. As long as the current date is outside your Action‚Äôs start date and end date, you should be able to enter any valid email address and password because the registration will never happen. You should see the following instead:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/w362yU7dfAnTDbLT42YHU/a2dcb648b06602cd95583cd5c2bbf591/sign-in_canceled.png" alt="The login box for the application, with a message under the ‚ÄúPassword‚Äù field that says ‚ÄúRegistration for this app is limited to January 2022.‚Äù"/></p><h2 id="Experiment-">Experiment!</h2><p>Now that you know the basics of restricting new registrations, you might want to try some different test conditions, such as:</p><ul><li><strong>Limiting sign-ups to users in specific countries.</strong> There may be legal, business, or security reasons for letting only users in specific countries sign up for an account. The <code>event</code> object provides a lot of information about the request to create a new user account, including the user‚Äôs geographical location based on their IP address, which you can access using <code>event<span>.</span>request<span>.</span>geoip<span>.</span>countryName</code>. Check out our article, <a href="https://auth0.com/blog/country-based-access-with-auth0-actions/" target="_blank" rel="noreferrer noopener"><em>Country-Based Access with Auth0 Actions</em></a>, to see how you can apply this technique to logins.</li><li><strong>Disallowing sign-ups from certain IP addresses.</strong> If you see a lot of malicious activity from certain IP addresses, you can block their sign-up requests. This is another use case where the <code>event</code> object comes in handy. Use <code>event<span>.</span>request<span>.</span>ip</code> to determine the address of the user attempting to register and deny their registration if it appears in a list of known malicious addresses.</li><li><strong>Limiting sign-ups to weekdays.</strong> You can use JavaScript‚Äôs <code><span>getDay</span><span>(</span><span>)</span></code> function to see if the current date/time falls is a weekend day. Keep in mind that while Saturday (for which <code><span>getDay</span><span>(</span><span>)</span></code> returns <code><span>6</span></code>) and Sunday (for which <code><span>getDay</span><span>(</span><span>)</span></code> returns <code><span>0</span></code>) constitute the weekend in most places, some regions have different weekend days. Once again, you may also have to account for time zone differences.</li></ul></div></div>]]></content:encoded>
      <pubDate>Thu, 17 Feb 2022 15:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0.org‚Äôs Latest Grant Recipients</title>
      <link>https://auth0.com/blog/auth0-orgs-latest-grant-recipients/</link>
      <description>5 Nonprofits Joining Auth0‚Äôs Grant Partners Program</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>As we kick off 2022, we are thrilled to welcome the addition of 5 more nonprofit organizations, plus a renewed commitment to our current grant partner Techbridge Girls, to the 35+ amazing social impact organizations we have supported through Auth0‚Äôs social impact arm, Auth0.org. Each charity in the Auth0.org program is receiving substantial unrestricted grant support and volunteer hours from Auth0 employees (‚ÄúAuzurios‚Äù).</p><p>Since its inception in mid-2020, Auth0.org has granted over $1.1 million to charitable organizations around the world, and Auziros have generously provided their time, money, expertise, and passion to many of these wonderful charities.</p><p>This latest cohort of partners is composed of amazing changemakers, globally-recognized institutions, and emerging social good orgs that are breaking down barriers and building people up ‚Äì reaching new heights in what can be accomplished when care meets cause. </p><p>The members of our latest cohort are:</p><ul><li><a href="https://goodienation.org/" target="_blank" rel="noreferrer noopener">Goodie Nation</a></li><li><a href="https://scwist.ca/" target="_blank" rel="noreferrer noopener">SCWIST (Society of Canadian Women in Science and Technology)</a></li><li><a href="https://washingtonstem.org/" target="_blank" rel="noreferrer noopener">Washington STEM (Science Technology Engineering and Math)</a></li><li><a href="https://www.techbridgegirls.org/" target="_blank" rel="noreferrer noopener">Techbridge Girls</a></li><li><a href="https://coqual.org/black-equity-index/" target="_blank" rel="noreferrer noopener">Coqual Black Equity Index</a></li></ul><p>Please be sure to take a moment to learn about our 5 latest cohort members below and consider engaging with them in the ways listed below. Every contribution, whether of your time, money, or expertise helps improve lives locally and globally.</p><h2 id="Auth0-org-Fund-Winter-Cohort-4-Member-Organizations">Auth0.org Fund Winter Cohort 4 Member Organizations</h2><h3 id="-Goodie-Nation--https---goodienation-org--"><a href="https://goodienation.org/" target="_blank" rel="noreferrer noopener">Goodie Nation</a></h3><p>Goodie Nation exists to eliminate the relationship gap that stands in the way of success for too many promising entrepreneurs, especially those who are people of color, women, or aren&#39;t located in coastal financial centers. By making sure that every entrepreneur, no matter their background or location, can access the relationships they need to thrive, they are building a more sustainable and prosperous future for all.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6IgDZdUUwBvamoaOuJmzNK/0c0100ecb58b7c48baf76ca3bb6007e2/Goodie_Nation.png" alt="Goodie Nation"/></p><p><strong>How You Can Support</strong></p><ul><li><a href="https://goodienation.org/" target="_blank" rel="noreferrer noopener">Help spread the word</a></li><li><a href="https://www.pledge.to/goodienation" target="_blank" rel="noreferrer noopener">Make a donation</a></li><li><a href="https://goodienation.org/merch/" target="_blank" rel="noreferrer noopener">Purchase some Goodie Nation merch</a></li><li><a href="https://goodienation.org/intentionally-good/expert-application/" target="_blank" rel="noreferrer noopener">Extend your expertise </a></li><li><a href="https://visit.org/experience/engage-with-diverse-startup-founders-in-a-speed-networking-event_317e" target="_blank" rel="noreferrer noopener">Engage at a virtual speed networking event</a></li></ul><h3 id="-SCWIST--Society-of-Canadian-Women-in-Science-and-Technology---https---scwist-ca--"><a href="https://scwist.ca/" target="_blank" rel="noreferrer noopener">SCWIST (Society of Canadian Women in Science and Technology)</a></h3><p>The Society for Canadian Women in Science and Technology is a not-for-profit specializing in improving the presence and influence of women and girls in Science Technology Engineering and Math (STEM). Their organization promotes participation and advancement through education, networking, mentorship, collaborative partnerships, and advocacy to remove barriers and create environments where women and girls can flourish.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3rcGvDlZUPI9g0QBozHSp5/f71f054da6faee11ffedf4e122bb6708/SCWIST.png" alt="SCWIST"/></p><p><strong>How You Can Support</strong></p><ul><li><a href="https://scwist.ca/" target="_blank" rel="noreferrer noopener">Help spread the word</a></li><li><a href="https://scwist.ca/get-involved/become-a-member/" target="_blank" rel="noreferrer noopener">Become a member</a></li><li><a href="https://scwist.ca/get-involved/volunteer/" target="_blank" rel="noreferrer noopener">Volunteer</a></li><li><a href="https://scwist.ca/shop/membership-gift/" target="_blank" rel="noreferrer noopener">Gift a membership</a></li><li><a href="https://scwist.ca/get-involved/donate/" target="_blank" rel="noreferrer noopener">Make a donation</a></li><li><a href="https://scwist.ca/shop/" target="_blank" rel="noreferrer noopener">Buy some SCWIST merch</a></li></ul><h3 id="-Techbridge-Girls--https---www-techbridgegirls-org--"><a href="https://www.techbridgegirls.org/" target="_blank" rel="noreferrer noopener">Techbridge Girls</a></h3><p>Techbridge Girls equips and galvanizes <em>gatekeepers</em> ‚Äì out-of-school time (OST) educators and STEM professionals ‚Äì with gender-responsive, culturally relevant curriculum and equity training that empowers them to act as an advocate for BIPOC girls pursuing their STEM aspirations. With a focus on dismantling systemic and structural barriers, Techbridge Girls builds awareness of and advocates for practices and systems that support girls‚Äô STEM persistence and amplifies the voices of educators and BIPOC girls from marginalized communities.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7krKcIix3XiKUQQZSNlmtT/76c4476dd94fc1c133eb1b3ff8bc028d/techbridge_girls.png" alt="Techbridge Girls"/></p><p><strong>How You Can Support</strong></p><ul><li><a href="https://www.techbridgegirls.org/get-involved/" target="_blank" rel="noreferrer noopener">Help spread the word</a></li><li><a href="https://www.techbridgegirls.org/get-involved/volunteer/" target="_blank" rel="noreferrer noopener">Volunteer</a></li><li><a href="https://www.techbridgegirls.org/donate/" target="_blank" rel="noreferrer noopener">Make a donation</a></li><li><a href="https://docs.google.com/forms/d/1HUK3FJEJpQOU8_KJ5pYebqsN-LlWGOPCUkSA_rP_N5I/viewform?edit_requested=true" target="_blank" rel="noreferrer noopener">Explore ways to partner</a></li></ul><h2 id="-Washington-STEM--Science-Technology-Engineering-and-Math---https---washingtonstem-org--"><a href="https://washingtonstem.org/" target="_blank" rel="noreferrer noopener">Washington STEM (Science Technology Engineering and Math)</a></h2><p>Washington STEM (Science Technology Engineering and Math) is a statewide, educational nonprofit organization leveraging STEM for social change, removing barriers to credential attainment, and creating pathways to long-term economic security for systemically underserved students.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/39StNKthnmJuDLRwPYll4y/78d7fe0ccf0c29a47954e4a44c78b8d4/Washington_STEM.png" alt="Washington STEM"/></p><p><strong>How You Can Support</strong></p><ul><li><a href="https://washingtonstem.org/" target="_blank" rel="noreferrer noopener">Help spread the word</a></li><li><a href="https://interland3.donorperfect.net/weblink/weblink.aspx?name=E204918&amp;id=25" target="_blank" rel="noreferrer noopener">Make a donation</a></li><li><a href="https://washingtonstem.org/support-us/ways-to-give/" target="_blank" rel="noreferrer noopener">Check out other ways to give</a></li><li><a href="https://washingtonstem.org/support-us/stem-champion/" target="_blank" rel="noreferrer noopener">Become a STEM Champion</a></li></ul><h3 id="-Coqual-Black-Equity-Index--https---coqual-org-black-equity-index--"><a href="https://coqual.org/black-equity-index/" target="_blank" rel="noreferrer noopener">Coqual Black Equity Index</a></h3><p>Coqual is a global, nonprofit think tank and advisory group founded in 2004 to address bias and uncover barriers to advancement for underrepresented populations in the workplace. As champions of equity, researchers of culture, and creators of community, they empower companies to create diverse and inclusive workplaces where every person belongs.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4d6JHcf1ZGXb8QPvwnS8Vz/618d480905e5082c4b6e25f2c4a74aa7/Coqual.png" alt="Coqual"/></p><p><strong>How You Can Support</strong></p><ul><li><a href="https://coqual.org/who-we-are/" target="_blank" rel="noreferrer noopener">Help spread the word</a></li><li><a href="https://coqual.org/our-research/" target="_blank" rel="noreferrer noopener">Check out their extensive research library</a></li><li><a href="https://coqual.org/join-the-task-force/" target="_blank" rel="noreferrer noopener">Request to join their Task Force</a></li></ul></div></div>]]></content:encoded>
      <pubDate>Wed, 16 Feb 2022 15:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Centralize Identity For Security and Customer Experience</title>
      <link>https://auth0.com/blog/centralize-identity-for-security-and-customer-experience/</link>
      <description>Partnering with a provider to centralize identity lets you maintain control over your data without compromising user experience</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Consumers expect the web apps and services they use to be intuitive while also requiring secure and private transactions and a low-friction experience. A good example of this is the increasing demand for biometrics, the use of a person‚Äôs physical attributes like a fingerprint or face scan to prove identity and control access. Consumers have become accustomed to the security and convenience that using a fingerprint to unlock their smartphone offers, so using the same technology to secure your web app is an intuitive way to help secure their account data.</p><p><a href="https://info.auth0.com/erwartungen-und-realitat.html" target="_blank" rel="noreferrer noopener">Auth0‚Äôs recent global survey</a>, including more than 2,000 consumers and 200 IT/marketing decision-makers in Germany, found that 31% of German consumers are more likely to sign up for a service if it offers biometric authentication. Yet only 17% of German businesses offer this feature. SO biometric authentication is one way for businesses in the DACH region to better align themselves with their customers‚Äô expectations for security without compromising their customer experience (CX). </p><p>Partnering with an <a href="https://auth0.com/blog/what-is-idaas/" target="_blank" rel="noreferrer noopener">Identity as a Service (IDaaS)</a> provider who understands how to combine an intuitive user interface with strong security measures like that offered by biometrics can bring additional benefits to your organization. For example: freeing your in-house development talent to focus on your core product, helping you meet regional data privacy regulations, and maintaining active control over your user data.</p><h2 id="Let-Your-Internal-Talent-Focus-on-Your-Core-Product">Let Your Internal Talent Focus on Your Core Product</h2><p>Germany is not only the largest economy in the EU; it is also home to the largest software developer talent pool in the region. <a href="https://www.cbi.eu/market-information/outsourcing-itobpo/software-development-services/market-potential" target="_blank" rel="noreferrer noopener">As of 2019</a>, there were more than 900,000 developers in the country, with a majority describing themselves as <a href="https://insights.stackoverflow.com/survey/2021" target="_blank" rel="noreferrer noopener">Full-Stack front-end developers</a>. To ensure your in-house dev teams can focus on those strengths, don‚Äôt distract them with an identity project. At Auth0, identity is our core product. Our teams built, maintained, and enhanced a Customer Identity and Access Management (CIAM) platform that incorporates industry security standards, an expert understanding of regional data privacy regulations, and a highly customizable set of integrations to bring you exactly the right mix of security, privacy, and CX.</p><p>Our identity specialists bring their expertise and knowledge to secure your authentication and authorization processes while also bringing your customers the tailored, low-friction CX they expect. That allows us to help you build a solution that will be capable of incorporating your needs in the present ‚Äî while remaining extensible enough to scale with your plans for the future. </p><p>The centralized identity solution you build will unify authentication for your platforms, services, and web apps. This single source of truth (SSoT) for your customer identity data is easier to secure than disparate, siloed data stores for each system. It also limits your attack surface by eliminating multiple access points and login boxes. </p><p>By partnering with Auth0, you get a centralized identity platform that‚Äôs ready to be customized by your developers to meet your precise requirements. And our extensibility allows that platform to be readily extended to cover all of your existing properties, whether they‚Äôre modern cloud-based apps or legacy on-prem systems.</p><h2 id="Understanding-Data-Privacy-Regulations-in-The-DACH-Region">Understanding Data Privacy Regulations in The DACH Region</h2><p>EU Member States are allowed to enact national privacy rules to supplement, specify, and modify the GDPR rules as applied to their citizens. It‚Äôs important that companies familiarise themselves with these rules that often govern specific situations.</p><p>This document is not intended to act as legal advice. Please consult your legal counsel to ensure you are in compliance with all applicable data privacy laws and regulations.</p><p>The right to privacy is well established and respected in the DACH region, where such legislation existed long before the GDPR. Today there are additional rules such as the <a href="https://auth0.com/blog/centralize-identity-for-security-and-customer-experience/BDSG-new" target="_blank" rel="noreferrer noopener">new German Privacy Act (BDSG-new)</a> along with industry-specific regulations for, e.g., telecommunications, banking, and energy. In Austria, too, we see local regulations like the <a href="https://www.dataguidance.com/notes/austria-data-protection-overview" target="_blank" rel="noreferrer noopener">Federal Act on the Protection of Individuals With Regard to the Processing of Personal Data (DSG)</a>, all designed to put the privacy rights of citizens first.</p><p><a href="https://www.dataguidance.com/notes/switzerland-data-protection-overview" target="_blank" rel="noreferrer noopener">Switzerland</a> has a slightly different take on data protection regulations as well. In addition to GDPR, there are two additional laws that impact data collection and processing there. The first is Article 13 of the Swiss Constitution, which protects Swiss citizens‚Äô rights to privacy in personal and family life, as well as within the home. Meanwhile, the Federal Act on Data Protection (FADP) solidified the language governing how those rights are protected in regards to digital data. Unless you have a team of lawyers and governance specialists for your developers to work with, making sure you‚Äôre in full compliance with all of these regulations will soak up a lot of internal resources. Partnering with an IDaaS provider can alleviate these additional strains by taking on the task of helping to assure compliance.</p><p>The DACH data privacy landscape can seem complex, and the responsibility for coding privacy into your applications often falls to the people building them. By partnering with Auth0, your developers can help you protect your customer‚Äôs personal information without becoming privacy experts themselves. Auth0‚Äôs key privacy-enabling features include:</p><ul><li>Easy access to user profiles to enable removal requests</li><li>To export a user‚Äôs data in JSON format for data portability</li><li>To enable Log Streaming for continuous security monitoring</li><li>The knowledge that your data is stored locally at an AWS facility in Frankfurt</li></ul><h2 id="Great-Customer-Experience-Includes-Choices-for-Data-Location">Great Customer Experience Includes Choices for Data Location</h2><p>Part of ensuring your customers get the experience they expect is maintaining control over the data they share when they create an account. Consolidating that data into an SSoT simplifies continuously monitoring its security and detecting threats and other anomalies. Having choices with respect to the location where your data is stored is another asset of partnering with an IDaaS provider like Auth0.</p><h3 id="Data-security-certification">Data security certification</h3><p>Auth0 brings knowledge of <a href="https://auth0.com/docs/compliance/gdpr" target="_blank" rel="noreferrer noopener">regional privacy regulations</a>, along with internationally recognized certifications from organizations such as the International Standards Organization (ISO) <a href="https://www.iso.org/obp/ui/#iso:std:iso-iec:27001:ed-2:v1:en" target="_blank" rel="noreferrer noopener">27001</a> and <a href="https://www.iso.org/standard/61498.html" target="_blank" rel="noreferrer noopener">27018</a>, along with a<a href="https://auth0.com/blog/auth0-achieves-soc-2-certification/" target="_blank" rel="noreferrer noopener"> SOC 2 Type II audit</a>. These are third-party verified certifications, meaning a specialized auditing body has signed off on the security of our processes, infrastructure, <a href="https://assets.ctfassets.net/kbkgmx9upatd/2KxmM5BICQ4GKgeIwA0sKu/d4f59bd579803593edcd571f1aa92ef0/Auth0_Platform_Operations.pdf" target="_blank" rel="noreferrer noopener">platform</a>, policies, and continuous monitoring framework. Auth0 complies with <a href="https://auth0.com/de/security" target="_blank" rel="noreferrer noopener">additional regulations</a> as well, BaFin, EBA, and HIPAA for example. </p><h3 id="Customizable-user-interfaces">Customizable user interfaces</h3><p><a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a> offers integrations with major line-of-business software, while our <a href="https://auth0.com/actions" target="_blank" rel="noreferrer noopener">Actions</a> capability allows your developers to work with these integrations with everything from drag and drop to a full Javascript editor. This ease of integration and customization means you can create your login box once and use it across properties.</p><h3 id="All-your-user-data-in-one-place">All your user data in one place</h3><p>Being cloud-native gives Auth0 the flexibility to offer multiple data storage options. Access is a key piece of data residency. For organizations in the DACH region, we offer <a href="https://auth0.com/blog/auth0-on-microsoft-azure-as-a-private-cloud-deployment-option/" target="_blank" rel="noreferrer noopener">private cloud deployment options on Microsoft Azure</a> or AWS infrastructure, as well as public cloud options using an AWS facility in multiple regions such as Frankfurt to help our customers achieve compliance. </p><h3 id="Iterative-deployment-to-ensure-buy-in-across-the-organization">Iterative deployment to ensure buy-in across the organization</h3><p>Deploying a new identity and access management system can be a lengthy and complex process from a business perspective. Partnering with Auth0 and taking advantage of our identity experts allows for an iterative deployment and a smooth migration that does not jeopardize the user experience by offering frictionless user migrations without password resets. That way, each department or product team can witness a successful roll-out before giving their buy-in without straining your in-house talent. Cross-departmental collaboration is key to any software project, particularly when that software controls data access, and having a successful proof-of-concept (POC) in hand can help secure buy-in as you move forward.</p><p>Work with an identity partner that understands your need for a great digital experience without compromising the security and privacy of your customer data. <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">Reach out to our identity experts</a> when you‚Äôre ready to continue the conversation or to find out how to start working with Auth0 today.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 14 Feb 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>State Management in Angular Using Akita - Pt. 1</title>
      <link>https://auth0.com/blog/state-management-in-angular-with-akita-1/</link>
      <description>See how it&#39;s easy to manage your Angular application&#39;s state using Akita and learn how you can use Akita with Auth0&#39;s SDK to handle user-related functionalities.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><h2 id="Intro">Intro</h2><p>State management is a key component when building applications. There are various approaches by which we can manage the state in an Angular application, each with its pros and cons.
This blog post will focus on using Akita as our state management solution. We will look at how you can use Akita to manage your application&#39;s state by building a Recipe Admin Dashboard application. We will also learn how to secure the application using Auth0 and how it works with Akita.</p><h2 id="What-Is-Akita">What Is Akita</h2><p><a href="https://datorama.github.io/akita/" target="_blank" rel="noreferrer noopener">Akita</a> is a state management pattern based on object-oriented design principles.
Akita is built on top of RxJs, merging the multiple data stores concept from Flux, immutable updates from Redux, and data streams from RxJs to create the Observable Data Store model. Akita boasts an opinionated structure that forces developers to follow a fixed pattern that cannot be deviated from, encouraging a uniform implementation in your codebase.</p><h2 id="How-Does-Akita-Work">How Does Akita Work</h2><p>Akita is made up of 4 main components - Store, Actions, Query, and Effects.</p><p>Akita uses the Redux concept of unidirectional data flow, where all application data goes through the same lifecycle. This unidirectional data flow makes the application&#39;s state more predictable and thus easier to understand. This flow only applies to the state management layer and is not to be confused with the unidirectional data flow of the presentation layer. The following diagram shows the state management lifecycle in Akita.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7zfsEnAJdgfKJv34Xu6b61/1f53a405ff750b696b198887787103d4/01-akita-how-it-works.png" alt="Akita State Management Lifecycle Diagram"/></p><h3 id="Store">Store</h3><p>The Store in Akita contains a single object containing the store state and acts as the application&#39;s single source of truth. It reflects the current state of the app. You can think of this as a client-side database.</p><h3 id="Actions">Actions</h3><p>Actions express unique events that happen in our application. These events range from application lifecycle events, user interactions, to network requests. Actions are how the application communicates with Akita&#39;s store to tell it what to do.</p><h3 id="Query">Query</h3><p>Queries are similar to database queries. A query is responsible for querying or getting slices of the state from the Store. Queries are how our application listens to state changes.</p><h3 id="Effects">Effects</h3><p>Effects handle the side effects of each Action. These side effects range from communicating with an external API via HTTP when a certain Action is dispatched to dispatching another Action to update another part of the State.</p><h2 id="Prerequisites">Prerequisites</h2><p>Angular requires an <a href="https://nodejs.org/about/releases" target="_blank" rel="noreferrer noopener">active LTS or maintenance LTS</a> version of Node.js. Angular applications also depend on <a href="https://docs.npmjs.com/getting-started/what-is-npm" target="_blank" rel="noreferrer noopener">npm packages</a> for many features and functions. To download and install npm packages, you need an npm package manager such as <a href="https://docs.npmjs.com/cli/install" target="_blank" rel="noreferrer noopener">npm</a> or <a href="https://yarnpkg.com/" target="_blank" rel="noreferrer noopener">yarn</a>.</p><p>This project has a server-side component that has to run in parallel when running the Frontend. Follow the instructions in the <a href="https://github.com/auth0-cookbook/api_express_typescript_menu" target="_blank" rel="noreferrer noopener">Api Express Typescript Menu repo</a>. You can read more about setting up the server-side with Auth0 in this <a href="https://auth0.com/blog/node-js-and-typescript-tutorial-secure-an-express-api/" target="_blank" rel="noreferrer noopener">blog post</a>.</p><p>This tutorial focuses on how to use Auth0 with Akita. For more information on setting up Auth0 for Angular applications, follow the instructions on the <a href="https://github.com/auth0-developer-hub/spa_angular_typescript_dashboard/blob/master/README.md#register-a-client-application-with-auth0" target="_blank" rel="noreferrer noopener">README</a> or refer to this <a href="https://auth0.com/blog/complete-guide-to-angular-user-authentication/#Connect-Angular-with-Auth0" target="_blank" rel="noreferrer noopener">blog post</a>.</p><h2 id="Getting-Started-Quickly">Getting Started Quickly</h2><p>I created a demo application with the basic structure and components to help you implement the Akita-related part.</p><p>Clone the demo app and check out its starter branch:</p><pre><code><span>git</span> clone -b starter git@github.com:auth0-developer-hub/spa_angular_typescript_dashboard.git</code></pre><p>Once you clone the repo, make <code>spa_angular_typescript_dashboard</code> your current directory:</p><pre><code><span>cd</span> spa_angular_typescript_dashboard</code></pre><p>Install the project&#39;s dependencies:</p><pre><code><span>npm</span> i</code></pre><p>Run the project locally:</p><pre><code><span>npm</span> run start</code></pre><p>We will be using the <a href="https://github.com/zalmoxisus/redux-devtools-extension/" target="_blank" rel="noreferrer noopener">redux devtools</a> extension for Chrome or Firefox for debugging store-related operations.</p><p>To use this extension with Akita, you&#39;ll need to add Akita&#39;s devtools dependency to our project. You can do this using <code>npm</code>.</p><pre><code><span>npm</span> i @datorama/akita-ngdevtools --save</code></pre><p>Import the <code>AkitaNgDevtools</code> in our <code>AppModule</code> and configure it based on your project&#39;s requirements. For this tutorial, you&#39;ll be using their default configuration. Open <code>app<span>.</span>module<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/app.module.ts</span>

<span>import</span> <span>{</span> BrowserModule <span>}</span> <span>from</span> <span>&#34;@angular/platform-browser&#34;</span><span>;</span>
<span>import</span> <span>{</span> NgModule <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> HttpClientModule<span>,</span> <span>HTTP_INTERCEPTORS</span> <span>}</span> <span>from</span> <span>&#34;@angular/common/http&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthHttpInterceptor<span>,</span> AuthModule <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> AkitaNgDevtools <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ngdevtools&#34;</span><span>;</span>

<span>import</span> <span>{</span> AppRoutingModule <span>}</span> <span>from</span> <span>&#34;./app-routing.module&#34;</span><span>;</span>
<span>import</span> <span>{</span> AppComponent <span>}</span> <span>from</span> <span>&#34;./app.component&#34;</span><span>;</span>
<span>import</span> <span>{</span> NavBarModule <span>}</span> <span>from</span> <span>&#34;./shared&#34;</span><span>;</span>
<span>import</span> <span>{</span> environment <span>}</span> <span>from</span> <span>&#34;src/environments/environment&#34;</span><span>;</span>

@<span>NgModule</span><span>(</span><span>{</span>
  imports<span>:</span> <span>[</span>
    BrowserModule<span>,</span>
    HttpClientModule<span>,</span>
    AuthModule<span>.</span><span>forRoot</span><span>(</span><span>{</span>
      <span>...</span>environment<span>.</span>auth<span>,</span>
      httpInterceptor<span>:</span> <span>{</span>
        allowedList<span>:</span> <span>[</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items</span><span>`</span></span><span>,</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items/*</span><span>`</span></span><span>,</span>
        <span>]</span><span>,</span>
      <span>}</span><span>,</span>
    <span>}</span><span>)</span><span>,</span>
    AppRoutingModule<span>,</span>
    NavBarModule<span>,</span>

    <span>// ‚ú® New üëá</span>
    environment<span>.</span>production
      <span>?</span> <span>[</span><span>]</span>
      <span>:</span> AkitaNgDevtools<span>.</span><span>forRoot</span><span>(</span><span>{</span>
          maxAge<span>:</span> <span>25</span><span>,</span>
        <span>}</span><span>)</span><span>,</span>
  <span>]</span><span>,</span>
  declarations<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  bootstrap<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  providers<span>:</span> <span>[</span>
    <span>{</span>
      provide<span>:</span> <span>HTTP_INTERCEPTORS</span><span>,</span>
      useClass<span>:</span> AuthHttpInterceptor<span>,</span>
      multi<span>:</span> <span>true</span><span>,</span>
    <span>}</span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppModule</span> <span>{</span><span>}</span></code></pre><h3 id="Running-the-app-and-turning-on-devtools">Running the app and turning on devtools</h3><p>After following the steps in this section, you should see an option to activate Redux Devtools in your toolbar when you run the app. Once activated, you should see a window with an interface similar to the image below.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/187cUNUXsCIbiTVfFPHQhq/8f11993f8c449cc249a8dfd114d5f530/02-akita-redux-devtools.png" alt="Redux Devtools with Akita"/></p><blockquote><p>You can learn more about these features from their <a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="noreferrer noopener">official documentation</a>.</p></blockquote><h2 id="Install-Akita">Install Akita</h2><p>You can either use <code>npm</code> or Angular&#39;s CLI to install Akita dependencies.</p><p>Using <code>npm</code></p><pre><code><span>npm</span> <span>install</span> @datorama/akita --save</code></pre><p>Using Angular&#39;s CLI</p><blockquote><p>To use the Angular CLI, you will need to have the CLI installed globally. Refer to instructions on the <a href="https://angular.io/cli" target="_blank" rel="noreferrer noopener">Angular docs</a> for how to set this up.</p></blockquote><pre><code>ng <span>add</span> @datorama/akita</code></pre><p>You will also be using Akita&#39;s Effects to handle your store&#39;s side effects. Let&#39;s add that dependency using <code>npm</code>.</p><pre><code><span>npm</span> i @datorama/akita-ng-effects --save</code></pre><blockquote><p>At the time this post was written, the latest Akita store and effects version was <code><span>6.2</span><span>.1</span></code> and <code><span>1.0</span><span>.4</span></code> respectively, which will be the version we will be using throughout the tutorial.</p></blockquote><h2 id="Architecture">Architecture</h2><p>The app&#39;s core is an admin dashboard where the logged-in user can add, edit, and delete a menu item. The logged-in user will perform all the operations or a subset of it depending on their permissions. You will use Akita to manage the state updates and user/server-related events.</p><p>You will create two Stores for our application:</p><ul><li><em>menus</em>: to manage menu related functionalities (CRUD operations)</li><li><em>user</em>: to manage user-related functionalities such as authentication using Auth0</li></ul><p>You will also split each part of the Store into individual files to make it easier to follow throughout the tutorial.</p><p>Let&#39;s first start by creating the following folder structure in our <code>core</code> directory (you will be updating each file as we discuss each section):</p><pre><code><span>|</span><span>-</span> src<span>/</span>app<span>/</span>core
    <span>|</span><span>-</span> state
        <span>|</span><span>-</span> menus
            <span>|</span><span>-</span> menus<span>.</span>actions<span>.</span>ts
            <span>|</span><span>-</span> menus<span>.</span>effects<span>.</span>ts
            <span>|</span><span>-</span> menus<span>.</span>query<span>.</span>ts
            <span>|</span><span>-</span> menus<span>.</span>store<span>.</span>ts
            <span>|</span><span>-</span> index<span>.</span>ts
        <span>|</span><span>-</span> user
            <span>|</span><span>-</span> user<span>.</span>actions<span>.</span>ts
            <span>|</span><span>-</span> user<span>.</span>effects<span>.</span>ts
            <span>|</span><span>-</span> user<span>.</span>query<span>.</span>ts
            <span>|</span><span>-</span> user<span>.</span>store<span>.</span>ts
            <span>|</span><span>-</span> index<span>.</span>ts</code></pre><blockquote><p>The starter app uses a <code>BehaviorSubject</code> in <code>menu<span>-</span>state<span>.</span>service<span>.</span>ts</code> to manage its state. This tutorial will walk you through migrating the <code>BehaviorSubject</code> based state management to Akita.</p></blockquote><p>Let&#39;s start with creating the state object for menus. Open <code>menus<span>.</span>store<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.store.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Store<span>,</span> StoreConfig <span>}</span> <span>from</span> <span>&#34;@datorama/akita&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenuItem <span>}</span> <span>from</span> <span>&#34;../../models&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>MenusState</span> <span>{</span>
  menus<span>:</span> MenuItem<span>[</span><span>]</span><span>;</span>
<span>}</span>

<span>export</span> <span>function</span> <span>createInitialState</span><span>(</span><span>)</span><span>:</span> MenusState <span>{</span>
  <span>return</span> <span>{</span>
    menus<span>:</span> <span>[</span><span>]</span><span>,</span>
  <span>}</span><span>;</span>
<span>}</span>

@<span>StoreConfig</span><span>(</span><span>{</span> name<span>:</span> <span>&#34;menus&#34;</span> <span>}</span><span>)</span>
@<span>Injectable</span><span>(</span><span>{</span> providedIn<span>:</span> <span>&#34;root&#34;</span> <span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenusStore</span> <span>extends</span> <span>Store<span>&lt;</span>MenusState<span>&gt;</span></span> <span>{</span>
  <span>constructor</span><span>(</span><span>)</span> <span>{</span>
    <span>super</span><span>(</span><span>createInitialState</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Let&#39;s also create a barrel export in our <code>menus</code> folder. Create <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.store&#34;</span><span>;</span></code></pre><p>The interface <code>MenusState</code> defines the type of object Menu&#39;s state will have. The <code>createInitialState</code> function, on the other hand, returns the initial state of the state object when the store is first initialized.</p><p>Next, you will need to define what Actions you need to handle. We will be following the Good Action Hygiene principle when writing our Actions.</p><p>On a high level, Good Action Hygiene recommends thinking of Actions as events instead of commands. Instead of <code>addMenuItem</code> as the Action, use <code>addMenuItemFormSubmitted</code>. This pattern also encourages dispatching specific Action instead of reusing the same Action and including the source as part of the Action type. The image below shows the anatomy of an Action&#39;s type.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5o2MH1X0FIjmlKMVQQFKws/928568876e46dbde7f2fcc5fedb7a6e6/03-akita-good-action-hygiene.png" alt="Anatomy of an Action name"/></p><p>Following this pattern makes it easier to debug as you have distinct Actions from each source. This lets you immediately know what event has just taken place and where it came from with a quick look at the devtools.</p><p>You can learn more about Good Action hygiene in this <a href="https://indepth.dev/posts/1407/force-good-action-hygiene-and-write-less-actions-in-ngrx-with-the-prepared-events-pattern" target="_blank" rel="noreferrer noopener">blog post</a> by Sameera Perera and Mike Ryan&#39;s <a href="https://youtu.be/JmnsEvoy-gY" target="_blank" rel="noreferrer noopener">talk</a> at ng-conf 2018.</p><p>Let&#39;s start with user-initiated Actions. This would include adding a new menu item, updating an existing menu item, and deleting a current menu item. Open <code>menus<span>.</span>actions<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.actions.ts</span>

<span>import</span> <span>{</span> createAction<span>,</span> props <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem<span>,</span> MenuItem <span>}</span> <span>from</span> <span>&#34;../../models&#34;</span><span>;</span>

<span>export</span> <span>const</span> addMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Add Menu Page] Add Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> BaseMenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> editMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Edit Menu Page] Edit Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> MenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> deleteMenuItemInitiated <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Delete Menu Page] Delete Menu Item Initiated&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuId<span>:</span> <span>string</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>You will need to fetch the menus from our API as the app load. Let&#39;s add an <code>appLoaded</code> Action that will be dispatched when the app loads. Open <code>menus<span>.</span>actions<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.actions.ts</span>

<span>import</span> <span>{</span> createAction<span>,</span> props <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem<span>,</span> MenuItem <span>}</span> <span>from</span> <span>&#34;../../models&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> appLoaded <span>=</span> <span>createAction</span><span>(</span><span>&#34;[App] App Loaded&#34;</span><span>)</span><span>;</span>

<span>export</span> <span>const</span> addMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Add Menu Page] Add Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> BaseMenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> editMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Edit Menu Page] Edit Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> MenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> deleteMenuItemInitiated <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Delete Menu Page] Delete Menu Item Initiated&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuId<span>:</span> <span>string</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>Let&#39;s continue to other API-related Actions. Since calling an API could either succeed or fail, let&#39;s add success and fail handlers for each API-related Action.</p><blockquote><p>You could do success and error handling in several different ways. What I&#39;m showing you is just one way you could do this.</p></blockquote><p>Open <code>menus<span>.</span>actions<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.actions.ts</span>

<span>import</span> <span>{</span> createAction<span>,</span> props <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem<span>,</span> MenuItem <span>}</span> <span>from</span> <span>&#34;../../models&#34;</span><span>;</span>

<span>export</span> <span>const</span> appLoaded <span>=</span> <span>createAction</span><span>(</span><span>&#34;[App] App Loaded&#34;</span><span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> fetchMenuSuccess <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Fetch Menu Success&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItems<span>:</span> MenuItem<span>[</span><span>]</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> fetchMenuFailed <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Fetch Menu Failed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> error<span>:</span> <span>any</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> addMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Add Menu Page] Add Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> BaseMenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> addMenuItemSuccess <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Add Menu Item Success&#34;</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> addMenuItemFailed <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Add Menu Item Failed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> error<span>:</span> <span>any</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> editMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Edit Menu Page] Edit Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> MenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> editMenuItemSuccess <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Edit Menu Item Success&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> MenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> editMenuItemFailed <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Edit Menu Item Failed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> error<span>:</span> <span>any</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> deleteMenuItemInitiated <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Delete Menu Page] Delete Menu Item Initiated&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuId<span>:</span> <span>string</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> deleteMenuItemSuccess <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Delete Menu Item Success&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuId<span>:</span> <span>string</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> deleteMenuItemFailed <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Delete Menu Item Failed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> error<span>:</span> <span>any</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>Let&#39;s also add this to the barrel export. Open <code>index<span>.</span>ts</code> and add the following code:</p><pre><code><span>// src/app/core/state/menus/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.store&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span></code></pre><p>You will now update the current implementation in our application with these Actions for any state-related operations. You do this by injecting Akita&#39;s <code>Actions</code> in the component and calling its <code>dispatch</code> function with the Action you want to execute.</p><p>Starting with <code>appLoaded</code>, as this is called when the application first loads, let&#39;s add this to your <code>AppComponent</code>&#39;s <code>ngOnInit</code>. Open <code>app<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/app.component.ts</span>

<span>import</span> <span>{</span> Component<span>,</span> OnInit <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Actions <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> appLoaded <span>}</span> <span>from</span> <span>&#34;./core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-root&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./app.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./app.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppComponent</span> <span>implements</span> <span>OnInit</span> <span>{</span>
  title <span>=</span> <span>&#34;spa-angular-typescript-dashboard&#34;</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  <span>constructor</span><span>(</span><span>private</span> actions<span>:</span> Actions<span>)</span> <span>{</span><span>}</span>

  <span>ngOnInit</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span><span>appLoaded</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Moving on to adding a menu item. Open <code>add<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/add-item/add-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Actions <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> addMenuItemFormSubmitted <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

<span>const</span> MenuItemPlaceholder<span>:</span> BaseMenuItem <span>=</span> <span>{</span>
  name<span>:</span> <span>&#34;French Fries&#34;</span><span>,</span>
  price<span>:</span> <span>299</span><span>,</span>
  tagline<span>:</span> <span>&#34;Crispy goodness&#34;</span><span>,</span>
  description<span>:</span>
    <span>&#34;A plate of light and crispy French fries using Idaho potatoes and peanut oil&#34;</span><span>,</span>
  image<span>:</span>
    <span>&#34;https://as2.ftcdn.net/jpg/02/13/18/09/500_F_213180964_DfqvRIHj0D3t9duYUROXuQ011AgVJIaM.jpg&#34;</span><span>,</span>
  calories<span>:</span> <span>410</span><span>,</span>
  category<span>:</span> <span>&#34;sides&#34;</span><span>,</span>
<span>}</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-add-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./add-item.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AddItemComponent</span> <span>{</span>
  menuItem <span>=</span> MenuItemPlaceholder<span>;</span>
  <span>constructor</span><span>(</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> actions<span>:</span> Actions
  <span>)</span> <span>{</span><span>}</span>

  <span>submit</span><span>(</span>menu<span>:</span> BaseMenuItem<span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span><span>addMenuItemFormSubmitted</span><span>(</span><span>{</span> menuItem<span>:</span> menu <span>}</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Deleting a menu item. Open <code><span>delete</span><span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/delete-item/delete-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusStateService <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Actions <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> deleteMenuItemInitiated <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-delete-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./delete-item.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./delete-item.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>DeleteItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>menusStateService<span>.</span><span>selectMenuItem$</span><span>(</span>id<span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> menusStateService<span>:</span> MenusStateService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> actions<span>:</span> Actions
  <span>)</span> <span>{</span><span>}</span>

  <span>deleteMenuItem</span><span>(</span>id<span>:</span> <span>string</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span><span>deleteMenuItemInitiated</span><span>(</span><span>{</span> menuId<span>:</span> id <span>}</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>back</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>navigateHome</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/menu&#34;</span><span>]</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Editing an existing menu item. Open <code>edit<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/edit-item/edit-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap<span>,</span> tap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem<span>,</span> MenusStateService <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Actions <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> editMenuItemFormSubmitted <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-edit-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./edit-item.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>EditItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>tap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>(</span><span>this</span><span>.</span>id <span>=</span> id<span>)</span><span>)</span><span>,</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>menusStateService<span>.</span><span>selectMenuItem$</span><span>(</span>id<span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>private</span> id<span>:</span> <span>number</span> <span>|</span> <span>undefined</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> menusStateService<span>:</span> MenusStateService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> actions<span>:</span> Actions
  <span>)</span> <span>{</span><span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>submit</span><span>(</span>menu<span>:</span> BaseMenuItem<span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>if</span> <span>(</span><span>!</span><span>this</span><span>.</span>id<span>)</span> <span>{</span>
      <span>return</span><span>;</span>
    <span>}</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span>
      <span>editMenuItemFormSubmitted</span><span>(</span><span>{</span>
        menuItem<span>:</span> <span>{</span>
          <span>...</span>menu<span>,</span>
          id<span>:</span> <span>this</span><span>.</span>id<span>.</span><span>toString</span><span>(</span><span>)</span><span>,</span>
        <span>}</span><span>,</span>
      <span>}</span><span>)</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Before creating individual queries for slices of the menu state, let&#39;s start by creating the boilerplate required to use this feature. Akita uses an <code>Injectable</code> class that extends Akita&#39;s <code>Query</code> class. Open <code>menus<span>.</span>query<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.query.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Query <span>}</span> <span>from</span> <span>&#34;@datorama/akita&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusState<span>,</span> MenusStore <span>}</span> <span>from</span> <span>&#34;./menus.store&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>{</span> providedIn<span>:</span> <span>&#34;root&#34;</span> <span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenusQuery</span> <span>extends</span> <span>Query<span>&lt;</span>MenusState<span>&gt;</span></span> <span>{</span>
  <span>constructor</span><span>(</span><span>protected</span> store<span>:</span> MenusStore<span>)</span> <span>{</span>
    <span>super</span><span>(</span>store<span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>You can use Akita&#39;s <code>select</code> method to select slices of the state. For menus, you only have one entry in our object: <code>menuItems</code>. Let&#39;s create an observable to access that using Akita&#39;s select method and passing in the store name (&#34;menus&#34;). Open <code>menus<span>.</span>query<span>.</span>ts</code> and update it with the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.query.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Query <span>}</span> <span>from</span> <span>&#34;@datorama/akita&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusState<span>,</span> MenusStore <span>}</span> <span>from</span> <span>&#34;./menus.store&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>{</span> providedIn<span>:</span> <span>&#34;root&#34;</span> <span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenusQuery</span> <span>extends</span> <span>Query<span>&lt;</span>MenusState<span>&gt;</span></span> <span>{</span>
  <span>// ‚ú® New üëá</span>
  selectMenuItems$ <span>=</span> <span>this</span><span>.</span><span>select</span><span>(</span><span>&#34;menus&#34;</span><span>)</span><span>;</span>

  <span>constructor</span><span>(</span><span>protected</span> store<span>:</span> MenusStore<span>)</span> <span>{</span>
    <span>super</span><span>(</span>store<span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>For pages like Menu Details, Edit Menu and Delete Menu, you&#39;ll need to access a specific menu item from the Store. You can do this by creating a function that accepts the menu id as a parameter and searches through our array of menu items from the <code>selectMenuItems$</code> observable. Open <code>menus<span>.</span>query<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.query.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Query <span>}</span> <span>from</span> <span>&#34;@datorama/akita&#34;</span><span>;</span>
<span>import</span> <span>{</span> map <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusState<span>,</span> MenusStore <span>}</span> <span>from</span> <span>&#34;./menus.store&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>{</span> providedIn<span>:</span> <span>&#34;root&#34;</span> <span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenusQuery</span> <span>extends</span> <span>Query<span>&lt;</span>MenusState<span>&gt;</span></span> <span>{</span>
  selectMenuItems$ <span>=</span> <span>this</span><span>.</span><span>select</span><span>(</span><span>&#34;menus&#34;</span><span>)</span><span>;</span>

  <span>constructor</span><span>(</span><span>protected</span> store<span>:</span> MenusStore<span>)</span> <span>{</span>
    <span>super</span><span>(</span>store<span>)</span><span>;</span>
  <span>}</span>

  <span>// ‚ú® New üëá</span>
  <span>selectMenuItem</span><span>(</span>id<span>:</span> <span>string</span><span>)</span> <span>{</span>
    <span>return</span> <span>this</span><span>.</span>selectMenuItems$<span>.</span><span>pipe</span><span>(</span>
      <span>map</span><span>(</span><span>(</span>menuItems<span>)</span> <span>=&gt;</span> menuItems<span>.</span><span>find</span><span>(</span><span>(</span>menuItem<span>)</span> <span>=&gt;</span> menuItem<span>.</span>id <span>===</span> id<span>)</span><span>)</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Let&#39;s also add the query to the barrel export. Open <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.store&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.query&#34;</span><span>;</span></code></pre><p>Similar to what you did with Actions, let&#39;s update the application to get data required by the components using Akita&#39;s Queries. You can use Queries by injecting the Query class and calling the function you&#39;ve defined in the previous section, similar to how you would use a service.</p><p>Starting with the main dashboard, open <code>menu<span>-</span>items<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/menu-items/menu-items.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> RolesService <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> MenusQuery <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-menu-items&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./menu-items.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenuItemsComponent</span> <span>{</span>
  <span>// ‚ú® New üëá</span>
  menuItems$ <span>=</span> <span>this</span><span>.</span>menuQuery<span>.</span>selectMenuItems$<span>;</span>
  isAdmin$ <span>=</span> <span>this</span><span>.</span>rolesService<span>.</span>isAdmin$<span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> rolesService<span>:</span> RolesService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> menuQuery<span>:</span> MenusQuery
  <span>)</span> <span>{</span><span>}</span>

  <span>addMenuItem</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;add&#34;</span><span>]</span><span>,</span> <span>{</span> relativeTo<span>:</span> <span>this</span><span>.</span>activatedRoute <span>}</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Moving on to the Menu Details page. Here, we only need a specific menu&#39;s data. Instead of using the <code>selectMenuItems</code>, you will use <code>selectMenuItem</code> and pass in the menu id from the route parameters. Open <code>menu<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/menu-item/menu-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> RolesService <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> MenusQuery <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-menu-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./menu-item.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./menu-item.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenuItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>menusQuery<span>.</span><span>selectMenuItem</span><span>(</span>id<span>)</span><span>)</span>
  <span>)</span><span>;</span>
  isAdmin$ <span>=</span> <span>this</span><span>.</span>rolesService<span>.</span>isAdmin$<span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> rolesService<span>:</span> RolesService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> menusQuery<span>:</span> MenusQuery
  <span>)</span> <span>{</span><span>}</span>

  <span>back</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>navigateTo</span><span>(</span>url<span>:</span> <span>string</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigateByUrl</span><span>(</span><span><span>`</span><span><span>${</span><span>this</span><span>.</span>router<span>.</span>url<span>}</span></span><span>/</span><span><span>${</span>url<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Delete Menu Item Component, open <code><span>delete</span><span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/delete-item/delete-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>

<span>import</span> <span>{</span> Actions <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> deleteMenuItemInitiated<span>,</span> MenusQuery <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-delete-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./delete-item.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./delete-item.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>DeleteItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>menusQuery<span>.</span><span>selectMenuItem</span><span>(</span>id<span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> actions<span>:</span> Actions<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> menusQuery<span>:</span> MenusQuery
  <span>)</span> <span>{</span><span>}</span>

  <span>deleteMenuItem</span><span>(</span>id<span>:</span> <span>string</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span><span>deleteMenuItemInitiated</span><span>(</span><span>{</span> menuId<span>:</span> id <span>}</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>back</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>navigateHome</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/menu&#34;</span><span>]</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>And finally, Edit Menu Item. Open <code>edit<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/edit-item/edit-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap<span>,</span> tap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem<span>,</span> MenuItem <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>import</span> <span>{</span> Actions <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span>
  editMenuItemFormSubmitted<span>,</span>
  MenusQuery<span>,</span>
<span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-edit-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./edit-item.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>EditItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>tap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>(</span><span>this</span><span>.</span>id <span>=</span> id<span>)</span><span>)</span><span>,</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>menusQuery<span>.</span><span>selectMenuItem</span><span>(</span>id<span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>private</span> id<span>:</span> <span>number</span> <span>|</span> <span>undefined</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> actions<span>:</span> Actions<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> menusQuery<span>:</span> MenusQuery
  <span>)</span> <span>{</span><span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>submit</span><span>(</span>menu<span>:</span> BaseMenuItem<span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>if</span> <span>(</span><span>!</span><span>this</span><span>.</span>id<span>)</span> <span>{</span>
      <span>return</span><span>;</span>
    <span>}</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span>
      <span>editMenuItemFormSubmitted</span><span>(</span><span>{</span>
        menuItem<span>:</span> <span>{</span>
          <span>...</span>menu<span>,</span>
          id<span>:</span> <span>this</span><span>.</span>id<span>.</span><span>toString</span><span>(</span><span>)</span><span>,</span>
        <span>}</span><span>,</span>
      <span>}</span><span>)</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>As explained at the beginning of the post, Effects are where side effects of the Action are handled. For Menus, this will mostly be making an HTTP request to get data from the server or perform other CRUD operations. In addition to handling side effects, We will also be using the Effects to update our state object. Let&#39;s start with creating an empty class with the <code>Injectable</code> decorator. Create <code>menus<span>.</span>effects<span>.</span>ts</code> in the <code>core<span>/</span>state<span>/</span>menus<span>/</span></code> directory and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>MenusEffects</span> <span>{</span><span>}</span></code></pre><p>Next, let&#39;s start with a simple effect that handles fetching the menu items from the API and updating the store with new data. Since this logic needs to be executed when the app loads and a new menu item is added successfully, you will pass in 2 actions - <code>MenusActions<span>.</span>appLoaded</code> and <code>MenusActions<span>.</span>addMenuItemSuccess</code>. You will then <code>switchMap</code> to the <code>apiService</code> to get the menu items. If it&#39;s successful, dispatch the <code>fecthMenuSuccess</code> action with the menu items returned from the API which will update the store with this new data. If unsuccessful, it will jump to the <code>catchError</code> block, which dispatches the <code>fetchMenuFailed</code> action with the error thrown. <code>MenusActions<span>.</span>fetchMenuSuccess</code> will then update the state object with the new menu items returned by the API call.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5F4vFYDLFRoX0ebGIG50nt/e4f772e1b81e7a9e882b2caba6fa09d8/03-akita-fetch-menu-effects.png" alt="Diagram of how the fetch menu effect works"/></p><blockquote><p>Tip: add your <code>catchError</code> to the inner observable in your <code>switchMap</code> instead of on the main observable to prevent the action stream from being closed when an error is thrown</p></blockquote><p>Open <code>menus<span>.</span>effects<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> <span>of</span> <span>}</span> <span>from</span> <span>&#34;rxjs&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> tap<span>,</span> switchMap<span>,</span> catchError <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> Actions<span>,</span> createEffect<span>,</span> ofType <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> ApiService <span>}</span> <span>from</span> <span>&#34;../../services&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> MenusActions <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusStore <span>}</span> <span>from</span> <span>&#34;./menus.store&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>MenusEffects</span> <span>{</span>
  <span>// ‚ú® New üëá</span>
  <span>constructor</span><span>(</span>
    <span>private</span> actions$<span>:</span> Actions<span>,</span>
    <span>private</span> menusStore<span>:</span> MenusStore<span>,</span>
    <span>private</span> apiService<span>:</span> ApiService
  <span>)</span> <span>{</span><span>}</span>

  <span>// ‚ú® New üëá</span>
  fetchMenu$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>MenusActions<span>.</span>appLoaded<span>,</span> MenusActions<span>.</span>addMenuItemSuccess<span>)</span><span>,</span>
        <span>switchMap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
          <span>this</span><span>.</span>apiService<span>.</span><span>getItems</span><span>(</span><span>)</span><span>.</span><span>pipe</span><span>(</span>
            <span>map</span><span>(</span><span>(</span>menuItems<span>)</span> <span>=&gt;</span>
              MenusActions<span>.</span><span>fetchMenuSuccess</span><span>(</span><span>{</span> menuItems<span>:</span> menuItems <span>}</span><span>)</span>
            <span>)</span><span>,</span>
            <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
              <span>of</span><span>(</span>MenusActions<span>.</span><span>fetchMenuFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
            <span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>true</span> <span>}</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  fetchMenuSuccess$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>MenusActions<span>.</span>fetchMenuSuccess<span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span> <span>{</span>
          <span>this</span><span>.</span>menusStore<span>.</span><span>update</span><span>(</span><span>(</span>state<span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
            <span>...</span>state<span>,</span>
            menus<span>:</span> action<span>.</span>menuItems<span>,</span>
          <span>}</span><span>)</span><span>)</span><span>;</span>
        <span>}</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>
<span>}</span></code></pre><p>Following the same logic, let&#39;s create effects for <code>addMenu</code>, <code>editMenu</code>, and <code>deleteMenu</code> along with their success handlers to update the state object. Open <code>menus<span>.</span>effects<span>.</span>ts</code> and update it with the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> <span>of</span> <span>}</span> <span>from</span> <span>&#34;rxjs&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> tap<span>,</span> switchMap<span>,</span> catchError <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> Actions<span>,</span> createEffect<span>,</span> ofType <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> ApiService <span>}</span> <span>from</span> <span>&#34;../../services&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> MenusActions <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusStore <span>}</span> <span>from</span> <span>&#34;./menus.store&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>MenusEffects</span> <span>{</span>
  <span>constructor</span><span>(</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> actions$<span>:</span> Actions<span>,</span>
    <span>private</span> menusStore<span>:</span> MenusStore<span>,</span>
    <span>private</span> apiService<span>:</span> ApiService
  <span>)</span> <span>{</span><span>}</span>

  fetchMenu$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>MenusActions<span>.</span>appLoaded<span>,</span> MenusActions<span>.</span>addMenuItemSuccess<span>)</span><span>,</span>
        <span>switchMap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
          <span>this</span><span>.</span>apiService<span>.</span><span>getItems</span><span>(</span><span>)</span><span>.</span><span>pipe</span><span>(</span>
            <span>map</span><span>(</span><span>(</span>menuItems<span>)</span> <span>=&gt;</span>
              MenusActions<span>.</span><span>fetchMenuSuccess</span><span>(</span><span>{</span> menuItems<span>:</span> menuItems <span>}</span><span>)</span>
            <span>)</span><span>,</span>
            <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
              <span>of</span><span>(</span>MenusActions<span>.</span><span>fetchMenuFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
            <span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>true</span> <span>}</span>
  <span>)</span><span>;</span>

  fetchMenuSuccess$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>MenusActions<span>.</span>fetchMenuSuccess<span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span> <span>{</span>
          <span>this</span><span>.</span>menusStore<span>.</span><span>update</span><span>(</span><span>(</span>state<span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
            <span>...</span>state<span>,</span>
            menus<span>:</span> action<span>.</span>menuItems<span>,</span>
          <span>}</span><span>)</span><span>)</span><span>;</span>
        <span>}</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  addMenu$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>MenusActions<span>.</span>addMenuItemFormSubmitted<span>)</span><span>,</span>
        <span>switchMap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span>
          <span>this</span><span>.</span>apiService<span>.</span><span>addItem</span><span>(</span>action<span>.</span>menuItem<span>)</span><span>.</span><span>pipe</span><span>(</span>
            <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/menu&#34;</span><span>]</span><span>)</span><span>)</span><span>,</span>
            <span>map</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> MenusActions<span>.</span><span>addMenuItemSuccess</span><span>(</span><span>)</span><span>)</span><span>,</span>
            <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
              <span>of</span><span>(</span>MenusActions<span>.</span><span>addMenuItemFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
            <span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>true</span> <span>}</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  editMenu$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>MenusActions<span>.</span>editMenuItemFormSubmitted<span>)</span><span>,</span>
        <span>switchMap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span>
          <span>this</span><span>.</span>apiService<span>.</span><span>updateItem</span><span>(</span>action<span>.</span>menuItem<span>)</span><span>.</span><span>pipe</span><span>(</span>
            <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>)</span><span>,</span>
            <span>map</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
              MenusActions<span>.</span><span>editMenuItemSuccess</span><span>(</span><span>{</span> menuItem<span>:</span> action<span>.</span>menuItem <span>}</span><span>)</span>
            <span>)</span><span>,</span>
            <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
              <span>of</span><span>(</span>MenusActions<span>.</span><span>editMenuItemFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
            <span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>true</span> <span>}</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  editMenuSuccess$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>MenusActions<span>.</span>editMenuItemSuccess<span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span> <span>{</span>
          <span>const</span> menuItem <span>=</span> action<span>.</span>menuItem<span>;</span>
          <span>const</span> menuItems <span>=</span> <span>this</span><span>.</span>menusStore<span>.</span><span>getValue</span><span>(</span><span>)</span><span>.</span>menus<span>;</span>
          <span>const</span> menuItemIndex <span>=</span> menuItems<span>.</span><span>findIndex</span><span>(</span>
            <span>(</span>item<span>)</span> <span>=&gt;</span> item<span>.</span>id <span>===</span> menuItem<span>.</span>id
          <span>)</span><span>;</span>
          <span>const</span> updatedMenuItems <span>=</span> <span>[</span><span>...</span>menuItems<span>]</span><span>;</span>
          updatedMenuItems<span>[</span>menuItemIndex<span>]</span> <span>=</span> menuItem<span>;</span>
          <span>this</span><span>.</span>menusStore<span>.</span><span>update</span><span>(</span><span>(</span>state<span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
            <span>...</span>state<span>,</span>
            menus<span>:</span> updatedMenuItems<span>,</span>
          <span>}</span><span>)</span><span>)</span><span>;</span>
        <span>}</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  deleteMenu$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>MenusActions<span>.</span>deleteMenuItemInitiated<span>)</span><span>,</span>
        <span>switchMap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span>
          <span>this</span><span>.</span>apiService<span>.</span><span>deleteItem</span><span>(</span>action<span>.</span>menuId<span>)</span><span>.</span><span>pipe</span><span>(</span>
            <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/menu&#34;</span><span>]</span><span>)</span><span>)</span><span>,</span>
            <span>map</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
              MenusActions<span>.</span><span>deleteMenuItemSuccess</span><span>(</span><span>{</span> menuId<span>:</span> action<span>.</span>menuId <span>}</span><span>)</span>
            <span>)</span><span>,</span>
            <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
              <span>of</span><span>(</span>MenusActions<span>.</span><span>deleteMenuItemFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
            <span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>true</span> <span>}</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  deleteMenuSuccess$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>MenusActions<span>.</span>deleteMenuItemSuccess<span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span> <span>{</span>
          <span>const</span> menuId <span>=</span> action<span>.</span>menuId<span>;</span>
          <span>const</span> menuItems <span>=</span> <span>this</span><span>.</span>menusStore<span>.</span><span>getValue</span><span>(</span><span>)</span><span>.</span>menus<span>;</span>
          <span>const</span> menuItemIndex <span>=</span> menuItems<span>.</span><span>findIndex</span><span>(</span>
            <span>(</span>item<span>)</span> <span>=&gt;</span> item<span>.</span>id <span>===</span> menuId
          <span>)</span><span>;</span>
          <span>const</span> updatedMenuItems <span>=</span> <span>[</span><span>...</span>menuItems<span>]</span><span>;</span>
          updatedMenuItems<span>.</span><span>splice</span><span>(</span>menuItemIndex<span>,</span> <span>1</span><span>)</span><span>;</span>
          <span>this</span><span>.</span>menusStore<span>.</span><span>update</span><span>(</span><span>(</span>state<span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
            <span>...</span>state<span>,</span>
            menus<span>:</span> updatedMenuItems<span>,</span>
          <span>}</span><span>)</span><span>)</span><span>;</span>
        <span>}</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>
<span>}</span></code></pre><blockquote><p>Tip: You can add the following effect if you want to listen to every action that gets dispatched for debugging purposes (more on debugging in the devtools section) üëá</p></blockquote><pre><code>init$ <span>=</span> <span>createEffect</span><span>(</span>
  <span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span><span>tap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span>action<span>)</span><span>)</span><span>)</span><span>,</span>
  <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
<span>)</span><span>;</span></code></pre><p>Add <code>menus<span>.</span>effects</code> to the menu directory&#39;s barrel export. Open <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.store&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.query&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.effects&#34;</span><span>;</span></code></pre><h4 id="Configure-effects-module">Configure effects module</h4><p>You will then need to initialize Akita&#39;s <code>EffectsModule</code> passing in all your feature Effects (in our case, just the <code>MenusEffects</code> for now). Open <code>app<span>.</span>module<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/app.module.ts</span>

<span>import</span> <span>{</span> BrowserModule <span>}</span> <span>from</span> <span>&#34;@angular/platform-browser&#34;</span><span>;</span>
<span>import</span> <span>{</span> NgModule <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> HttpClientModule<span>,</span> <span>HTTP_INTERCEPTORS</span> <span>}</span> <span>from</span> <span>&#34;@angular/common/http&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthHttpInterceptor<span>,</span> AuthModule <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>
<span>import</span> <span>{</span> AkitaNgDevtools <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ngdevtools&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> AkitaNgEffectsModule <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>

<span>import</span> <span>{</span> AppRoutingModule <span>}</span> <span>from</span> <span>&#34;./app-routing.module&#34;</span><span>;</span>
<span>import</span> <span>{</span> AppComponent <span>}</span> <span>from</span> <span>&#34;./app.component&#34;</span><span>;</span>
<span>import</span> <span>{</span> NavBarModule <span>}</span> <span>from</span> <span>&#34;./shared&#34;</span><span>;</span>
<span>import</span> <span>{</span> environment <span>}</span> <span>from</span> <span>&#34;src/environments/environment&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> MenusEffects <span>}</span> <span>from</span> <span>&#34;./core/state/menus&#34;</span><span>;</span>

@<span>NgModule</span><span>(</span><span>{</span>
  imports<span>:</span> <span>[</span>
    BrowserModule<span>,</span>
    HttpClientModule<span>,</span>
    AuthModule<span>.</span><span>forRoot</span><span>(</span><span>{</span>
      <span>...</span>environment<span>.</span>auth<span>,</span>
      httpInterceptor<span>:</span> <span>{</span>
        allowedList<span>:</span> <span>[</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items</span><span>`</span></span><span>,</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items/*</span><span>`</span></span><span>,</span>
        <span>]</span><span>,</span>
      <span>}</span><span>,</span>
    <span>}</span><span>)</span><span>,</span>
    AppRoutingModule<span>,</span>
    NavBarModule<span>,</span>
    environment<span>.</span>production
      <span>?</span> <span>[</span><span>]</span>
      <span>:</span> AkitaNgDevtools<span>.</span><span>forRoot</span><span>(</span><span>{</span>
          maxAge<span>:</span> <span>25</span><span>,</span>
        <span>}</span><span>)</span><span>,</span>

    <span>// ‚ú® New üëá</span>
    AkitaNgEffectsModule<span>.</span><span>forRoot</span><span>(</span><span>[</span>MenusEffects<span>]</span><span>)</span><span>,</span>
  <span>]</span><span>,</span>
  declarations<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  bootstrap<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  providers<span>:</span> <span>[</span>
    <span>{</span>
      provide<span>:</span> <span>HTTP_INTERCEPTORS</span><span>,</span>
      useClass<span>:</span> AuthHttpInterceptor<span>,</span>
      multi<span>:</span> <span>true</span><span>,</span>
    <span>}</span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppModule</span> <span>{</span><span>}</span></code></pre><blockquote><p><strong>Checkpoint:</strong> Executing any CRUD operations such as adding a new menu item and editing or deleting an existing menu item should make an API call to update the server&#39;s database and also update the app&#39;s state. Only authenticated users with a <code>menu<span>-</span>admin</code> role can create, update, and delete menu items. The <code>menu<span>-</span>admin</code> role bundles the necessary permissions to execute these write operations. Read more on how to configure role-based access control (RBAC) and how to create an admin user for this application in this <a href="https://auth0.com/blog/node-js-and-typescript-tutorial-secure-an-express-api/#Configure-Role-Based-Access-Control--RBAC-" target="_blank" rel="noreferrer noopener">blog post</a></p></blockquote><h2 id="Conclusion">Conclusion</h2><p>We&#39;ve covered how Akita works, its installation, and how to use it to manage our application&#39;s state. In the second half of this tutorial: [State Management in Angular with Akita - Part 2](TODO: link here), we&#39;ll learn how to use Auth0 with Akita to manage user-related states.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 10 Feb 2022 15:01:00 +0000</pubDate>
    </item>
    <item>
      <title>State Management in Angular Using Akita - Pt. 2</title>
      <link>https://auth0.com/blog/state-management-in-angular-with-akita-2/</link>
      <description>See how it&#39;s easy to manage your Angular application&#39;s state using Akita and learn how you can use Akita with Auth0&#39;s SDK to handle user-related functionalities.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> In the first part of the state management in Angular with Akita series, we learned about the basics of Akita, how it works, and how to use it to manage our application&#39;s state. In part 2, I will show you how to use Auth0 with Akita to manage use-related states.</p><hr/><h2 id="User-State-Management">User State Management</h2><p>The user store will work similarly to how the menus state management works. I won&#39;t detail how each part of the state works and focus more on the Auth0 and Akita integration.</p><p>The starter app is using the Auth0 SDK directly and managing the roles through the <code>RolesService</code>, this section of the tutorial will walk you through migrating to using Auth0&#39;s SDK through Akita and managing the roles by using Queries.</p><h3 id="Create-user-store">Create user store</h3><p>Let&#39;s start with defining the interface for the user state object and its initial state. Open <code>user<span>.</span>store<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.store.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Store<span>,</span> StoreConfig <span>}</span> <span>from</span> <span>&#34;@datorama/akita&#34;</span><span>;</span>
<span>import</span> <span>{</span> User <span>as</span> Auth0User <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-spa-js&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>UserState</span> <span>{</span>
  user<span>:</span> Auth0User <span>|</span> <span>undefined</span><span>;</span>
<span>}</span>

<span>export</span> <span>function</span> <span>createInitialState</span><span>(</span><span>)</span><span>:</span> UserState <span>{</span>
  <span>return</span> <span>{</span>
    user<span>:</span> <span>undefined</span><span>,</span>
  <span>}</span><span>;</span>
<span>}</span>
@<span>StoreConfig</span><span>(</span><span>{</span> name<span>:</span> <span>&#34;user&#34;</span> <span>}</span><span>)</span>
@<span>Injectable</span><span>(</span><span>{</span> providedIn<span>:</span> <span>&#34;root&#34;</span> <span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>UserStore</span> <span>extends</span> <span>Store<span>&lt;</span>UserState<span>&gt;</span></span> <span>{</span>
  <span>constructor</span><span>(</span><span>)</span> <span>{</span>
    <span>super</span><span>(</span><span>createInitialState</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Create a barrel export for the <code>user</code> directory with the following code üëá</p><pre><code><span>// src/app/core/state/user/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.store&#34;</span><span>;</span></code></pre><h3 id="Create-user-actions">Create user actions</h3><p>We have three user-related Actions that we need for our user Store. Login, logout, and user changed Action to keep the user details in our Store in sync with Auth0&#39;s SDK.</p><p>Since we have several user Actions that will originate from the Navbar component, you can group them under <code>allNavbarAction</code> to ensure you aren&#39;t reusing these Actions in a different part of the application (following the Good Action Hygiene pattern).</p><p>Because the <code>userChangedFromAuth0SDK</code> Action originates from Auth0&#39;s SDK, let&#39;s name the source part of the Action type as <code>Auth0 <span>SDK</span></code>.</p><p>Open <code>user<span>.</span>actions<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.actions.ts</span>

<span>import</span> <span>{</span> createAction<span>,</span> props <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> User <span>as</span> Auth0User <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-spa-js&#34;</span><span>;</span>

<span>export</span> <span>const</span> allNavbarActions <span>=</span> <span>{</span>
  loginFlowInitiated<span>:</span> <span>createAction</span><span>(</span><span>&#34;[Navbar] Login Flow Initiated&#34;</span><span>)</span><span>,</span>
  logoutFlowInitiated<span>:</span> <span>createAction</span><span>(</span><span>&#34;[Navbar] Logout Flow Initiated&#34;</span><span>)</span><span>,</span>
<span>}</span><span>;</span>

<span>export</span> <span>const</span> userChangedFromAuth0SDK <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Auth0 SDK] User Changed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> user<span>:</span> Auth0User <span>|</span> <span>undefined</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>Add <code>user<span>.</span>actions</code> to the barrel export. Open <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.store&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span></code></pre><h4 id="Update-application-to-use-user-actions">Update application to use user actions</h4><p>Open <code>nav<span>-</span>bar<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/shared/components/nav-bar/nav-bar.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> IconDefinition <span>}</span> <span>from</span> <span>&#34;@fortawesome/fontawesome-svg-core&#34;</span><span>;</span>
<span>import</span> <span>{</span> faHome<span>,</span> faUser<span>,</span> faUtensils <span>}</span> <span>from</span> <span>&#34;@fortawesome/free-solid-svg-icons&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthService <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Actions <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> allNavbarActions <span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>INavBarMenuLinkProps</span> <span>{</span>
  to<span>:</span> <span>string</span><span>;</span>
  icon<span>:</span> IconDefinition<span>;</span>
  label<span>:</span> <span>string</span><span>;</span>
<span>}</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-nav-bar&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./nav-bar.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./nav-bar.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>NavBarComponent</span> <span>{</span>
  faUser <span>=</span> faUser<span>;</span>
  isAuthenticated$ <span>=</span> <span>this</span><span>.</span>authService<span>.</span>isAuthenticated$<span>;</span>
  user$ <span>=</span> <span>this</span><span>.</span>authService<span>.</span>user$<span>;</span>

  navOptions<span>:</span> INavBarMenuLinkProps<span>[</span><span>]</span> <span>=</span> <span>[</span>
    <span>{</span> to<span>:</span> <span>&#34;/home&#34;</span><span>,</span> label<span>:</span> <span>&#34;Home&#34;</span><span>,</span> icon<span>:</span> faHome <span>}</span><span>,</span>
    <span>{</span> to<span>:</span> <span>&#34;/menu&#34;</span><span>,</span> label<span>:</span> <span>&#34;Menu&#34;</span><span>,</span> icon<span>:</span> faUtensils <span>}</span><span>,</span>
  <span>]</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> authService<span>:</span> AuthService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> actions<span>:</span> Actions
  <span>)</span> <span>{</span><span>}</span>

  <span>loginWithRedirect</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span>allNavbarActions<span>.</span><span>loginFlowInitiated</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>logout</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span>allNavbarActions<span>.</span><span>logoutFlowInitiated</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><h3 id="Create-user-query">Create user query</h3><p>Before creating individual queries for slices of the user state, let&#39;s start by creating the boilerplate required to use this feature. Akita uses an <code>Injectable</code> class that extends Akita&#39;s <code>Query</code> class. Create <code>user<span>.</span>query<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.query.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Query <span>}</span> <span>from</span> <span>&#34;@datorama/akita&#34;</span><span>;</span>
<span>import</span> <span>{</span> UserState <span>}</span> <span>from</span> <span>&#34;./user.store&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>{</span> providedIn<span>:</span> <span>&#34;root&#34;</span> <span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>UserQuery</span> <span>extends</span> <span>Query<span>&lt;</span>UserState<span>&gt;</span></span> <span>{</span>
  selectUser$ <span>=</span> <span>this</span><span>.</span><span>select</span><span>(</span><span>&#34;user&#34;</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>Next, Let&#39;s add some utility Queries for <code>isLoggedIn</code>, <code>userRoles</code>, and <code>isAdmin</code> to let your components access these properties easily. Open <code>user<span>.</span>query<span>.</span>ts</code> and update it with the following code üëá</p><pre><code><span>// src/app/core/state/user/user.query.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Query <span>}</span> <span>from</span> <span>&#34;@datorama/akita&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> map <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> environment <span>}</span> <span>from</span> <span>&#34;src/environments/environment&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> UserStore<span>,</span> UserState <span>}</span> <span>from</span> <span>&#34;./user.store&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> <span>USER_ROLES</span> <span>=</span> <span>{</span>
  <span>MENU_ADMIN</span><span>:</span> <span>&#34;menu-admin&#34;</span><span>,</span>
<span>}</span><span>;</span>
@<span>Injectable</span><span>(</span><span>{</span> providedIn<span>:</span> <span>&#34;root&#34;</span> <span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>UserQuery</span> <span>extends</span> <span>Query<span>&lt;</span>UserState<span>&gt;</span></span> <span>{</span>
  selectUser$ <span>=</span> <span>this</span><span>.</span><span>select</span><span>(</span><span>&#34;user&#34;</span><span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  selectIsLoggedIn$ <span>=</span> <span>this</span><span>.</span>selectUser$<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>user<span>)</span> <span>=&gt;</span> <span>!</span><span>!</span>user<span>)</span><span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  selectUserRoles$ <span>=</span> <span>this</span><span>.</span>selectUser$<span>.</span><span>pipe</span><span>(</span>
    <span>map</span><span>(</span><span>(</span>user<span>)</span> <span>=&gt;</span> user<span>?.</span><span>[</span><span><span>`</span><span><span>${</span>environment<span>.</span>auth<span>.</span>audience<span>}</span></span><span>/roles</span><span>`</span></span><span>]</span> <span>||</span> <span>undefined</span><span>)</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  selectIsAdmin$ <span>=</span> <span>this</span><span>.</span>selectUserRoles$<span>.</span><span>pipe</span><span>(</span>
    <span>map</span><span>(</span><span>(</span>userRoles<span>)</span> <span>=&gt;</span> userRoles<span>?.</span><span>includes</span><span>(</span><span>USER_ROLES</span><span>.</span><span>MENU_ADMIN</span><span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>constructor</span><span>(</span><span>protected</span> store<span>:</span> UserStore<span>)</span> <span>{</span>
    <span>super</span><span>(</span>store<span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Add <code>user<span>.</span>query</code> to the list of exports in <code>index<span>.</span>ts</code> üëá</p><pre><code><span>// src/app/core/state/user/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.store&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.query&#34;</span><span>;</span></code></pre><h4 id="Update-application-to-use-user-queries">Update application to use user queries</h4><p>The user role route guard was previously using the value of the roles from <code>RolesService</code>. Since you now have a user roles Query, you can replace the current implementation with a query created in the previous section. Open <code>user<span>-</span>role<span>.</span>guard<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/guards/user-role.guard.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span>
  CanActivate<span>,</span>
  Router<span>,</span>
  ActivatedRouteSnapshot<span>,</span>
  RouterStateSnapshot<span>,</span>
<span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> Observable<span>,</span> <span>of</span> <span>}</span> <span>from</span> <span>&#34;rxjs&#34;</span><span>;</span>
<span>import</span> <span>{</span> catchError<span>,</span> map <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> UserQuery <span>}</span> <span>from</span> <span>&#34;../state/user&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>{</span> providedIn<span>:</span> <span>&#34;root&#34;</span> <span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>UserRoleGuard</span> <span>implements</span> <span>CanActivate</span> <span>{</span>
  <span>constructor</span><span>(</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> userQuery<span>:</span> UserQuery
  <span>)</span> <span>{</span><span>}</span>

  <span>canActivate</span><span>(</span>
    route<span>:</span> ActivatedRouteSnapshot<span>,</span>
    state<span>:</span> RouterStateSnapshot
  <span>)</span><span>:</span> Observable<span>&lt;</span><span>boolean</span><span>&gt;</span> <span>{</span>
    <span>// ‚ú® Update this üëá</span>
    <span>return</span> <span>this</span><span>.</span>userQuery<span>.</span>selectUserRoles$<span>.</span><span>pipe</span><span>(</span>
      <span>map</span><span>(</span><span>(</span>roles<span>)</span> <span>=&gt;</span> <span>{</span>
        <span>if</span> <span>(</span>roles <span>&amp;&amp;</span> roles<span>.</span><span>includes</span><span>(</span>route<span>?.</span>data<span>?.</span>role<span>)</span><span>)</span> <span>{</span>
          <span>return</span> <span>true</span><span>;</span>
        <span>}</span>

        <span>// redirect the user to home</span>
        <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/home&#34;</span><span>]</span><span>)</span><span>;</span>
        <span>return</span> <span>false</span><span>;</span>
      <span>}</span><span>)</span><span>,</span>
      <span>catchError</span><span>(</span><span>(</span>err<span>)</span> <span>=&gt;</span> <span>{</span>
        <span>// redirect the user to home</span>
        <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/home&#34;</span><span>]</span><span>)</span><span>;</span>
        <span>return</span> <span>of</span><span>(</span><span>false</span><span>)</span><span>;</span>
      <span>}</span><span>)</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Another place we use user-related information is the Navbar. We display user information and conditionally display the login and logout button depending on the user&#39;s <code>isAuthenticated</code> state. Open <code>nav<span>-</span>bar<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/shared/components/nav-bar/nav-bar.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Actions <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> IconDefinition <span>}</span> <span>from</span> <span>&#34;@fortawesome/fontawesome-svg-core&#34;</span><span>;</span>
<span>import</span> <span>{</span> faHome<span>,</span> faUser<span>,</span> faUtensils <span>}</span> <span>from</span> <span>&#34;@fortawesome/free-solid-svg-icons&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> allNavbarActions<span>,</span> UserQuery <span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>INavBarMenuLinkProps</span> <span>{</span>
  to<span>:</span> <span>string</span><span>;</span>
  icon<span>:</span> IconDefinition<span>;</span>
  label<span>:</span> <span>string</span><span>;</span>
<span>}</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-nav-bar&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./nav-bar.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./nav-bar.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>NavBarComponent</span> <span>{</span>
  faUser <span>=</span> faUser<span>;</span>

  <span>// ‚ú® New üëá</span>
  isAuthenticated$ <span>=</span> <span>this</span><span>.</span>userQuery<span>.</span>selectIsLoggedIn$<span>;</span>

  <span>// ‚ú® New üëá</span>
  user$ <span>=</span> <span>this</span><span>.</span>userQuery<span>.</span>selectUser$<span>;</span>

  navOptions<span>:</span> INavBarMenuLinkProps<span>[</span><span>]</span> <span>=</span> <span>[</span>
    <span>{</span> to<span>:</span> <span>&#34;/home&#34;</span><span>,</span> label<span>:</span> <span>&#34;Home&#34;</span><span>,</span> icon<span>:</span> faHome <span>}</span><span>,</span>
    <span>{</span> to<span>:</span> <span>&#34;/menu&#34;</span><span>,</span> label<span>:</span> <span>&#34;Menu&#34;</span><span>,</span> icon<span>:</span> faUtensils <span>}</span><span>,</span>
  <span>]</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  <span>constructor</span><span>(</span><span>private</span> userQuery<span>:</span> UserQuery<span>,</span> <span>private</span> actions<span>:</span> Actions<span>)</span> <span>{</span><span>}</span>

  <span>loginWithRedirect</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span>allNavbarActions<span>.</span><span>loginFlowInitiated</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>logout</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>actions<span>.</span><span>dispatch</span><span>(</span>allNavbarActions<span>.</span><span>logoutFlowInitiated</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>The profile page displays some information about the user, such as name and photo. Since this is stored as part of the user Store, let&#39;s also update this to use the <code>selectUser$</code> Query. Open <code>profile<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/profile/profile.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> UserQuery <span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-profile&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./profile.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./profile.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>ProfileComponent</span> <span>{</span>
  <span>// ‚ú® New üëá</span>
  user$ <span>=</span> <span>this</span><span>.</span>userQuery<span>.</span>selectUser$<span>;</span>

  <span>// ‚ú® New üëá</span>
  <span>constructor</span><span>(</span><span>private</span> userQuery<span>:</span> UserQuery<span>)</span> <span>{</span><span>}</span>
<span>}</span></code></pre><p>We display an <code>Add</code> button when the logged-in user is an admin user on the Menu Items page. You can read more about setting up admin users on Auth0 in this <a href="https://auth0.com/blog/developing-a-secure-api-with-nestjs-adding-role-based-access-control/#Get-User-Roles" target="_blank" rel="noreferrer noopener">blog post</a>. Open <code>menu<span>-</span>items<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/menu-items/menu-items.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusQuery <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> UserQuery <span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-menu-items&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./menu-items.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenuItemsComponent</span> <span>{</span>
  menuItems$ <span>=</span> <span>this</span><span>.</span>menuQuery<span>.</span>selectMenuItems$<span>;</span>

  <span>// ‚ú® New üëá</span>
  isAdmin$ <span>=</span> <span>this</span><span>.</span>userQuery<span>.</span>selectIsAdmin$<span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> userQuery<span>:</span> UserQuery<span>,</span>
    <span>private</span> menuQuery<span>:</span> MenusQuery
  <span>)</span> <span>{</span><span>}</span>

  <span>addMenuItem</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;add&#34;</span><span>]</span><span>,</span> <span>{</span> relativeTo<span>:</span> <span>this</span><span>.</span>activatedRoute <span>}</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Lastly, we display a <code>Edit</code> and <code>Delete</code> buttons when the logged-in user is an admin user on the Menu Item page. Open <code>menu<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/menu-item/menu-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusQuery <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> UserQuery <span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-menu-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./menu-item.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./menu-item.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenuItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>

  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>menusQuery<span>.</span><span>selectMenuItem</span><span>(</span>id<span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  isAdmin$ <span>=</span> <span>this</span><span>.</span>userQuery<span>.</span>selectIsAdmin$<span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> userQuery<span>:</span> UserQuery<span>,</span>
    <span>private</span> menusQuery<span>:</span> MenusQuery
  <span>)</span> <span>{</span><span>}</span>

  <span>back</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>navigateTo</span><span>(</span>url<span>:</span> <span>string</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigateByUrl</span><span>(</span><span><span>`</span><span><span>${</span><span>this</span><span>.</span>router<span>.</span>url<span>}</span></span><span>/</span><span><span>${</span>url<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><h3 id="Create-user-effects">Create user effects</h3><p>As explained at the beginning of part 1 of the &#34;State Management with Akita&#34; series, Effects are where side effects of the Action are handled. For the user store, this will be where the app will interact with Auth0&#39;s SDK, updating the store when the user object changes and logging in and logging out the user. Let&#39;s start with creating an empty class with the <code>Injectable</code> decorator. Create <code>user<span>.</span>effects<span>.</span>ts</code> in the <code>core<span>/</span>state<span>/</span>user<span>/</span></code> directory and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>UserEffects</span> <span>{</span><span>}</span></code></pre><p>Next, let&#39;s add login and logout action handlers that trigger their respective flows in Auth0&#39;s SDK. Open <code>user<span>.</span>effects<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> map<span>,</span> tap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthService <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>
<span>import</span> <span>{</span> Actions<span>,</span> createEffect<span>,</span> ofType <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> UserActions <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span>
<span>import</span> <span>{</span> UserStore <span>}</span> <span>from</span> <span>&#34;./user.store&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>UserEffects</span> <span>{</span>
  <span>// ‚ú® New üëá</span>
  <span>constructor</span><span>(</span>
    <span>private</span> actions$<span>:</span> Actions<span>,</span>
    <span>private</span> userStore<span>:</span> UserStore<span>,</span>
    <span>private</span> authService<span>:</span> AuthService
  <span>)</span> <span>{</span><span>}</span>

  <span>// ‚ú® New üëá</span>
  login$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>UserActions<span>.</span>allNavbarActions<span>.</span>loginFlowInitiated<span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>authService<span>.</span><span>loginWithRedirect</span><span>(</span><span>)</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  logout$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>UserActions<span>.</span>allNavbarActions<span>.</span>logoutFlowInitiated<span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>authService<span>.</span><span>logout</span><span>(</span><span>)</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>
<span>}</span></code></pre><p>To keep the user observable from the Auth0&#39;s SDK and our user Store in sync, you can use an actionless effect that listens to an external observable (in our case <code>authService<span>.</span>user$</code>) and dispatches another action (<code>UserActions<span>.</span>userChangedFromAuth0SDK</code>) whenever that observable emits a new value. <code>UserActions<span>.</span>userChangedFromAuth0SDK</code> will then update the user store with new user data from Auth0. Open <code>user<span>.</span>effects<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> tap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> Actions<span>,</span> createEffect<span>,</span> ofType <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> UserActions <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span>
<span>import</span> <span>{</span> UserStore <span>}</span> <span>from</span> <span>&#34;./user.store&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthService <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>UserEffects</span> <span>{</span>
  <span>constructor</span><span>(</span>
    <span>private</span> actions$<span>:</span> Actions<span>,</span>
    <span>private</span> userStore<span>:</span> UserStore<span>,</span>
    <span>private</span> authService<span>:</span> AuthService
  <span>)</span> <span>{</span><span>}</span>

  <span>// ‚ú® New üëá</span>
  userChanged$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>authService<span>.</span>user$<span>.</span><span>pipe</span><span>(</span>
        <span>map</span><span>(</span><span>(</span>user<span>)</span> <span>=&gt;</span>
          UserActions<span>.</span><span>userChangedFromAuth0SDK</span><span>(</span><span>{</span> user<span>:</span> user <span>||</span> <span>undefined</span> <span>}</span><span>)</span>
        <span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>true</span> <span>}</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  userChangedFromAuth0SDK$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>UserActions<span>.</span>userChangedFromAuth0SDK<span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span> <span>{</span>
          <span>this</span><span>.</span>userStore<span>.</span><span>update</span><span>(</span><span>(</span>state<span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
            <span>...</span>state<span>,</span>
            user<span>:</span> action<span>.</span>user<span>,</span>
          <span>}</span><span>)</span><span>)</span><span>;</span>
        <span>}</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>

  login$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>UserActions<span>.</span>allNavbarActions<span>.</span>loginFlowInitiated<span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>authService<span>.</span><span>loginWithRedirect</span><span>(</span><span>)</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>

  logout$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>UserActions<span>.</span>allNavbarActions<span>.</span>logoutFlowInitiated<span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>authService<span>.</span><span>logout</span><span>(</span><span>)</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>
<span>}</span></code></pre><p>Add <code>user<span>.</span>effects</code> to the barrel export. Open <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.store&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.query&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.effects&#34;</span><span>;</span></code></pre><h4 id="Update-Effects-Module">Update Effects Module</h4><p>You will then need to add <code>UserEffects</code> to the <code>EffectsModule</code> initialization. Open <code>app<span>.</span>module<span>.</span>ts</code> and add the following code</p><pre><code><span>// src/app/app.module.ts</span>

<span>import</span> <span>{</span> BrowserModule <span>}</span> <span>from</span> <span>&#34;@angular/platform-browser&#34;</span><span>;</span>
<span>import</span> <span>{</span> NgModule <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> HttpClientModule<span>,</span> <span>HTTP_INTERCEPTORS</span> <span>}</span> <span>from</span> <span>&#34;@angular/common/http&#34;</span><span>;</span>
<span>import</span> <span>{</span> AkitaNgEffectsModule <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ng-effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> AkitaNgDevtools <span>}</span> <span>from</span> <span>&#34;@datorama/akita-ngdevtools&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthHttpInterceptor<span>,</span> AuthModule <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>

<span>import</span> <span>{</span> AppRoutingModule <span>}</span> <span>from</span> <span>&#34;./app-routing.module&#34;</span><span>;</span>
<span>import</span> <span>{</span> AppComponent <span>}</span> <span>from</span> <span>&#34;./app.component&#34;</span><span>;</span>
<span>import</span> <span>{</span> NavBarModule <span>}</span> <span>from</span> <span>&#34;./shared&#34;</span><span>;</span>
<span>import</span> <span>{</span> environment <span>}</span> <span>from</span> <span>&#34;src/environments/environment&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusEffects <span>}</span> <span>from</span> <span>&#34;./core/state/menus&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> UserEffects <span>}</span> <span>from</span> <span>&#34;./core/state/user&#34;</span><span>;</span>

@<span>NgModule</span><span>(</span><span>{</span>
  imports<span>:</span> <span>[</span>
    BrowserModule<span>,</span>
    HttpClientModule<span>,</span>
    AuthModule<span>.</span><span>forRoot</span><span>(</span><span>{</span>
      <span>...</span>environment<span>.</span>auth<span>,</span>
      httpInterceptor<span>:</span> <span>{</span>
        allowedList<span>:</span> <span>[</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items</span><span>`</span></span><span>,</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items/*</span><span>`</span></span><span>,</span>
        <span>]</span><span>,</span>
      <span>}</span><span>,</span>
    <span>}</span><span>)</span><span>,</span>
    AppRoutingModule<span>,</span>
    NavBarModule<span>,</span>

    <span>// ‚ú® Update this üëá</span>
    AkitaNgEffectsModule<span>.</span><span>forRoot</span><span>(</span><span>[</span>MenusEffects<span>,</span> UserEffects<span>]</span><span>)</span><span>,</span>
    environment<span>.</span>production
      <span>?</span> <span>[</span><span>]</span>
      <span>:</span> AkitaNgDevtools<span>.</span><span>forRoot</span><span>(</span><span>{</span>
          maxAge<span>:</span> <span>25</span><span>,</span>
        <span>}</span><span>)</span><span>,</span>
  <span>]</span><span>,</span>
  declarations<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  bootstrap<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  providers<span>:</span> <span>[</span>
    <span>{</span>
      provide<span>:</span> <span>HTTP_INTERCEPTORS</span><span>,</span>
      useClass<span>:</span> AuthHttpInterceptor<span>,</span>
      multi<span>:</span> <span>true</span><span>,</span>
    <span>}</span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppModule</span> <span>{</span><span>}</span></code></pre><blockquote><p><strong>Checkpoint:</strong> There aren&#39;t any visible functional changes added in this section. The difference between the app&#39;s current state and the previous checkpoint is its underlying implementation. The app now uses Akita versus a <code>BehaviorSubject</code> to manage user-related states. The app should display the login button with an empty dashboard when the user is not authenticated, and display the logout button with the logged-in user&#39;s name along with the menu items on the dashboard when a user is authenticated. Clicking on the &#34;Log in&#34; and &#34;Log out&#34; buttons should trigger their respective flows using Auth0&#39;s SDK and update your application&#39;s state. If you open Redux Devtools in your browser, you should see the user state and actions every time you perform any user-related actions.</p></blockquote><h2 id="Conclusion">Conclusion</h2><p>State management is a key component when building applications. You added two Stores to our demo application to manage two distinct states - menus and user. This is a relatively small demo application with a few Stores, Actions, Queries, and Effects to show how you can use Akita to manage your Application&#39;s state, and use Akita with Auth0&#39;s SDK to handle user-related functionalities.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 10 Feb 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Credential Guard Detects Breached Passwords Faster to Prevent Account Takeover</title>
      <link>https://auth0.com/blog/auth0-credential-guard-detects-breached-passwords-faster-to-prevent-account-takeover/</link>
      <description>New feature adds a dedicated security team and support for multiple languages to prevent fraudulent access with stolen credentials</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>BELLEVUE, Wash. ‚Äì February 9, 2022 ‚Äì <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a></strong>, a product unit within <a href="https://www.okta.com/" target="_blank" rel="noreferrer noopener">Okta</a> (NASDAQ: OKTA), today announced the general availability of <a href="https://www.auth0.com/breached-passwords#credential-guard" target="_blank" rel="noreferrer noopener">Credential Guard</a>, a new security feature that helps enterprises prevent account takeover attacks by detecting and resetting stolen passwords faster. Credential Guard upgrades Auth0‚Äôs existing breached password detection with a dedicated security team, and support for more than 35 languages and 200+ countries and territories to reduce breach detection time.</p><p>Credential Guard gives application builders the tools to secure their apps and protect their users from bad actors logging in with stolen credentials. Auth0‚Äôs breached password detection enables organizations to automatically screen for stolen passwords, and alert the user, prompt for additional verification, or block access by forcing a password reset. Credential Guard adds even more visibility and speed with a dedicated security team that infiltrates criminal communities to gain access to otherwise unavailable breach data.</p><p>Auth0‚Äôs security team conducted an internal test on 100,000 random usernames, and found that the ability to detect breached passwords (breach detection efficacy) increased by a minimum of 250% when using Credential Guard compared to an automated detection solution alone.</p><p>‚ÄúThe goal with Credential Guard is to help organizations detect breaches as soon as they happen, to reduce the risk to the business and its users,‚Äù said Shiv Ramji, Chief Product Officer at Auth0. ‚ÄúTraditional web scanners and scrapers rely on breach data being made public, which can be months or even years after the initial breach. Credential Guard enables security teams to shrink that gap, and better protect their customers‚Äô digital identities on a global scale.‚Äù</p><p>Account takeover attacks with stolen credentials, targeting everything from sensitive healthcare data to loyalty points, are one of the most common and costly cyber threats. Verizon‚Äôs 2021 <a href="https://www.verizon.com/business/resources/reports/dbir/" target="_blank" rel="noreferrer noopener">Data Breach Investigations Report</a> (DBIR) found that 89% of web application breaches involve some sort of credential abuse (use of stolen credentials or brute force). Reusing passwords across sites increases the risk of an attack and makes it more difficult for organizations to prevent fraudulent access to user accounts. With Credential Guard, organizations can secure their apps and protect their users during the login process by detecting and resetting exposed passwords before they fall into the wrong hands.</p><p>Credential Guard is available as an Enterprise Add-on for existing Auth0 customers. For more information, please visit the <a href="https://auth0.com/blog/detect-breached-passwords-faster-with-auth0-credential-guard/" target="_blank" rel="noreferrer noopener">Auth0 blog</a>.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h2 id="About-Okta">About Okta</h2><p>Okta is the leading independent identity provider. The Okta Identity Cloud enables organizations to securely connect the right people to the right technologies at the right time. With more than 7,000 pre-built integrations to applications and infrastructure providers, Okta provides simple and secure access to people and organizations everywhere, giving them the confidence to reach their full potential. More than 14,000 organizations, including JetBlue, Nordstrom, Siemens, Slack, Takeda, Teach for America, and Twilio, trust Okta to help protect the identities of their workforces and customers.</p><h3 id="Media-Contacts">Media Contacts</h3><p>Global Communications<br/>Auth0 <br/><a href="mailto:press@auth0.com" target="_blank" rel="noreferrer noopener">press@auth0.com</a><br/></p><h3 id="Investor-Contact">Investor Contact</h3><p>Investor Relations<br/><a href="mailto:investor@okta.com" target="_blank" rel="noreferrer noopener">investor@okta.com</a><br/></p></div></div>]]></content:encoded>
      <pubDate>Wed, 09 Feb 2022 12:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Detect Breached Passwords Faster with Auth0 Credential Guard</title>
      <link>https://auth0.com/blog/detect-breached-passwords-faster-with-auth0-credential-guard/</link>
      <description>Secure apps and protect users with enterprise scale account takeover protection</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>It‚Äôs 2022, yet passwords still remain the <a href="https://www.idrnd.ai/5-authentication-methods-that-can-prevent-the-next-breach/" target="_blank" rel="noreferrer noopener">most common form of authentication</a> online. Like it or not, they are not going away anytime soon. Even if they‚Äôre becoming riskier than ever. The very fact that there are so many more applications that users have to register for and log in to makes password reuse across multiple sites even more likely for all but the most security-conscious users. No wonder that the threat of account takeovers (ATOs) <a href="https://www.techrepublic.com/article/account-takeover-attacks-spiked-in-2020-kaspersky-says/" target="_blank" rel="noreferrer noopener">nearly doubled in 2020</a>.</p><p>Breaches impact everybody. The average email address is now associated with <a href="https://www.linkedin.com/pulse/b2b-identity-software-deep-dive-clement-vouillon/?trackingId=C11skBW3qNhNTv25nHkiEQ%3D%3D" target="_blank" rel="noreferrer noopener">130 online accounts</a>. Chances are that a significant portion of your users are using the same or similar usernames and passwords as they use on other sites. So when a password gets leaked in a data breach, that same password, or a slight variation thereof, has a high chance of being successful at multiple other online accounts that the user owns. Even if your own site hasn‚Äôt been breached, there‚Äôs still a good chance that your users&#39; information may be compromised due to a leak that occurred elsewhere. </p><p>With <a href="https://www.auth0.com/breached-passwords#credential-guard" target="_blank" rel="noreferrer noopener">Auth0 Credential Guard</a>, you can protect your applications from bad actors logging in with stolen credentials. You can alert the user about their compromised password, challenge the user using an additional factor, or block access by forcing a password reset. Typical breached password detection relies on breach data released to the public. From the time when a breach happens to when it‚Äôs announced, there is a gap (typically months) during which your users and business remain at risk. Credential Guard eliminates this gap: a team of dedicated security experts infiltrates criminal communities and gains access to exposed data as soon as breaches occur. With this advantage, you can better protect your users and secure your applications by resetting stolen passwords sooner.</p><h2 id="Improve-Detection-Response">Improve Detection Response</h2><p>A typical account takeover attempt is performed using bots that hit login screens that use credentials obtained in data dumps that follow breaches. These indiscriminate attacks account for <a href="https://spycloud.com/resource/targeted-vs-automated-ato/" target="_blank" rel="noreferrer noopener">90% of ATO attempts</a>, yet only inflict 20% of the losses that business incur due to breaches. Targeted attacks, on the other hand, are disproportionately costly, even though they are far fewer in number. These attacks use sophisticated and clandestine methods of obtaining passwords, using these compromised credentials to inflict damage long before there is any traceable record of the breach. Traditional breach detection services that use scanners and scrapers to identify leaked credentials are therefore of no use when it comes to these types of attacks.</p><p>Credential Guard counters this threat with a team of security experts that infiltrate the dark web to mine out the exposed information before criminals can monetize it. This unique capability allows us to identify ATO risks months, even years before breach data is made public. Given importance of timeliness in identifying targeted attacks, companies can secure their applications during login by detecting and resetting stolen passwords as soon as breaches happen</p><h2 id="Expand-Reach-Globally">Expand Reach Globally</h2><p>Breached passwords are not only a threat to the companies‚Äô applications but also their users. As mentioned above, users reuse passwords across multiple sites, so it‚Äôs not just an account that‚Äôs at risk but their entire online identity. </p><p>Credential Guard automates the detection and remediation of breached passwords across more than 35 languages and 200+ countries and territories for global account protection.</p><h2 id="Improve-Security-Posture">Improve Security Posture</h2><p>We all have heard ad nauseum about the trade-off between user experience (UX) and security. Human psychology tells us that we make choices based on perceived threat. When a threat goes from being abstract to real, we‚Äôre much more likely to take it seriously and adjust our behavior to account for it. The same user that scoffs at stronger authentication methods when there is no perceived risk might enthusiastically sign up for the same measure if the choice is presented at a time when the alternative was to lose control of their account. Companies can alert a user that their password has been leaked in a data breach, and then offer to improve their security posture enrolling in MFA, without risking conversion, impacting UX or retention.</p><h2 id="Secure-Your-Login-Box--Protect-Your-Users">Secure Your Login Box, Protect Your Users</h2><p>As security enthusiasts, we know that passwords worry both users and app owners alike. Yet they persist, and will likely do so for the foreseeable future. Using Auth0 Credential Guard, companies can stay ahead of criminals trying to exploit breached passwords. It protects companies as well as users‚Äô online identities, which are increasingly bound up with a single, widely used password. While password protection is no silver bullet, making password protection part of a strategy to improve authentication choices, companies can reduce chances of being breached by <a href="https://www.verizon.com/business/resources/reports/dbir/" target="_blank" rel="noreferrer noopener">up to 89%.</a> </p><p>Learn more about implementing Credential Guard <a href="https://auth0.com/docs/secure/attack-protection/breached-password-detection" target="_blank" rel="noreferrer noopener">here</a>.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Wed, 09 Feb 2022 11:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Bridging Legacy Systems and Digital Transformation with CIAM</title>
      <link>https://auth0.com/blog/bridging-legacy-systems-and-digital-transformation-with-ciam/</link>
      <description>The pandemic accelerated digitization initiatives, a robust CIAM solution can assist in an iterative migration to the cloud</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the DACH region, trust is everything, and one of the first places you can build consumer trust is your login experience. German consumers say their main frustrations with signing up to a new app or online service are having to fill in long login or sign-up forms (42%) and entering private information (38%), followed by having to create a password that has to meet certain requirements (33%), and a new ID and password for every app or online service (31%). These statistics come from a <a href="https://info.auth0.com/erwartungen-und-realitat.html" target="_blank" rel="noreferrer noopener">global research study</a> conducted by Auth0 and YouGov, including more than 2,000 consumers and 200 IT/marketing decision-makers in Germany.</p><p>One of the challenges organizations encounter when looking to launch new services or feature sets is the fact that many of these features are cloud-based while existing services that could benefit from integration are often legacy and hosted on-premises. Finding an <a href="https://auth0.com/blog/what-is-idaas/" target="_blank" rel="noreferrer noopener">Identity as a Service (IDaaS)</a> provider who can link those legacy systems and modern cloud-first platforms is an important step towards creating a future-proof service. However, many organizations in the DACH region are still building their own identity solutions. Or they‚Äôre misusing tools designed for managing employee identities for customer-facing needs. Both of these scenarios can introduce additional pain points when it comes to joining legacy and modern systems.</p><h2 id="Digitization-Projects-Are-Resource-Intensive">Digitization Projects Are Resource Intensive</h2><p>IT departments have spent the better part of the last 18 months establishing work-from-home protocols, migrating critical systems to the cloud for better access, and ensuring that everyone‚Äôs data stays safe and secure throughout the transition. Despite the acceleration in these digitization projects brought on by the COVID-19 pandemic, many of these systems have to remain housed on legacy on-prem servers due to a lack of alternatives. Bridging the gap between these and the convenient cloud-based tools your customers need access to is a large undertaking, especially for IT teams that are already stretched thin supporting ongoing internal needs.</p><p>Your IT and development teams support the organization‚Äôs goals by creating and maintaining the best web applications for your customers and by keeping your infrastructure running smoothly. That way, everyone, both inside and outside of the company, has the best experience possible. Partnering with an IDaaS provider like Auth0 will free those teams to continue focusing on their primary goals by taking the task of user authentication off their hands ‚Äî and putting it in the hands of identity experts. This ensures your users get the CX they‚Äôve come to expect while you maintain control over your data and privacy.</p><h2 id="Legacy-Workforce-Identity-Solutions-Are-Not-Built-To-Face-External-Threats">Legacy Workforce Identity Solutions Are Not Built To Face External Threats</h2><p>The workforce <a href="https://auth0.com/blog/what-is-iam/" target="_blank" rel="noreferrer noopener">Identity and Access Management (IAM)</a> tool you‚Äôre using today may look like an attractive option for your customer-facing needs. There are several problems with this idea, starting with the simple fact that IAM solutions are not focused on user experience (UX). Their priority is security, keeping your company‚Äôs intellectual property safe and secure from bad actors. </p><p>The threats facing customer applications can be vastly different in type and scale. Workforce IAM verifies employee identity in order to approve access to just the tools they need to do their job effectively, from primarily company-owned devices. <a href="https://auth0.com/blog/what-is-ciam/#:~:text=Auth0%20Docs&amp;text=Customer%20Identity%20and%20Access%20Management,%2C%20customer%20experience%2C%20and%20analytics." target="_blank" rel="noreferrer noopener">Customer Identity and Access Management (CIAM)</a> solutions, on the other hand, need to integrate protection against brute force attacks, password spraying attacks, along with other outside attack vectors. And they need to do that while maintaining identity verification across potentially millions of end-user devices and networks. Additional hurdles exist as well; for example, many IAM tools are on-prem only and unable to protect your new cloud-first infrastructure. </p><h2 id="Growing-Demand-From-Consumers-for-a-Low-Friction-Customer-Experience">Growing Demand From Consumers for a Low-Friction Customer Experience</h2><p>The acceleration and growth of online tools have increased consumer expectations for a safe and simple identity experience. They‚Äôre no longer willing to wait for slow pages to load or to endure lengthy and complex account creation flows. Your customers demand-responsive, intuitive design, or they‚Äôll take their business elsewhere. In fact, 78% of German consumers say they have <a href="https://info.auth0.com/erwartungen-und-realitat.html" target="_blank" rel="noreferrer noopener">abandoned an app or online service</a> due to an arduous login experience.</p><p>Addressing the systemic issues that need attention to keep up with this demand will put additional stress on your internal teams, pulling their attention away from those core goals we discussed above. You don‚Äôt need to sacrifice your user experience in order to create a user-friendly and trusted authentication experience. Auth0 provides a secure platform with a variety of cloud deployment options, including <a href="https://auth0.com/blog/auth0-on-microsoft-azure-as-a-private-cloud-deployment-option/" target="_blank" rel="noreferrer noopener">private cloud deployments on Microsoft Azure</a> or AWS infrastructure, and public cloud options using AWS facilities in multiple regions, including Frankfurt. Built by and for development teams, Auth0 is easily customizable to create exactly the low-friction experience your customers demand without sacrificing security and extensibility.</p><h2 id="Auth0-Lets-You-Find-the-Right-Mix-of-Security--Privacy--and-CX">Auth0 Lets You Find the Right Mix of Security, Privacy, and CX</h2><p>We‚Äôve discussed three pain points organizations in the DACH region are likely to encounter when looking to deploy a new identity and authentication solution across both legacy and cloud-based systems. The Auth0 Identity Platform has a robust feature set designed to address these challenges and any others you may encounter as you embark on your own identity project.</p><h3 id="Extensibility-allows-you-to-quickly-adapt-your-digitization-project">Extensibility allows you to quickly adapt your digitization project</h3><p>Auth0‚Äôs founders wrote the book on identity management at Microsoft while helping development teams remove barriers to building applications in the cloud. The Auth0 Identity Platform is designed with developers in mind, with multiple <a href="https://auth0.com/extensibility" target="_blank" rel="noreferrer noopener">extensibility</a> points that allow you to configure the exact authentication flows you want.</p><h3 id="Exhaustive-integrations-mean-you-can-bridge-the-legacy-cloud-gap-easily-and-iteratively">Exhaustive integrations mean you can bridge the legacy/cloud gap easily and iteratively</h3><p>No matter what systems you have housed on-prem or on legacy infrastructure and what you have already migrated to the cloud, our <a href="https://auth0.com/docs/api" target="_blank" rel="noreferrer noopener">Application Programming Interfaces (APIs)</a> and <a href="https://auth0.com/docs/libraries" target="_blank" rel="noreferrer noopener">Software Development Kit (SDK) libraries</a> mean, you can use one CIAM solution to bridge the gap. That allows you the flexibility to continue your deployment iteratively, knowing that your customer experience won‚Äôt suffer any negative impacts as you migrate more services to the cloud on your own schedule.</p><p>We‚Äôre able to integrate with most existing cloud-based SaaS services via our APIs and SDKs but can also integrate with your on-premise environments as long as they‚Äôre accessible via API or otherwise. We are also up to date with the <a href="https://auth0.com/docs/compliance/gdpr" target="_blank" rel="noreferrer noopener">General Data Protection Regulation (GDPR)</a> enacted by the European Union in 2018, so we can help and support our customers in meeting their compliance requirements.</p><p>Additionally, <a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a> and <a href="https://auth0.com/actions" target="_blank" rel="noreferrer noopener">Actions</a> provide access to a wide array of out-of-the-box integrations with most line-of-business software and services. That means you can quickly connect your CMS and ERP to your new web app, and your users won‚Äôt see any change in their experience as it‚Äôs serverless, so there won‚Äôt be any interruption to your services.</p><h3 id="No---low---and-pro-code-options-for-creating-a-low-friction-user-experience">No-, low-, and pro-code options for creating a low-friction user experience</h3><p>Between the pre-configured integrations in <a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a> and our low-code <a href="https://auth0.com/actions" target="_blank" rel="noreferrer noopener">Actions</a> capability, your development team can easily customize Auth0 to meet your customers‚Äô expectations for a secure and low-friction authentication experience. For even more control, we still offer pro-code customization, as always, via our JavaScript editor.</p><p>The ability to have all your identity needs up and running quickly means your team can focus on serving their primary functions. Your developers can continue delivering top-quality experiences for your customers, and IT support can maintain your internal employees‚Äô work environment, no matter where they‚Äôre working from.</p><h2 id="Partnering-With-Auth0-Ensures-a-Secure--Customizable-CIAM-Experience">Partnering With Auth0 Ensures a Secure, Customizable CIAM Experience</h2><p>You can rely on the identity professionals at Auth0 to help:</p><ul><li>focus your development team on innovation</li><li>deliver the identity experience consumers have come to expect</li><li>protect customer data with a deployment option that works for your business</li></ul><p>That‚Äôs how you deliver an excellent user experience without compromising security or privacy along the way. Read more about our <a href="https://auth0.com/docs/compliance" target="_blank" rel="noreferrer noopener">compliance and certifications</a>, then <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">reach out to an identity expert</a> to continue the conversation about how partnering with Auth0 can help your organization.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 08 Feb 2022 15:09:00 +0000</pubDate>
    </item>
    <item>
      <title>A Look Back to Our Platform Resiliency and What‚Äôs Next</title>
      <link>https://auth0.com/blog/platform-resiliency-whats-next/</link>
      <description>Our commitment to delivering a Tier 0 service for our customers</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div id="__next"><p><img src="https://cdn.auth0.com/website/blog-new/close-button-desktop.svg"/><span>Discover and enable the integrations you need to solve identity</span><a href="https://marketplace.auth0.com?utm_source=blog&amp;utm_medium=top-banner" target="_blank" rel="noopener noreferrer">Auth0 Marketplace</a></p><div><ul><li><a href="https://auth0.com/blog/developers/">Developers</a></li><li><a href="https://auth0.com/blog/identity-and-security/">Identity &amp; Security</a></li><li><a href="https://auth0.com/blog/business/">Business</a></li><li><a href="https://auth0.com/blog/leadership/">Leadership</a></li><li><a href="https://auth0.com/blog/culture/">Culture</a></li><li><a href="https://auth0.com/blog/engineering/">Engineering</a></li><li><a href="https://auth0.com/blog/announcements/">Announcements</a></li><li><a href="https://auth0.com/signup?&amp;signUpData=%7B%22category%22%3A%22button%22%7D">Try Auth0 For Free</a></li></ul></div><section itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="mainEntity"><header><div><div><p><span id="post-category">Platform</span></p><p itemprop="description">Our commitment to delivering a Tier 0 service for our customers</p></div><p>Last Updated On: February 07, 2022</p><meta itemprop="datePublished" content="2022-02-07"/><meta itemprop="dateModified" content="2022-02-07"/></div></header><header><div><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6yR7mLYRgJotnAKSDEt2J8/4984fa1f78c40db99683405db7becf27/auth0_okta_hero.png"/></p><div><p><span>Platform</span></p><p itemprop="description">Our commitment to delivering a Tier 0 service for our customers</p><p>Last Updated On: February 07, 2022</p><meta itemprop="datePublished" content="2022-02-07"/><meta itemprop="dateModified" content="2022-02-07"/></div></div></header><article><main id="post-content" itemprop="articleBody"><div><p>Resiliency, reliability, and adaptability are foundational tenets to how we build at Auth0. Last year, we recognized the need to deliberately double down on our resilience efforts in order to address some of the failures we had seen. In November 2021, I wrote about our <a href="https://auth0.com/blog/improving-our-platform-resiliency-and-upcoming-holiday-plans/" target="_blank" rel="noreferrer noopener">plans to improve the resilience of our platform</a> and the additional steps we were taking to address the peak holiday traffic. I‚Äôm proud of the hard work and diligence by our teams during the holiday season that moved us considerably towards our goal of providing a Tier 0 service. Today, I want to provide updates to that work, share the progress to date, as well as provide insight into our upcoming efforts.</p><h2 id="Update-on-Our-Resiliency-Focus-Areas-to-Date">Update on Our Resiliency Focus Areas to Date</h2><p>As a reminder, a big focus area for our team was to reduce the load on our datastores. We made significant progress in this area:  </p><ul><li>Reduced the database read/write workload by 50%. Our initial target was a 10% reduction, so we greatly surpassed our initial estimates</li><li>Reduced 45% of inserts/deletes from our database in US-1, 50% in EU, and 20% in the rest of our environments. The team&#39;s initial target was 40% in US-1 so we also beat this estimate</li></ul><p>We also actioned all the initially identified resiliency priorities. These were all implemented either prior to the Thanksgiving holiday in the US or in early December:  </p><ul><li>Added noisy neighbor protection for our extensibility stack (Webtask)</li><li>Expanded our caching approach for common Authentication API requests</li><li>Enforced new Auth API global rate limits for all production tenants</li><li>Enforced 100 RPS for non-production enterprise tenants</li><li>Refactored our connections schema and deleted unused entries/rows; in US-1, we reduced the table size by ~25X.</li><li>Overprovisioning of our stack was done in anticipation of holiday traffic, we‚Äôve since downsized based on usage data and some of the other protections put into place</li></ul><p>While we made great progress on our improvement initiatives, I want to acknowledge that in December we experienced a few issues related to our network edge, which caused unfortunate customer impact. We have met with our network edge provider to ensure our expectations around incident response and service levels are understood and upheld. We‚Äôve also initiated a new internal effort to review our Edge resiliency plan and kicked off the discovery work. We‚Äôll provide further updates as we make meaningful progress on this effort.</p><h2 id="What-s-Next-in-2022">What‚Äôs Next in 2022</h2><p>Resiliency has been and remains a top priority for Auth0 in 2022. The work that I outlined above has laid strong foundations that will serve as a springboard for our ongoing priorities. Below are a few key highlights of what to expect this year.</p><h3 id="New-Environments">New Environments</h3><p>This is one of our top priorities for the first half of 2022. Construction efforts have kicked off for three new production environments that will enable us to shift load as required for our demand response strategies and limit the blast radius of disruptions and outages. These environments will be launched in 1H 2023 and will feature two new options in the US and one in the EU.</p><h3 id="Automated-Tenant-Migration-Process">Automated Tenant Migration Process</h3><p>In addition to new environments, our team has been working on our capabilities to move tenants from one environment to another in order to further reduce the blast radius. The early design work began in Q3 2021, with a focus on high-touch migration of select targeted customers based on feature usage, workload, and configuration. As we iterate and learn from that effort, we will shape up our tenant migration process from ‚Äúhigh-touch‚Äù/manual intensive to a more automated process.</p><h3 id="New-Platform-Rollout">New Platform Rollout</h3><p>We are laser-focused on our platform modernization efforts which have an underlying architecture that is responsive and resilient to meet all current and anticipated customer needs. The new platform is already powering our product that <a href="https://auth0.com/blog/auth0-on-microsoft-azure-as-a-private-cloud-deployment-option/" target="_blank" rel="noreferrer noopener">launched on MS Azure</a> in November 2021. I will share details about the availability of this new platform on AWS as we get closer to launch in Q1 2022.</p><p>Thank you for the continued trust that you place in Auth0 to meet your identity needs. We have exciting things in the works that will enable us to continue our delivery of a Tier 0 service with all of the product innovation you have come to rely on for your applications.</p></div></main></article></section></div></div>]]></content:encoded>
      <pubDate>Mon, 07 Feb 2022 16:02:00 +0000</pubDate>
    </item>
    <item>
      <title>Developing RESTful APIs with Lumen (A PHP Micro-framework)</title>
      <link>https://auth0.com/blog/developing-restful-apis-with-lumen-a-php-micro-framework/</link>
      <description>Learn how to build a secured Lumen API server using Auth0</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> In this tutorial, you will learn how to easily build a secured API with <a href="https://lumen.laravel.com/" target="_blank" rel="noreferrer noopener">Lumen</a>. The complete source code for this tutorial can be found here on <a href="https://github.com/yemiwebby/lumen-api-auth0" target="_blank" rel="noreferrer noopener">GitHub</a>.</p><p>Built on Laravel&#39;s <a href="https://github.com/illuminate" target="_blank" rel="noreferrer noopener">core components</a>, Lumen is able to provide speed without sacrificing any of the goodies we love about Laravel - clean and concise syntax; flexibility, and out-of-the-box support for just about anything you can think of. The scalability of an application is also not affected as Lumen is built to upgrade directly to Laravel painlessly should the application needs to outgrow Lumen&#39;s offerings.</p><h2 id="Features-Overview">Features Overview</h2><p>These are some of the built-in features of Lumen:</p><ul><li><strong>Routing</strong> is provided out of the box in Lumen. This includes basic routing, routing parameters, named routes, and route groups such as middleware.</li><li><strong>Authentication</strong> does not support the session state. However, incoming requests are authenticated via stateless mechanisms such as tokens.</li><li><strong>Caching</strong> is implemented the same as in Laravel. Cache drivers such as <em>Database</em>, <em>Memcached</em>, and <em>Redis</em> are supported. For example, you can install the <code>illuminate<span>/</span>redis</code> package via Composer to use a Redis cache with Lumen.</li><li><strong>Errors and Logging</strong> are implemented via the <a href="https://github.com/Seldaek/monolog" target="_blank" rel="noreferrer noopener">Monolog library</a>, which provides support for various log handlers.</li><li><strong>Queuing</strong> services are similar to the ones offered by Laravel. A unified API is provided across a variety of different queue back-ends.</li><li><strong>Events</strong> provide a simple observer implementation that allows you to subscribe and listen for events in your application.</li><li><strong>Bootstrapping</strong> processes are located in a <a href="https://github.com/laravel/lumen/blob/master/bootstrap/app.php" target="_blank" rel="noreferrer noopener">single file</a>.</li></ul><h2 id="Lumen-Key-Requirements">Lumen Key Requirements</h2><p>To use Lumen, you need to have the following tools installed on your machine:</p><ul><li><strong>PHP</strong>: Make sure <a href="http://php.net/manual/en/install.php" target="_blank" rel="noreferrer noopener">PHP &gt;= 7.3</a> is installed on your machine. Furthermore, ensure that the following PHP extensions are installed. <a href="https://www.php.net/manual/en/openssl.installation.php" target="_blank" rel="noreferrer noopener">OpenSSL</a>, <a href="https://www.php.net/manual/en/pdo.installation.php" target="_blank" rel="noreferrer noopener">PDO</a>, and <a href="https://www.php.net/manual/en/mbstring.installation.php" target="_blank" rel="noreferrer noopener">Mbstring</a>.</li><li><strong>Composer</strong>: Navigate to the <a href="https://getcomposer.org/" target="_blank" rel="noreferrer noopener">Composer website</a> and install it on your machine. A composer is needed to install Lumen&#39;s dependencies.</li><li><strong>Postman</strong>: You also need to ensure that <a href="https://www.getpostman.com/" target="_blank" rel="noreferrer noopener">Postman</a>, or a similar application, to test endpoints is installed.</li></ul><blockquote><p>Note: You&#39;ll need MySQL for this tutorial. Navigate to the <a href="https://www.mysql.com/" target="_blank" rel="noreferrer noopener">MySQL</a> website and install the community server edition. If you are using a Mac, I recommend following <a href="https://flaviocopes.com/mysql-how-to-install/" target="_blank" rel="noreferrer noopener">these instructions</a>. For this tutorial, you can use MySQL straight from the terminal, but if you&#39;d prefer a MySQL GUI, check out <a href="https://sequelpro.com/" target="_blank" rel="noreferrer noopener">Sequel Pro</a> for Mac or <a href="https://www.heidisql.com/" target="_blank" rel="noreferrer noopener">HeidiSQL</a> for Windows.</p></blockquote><p>At Auth0, we have many technical writers, otherwise known as authors. A directive has been given to developing an app to manage Auth0 authors. The front-end app will be built with ReactJS. However, it needs to pull data from a source and also push to it. Yes, we need an API!</p><p>An author will have the following attributes:</p><ul><li>Name</li><li>Email address</li><li>Link to Twitter profile</li><li>Link to GitHub profile</li><li>Location</li><li>Title of the latest article published by the author</li></ul><p>Additionally, we will have timestamps for each author corresponding to when the author was added or edited.<br/>The API will provide endpoints for basic CRUD (Create, Read, Update and Delete) operations related to authors. These endpoints are as follows:</p><ul><li>Get all authors ‚Äî <code><span>GET</span> <span>/</span>api<span>/</span>authors</code></li><li>Get one author ‚Äî <code><span>GET</span> <span>/</span>api<span>/</span>authors<span>/</span><span>23</span></code></li><li>Create an author ‚Äî <code><span>POST</span> <span>/</span>api<span>/</span>authors</code></li><li>Edit an author ‚Äî <code><span>PUT</span> <span>/</span>api<span>/</span>authors<span>/</span><span>23</span></code></li><li>Delete an author ‚Äî <code><span>DELETE</span> <span>/</span>api<span>/</span>authors<span>/</span><span>23</span></code></li></ul><h3 id="Getting-Started">Getting Started</h3><p>Run the following command in your terminal to create a new project with <a href="https://lumen.laravel.com/" target="_blank" rel="noreferrer noopener">Lumen</a>:</p><pre><code><span>composer</span> create-project --prefer-dist laravel/lumen authors</code></pre><p>Navigate into the newly created project using the <code>cd</code> command.</p><pre><code><span>cd</span> authors</code></pre><p>You can run the application using the following command.</p><pre><code>php -S localhost:8000 -t public</code></pre><p>This will make the application available at <a href="http://localhost:8000" target="_blank" rel="noreferrer noopener">http://localhost:8000</a>, which will return the index page shown below.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1BY3YynNm9xA4D0A2hVf1u/6b1dcbb402f73996b29711489993ea34/01_rest.png" alt="Lumen Homepage"/></p><h3 id="Activate-Eloquent-and-Facades">Activate Eloquent and Facades</h3><p>As I mentioned earlier, the entire bootstrap process is located in a <a href="https://github.com/laravel/lumen/blob/master/bootstrap/app.php" target="_blank" rel="noreferrer noopener">single file</a>.
Open up the <code>bootstrap<span>/</span>app<span>.</span>php</code> and uncomment the following lines.</p><pre><code><span>// $app-&gt;withFacades();</span>

<span>// $app-&gt;withEloquent();</span></code></pre><p>Once uncommented, the <code>withEloquent</code> function instructs Lumen to hook the <a href="https://github.com/illuminate/database/tree/master/Eloquent" target="_blank" rel="noreferrer noopener">Eloquent ORM</a> with your database using the connections configured in the <code><span>.</span>env</code> file.</p><blockquote><p>Make sure you set the right details for your database in the .env file.</p></blockquote><p>In the same vein, calling the <code>withFacades</code> function call enables the use of <a href="https://laravel.com/docs/5.5/facades" target="_blank" rel="noreferrer noopener">Facades</a> in our project.</p><h3 id="Setup-Database--Models--and-Migrations">Setup Database, Models, and Migrations</h3><p>At the time of this writing, Lumen supports four database systems: MySQL, Postgres, SQLite, and SQL Server. We are making use of MySQL in this tutorial. First, we&#39;ll create a migration for the <code>authors</code> table.</p><blockquote><p>Migrations are like version control for your database, allowing your team to modify and share the application&#39;s database schema easily.</p></blockquote><p>Stop the application from running using <code><span>CTRL</span> <span>+</span> <span>C</span></code> from the terminal and hit return on your keyboard. Now, run the command below in the terminal to create the <code>authors</code> table migration:</p><pre><code>php artisan make:migration create_authors_table</code></pre><p>The new migration will be placed in your <code>database<span>/</span>migrations</code> directory. The migration file name is prepended with a timestamp in the format <code><span>YYYY_MM_DD_HHMMSS</span></code>. This allows Lumen to determine the order of the migrations.</p><p>Open the migration file <code>database<span>/</span>migrations<span>/</span>YYYY_MM_DD_HHMMSS_create_authors_table<span>.</span>php</code> update it to match the following.</p><pre><code><span><span>&lt;?php</span>

<span>use</span> <span>Illuminate<span>\</span>Database<span>\</span>Migrations<span>\</span>Migration</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Database<span>\</span>Schema<span>\</span>Blueprint</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Support<span>\</span>Facades<span>\</span>Schema</span><span>;</span>

<span>class</span> <span>CreateAuthorsTable</span> <span>extends</span> <span>Migration</span> <span>{</span>

    <span>/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span>public</span> <span>function</span> <span>up</span><span>(</span><span>)</span> <span>{</span>

        <span>Schema</span><span>::</span><span>create</span><span>(</span><span>&#39;authors&#39;</span><span>,</span> <span>function</span> <span>(</span><span>Blueprint</span> <span>$table</span><span>)</span> <span>{</span>

            <span>$table</span><span>-&gt;</span><span>increments</span><span>(</span><span>&#39;id&#39;</span><span>)</span><span>;</span>
            <span>$table</span><span>-&gt;</span><span>string</span><span>(</span><span>&#39;name&#39;</span><span>)</span><span>;</span>
            <span>$table</span><span>-&gt;</span><span>string</span><span>(</span><span>&#39;email&#39;</span><span>)</span><span>;</span>
            <span>$table</span><span>-&gt;</span><span>string</span><span>(</span><span>&#39;github&#39;</span><span>)</span><span>;</span>
            <span>$table</span><span>-&gt;</span><span>string</span><span>(</span><span>&#39;twitter&#39;</span><span>)</span><span>;</span>
            <span>$table</span><span>-&gt;</span><span>string</span><span>(</span><span>&#39;location&#39;</span><span>)</span><span>;</span>
            <span>$table</span><span>-&gt;</span><span>string</span><span>(</span><span>&#39;latest_article_published&#39;</span><span>)</span><span>;</span>
            <span>$table</span><span>-&gt;</span><span>timestamps</span><span>(</span><span>)</span><span>;</span>
        <span>}</span><span>)</span><span>;</span>
    <span>}</span>

    <span>/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span>public</span> <span>function</span> <span>down</span><span>(</span><span>)</span> <span>{</span>

        <span>Schema</span><span>::</span><span>dropIfExists</span><span>(</span><span>&#39;authors&#39;</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>In the <code>up</code> function, we specify the columns to be added to the <code>authors</code> table. A column is declared for each author attribute we highlighted earlier.</p><p>Now, go ahead and run the migration like so:</p><pre><code>php artisan migrate</code></pre><p>Check your database. You should now have the <code>authors</code> and <code>migrations</code> tables present.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2D7EmXiABIlf8BtYlGNjvz/8e65b8d3e40f44bc9300bfe9c8dff14f/01_rest_2.png" alt="Database View"/></p><p>Next, let&#39;s create the <code>Author</code> model. Create an <code>app<span>/</span>Models<span>/</span>Author<span>.</span>php</code> file and add the code below to it:</p><pre><code><span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>Models</span><span>;</span>

<span>use</span> <span>Illuminate<span>\</span>Database<span>\</span>Eloquent<span>\</span>Model</span><span>;</span>

<span>class</span> <span>Author</span> <span>extends</span> <span>Model</span> <span>{</span>

    <span>/**
     * The attributes that are mass assignable.
     *
     * @var array
     */</span>
    <span>protected</span> <span>$fillable</span> <span>=</span> <span>[</span>
        <span>&#39;name&#39;</span><span>,</span>
        <span>&#39;email&#39;</span><span>,</span>
        <span>&#39;github&#39;</span><span>,</span>
        <span>&#39;twitter&#39;</span><span>,</span>
        <span>&#39;location&#39;</span><span>,</span>
        <span>&#39;latest_article_published&#39;</span><span>,</span>
    <span>]</span><span>;</span>

    <span>/**
     * The attributes are excluded from the model&#39;s JSON form.
     *
     * @var array
     */</span>
    <span>protected</span> <span>$hidden</span> <span>=</span> <span>[</span><span>]</span><span>;</span>
<span>}</span></span></code></pre><p>In the code above, we made the author attributes <a href="https://laravel.com/docs/5.5/eloquent#mass-assignment" target="_blank" rel="noreferrer noopener">mass assignable</a>.</p><h3 id="Set-up-Routes">Set up Routes</h3><p>Routing is fairly straightforward. Open up <code>routes<span>/</span>web<span>.</span>php</code> and modify it like so:</p><pre><code><span><span>&lt;?php</span>

<span>/** @var Router $router */</span>

<span>/*
|--------------------------------------------------------------------------
| Application Routes
|--------------------------------------------------------------------------
|
| Here is where you can register all of the routes for an application.
| It is a breeze. Simply tell Lumen the URIs it should respond to
| and give it the Closure to call when that URI is requested.
|
*/</span>

<span>use</span> <span>Laravel<span>\</span>Lumen<span>\</span>Routing<span>\</span>Router</span><span>;</span>

<span>$router</span><span>-&gt;</span><span>get</span><span>(</span><span>&#39;/&#39;</span><span>,</span> <span>function</span> <span>(</span><span>)</span> <span>use</span> <span>(</span><span>$router</span><span>)</span> <span>{</span>

    <span>return</span> <span>$router</span><span>-&gt;</span><span>app</span><span>-&gt;</span><span>version</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

<span>$router</span><span>-&gt;</span><span>group</span><span>(</span><span>[</span><span>&#39;prefix&#39;</span> <span>=&gt;</span> <span>&#39;api&#39;</span><span>]</span><span>,</span> <span>function</span> <span>(</span><span>)</span> <span>use</span> <span>(</span><span>$router</span><span>)</span> <span>{</span>

    <span>$router</span><span>-&gt;</span><span>get</span><span>(</span><span>&#39;authors&#39;</span><span>,</span> <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@showAllAuthors&#39;</span><span>]</span><span>)</span><span>;</span>

    <span>$router</span><span>-&gt;</span><span>get</span><span>(</span><span>&#39;authors/{id}&#39;</span><span>,</span> <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@showOneAuthor&#39;</span><span>]</span><span>)</span><span>;</span>

    <span>$router</span><span>-&gt;</span><span>post</span><span>(</span><span>&#39;authors&#39;</span><span>,</span> <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@create&#39;</span><span>]</span><span>)</span><span>;</span>

    <span>$router</span><span>-&gt;</span><span>delete</span><span>(</span><span>&#39;authors/{id}&#39;</span><span>,</span> <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@delete&#39;</span><span>]</span><span>)</span><span>;</span>

    <span>$router</span><span>-&gt;</span><span>put</span><span>(</span><span>&#39;authors/{id}&#39;</span><span>,</span> <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@update&#39;</span><span>]</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></span></code></pre><p>In the code above, we have abstracted the functionality for each route into a controller, <code>AuthorController</code>. Route groups allow you to share route attributes, such as middleware or namespaces, across a large number of routes without needing to define those attributes on each route. Therefore, every route will have a prefix of <code><span>/</span>api</code>. Next, let&#39;s create the <code>AuthorController</code>.</p><h3 id="Set-up-Author-Controller">Set up Author Controller</h3><p>Create a new file, <code>AuthorController<span>.</span>php</code> in <code>app<span>/</span>Http<span>/</span>Controllers</code> directory and add the following code to it:</p><pre><code><span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>Http<span>\</span>Controllers</span><span>;</span>

<span>use</span> <span>App<span>\</span>Models<span>\</span>Author</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Http<span>\</span>JsonResponse</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Http<span>\</span>Request</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Http<span>\</span>Response</span><span>;</span>

<span>class</span> <span>AuthorController</span> <span>extends</span> <span>Controller</span> <span>{</span>

    <span>public</span> <span>function</span> <span>showAllAuthors</span><span>(</span><span>)</span>
    <span>:</span> <span>JsonResponse</span> <span>{</span>

        <span>return</span> <span>response</span><span>(</span><span>)</span><span>-&gt;</span><span>json</span><span>(</span><span>Author</span><span>::</span><span>all</span><span>(</span><span>)</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>showOneAuthor</span><span>(</span><span>$id</span><span>)</span>
    <span>:</span> <span>JsonResponse</span> <span>{</span>

        <span>return</span> <span>response</span><span>(</span><span>)</span><span>-&gt;</span><span>json</span><span>(</span><span>Author</span><span>::</span><span>find</span><span>(</span><span>$id</span><span>)</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>create</span><span>(</span><span>Request</span> <span>$request</span><span>)</span>
    <span>:</span> <span>JsonResponse</span> <span>{</span>

        <span>$author</span> <span>=</span> <span>Author</span><span>::</span><span>create</span><span>(</span><span>$request</span><span>-&gt;</span><span>all</span><span>(</span><span>)</span><span>)</span><span>;</span>

        <span>return</span> <span>response</span><span>(</span><span>)</span><span>-&gt;</span><span>json</span><span>(</span><span>$author</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_CREATED</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>update</span><span>(</span><span>$id</span><span>,</span> <span>Request</span> <span>$request</span><span>)</span>
    <span>:</span> <span>JsonResponse</span> <span>{</span>

        <span>$author</span> <span>=</span> <span>Author</span><span>::</span><span>findOrFail</span><span>(</span><span>$id</span><span>)</span><span>;</span>
        <span>$author</span><span>-&gt;</span><span>update</span><span>(</span><span>$request</span><span>-&gt;</span><span>all</span><span>(</span><span>)</span><span>)</span><span>;</span>

        <span>return</span> <span>response</span><span>(</span><span>)</span><span>-&gt;</span><span>json</span><span>(</span><span>$author</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_OK</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>delete</span><span>(</span><span>$id</span><span>)</span> <span>{</span>

        <span>Author</span><span>::</span><span>findOrFail</span><span>(</span><span>$id</span><span>)</span><span>-&gt;</span><span>delete</span><span>(</span><span>)</span><span>;</span>

        <span>return</span> <span>response</span><span>(</span><span>&#39;Deleted Successfully&#39;</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_OK</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>Let&#39;s analyze the code above. First, we have <code>use App\Author</code>, which allowed us to require the <code>Author</code> model that we created earlier.</p><p>Next, we&#39;ve created the following five methods:</p><ul><li><code>showAllAuthors</code> ‚Äî /GET</li><li><code>showOneAuthor</code> ‚Äî /GET</li><li><code>create</code> ‚Äî /POST</li><li><code>update</code> ‚Äî /PUT</li><li><code><span>delete</span></code> ‚Äî /DELETE</li></ul><p>These will allow us to use that <code>Author</code> model to interact with author data. For example, if you make a POST request to <code><span>/</span>api<span>/</span>authors</code> API endpoint, the <code>create</code> function will be invoked, and a new entry will be added to the <code>authors</code> table.</p><p><strong>Author controller method overview:</strong></p><ul><li><code><span>showAllAuthors</span><span>(</span><span>)</span></code>: checks for all the author resources</li><li><code><span>create</span><span>(</span><span>)</span></code>:creates a new author resource</li><li><code><span>showOneAuthor</span><span>(</span><span>)</span></code>: checks for a single author resource</li><li><code><span>update</span><span>(</span><span>)</span></code>: checks if an author resource exists and allows the resource to be updated</li><li><code><span>delete</span><span>(</span><span>)</span></code>: checks if an author resource exists and deletes it</li></ul><p><strong>Controller responses:</strong></p><ul><li><code><span>response</span><span>(</span><span>)</span></code>: global helper function that obtains an instance of the response factory</li><li><code><span>response</span><span>(</span><span>)</span><span>-</span><span>&gt;</span><span>json</span><span>(</span><span>)</span></code>: returns the response in JSON format.</li><li><code>Response<span>:</span><span>:</span><span>HTTP_OK</span></code>: This is a constant that represent the <code><span>200</span></code> HTTP status code. This indicates that the request was successful.</li><li><code>Response<span>:</span><span>:</span><span>HTTP_CREATED</span></code>: This is a constant that represent the <code><span>201</span></code> HTTP status code. This indicates that a new resource (in this case, author) was created.</li><li><code>findOrFail</code>: throws a <code>ModelNotFoundException</code> if no result is not found.</li></ul><p>At this point, we can test the API routes with <a href="https://www.getpostman.com/" target="_blank" rel="noreferrer noopener">Postman</a>. To do that, restart the application with:</p><pre><code>php -S localhost:8000 -t public</code></pre><p><em>Author POST operation</em> - <code><span>POST</span> http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8000</span><span>/</span>api<span>/</span>authors</code></p><p>Use the JSON requests below:</p><pre><code><span>{</span>
  <span>&#34;name&#34;</span><span>:</span> <span>&#34;John Doe&#34;</span><span>,</span>
  <span>&#34;email&#34;</span><span>:</span> <span>&#34;john@john.ng&#34;</span><span>,</span>
  <span>&#34;twitter&#34;</span><span>:</span> <span>&#34;yemiwebby&#34;</span><span>,</span>
  <span>&#34;github&#34;</span><span>:</span> <span>&#34;yemiwebby&#34;</span><span>,</span>
  <span>&#34;location&#34;</span><span>:</span> <span>&#34;Nigeria&#34;</span><span>,</span>
  <span>&#34;latest_article_published&#34;</span><span>:</span> <span>&#34;Auth0_laravel&#34;</span>
<span>}</span></code></pre><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2V3xL7COPSUqX2IJtlOwgU/f8d9bf8ac32127414d8784d1e320be28/02_rest.png" alt="Create a new Author"/></p><p><em>Author GET operation</em> - <code><span>GET</span> http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8000</span><span>/</span>api<span>/</span>authors</code></p><p>You should now see an array of objects, including the author you just created, plus any others in the database.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/oST0zLLs9JZLBi8SMs5Mg/42fa8aed8e18128993168e05cf0c5487/03_rest.png" alt="Get Author"/></p><p><em>Author PUT operation</em></p><p>The <code><span>PUT</span></code> operation allows us to edit an existing author. Notice the author&#39;s <code>id</code> in the URL.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4uMFyFfIQKhCnRmSpckgvI/c691e3e289ac81d248105480e28cb9e5/04_rest.png" alt="Edit Author Details"/></p><p><em>Author DELETE operation</em></p><p>Finally, we can delete a specific author as well.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4Puqxq9fFEceV85Z0T4cVP/eabd66896ef3ba1a167fca2cfe6b7f19/05_rest.png" alt="Delete a specific Author"/></p><p>Now we have a working API. Awesome!</p><h2 id="Lumen-API-Validation">Lumen API Validation</h2><p>In Lumen, it&#39;s very easy to validate your application&#39;s incoming data. Lumen provides access to the <code>$<span>this</span><span>-</span><span>&gt;</span>validate</code> helper method from within Route closures.</p><p>Currently, we&#39;re not checking what people are sending through to our <code>create</code> method in our API. Let&#39;s fix that now. Open up the <code>AuthorController</code> file and modify the <code>create</code> method as shown below.</p><pre><code><span>// ...</span>
<span>public</span> <span>function</span> <span>create</span><span>(</span><span>Request</span> <span>$request</span><span>)</span>
    <span>:</span> <span>JsonResponse</span> <span>{</span>

        <span>$this</span><span>-&gt;</span><span>validate</span><span>(</span><span>$request</span><span>,</span> <span>[</span>
            <span>&#39;name&#39;</span> <span>=&gt;</span> <span>&#39;required&#39;</span><span>,</span>
            <span>&#39;email&#39;</span> <span>=&gt;</span> <span>&#39;required|email|unique:authors&#39;</span><span>,</span>
            <span>&#39;location&#39;</span> <span>=&gt;</span> <span>&#39;required|alpha&#39;</span>
        <span>]</span><span>)</span><span>;</span>

        <span>$author</span> <span>=</span> <span>Author</span><span>::</span><span>create</span><span>(</span><span>$request</span><span>-&gt;</span><span>all</span><span>(</span><span>)</span><span>)</span><span>;</span>

        <span>return</span> <span>response</span><span>(</span><span>)</span><span>-&gt;</span><span>json</span><span>(</span><span>$author</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_CREATED</span><span>)</span><span>;</span>
    <span>}</span>
<span>// ...</span></code></pre><p>Now test the API POST route with Postman.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/25Xk9zQsla813goecyPDRk/ae5ba0db9736671b8939e54e2091a537/06_rest.png" alt="Validation"/></p><p>It validated the incoming requests and returned the appropriate error message.</p><ul><li><em>name</em>, <em>email</em>, and <em>location</em> were required. In testing the API, <em>name</em> and <em>email</em> were not provided.</li><li><em>email</em> was required to be in email format.</li><li><em>location</em> was required to be entirely alphabetic characters, <code>alpha</code>. Nothing more. Numbers were provided as the value for <em>location</em>.</li></ul><p>Lumen comes with <a href="https://laravel.com/docs/5.8/validation#available-validation-rules" target="_blank" rel="noreferrer noopener">a plethora of validation rules</a> that you can use to ensure that the incoming request meets the expected quality before it can be handled.</p><h2 id="Securing-the-Authors-API-with-Auth0">Securing the Authors API with Auth0</h2><p>Right now, an application can make requests to any of the endpoints present in our API. In a real-world scenario, we would want to restrict our API so that only  <a href="https://auth0.com/docs/flows/concepts/auth-code" target="_blank" rel="noreferrer noopener">authorized users</a> have the ability to do this. A few things need to happen here.</p><ol start="1"><li>A user signs in with their credentials (to prove who they are, i.e., <strong>authenticate</strong>)</li><li>If the user is authorized to use the API, the application is issued an API access token</li><li>Whenever an API request is made, the application will send that API access token along with the request</li><li>If the access token is valid, the API will respond with the requested data</li></ol><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6h5D5eYlM1lEzBpV0FlZ0/fbc3c0f5bc9643e45949f9e36763f1aa/07_rest.png" alt="auth0-flow.png"/></p><p>In this tutorial, we&#39;re going to focus on what happens in <strong>step 4</strong> of that list (step 9-10 in the diagram). Since we&#39;re only building the backend API here, you&#39;ll need to create a separate front-end to accomplish the first two steps. <a href="https://auth0.com/blog/reactjs-authentication-tutorial/" target="_blank" rel="noreferrer noopener">Here</a> is an awesome example of how you can do that using Auth0 with React. For now, let&#39;s focus on generating access tokens using <a href="https://jwt.io/" target="_blank" rel="noreferrer noopener">JSON Web Tokens</a>.</p><p>JSON Web Token, commonly known as JWT, is an open standard for creating JSON-based access tokens that make some claim, usually <a href="https://jwt.io/introduction/" target="_blank" rel="noreferrer noopener">authorizing a user or exchanging information</a>. This technology has gained popularity over the past few years because it enables backends to accept requests simply by validating the contents of these JWTs.</p><p>JWTs can be used for authorization or information exchange. In this tutorial, we&#39;ll use JWTs to grant applications (users) authorization using our API.</p><p>Whenever the user wants to access a protected route or resource (an endpoint), the user agent must send the JWT, usually in the <em>Authorization</em> header using the <a href="http://self-issued.info/docs/draft-ietf-oauth-v2-bearer.html" target="_blank" rel="noreferrer noopener">Bearer schema</a>, along with the request.</p><p>When the API receives a request with an access token, the first thing it needs to do is <strong>validate the token</strong>. If the validation fails, then the request must be rejected.</p><p>For more information about <strong>JSON Web Tokens</strong>, check out our <em>free ebook</em> below.</p><div><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2MJmGvwbRWQZLpEkAEEGXF/0b527a4db1cb1bea63393352c0093b4c/jwt-handbook.svg" alt="JWT Handbook"/></p></div><p>We will make use of Auth0 to issue our access tokens. With Auth0, we only have to write a few lines of code to get an in-depth <a href="https://auth0.com/docs/identityproviders" target="_blank" rel="noreferrer noopener">identity management solution</a> which includes:</p><ul><li><a href="https://auth0.com/docs/sso/single-sign-on" target="_blank" rel="noreferrer noopener">Single sign-on</a></li><li><a href="https://auth0.com/docs/user-profile" target="_blank" rel="noreferrer noopener">User management</a></li><li>Support for <a href="https://auth0.com/docs/identityproviders" target="_blank" rel="noreferrer noopener">social identity providers (like Facebook, GitHub, Twitter, etc.)</a></li><li><a href="https://auth0.com/enterprise" target="_blank" rel="noreferrer noopener">Enterprise (Active Directory, LDAP, SAML, etc.)</a></li><li>Your <a href="https://auth0.com/docs/connections/database/mysql" target="_blank" rel="noreferrer noopener">own database of users</a></li></ul><p>If you haven&#39;t done so yet, this is a good time to sign up for a <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">free Auth0 account</a>.</p><blockquote><p>Try out the most powerful authentication platform for free. <strong><a href="https://auth0.com/signup?promo=sup&amp;place=in-blog-banner&amp;type=link&amp;text=get-started&amp;origin=blog" target="_blank" rel="noreferrer noopener">Get started ‚Üí</a></strong></p></blockquote><p>Once you have your Auth0 account, go ahead and <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">create a new API in the dashboard</a>. An API is an entity that represents an external resource, capable of accepting and responding to requests made by clients, such as the authors API we just made.</p><blockquote><p>Auth0 offers a generous free tier to get started with modern authentication.</p></blockquote><p>Login to your Auth0 <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">management dashboard</a> and create a new API client.</p><p>Click on the APIs menu item and then the <strong>Create API</strong> button.</p><p><em>Create a New API</em></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3N30QOPVYZJCQHrknTFhDp/8f38f811cb3302f000a341c1bff0e934/08_rest.png" alt="Create API on Auth0 Dashboard"/></p><p>Next, you will need to give your API a <code>Name</code> and an <code>Identifier</code>. The <code>Name</code> can be anything you choose, so make it as descriptive as you want. The <code>Identifier</code> will be used to specify your API and cannot be changed once set. We&#39;ll be using it as an <code>audience</code> later when configuring the access token verification.</p><p>Here&#39;s my setup for the author&#39;s API:</p><ul><li>Name: <strong>Authors API</strong></li><li>Identifier: <strong><a href="https://authorsapi.com/" target="_blank" rel="noreferrer noopener">https://authorsapi.com</a></strong>.</li><li>Signing algorithm: <strong>RS256</strong></li></ul><p>Once you have yours filled out, click on the <strong>Create API</strong> button.</p><p><em>Creating the Authors API</em></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2scoVbuN1Dri7mQ336a0T6/57019146d674a21dd28891c2b7ca9fee/09_rest.png" alt="Create Author&#39;s API"/></p><p>Next, head over to your terminal and install the <strong><a href="https://github.com/auth0/auth0-PHP" target="_blank" rel="noreferrer noopener">Auth0 PHP SDK</a></strong> in your project&#39;s root directory:</p><pre><code><span>composer</span> require auth0/auth0-php guzzlehttp/guzzle</code></pre><blockquote><p><a href="https://packagist.org/packages/guzzlehttp/guzzle" target="_blank" rel="noreferrer noopener">guzzlehttp/guzzle</a> provides psr/http-client-implementation which the auth0 PHP SDK requires.</p></blockquote><h3 id="Setting-up-environment-variables">Setting up environment variables</h3><p>In this section, we&#39;re going to create the middleware to validate access tokens. The middleware will use some environment variables, so let&#39;s set those up first.</p><p>Open up <code><span>.</span>env</code> and add the following:</p><pre><code><span>AUTH0_DOMAIN</span><span>=</span>https<span>:</span><span>/</span><span><span>/</span><span>your-domain.auth0.com</span><span>/</span></span>

<span>AUTH0_AUD</span><span>=</span>https<span>:</span><span>/</span><span>/</span>authorsapi<span>.</span>com</code></pre><p>Replace these values with your own from the <a href="https://manage.auth0.com/dashboard" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a>.</p><p><strong>AUTH0_DOMAIN</strong></p><p>Click on <code>APIs</code> &gt; <code>Authors <span>API</span></code> &gt; <code>Quick Start</code> &gt; <code><span>PHP</span></code> in the dashboard to find your domain. Copy the value listed for <code>authorized_iss</code> and paste it into <code><span>.</span>env</code> as <code><span>AUTH0_DOMAIN</span></code>.</p><blockquote><p>When specifying the <code><span>AUTH0_DOMAIN</span></code> value, make sure you add the trailing slash: <code>https<span>:</span><span>/</span><span><span>/</span><span>xyz.auth0.com</span><span>/</span></span></code>.</p></blockquote><p><strong>AUTH0_AUD</strong></p><p>You can find this value in the Auth0 dashboard in the same place as the domain:</p><p><code>APIs</code> &gt; <code>Quick Start</code> &gt; <code><span>PHP</span></code>.</p><p>Copy the value listed for <code>valid_audiences</code> and paste it in for <code><span>AUTH0_AUD</span></code>. If you followed the naming conventions of this tutorial, it would be <code>https<span>:</span><span>/</span><span>/</span>authorsapi<span>.</span>com</code>.</p><h3 id="Create-the-Auth0-Middleware">Create the Auth0 Middleware</h3><p>Create a new middleware file, <code>Auth0Middleware<span>.</span>php</code>, in the <code>app<span>/</span>Http<span>/</span>Middleware</code> directory. Add the following code to it:</p><pre><code><span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>Http<span>\</span>Middleware</span><span>;</span>

<span>use</span> <span>Auth0<span>\</span>SDK<span>\</span>Auth0</span><span>;</span>
<span>use</span> <span>Auth0<span>\</span>SDK<span>\</span>Exception<span>\</span>InvalidTokenException</span><span>;</span>
<span>use</span> <span>Closure</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Http<span>\</span>Request</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Http<span>\</span>Response</span><span>;</span>

<span>class</span> <span>Auth0Middleware</span> <span>{</span>

    <span>/**
     * Run the request filter.
     *
     * @param Request $request
     * @param Closure $next
     * @return mixed
     */</span>
    <span>public</span> <span>function</span> <span>handle</span><span>(</span><span>Request</span> <span>$request</span><span>,</span> <span>Closure</span> <span>$next</span><span>)</span> <span>{</span>

        <span>$token</span> <span>=</span> <span>$request</span><span>-&gt;</span><span>bearerToken</span><span>(</span><span>)</span><span>;</span>

        <span>if</span> <span>(</span><span>!</span><span>$token</span><span>)</span> <span>{</span>
            <span>return</span> <span>response</span><span>(</span><span>)</span>
                <span>-&gt;</span><span>json</span><span>(</span><span>&#39;No token provided&#39;</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_UNAUTHORIZED</span><span>)</span><span>;</span>
        <span>}</span>

        <span>try</span> <span>{</span>
            <span>$this</span><span>-&gt;</span><span>validateToken</span><span>(</span><span>$token</span><span>)</span><span>;</span>
        <span>}</span> <span>catch</span> <span>(</span><span>InvalidTokenException</span> <span>$exception</span><span>)</span> <span>{</span>
            <span>return</span> <span>response</span><span>(</span><span>)</span>
                <span>-&gt;</span><span>json</span><span>(</span><span>$exception</span><span>-&gt;</span><span>getMessage</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>}</span>

        <span>return</span> <span>$next</span><span>(</span><span>$request</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>validateToken</span><span>(</span><span>$token</span><span>)</span> <span>{</span>

        <span>$auth0</span> <span>=</span> <span>new</span> <span>Auth0</span><span>(</span>
            <span>[</span>
                <span>&#39;domain&#39;</span> <span>=&gt;</span> <span>env</span><span>(</span><span>&#39;AUTH0_DOMAIN&#39;</span><span>)</span><span>,</span>
                <span>&#39;strategy&#39;</span> <span>=&gt;</span> <span>&#39;api&#39;</span><span>,</span>
                <span>&#39;audience&#39;</span> <span>=&gt;</span> <span>[</span>
                    <span>env</span><span>(</span><span>&#39;AUTH0_AUD&#39;</span><span>)</span><span>,</span>
                <span>]</span><span>,</span>
            <span>]</span>
        <span>)</span><span>;</span>
        <span>$auth0</span><span>-&gt;</span><span>decode</span><span>(</span><span>$token</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>The <code>handle</code> function is the entry point for this middleware. When a route (or group of routes) applies this middleware, the <code>handle</code> function will be called before the request can proceed to the application. For now, we only want to ensure that the request has a valid JWT token.</p><p>The first check in the <code>handle</code> function ensures that a bearer token exists for the request. A response is returned with status code <code><span>403</span></code> and an appropriate error message in the absence of one.</p><p>Next, the <code>handle</code> function tries to validate the token by calling the <code>validateToken</code> function - passing the token as an argument. Using the Auth0 SDK, we try to decode the token by calling the <code>decode</code> function. If the token cannot be decoded successfully, an <code>InvalidTokenException</code> will be thrown; hence the <code>validate</code> token is wrapped in a try-catch block. A JSON response is returned with the message and code gotten from the exception when the exception is caught.</p><p>If all of this passes, the token is decoded, and the middleware allows the HTTP request to execute.</p><blockquote><p>While the <code>decode</code> function returns an object with which we can interact, we do not need that at the moment; hence the return value is ignored.</p></blockquote><h3 id="Assign-middleware-to-routes">Assign middleware to routes</h3><p>Now that the middleware is set up, we need to add it to our routes. The first step is to assign the middleware a short-hand key in <code>bootstrap<span>/</span>app<span>.</span>php</code> file&#39;s call to the <code>$app<span>-</span><span>&gt;</span><span>routeMiddleware</span><span>(</span><span>)</span></code> method.</p><p>Go ahead and open up <code>bootstrap<span>/</span>app<span>.</span>php</code> and uncomment this line of code:</p><pre><code><span>...</span>
<span>// $app-&gt;routeMiddleware([</span>
<span>//     &#39;auth&#39; =&gt; App\Http\Middleware\Authenticate::class,</span>
<span>// ]);</span>
<span>...</span></code></pre><p>Once uncommented, replace the <code>Authenticate<span>:</span><span>:</span><span>class</span></code> portion with <code>Auth0Middleware<span>:</span><span>:</span><span>class</span></code> like so:</p><pre><code><span>$app</span><span>-&gt;</span><span>routeMiddleware</span><span>(</span><span>[</span>
    <span>&#39;auth&#39;</span> <span>=&gt;</span> <span>App<span>\</span>Http<span>\</span>Middleware<span>\</span>Auth0Middleware</span><span>::</span><span>class</span><span>,</span>
<span>]</span><span>)</span><span>;</span></code></pre><p>This will allow us to use the <code>Auth0Midddleware</code> that we just created. And now we can use the middleware key in the route options array in the <code>routes<span>/</span>web<span>.</span>php</code> file like so:</p><pre><code><span>...</span>

<span>$router</span><span>-&gt;</span><span>group</span><span>(</span>
    <span>[</span><span>&#39;prefix&#39;</span> <span>=&gt;</span> <span>&#39;api&#39;</span><span>,</span> <span>&#39;middleware&#39;</span> <span>=&gt;</span> <span>&#39;auth&#39;</span><span>]</span><span>,</span>

    <span>function</span> <span>(</span><span>)</span> <span>use</span> <span>(</span><span>$router</span><span>)</span> <span>{</span>

        <span>$router</span><span>-&gt;</span><span>get</span><span>(</span>
            <span>&#39;authors&#39;</span><span>,</span>
            <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@showAllAuthors&#39;</span><span>]</span>
        <span>)</span><span>;</span>

        <span>$router</span><span>-&gt;</span><span>get</span><span>(</span>
            <span>&#39;authors/{id}&#39;</span><span>,</span>
            <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@showOneAuthor&#39;</span><span>]</span>
        <span>)</span><span>;</span>

        <span>$router</span><span>-&gt;</span><span>post</span><span>(</span>
            <span>&#39;authors&#39;</span><span>,</span>
            <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@create&#39;</span><span>]</span>
        <span>)</span><span>;</span>

        <span>$router</span><span>-&gt;</span><span>delete</span><span>(</span>
            <span>&#39;authors/{id}&#39;</span><span>,</span>
            <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@delete&#39;</span><span>]</span>
        <span>)</span><span>;</span>

        <span>$router</span><span>-&gt;</span><span>put</span><span>(</span>
            <span>&#39;authors/{id}&#39;</span><span>,</span>
            <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@update&#39;</span><span>]</span>
        <span>)</span><span>;</span>
    <span>}</span>
<span>)</span><span>;</span></code></pre><p>Now, if a request is made to any endpoint, it first runs the <code>Auth0Middleware</code>. If the request doesn&#39;t have a valid access token or no token at all, it returns an error. Let&#39;s try all of this out.</p><p><em>Accessing any endpoint without an authorization header</em></p><p>When accessing the endpoint without an authorization header, we receive a &#34;no token provided&#34; message.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4oDmxblUGdG1wnPdyOPNgX/1bbdba919ecdb74d34faeef0215b5806/10_rest.png" alt="Accessing any endpoint without an authorization header"/></p><p><em>Accessing any endpoint without any token provided</em></p><p>When accessing the endpoint without a token, we receive a &#34;no token provided&#34; message.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4oDmxblUGdG1wnPdyOPNgX/1bbdba919ecdb74d34faeef0215b5806/10_rest.png" alt="Accessing any endpoint without any token provided"/></p><p><em>Accessing any endpoint without a valid access token</em></p><p>When accessing endpoint without a valid access token:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3tJtQSInf8CrV0DbhQzKtw/c6ab7a52d99467e953bdfeabeabc336e/11_rest.png" alt="Accessing any endpoint without a valid access token"/></p><p>Now, let&#39;s test it with a valid access token. Head over to the <code>test</code> tab of your newly created API on your Auth0 dashboard.</p><p>Grab the Access token from the <em>Test</em> tab</p><p><em>Grab the Access Token</em></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Tb6VuUBIE6bpjqvFywQlf/0fc0dd98b20848d7bcc27d2b0b286203/12_rest.png" alt="Grab the Access Token"/></p><p>Now use this <code>access token</code> in Postman by sending it as an Authorization header to make a POST request to the <code>api<span>/</span>authors</code> endpoint.</p><p><em>Accessing the endpoint securely</em></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2M3Wg9Bps6VPbbGyHn8adn/792aefca801187842437ffc4b8ede15a/13_rest.png" alt="Accessing the endpoint securely"/></p><h3 id="Adding-permissions">Adding permissions</h3><p>Currently, this single access token will allow an application to run any requests, as long as it has a valid token. Eventually, you may want to issue certain <strong>permissions</strong> with the access token. Let&#39;s try it out.</p><p>In the Auth0 dashboard, find the API we&#39;ve been using and click on <code>Permissions</code>. Create a new scope that will grant permission to create a new author (e.g. <code>create<span>:</span>authors</code>). Then add a short description of what that scope does and click <strong>&#34;Add&#34;</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7yeWKDcTLtCcV2rpYYRWyI/745bae041ddbc250a3cea836df12278f/14_rest.png" alt="Adding Permissions"/></p><p>Now our API expects that when an application makes a request to create a new author, it must also send an access token that includes the <code>create<span>:</span>authors</code> scope. To check for this, we need to update our middleware so that it checks the scope in the access token. Open up <code>Auth0Middleware<span>.</span>php</code> and replace it with:</p><pre><code><span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>Http<span>\</span>Middleware</span><span>;</span>

<span>use</span> <span>App<span>\</span>Exceptions<span>\</span>InsufficientScopeException</span><span>;</span>
<span>use</span> <span>Auth0<span>\</span>SDK<span>\</span>Auth0</span><span>;</span>
<span>use</span> <span>Auth0<span>\</span>SDK<span>\</span>Exception<span>\</span>InvalidTokenException</span><span>;</span>
<span>use</span> <span>Closure</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Http<span>\</span>Request</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Http<span>\</span>Response</span><span>;</span>

<span>class</span> <span>Auth0Middleware</span> <span>{</span>

    <span>public</span> <span>function</span> <span>handle</span><span>(</span>
        <span>Request</span> <span>$request</span><span>,</span>
        <span>Closure</span> <span>$next</span><span>,</span>
        <span>?</span><span>string</span> <span>$requiredScope</span> <span>=</span> <span>null</span>
    <span>)</span> <span>{</span>

        <span>$token</span> <span>=</span> <span>$request</span><span>-&gt;</span><span>bearerToken</span><span>(</span><span>)</span><span>;</span>
        <span>if</span> <span>(</span><span>!</span><span>$token</span><span>)</span> <span>{</span>
            <span>return</span> <span>response</span><span>(</span><span>)</span>
                <span>-&gt;</span><span>json</span><span>(</span><span>&#39;No token provided&#39;</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_UNAUTHORIZED</span><span>)</span><span>;</span>
        <span>}</span>

        <span>try</span> <span>{</span>
            <span>$this</span><span>-&gt;</span><span>validateToken</span><span>(</span><span>$token</span><span>,</span> <span>$requiredScope</span><span>)</span><span>;</span>
        <span>}</span> <span>catch</span> <span>(</span><span>InsufficientScopeException</span> <span>|</span> <span>InvalidTokenException</span> <span>$exception</span><span>)</span> <span>{</span>
            <span>return</span> <span>response</span><span>(</span><span>)</span>
                <span>-&gt;</span><span>json</span><span>(</span><span>$exception</span><span>-&gt;</span><span>getMessage</span><span>(</span><span>)</span><span>,</span> <span>$exception</span><span>-&gt;</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>}</span>

        <span>return</span> <span>$next</span><span>(</span><span>$request</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>validateToken</span><span>(</span><span>$token</span><span>,</span> <span>?</span><span>string</span> <span>$requiredScope</span><span>)</span> <span>{</span>

        <span>$auth0</span> <span>=</span> <span>new</span> <span>Auth0</span><span>(</span>
            <span>[</span>
                <span>&#39;domain&#39;</span> <span>=&gt;</span> <span>env</span><span>(</span><span>&#39;AUTH0_DOMAIN&#39;</span><span>)</span><span>,</span>
                <span>&#39;strategy&#39;</span> <span>=&gt;</span> <span>&#39;api&#39;</span><span>,</span>
                <span>&#39;audience&#39;</span> <span>=&gt;</span> <span>[</span>
                    <span>env</span><span>(</span><span>&#39;AUTH0_AUD&#39;</span><span>)</span><span>,</span>
                <span>]</span><span>,</span>
            <span>]</span>
        <span>)</span><span>;</span>
        <span>$decodedToken</span> <span>=</span> <span>$auth0</span><span>-&gt;</span><span>decode</span><span>(</span><span>$token</span><span>)</span><span>;</span>
        <span>if</span> <span>(</span><span>!</span><span>empty</span><span>(</span><span>$requiredScope</span><span>)</span><span>)</span> <span>{</span>
            <span>$this</span><span>-&gt;</span><span>ensureTokenHasScope</span><span>(</span><span>$decodedToken</span><span>-&gt;</span><span>toArray</span><span>(</span><span>)</span><span>,</span> <span>$requiredScope</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>

    <span>private</span> <span>function</span> <span>ensureTokenHasScope</span><span>(</span><span>array</span> <span>$decodedToken</span><span>,</span> <span>string</span> <span>$requiredScope</span><span>)</span> <span>{</span>

        <span>$tokenScope</span> <span>=</span> <span>$decodedToken</span><span>[</span><span>&#39;scope&#39;</span><span>]</span> <span>??</span> <span>&#39;&#39;</span><span>;</span>
        <span>if</span> <span>(</span><span>empty</span><span>(</span><span>$tokenScope</span><span>)</span> <span>||</span> <span>!</span><span>$this</span><span>-&gt;</span><span>tokenHasScope</span><span>(</span><span>$tokenScope</span><span>,</span> <span>$requiredScope</span><span>)</span><span>)</span> <span>{</span>

            <span>throw</span> <span>new</span> <span>InsufficientScopeException</span><span>;</span>
        <span>}</span>

    <span>}</span>

    <span>private</span> <span>function</span> <span>tokenHasScope</span><span>(</span><span>string</span> <span>$scopeString</span><span>,</span> <span>string</span> <span>$requiredScope</span><span>)</span>
    <span>:</span> <span>bool</span> <span>{</span>

        <span>$tokenScopes</span> <span>=</span> <span>explode</span><span>(</span><span>&#39; &#39;</span><span>,</span> <span>$scopeString</span><span>)</span><span>;</span>

        <span>return</span> <span>in_array</span><span>(</span><span>$requiredScope</span><span>,</span> <span>$tokenScopes</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>We&#39;ve made a few changes to the middleware. First, we added a third parameter named <code>requiredScope</code> to the <code>handle</code> function. When this value is not null, our middleware should check and ensure that the provided token has that scope.</p><p>We also modified the <code>validateToken</code> function. Using the decoded token returned by the <code>decode</code> function, we check for the scopes in the token. To do this, we split the string value for <code>scope</code> in the decoded token and check if <code>requiredScope</code> is present in the array of split values. If not, we throw an <code>InsufficientScopeException</code> which is caught by the <code>handle</code> function and handled accordingly.</p><p>Next, we need to declare the <code>InsufficientScopeException</code> class. Create a new file in the <code>app<span>/</span>Exceptions</code> folder named <code>InsufficientScopeException<span>.</span>php</code>. Add the following to the newly created file.</p><pre><code><span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>Exceptions</span><span>;</span>

<span>use</span> <span>Exception</span><span>;</span>
<span>use</span> <span>Illuminate<span>\</span>Http<span>\</span>Response</span><span>;</span>

<span>class</span> <span>InsufficientScopeException</span> <span>extends</span> <span>Exception</span> <span>{</span>

    <span>public</span> <span>function</span> <span>__construct</span><span>(</span><span>)</span> <span>{</span>

        <span>parent</span><span>::</span><span>__construct</span><span>(</span><span>&#39;Insufficient scope&#39;</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_FORBIDDEN</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>Next, we need to update our router and specify the required scope for the route to create authors. To do this, we append the scope to the middleware name (separated by a <code><span>:</span></code>). Modify <code>routes<span>/</span>web<span>.</span>php</code> to match the following.</p><pre><code><span><span>&lt;?php</span>

<span>/** @var Router $router */</span>

<span>/*
|--------------------------------------------------------------------------
| Application Routes
|--------------------------------------------------------------------------
|
| Here is where you can register all of the routes for an application.
| It is a breeze. Simply tell Lumen the URIs it should respond to
| and give it the Closure to call when that URI is requested.
|
*/</span>

<span>use</span> <span>Laravel<span>\</span>Lumen<span>\</span>Routing<span>\</span>Router</span><span>;</span>

<span>$router</span><span>-&gt;</span><span>get</span><span>(</span><span>&#39;/&#39;</span><span>,</span> <span>function</span> <span>(</span><span>)</span> <span>use</span> <span>(</span><span>$router</span><span>)</span> <span>{</span>

    <span>return</span> <span>$router</span><span>-&gt;</span><span>app</span><span>-&gt;</span><span>version</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

<span>$router</span><span>-&gt;</span><span>group</span><span>(</span>
    <span>[</span><span>&#39;prefix&#39;</span> <span>=&gt;</span> <span>&#39;api&#39;</span><span>,</span> <span>&#39;middleware&#39;</span> <span>=&gt;</span> <span>&#39;auth&#39;</span><span>]</span><span>,</span>

    <span>function</span> <span>(</span><span>)</span> <span>use</span> <span>(</span><span>$router</span><span>)</span> <span>{</span>

        <span>$router</span><span>-&gt;</span><span>get</span><span>(</span>
            <span>&#39;authors&#39;</span><span>,</span>
            <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@showAllAuthors&#39;</span><span>]</span>
        <span>)</span><span>;</span>

        <span>$router</span><span>-&gt;</span><span>get</span><span>(</span>
            <span>&#39;authors/{id}&#39;</span><span>,</span>
            <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@showOneAuthor&#39;</span><span>]</span>
        <span>)</span><span>;</span>

        <span>$router</span><span>-&gt;</span><span>delete</span><span>(</span>
            <span>&#39;authors/{id}&#39;</span><span>,</span>
            <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@delete&#39;</span><span>]</span>
        <span>)</span><span>;</span>

        <span>$router</span><span>-&gt;</span><span>put</span><span>(</span>
            <span>&#39;authors/{id}&#39;</span><span>,</span>
            <span>[</span><span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@update&#39;</span><span>]</span>
        <span>)</span><span>;</span>
    <span>}</span>
<span>)</span><span>;</span>

<span>$router</span><span>-&gt;</span><span>post</span><span>(</span>
    <span>&#39;api/authors&#39;</span><span>,</span>
    <span>[</span>
        <span>&#39;middleware&#39;</span> <span>=&gt;</span> <span>&#39;auth:create:authors&#39;</span><span>,</span>
        <span>&#39;uses&#39;</span> <span>=&gt;</span> <span>&#39;AuthorController@create&#39;</span><span>,</span>
    <span>]</span>
<span>)</span><span>;</span></span></code></pre><blockquote><p>Notice we removed the <code>post</code> route from the group. We did this to allow us to pass the custom scope to the middleware.</p></blockquote><p>Now, if you try to create a new author in Postman using that same token as before, you&#39;ll receive the &#34;Insufficient scope&#34; message.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4vFkd5neC6l8BEWWlFuGIH/68396ca33a44ae36b74478418b8fc73f/15_rest.png" alt="Insufficient scope"/></p><p>To test that it works, make sure you&#39;re on the page with your API in the <a href="https://manage.auth0.com/dashboard/" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a> and then go to the <code>Permissions</code> tab. Click on <code>Machine to Machine Applications</code> and find the API Application you&#39;ve been using. Make sure the <code>Authorized</code> toggle is on, and then click on the arrow. Now select the <code>create<span>:</span>authors</code> scope and press &#34;Update&#34;.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2JvC7MwAf7K6kbf2iAno98/9cfa531e144d179b96a1231fd058c569/16_rest.png" alt="Create Author Scope"/></p><p>The permission for <code>create<span>:</span>authors</code> has been added to our test token. Head back to the &#34;Test&#34; tab and press &#34;Copy token&#34; to get the updated one.</p><p>Paste that token into the Authorization header as you did before (make sure you have <code>Bearer</code> before it), try the <code><span>POST</span></code> request again, and now it should have worked!</p><h3 id="Adding-a-front-end">Adding a front-end</h3><p>This is just an example of how to create API access tokens. Once you&#39;re ready to actually <strong>issue and use them</strong>, you need to create a front-end. Here are some amazing <a href="https://auth0.com/blog/reactjs-authentication-tutorial/" target="_blank" rel="noreferrer noopener">React</a> and <a href="https://auth0.com/blog/beginner-vuejs-tutorial-with-user-login/" target="_blank" rel="noreferrer noopener">Vue.js authentication tutorials</a> that cover how you can accomplish that.</p><h2 id="Conclusion">Conclusion</h2><p>Well done! You have learned how to build a rest API with the powerful PHP micro-framework Lumen and secure it using JWTs. Need to use PHP to build your API or micro-service? I&#39;d bet on Lumen as the tool of choice for speed and ease of use.</p><p>As you&#39;ve seen, Auth0 can help secure your <strong>API</strong> with ease. Auth0 provides more than just username-password authentication. It provides features like <a href="https://auth0.com/multifactor-authentication" target="_blank" rel="noreferrer noopener">multifactor auth</a>, <a href="https://auth0.com/breached-passwords" target="_blank" rel="noreferrer noopener">breached password detection</a>, <a href="https://auth0.com/docs/anomaly-detection" target="_blank" rel="noreferrer noopener">anomaly detection</a>, <a href="https://auth0.com/docs/identityproviders" target="_blank" rel="noreferrer noopener">enterprise federation</a>, <a href="https://auth0.com/docs/sso" target="_blank" rel="noreferrer noopener">single sign-on (SSO)</a>, and more.</p><p><a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">Sign up</a> today so you can take the stress out of authentication and instead focus on building unique features for your app.</p><p>The code for this article is available on <a href="https://github.com/yemiwebby/lumen-api-auth0" target="_blank" rel="noreferrer noopener">GitHub</a>. Happy coding!</p></div></div>]]></content:encoded>
      <author>Building a Fast Authors API Rapidly With Lumen</author>
      <pubDate>Fri, 04 Feb 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Use Auth0 Actions to Send User Info to Apache Kafka When They Register</title>
      <link>https://auth0.com/blog/send-auth0-events-to-kafka-for-realtime-processing/</link>
      <description>Use Auth0 Actions to send authentication events to Apache Kafka.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In this post, you‚Äôll learn how to integrate Auth0 with <a href="https://kafka.apache.org/" target="_blank" rel="noreferrer noopener">Apache Kafka</a> using Actions. You‚Äôll do this by writing an Action that pushes information from new user registrations to a Kafka cluster. By doing this, you open a number of analytics and user experience possibilities, including:</p><ul><li>Processing sign-up events (with <a href="https://flink.apache.org/" target="_blank" rel="noreferrer noopener">Apache Flink</a> or <a href="https://spark.apache.org/" target="_blank" rel="noreferrer noopener">Spark</a>) to notify your business and sales team when a new user signs up for an account.</li><li>Trigger processes such as sending a welcome email or Slack message in response to a user signing up.</li><li>Using a <a href="https://docs.snowflake.com/en/user-guide/kafka-connector-overview.html" target="_blank" rel="noreferrer noopener">Kafka connector</a> to move the user data gathered from the sign-up process to a database or data warehouse to feed reporting and analytics applications.</li><li>Feeding new user data to your CRM application.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/47eyPrCR712YD4KWSRvG80/8150b144cf5cbb5747096d3f3af8bea4/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Kafka"/></p><h2 id="Why-Apache-Kafka-">Why Apache Kafka?</h2><p>Apache Kafka is a distributed messaging platform that receives data as events in real-time from sources such as sensors, mobile devices, databases, applications, and services (including Auth0) and makes that data available to target systems. It supports both publish/subscribe and distributed queue scenarios. Kafka gives you the flexibility to perform both stream processing and batch processing with your data. Kafka‚Äôs replication feature and durability allow you to use it as a persistent hub for your data.</p><h2 id="Auth0-Actions">Auth0 Actions</h2><p>Auth0 Actions are serverless Node.js functions that are triggered by certain events that take place when signing up for an Auth0 user account or authenticating with Auth0. Using Actions, you can customize and extend Auth0‚Äôs capabilities with your custom logic that you can add to events such as login, registration, changing passwords, and more. Auth0 Actions are stateless, so you‚Äôll need an external store if you use them to collect data. Check <a href="https://auth0.com/docs/customize/actions/actions-overview" target="_blank" rel="noreferrer noopener">this article</a> to learn more about Actions.</p><p>In this post, we will write an Auth0 Action which will be triggered by the Post User Registration flow, which happens after a user has completed signing up for an account.</p><h2 id="Create-a-Kafka-Cluster">Create a Kafka Cluster</h2><p>Because Auth0 Actions are stateless, we need a Kafka service that does not require stateful connections. We will use <a href="https://upstash.com/kafka" target="_blank" rel="noreferrer noopener">Upstash‚Äôs Kafka service</a>, which has a REST API and is designed for serverless environments and a free plan suitable for this project.</p><p>If you don‚Äôt already have an Upstash account, <a href="https://console.upstash.com/login" target="_blank" rel="noreferrer noopener">sign up for one</a>. The process is very quick, especially if you sign up using an Amazon, GitHub, or Google account. You‚Äôll be taken to the <a href="https://console.upstash.com/" target="_blank" rel="noreferrer noopener">Upstash console</a> immediately afterward:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7i8OxJQwxFJZYOAKZGvS1f/d89275afb1698cc4f7c498eb100fb12d/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Cluster"/></p><p>Select <strong>Kafka</strong> in the menu bar at the top of the page. You‚Äôll be taken here:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4shEb8jySPGei6xBcZ0DPK/6e056b1ae7fa8e0a9a60f7f67d047506/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Cluster"/></p><p>In order to use Kafka, you need a cluster, which is a set of one or more servers running Apache Kafka. Click the <strong>Create Cluster</strong> button. This form will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6LZJRtkgqpHLUPxpdoesuj/08d7a77dc2da2ef54e57f3dea316eaf7/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Cluster"/></p><p>Provide the following information for each of its fields:</p><ul><li><strong>Name:</strong> Pick a name that will make it easy to recognize, such as ‚ÄúAuth0 Actions Test.‚Äù</li><li><strong>Region:</strong> Select the region closest to you.</li><li><strong>Type:</strong> Select <strong>Single Zone</strong></li></ul><p>Click the <strong>Create</strong> button to continue. You‚Äôll see the form‚Äôs second page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/130Z4nzMY3elKtmElpZz4o/d25551d11ae2615697e6b724199cac47/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Create"/></p><p>You need to provide a name for a <em>topic,</em> which is how Kafka organizes events. If you think of events as being like files, topics are like directories. Enter the topic name <strong>user-events-topic</strong> into the <strong>Name</strong> field and click the <strong>Send Request</strong> button.</p><p>Upstash will create the cluster and immediately take you to its <strong>Details</strong> page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1iU7Q3GmamqgUbJQGVOOeF/fbf5724310a40936c0937a0e3d4baeca/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Details"/></p><p>Scroll down to the <strong>REST API</strong> section, where you‚Äôll see controls to copy the values for <code><span>UPSTASH_KAFKA_REST_URL</span></code>, <code><span>UPSTASH_KAFKA_REST_USERNAME</span></code>, and <code><span>UPSTASH_KAFKA_REST_PASSWORD</span></code>, which you will use in the next step.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3FEKvlN77iwUh0V8RBQ6aC/265f34f90d4d38ad09f64b5662a7dc79/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="REST API"/></p><p>Keep this page open in a browser tab or window; you‚Äôll need it shortly.</p><h2 id="Implement-the-Action">Implement the Action</h2><p>You will need an Auth0 account for this step. If you don‚Äôt already have an account, <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">you can sign up for one for free.</a></p><h3 id="Create-a-new-action">Create a new action</h3><p>Log into the Auth0 dashboard. On the left menu, select <strong>Actions</strong> ‚Üí <strong>Library</strong>, then click the <strong>Build Custom</strong> button. This will open the <strong>Create Action</strong> pop-up:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/541DakfFmVUUMnBG9vHwr9/f60d4fe3cd82639f39f835a32b9c4a51/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="reate Action"/></p><p>Provide a name for the Action (I used <strong>sendKafka</strong>).  </p><p>Since the goal is to send a message to Kafka after a user has signed up for an account, the action should be triggered by the Post User Registration event. Select <strong>Post User Registration</strong> from the <strong>Trigger</strong> menu, then click the <strong>Create</strong> button.</p><p>You should now see the code editor:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4QTUZab91hhnUek6nbydtm/789ab00bcbde339441a01d02ec0018c5/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="reate Action"/></p><h3 id="Define-the-Action-s-secrets">Define the Action‚Äôs secrets</h3><p>To send messages to the Kafka cluster, the Action needs the <code><span>UPSTASH_KAFKA_REST_URL</span></code>, <code><span>UPSTASH_KAFKA_REST_USERNAME</span></code> and <code><span>UPSTASH_KAFKA_REST_PASSWORD</span></code> values for your Kafka cluster, which you can copy from the Upstash console. You could simply use these values to define constants, but it‚Äôs more secure to keep them hidden. You can do this with Actions‚Äô <strong><em>Secrets</em></strong> feature, which lets you securely store sensitive values and access them as properties of the <code>event<span>.</span>secrets</code> object.</p><p>Let‚Äôs start with the first value, <code><span>UPSTASH_KAFKA_REST_USERNAME</span></code>. Switch to the browser tab or window with the Upstash console and click on the icon beside <code><span>UPSTASH_KAFKA_REST_USERNAME</span></code> to copy its value. Then switch back to the Action code editor and click the ‚ÄúSecrets‚Äù icon:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/25t3LnePJf5WZEZlXWUNWk/d8eb298b643cc246f4edd5e9f16e8dc3/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Secrets"/></p><p>A new column with the title <strong>Secrets</strong> will appear in the code editor:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5Mpielp1PpUBKdggFN95Ez/ff08915ea004c8a7eb894aa92bc1faec/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Secrets"/></p><p>Click the <strong>Add Secret</strong> button. A pop-up will appear, and you will be able to define your first secret value:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6dxqg239qUPjaKFocZeGcT/c0acea0519808c411846200a23fee411/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Add Secret"/></p><p>Enter <code><span>UPSTASH_KAFKA_REST_URL</span></code> into the <strong>Key</strong> field, paste the value you copied from the Upstash console into the <strong>Value</strong> field, and click the <strong>Create</strong> button. This will create a property named <code>event<span>.</span>secrets<span>.</span><span>UPSTASH_KAFKA_REST_URL</span></code>, which you will be able to use in your Action.</p><p>Click the <strong>Add Secret</strong> button again. This time, define the <code><span>UPSTASH_KAFKA_REST_USERNAME</span></code> secret by copying its value from Upstash and filling out the <strong>Define Secret</strong> form as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/g1QnSJwEekRL6u2lbcWoa/12a993bf7846febff07fbe3a4962f3e4/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Add Secret"/></p><p>Click the <strong>Create</strong> button, then click the <strong>Add Secret</strong> button one more time. Define the <code><span>UPSTASH_KAFKA_REST_PASSWORD</span></code> secret by copying its value from Upstash and filling out the <strong>Define Secret</strong> form as shown below‚Ä¶</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/35dYyYGnD9CrFlUNPhigqB/afd68d74bc539e86f607af23a956dab9/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Define Secret"/></p><p>‚Ä¶then click the <strong>Create</strong> button. The <strong>Secrets</strong> column should now contain a list of three secrets:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1wkGPTskvMIU8BHQUXdlTn/6090399c09c0cecebf448949444b5fa7/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Create"/></p><h3 id="Add-the-node-fetch-module-to-the-Action">Add the node-fetch module to the Action</h3><p>You can import any npm module into an Action, which makes them very powerful. This action uses the <a href="https://www.npmjs.com/package/node-fetch" target="_blank" rel="noreferrer noopener">node-fetch</a> module to send events to the Kafka cluster, so you‚Äôll need to add it as a dependency. You can do this with the <strong><em>Modules</em></strong> feature.</p><p>Click the ‚ÄúModules‚Äù icon, which is just below the ‚ÄúSecrets‚Äù icon:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1FIkQiyIwiEnMuLceyRqWm/229bfc23e1b8b9fb8c1f804fbfa672a4/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Modules"/></p><p>A new column with the title <strong>Modules</strong> will appear in the code editor:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6D6vSKdIZwkhIk26zhpMfv/f6c18c676a69f6c519ba9b30166034e9/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Modules"/></p><p>Click the <strong>Add Module</strong> button. A pop-up will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7KbTmaZmZNNUDiMnqgvPF9/c1fa1efdc6285f5f51405f8a924df68c/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Add Module"/></p><p>Enter <strong>node-fetch</strong> into the <strong>Name</strong> field and <strong>2</strong> into the <strong>Version</strong> field. Do <em>not</em> select the latest version (3 at the time of writing), as it does not allow <code><span>require</span><span>(</span><span>)</span></code> to import it.</p><p>Click the <strong>Create</strong> button. The <strong>Modules</strong> column should now list the <em>node-fetch</em> module:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Uvbaeb6xNhGQWcE2T8Ru4/2dd6b53db2bf15ab2f23e020416e366c/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Create"/></p><h3 id="Write-the-Action">Write the Action</h3><p>Now that you have provided the prerequisites, it‚Äôs time to write the Action!</p><p>Paste the code below into the editor:</p><pre><code><span>const</span> fetch <span>=</span> <span>require</span><span>(</span><span>&#39;node-fetch&#39;</span><span>)</span><span>;</span>
 
exports<span>.</span><span>onExecutePostUserRegistration</span> <span>=</span> <span>async</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> address <span>=</span> event<span>.</span>secrets<span>.</span><span>UPSTASH_KAFKA_REST_URL</span>
  <span>const</span> user <span>=</span> event<span>.</span>secrets<span>.</span><span>UPSTASH_KAFKA_REST_USERNAME</span>
  <span>const</span> pass <span>=</span> event<span>.</span>secrets<span>.</span><span>UPSTASH_KAFKA_REST_PASSWORD</span>
  <span>const</span> auth <span>=</span> Buffer<span>.</span><span>from</span><span>(</span><span><span>`</span><span><span>${</span>user<span>}</span></span><span>:</span><span><span>${</span>pass<span>}</span></span><span>`</span></span><span>)</span><span>.</span><span>toString</span><span>(</span><span>&#39;base64&#39;</span><span>)</span>
  <span>const</span> topic <span>=</span> <span>&#39;user-events-topic&#39;</span>

  <span>const</span> userData <span>=</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span>event<span>.</span>user<span>)</span><span>;</span>
  <span>const</span> x <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span><span>`</span><span><span>${</span>address<span>}</span></span><span>/produce/</span><span><span>${</span>topic<span>}</span></span><span>`</span></span><span>,</span> <span>{</span>
    method<span>:</span> <span>&#39;POST&#39;</span><span>,</span>
    headers<span>:</span> <span>{</span><span>&#39;Authorization&#39;</span><span>:</span> <span><span>`</span><span>Basic </span><span><span>${</span>auth<span>}</span></span><span>`</span></span><span>}</span><span>,</span>
    body<span>:</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span><span>&#34;value&#34;</span> <span>:</span> userData<span>}</span><span>)</span>
  <span>}</span><span>)</span>
  <span>const</span> response <span>=</span> <span>await</span> x<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>
  console<span>.</span><span>log</span><span>(</span>response<span>)</span>
<span>}</span><span>;</span></code></pre><p>This Action uses the <code><span>onExecutePostUserRegistration</span><span>(</span><span>)</span></code> function provided by Auth0. The function is called when the user has finished signing up for an account. It takes a single parameter, <code>event</code>, whose <code>user</code> property is an object containing information about the newly-registered user, such as their email address and user ID.</p><p>This code retrieves the secret values stored in the Action‚Äôs Secrets and uses them to connect to the Kafka cluster. It takes the <code>user</code> object, converts it into a raw JSON string, and sends it to the topic named <code>user<span>-</span>events<span>-</span>topic</code> in the Kafka cluster. The user data to the Kafka topic using the Upstash REST API.</p><h3 id="Test-the-Action">Test the Action</h3><p>Now, we can run the function by clicking on the <strong>Test</strong> icon on the editor‚Äôs sidebar:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6UPSQybrGeZRu0kj6qzpsQ/13cf0a64078bd41880c5352ef585dc04/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Test"/></p><p>A new column with the title <strong>Test</strong> will appear in the code editor:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6iPKb04fleyOW1kndgekn5/8a43590a9482e388757f5cecf628b227/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Test"/></p><p>Click the <strong>Run</strong> button to run the test. A <strong>Test Results</strong> pane will appear in the lower section of the code editor:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3NNpjQElJ4qrQQAGPSZ5mj/750f79ace5041fb987f839115067ea2b/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Run"/></p><p>You should see something similar to the output below in the <strong>Logs</strong> section:</p><pre><code>Logs<span>:</span>
<span>[</span>
  <span>{</span>
    topic<span>:</span> <span>&#39;user-events-topic&#39;</span><span>,</span>
    partition<span>:</span> <span>0</span><span>,</span>
    offset<span>:</span> <span>317</span><span>,</span>
    timestamp<span>:</span> <span>1641950606804</span>
  <span>}</span>
<span>]</span></code></pre><p>You now have a working Action. It‚Äôs time to deploy it!</p><h2 id="Deploy-the-Action">Deploy the Action</h2><p>Click the <strong>Deploy</strong> button located near the upper right corner of the page. This saves your Action and makes it the current version in your library,</p><p>Now that your Action is in the Library, you need to add it to the Post User Registration flow. Navigate to the flow by selecting <strong>Actions</strong> from the left side menu, then <strong>Flows</strong> ‚Üí<strong>Post User Registration</strong>. You‚Äôll see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/MTvdp0U3YWpwQ3zP0PNvm/cd660cc3c68f8c1b3f85738f4b764915/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Deploy"/></p><p>In the <strong>Add Action</strong> section on the right side of the page, select the <strong>Custom</strong> tab to see the Actions you have created:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2ws2KlG9D05TFenL1KkHz5/3665c18f8042ba8f30ae2772c48fc206/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Deploy"/></p><p>You should see the <strong>sendKafka</strong> action. Drag and drop it to the area between the <strong>Start</strong> and <strong>Complete</strong> nodes in the flow as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6xO4IuP3sJXiURYYFYQDqt/4ba5fb18546c69890af0c71cefe55f27/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="sendKafka"/></p><p>Now that you have added your Action to the flow apply the change by clicking the <strong>Apply</strong> button near the upper right corner of the page.</p><h2 id="Test-the-Action">Test the Action</h2><p>Now that the Action is deployed, it‚Äôs time to test it!</p><h3 id="Create-a-new-user">Create a new user</h3><p>The Action you just created runs whenever a new user signs up, so one way to test it is to create a new user using the Auth0 dashboard.</p><p>In the Auth0 dashboard‚Äôs left menu, select <strong>User Management</strong> ‚Üí <strong>Users</strong> ‚Üí <strong>Create User</strong> and create a new user:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4oVUjX54aRwTPCOu4bBqXu/6e6bd39df85e29061f918af92681067f/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="User Management"/></p><p>After creating the user, switch to the Upstash browser tab or window, select the <strong>Topics</strong> tab, and then select the <strong>user-events-topic</strong> topic:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5KBLE6L4v4AVlNb5RsQPKX/208f1e1ba0c3820de192cf4d928c99d7/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Topics"/></p><p>This will display the statistics for your Kafka topic:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6bYnLjjiKI1uQ8hTl7hQnQ/3c318e37ea74536beaa3923054b2c1f8/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Topics"/></p><p>Each time you create a new user, a new message is pushed to the Kafka topic, increasing its count ‚Äîwhich appears under <strong>Messages</strong> ‚Äîby one.</p><p>You can check the Kafka topic by using the <strong>Consumer</strong> curl script in the <strong>REST API</strong> section under the <strong>Details</strong> tab:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/54opQIKp8N757l82HmPrle/199a88de3d5caad79126da557fd76d26/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Details"/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7HtICJcX8nk92VgX7O244c/053a270c39a0fb52ea759e85b476812b/Uploaded_from_Send_Auth0_Events_to_Kafka_for_Realtime_Processing_" alt="Details"/></p><p>Run the curl script in your command line console. The result should look something like this:</p><pre><code><span>[</span> <span>{</span>
  <span>&#34;topic&#34;</span> <span>:</span> <span>&#34;user-events-topic&#34;</span><span>,</span>
  <span>&#34;partition&#34;</span> <span>:</span> <span>0</span><span>,</span>
  <span>&#34;offset&#34;</span> <span>:</span> <span>316</span><span>,</span>
  <span>&#34;timestamp&#34;</span> <span>:</span> <span>1641948554609</span><span>,</span>
  <span>&#34;key&#34;</span> <span>:</span> <span>&#34;&#34;</span><span>,</span>
  <span>&#34;value&#34;</span> <span>:</span> <span>&#34;{\&#34;email\&#34;:\&#34;exampleuser@example.com\&#34;,\&#34;tenant\&#34;:\&#34;test-upstash\&#34;,\&#34;user_id\&#34;:\&#34;auth0|61de2511fd334200aq221d\&#34;,\&#34;app_metadata\&#34;:{},\&#34;user_metadata\&#34;:{},\&#34;email_verified\&#34;:false,\&#34;phone_verified\&#34;:false}&#34;</span><span>,</span>
  <span>&#34;headers&#34;</span> <span>:</span> <span>[</span> <span>]</span>
<span>}</span> <span>]</span><span>%</span></code></pre><h2 id="Conclusion">Conclusion</h2><p>Auth0 Actions enable developers to inject custom logic into the user lifecycle, adding additional behavior and features to the login process. In this article, we used Auth0 Actions to produce events for Kafka triggered by new user registrations. Once stored in Kafka, there are endless possibilities for how you can leverage the data.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 03 Feb 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Micro Frontends with Angular, Module Federation, and Auth0</title>
      <link>https://auth0.com/blog/micro-frontends-with-angular-module-federation-and-auth0/</link>
      <description>Module Federation allows loading Micro Frontends at runtime. Common dependencies like Angular or the Auth0 library can be shared and hence don&#39;t need to be loaded several times. This is also the key for sharing data like the current user or global filters.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> Module Federation allows loading Micro Frontends at runtime. Common dependencies like Angular or the Auth0 library can be shared and hence don&#39;t need to be loaded several times. This is also the key for sharing data like the current user or global filters.</p><h2 id="Micro-Frontends">Micro Frontends</h2><p>Recently, there have been a lot of discussions about Micro Frontends. The underlying idea is quite tempting: Splitting a huge software system into smaller parts and assigning each part to an individual team:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/38DpehwkPwiMTNBOvOQowG/ce345e71277e19f211f23add38a0ae4e/microfrontends.png" alt="Each micro frontend can be developed by an autarkic team"/></p><p>As these teams are -- more or less -- autonomous, they can work in a more flexible way and don&#39;t need to coordinate that much with others. This shows that Micro Frontends are mostly about scaling teams. Hence, if you don&#39;t have several frontend teams, Micro Frontends might be overkill. </p><h2 id="Module-Federation">Module Federation</h2><p>Splitting software systems into several parts is, however, only one side of the coin. Even though we developers might like this idea, the users don&#39;t! They aren&#39;t interested in starting several frontends but expect an integrated solution. </p><p>Accordingly, we need to find a way to make all our micro frontends appear as one (single page) application. Very often, this involves loading micro frontends into a shell application.</p><p>For instance, the example used here mimics a simple shopping system. One of its micro frontends deals with shipping:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Zs0it0naO2U4W1GwBMpNn/caa76eb2a246ab2dfa5d5394c6ed89c5/example-shipping.png" alt="Example micro frontend dealing with shipping products"/></p><p>For the purpose of integration, this micro frontend needs to be loaded into a shell:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/iJOA5Lg4AHYGHBt0SK06U/8bdb25c11b8ac571f259f57217ff72eb/example-shipping-in-shell.png" alt="Example of a shell loading the shipping micro frontend"/></p><p>The shell loads this but also other micro frontends on demand.</p><p>For such an implementation, you needed a lot of tricks in the past. Fortunately, Module Federation makes this task straightforward. </p><p>Module Federation is an integrated part of webpack 5, and hence, it works with all modern web frameworks. Also, as webpack is highly used in nearly all communities, Module Federation immediately becomes a widespread solution.</p><p>In order to allow loading separately compiled and deployed micro frontends, Module Federation defines two roles: the host and the remote:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6RTBbIScEwfnZm97MMe7nJ/2138d86c99a988b286f9852d020097a4/module-federation.png" alt="Schematic representation of Module Federation"/></p><p>In our case, the host is the shell, while the remote is the micro frontend. Both can be configured with their webpack configurations. </p><p>The host defines virtual URLs pointing to remotes. In the previous picture, for instance, the URL <code>mfe1</code> pointing to a micro frontend, also called <code>mfe1</code>, is defined.</p><p>The remote, in turn, exposes files -- or, to be more precise: EcmaScript modules -- for the host. To prevent that, the latter one needs to know the remote&#39;s file structure; exposed files can get a shorter alias. The example in the last picture goes with the alias <code>Cmp</code>. </p><p>Exposed EcmaScript modules can easily be loaded into the host by using a dynamic <code><span>import</span></code> together with the mapped URLs and defined aliases. The best: From Angular&#39;s perspective, this is just like lazy loading. </p><p>As Angular doesn&#39;t even recognize that the application loads a micro frontend, we can use it exactly as it was intended to be used. We don&#39;t need any tricks or meta frameworks orchestrating different SPAs in our browser window. This eases our endeavor dramatically.</p><h2 id="Module-Federation-in-Angular">Module Federation in Angular</h2><p>Since version 12, the Angular CLI uses webpack 5. Hence, we also get Module Federation out of the box. To activate it, we need a custom builder that, e. g. ships with the community solution <code>@angular<span>-</span>architects<span>/</span>module<span>-</span>federation</code>. As it comes with respective schematics, you can easily <code>ng add</code> it to your CLI workspace:</p><pre><code>ng <span>add</span> @angular-architects/module-federation</code></pre><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3eoqQDVCE5OK0QfzoYmXt8/378fda04d26bd28ffc798754f3150819/ng-add.png" alt="Adding @angular-architects/module-federation to your project"/></p><p>The well-known CLI extension <a href="https://nx.dev/" target="_blank" rel="noreferrer noopener">Nx</a> is supported too. The schematic asks about the name of the project in your workspace you want to enable module federation for. Also, it asks which port to assign for <code>ng serve</code>.</p><p>After that, it generates several files, e. g. a partial webpack configuration we need to adjust for our needs. Also, it registers the custom builder in our <code>angular<span>.</span>json</code>.</p><p>For the example used here, I ran this command twice: Once for the shell and once for the above-shown shipping micro frontend. The latter one is just called <code>mfe1</code> here.</p><h2 id="Configuring-the-Micro-Frontends">Configuring the Micro Frontends</h2><p>Now, we need to adjust the webpack configurations generated for the shell and the micro frontend. As the Angular CLI is generating most parts of the webpack configuration, we just need to define the remaining details for the module federation. First and foremost, this is about configuring the <code>ModuleFederationPlugin</code> that ships with webpack.</p><p>Let&#39;s start with the configuration for the micro frontend:</p><pre><code><span>// projects/mfe1/webpack.config.js</span>

<span>[</span><span>...</span><span>]</span>
plugins<span>:</span> <span>[</span>

  <span>new</span> <span>ModuleFederationPlugin</span><span>(</span><span>{</span>
    
      <span>// For remotes (please adjust)</span>
      name<span>:</span> <span>&#34;mfe1&#34;</span><span>,</span>
      filename<span>:</span> <span>&#34;remoteEntry.js&#34;</span><span>,</span>
      exposes<span>:</span> <span>{</span>
          <span>&#39;./AddressModule&#39;</span><span>:</span> <span>&#39;./projects/mfe1/src/app/address/address.module.ts&#39;</span><span>,</span>
      <span>}</span><span>,</span>        
      
      shared<span>:</span> <span>share</span><span>(</span><span>{</span>
        <span>&#34;@angular/core&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span> <span>}</span><span>,</span> 
        <span>&#34;@angular/common&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span> <span>}</span><span>,</span> 
        <span>&#34;@angular/common/http&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span> <span>}</span><span>,</span> 
        <span>&#34;@angular/router&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span> <span>}</span><span>,</span>
        <span>&#34;@angular/material&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span><span>,</span> includeSecondaries<span>:</span> <span>true</span> <span>}</span><span>,</span>

        <span>...</span>sharedMappings<span>.</span><span>getDescriptors</span><span>(</span><span>)</span>
      <span>}</span><span>)</span>
          
  <span>}</span><span>)</span><span>,</span>
<span>]</span><span>,</span>
<span>[</span><span>...</span><span>]</span></code></pre><p>The property <code>name</code> is normally the project name and should be unique across all micro frontends. The <code>filename</code> points to a file webpack generates when building the project. It&#39;s often referred to as the remote entry point. This JavaScript file provides all the metadata the shell needs to know for loading the micro frontend.</p><p>While normally you can go with the generated values for <code>name</code> and <code>filename</code>, you very likely need to adjust the <code>exposes</code> section. As discussed above, it contains the aliases for the files to expose.</p><p>With <code>shared</code>, you define all the npm packages you want to share across the shell and the micro frontends. These packages are only loaded once at runtime. This is vital because having ten micro frontends doesn&#39;t mean you want to load Angular or other packages ten times!</p><p>Of course, when sharing packages at runtime, we might end up with version conflicts. Fortunately, Module Federation also got us covered here: It provides several strategies for dealing with version mismatches. </p><p>In our case, the combination of <code>singleton<span>:</span> <span>true</span></code> and <code>strictVersion<span>:</span> <span>true</span></code> is used. Hence, only one version of the shared packages is allowed, and if Module Federation detects several versions at runtime, it throws an Error. While this seems to be quite harsh at first sight, it allows our integration tests to immediately find out about version mismatches.</p><p>More details on <a href="https://www.angulararchitects.io/en/aktuelles/getting-out-of-version-mismatch-hell-with-module-federation/" target="_blank" rel="noreferrer noopener">strategies for preventing version mismatches</a> can be found <a href="https://www.angulararchitects.io/en/aktuelles/getting-out-of-version-mismatch-hell-with-module-federation/" target="_blank" rel="noreferrer noopener">here</a>.</p><p>Besides <code>singleton</code> and <code>strictVersions</code>, there are two further properties used: <code>requiredVersion</code> and <code>includeSecondaries</code>. If we set the first one to <code>auto</code>, <code>@angular<span>-</span>architects<span>/</span>module<span>-</span>federation</code> assumes the version found in your project&#39;s <code><span>package</span><span>.</span>json</code>. This avoids several <a href="https://www.angulararchitects.io/aktuelles/pitfalls-with-module-federation-and-angular/" target="_blank" rel="noreferrer noopener">pitfalls</a>. </p><p>The option <code>includeSecondaries</code> is provided by <code>@angular<span>-</span>architects<span>/</span>module<span>-</span>federation</code> too. It automatically adds all secondary entry points to the list of shared libraries. In the case of libraries like Angular Material, this saves you a lot of typing as they provide one such entry point per component, e. g. <code>@angular<span>/</span>material<span>/</span>input</code> or <code>@angular<span>/</span>material<span>/</span>button</code>.</p><p>Now, let&#39;s have a look at the exposed <code>AddressModule</code>: </p><pre><code><span>// projects/mfe1/src/app/address/address.module.ts</span>

<span>[</span><span>...</span><span>]</span>

@<span>NgModule</span><span>(</span><span>{</span>
  imports<span>:</span> <span>[</span>
    <span>[</span><span>...</span><span>]</span>
    RouterModule<span>.</span><span>forChild</span><span>(</span><span>[</span><span>{</span>
      path<span>:</span> <span>&#39;address&#39;</span><span>,</span> 
      component<span>:</span> AddressComponent
    <span>}</span><span>]</span><span>)</span>  
  <span>]</span><span>,</span>
  declarations<span>:</span> <span>[</span>
    AddressComponent
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AddressModule</span> <span>{</span> <span>}</span></code></pre><p>As you see, it&#39;s just an ordinary Angular module. However, as it has child routes, we can immediately route to them after loading the whole module into the shell. </p><h2 id="Configuring-the-Shell">Configuring the Shell</h2><p>The shell&#39;s <code>webpack<span>.</span>config<span>.</span>js</code> is a bit simpler. Here, we only need to define the shared libraries:</p><pre><code><span>// projects/shell/webpack.config.js</span>

<span>[</span><span>...</span><span>]</span>
plugins<span>:</span> <span>[</span>
  <span>new</span> <span>ModuleFederationPlugin</span><span>(</span><span>{</span>

      shared<span>:</span> <span>share</span><span>(</span><span>{</span>
        <span>&#34;@angular/core&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span> <span>}</span><span>,</span> 
        <span>&#34;@angular/common&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span> <span>}</span><span>,</span> 
        <span>&#34;@angular/common/http&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span> <span>}</span><span>,</span> 
        <span>&#34;@angular/router&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span> <span>}</span><span>,</span>
        <span>&#34;@angular/material&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span><span>,</span> includeSecondaries<span>:</span> <span>true</span> <span>}</span>

        <span>...</span>sharedMappings<span>.</span><span>getDescriptors</span><span>(</span><span>)</span>
      <span>}</span><span>)</span>
      
  <span>}</span><span>)</span><span>,</span>
<span>]</span><span>,</span>
<span>[</span><span>...</span><span>]</span></code></pre><p>In addition, we also could map URLs here, as outlined above. This would look like this:</p><pre><code><span>// Alternative that maps URLs upfront</span>
<span>new</span> <span>ModuleFederationPlugin</span><span>(</span><span>{</span>
  remotes<span>:</span> <span>{</span>
    <span>&#34;mfe1&#34;</span><span>:</span> <span>&#34;mfe1@http://localhost:3000/remoteEntry.js&#34;</span>
  <span>}</span><span>,</span>
  <span>[</span><span>...</span><span>]</span>
<span>}</span><span>)</span></code></pre><p>The key is the mapped URL, and the value defines the name of the micro frontend as defined in its <code>webpack<span>.</span>config<span>.</span>js</code>. Here, the value also contains the location of the micro frontend&#39;s remote entry point. To load <code>mfe1</code>&#39;s exposed Module, we could use a dynamic <code><span>import</span></code>:</p><pre><code><span>// Using mapped URL:</span>
<span>import</span><span>(</span><span>&#39;mfe1/AddressModule&#39;</span><span>)</span></code></pre><p>As the TypeScript compiler doesn&#39;t know the file <code>mfe1<span>/</span>Module</code>, we also needed a type definition. For this, we could create an arbitrary with the ending <code><span>.</span>d<span>.</span>ts</code>:</p><pre><code><span>declare</span> <span>module</span> <span>&#34;mfe1/AddressModule&#34;</span><span>;</span></code></pre><p>However, while mapping URLs this way is simple, it also requires us to know about the micro frontends and their locations upfront. Hence, I&#39;m using a more dynamic approach that does not demand us to define URLs for compile time. </p><p>Instead, we can tell Module Federation about possible Micro Frontends at runtime. To make use of it, I use the helper function <code>loadRemoteModule</code> provided by <code>@angular<span>-</span>architects<span>/</span>module<span>-</span>federation</code> together with lazy routes:</p><pre><code><span>// projects/shell/src/app/app.module.ts</span>

<span>[</span><span>...</span><span>]</span>
RouterModule<span>.</span><span>forRoot</span><span>(</span><span>[</span>
  <span>{</span>
    path<span>:</span> <span>&#39;&#39;</span><span>,</span>
    component<span>:</span> HomeComponent
  <span>}</span><span>,</span>
  <span>{</span>
    path<span>:</span> <span>&#39;mfe1&#39;</span><span>,</span>
    <span>loadChildren</span><span>:</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>loadRemoteModule</span><span>(</span><span>{</span>
      remoteEntry<span>:</span> <span>&#39;http://localhost:3000/remoteEntry.js&#39;</span><span>,</span>
      remoteName<span>:</span> <span>&#39;mfe1&#39;</span><span>,</span>
      exposedModule<span>:</span> <span>&#39;./AddressModule&#39;</span><span>,</span>
    <span>}</span><span>)</span><span>.</span><span>then</span><span>(</span>m <span>=&gt;</span> m<span>.</span>AddressModule<span>)</span>
  <span>}</span>
<span>]</span><span>)</span>
<span>[</span><span>...</span><span>]</span></code></pre><p>The <code>loadRemoteModule</code> function takes the location of the remote entry point, the remote&#39;s name, and the alias of the exposed EcmaScript module. All these values are defined in the micro frontend&#39;s webpack configuration. </p><p>As these properties are just strings, we could even retrieve their values from a configuration file or from a service endpoint.</p><h2 id="Trying-It-Out">Trying It Out</h2><p>After starting both projects, e. g. with <code>ng serve shell<span>,</span></code> and <code>ng serve mfe1</code>, we can use the lazy route shown above to load the micro frontend into the shell. It&#39;s also interesting to inspect the loaded files in your browser&#39;s dev tools:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5YzAFolOzvMYTspPsgZ5Wb/73d1fb9772e1128fca2eca404a1aa0ce/share.png" alt="The browser loads the shared libraries"/></p><p>At first sight, it really looks like lazy loading. However, when looking more closely, we see that the lazy chunks come from the micro frontend&#39;s origin. Also, for all the shared libraries, a bundle of its own is loaded. This is necessary because the module federation decides at runtime when to load which shared package. </p><h2 id="Authentication-for-Micro-Frontends">Authentication for Micro Frontends</h2><p>Sometimes we need to share some information between micro frontends and the shell, e. g. context information like the current user or global filters like the selected customer. The example used here allows logging in the user via the shell:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2XumqnUE2Cp56cB0nWJt2w/37480acbfca69c8036e36d38b94fbcd2/logged-in.png" alt="Logging in the current user"/></p><p>However, when loading the micro frontend on demand, it also knows about the current user:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2BdJ84YhuAxliC349B9A2Q/6294f33fd3d8b940789da984d41efe8c/logged-in-shipping.png" alt="Sharing information about the logged in user"/></p><p>To achieve this, we just need to share a package that holds the information to share. In our case, this is <code>@auth0<span>/</span>auth0<span>-</span>angular</code> as we are using Auth0 as our identity provider. It&#39;s available via npm:</p><pre><code><span>npm</span> i @auth0/auth0-angular</code></pre><p>To make this work, I&#39;ve configured a web application at <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">https://manage.auth0.com/</a>. If you want to try this out, don&#39;t forget to register your SPA&#39;s URL, e. g. <a href="http://localhost:4200" target="_blank" rel="noreferrer noopener">http://localhost:4200</a>, under <em>Allowed Callback URLs</em>. Besides this, I went with the default values proposed by the web portal.</p><p>To get started, we need to import the <code>AuthModule</code> provided by <code>@auth0<span>/</span>auth0<span>-</span>angular</code> into the <code>shell</code>&#39;s but also into <code>mfe1</code>&#39;s <code>AppModule</code>:</p><pre><code><span>// projects/shell/src/app/app.module.ts</span>
<span>//  and</span>
<span>// projects/mfe1/src/app/app.module.ts</span>

<span>[</span><span>...</span><span>]</span>

<span>import</span> <span>{</span> AuthModule <span>}</span> <span>from</span> <span>&#39;@auth0/auth0-angular&#39;</span><span>;</span>

<span>[</span><span>...</span><span>]</span>

@<span>NgModule</span><span>(</span><span>{</span>
  imports<span>:</span> <span>[</span>
    AuthModule<span>.</span><span>forRoot</span><span>(</span><span>{</span>
      domain<span>:</span> <span>&#39;dev-ha-6vf7s.us.auth0.com&#39;</span><span>,</span>
      clientId<span>:</span> <span>&#39;pQXuZGn3bfOfHpFd9ch7Wfa4xP4KhKlS&#39;</span>
    <span>}</span><span>)</span><span>,</span>
    <span>[</span><span>...</span><span>]</span>
  <span>]</span><span>,</span>
  <span>[</span><span>...</span><span>]</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppModule</span> <span>{</span> <span>}</span></code></pre><p>The values for <code>domain</code> and <code>clientId</code> can be found at <a href="https://manage.auth0.com" target="_blank" rel="noreferrer noopener">https://manage.auth0.com</a> after registering your application.</p><p>After that, we can use the <code>AuthService</code> in the shell to login the current user:</p><pre><code><span>// projects/shell/src/app/home/home.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#39;@angular/core&#39;</span><span>;</span>
<span>import</span> <span>{</span> AuthService <span>}</span> <span>from</span> <span>&#39;@auth0/auth0-angular&#39;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#39;app-home&#39;</span><span>,</span>
  templateUrl<span>:</span> <span>&#39;./home.component.html&#39;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#39;./home.component.scss&#39;</span><span>]</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>HomeComponent</span> <span>{</span>

  user$ <span>=</span> <span>this</span><span>.</span>auth<span>.</span>user$<span>;</span>

  <span>constructor</span><span>(</span><span>private</span> auth<span>:</span> AuthService<span>)</span> <span>{</span><span>}</span>

  <span>login</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>auth<span>.</span><span>loginWithRedirect</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

<span>}</span></code></pre><p>I also decided to display the user&#39;s name after they logged in:  </p><pre><code><span>&lt;!-- 
  projects/shell/src/app/home/home.component.html
--&gt;</span>

<span><span><span>&lt;</span>h1</span><span>&gt;</span></span>Welcome!<span><span><span>&lt;/</span>h1</span><span>&gt;</span></span>

<span><span><span>&lt;</span>p</span> <span>*ngIf</span><span><span>=</span><span>&#34;</span>user$ | async as user<span>&#34;</span></span><span>&gt;</span></span>
    User: {{user.name}}
<span><span><span>&lt;/</span>p</span><span>&gt;</span></span>

<span><span><span>&lt;</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>button</span> <span>(click)</span><span><span>=</span><span>&#34;</span>login()<span>&#34;</span></span> <span>mat-flat-button</span> <span>color</span><span><span>=</span><span>&#34;</span>primary<span>&#34;</span></span><span>&gt;</span></span>Login<span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span></code></pre><p>In the micro frontend&#39;s <code>AddressComponent</code>, I&#39;m also using the <code>AuthService</code> to get some information about the current user:</p><pre><code><span>// projects/mfe1/src/app/address/address.component.ts</span>

<span>[</span><span>...</span><span>]</span>

<span>import</span> <span>{</span> AuthService <span>}</span> <span>from</span> <span>&#39;@auth0/auth0-angular&#39;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#39;app-address&#39;</span><span>,</span>
  templateUrl<span>:</span> <span>&#39;./address.component.html&#39;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#39;./address.component.scss&#39;</span><span>]</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AddressComponent</span> <span>{</span>

  <span>[</span><span>...</span><span>]</span>

  <span>constructor</span><span>(</span>
    <span>private</span> auth<span>:</span> AuthService<span>,</span>
    <span>private</span> fb<span>:</span> FormBuilder<span>)</span> <span>{</span>

    <span>this</span><span>.</span>auth<span>.</span>user$<span>.</span><span>pipe</span><span>(</span><span>take</span><span>(</span><span>1</span><span>)</span><span>)</span><span>.</span><span>subscribe</span><span>(</span>user <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span><span>!</span>user<span>)</span> <span>return</span><span>;</span>
      <span>this</span><span>.</span>addressForm<span>.</span>controls<span>[</span><span>&#39;firstName&#39;</span><span>]</span><span>.</span><span>setValue</span><span>(</span>user<span>.</span>given_name<span>)</span><span>;</span>
      <span>this</span><span>.</span>addressForm<span>.</span>controls<span>[</span><span>&#39;lastName&#39;</span><span>]</span><span>.</span><span>setValue</span><span>(</span>user<span>.</span>family_name<span>)</span><span>;</span>

    <span>}</span><span>)</span><span>;</span>

  <span>}</span>

  <span>[</span><span>...</span><span>]</span>
<span>}</span></code></pre><p>In order to make this work, we need to share the <code>@auth0<span>/</span>auth0<span>-</span>angular</code> package:</p><pre><code><span>// projects/shell/webpack.config.js</span>
<span>//  AND</span>
<span>// projects/mfe1/webpack.config.js</span>

<span>[</span><span>...</span><span>]</span>
shared<span>:</span> <span>share</span><span>(</span><span>{</span>
  <span>[</span><span>...</span><span>]</span>
  
  <span>// Add this:</span>
  <span>&#34;@auth0/auth0-angular&#34;</span><span>:</span> <span>{</span> singleton<span>:</span> <span>true</span><span>,</span> strictVersion<span>:</span> <span>true</span><span>,</span> requiredVersion<span>:</span> <span>&#39;auto&#39;</span> <span>}</span><span>,</span>

  <span>...</span>sharedMappings<span>.</span><span>getDescriptors</span><span>(</span><span>)</span>
<span>}</span><span>)</span>
<span>[</span><span>...</span><span>]</span></code></pre><p>This ensures there is only one <code>AuthService</code> at runtime we can use to share information about the current user. </p><p>After changing the webpack configuration, we need to restart our applications. If everything works well, we can log in the user via the shell and read the user&#39;s name in the lazy loaded micro frontend.</p><h2 id="Summary">Summary</h2><p>Module Federation allows loading separately compiled applications at runtime. Also, we can share common dependencies. This also allows sharing common data like information on the current user or global filters.</p><p>As Module Federation allows runtime integration, it is also the key for plugin systems and micro frontend architectures. However, this approach turns to compile-time dependencies into runtime dependencies; we need a sound set of integration tests to detect issues. </p><p>In general, Micro Frontends only makes sense if you want to scale a project by splitting it into several smaller applications developed by different autarkic teams. If you only have one frontend team, Micro Frontend architectures are very likely an overhead.</p></div></div>]]></content:encoded>
      <author>Manfred Steyer</author>
      <pubDate>Wed, 02 Feb 2022 15:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Security Best Practices in iOS</title>
      <link>https://auth0.com/blog/security-best-practices-in-ios/</link>
      <description>Take a look at techniques that you can use right now to make your iOS apps more secure.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR</strong>: Nowadays, we use our smartphones to do almost everything, from sending a simple email to making a wire transfer. Those tasks are performed over the internet, which means that you&#39;re exposed to possible security attacks.</p><p>You need to understand that security risks are always going to exist, and you can never make your software 100% secure. What you can do is mitigate those risks and reduce them as much as possible.</p><p>As a mobile developer, you should try to make your application as secure as possible. Imagine that you&#39;re building an application for a bank institution. What happens to your client&#39;s reputation if a security breach occurs? And what about your client&#39;s customers? Imagine someone using a preventable security leak to steal their money.</p><p>Let&#39;s go over some techniques that you could start applying right now to make your mobile applications a little more secure.</p><h2 id="What-Should-You-Pay-Attention-To-">What Should You Pay Attention To?</h2><p>As a developer, there are four major subjects that you must check when you&#39;re developing an iOS application:</p><ol start="1"><li>Data storage</li><li>Data communications channels</li><li>Jailbroken devices</li><li>Development techniques</li></ol><p>I‚Äôll cover each of these below.</p><h3 id="Data-storage">Data storage</h3><p>Depending on the information you&#39;re storing, you&#39;ll need to use different mechanisms to increase your application&#39;s security level.</p><h4 id="App-files">App files</h4><p>If you need to save files in your app&#39;s directory, you should use the built-in <a href="https://developer.apple.com/documentation/uikit/protecting_the_user_s_privacy/encrypting_your_app_s_files#2928957" target="_blank" rel="noreferrer noopener">Data Protection API</a> feature. This feature allows you to specify a level of protection for a file. If the user sets and uses a device passcode, Data Protection will be automatically enabled.</p><p>There are four levels of Data Protection available:</p><ul><li>No protection. The file is always accessible.</li><li>Complete until first user authentication. This is the default value. The file will remain encrypted until the user unlocks the device for the first time. After that, the file will be accessible until the device shuts down or reboots.</li><li>Complete unless open. The file will remain encrypted until the application opens the file, and the application can open files only while the device is unlocked. Open files are accessible even when the device is locked. New files can be created and accessed whether the device is locked or unlocked.</li><li>Complete. The file will remain encrypted until the user unlocks the device and becomes encrypted when the user locks it.</li></ul><p>You&#39;ve got two options to set the encryption level for a file:</p><p>Option 1: Using the <code><span>[</span></code> method. With this, you can create a file and assign it a protection level all at once:</p><pre><code><span>do</span> <span>{</span>
  <span>try</span> data<span>.</span><span>write</span><span>(</span>to<span>:</span> fileURL<span>,</span> options<span>:</span> <span>.</span>completeFileProtection<span>)</span>
<span>}</span> <span>catch</span> <span>{</span>
  <span>// Handle errors.</span>
<span>}</span></code></pre><p>You can check out the encryption options <a href="https://developer.apple.com/documentation/foundation/nsdata/writingoptions" target="_blank" rel="noreferrer noopener">here</a>.</p><p>Option 2: Setting the data protection level for an existing file using the <code><span>[</span></code> method:</p><pre><code><span>do</span> <span>{</span>
  <span>try</span> <span>(</span>fileURL <span>as</span> <span>NSURL</span><span>)</span>
    <span>.</span><span>setResourceValue</span><span>(</span>
      URLFileProtection<span>.</span>complete<span>,</span>
      forKey<span>:</span> <span>.</span>fileProtectionKey
    <span>)</span>
  <span>}</span> <span>catch</span> <span>{</span>
    <span>// Handle errors.</span>
<span>}</span></code></pre><h4 id="UserDefaults">UserDefaults</h4><p>Sometimes you need to store some user preferences. For example, the user might want the sign-in screen to remember them. You‚Äôll want to persist this kind of information between application launches.</p><p>Through the use of the <code><span>[</span></code> class, Apple gives us an easy way to save and retrieve information as key-value pairs.</p><pre><code><span>// Save the boolean value `true` under the key `rememberUser`</span>
UserDefaults<span>.</span>standard<span>.</span><span>set</span><span>(</span><span>true</span><span>,</span> forKey<span>:</span> <span>&#34;rememberUser&#34;</span><span>)</span>

<span>// Retrieve the boolean value stored under the key `rememberUser`</span>
<span>let</span> rememberUser <span>=</span> UserDefaults<span>.</span>standard<span>.</span><span>bool</span><span>(</span>forKey<span>:</span> <span>&#34;rememberUser&#34;</span><span>)</span></code></pre><p>The problem is that it‚Äôs too easy to use <code>UserDefaults</code>. This ease of use can mean that you might end up using it to store sensitive information ‚Äî such as API tokens, for instance.</p><p>You should never use <code>UserDefaults</code> to store data that could compromise your application. When using <code>UserDefaults</code> to store some piece of data, ask yourself: &#34;What could happen if someone accessed the information in UserDefaults?&#34; If any of the answers mean that your application could be breached, you shouldn&#39;t store that data in <code>UserDefaults</code>.</p><h4 id="Keychain">Keychain</h4><p>If you need to store sensitive data, use <a href="https://developer.apple.com/documentation/security/keychain_services" target="_blank" rel="noreferrer noopener">Keychain Services</a>. Unlike UserDefaults, the data stored in the keychain is automatically encrypted.</p><p>With the keychain, you don&#39;t need to save encryption keys. Every application has its own isolated keychain section that other applications can‚Äôt access.</p><p>In addition, you can choose from these keychains:</p><p>The local keychain, which is available only on the device. The user‚Äôs iCloud keychain, which synchronizes with all the devices registered with the same Apple ID.</p><p>You can also specify security policies for the data stored in the keychain. For example, you could require FaceID to access the data.</p><p>The bad news is that the keychain API is not as simple as the <code>UserDefaults</code> API. This is why many developers end up relying on <code>UserDefaults</code>, even when storing sensitive data.</p><p>You&#39;ll need to use the <code><span>[</span></code> method to add a new item into the keychain, and <code><span>[</span></code> to retrieve items.</p><h3 id="Data-communications-channels">Data communications channels</h3><p>When developing an application, the next subject you must look at is how you communicate with the services outside your application. There&#39;s no point in securing all the data storage-related stuff if it‚Äôs easy to capture the information you send to your back end.</p><h4 id="App-transport-security">App transport security</h4><p>This feature improves the network security between your application and the outside world and has been available since iOS 9. <a href="https://developer.apple.com/documentation/bundleresources/information_property_list/nsapptransportsecurity" target="_blank" rel="noreferrer noopener">App Transport Security (ATS)</a> blocks insecure connections by default, requiring you to use HTTPS rather than HTTP.</p><p>Although it‚Äôs highly recommended to leave ATS enabled, you can disable it for specific domains if you want, which allows you to access HTTP domains. You can specify these unsecured domains in the <code>info<span>.</span>plist</code> file.</p><h4 id="SSL-certificate-pinning">SSL certificate pinning</h4><p>When making connections to a server over HTTPS, iOS checks the validity of the server‚Äôs certificate. For a certificate to be valid, it has to be issued by a valid Certificate Authority (CA).</p><p>Certificates do a decent job preventing <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noreferrer noopener">monkey-in-the-middle attacks</a>, but they‚Äôre not a perfect solution. Hackers can still bypass them with self-signed certificates or hacking a root CA certificate.</p><p>To prevent this problem, you have a couple of options:</p><ul><li>Download your server&#39;s certificate and store it in your application. When the app connects to the server and presents its certificate, compare it with the one stored in your application.</li><li>Store the public key for the server&#39;s certificate in your application&#39;s code. When the app connects to the server and presents its certificate, compare its public key with the one stored in your application.</li></ul><h3 id="Jailbroken-Devices">Jailbroken Devices</h3><p>For iOS devices, <a href="https://en.wikipedia.org/wiki/IOS_jailbreaking" target="_blank" rel="noreferrer noopener">jailbreaking</a> gives the OS unauthorized privileges and root user access. It allows you to perform actions that wouldn‚Äôt otherwise be possible.</p><p>Every iOS application that we want to distribute needs to go through the App Store. This allows Apple to inspect and approve apps and reduces the odds that users will install <a href="https://en.wikipedia.org/wiki/Malware" target="_blank" rel="noreferrer noopener">malware</a>.</p><p>The App Store is supposed to be the only source for apps. However, jailbreaking allows users to download non-approved apps from alternatives to the App Store, such as <a href="https://en.wikipedia.org/wiki/Cydia" target="_blank" rel="noreferrer noopener">Cydia</a>.</p><p>How does this impact you as a developer? A jailbroken device can run unauthorized apps to hack into your applications.</p><p>You should consider having your app check the device for jailbreaking. You can do so with this code:</p><pre><code><span>import</span> Foundation
<span>import</span> UIKit

extension UIDevice <span>{</span>
  <span>var</span> isSimulator<span>:</span> Bool <span>{</span>
    <span>return</span> <span>TARGET_OS_SIMULATOR</span> <span>!=</span> <span>0</span>
  <span>}</span>


  <span>var</span> isJailBroken<span>:</span> Bool <span>{</span>
    <span>if</span> UIDevice<span>.</span>current<span>.</span>isSimulator <span>{</span> <span>return</span> <span>false</span> <span>}</span>
    <span>if</span> JailBrokenHelper<span>.</span><span>hasCydiaInstalled</span><span>(</span><span>)</span> <span>{</span> <span>return</span> <span>true</span> <span>}</span>
    <span>if</span> JailBrokenHelper<span>.</span><span>containsSuspiciousApps</span><span>(</span><span>)</span> <span>{</span> <span>return</span> <span>true</span> <span>}</span>
    <span>if</span> JailBrokenHelper<span>.</span><span>hasSuspiciousSystemPaths</span><span>(</span><span>)</span> <span>{</span> <span>return</span> <span>true</span> <span>}</span>
    <span>return</span> JailBrokenHelper<span>.</span><span>canEditSystemFiles</span><span>(</span><span>)</span>
  <span>}</span>
<span>}</span>

<span>private</span> struct JailBrokenHelper <span>{</span>
  <span>static</span> func <span>hasCydiaInstalled</span><span>(</span><span>)</span> <span>-</span><span>&gt;</span> Bool <span>{</span>
    <span>return</span> UIApplication<span>.</span>shared<span>.</span><span>canOpenURL</span><span>(</span><span>URL</span><span>(</span>string<span>:</span> <span>&#34;cydia://package/com.example.package&#34;</span><span>)</span><span>!</span><span>)</span>
  <span>}</span>


  <span>static</span> func <span>containsSuspiciousApps</span><span>(</span><span>)</span> <span>-</span><span>&gt;</span> Bool <span>{</span>
    <span>for</span> path <span>in</span> suspiciousAppsPathToCheck <span>{</span>
      <span>if</span> FileManager<span>.</span>default<span>.</span><span>fileExists</span><span>(</span><span>atPath<span>:</span> path</span><span>)</span> <span>{</span>
        <span>return</span> <span>true</span>
      <span>}</span>
    <span>}</span>
    <span>return</span> <span>false</span>
  <span>}</span>


  <span>static</span> func <span>hasSuspiciousSystemPaths</span><span>(</span><span>)</span> <span>-</span><span>&gt;</span> Bool <span>{</span>
    <span>for</span> path <span>in</span> suspiciousSystemPathsToCheck <span>{</span>
      <span>if</span> FileManager<span>.</span>default<span>.</span><span>fileExists</span><span>(</span><span>atPath<span>:</span> path</span><span>)</span> <span>{</span>
        <span>return</span> <span>true</span>
      <span>}</span>
    <span>}</span>
    <span>return</span> <span>false</span>
  <span>}</span>


  <span>static</span> func <span>canEditSystemFiles</span><span>(</span><span>)</span> <span>-</span><span>&gt;</span> Bool <span>{</span>
    <span>let</span> jailBreakText <span>=</span> <span>&#34;Developer Insider&#34;</span>
      <span>do</span> <span>{</span>
        <span>try</span> jailBreakText<span>.</span><span>write</span><span>(</span>toFile<span>:</span> <span>&#34;/private/jailbreak.txt&#34;</span><span>,</span> atomically<span>:</span> <span>true</span><span>,</span> encoding<span>:</span> <span>.</span>utf8<span>)</span>
        <span>return</span> <span>true</span>
      <span>}</span> <span>catch</span> <span>{</span>
        <span>return</span> <span>false</span>
      <span>}</span>
    <span>}</span>


  <span>/**
   Add more paths here to check for jail break
  */</span>
  <span>static</span> <span>var</span> suspiciousAppsPathToCheck<span>:</span> <span>[</span>String<span>]</span> <span>{</span>
    <span>return</span> <span>[</span>
      <span>&#34;/Applications/Cydia.app&#34;</span><span>,</span>
      <span>&#34;/Applications/blackra1n.app&#34;</span><span>,</span>
      <span>&#34;/Applications/FakeCarrier.app&#34;</span><span>,</span>
      <span>&#34;/Applications/Icy.app&#34;</span><span>,</span>
      <span>&#34;/Applications/IntelliScreen.app&#34;</span><span>,</span>
      <span>&#34;/Applications/MxTube.app&#34;</span><span>,</span>
      <span>&#34;/Applications/RockApp.app&#34;</span><span>,</span>
      <span>&#34;/Applications/SBSettings.app&#34;</span><span>,</span>
      <span>&#34;/Applications/WinterBoard.app&#34;</span><span>,</span>
      <span>&#34;/Applications/LibertyLite.app&#34;</span>
    <span>]</span>
  <span>}</span>


  <span>static</span> <span>var</span> suspiciousSystemPathsToCheck<span>:</span> <span>[</span>String<span>]</span> <span>{</span>
    <span>return</span> <span>[</span>
      <span>&#34;/Library/MobileSubstrate/DynamicLibraries/LiveClock.plist&#34;</span><span>,</span>
      <span>&#34;/Library/MobileSubstrate/DynamicLibraries/Veency.plist&#34;</span><span>,</span>
      <span>&#34;/Library/MobileSubstrate/MobileSubstrate.dylib&#34;</span><span>,</span>
      <span>&#34;/System/Library/LaunchDaemons/com.ikey.bbot.plist&#34;</span><span>,</span>
      <span>&#34;/System/Library/LaunchDaemons/com.saurik.Cydia.Startup.plist&#34;</span><span>,</span>
      <span>&#34;/bin/bash&#34;</span><span>,</span>
      <span>&#34;/bin/sh&#34;</span><span>,</span>
      <span>&#34;/etc/apt&#34;</span><span>,</span>
      <span>&#34;/etc/ssh/sshd_config&#34;</span><span>,</span>
      <span>&#34;/private/var/tmp/cydia.log&#34;</span><span>,</span>
      <span>&#34;/var/tmp/cydia.log&#34;</span><span>,</span>
      <span>&#34;/usr/bin/sshd&#34;</span><span>,</span>
      <span>&#34;/usr/libexec/sftp-server&#34;</span><span>,</span>
      <span>&#34;/usr/libexec/ssh-keysign&#34;</span><span>,</span>
      <span>&#34;/usr/sbin/sshd&#34;</span><span>,</span>
      <span>&#34;/var/cache/apt&#34;</span><span>,</span>
      <span>&#34;/var/lib/apt&#34;</span><span>,</span>
      <span>&#34;/var/lib/cydia&#34;</span><span>,</span>
      <span>&#34;/usr/sbin/frida-server&#34;</span><span>,</span>
      <span>&#34;/usr/bin/cycript&#34;</span><span>,</span>
      <span>&#34;/usr/local/bin/cycript&#34;</span><span>,</span>
      <span>&#34;/usr/lib/libcycript.dylib&#34;</span><span>,</span>
      <span>&#34;/var/log/syslog&#34;</span><span>,</span>
      <span>&#34;/private/var/lib/apt&#34;</span><span>,</span>
      <span>&#34;/private/var/lib/cydia&#34;</span><span>,</span>
      <span>&#34;/private/var/mobile/Library/SBSettings/Themes&#34;</span><span>,</span>
      <span>&#34;/private/var/stash&#34;</span>
    <span>]</span>
  <span>}</span>
<span>}</span></code></pre><p>Please be aware that this is not a foolproof way to detect jailbreaking on a device. Security is an active field, and new malware is released every day. You need to stay up to date and add to the code above as new vulnerabilities appear.</p><h3 id="Development-techniques">Development techniques</h3><p>You can also incorporate techniques to prevent your code from giving away information to malicious parties.</p><h4 id="Printing-logs">Printing logs</h4><p>Developers often call the  <code><span>print</span><span>(</span><span>)</span></code> function for debugging. The problem is that they can forget to remove these calls, which might contain some information that an attacker could use to breach your security.</p><p>A good practice is to use compiler flags so that  <code><span>print</span><span>(</span><span>)</span></code> works only in debug mode:</p><pre><code>#<span>if</span> <span>DEBUG</span>
<span>print</span><span>(</span><span>&#34;Log&#34;</span><span>)</span>
#endif</code></pre><h4 id="Environment-files">Environment files</h4><p>Another part of your application that you should review is the environment information. Many developers overlook this, even though it could contain sensitive information such as your API URL, API keys, and so on.</p><p>By default, Apple does a decent job obfuscating your code when compiling to upload it to the App Store. In spite of this, it‚Äôs still possible for a hacker to reverse-engineer the environment information.</p><p>You should never leave this type of information hardcoded. Instead, you should use configuration files (such as <code><span>.</span>plist</code> files, for example), and you should never commit them to your repository.</p><h2 id="Apple-CryptoKit">Apple CryptoKit</h2><p><a href="https://developer.apple.com/documentation/cryptokit" target="_blank" rel="noreferrer noopener">CryptoKit</a> was presented at <a href="https://developer.apple.com/videos/play/wwdc2019/709/" target="_blank" rel="noreferrer noopener">WWDC2019</a> as the new framework to perform cryptographic operations in iOS. It includes the most popular encryption and hashing algorithms. Let&#39;s take a look at some of CryptoKit‚Äôs features.</p><h3 id="Hashing">Hashing</h3><p>A hash function takes an input of any size and returns an output of a fixed size called a digest or hash. Keep these in mind when thinking about hash functions:</p><ul><li>They‚Äôre not reversible. You can‚Äôt compute a hash function‚Äôs original input from the resulting digest.</li><li>If you feed two different inputs X and Y into the same hash function and both produce the same digest Z, X and Y are the same (except in incredibly rare cases).</li></ul><p>Here‚Äôs how you can use hash functions to send a message to a friend and confirm it hasn‚Äôt been altered by a third party:</p><ol start="1"><li>You enter the message into a hash function to produce a digest.</li><li>You send the message along with the digest.</li><li>Your friend receives the message with the digest.</li><li>Your friend applies the same hash function to the message.</li><li>If resulting digest matches the one you sent with the message, your friend can be assured that the message wasn&#39;t compromised.</li></ol><p>CryptoKit features these three hash functions: <a href="https://developer.apple.com/documentation/cryptokit/sha256" target="_blank" rel="noreferrer noopener">SHA256</a>, <a href="https://developer.apple.com/documentation/cryptokit/sha384" target="_blank" rel="noreferrer noopener">SHA384</a>, and <a href="https://developer.apple.com/documentation/cryptokit/sha512" target="_blank" rel="noreferrer noopener">SHA512</a>. Here‚Äôs how you use these functions:</p><pre><code><span>import</span> CryptoKit

<span>let</span> dataToHash <span>=</span> <span>&#34;Hash test&#34;</span><span>.</span><span>data</span><span>(</span>using<span>:</span> <span>.</span>utf8<span>)</span><span>!</span>
<span>let</span> sha256Hash <span>=</span> <span>SHA256</span><span>.</span><span>hash</span><span>(</span>data<span>:</span> dataToHash<span>)</span>
<span>let</span> sha384Hash <span>=</span> <span>SHA284</span><span>.</span><span>hash</span><span>(</span>data<span>:</span> dataToHash<span>)</span>
<span>let</span> sha512Hash <span>=</span> <span>SHA512</span><span>.</span><span>hash</span><span>(</span>data<span>:</span> dataToHash<span>)</span></code></pre><h3 id="Authentication-Data">Authentication Data</h3><p>You may need to make sure that the person communicating with you is who they claim to be. You can use <a href="https://en.wikipedia.org/wiki/Message_authentication_code" target="_blank" rel="noreferrer noopener">Message Authentication Code (MAC)</a>, which is additional information attached to the message that authenticates the sender and confirms the message&#39;s integrity as well.</p><p>CryptoKit implements MAC as <a href="https://en.wikipedia.org/wiki/HMAC" target="_blank" rel="noreferrer noopener">Hash Message Authentication Code (HMAC)</a>, a type of MAC that uses a symmetric key to generate the code.</p><p>Here‚Äôs an example of CryptoKit‚Äôs HMAC in use:</p><pre><code><span>import</span> CryptoKit

<span>let</span> key <span>=</span> <span>SymmetricKey</span><span>(</span>size<span>:</span> <span>.</span>bits256<span>)</span> <span>// 1</span>

<span>// Sender side</span>
<span>let</span> message <span>=</span> <span>&#34;Hi John, how are you?&#34;</span><span>.</span><span>data</span><span>(</span>using<span>:</span> <span>.</span>utf8<span>)</span><span>!</span> <span>// 2</span>
<span>let</span> hmacCode <span>=</span> <span>HMAC</span><span>&lt;</span><span>SHA256</span><span>&gt;</span><span>.</span><span>authenticationCode</span><span>(</span><span>for</span><span>:</span> message<span>,</span> using<span>:</span> key<span>)</span> <span>// 3</span>

<span>// Receiver side</span>
<span>let</span> hmacCodeData <span>=</span> <span>Data</span><span>(</span>hmacCode<span>)</span> <span>// 4</span>
<span>if</span> <span>HMAC</span><span>&lt;</span><span>SHA256</span><span>&gt;</span><span>.</span><span>isValidAuthenticationCode</span><span>(</span> <span>// 5</span>
  hmacCodeData<span>,</span>
  authenticating<span>:</span> message<span>,</span>
  using<span>:</span> key<span>)</span> <span>{</span>
  <span>print</span><span>(</span><span>&#34;MAC code is valid!&#34;</span><span>)</span>
<span>}</span></code></pre><p>Here‚Äôs what‚Äôs happening at the numbered comments in the code above:</p><ol start="1"><li>Generate a new random key. This key must be shared between the sender and receiver.</li><li>Create the message.</li><li>Generate a new HMAC using the SHA256 hash function.</li><li>Generate a <code>Data</code> instance from the HMAC received.</li><li>Check if the HMAC received is valid.</li></ol><h3 id="Encryption">Encryption</h3><p>If you need to send sensitive data to the server, you should encrypt it first. CryptoKit provides two encryption options:</p><ul><li><a href="https://developer.apple.com/documentation/cryptokit/aes" target="_blank" rel="noreferrer noopener">AES</a>, short for <a href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard" target="_blank" rel="noreferrer noopener">Advanced Encryption Standard</a>, which has been adopted by the U.S. Government.</li><li><a href="https://developer.apple.com/documentation/cryptokit/chachapoly" target="_blank" rel="noreferrer noopener">ChaChaPoly</a>, a combination of <a href="https://en.wikipedia.org/wiki/Salsa20#ChaCha_variant" target="_blank" rel="noreferrer noopener">ChaCha</a> encryption and the <a href="https://en.wikipedia.org/wiki/Poly1305" target="_blank" rel="noreferrer noopener">Poly1305</a> MAC.</li></ul><p>Here‚Äôs an example of ChaChaPoly in use:</p><pre><code><span>import</span> CryptoKit

<span>let</span> key <span>=</span> <span>SymmetricKey</span><span>(</span>size<span>:</span> <span>.</span>bits256<span>)</span> <span>// 1</span>

<span>let</span> message <span>=</span> <span>&#34;Hi John, how are you?&#34;</span><span>.</span><span>data</span><span>(</span>using<span>:</span> <span>.</span>utf8<span>)</span><span>!</span> <span>// 2</span>

<span>let</span> encryptedMessage <span>=</span> <span>try</span><span>!</span> ChaChaPoly<span>.</span><span>seal</span><span>(</span>message<span>,</span> using<span>:</span> key<span>)</span> <span>// 3</span>
<span>let</span> sealedBox <span>=</span> <span>try</span><span>!</span> ChaChaPoly<span>.</span><span>SealedBox</span><span>(</span>combined<span>:</span> encryptedMessage<span>.</span>combined<span>)</span> <span>// 4</span>

<span>let</span> decryptedMessage <span>=</span> <span>try</span><span>!</span> ChaChaPoly<span>.</span><span>open</span><span>(</span>sealedBox<span>,</span> using<span>:</span> key<span>)</span> <span>// 5</span>

<span>assert</span><span>(</span>message <span>==</span> decryptedMessage<span>)</span></code></pre><p>Here‚Äôs what‚Äôs happening at the numbered comments in the code above:</p><ol start="1"><li>Generate a new encryption/decryption key. The application and server share this key.</li><li>Create the message.</li><li>Encrypt the message using ChaChaPoly and the shared key.</li><li>Seal the encrypted message. This function will return a <code>SealedBox</code> struct that contains:
 <ul><li>A <em>nonce</em>: A random value used only once during a cryptographic operation in order to prevent <a href="https://en.wikipedia.org/wiki/Replay_attack" target="_blank" rel="noreferrer noopener">replay attacks</a>. ‚ÄúNonce‚Äù is derived from the phrase ‚Äúnumber once‚Äù. If you don‚Äôt provide a nonce value to the <code><span>seal</span><span>(</span><span>)</span></code> function, CryptoKit will automatically generate a value for you.</li><li>ciphertext: The encrypted message.</li><li>tag: An authentication tag to ensure that the message wasn&#39;t modified in transit.</li><li>combine: A combination of all three previous values ‚Äî nonce, ciphertext, and tag.</li></ul></li><li>Open the sealed box containing the encrypted message using the shared key.</li></ol><h3 id="Key-Agreement">Key Agreement</h3><p>If you have an architecture where you communicate with multiple peers, sharing a private secret might not be a good solution. You will need to generate a new key for each one, and every time you add a peer to the system, you must generate a new key and deploy a new version of your application.</p><p>A key agreement using public keys is the best solution for these cases. Each node of the network will have a public key that everyone else will know. And, from that public key, you will generate a symmetric key to cipher your data. Then, the other part will do the same with your public key.</p><p>Here‚Äôs an example implementation of key agreement featuring two peers, ‚ÄúPeter‚Äù and ‚ÄúJane‚Äù:</p><pre><code><span>import</span> CryptoKit

<span>// 1 &gt;&gt;&gt;</span>
<span>let</span> peterPrivateKey <span>=</span> <span>P256</span><span>.</span>KeyAgreement<span>.</span><span>PrivateKey</span><span>(</span><span>)</span>
<span>let</span> peterPublicKey <span>=</span> peterPrivateKey<span>.</span>publicKey

<span>let</span> janePrivateKey <span>=</span> <span>P256</span><span>.</span>KeyAgreement<span>.</span><span>PrivateKey</span><span>(</span><span>)</span>
<span>let</span> janePublicKey <span>=</span> janePrivateKey<span>.</span>publicKey
<span>// &lt;&lt;&lt;</span>

<span>// 2 &gt;&gt;&gt;</span>
<span>let</span> peterSharedSecret <span>=</span> <span>try</span><span>!</span> peterPrivateKey<span>.</span><span>sharedSecretFromKeyAgreement</span><span>(</span><span>with</span><span>:</span> janePublicKey<span>)</span>
<span>let</span> peterSymmetricKey <span>=</span> peterSharedSecret<span>.</span><span>hkdfDerivedSymmetricKey</span><span>(</span>
  using<span>:</span> <span>SHA256</span><span>.</span>self<span>,</span>
  salt<span>:</span> <span>&#34;Some random salt&#34;</span><span>.</span><span>data</span><span>(</span>using<span>:</span> <span>.</span>utf8<span>)</span><span>!</span><span>,</span>
  sharedInfo<span>:</span> <span>Data</span><span>(</span><span>)</span><span>,</span>
  outputByteCount<span>:</span> <span>32</span>
<span>)</span>

<span>let</span> janeSharedSecret <span>=</span> <span>try</span><span>!</span> janePrivateKey<span>.</span><span>sharedSecretFromKeyAgreement</span><span>(</span>
  <span>with</span><span>:</span> peterPublicLey<span>)</span>
<span>let</span> janeSymmetricKey <span>=</span> janeSharedSecret<span>.</span><span>hkdfDerivedSymmetricKey</span><span>(</span>
  using<span>:</span> <span>SHA256</span><span>.</span>self<span>,</span>
  salt<span>:</span> <span>&#34;Some random salt&#34;</span><span>.</span><span>data</span><span>(</span>using<span>:</span> <span>.</span>utf8<span>)</span><span>!</span><span>,</span>
  sharedInfo<span>:</span> <span>Data</span><span>(</span><span>)</span><span>,</span>
  outputByteCount<span>:</span> <span>32</span><span>)</span>
<span>// &lt;&lt;&lt;</span>

<span>assert</span><span>(</span>peterSymmetricKey <span>==</span> janeSymmetricKey<span>)</span></code></pre><p>Here‚Äôs what the code does (see the comments that divide it into numbered sections):</p><ol start="1"><li>Each peer creates a new public/private key pair and makes its public key available to the others. In this example, Peter will know Jane&#39;s public key, and Jane will know Peter&#39;s public key.</li><li>Each peer will generate a symmetric key to use with each other:
 <ol start="1"><li>First, each peer generates a shared secret from their counterpart‚Äôs public key (which is available and everybody in the network knows) and their own private key.</li><li>Each peer generates the symmetric key based on that shared secret using the <code><span>hkdfDerivedSymmetricKey</span><span>(</span><span>)</span></code> method, which has the following parameters:
 <ul><li><code>using</code>: The hash algorithm to use.</li><li><code>salt</code>: A salt to use in the key generation</li><li><code>sharedInfo</code>: The shared information to use for the key generation.
  <ul><li><code>outputByteCount</code>: The length of the symmetric key, in bytes.</li></ul></li></ul></li></ol></li></ol><p>Now you can use the generated symmetric key to encrypt and decrypt information passed between Peter and Jane.</p><h2 id="Signature-Verification">Signature Verification</h2><p>There may be cases where you&#39;ll need to sign the information before you send it so the recipient of the message can be sure that you ‚Äî and not someone pretending to be you ‚Äî sent the message.</p><pre><code><span>import</span> CryptoKit

<span>let</span> signingKey <span>=</span> Curve25519<span>.</span>Signing<span>.</span><span>PrivateKey</span><span>(</span><span>)</span> <span>// 1</span>
<span>let</span> signingPublicKey <span>=</span> signingKey<span>.</span>publicKey <span>// 2</span>

<span>// 3</span>
<span>let</span> signature <span>=</span> <span>try</span><span>!</span> signingKey<span>.</span><span>signature</span><span>(</span>
  <span>for</span><span>:</span> <span>&#34;Some sample Data to sign.&#34;</span><span>.</span><span>data</span><span>(</span>using<span>:</span> <span>.</span>utf8<span>)</span><span>!</span>
<span>)</span>

<span>// 4</span>
<span>if</span> signingPublicKey<span>.</span><span>isValidSignature</span><span>(</span><span>signature<span>,</span> <span>for</span><span>:</span> dataToSign</span><span>)</span> <span>{</span>
  <span>print</span><span>(</span><span>&#34;The signature is valid.&#34;</span><span>)</span>
<span>}</span></code></pre><p>Here‚Äôs what‚Äôs happening at the numbered comments in the code above:</p><ol start="1"><li>Generate a new private key for signing.</li><li>Make the public key available.</li><li>Sign the data with your signing key.</li><li>The receiver will check the signature using your public key.</li></ol><h2 id="Conclusion">Conclusion</h2><p>Mobile security cannot be an afterthought. It‚Äôs something that you need to consider throughout the development process, from design to development to QA. Keep in mind that security often involves trade-offs and costs time and resources. The level of work in securing a ‚Äúto-do list‚Äù app will differ from what you‚Äôd need to do for a banking application.</p><p>It‚Äôs important to know the security risks involved in application development, and it‚Äôs even more important to know how to mitigate them. iOS provides developers with a rich set of libraries, and the introduction of CryptoKit gives us a solid security foundation with easy-to-use high-level APIs.</p><p>There is no such thing as a perfect defense. Given enough time and resources, a determined hacker will be able to penetrate any system. Instead, we employ security techniques to make the hacker‚Äôs job as difficult as possible. Your goal is to harden your application so that hacking it isn‚Äôt worth their time.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 01 Feb 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Country-Based Access with Auth0 Actions</title>
      <link>https://auth0.com/blog/country-based-access-with-auth0-actions/</link>
      <description>How to deal with logins that must meet specific criteria based on the user‚Äôs country? Let&#39;s see how you can do this.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>If your application needs conditional access based on the user‚Äôs country, you can easily achieve it with a simple Auth0 Action. Let‚Äôs see how you can do it.</p><h2 id="Why-a-Country-based-Login-">Why a Country-based Login?</h2><p>Controlling user access based on the country where they&#39;re located when they log in to your application may have different reasons. To mention just a few of them:</p><ul><li><em>Legal reasons</em>. Laws are different around the world. This leads to adapting access to services or content offered by your application so that it does not break the laws of a particular country. For example, think of online gambling: it is illegal in some countries. Also, think of the liability requirements of <a href="https://en.wikipedia.org/wiki/General_Data_Protection_Regulation" target="_blank" rel="noreferrer noopener">GDPR</a> for Europe: you must comply with them in order to offer your services to European citizens.</li><li><em>Business reasons</em>. A company may decide not to offer their services or product to a country for business reasons: maybe because the cost of delivering that product or service in a given country is not affordable, or because the pricing strategy may depend on the country. You can even consider copyright licenses: think of the availability of video on-demand services due to copyright restrictions, for example.</li><li><em>Security reasons</em>. You may consider accesses coming from a given country dangerous because most traffic is statistically malicious.</li></ul><p>Depending on the reason you want to control user access and on the services or content offered by your application, you can apply different restriction levels. You can range from blocking access to your application (<a href="https://en.wikipedia.org/wiki/Geo-blocking" target="_blank" rel="noreferrer noopener">geo-blocking</a>) to adapting your services or content to that country&#39;s audience.</p><blockquote><p>Be aware that the most common technique to geolocate a user is based on their IP address. However, blocking users based on their IP address can be easily circumvented through VPNs or anonymizer services.</p></blockquote><h2 id="Using-Auth0-Actions">Using Auth0 Actions</h2><p>This article will focus on how you can use <a href="https://auth0.com/actions" target="_blank" rel="noreferrer noopener">Auth0 Actions</a> to detect the user&#39;s country and how to block them or require a second authentication factor. Auth0 Actions are JavaScript functions running in a Node.js environment executed when specific events happen in a few internal Auth0 Flows, such as the Login Flow, the Change Password Flow, the User Registration Flow, etc.</p><p>Each Flow is made up of one or more triggers. For example, the Login Flow runs when a user logs in. This Flow has a post-login trigger: an event fired after the user logs in. You can handle this event through one or more Actions. You can think of Actions as event handlers that run when a specific event fires in an Auth0 Flow.</p><p>The following is a graphical representation of an Action (<em>AddRoles</em>) that will be executed in the Login Flow after the user logs in:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1pJn7J2p7cICewJkSv4Ecj/4030cd2fa04c3df43e8c29b3c537b68c/auth0-action-in-login-flow.png" alt="Auth0 Action in the Login Flow"/></p><p>In the following, you will use the post-login trigger of the Login Flow to detect the user&#39;s country and apply your control strategy.</p><p>To learn more, you can check out this blog post for <a href="https://auth0.com/blog/introducing-auth0-actions/" target="_blank" rel="noreferrer noopener">a quick introduction to Auth0 Actions</a>.</p><h2 id="Blocking-Logins-from-a-Country">Blocking Logins from a Country</h2><p>Let&#39;s assume you want to block users coming from a given country. As I said, you need to create an Auth0 Action to handle the post-login trigger. So, head to your <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a>. If you don&#39;t have an Auth0 account yet, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one</a>.</p><p>Select <em>Actions</em> on the left side menu and then <a href="https://manage.auth0.com/#/actions/flows" target="_blank" rel="noreferrer noopener"><em>Flows</em></a>. You should land on the following page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4rUFsGdm1cYpgP6jS8xF98/ed055e37e3cb144cc7f5d540095b9ab3/auth0-flows-dashboard.png" alt="Auth0 Flows in the Auth0 Dashboard"/></p><p>Click the <em>Login</em> Flow and enter the Flow editor, as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4uIJUK8GRjAkfo5eksSffh/0c62aeb77c6178fba58b1bdc30a21491/auth0-flow-editor.png" alt="Auth0 Flow editor"/></p><p>Here, you can add a custom Action by clicking the <em>Build Custom</em> menu item in the Add Action section of the Flow editor:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/WD1Alxdh14g8jrzztaD58/9597f8fd5a522f02b5816fdc525b4f60/add-custom-action-menu.png" alt="Add Custom Action menu"/></p><p>This allows you to assign a name to the Action you are going to create and to access the Action editor:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5uI0EGTobmSMBbTcifj6dL/382a78976db5dd4f250759f6f8c47b53/auth0-action-editor-block-users-by-country.png" alt="Auth0 Action editor"/></p><p>Replace the code in the editor with the following:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>if</span> <span>(</span>event<span>.</span>request<span>.</span>geoip<span>.</span>countryCode <span>===</span> <span>&#34;AQ&#34;</span><span>)</span> <span>{</span>
    <span>const</span> countryName <span>=</span> event<span>.</span>request<span>.</span>geoip<span>.</span>countryName<span>;</span>
    
    api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span><span>`</span><span>Users from </span><span><span>${</span>countryName<span>}</span></span><span> are not allowed!</span><span>`</span></span><span>)</span><span>;</span>
  <span>}</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>This code defines the <code><span>onExecutePostLogin</span><span>(</span><span>)</span></code> method, which handles the post-login trigger. It receives two parameters: <code>event</code> and <code>api</code>.</p><p>The <code>event</code> parameter provides some information about the current running environment. For example, it allows you to access the current user&#39;s data, the current request, the tenant, etc. For more details about <a href="https://auth0.com/docs/actions/triggers/pre-user-registration/event-object" target="_blank" rel="noreferrer noopener">the Pre User Registration <code>event</code> object, check out the documentation</a>.</p><p>The <code>api</code> parameter provides methods for changing the behavior of the Flow. For example, it allows you to deny access to your application or set specific metadata for the user or the application. For more details about <a href="https://auth0.com/docs/actions/triggers/pre-user-registration/api-object" target="_blank" rel="noreferrer noopener">the Pre User Registration <code>api</code> object, check out the documentation</a>.</p><p>In your Action, you used the <code>event<span>.</span>request<span>.</span>geoip</code> object to get geolocation information about the user logging in. In particular, you checked the <code>countryCode</code> property, which can have one of the <a href="https://en.wikipedia.org/wiki/List_of_ISO_3166_country_codes" target="_blank" rel="noreferrer noopener">ISO country codes</a> as a value. In the example, you want to block users coming from Antarctica, whose country code is <code><span>AQ</span></code>. The <code>geoip</code> object also provides you with other information about the user&#39;s country. For example, you used the <code>countryName</code> property to get the full name of the country. Check out <a href="https://auth0.com/docs/customize/actions/triggers/post-login/event-object" target="_blank" rel="noreferrer noopener">the post-login <code>event</code> object documentation</a> for more details.</p><p>If the user&#39;s country is Antarctica, access is denied through the <code>api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span>)</span></code> method. The string passed to the <code><span>deny</span><span>(</span><span>)</span></code> method briefly explains the reason for the denied access.</p><p>Click the <em>Save Draft</em> button to store the Action you just created.</p><p>To test this Action, you should... move to Antarctica and try to log in to your application from there. This approach is a bit expensive and ineffective üôÇ. Alternatively, you can test the Action by using the <em>Test</em> button on the upper-left corner of the Action editor. It opens a sliding window whose content is the <code>event</code> object that will be passed to the Action:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1VA1JtGrCB9hzt5fasJC0p/0b758ea2dea47ebb8e3ee10e7d5b08ca/testing-auth0-action.png" alt="Testing Auth0 Action"/></p><p>You can modify the <code>geoip</code> object&#39;s properties to simulate a request coming from Antarctica and click the <em>Run</em> button. At this point, you will get a window showing a result similar to the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/dqH3FqfMGOJUGh2Jeg84x/e442c573c846355a336edfd734eb3084/geoip-test-result.png" alt="geoip test result"/></p><h2 id="Requesting-MFA-from-a-Country">Requesting MFA from a Country</h2><p>In addition to or instead of blocking users, you may want to enforce <a href="https://auth0.com/docs/secure/multi-factor-authentication" target="_blank" rel="noreferrer noopener">Multi-Factor Authentication (MFA)</a> for users logging in from specific regions. First, you must have <a href="https://auth0.com/docs/secure/multi-factor-authentication/enable-mfa" target="_blank" rel="noreferrer noopener">configured MFA in your Auth0 dashboard</a>. This lets you define what additional factor you want to use. The next step is to force MFA when a user logs in from specific regions.</p><p>For example, assume you want to enforce MFA for North American users. You can create an Action with the following code:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>if</span> <span>(</span>event<span>.</span>request<span>.</span>geoip<span>.</span>continentCode <span>===</span> <span>&#34;NA&#34;</span><span>)</span> <span>{</span>
    api<span>.</span>multifactor<span>.</span><span>enable</span><span>(</span><span>&#34;any&#34;</span><span>)</span><span>;</span>
  <span>}</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>In this case, you used the <code>continentCode</code> property of the <code>geoip</code> object. If a user logs in to your application from one of the North American countries, you force MFA by invoking the <code>api<span>.</span>multifactor<span>.</span><span>enable</span><span>(</span><span>)</span></code> method. The <code><span>&#34;any&#34;</span></code> string passed to the method tells Auth0 to use any of the configured factors. Alternatively, you can pass a string identifying a specific provider. Check out <a href="https://auth0.com/docs/customize/actions/triggers/post-login/api-object" target="_blank" rel="noreferrer noopener">the documentation to learn the  available values for MFA providers</a>.</p><blockquote><p>To make your Action available to the Login Flow in your production environment, you have to click the <em>Deploy</em> button and drag the newly created Action into the Flow editor, as explained in <a href="https://auth0.com/blog/introducing-auth0-actions/#Creating-Your-First-Auth0-Action" target="_blank" rel="noreferrer noopener">the introduction to Auth0 Actions</a>.</p></blockquote><h2 id="Recap">Recap</h2><p>In conclusion, throughout this article, you learned the main reasons you may want to control user access to your application on a country-based criterion and how you can implement it with Auth0 Actions. You learned the geolocation features of the <code>event<span>.</span>request<span>.</span>geoip</code> object and how to leverage them to block users or enable MFA when they come from specific countries.</p><p>However, remember that while the geolocation approach is pretty straightforward, it is not infallible.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 31 Jan 2022 15:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Adding Custom Claims to ID Tokens with Auth0 Actions</title>
      <link>https://auth0.com/blog/adding-custom-claims-to-id-token-with-auth0-actions/</link>
      <description>Learn how to create a new custom action that will add a custom claim to your Auth0-issued ID Token</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Did you know that you can use Actions to customize the user ID token? Well, if you need to add custom claims to your users&#39; ID tokens, you came to the right place! With this tutorial, you&#39;ll learn how to use the power of Actions to include custom claims to users&#39; ID tokens.</p><p>If you prefer, you can also watch the videos below with me explaining to add custom claims to your users&#39; ID tokens using Actions üëá!</p>
<p><iframe src="https://www.youtube.com/embed/noLO8qv1jjs" frameborder="0" allowfullscreen=""></iframe></p><h2 id="Auth0-Issued-ID-Tokens-and-Custom-Claims">Auth0 Issued ID Tokens and Custom Claims</h2><p><a href="https://auth0.com/docs/secure/tokens/id-tokens" target="_blank" rel="noreferrer noopener">ID Tokens</a> are commonly used in token-based authentication to pass user information to a client application. At Auth0, ID Tokens follow the <a href="https://auth0.com/docs/secure/tokens/json-web-tokens" target="_blank" rel="noreferrer noopener">JSON Web Token (JWT)</a> standard; this means that all ID tokens Auth0 issues are JWTs.</p><p>Claims are pieces of information about a given subject. In the case of ID Tokens, claims will contain information about the user, such as the user&#39;s name. Using custom claims can give your ID token extra information that can improve your application, for example, storing a user ID from a third party or system.</p><p>In this example, you&#39;ll see how to use Actions to make a request to an external API and store back the obtained information as a custom claim to ID token payload to be used on the sample application.</p><h2 id="The-Sample-Application">The Sample Application</h2><p>Before you begin, you will need a sample code to customize.</p><blockquote><p> For this blog post, you will use the React single-page application (SPA) sample. Keep in mind that <u>you can use what you&#39;ll learn here and apply it to your app no matter what language or framework it uses</u>.</p></blockquote><p>You can clone the sample application from GitHub with the following command:</p><pre><code><span>git</span> clone https://github.com/auth0-blog/assign-random-dog.git</code></pre><p>After the cloning finishes, follow the <a href="https://github.com/auth0-blog/assign-random-dog/blob/main/README.md" target="_blank" rel="noreferrer noopener">README.md file</a> instructions to configure it to use Auth0. You&#39;ll need an Auth0 account, and if you don&#39;t have it, <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">you can get one for free here</a>.</p><p>After configuring the sample application, you can go into the app root folder and run it with the following command:</p><pre><code><span>npm</span> start</code></pre><p>Open your browser and access <a href="https://localhost:3000/" target="_blank" rel="noreferrer noopener">https://localhost:3000/</a>. You should get the following page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1KGVVbq1ML8VZkXFhPgAWJ/205d7b2cac63ab7c718aa74d2c1d056a/starter-react-app" alt="Sample app home page"/></p><h2 id="What-Are-Auth0-Actions-">What Are Auth0 Actions?</h2><p>If you are new to this neck of the woods, this might be your first time hearing about Actions, don&#39;t worry; I got you covered, but if you are familiar with Actions, feel free to jump to the next section.</p><p>As mentioned, you will use Actions to add a custom claim to your users&#39; ID tokens, and Actions are the new way to extend Auth0 functionalities. They are JavaScript functions running in a Node.js environment executed when specific events happen in some internal Auth0 flows.</p><p> For example, Actions can be triggered when a user authenticates or changes their password. Today, you&#39;ll build an Action that will run after a user logs into your application, and as a result, the ID token will have a new custom claim. You can imagine this process as shown in the image below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3bMftYmivpwjXYRrQCS1fo/575d293ccfe8dfdada67eea035f85084/login-flow-with-assign-random-dog-action.png" alt="Post login registration Auth0 Action"/></p><p>The Action code itself is implemented inside the Auth0 Dashboard, with an in-browser editor that allows you to write the code and use a prepared test environment to test your code. Also, you can deploy the code and use the versioning tool, but you will see more of that later.</p><blockquote><p> You can check out these blog posts for <a href="https://auth0.com/blog/introducing-auth0-actions/" target="_blank" rel="noreferrer noopener">a quick introduction to Auth0 Actions</a> and how they <a href="https://auth0.com/blog/actions-now-generally-available/" target="_blank" rel="noreferrer noopener">compare with the deprecated Rules and Hooks</a>.</p></blockquote><h2 id="Implementing-The-Assign-Random-Dog-Action">Implementing The Assign Random Dog Action</h2><p>Having fun while learning new things makes everybody&#39;s life easier! For your custom claim, you will call an external API to grab a random dog picture to be displayed every time the user navigates to their user profile. Right now, your profile page looks like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6aJLZd3bQM1upkXkszdidq/bfe3e6c3b4d444c7e6caf93f81261668/profle-page-react-sample-spa-showing-id-token-of-the-user.png" alt="image of the profile page for the react sample showing the id token"/></p><p>And you want to make it look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/75eMhiO9yzow8C9Z3b2hor/006aceb5662bb41d70f0e0f4e07a98a8/updated-profile-page-to-display-the-dog-picture.png" alt="image of the profile page for the react sample showing the id token and a random dog picture"/></p><p>The API you will use is the <a href="https://dog.ceo/dog-api" target="_blank" rel="noreferrer noopener">Dog API</a>, which claims to be <em>&#34;the internet&#39;s biggest collection of open source dog pictures.&#34;</em> This API has a &#34;random&#34; endpoint that gives back JSON containing the URL for a dog picture it chooses randomly from its database. That URL will be the value of your custom claim.</p><p>Let&#39;s go back to the <a href="https://manage.auth0." target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a>. Choose <em>Actions</em> on the left-hand side menu, and you should see two options there:</p><ol start="1"><li><strong>Flows:</strong> the processes that can be extended with Actions. Each Flow is made up of one or more triggers and represents the logical pipeline through which information moves during a single point in the Auth0 journey, for example, the <em>Login</em> Flow;</li><li><strong>Library:</strong> contains all your Actions. They can be either ready-to-use <a href="https://marketplace.auth0.com/features/actions" target="_blank" rel="noreferrer noopener">Actions built by third parties and published in the Auth0 Marketplace</a> or custom Actions, like the one we are building today.</li></ol><p>So click on <em>Flows</em> and choose the <em>Login</em> flow. This will take you to the following page, where you can see your current login flow. There you will be able to edit the flow and add your custom action:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1fnnTVUuTmerNDjqA0fF9c/aa26492109ec1521e38c5ce0488454ce/login-flow-action-page.png" alt="image of the page for the login flow where you can adjust the flow and add Actions"/></p><p>On the right-hand side, you&#39;ll see the list of your Actions. The ones that come from the marketplace and the custom ones you implement yourself.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6wIs79eD5UC4GQwY49JeGQ/632a1db6c9949144157648f6f26af717/actions-menu-on-login-flow-page.png" alt="image of the Actions menu on the flow page"/></p><p>Click on the <strong>+</strong> sign button on the top right-hand corner, and you&#39;ll see a menu that will either take you to the marketplace if you select <em>Browse Actions</em> or will allow you to create a new Action if you select <em>Build Custom</em>. The latter is the option you&#39;ll want. It will then display a <em>Create Action</em> form. Now you can give your Action a name that represents what it does. For example, you could use <em>&#34;Assign random dog&#34;</em> to the action you are creating:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2s1L6MHln402rQRrd7zsIo/776766567106baaee161667655a26331/create-new-action-assign-random-dog.png" alt="image of the create new action form filled with the assigned new dog name"/></p><p>You can keep the default values for the other two fields. These fields define the flow where the action can work, in this case, the <em>Login Flow</em>, and which Node.js runtime will be used to run the Action. Click the <em>Create button</em> in the form, this will create your Action, and you will see the in-browser editor.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1Navuh8xu0m94CKGT9Xgz0/a08f24e24f063e3127ba828c841c850c/assign-random-dog-actions-in-browser-editor.png" alt="image showing the in-browser editor for Actions"/></p><p>Take a closer look and see the editor already has some code and comments to help you write code for your Action. Let&#39;s take a moment to understand what it says.</p><p>First of all, since you are editing an Action that will run during login, it can be an event that occurs <em>post login</em> or an event that happens after the user <em>resumes the login after an external redirect</em>. For this case, you need a <em>post-login</em> event so you can focus on that part of the code copied below:</p><pre><code><span>/**
* Handler that will be called during the execution of a PostLogin flow.
*
* @param {Event} event - Details about the user and the context in which they are logging in.
* @param {PostLoginAPI} api - Interface whose methods can be used to change the behavior of the login.
*/</span>
exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
<span>}</span><span>;</span></code></pre><p>The function <code>onExecutePostLogin</code> receives the <code>event</code> and the <code>api</code> parameters.</p><p>The <code>event</code> object carries information about the login context, for example, which authorization was granted to the user while logging in. For more details on this, <a href="https://auth0.com/docs/customize/actions/triggers/post-login/event-object" target="_blank" rel="noreferrer noopener">refer to the post-login <code>event</code> object documentation</a>.</p><p>The <code>api</code> object, on the other hand, has methods for changing the behavior of the flow, like denying access to the app if you want more details on this object <a href="https://auth0.com/docs/customize/actions/triggers/post-login/api-object" target="_blank" rel="noreferrer noopener">refer to the post-login <code>api</code> object documentation</a>.</p><p>For the Action to work, you will also need to install <code>axios</code>, an NPM package that will make the request to the <em>Dog API</em> <code>random</code> endpoint. A cool feature of Actions is that you can add almost any NPM package as long as it can be installed without relying on native add-ons. So let&#39;s do this first and then go back to the code.</p><p>Notice that there are three tabs on the left-hand side of the editor:</p><ul><li>The ‚ñ∂Ô∏è icon: where you can run a test suite to see if your action is performing as expected;</li><li>The üîë icon: where you can access the secret storage menu;</li><li>The üì¶ icon: where you can install NPM modules.</li></ul><p>Since you need to install <code>axios</code> on the environment for your Action to work properly, click on the üì¶ icon, and you&#39;ll see a sidebar inside the editor with the <em>Add Module</em> button. Click the <em>Add Module</em> button, and you&#39;ll see a form where you can put the name of the module you want to add, like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6Y06KN0mPllDHs7fZ2vMAJ/b4e1bb4112650ed2866a4fdffb445fdd/adding-axios-package-on-actions-modules-page.png" alt="image showing the add module form"/></p><p>Now <code>axios</code> is available for you to use on your action. If you click the üì¶ icon, the modules sidebar will be hidden, and you can go back to full editor space. Now substitute the code in the editor with the following code:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> axios <span>=</span> <span>require</span><span>(</span><span>&#34;axios&#34;</span><span>)</span><span>;</span>

  <span>const</span> randomDog <span>=</span> <span>await</span> axios<span>.</span><span>get</span><span>(</span><span>&#34;https://dog.ceo/api/breeds/image/random&#34;</span><span>)</span><span>;</span>

  <span>if</span> <span>(</span>event<span>.</span>authorization<span>)</span> <span>{</span>
    api<span>.</span>idToken<span>.</span><span>setCustomClaim</span><span>(</span><span>&#34;https://dogfy.com/random_dog&#34;</span><span>,</span> randomDog<span>.</span>data<span>.</span>message<span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>Inside the function, the logic is as follows:</p><ol start="1"><li>First, you import the <code>axios</code> package into the variable <code>axios</code> so you can use it;</li><li>Second, you make a <code><span>GET</span></code> request to the <code>random</code> endpoint of the Dog API and restore the resulting response in the <code>randomDog</code> variable;</li><li>Finally, if the event is an <em>authorization</em> flow, you use the <code>api<span>.</span>idToken<span>.</span>setCustomClaim</code> to create your custom claim.</li></ol><p>The third and last step uses the <code>setCustomClaim</code> method to create the custom claim and give it the value returned from the Dog API. There are two important things to notice here:</p><ol start="1"><li>The first one is that your custom claim name should always try to avoid clashes with standard claims, one way to achieve this is by using the URI format to name that claim. For example, here, we used <code><span>&#34;https://dogfy.com/&#34;</span> <span>+</span> <span>&#34;random_dog&#34;</span></code> to set the name of your claim, and the URL doesn&#39;t even need to be a real-life URL. <a href="https://auth0.com/docs/secure/tokens/json-web-tokens/create-namespaced-custom-claims" target="_blank" rel="noreferrer noopener">You can read more about naming custom claims here</a>.</li><li>The second thing to notice is that to access the URL for the dog picture, you use <code>randomDog<span>.</span>data<span>.</span>message</code> because the JSON containing the URL is located inside <code>data</code> on the response structure.</li></ol><p>Now that you&#39;ve got your code, you can go ahead and click the <em>Deploy</em> button on the top left corner, which will save the Action and make it available for use. After deploying your Action, you need to go back to the flow to add it. On the right-hand main menu, choose <em>Actions</em>, then <em>Flows</em>, and pick the <em>Login</em> flow; now, if you look at your <em>Add action</em> section, and if you click on the <em>Custom</em> tab, you should see your Action in there:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2niMVNWCOOGLBXX41aBHqf/888096695e7902859ddde3c27af044fe/custom-action-being-displayed-on-add-action-section.png" alt="image of the Add action section showing the action under the Custom tab"/></p><p>With that said, it is time to drag your Action, drop it on the Flow, and don&#39;t forget to click <em>Apply</em> to make your Action part of your <em>Login</em> flow.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3uf5YKYg6kbcnbNgeTPetO/553b988408dc4063a4484f787eaf44b5/drag-and-drop-new-action-into-the-login-flow.gif" alt="gif showing the drag and drop of the action into the flow and its deployment"/></p><p>You can test to see if the change worked by logging out of your application then logging back in once more. You should see on the <em>Profile</em> page that the ID token content was updated and the new custom claim is there:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1lDrIOzfo8Mp2nWv9W0I19/34299cfc6cfafe925e2953c94cb789ce/updated-profile-page-react-spa-with-custom-claim.png" alt="image of the profile page for the react sample showing the id token the new custom claim"/></p><h2 id="Updating-Your-Application-to-Use-the-Custom-Claim">Updating Your Application to Use the Custom Claim</h2><p>Now that we have the URL for the dog picture is time to update the profile page to display it. Let&#39;s see how to do that.</p><blockquote><p>Since the sample application is built with React, the steps described in this subsection are strictly related to this library. <u>This step aims to update the profile page to display a cute dog picture</u>, so feel free to adapt this step to your needs.</p></blockquote><p>On the project source code, navigate to the file <code>Profile<span>.</span>js</code> inside <code>src<span>/</span>views</code> directory. Then add the code highlighted below:</p><pre><code><span>import</span> React <span>from</span> <span>&#34;react&#34;</span><span>;</span>
<span>import</span> <span>{</span> Container<span>,</span> Row<span>,</span> Col <span>}</span> <span>from</span> <span>&#34;reactstrap&#34;</span><span>;</span>

<span>import</span> Highlight <span>from</span> <span>&#34;../components/Highlight&#34;</span><span>;</span>
<span>import</span> Loading <span>from</span> <span>&#34;../components/Loading&#34;</span><span>;</span>
<span>import</span> <span>{</span> useAuth0<span>,</span> withAuthenticationRequired <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-react&#34;</span><span>;</span>

<span>export</span> <span>const</span> <span>ProfileComponent</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>// ...existing code...</span>

      <span>&lt;</span>Row<span>&gt;</span>
        <span>&lt;</span>Highlight<span>&gt;</span><span>{</span><span>JSON</span><span>.</span><span>stringify</span><span>(</span>user<span>,</span> <span>null</span><span>,</span> <span>2</span><span>)</span><span>}</span><span>&lt;</span><span>/</span>Highlight<span>&gt;</span>
      <span>&lt;</span><span>/</span>Row<span>&gt;</span>

    <span>// üëá new code</span>
    <span>{</span>user<span>[</span><span>&#34;https://dogfy.com/random_dog&#34;</span><span>]</span> <span>&amp;&amp;</span>  <span>&lt;</span>div style<span>=</span><span>{</span><span>{</span>textAlign<span>:</span> <span>&#39;center&#39;</span><span>}</span><span>}</span><span>&gt;</span>
    <span>&lt;</span>h2<span>&gt;</span>Our Doggy<span>!</span><span>&lt;</span><span>/</span>h2 <span>&gt;</span>
    <span>&lt;</span>img
        src<span>=</span><span>{</span>user<span>[</span><span>&#34;https://dogfy.com/random_dog&#34;</span><span>]</span><span>}</span>
        alt<span>=</span><span>&#34;Random dog&#34;</span>
        className<span>=</span><span>&#34;img-fluid profile-picture mb-3 mb-md-0&#34;</span>
      <span>/</span><span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span><span>}</span>
    <span>// üëÜ new code</span>

    <span>&lt;</span><span>/</span>Container<span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>// ...existing code...</span></code></pre><p>This code will add a picture from the ID token to the profile page whenever there is a <code><span>&#34;https://dogfy.com/random_dog&#34;</span></code> claim. Your page should automatically reload itself and display the current dog picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/75eMhiO9yzow8C9Z3b2hor/006aceb5662bb41d70f0e0f4e07a98a8/updated-profile-page-to-display-the-dog-picture.png" alt="image showing the new profile page displaying the dog picture"/></p><p>With that done, your application is ready. üéâ Congratulations! </p><p>You can check out <a href="https://github.com/auth0-blog/assign-random-dog/tree/profile-page-updated" target="_blank" rel="noreferrer noopener">the complete code changes, access this link</a> or switch to the branch <code>profile<span>-</span>page<span>-</span>updated</code> on your sample app.</p><h2 id="Recap">Recap</h2><p>You just implemented a brand new Action to be used during the Login flow üéâ. Let&#39;s recap what you&#39;ve learned:</p><ol start="1"><li>You set up a SPA using Auth0;</li><li>You learned what Actions are and how you can use them to expand Auth0&#39;s functionalities;</li><li>You implemented an Action that makes a call to an external API, and that creates a custom claim with data from the response;</li><li>Finally, you deployed that custom action and updated your app to use the custom claim.</li></ol><p>Keep in mind that this was a colorful way to show how you can use Actions to make a call to an external resource and add a custom claim on the user&#39;s ID token. Now you can let your imagination fly and use the knowledge you acquired today to add useful information to your user&#39;s ID tokens.</p><p>Are you ready to add more custom claims to your user&#39;s ID tokens? Let me know in the comments üòâ.</p></div></div>]]></content:encoded>
      <pubDate>Fri, 28 Jan 2022 14:58:00 +0000</pubDate>
    </item>
    <item>
      <title>Migrating Auth0 Rules to Auth0 Actions</title>
      <link>https://auth0.com/blog/migrating-auth0-rules-to-auth0-actions/</link>
      <description>Are you considering migrating your Auth0 Rules to Auth0 Actions? Here are some guidelines to do it successfully.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Auth0 Actions offer many advantages over Rules. If you are using Rules to customize your Auth0 integration experience, you should consider migrating to Actions. Learn how to plan and implement this migration.</p><h2 id="Comparing-Auth0-Rules-and-Actions">Comparing Auth0 Rules and Actions</h2><p>One of Auth0&#39;s strengths is its focus on extensibility, i.e., the ability for the user to customize the standard behavior of Auth0&#39;s identity solutions. <a href="https://auth0.com/docs/customize/rules" target="_blank" rel="noreferrer noopener">Auth0 Rules</a> was the first tool that enabled users to run custom code to extend Auth0 authentication. Rules are serverless code blocks executed right after successful authentication but before tokens are issued.</p><p>To satisfy the widest range of extensibility needs, Auth0 has constantly worked on improving this tool. Recently, it consolidated the acquired experience on customization and provided developers with <a href="https://auth0.com/actions" target="_blank" rel="noreferrer noopener">Auth0 Actions</a>, a solid environment for most code-based customization needs.</p><p>Auth0 Actions offer a lot of benefits over Rules. So, if you are about to start your customization, Actions are the recommended tool. On the other hand, if you have already implemented your customization through Rules, you are strongly encouraged to migrate to Actions. Let&#39;s look at a few advantages you can get by switching to Actions:</p><ul><li>Rules let you handle just the authentication flow. <strong>Auth0 Actions let you handle multiple flows</strong>: authentication, pre and post user registration, password change, client credential exchange, phone message sending.</li><li>Rules don&#39;t have an integrated version control system. Actions do. <strong>You can modify an Action without affecting the one in production</strong>, create multiple versions, and restore a previous one.</li><li>Unlike Rules, the Actions editor supports code hints, all npm packages, and isolated secrets management. <strong>The developer experience is significantly improved</strong>.</li></ul><p>Read <a href="https://auth0.com/blog/introducing-auth0-actions/" target="_blank" rel="noreferrer noopener">this blog post for a quick introduction to Auth0 Actions</a>.</p><blockquote><p>While Auth0 Actions bring you an improved customization environment, Rules and Hooks are still available, and they all can live together. <u>Just remember that Rules and Hooks are executed before Actions.</u></p></blockquote><p>You can use Actions to replace your Rules, but be aware of some limitations:</p><ul><li>In Rules, you can share data with other Rules in the pipeline by adding properties to the <code>user</code> and <code>context</code> objects. These properties are accessible in subsequent Rules. In Actions, you can&#39;t do this, although changes to the user&#39;s metadata can be accessed by subsequent Actions.</li><li>Rules can <a href="https://auth0.com/docs/authenticate/protocols/saml/saml-configuration/customize-saml-assertions" target="_blank" rel="noreferrer noopener">modify SAML assertions or attributes</a>. Actions can&#39;t.</li><li>Rules have <a href="https://auth0.com/docs/customize/rules/use-management-api" target="_blank" rel="noreferrer noopener">limited access to the Auth0 Management API</a> and <a href="https://auth0.com/docs/customize/rules/rules-best-practices/rules-environment-best-practices#global-object" target="_blank" rel="noreferrer noopener">the <code>global</code> and <code>auth0</code> objects</a>. Actions can&#39;t, but have an alternative approach for doing similar tasks, as you will learn in the following.</li></ul><p>Take a look at <a href="https://auth0.com/docs/customize/actions/limitations" target="_blank" rel="noreferrer noopener">the full list of limitations of the current implementation</a>.</p><p>With these caveats in mind, let&#39;s take a look at how you can convert your Rule into an Auth0 Action.</p><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"></path></svg><p><strong>No-Code Solution</strong></p><p>When migrating from Rules to Actions, a developer may also want to consider a no-code Integration - including Actions Integrations - from the <a href="https://auth0.com/resources/whitepapers/broken-auth-checklist" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a>. These Partner-built integrations solve common identity use cases such as consent management, progressive profiling, and user verification, enabling developers to go-to-market faster while reducing development and maintenance costs associated with custom code.<br/> </p></div><h2 id="Code-Conversion-Guidelines">Code Conversion Guidelines</h2><p>Auth0 Rules allow you to customize the authentication flow. That means you can convert a Rule into an Auth0 Action handling <a href="https://auth0.com/docs/customize/actions/triggers/post-login" target="_blank" rel="noreferrer noopener">the Post Login trigger of the Login Flow</a>.</p><blockquote><p>This article will not guide you step-by-step through creating an action or migrating a rule. It assumes that you have a basic understanding of how to create a Rule and how to create an Action.
If not, please refer to Auth0 documentation about <a href="https://auth0.com/docs/customize/rules/create-rules" target="_blank" rel="noreferrer noopener">Rules creation</a> and <a href="https://auth0.com/docs/customize/actions/write-your-first-action" target="_blank" rel="noreferrer noopener">Actions writing</a>.
In both cases, you need an Auth0 account. If you don&#39;t have it, <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">you can get one for free</a>.</p></blockquote><p>The Actions editor for the Post Login trigger looks like the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/29HiQQis75pvxp6arSitxM/4927a37ca2557f8567bd838b8c8cb6c0/auth0-action-editor.png" alt="Auth0 Action editor"/></p><p>Conceptually, to migrate your Rule, you need to move the body of the function that implements it into the body of the following function:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
<span>}</span><span>;</span></code></pre><p>This is not just a matter of copy and paste. You need to apply some changes to make the conversion effective. So, let&#39;s focus on the specific changes you should apply to your Rule&#39;s code.</p><blockquote><p>You can have multiple Rules handling your authentication flow. You can map these Rules to as many Actions by keeping the same order. This will ensure you keep the same functionality.</p></blockquote><h3 id="Mapping-parameters">Mapping parameters</h3><p>An Auth0 Rule is a JavaScript function with three parameters: <code>user</code>, <code>context</code>, and <code>callback</code>. The <code><span>onExecutePostLogin</span><span>(</span><span>)</span></code> function implementing the Action has two parameters: <code>event</code> and <code>api</code>. Besides the different names, how can you map those parameters? How can your Action retrieve the same data from the parameters as your Rule?</p><p>Actually, the design of Actions brought you consolidation of the data passed by the running environment to the Action function. As a general rule, all read-only properties of the <code>user</code> and <code>context</code> objects in Rules have been moved to the <code>event</code> object in Actions. Any interaction with the running environment, like failing a login or updating user metadata, is implemented through methods of the <code>api</code> object.</p><p>Please refer to the documentation to learn more details about <a href="https://auth0.com/docs/customize/actions/triggers/post-login/event-object" target="_blank" rel="noreferrer noopener">the <code>event</code> object</a> and <a href="https://auth0.com/docs/customize/actions/triggers/post-login/api-object" target="_blank" rel="noreferrer noopener">the <code>api</code> object</a>.</p><h3 id="Accessing-user-data">Accessing user data</h3><p>In Rules, you get data about the current user by accessing the <code>user</code> object parameter. In Actions, you need to access the <code>event<span>.</span>user</code> object. Here you can find the same data as the <code>user</code> object except the attributes added by an external identity provider or custom database script.</p><p>To give you an example, if you have the following Rule implementation:</p><pre><code><span>function</span> <span>myRule</span><span>(</span><span>user<span>,</span> context<span>,</span> callback</span><span>)</span> <span>{</span>
    <span>const</span> userEmail <span>=</span> user<span>.</span>email<span>;</span>
    <span>const</span> userId <span>=</span> user<span>.</span>user_id<span>;</span>
    
    <span>// ... additional code</span>
<span>}</span></code></pre><p>You can convert it into an Action implementation as follows:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> userEmail <span>=</span> event<span>.</span>user<span>.</span>email<span>;</span>
    <span>const</span> userId <span>=</span> event<span>.</span>user<span>.</span>user_id<span>;</span>
    
    <span>// ... additional code</span>
<span>}</span><span>;</span></code></pre><blockquote><p>Notice that while the <code>user<span>.</span>app_metadata</code> object could be undefined in Rules, the counterpart <code>event<span>.</span>user<span>.</span>app_metadata</code> will always be defined in Actions.</p></blockquote><h3 id="Accessing-context-data">Accessing context data</h3><p>In Rules, the <code>context</code> object stores data about the current login session. In Actions, you can find the same data in the <code>event</code> object.</p><p>Consider the following Rule function:</p><pre><code><span>function</span> <span>myRule</span><span>(</span><span>user<span>,</span> context<span>,</span> callback</span><span>)</span> <span>{</span>
    <span>const</span> clientId <span>=</span> context<span>.</span>clientID<span>;</span>
    <span>const</span> clientMetadata <span>=</span> context<span>.</span>clientMetadata <span>||</span> <span>{</span><span>}</span><span>;</span>
    
    <span>const</span> connectionId <span>=</span> context<span>.</span>connectionID<span>;</span>
    <span>const</span> connectionMetadata <span>=</span> context<span>.</span>connectionMetadata <span>||</span> <span>{</span><span>}</span><span>;</span>
    
    <span>const</span> protocol <span>=</span> context<span>.</span>protocol<span>;</span>
    
    <span>const</span> tenant <span>=</span> context<span>.</span>tenant<span>;</span>
    
    <span>// ... additional code</span>
<span>}</span></code></pre><p>In an Action, it will become as shown below:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> clientId <span>=</span> event<span>.</span>client<span>.</span>client_id<span>;</span>
    <span>const</span> clientMetadata <span>=</span> event<span>.</span>client<span>.</span>metadata<span>;</span>
    
    <span>const</span> connectionId <span>=</span> event<span>.</span>connection<span>.</span>id<span>;</span>
    <span>const</span> connectionMetadata <span>=</span> event<span>.</span>connection<span>.</span>metadata<span>;</span>
    
    <span>const</span> protocol <span>=</span> event<span>.</span>transaction<span>.</span>protocol<span>;</span>
    
    <span>const</span> tenant <span>=</span> event<span>.</span>tenant<span>.</span>id<span>;</span>
    
    <span>// ... additional code</span>
<span>}</span><span>;</span></code></pre><p>As you can see, some properties of the <code>context</code> object have become properties of a few objects attached to the <code>event</code> object. For example, you have the <code>client</code> object, the <code>connection</code> object, and so on. In other words, the login session data has been refactored to be more clearly organized.</p><p>Be aware that some property names have different spellings. For example, <code>clientID</code> becomes <code>client_id</code>, <code>connectionMetadata</code> becomes <code>connection<span>.</span>metadata</code>, etc.</p><p>Please compare the documentation of <a href="https://auth0.com/docs/customize/rules/context-object" target="_blank" rel="noreferrer noopener">the <code>context</code> object in Rules</a> and <a href="https://auth0.com/docs/customize/actions/triggers/post-login/event-object" target="_blank" rel="noreferrer noopener">the <code>event</code> object in Actions</a> to learn more about the differences.</p><h3 id="Dealing-with-dependencies">Dealing with dependencies</h3><p>Auth0 Rules allow you to include dependencies to power up your code. You can leverage thousands of npm packages, but not all the packages available in the <a href="https://www.npmjs.com/" target="_blank" rel="noreferrer noopener">npm registry</a>. If you need a package that is not available for Rules (or even just a specific version of an npm package), you need to request it to Auth0.</p><p>In Actions, you can add dependencies for all the available packages in the npm registry, which means over one million.</p><p>Also, unlike Rules, in Actions you don&#39;t need to specify the package version in the code. That means, for example, that in Rules you have to declare a dependency this way:</p><pre><code><span>function</span> <span>myRule</span><span>(</span><span>user<span>,</span> context<span>,</span> callback</span><span>)</span> <span>{</span>
    <span>const</span> axios <span>=</span> <span>require</span><span>(</span><span>&#34;axios@0.22.0&#34;</span><span>)</span><span>;</span>
    
    <span>// ... additional code</span>
<span>}</span></code></pre><p>In Actions, you specify the package version just in the editor&#39;s module manager and your code looks like the following:</p><pre><code><span>const</span> axios <span>=</span> <span>require</span><span>(</span><span>&#34;axios&#34;</span><span>)</span><span>;</span>

exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>// ... additional code</span>
<span>}</span><span>;</span></code></pre><p>Notice that you import the dependency outside the function&#39;s body, more in the style of a Node.js module.</p><h3 id="Converting-Rules--callbacks">Converting Rules&#39; callbacks</h3><p>In Rules, you use the <code>callback</code> parameter to pass back the result of your processing. For example, in order to pass the control to the Auth0 authentication process, which will possibly run the next Rule, you should invoke the <code><span>callback</span><span>(</span><span>)</span></code> function by passing the current <code>user</code> and <code>context</code> objects. In case you want to stop the current login process, you need to call the <code><span>callback</span><span>(</span><span>)</span></code> function with an error instance.</p><p>With Actions, everything is more straightforward. To pass control, simply use <code><span>return</span></code>. To stop the login process, call the <code>api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span>)</span></code> method.</p><p>Consider the following Rule function:</p><pre><code><span>function</span> <span>myRule</span><span>(</span><span>user<span>,</span> context<span>,</span> callback</span><span>)</span> <span>{</span>
    <span>const</span> userAppMetadata <span>=</span> user<span>.</span>app_metadata <span>||</span> <span>{</span><span>}</span><span>;</span>

    <span>if</span> <span>(</span>userAppMetadata<span>.</span>condition <span>===</span> <span>&#34;success&#34;</span><span>)</span> <span>{</span>
        <span>// This Rule succeeded, proceed with next Rule.</span>
        <span>return</span> <span>callback</span><span>(</span><span>null</span><span>,</span> user<span>,</span> context<span>)</span><span>;</span>
    <span>}</span>
    
    <span>if</span> <span>(</span>userAppMetadata<span>.</span>condition <span>===</span> <span>&#34;failure&#34;</span><span>)</span> <span>{</span>
        <span>// This Rule failed, stop the login with an error response.</span>
        <span>return</span> <span>callback</span><span>(</span><span>new</span> <span>Error</span><span>(</span><span>&#34;Failure message&#34;</span><span>)</span><span>)</span><span>;</span>
    <span>}</span>
    
    <span>// ... additional code</span>
<span>}</span></code></pre><p>This code succeeds or fails based on the value of the <code>condition</code> property of the <code>app_metadata</code> object. You can convert this code into the following Action function:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>if</span> <span>(</span>event<span>.</span>user<span>.</span>app_metadata<span>.</span>condition <span>===</span> <span>&#34;success&#34;</span><span>)</span> <span>{</span>
        <span>// This Action succeeded, proceed with next Action.</span>
        <span>return</span><span>;</span>
    <span>}</span>
    
    <span>if</span> <span>(</span>event<span>.</span>user<span>.</span>app_metadata<span>.</span>condition <span>===</span> <span>&#34;failure&#34;</span><span>)</span> <span>{</span>
        <span>// This Action failed, stop the login with an error response.</span>
        <span>return</span> api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span>&#34;Failure message&#34;</span><span>)</span><span>;</span>
    <span>}</span>
    
    <span>// ... additional code</span>
<span>}</span><span>;</span></code></pre><p>In summary, you should replace any instance of <code><span>callback</span><span>(</span><span>)</span></code> in your Rule with a call to <code>api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span>)</span></code>, in case of failure, or with <code><span>return</span></code>, in case of success. You can also omit the <code><span>return</span></code> statement if your code runs to the end of the function&#39;s body.</p><h2 id="Conversion-Examples">Conversion Examples</h2><p>Now that you have some general guidelines to convert the code of your Rules into Actions, let&#39;s take a look at some examples.</p><h3 id="Adding-custom-claims-to-a-token">Adding custom claims to a token</h3><p>One of the most common use cases for Rules is the ability to add custom claims to a token, either an ID token or an access token. For example, the following code snippet shows a Rule adding two custom claims to the ID token:</p><pre><code><span>function</span> <span>myRule</span><span>(</span><span>user<span>,</span> context<span>,</span> callback</span><span>)</span> <span>{</span>
  <span>const</span> namespace <span>=</span> <span>&#39;https://myapp.example.com/&#39;</span><span>;</span>
  
  context<span>.</span>idToken<span>[</span>namespace <span>+</span> <span>&#39;favorite_color&#39;</span><span>]</span> <span>=</span> user<span>.</span>user_metadata<span>.</span>favorite_color<span>;</span>
  context<span>.</span>idToken<span>[</span>namespace <span>+</span> <span>&#39;preferred_contact&#39;</span><span>]</span> <span>=</span> user<span>.</span>user_metadata<span>.</span>preferred_contact<span>;</span>
  <span>callback</span><span>(</span><span>null</span><span>,</span> user<span>,</span> context<span>)</span><span>;</span>
<span>}</span></code></pre><p>This Rule can be converted into an Action as follows:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> namespace <span>=</span> <span>&#39;https://myapp.example.com/&#39;</span><span>;</span>
  
  api<span>.</span>idToken<span>.</span><span>setCustomClaim</span><span>(</span>
    <span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/favorite_color</span><span>`</span></span><span>,</span>
    event<span>.</span>user<span>.</span>user_metadata<span>.</span>favorite_color
  <span>)</span><span>;</span>
  
  api<span>.</span>idToken<span>.</span><span>setCustomClaim</span><span>(</span>
    <span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/preferred_contact</span><span>`</span></span><span>,</span>
    event<span>.</span>user<span>.</span>user_metadata<span>.</span>preferred_contact
  <span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>While the Rule assigns the values directly to the <code>context<span>.</span>idToken</code> object, in the Action you have to use the <code>api<span>.</span>idToken<span>.</span><span>setCustomClaim</span><span>(</span><span>)</span></code> method. Notice how the invocation of <code><span>callback</span><span>(</span><span>)</span></code> disappears in the Action.</p><h3 id="Updating-metadata">Updating metadata</h3><p>You can manage users&#39; and applications&#39; metadata using Rules. The following example shows how to store the font size preference in the user&#39;s metadata:</p><pre><code><span>function</span> <span>myRule</span><span>(</span><span>user<span>,</span> context<span>,</span> callback</span><span>)</span><span>{</span>
  user<span>.</span>user_metadata <span>=</span> user<span>.</span>user_metadata <span>||</span> <span>{</span><span>}</span><span>;</span>
  user<span>.</span>user_metadata<span>.</span>preferences <span>=</span> user<span>.</span>user_metadata<span>.</span>preferences <span>||</span> <span>{</span><span>}</span><span>;</span>
  user<span>.</span>user_metadata<span>.</span>preferences<span>.</span>fontSize <span>=</span> <span>12</span><span>;</span>

  <span>// persist the user_metadata update</span>
  auth0<span>.</span>users<span>.</span><span>updateUserMetadata</span><span>(</span>user<span>.</span>user_id<span>,</span> user<span>.</span>user_metadata<span>)</span>
    <span>.</span><span>then</span><span>(</span><span>function</span><span>(</span><span>)</span><span>{</span>
      <span>callback</span><span>(</span><span>null</span><span>,</span> user<span>,</span> context<span>)</span><span>;</span>
    <span>}</span><span>)</span>
    <span>.</span><span>catch</span><span>(</span><span>function</span><span>(</span><span>err</span><span>)</span><span>{</span>
      <span>callback</span><span>(</span>err<span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>The corresponding Action&#39;s code looks like the following:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> userPreferences <span>=</span> event<span>.</span>user<span>.</span>user_metadata<span>.</span>preferences <span>||</span> <span>{</span><span>}</span><span>;</span>
  
  userPreferences<span>.</span>fontSize <span>=</span> <span>12</span><span>;</span>
  
  <span>// persist the user_metadata update</span>
  api<span>.</span>user<span>.</span><span>setUserMetadata</span><span>(</span><span>&#34;preferences&#34;</span><span>,</span> userPreferences<span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>While the Rule&#39;s code needs to access the <code>auth0<span>.</span>users<span>.</span><span>updateUserMetadata</span><span>(</span><span>)</span></code> method, which returns a promise, the Action&#39;s code just assigns the metadata value by using the <code>api<span>.</span>user<span>.</span><span>setUserMetadata</span><span>(</span><span>)</span></code> method. Notice how simplified the Action&#39;s code is compared to the Rule&#39;s one.</p><blockquote><p>In Rules, each invocation of <code>auth0<span>.</span>users<span>.</span><span>updateUserMetadata</span><span>(</span><span>)</span></code> makes an HTTP request to the <a href="https://auth0.com/docs/api/management/v2" target="_blank" rel="noreferrer noopener">Auth0 Management API</a>. Instead, all the invocations of <code>api<span>.</span>user<span>.</span><span>setUserMetadata</span><span>(</span><span>)</span></code> occurring in one or more Actions will result in a single API call at the end of the Actions execution. This contributes to mitigating the risk of <a href="https://auth0.com/docs/troubleshoot/customer-support/operational-policies/rate-limit-policy/management-api-endpoint-rate-limits" target="_blank" rel="noreferrer noopener">rate limit</a> errors.</p></blockquote><h3 id="Redirecting-users">Redirecting users</h3><p>When you need to redirect the user to a different page to complete the login process and then resume authentication, your Rule may look as shown below:</p><pre><code><span>function</span> <span>myRule</span><span>(</span><span>user<span>,</span> context<span>,</span> callback</span><span>)</span> <span>{</span>
  <span>if</span> <span>(</span>context<span>.</span>protocol <span>===</span> <span>&#34;redirect-callback&#34;</span><span>)</span> <span>{</span>
    <span>// User was redirected to the /continue endpoint</span>
    user<span>.</span>app_metadata<span>.</span>wasRedirected <span>=</span> <span>true</span><span>;</span>
    <span>return</span> <span>callback</span><span>(</span><span>null</span><span>,</span> user<span>,</span> context<span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>if</span> <span>(</span>
    context<span>.</span>protocol <span>===</span> <span>&#34;oauth2-password&#34;</span> <span>||</span>
    context<span>.</span>protocol <span>===</span> <span>&#34;oauth2-refresh-token&#34;</span> <span>||</span>
    context<span>.</span>protocol <span>===</span> <span>&#34;oauth2-resource-owner&#34;</span>
  <span>)</span> <span>{</span>
    <span>// User cannot be redirected</span>
    <span>return</span> <span>callback</span><span>(</span><span>null</span><span>,</span> user<span>,</span> context<span>)</span><span>;</span>
  <span>}</span>

  <span>// User is logging in directly</span>
  <span>if</span> <span>(</span><span>!</span>user<span>.</span>app_metadata<span>.</span>wasRedirected<span>)</span> <span>{</span>
    context<span>.</span>redirect <span>=</span> <span>{</span>
        url<span>:</span> <span>&#34;https://example.com&#34;</span><span>,</span>
    <span>}</span><span>;</span>
    <span>callback</span><span>(</span><span>null</span><span>,</span> user<span>,</span> context<span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>This Rule and any other previous Rule will run twice: before the redirection and on the response. Typically, you need to put the logic for handling the redirection and the response in the same Rule. Also, you need to manually check if the current protocol is eligible for a user redirect.</p><p>The conversion of this Rule into an Action becomes as follows:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>if</span> <span>(</span><span>!</span>event<span>.</span>user<span>.</span>app_metadata<span>.</span>wasRedirected <span>&amp;&amp;</span> api<span>.</span>redirect<span>.</span><span>canRedirect</span><span>(</span><span>)</span><span>)</span> <span>{</span>
        api<span>.</span>redirect<span>.</span><span>sendUserTo</span><span>(</span><span>&#34;https://example.com&#34;</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span><span>;</span>

exports<span>.</span><span>onContinuePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
    api<span>.</span>user<span>.</span><span>setAppMetadata</span><span>(</span><span>&#34;wasRedirected&#34;</span><span>,</span> <span>true</span><span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>You have different functions handling the redirection (<code><span>onExecutePostLogin</span><span>(</span><span>)</span></code>) and the response (<code><span>onContinuePostLogin</span><span>(</span><span>)</span></code>). Also, the burden to check if the current protocol is eligible for a user redirect is assigned to the <code>api<span>.</span>redirect<span>.</span><span>canRedirect</span><span>(</span><span>)</span></code> method. Also, notice that Actions use the <code>api<span>.</span>redirect<span>.</span><span>sendUserTo</span><span>(</span><span>)</span></code> method to redirect users instead of the <code>context<span>.</span>redirect</code> object.</p><p>To learn more about <a href="https://auth0.com/docs/customize/actions/triggers/post-login/redirect-with-actions" target="_blank" rel="noreferrer noopener">user redirect with Actions, check out the documentation</a>.</p><h2 id="Plan-Your-Migration-Strategy">Plan Your Migration Strategy</h2><p>At this point, you should have a clearer understanding of the main differences between the code used in Rules and Actions. However, knowing how to translate a Rule into an Action is not the only thing you should care about. You also need to plan a strategy to migrate your code from Rules to Actions in order to avoid issues in the production environment.</p><p>Check out <a href="https://auth0.com/docs/customize/actions/migrate-from-rules-to-actions#complete-the-migration" target="_blank" rel="noreferrer noopener">the documentation for guidelines to define your Rules to Actions migration strategy</a>.</p><h2 id="Summary">Summary</h2><p>This article gave you the foundations to set up your migration process from Auth0 Rules to Actions. You learned the main reasons to migrate and the basic differences between coding for Rules and coding for Actions.</p><p>A few conversion examples showed you how Actions generally simplify the code. You can find more conversion examples and additional information in <a href="https://auth0.com/docs/customize/actions/migrate-from-rules-to-actions" target="_blank" rel="noreferrer noopener">the Auth0 Rules to Actions migration guide</a>.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 27 Jan 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Ably&#39;s Fully Featured Scalable Chat App</title>
      <link>https://auth0.com/blog/ably-fully-featured-scalable-chat-app/</link>
      <description>Creating a Universal Authentication System with Auth0 for Ably&#39;s scalable chat application.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>This is the second part of <a href="https://ably.com/blog/fully-featured-scalable-chat-app" target="_blank" rel="noreferrer noopener">Ably‚Äôs Fully Featured Scalable Chat App</a> series. We have been working on creating a prototype for an open-source chat application that anyone could use at real-world scales of traffic, with many of the bells and whistles one would expect from a modern chat application. This means integrated media, notifications, and more.</p><p>If you want to try out this application yourself, you can get the code from <a href="https://github.com/ably-labs/fully-featured-scalable-chat-app" target="_blank" rel="noreferrer noopener">GitHub</a> and follow the <a href="https://github.com/ably-labs/fully-featured-scalable-chat-app#readme" target="_blank" rel="noreferrer noopener">README</a> on the steps for local setup.</p><p>Our goal is for you to be able to take the code and create your own scalable chat application or mix and match elements from it into other applications that need a chat element.</p><p>Ably handles the complexity of distributed messaging between clients, presence checks, and authorization of messages. By making use of <a href="https://ably.com/topic/websockets" target="_blank" rel="noreferrer noopener">WebSockets</a> we can have persisted, realtime communication. Making use of Ably as a <a href="https://ably.com/pub-sub-messaging" target="_blank" rel="noreferrer noopener">Pub/Sub broker</a>, we will be able to have the consistent ordering of messages and reliable message ordering. You can try out these features by <a href="https://ably.com/signup" target="_blank" rel="noreferrer noopener">signing up for a free Ably account</a>.</p><p>Before starting on these elements, however, we need the absolute fundamentals of chat. One of the most crucial things to get right is the authentication of users.</p><p>Authentication requires:</p><ul><li>All information we store on users to be secure</li><li>We should provide 2FA and reasonable methods to recover an account should login credentials be forgotten</li><li>Password resetting should be possible</li><li>We need to be able to assign permissions, user information, and more to a user</li></ul><h2 id="Starting-Off">Starting Off</h2><p>Prior to starting on our authentication system, we already have a few things in place.</p><p>We have a frontend server that is hosting a <a href="https://reactjs.org/" target="_blank" rel="noreferrer noopener">ReactJS</a> application, compiled using <a href="https://www.snowpack.dev/" target="_blank" rel="noreferrer noopener">Snowpack</a>. On this, we have a basic page as seen below which allows for a user to set a username for themselves.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/10HfnKU3xmw1aTcBXfQNwP/36fc8f2a57b7a7dc1f323cfd090c7ea8/Uploaded_from_Fully_Functional_Scalable_Chat_App" alt="Starting Off"/></p><p>Once a user sets their username, they‚Äôll be taken to the main chat application page, which has the available hard-coded chat channels on the left, which you can click on to load a <a href="https://reactjs.org/docs/react-component.html" target="_blank" rel="noreferrer noopener">React Component</a> on the right of the screen for chatting within that channel.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6UCmezwQzxO2oDofbC3JaX/5433dd6b9b2d8409fb4a6f79b599c8e5/ably-chat.png" alt="Starting Off"/></p><p>The chat uses Ably. When a user clicks on one of the chat channels on the left of the screen, we use the <a href="https://ably.com/blog/ably-react-hooks-npm-package" target="_blank" rel="noreferrer noopener">Ably React Hooks</a> library to connect to one of Ably‚Äôs servers and subscribe to its associated <a href="https://ably.com/documentation/realtime/channels" target="_blank" rel="noreferrer noopener">Ably Channel</a>. For example, to subscribe to the Ably Channel for the ‚Äòglobal-welcome‚Äô chat room:</p><pre><code><span>[</span> channel <span>]</span> <span>=</span> <span>useChannel</span><span>(</span>‚Äúglobal<span>-</span>welcome‚Äù<span>,</span> <span>(</span><span>message</span><span>)</span> <span>=&gt;</span> <span>{</span>
<span>// Append message to our chat box component</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>If we want to publish a message to this channel, we can make use of the channel object returned by the <code>useChannel</code> function:</p><pre><code>channel<span>.</span><span>publish</span><span>(</span><span>&#34;message&#34;</span><span>,</span> messageFromChatBox<span>)</span><span>;</span></code></pre><p>We do both of these within the FFS app inside our <a href="https://github.com/ably-labs/fully-featured-scalable-chat-app/blob/main/app/src/components/Chat/ChatContainer.jsx" target="_blank" rel="noreferrer noopener">ChatContainer</a> code, which you can check if you‚Äôd like to see real examples.</p><p>With the above, we‚Äôre able to allow for non-authenticated usage of some hard-coded chat rooms with a username. However, we have no form of authentication at this stage. We trust the user to set themselves to have any name, even if it‚Äôs the same as someone else. We have no way to uniquely identify a user, which is something that is crucial for having any form of permissioning, private discussions, notifications, and more.</p><h2 id="Creating-a-Basic-Authentication-System">Creating a Basic Authentication System</h2><p>For an absolutely rudimentary authentication system, we need to have:</p><ul><li>A signup page where users can create a username and password</li><li>A database to store these, with the password being encrypted</li><li>A backend system that can authenticate a user when logging in by checking their login details to the database, and return a token that the user can use for any actions which require authentication</li><li>An endpoint that can be used to get authentication credentials to be used with Ably</li></ul><p>In addition, we‚Äôd want:</p><ul><li>2-Factor Authentication</li><li>Password Resetting</li><li>Social media logins</li></ul><p>Each would be complex to implement, with many edge-cases and many security concerns to address. However, we thankfully knew of an existing solution for this, which <a href="https://auth0.com/blog/dependable-and-secure-realtime-in-spring-boot-with-auth0-and-ably/" target="_blank" rel="noreferrer noopener">we‚Äôve used in numerous projects</a> before, known as <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>.</p><p>Auth0, an authentication and authorization platform, simplifies this process immensely. Not only does it allow for easy integration with your login systems, but it also makes integrating other login services such as Google and Twitter simple. It allows for a quick setup of permissions, roles with set permissions attached, and these roles to be assigned to users. These users can then use various login systems to access the same account and thus have the same permissions.</p><h3 id="Setting-up-Auth0">Setting up Auth0</h3><p>To make use of Auth0, you firstly need to create and configure an account with them. To do this, firstly, <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">sign up to Auth0</a> on their website. Go through the signup process, setting whatever <a href="https://auth0.com/docs/get-started/create-tenants" target="_blank" rel="noreferrer noopener">tenant name and region you&#39;d like</a>. Once you‚Äôre signed up, go to the ‚ÄòApplications‚Äô part of the website. You should see ‚ÄòDefault App‚Äô here, which you can use for this tutorial, or you can create a new app if you so wish.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/62NYAkeQ25FA41mP2aspir/c6b325272a4447284036388fcae8a51c/Uploaded_from_Fully_Functional_Scalable_Chat_App" alt="Setting up Auth0"/></p><p>If you go to your app, you should arrive on the ‚ÄòSettings‚Äô page for the app. From here, you should make a note of the <strong>Domain</strong>, <strong>Client</strong> <strong>ID</strong>, and <strong>Client Secret</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5ksyxBrksEBwQSeCkZe5VP/945e24c31578d98a6425b52c61eefbe0/Uploaded_from_Fully_Functional_Scalable_Chat_App" alt="Setting up Auth0"/></p><p>On this <em>settings</em> tab, scroll down to the section called ‚ÄòApplication URIs.‚Äô In it, you should see a field for ‚ÄòAllowed Callback URLs‚Äô and ‚ÄòAllowed Logout URLs.‚Äô For context, the flow of a webpage using Auth0 is:</p><ul><li>Your site links a user to your Auth0 app‚Äôs login page, where they sign in</li><li>The Auth0 page redirects the user back to your website‚Äôs ‚Äòcallback‚Äô page</li><li>When the user wants to log out, they are directed to the Auth0 app‚Äôs logout page and then redirected back to the page specified in the ‚ÄòreturnTo‚Äô query passed to the logout page</li></ul><p>To avoid potential misuse and abuse, you need to specify what URLs Auth0 can redirect to. When hosting this chat app locally, it is hosted on localhost:8080, so set the <strong>Allowed Callback URLs</strong> to ‚Äò<a href="http://localhost:8080/auth0-landing" target="_blank" rel="noreferrer noopener">http://localhost:8080/auth0-landing</a>‚Äô. When a user logs out, we‚Äôll have the user redirected back to our main page, so set the <strong>Allowed Logout URLs</strong> to ‚Äò<a href="http://localhost:8080/" target="_blank" rel="noreferrer noopener">http://localhost:8080/</a>‚Äô.</p><h3 id="Using-an-Auth0-application-from-the-chat-application">Using an Auth0 application from the chat application</h3><p>With the Auth0 application set up, the actual chat application needs to make use of it. When someone attempts to sign up or log in via Auth0, we will need to redirect a user to the appropriate Auth0 endpoint, and the same needs to occur when a user logs out.</p><p>Auth0 provides both a <a href="https://www.npmjs.com/package/@auth0/auth0-react" target="_blank" rel="noreferrer noopener">React library</a> as well as a standard node module. Both work well, and in most cases, you‚Äôd probably want to use the React library as it will automatically handle a lot of authentication state sharing between different components.</p><p>For this project, however, we decided to go with the node module. This was due to a few reasons:</p><ul><li>We want the code to be easily understood, and as we will need to use the node module version from the <a href="https://azure.microsoft.com/en-gb/services/functions/" target="_blank" rel="noreferrer noopener">Serverless Functions</a> we‚Äôre using for our database, it makes sense to keep consistency between both frontend and backend</li><li>To use the Auth0 library, it needs to have specific details such as the endpoint name specified as part of a compilation. To have these details adjustable by anyone using the project, we‚Äôd need to set this as part of the environment variables. This variable would be required at two different stages, the compilation (which we do on GitHub using <a href="https://github.com/features/actions" target="_blank" rel="noreferrer noopener">GitHub Actions</a>) and at runtime (for the Serverless Functions which we‚Äôre hosting on Azure), we‚Äôd need to specify it in 2 separate environments.</li></ul><p>To avoid these complications, we decided only to store these Auth0 variables on the Serverless Functions and make them available via a Serverless Function to clients to use. We couldn‚Äôt use the React library to do this, as it has no method for asynchronous instantiation of details.</p><p>Using the node library, we just need to fetch the Auth0 configuration details from the appropriate Serverless Function endpoint, and then use those to instantiate an Auth0 client:</p><pre><code><span>import</span> createAuth0Client <span>from</span> <span>&#34;@auth0/auth0-spa-js&#34;</span><span>;</span>

<span>const</span> response <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#34;/api/oauth/config&#34;</span><span>)</span><span>;</span>
<span>const</span> configuration <span>=</span> <span>await</span> response<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>
cachedClient <span>=</span> <span>await</span> <span>createAuth0Client</span><span>(</span>configuration<span>)</span><span>;</span></code></pre><p>The Serverless Function at <code><span>/</span>api<span>/</span>oauth<span>/</span>config</code> simply responds with the configuration details we obtained earlier when setting up Auth0:</p><pre><code>  context<span>.</span>res <span>=</span> <span>{</span>
    status<span>:</span> <span>200</span><span>,</span>
    body<span>:</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>{</span>
          domain<span>:</span> process<span>.</span>env<span>.</span><span>AUTH0_DOMAIN</span><span>,</span>
          clientID<span>:</span> process<span>.</span>env<span>.</span><span>AUTH0_CLIENTID</span><span>,</span>
          client_id<span>:</span> process<span>.</span>env<span>.</span><span>AUTH0_CLIENTID</span><span>,</span>
          redirect_uri<span>:</span> process<span>.</span>env<span>.</span><span>AUTH0_REDIRECT_URI</span>
    <span>}</span><span>)</span>
  <span>}</span><span>;</span></code></pre><p>Now we can add a button to our chat application which will instantiate our Auth0 client as seen above, and then use the Auth0 library‚Äôs login method to redirect the user to the Auth0 login page for our app:</p><pre><code><span>export</span> <span>async</span> <span>function</span> <span>loginWithRedirect</span><span>(</span><span>event</span><span>)</span> <span>{</span>
  event<span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span>
  <span>const</span> auth0 <span>=</span> <span>await</span> <span>useAuth0</span><span>(</span><span>)</span><span>;</span>
  <span>await</span> auth0<span>.</span><span>loginWithRedirect</span><span>(</span><span>)</span><span>;</span>
<span>}</span></code></pre><p><img src="https://images.ctfassets.net/23aumh6u8s0i/Ce4CuRSlp8zXsf3nNvzmG/896b959bb5619c99cad5234d4d18f8f7/Uploaded_from_Fully_Functional_Scalable_Chat_App" alt="Setting up Auth0"/></p><p>When the user either signs up or enters valid credentials for logging in via Auth0, they need to be redirected to the page we specified when setting up Auth0, <code>localhost<span>:</span><span>8080</span><span>/</span>auth0<span>-</span>landing</code>.</p><p>With that, Auth0 is now up and running and we can use it as an authentication method!</p><h2 id="Storing-user-credentials">Storing user credentials</h2><p>We now have login credentials of our users stored in Auth0, but we need that data to be accessible and associated with data in our CosmosDB database as well. Ideally we‚Äôd <a href="https://auth0.com/docs/users/import-and-export-users/configure-automatic-migration-from-your-database" target="_blank" rel="noreferrer noopener">migrate our database‚Äôs contents over to Auth0</a> to avoid duplication of information, however for the time being we decided to keep data in CosmosDB.</p><p>As we will be treating our own database as the definitive location of data, we will want to also have our Auth0 users stored in our database as well. To do this, we can just intercept the response of signup via Auth0, and get the Auth0 ID and other details to store in our database.</p><p>Our CosmosDB will thus end up with a data structure for Users, defined in our <a href="https://github.com/ably-labs/fully-featured-scalable-chat-app/blob/main/api/common/metadata/User.ts" target="_blank" rel="noreferrer noopener">Users.ts</a> file, of:</p><ul><li>id: Unique ID for the User in our database</li><li>username: the login name they use if using our custom login system</li><li>oauthSub: The unique Auth0 ID if the user has an Auth0 login method associated with them</li><li>firstName: The user‚Äôs first name</li><li>lastName: The user‚Äôs last name</li><li>profileImgUrl: User‚Äôs profile image</li></ul><p>With the above, we can provide users with login methods for both Auth0. We will also have representations of all our users within our database.</p><h2 id="Conclusion">Conclusion</h2><p>With that, we have a way to authenticate users. With Auth0 we‚Äôre able to have 2FA, password recovery, and a smooth signup process handled for us. We have additional user information stored within CosmosDB, which we can use for providing additional information on users, which we can potentially use for profile pages, attaching details to messages.</p><p>With authentication done now, we still need to be able to authorize these users. We may know who someone is when they‚Äôre logged in, but we‚Äôre yet to define what permissions they should have, and how we‚Äôll control them.</p><p>Next, we‚Äôll be diving into how we can make use of a combination of Role-based Access Control (RBAC) and fine-grained permissions to define an authorization structure for users, as well as how to apply these permissions to both our backend as well as our real-time communications over WebSockets using Ably.</p><p>If you have any questions or thoughts about this project, please get in touch on <a href="https://twitter.com/ablyrealtime/" target="_blank" rel="noreferrer noopener">Twitter</a> or via <a href="mailto:devrel@ably.com" target="_blank" rel="noreferrer noopener">email</a> and we‚Äôd love to talk with you!</p></div></div>]]></content:encoded>
      <pubDate>Wed, 26 Jan 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Application Session Management</title>
      <link>https://auth0.com/blog/application-session-management-best-practices/</link>
      <description>Let&#39;s see how to maintain application sessions in different scenarios</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><h2 id="Terminology">Terminology</h2><ul><li><strong>SSO</strong> ‚Äî Single sign-on</li><li><strong>SLO</strong> ‚Äî Single Logout</li><li><strong>redirect_uri</strong> ‚Äî The callback URL after login</li><li><strong>returnTo</strong> ‚Äî The callback URL after logout</li><li><strong>TLD</strong> ‚Äî Top level domain</li><li><strong>ITP</strong> ‚Äî Intelligent tracking prevention (by Apple)</li><li><strong>IdP</strong> ‚Äî Identity provider</li></ul><h2 id="Problem-Definition">Problem Definition</h2><p>An application can determine the validity of an Auth0 Session via the use of <code><span>/</span>authorize</code> endpoint. Customers often implement some kind of polling against Auth0 <code><span>/</span>authorize</code> to determine the session validity and this may not be viable given the potential impact of hitting rate limits, ITP, and third-party cookie issues. This document describes scenarios on how to avoid such issues and implement approaches to maintain app sessions.</p><h2 id="Implementation-Details">Implementation Details</h2><h2 id="Sessions">Sessions</h2><p>A session identifies the user to the app after they have logged in, and is valid for a period of time during which the user can perform a set of interactions within that application. A single session can contain multiple activities (such as page views, events, social interactions, and e-commerce transactions), all of which are stored in the session temporarily while the user is connected.</p><h3 id="Session-layers-">Session layers:</h3><p>There are basically three <a href="https://auth0.com/docs/manage-users/sessions/session-layers" target="_blank" rel="noreferrer noopener">layers of sessions</a>:</p><ul><li><strong>Application session</strong>  Though the application uses Auth0 to authenticate users, it may still need to track that the user has logged in to the application.  For which, it may have to create a session (for eg., by depending on an access_token expiration).</li><li><strong>Auth0 session </strong>Auth0 also keeps a session for the user and stores their information inside a cookie. The next time a user is redirected to the Auth0 login, the user&#39;s information will be inferred.</li><li><strong>IdP session:</strong> This session is involved when Auth0 is federating to another third-party IdP.</li></ul><p>In addition to the above session layers, the application also has to be aware of token expirations, especially in OIDC flows.</p><ul><li><strong>Session vs Token:</strong> When a user successfully logs in, a session is created and maintained by Auth0 and indicates that the user has logged in and does not need to re-authenticate for the duration of that session.  The session will last until a <a href="https://auth0.com/docs/manage-users/sessions/configure-session-lifetime-settings" target="_blank" rel="noreferrer noopener">set expiration time</a> or the user logs out, or the SSO session cookie is deleted from the user‚Äôs browser.  So if a user leaves an application but later returns and attempts to login before the session expires they will not have to enter their credentials again. On the other hand, tokens are signed information that Auth0 sends back to the client application in a way to securely exchange the user authentication and authorization decisions with the client applications. <a href="https://auth0.com/docs/secure/tokens/access-tokens" target="_blank" rel="noreferrer noopener">Access tokens</a> represent authorization and are intended to grant the bearer access to an API either on behalf of a user or an application. <a href="https://auth0.com/docs/secure/tokens/id-tokens" target="_blank" rel="noreferrer noopener">Id tokens</a> represent authentication and contain information about the user who authenticated and are intended for the application the user is using.</li></ul><h3 id="SSO--SLO---how-they-work-">SSO, SLO &amp; how they work:</h3><p>Single Sign-on (SSO) occurs when a user logs in to one application and is then signed in to other applications in that agent/browser automatically. The user signs in only one time, hence the name of the feature (Single Sign-on).</p><p>Whenever users go to a domain that requires authentication, they are redirected to the centralized authentication domain where they may be asked to log in. If the user is already logged in at the authentication domain, the central authentication server will automatically re-authorize and re-consent(if required) the user‚Äôs request to the application and then the user can be immediately redirected to the original domain without signing in again.</p><p>Logout in the context of Auth0 implementation is the act of terminating an authenticated session. Auth0 provides tools to help you give users the ability to log out; this includes options for providing different levels of logout and also determining where the user will land after the logout is complete.</p><ul><li><strong>Application Session Layer Logout:</strong> Logging users out of your applications typically results in their application session being cleared, and this should be handled by your application: for the Application Session Layer, there is nothing within your Auth0 tenant that you need to use to facilitate session termination.</li><li><strong>Auth0 Session Layer Logout: </strong>You can log users out of the Auth0 session layer by redirecting them to the Auth0 Logout endpoint so Auth0 can clear the SSO cookie.</li><li><strong>Identity Provider Session Layer Logout:</strong> It is not necessary to log the users out of this session layer, but you may be able to use Auth0 to force the logout, if required, by <a href="https://auth0.com/docs/login/logout/log-users-out-of-idps" target="_blank" rel="noreferrer noopener">passing a parameter</a> to the Auth0 Logout endpoint (if supported by third party IDP). This is applicable for SAML scenarios and other scenarios are covered in the next sections.</li></ul><h2 id="Maintain-Sessions-in-SPAs-and-Regular-Web-Apps">Maintain Sessions in SPAs and Regular Web Apps</h2><h3 id="App-session-with-a-backend-">App session with a backend:</h3><p>Applications with a backend may track sessions with a server-side application session (a server-side cookie). This cookie may track its expiration by depending on the token response from Auth0. If the cookie expires, the backend has a few options to get the token response from Auth0 and then slide the app session.</p><ul><li>Perform a 302(redirect) to Auth0 /authorize endpoint. Here, if the session is still valid on Auth0, then new tokens are replied back on the callback service without asking for the user to re-login.</li><li>During initial authentication, request for a <a href="https://auth0.com/docs/tokens/refresh-token/current" target="_blank" rel="noreferrer noopener">refresh token</a>. Later, the backend can use<a href="https://auth0.com/docs/secure/tokens/refresh-tokens/use-refresh-tokens" target="_blank" rel="noreferrer noopener"> refresh token to get the new tokens</a> when the app session expires. This approach makes your backend a stateful service and can be extended to be a centralized session management service. The session cookie may only store an anchor (an identifier stored in it) and every time the front end makes a call to the backend, the cookie is associated with the request. The backend will get the refresh token(if required) from the storage using the mapped identifier (or anchor) in the app session cookie. However, this solution will be useful only when the front end &amp; backend are tied to the same TLD.</li><li>Review our <a href="https://auth0.com/docs/quickstart/webapp" target="_blank" rel="noreferrer noopener">Regular web app Quickstarts &amp; SDKs</a> for the implementation details.</li></ul><h3 id="App-session-on-SPA-">App session on SPA.</h3><p>Use the approach implemented by our <a href="https://auth0.com/docs/quickstart/spa" target="_blank" rel="noreferrer noopener">SDKs</a>. On load of the application, our SDKs check for a valid refresh<em>token (if there was a previous valid<a href="https://auth0.com/docs/secure/tokens/refresh-tokens/refresh-token-rotation" target="_blank" rel="noreferrer noopener"> rotating refresh_token</a> issued to the SPA). As a fallback mechanism, the SDK does a <a href="https://auth0.com/docs/authenticate/login/configure-silent-authentication" target="_blank" rel="noreferrer noopener">silentAuthentication</a> (prompt=none call, if no valid refresh</em>token exists) and only if all these steps fail, a complete redirect happens to Auth0 to check for SSO sessions.</p><ul><li>If any of the above validations succeed (refresh_token validation OR SilentAuthentication OR stateful request to Auth0 cookie), then the user is logged into the application automatically. Otherwise, the app can show a public page or Auth0 SDK will redirect the user to Universal login to complete an interactive flow.</li></ul><p>Client applications can still perform a prompt=none when there is an active user in that app, and only when the client app is unable to re-hydrate the cache with an existing rotating refresh<em>token (for eg., if the rotating refresh</em>token is stored in memory, then it is lost on page refresh and therefore, in this case, the fallback is prompt=none call to re-hydrate the app session). </p><p>This approach will avoid multiple unnecessary calls to Auth0 and will have a better user experience. </p><h2 id="Issues-with-Maintaining-App-Session-on-SPA-with-prompt-none">Issues with Maintaining App Session on SPA with prompt=none</h2><p>Every SPA application, if guarded with the Auth0 SDK, on load makes a prompt=none call to Auth0 except when there is a valid rotating refresh_token in the browser storage. This is required to seamlessly load the app session by checking for a valid Auth0 SSO cookie on that browser. </p><p>However, in a few cases, this can lead to rate limits if the client application is continuously polling against Auth0‚Äôs /authorize endpoint with prompt=none </p><p>For eg., </p><ul><li>The client application, to follow best practices, might have kept its local app session short and therefore the client application keeps refreshing its local session by continuously polling for the validity of the Auth0 SSO cookie with prompt=none iframe calls.</li><li>Poor client app implementation can lead the above polling to happen even when the user remains inactive(ie., in the background).</li><li>If the user remained inactive beyond the inactivity SSO timeout in Auth0, then Auth0 responds with <strong>‚Äúlogin_required‚Äù</strong>. However, the polling would continue in the background regardless of the error and therefore increase unwarranted traffic to Auth0 and the client application.</li></ul><p>Removing polling on client applications is necessary to reduce a significant amount of invalid network calls against Auth0 as well the client app. This is also required to avoid rate limits on Auth0 Authentication API</p><h2 id="A-Complex-Use-Case">A Complex Use Case</h2><p>If you made it this far, I believe you already know the best practices on how to maintain the app sessions. Most of the client implementations are not complex and might be able to establish sessions using Auth0 SDKs as I described in the previous sections. However, it is not always simple and I want to cover a complex use case.</p><p>Let‚Äôs consider a scenario where there are multiple Single Page Applications hosted on different domains (e.g. <a href="http://trave0.us/" target="_blank" rel="noreferrer noopener">travel0.us</a>,<a href="http://travel0.de/" target="_blank" rel="noreferrer noopener">travel0.de</a>, <a href="http://travel0.uk/" target="_blank" rel="noreferrer noopener">travel0.uk</a> and etc.), and Auth0 is tied to a different domain <a href="http://login.travel0.com/" target="_blank" rel="noreferrer noopener">login.travel0.com</a>. The requirement is for users to be able to use Single Sign-On (SSO) and Single Logout (SLO) across all these SPAs, seamlessly.</p><h3 id="Issues-">Issues:</h3><p>In this use case, Auth0 supports SSO out of the box using <a href="https://auth0.com/docs/configure/sso#sso-with-universal-login" target="_blank" rel="noreferrer noopener">Universal Login</a>. However, every SPA application in our above example should do a redirect to Auth0 to be able to load its local session. At times, customers want their users to seamlessly land on a logged-in page for every SPA on that browser if there is a valid session without redirects. This seamless landing on a logged-in page will require an iframe prompt=none call to Auth0  and will not work (when SPA and Auth0 are tied to different top-level domains)  in Safari due to <a href="https://webkit.org/tracking-prevention/" target="_blank" rel="noreferrer noopener">ITP</a> and eventually in Chrome due to <a href="https://blog.chromium.org/2020/01/building-more-private-web-path-towards.html" target="_blank" rel="noreferrer noopener">google‚Äôs efforts</a> to phase out the third-party cookies.</p><p>On the other side, the Auth0 <a href="https://auth0.com/docs/api/authentication#logout" target="_blank" rel="noreferrer noopener">Logout endpoint</a> does not cover all scenarios where users need to be signed out of all of the applications they used on that browser. Other than when Auth0 is using SAML, Auth0 does not natively support single logout (SLO). </p><p>Following are a few solutions that could be implemented to achieve the above scenarios and can be categorized into two patterns: Push and Poll.</p><h3 id="Polling-based-solutions">Polling based solutions</h3><p>Polling happens when the client application polls against an endpoint to determine the validity of a session.</p><h4 id="1--Poll-against-Auth0-using-prompt-none">1. Poll against Auth0 using prompt=none</h4><p>A common approach is where all the client applications periodically <a href="https://auth0.com/docs/authorization/configure-silent-authentication#poll-with-checksession-" target="_blank" rel="noreferrer noopener">poll</a> against Auth0 with prompt=none iframe calls to check if the user has initiated a logout request to Auth0 from any one of the apps and if so, perform a local logout. </p><p>This is commonly known as <strong>silentAuthentication</strong> and if the response is <strong>login_required</strong> from Auth0, the user will be logged out from the app, else the application will receive a new set of tokens using which it can re-establish its local session. </p><ul><li>This will not work (when SPAs and Auth0 are tied to different top-level domains) in Safari due to <a href="https://webkit.org/tracking-prevention/" target="_blank" rel="noreferrer noopener">ITP</a> and eventually in Chrome due to<a href="https://blog.chromium.org/2020/01/building-more-private-web-path-towards.html" target="_blank" rel="noreferrer noopener"> google‚Äôs efforts</a> to phase out the third-party cookies.</li><li>This also has a major impact on the application and end-users if the Auth0 authentication API rate limits are not considered.</li></ul><h4 id="2--Poll-against-a-client-side-endpoint">2. Poll against a client-side endpoint</h4><p>You can consider polling on the client-side to track logout. Set a client-side SLO cookie (eg: slo_flag:true) associated against the SPA domain when the user initiates a logout. Every other app on that browser can poll for that client-side cookie, to verify if there has been a logout issued against Auth0 and then kill its local session.</p><p>This approach can also be extended to determine if the login has happened on a different SPA in the same browser, using a different flag sso<em>flag:true. Only, upon detecting the flag (sso</em>flag:true), the current application can make a prompt=none call to establish its local session. This will reduce the number of prompt=none calls to Auth0. A similar SSO approach is used by Auth0 SDKs.</p><ul><li>This approach also has the same impact (when SPAs and Auth0 are tied to different Top-level domains) in Safari due to <a href="https://webkit.org/tracking-prevention/" target="_blank" rel="noreferrer noopener">ITP</a> and eventually in Chrome due to <a href="https://blog.chromium.org/2020/01/building-more-private-web-path-towards.html" target="_blank" rel="noreferrer noopener">google‚Äôs efforts</a> to phase out the third-party cookies.</li></ul><h3 id="Redirect-and-Chain-login-logout">Redirect and Chain login/logout</h3><p>To avoid ITP issues when dealing with multiple TLD‚Äôs and as an alternate to client-side cookie polling via iframe, you can implement a redirect using a common server-side login/logout endpoint. This common endpoint can be called by Auth0 <a href="https://auth0.com/docs/rules/redirect-users" target="_blank" rel="noreferrer noopener">redirect rules</a> if it is to chain login requests OR the common endpoint can itself be the application callback (the redirect_uri/returnTo that Auth0 redirects the user after successful login/logout) that chains the login/logout session to every other app in that browser. </p><p>This is similar to Google/youtube approach, where a common endpoint on google redirects to youtube to set the session on youtube.</p><ul><li>This could become complex if there are many applications in the ecosystem. The number of redirects will be equal to the number of applications and could lead to user experience issues if one of the redirects fails.</li><li>This implementation also depends on customer needs and the actual behavior of the browser.</li><li>Consider race conditions on how the /authorize calls are initiated against Auth0.</li></ul><h3 id="Push-events">Push events</h3><p>The push approach is when every application on logout, calls a common logout route that pushes logout events to all the apps in the ecosystem. This approach can solve problems like rate limiting, 3rd party cookie restrictions with browsers and therefore give a better UX.</p><h4 id="1--Using-web-socket">1. Using web-socket</h4><p>A <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API" target="_blank" rel="noreferrer noopener">Web Socket API</a> can be used to push the SLO event across apps that have subscribed to that slo-event and are open within a user-agent.</p><ol start="1"><li>On logout, all SPA applications can call the common logout URL <a href="https://logout.common.com/logout?slo" target="_blank" rel="noreferrer noopener">https://logout.common.com/logout</a></li><li>The common logout URL is a backend service in this example and will push an event to all SPA applications.</li></ol><pre><code><span>/*
*NOTE: This is sample code that references to an open library `pusher` as an example. The customer is free to use any messaging websocket service.
*The code cannot be used in production code without testing &amp; security review. This may need alteration to be production ready
*/</span>
<span>const</span> express <span>=</span> <span>require</span><span>(</span><span>&#39;express&#39;</span><span>)</span><span>;</span>
<span>const</span> bodyParser <span>=</span> <span>require</span><span>(</span><span>&#39;body-parser&#39;</span><span>)</span><span>;</span>
<span>const</span> cors <span>=</span> <span>require</span><span>(</span><span>&#39;cors&#39;</span><span>)</span><span>;</span>
<span>const</span> Pusher <span>=</span> <span>require</span><span>(</span><span>&#34;pusher&#34;</span><span>)</span><span>;</span>
<span>const</span> app <span>=</span> <span>express</span><span>(</span><span>)</span><span>;</span>

<span>const</span> corsOptions <span>=</span> <span>{</span>
    origin<span>:</span> <span>&#39;&lt;CALLING APP URL&gt;&#39;</span>
  <span>}</span><span>;</span>
app<span>.</span><span>use</span><span>(</span><span>cors</span><span>(</span>corsOptions<span>)</span><span>)</span><span>;</span>

<span>// create application/json parser</span>
<span>let</span> jsonParser <span>=</span> bodyParser<span>.</span><span>json</span><span>(</span><span>)</span>
<span>const</span> pusher <span>=</span> <span>new</span> <span>Pusher</span><span>(</span><span>{</span>
  appId<span>:</span> <span>&#34;YOUR_PUSHER_APP_ID&#34;</span><span>,</span>
  key<span>:</span> <span>&#34;YOUR_PUSHER_APP_KEY&#34;</span><span>,</span>
  secret<span>:</span> <span>&#34;YOUR_PUSHER_APP_SECRET&#34;</span><span>,</span>
  cluster<span>:</span> <span>&#34;YOUR_PUSHER_APP_CLUSTER&#34;</span><span>,</span>
  useTLS<span>:</span> <span>true</span>
<span>}</span><span>)</span><span>;</span>

app<span>.</span><span>get</span><span>(</span><span>&#39;/&#39;</span><span>,</span> <span>(</span><span>request<span>,</span> response</span><span>)</span> <span>=&gt;</span> <span>{</span>
<span>}</span><span>)</span><span>;</span>

<span>//Protect this endpoint with an access_token</span>
app<span>.</span><span>post</span><span>(</span><span>&#39;/api/v1/trigger/slo-event&#39;</span><span>,</span> jsonParser<span>,</span> <span>function</span> <span>(</span><span>req<span>,</span> res</span><span>)</span> <span>{</span>
    pusher<span>.</span><span>trigger</span><span>(</span>req<span>.</span>body<span>.</span>channelName<span>,</span> <span>&#34;slo-event&#34;</span><span>,</span> <span>{</span>
       slo<span>:</span> <span>true</span>
      <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>

app<span>.</span><span>listen</span><span>(</span><span>3002</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  console<span>.</span><span>log</span><span>(</span><span>&#39;Server running on localhost:3002&#39;</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><ol start="3"><li>The child SPA will call logout by subscribing to the channel event.</li></ol><pre><code><span>/*
*NOTE: This is sample code that references to an open library `pusher` as an example. The customer is free to use any messaging websocket service.
*The code cannot be used in production code without testing &amp; security review. This may need alteration to be production ready
*/</span>

<span>//..other code on the client SPA</span>

<span>let</span> channelName <span>=</span> <span>&#39;&#39;</span><span>;</span>

<span>async</span> <span>function</span> <span>postData</span><span>(</span>url <span>=</span> <span>&#39;&#39;</span><span>,</span> data <span>=</span> <span>{</span><span>}</span><span>)</span> <span>{</span>    
    <span>const</span> response <span>=</span> <span>await</span> <span>fetch</span><span>(</span>url<span>,</span> <span>{</span>
      method<span>:</span> <span>&#39;POST&#39;</span><span>,</span>
      mode<span>:</span> <span>&#39;cors&#39;</span>
      cache<span>:</span> <span>&#39;no-cache&#39;</span><span>,</span>
      credentials<span>:</span> <span>&#39;same-origin&#39;</span><span>,</span>
      headers<span>:</span> <span>{</span>
        <span>&#39;Content-Type&#39;</span><span>:</span> <span>&#39;application/json&#39;</span>
      <span>}</span><span>,</span>
      redirect<span>:</span> <span>&#39;follow&#39;</span><span>,</span>
      referrerPolicy<span>:</span> <span>&#39;no-referrer&#39;</span><span>,</span>
      body<span>:</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span>data<span>)</span>
    <span>}</span><span>)</span><span>;</span>
    <span>return</span> response<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>  

<span>//SLO event triggered within the app on visiting logout route or clicking a button</span>
<span>const</span> <span>triggerSLO</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>//Invoking below endpoint will send SLO notification to other apps</span>
  <span>postData</span><span>(</span><span>&#39;&lt;SERVER-URL&gt;/api/v1/trigger/slo-event&#39;</span><span>,</span> <span>{</span> channelName<span>:</span> channelName <span>}</span><span>)</span>
    <span>.</span><span>then</span><span>(</span><span>data</span> <span>=&gt;</span> <span>{</span>
      <span>localLogout</span><span>(</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>const</span> <span>localLogout</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>try</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span>&#34;local Logging out&#34;</span><span>)</span><span>;</span>
    auth0<span>.</span><span>logout</span><span>(</span><span>{</span>
      returnTo<span>:</span> window<span>.</span>location<span>.</span>origin
    <span>}</span><span>)</span><span>;</span>
  <span>}</span> <span>catch</span> <span>(</span>err<span>)</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span>&#34;Log out failed&#34;</span><span>,</span> err<span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>;</span>

<span>const</span> pusher<span>;</span>
<span>function</span> <span>setupPusher</span><span>(</span><span>channelName</span><span>)</span> <span>{</span>
  pusher <span>=</span> <span>new</span> <span>Pusher</span><span>(</span><span>YOUR_PUSHER_APP_KEY</span><span>,</span> <span>{</span>
    cluster<span>:</span> <span>YOUR_PUSHER_APP_CLUSTER</span><span>,</span>
    <span>//OTHER_AUTH_PARAMS</span>
  <span>}</span><span>)</span><span>;</span>
  <span>var</span> channel <span>=</span> pusher<span>.</span><span>subscribe</span><span>(</span>channelName<span>)</span><span>;</span>
  <span>channel</span><span>.</span><span>bind</span><span>(</span><span>&#39;slo-event&#39;</span><span>,</span> <span>(</span><span>data</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>if</span> <span>(</span>data<span>.</span>slo <span>===</span> <span>true</span><span>)</span> <span>{</span>
      <span>localLogout</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span><span>)</span>
<span>}</span>

<span>//Get fingerPrint of the user-agent to identify the user logged in applications</span>
  <span>const</span> fpPromise <span>=</span> <span>import</span><span>(</span><span>&#39;https://openfpcdn.io/fingerprintjs/v3&#39;</span><span>)</span>
                    <span>.</span><span>then</span><span>(</span><span>FingerprintJS</span> <span>=&gt;</span> FingerprintJS<span>.</span><span>load</span><span>(</span><span>)</span><span>)</span><span>;</span>

  <span>async</span> <span>function</span> <span>getVisitorData</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> fp <span>=</span> <span>await</span> <span>import</span><span>(</span><span>&#39;https://openfpcdn.io/fingerprintjs/v3&#39;</span><span>)</span>
      <span>.</span><span>then</span><span>(</span><span>FingerprintJS</span> <span>=&gt;</span> FingerprintJS<span>.</span><span>load</span><span>(</span><span>{</span> token<span>:</span> <span>&#39;&lt;TOKEN&gt;&#39;</span> <span>}</span><span>)</span><span>)</span><span>;</span>
    <span>return</span> <span>await</span> fp<span>.</span><span>get</span><span>(</span><span>{</span> extendedResult<span>:</span> <span>true</span> <span>}</span><span>)</span><span>;</span>
  <span>}</span>

<span>// Will run when page finishes loading</span>
window<span>.</span><span>onload</span> <span>=</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>    
  <span>const</span> <span>{</span> visitorId<span>,</span> incognito<span>}</span> <span>=</span> <span>await</span> <span>getVisitorData</span><span>(</span><span>)</span><span>;</span>
  <span>if</span> <span>(</span>incognito<span>)</span> <span>{</span>
    channelName <span>=</span> visitorId <span>+</span> <span>&#39;_incognito&#39;</span><span>;</span>    
  <span>}</span> 
  <span>setupPusher</span><span>(</span>channelName<span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><h4 id="2-Using-iFrame-postMessage-">2.Using iFrame postMessage.</h4><p>In this approach, every application will call a common logout route which in turn pushes messages to all apps using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" target="_blank" rel="noreferrer noopener">window.postMessage</a> via iFrame. Each app can subscribe to the message event.</p><ol start="1"><li>On logout, all applications would use the common logout URL <a href="https://logout.common.com/logout?slo" target="_blank" rel="noreferrer noopener">https://logout.common.com/logout?slo</a></li><li>The common logout URL will call each SPAs logout route in iframes. The common logout service can be registered with a list of allowed application logout URLs in the ecosystem or get the list of clients the user authenticated in token from Auth0 rule using context.sso.current_clients.</li></ol><pre><code><span>/*
*NOTE: This is sample code and can not be used in production code without testing and may need alteration to be production ready
*/</span>
<span>if</span> <span>(</span>window<span>.</span>location<span>.</span>search<span>.</span><span>includes</span><span>(</span><span>&#39;slo&#39;</span><span>)</span><span>)</span> <span>{</span>
   <span>var</span> iframe <span>=</span> document<span>.</span><span>createElement</span><span>(</span><span>&#39;iframe&#39;</span><span>)</span><span>;</span>
   iframe<span>.</span>src <span>=</span> <span>&#39;https://child.anotherdomain.com/logout?slo&#39;</span><span>;</span>
   iframe<span>.</span>width <span>=</span> <span>0</span><span>;</span>
   iframe<span>.</span>height <span>=</span> <span>0</span><span>;</span>
   document<span>.</span>body<span>.</span><span>appendChild</span><span>(</span>iframe<span>)</span><span>;</span>
 <span>}</span><span>;</span></code></pre><ol start="3"><li>The child SPA will clear its local session and send a message to the parent window</li></ol><pre><code><span>/*
*NOTE: This is sample code and can not be used in production code without testing and may need alteration to be production ready
*/</span>
<span>if</span> <span>(</span>window<span>.</span>location<span>.</span>search<span>.</span><span>includes</span><span>(</span><span>&#39;slo&#39;</span><span>)</span><span>)</span> <span>{</span>
   <span>return</span> <span>logout</span><span>(</span><span>)</span><span>;</span>
 <span>}</span>
<span>const</span> <span>logout</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
 <span>try</span> <span>{</span>
   console<span>.</span><span>log</span><span>(</span><span>&#34;local Logging out&#34;</span><span>)</span><span>;</span>
   auth0<span>.</span><span>logout</span><span>(</span><span>{</span>
     localOnly<span>:</span> <span>true</span>
   <span>}</span><span>)</span><span>;</span>
   window<span>.</span>parent<span>.</span><span>postMessage</span><span>(</span><span>&#34;logout from child.anotherdomain.com&#34;</span><span>,</span> <span>&#39;https://logout.common.com/logout&#39;</span><span>)</span><span>;</span>
 <span>}</span> <span>catch</span> <span>(</span>err<span>)</span> <span>{</span>


   console<span>.</span><span>log</span><span>(</span><span>&#34;Log out failed&#34;</span><span>,</span> err<span>)</span><span>;</span>
 <span>}</span>
<span>}</span><span>;</span></code></pre><ol start="4"><li>On successfully receiving a message from the child frame, the common logout URL will call Auth0 logout and finally return to the calling application.</li></ol><pre><code><span>/*
*NOTE: This is sample code and can not be used in production code without testing and may need alteration to be production ready
*/</span>
window<span>.</span><span>addEventListener</span><span>(</span><span>&#34;message&#34;</span><span>,</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span>
 <span>if</span> <span>(</span>event<span>.</span>origin <span>!==</span> <span>&#34;https://child.anotherdomain.com&#34;</span><span>)</span>
   <span>return</span><span>;</span>
 <span>logout</span><span>(</span>event<span>.</span>origin<span>)</span><span>;</span>
<span>}</span><span>,</span> <span>false</span><span>)</span><span>;</span>


<span>const</span> <span>logout</span> <span>=</span> <span>(</span><span>targetRedirect</span><span>)</span> <span>=&gt;</span> <span>{</span>
 <span>try</span> <span>{</span>
   auth0<span>.</span><span>logout</span><span>(</span><span>{</span>
     returnTo<span>:</span> targetRedirect
   <span>}</span><span>)</span><span>;</span>
 <span>}</span> <span>catch</span> <span>(</span>err<span>)</span> <span>{</span>
   console<span>.</span><span>log</span><span>(</span><span>&#34;Log out failed&#34;</span><span>,</span> err<span>)</span><span>;</span>
 <span>}</span>
<span>}</span><span>;</span></code></pre><ul><li>In the above example, Auth0 logout is called only after all SPA local sessions are removed. Depending on the use case, the customer can call Auth0 log out first and on logout returnTo, the common logout endpoint can then chain the logout requests to other SPAs via iframes.</li><li>Consider Race conditions where the logout is in progress and the user tries to login at the same.</li></ul><h2 id="Summary">Summary</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2IocPrKYHlRkMrSIVFacO8/cfb8ca5cdc293997c5806811a0783196/Screen_Shot_2022-01-17_at_12.05.43.png" alt="Summary"/></p></div></div>]]></content:encoded>
      <pubDate>Tue, 25 Jan 2022 15:01:00 +0000</pubDate>
    </item>
    <item>
      <title>How Developers Will Work in 2022</title>
      <link>https://auth0.com/blog/how-developers-will-work-in-2022/</link>
      <description>From tooling changes to the ascent of the hybrid event model, it‚Äôs all change, all the time.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>As a seasoned engineer, you&#39;ve seen your fair share of industry changes. Over the past forty years, developers have witnessed the emergence of new coding paradigms and approaches that have had a seismic change to how they work. Examples include the mainstreaming of object-oriented programming in the early 1990s and the emergence of multi-core programming in the late 2000s. </p><p>More recently, Covid-19 has turned the development world on its head, forcing teams to adapt to a brave new distributed world. As we enter the second year of the pandemic, it is increasingly clear that these changes aren&#39;t a temporary blip but rather a long-term reality. </p><p>So, what can we expect from 2022? We spoke to four development, product, and privacy experts at Auth0 to hear their predictions for the year ahead. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6esbX2g2LrG3jLK1FQjRyw/a110f6422adefcbfecdc53a67141b809/separator01.jpg" alt="Remote"/></p><p>It&#39;s been almost two years since the world was tipped on its head. Tech roles, from software development to system administration, moved from the cubicle farm to the home office. Slack DMs replaced the usual water cooler conversations. Although some firms have fully embraced these seismic shifts, notably Twitter and Pinterest, others are less keen. </p><p>Several Silicon Valley giants ‚Äî most notably Google and Apple ‚Äî set deadlines for a return to in-person working, although these have been pushed back again and again, following the emergence of the Delta and Omicron variants. Like it or not, remote working is here to stay for the foreseeable future. As Adam Housman, Group Product Manager at Auth0, explains, this will influence how developer tools are made, configured, and used. </p><p>&#34;I&#39;m excited about how the shift towards remote work is impacting the choices in tooling that design and development teams make. We see a lot more globally distributed teams, and that is directly influencing which SaaS products are gaining traction in modern software companies,&#34; said Housman. </p><p>&#34;Products that take the friction out of async collaboration are experiencing a massive amount of growth, but we&#39;ve reached the point that even companies which may have been late to react to the initial shift with COVID are now catching up,&#34; he added. </p><p>What does this mean in practice? Housman expects developer-facing SaaS products to compete for less on functionality but more on flexibility, interoperability, and ease of adoption. Scalability will be another key factor, Housman adds, and the most successful tools will be those that can work equally well across whole companies as with small teams. </p><p>&#34;Companies of all sizes are using way more SaaS products today than they did just a year ago, and we&#39;re seeing a distinct shift from top-down purchasing to autonomous teams championing the tools that they need to be effective. I am very bullish about it because that autonomy directly translates to being happier and more productive at work,&#34; he said. </p><p>&#34;We&#39;re experiencing a bit of a renaissance in SaaS right now; products that solve problems well, are delightful to use, and reduce friction in collaboration among distributed teams have an advantage over more traditional players that rely on top-down adoption. Those that can do all of that and also nail the land-and-expand motion ‚Äì by fulfilling all of the &#34;enterprise&#34; requirements around single sign-on, security, compliance, and auditing ‚Äì will be the clear winners.&#34;</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/35plETC7j2bdsO3J2pmYJV/b3d92308ff2b6b3dd4c6fcc0ffc8efbe/separator02.jpg" alt="Privacy"/></p><h2 id="Privacy--Engineering--and-Security-Teams-to-Work-Closer-Together">Privacy, Engineering, and Security Teams to Work Closer Together</h2><p>For the longest time, engineering operated as its own private silo, detached from the other tech-facing sides of the business: including security, operations, privacy, and governance. Over time, that began to change. </p><p>The real catalyst was GDPR. With a maximum possible fine of ‚Ç¨20m or 4 percent of total global revenue, organizations were incentivized to take data privacy and security seriously. Subsequent legislation, including the California Consumer Privacy Act (CCPA), as well as the upcoming California Privacy Rights Act (CPRA), only reinforced that.</p><p>Rachel Taylor, Compliance Manager at Auth0, believes this will transform the organizational landscape, with engineering, security, and privacy teams working as a single coherent unit. These &#34;shift left&#34; principles are already being adopted in some workplaces, including at Auth0. </p><p>&#34;As privacy laws continue to expand and as the regulatory bodies that govern them continue to hold organizations accountable, companies will not just be challenged with privacy by design, but by the concept of data protection as a service,&#34; said Taylor. </p><p>Much like secure-by-design, Privacy by Design sees engineering and design teams consider privacy and compliance requirements at the start of the development process rather than as an afterthought. Data Protection as a Service (DPaaS), meanwhile, allows organizations to rapidly harden their privacy posture through the provisioning of discrete, cloud-based services. </p><p>&#34;I am excited for this challenge, as I believe it offers a unique opportunity to bring teams such as privacy, security, and engineering closer together. Data privacy and data security roles will merge, as the responsibilities between them are further blurred, and the need for a cohesive unit will start to take shape,&#34; she added. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/48rgTNxGDCDabzYHWqKyXk/57df93d97881895281ed1ef585fe3adb/separator04.jpg"/></p><h2 id="DevSecOps-Becomes-More-Widespread">DevSecOps Becomes More Widespread</h2><p>David Telehowski, Director of Security Engineering at Auth0, echoed these sentiments, adding that he expected DevSecOps roles and approaches to become more common within organizations of a certain size. </p><p>The National Institute of Standards and Technology defines a DevSecOps platform as where security is ingrained during the design, building, deployment, and runtime phases. &#34;Integrating Security into DevOps practices and workflows enables vulnerabilities to be detected and quickly remediated in every phase of the DevOps lifecycle,&#34; said Telehowski. </p><p>This doesn&#39;t just bring security and privacy benefits but is liable to accelerate the development process, as a 2020 study from GitLab found. A majority of organizations surveyed integrated DevSecOps into their workflows, and 83% reported faster code releases, with 60% able to achieve multiple daily releases. </p><h2 id="Hybrid-Events-are-Here-to-Stay">Hybrid Events are Here to Stay</h2><p>The COVID-19 pandemic added dozens of new terms into our collective lexicons, including social distancing, spike protein, and viral load. But let&#39;s not forget &#34;Zoom fatigue,&#34; referring to the widespread disaffection with virtual meetings. </p><p>&#34;It&#39;s fashionable to complain about how hard and alienating virtual events are and to celebrate on social media the first in-person events we are able to attend,&#34; said Vittorio Bertocci, Principal Architect at Auth0. In practice, however, virtual events are here to stay, at least as a hybrid model. </p><p>&#34;Conference organizers got a taste of the incredible reach they can achieve when offering an experience that doesn&#39;t require the money, time, and complexity traditionally demanded when attending an in-person event. Many conferences achieved record (paying) attendee numbers, reaching audiences traditionally off-limits. They won&#39;t give that up,&#34; said Bertocci. </p><p>&#34;I expect a sharp increase in hybrid events, aimed both at developers and other interest groups, in 2022. Last year was the testbed for this model, but this will be the year when the industry irons out the wrinkles and brings hybrid events into the mainstream,&#34; he added. </p><p>This increased reach has an unavoidable cost. Large sectors of the economy support in-person events, from airlines and hotels to catering firms. These sectors will be the biggest losers from this shift. Bertocci also notes that organizers will have to create the technological underpinnings to support these hybrid events, from conference apps supporting both in-person and online attendees to virtual expo booths and lead generation tools. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1i5xKyG2hpADtJuntezwZp/5dd18cbb2c3806412ae6c4acdd3bc614/separator05.jpg"/></p><h2 id="Omicron-Uncertainty">Omicron Uncertainty</h2><p>The software development sector exists in a perpetual state of change. New frameworks and technologies emerge. Coders wrestle with new paradigms. Culture continues to evolve. This has always been the case but has only felt more true over the past two years. </p><p>The emergence of the Omicron variant offers more uncertainty, with organizations pushing back their office re-opening dates and international travel feeling riskier than ever. For the time being, remote working and socially-distanced webinars are here to stay. </p><p>Looking ahead to 2023, it&#39;s possible that things might remain in flux. However, devs are comfortable with responding to change, and I&#39;m personally curious to see how working models continue to evolve.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 24 Jan 2022 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Managing Trial Periods with Auth0 Actions</title>
      <link>https://auth0.com/blog/managing-trial-periods-with-auth0-actions/</link>
      <description>How to use Auth0 Actions to let users access your application or website for a trial period.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Assume you want to let users try your application&#39;s services for a given period of time, say 30 days. How can you let users register and then block them after the trial period expires? You can easily leverage Auth0 Actions to achieve this result.</p><h2 id="Setting-Up-the-Sample-App">Setting Up the Sample App</h2><p>To show you how to enable a trial period for your application, this article will be referring to a sample web application that allows the user to access a fictitious online catalog.</p><blockquote><p>The sample application you are going to use in this article is built with C# and requires <a href="https://dotnet.microsoft.com/en-us/download" target="_blank" rel="noreferrer noopener">.NET</a> installed on your machine. <u>However, the user registration customization you will implement is independent of your application&#39;s specific programming language and framework.</u></p></blockquote><p>You can download the sample application by cloning its GitHub repository with the following command:</p><pre><code><span>git</span> clone https://github.com/auth0-blog/acme-aspnet-mvc.git</code></pre><p>Once you download it, take a look at the <a href="https://github.com/auth0-blog/acme-aspnet-mvc/blob/main/README.md" target="_blank" rel="noreferrer noopener">README file</a> and follow its instructions to configure the application to use Auth0. You need an Auth0 account, and if you don&#39;t yet have it, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one</a>.</p><blockquote><p>If you want to learn the details of the sample application implementation, <a href="https://auth0.com/blog/add-authentication-aspnet-core-mvc/" target="_blank" rel="noreferrer noopener">this blog post describes how it has been integrated with the Auth0 authentication services</a>.</p></blockquote><p>After configuring the sample application, you can run it with the following command:</p><pre><code>dotnet run</code></pre><p>Now, head your browser to the <a href="https://localhost:7095/" target="_blank" rel="noreferrer noopener">https://localhost:7095/</a> address, you should get the following page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5yO9ER9JsSrsFGXj5e1w6e/3c4f71b3286b43249d0e89a3e7e44c70/acme-homepage-login.png" alt="Sample app home page"/></p><h2 id="Auth0-Actions-and-Flows">Auth0 Actions and Flows</h2><p>Once you have ensured that your application is properly configured and running, let&#39;s briefly explore Auth0&#39;s features that will allow you to implement the trial period: Auth0 Actions and Flows.</p><p><a href="https://auth0.com/docs/actions" target="_blank" rel="noreferrer noopener">Auth0 Actions</a> are JavaScript functions running in a Node.js environment executed when specific events happen in a few internal Auth0 Flows.</p><p><a href="https://auth0.com/docs/actions/triggers" target="_blank" rel="noreferrer noopener">Auth0 Flows</a> are the processes that can be extended with Actions. Each Flow is made up of one or more triggers and represents the logical pipeline through which information moves during a single point in the Auth0 journey.</p><p>For example, you can consider the Login Flow, which runs when a user logs in. This Flow has a post-login trigger: an event fired after the user logs in. You can handle this event through one or more Actions. In other words, you can see Actions as event handlers that run when a specific event fires in an Auth0 Flow.</p><p>The following is a graphical representation of an Action (<em>AddRoles</em>) that will be executed in the Login Flow after the user logs in:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1pJn7J2p7cICewJkSv4Ecj/4030cd2fa04c3df43e8c29b3c537b68c/auth0-action-in-login-flow.png" alt="Auth0 Action in the Login Flow"/></p><p>The following are the available Auth0 Flows you can customize with Actions:</p><ul><li><em>Login</em>, running when a user logs in.</li><li><em>Pre User Registration</em>, running before a user is added to the users&#39; store.</li><li><em>Post User Registration</em>, running after a user is added to the users&#39; store.</li><li><em>Post Change Password</em>, running after the user changes their password.</li><li><em>Send Phone Message</em>, running when you configure a custom <a href="https://auth0.com/docs/login/mfa" target="_blank" rel="noreferrer noopener">Multi-Factor Authentication (MFA)</a> provider.</li><li><em>Machine To Machine</em>, running when an access token is issued to a client using the <a href="https://auth0.com/docs/authorization/flows/client-credentials-flow" target="_blank" rel="noreferrer noopener">Client Credential Flow</a>.</li></ul><p>You will use a couple of these Flows to implement the trial period feature for the sample application.</p><p>To learn more about Actions, you can check out these blog posts for <a href="https://auth0.com/blog/introducing-auth0-actions/" target="_blank" rel="noreferrer noopener">a quick introduction to Auth0 Actions</a> and how they <a href="https://auth0.com/blog/actions-now-generally-available/" target="_blank" rel="noreferrer noopener">compare with the deprecated Rules and Hooks</a>.</p><h2 id="The-Trial-Period-Implementation">The Trial Period Implementation</h2><p>Once you have an idea of what Auth0 Flows and Actions are, let&#39;s outline how to implement the trial period feature for the sample application. You can identify the following steps:</p><ol start="1"><li><strong>Starting a trial</strong>: when the user registers with the application to access its catalog, you will calculate the trial expiration date and store it on the server side. You will do this step by creating an Action that customizes the <em>Pre User Registration</em> Flow. You will also learn you can leverage Auth0 to store the trial expiration date opportunely.</li><li><strong>Checking the trial validity</strong>: whenever the user logs in to the sample application, you have to compare the current date with the expiration date in order to determine whether the trial period is still valid. If the trial period is still active, the user is allowed to access the catalog. You will implement this step by customizing the <em>Login</em> Flow with an Action.</li><li><strong>Dealing with trial expiration</strong>: when the trial period expires, the user is not allowed to access the catalog. They will be redirected to a page inviting them to purchase full access to the application&#39;s services. The implementation of this step relies on the trial validity check Action and on a few changes to the sample application.</li></ol><p>The next sections will detail how to implement each step.</p><h2 id="Starting-a-Trial">Starting a Trial</h2><p>Let&#39;s start by implementing the first step of the trial: registering the expiration date when the user registers with your application.</p><p>Access your <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a> and select <a href="https://manage.auth0.com/#/actions/flows" target="_blank" rel="noreferrer noopener">Flows under the Actions</a> item from the left side menu. You should see the following screen in your browser:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4rUFsGdm1cYpgP6jS8xF98/ed055e37e3cb144cc7f5d540095b9ab3/auth0-flows-dashboard.png" alt="Auth0 Flows in the Auth0 Dashboard"/></p><p>This screen shows the Auth0 Flows you can customize with your Actions. For our purposes, click the <em>Pre User Registration</em> tile, and you will enter the following page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4A2eGE4V3nFeo5Azg3zKID/5ad7a54d30094484e39cdb526b8c6368/pre-user-registration-flow-editor.png" alt="Pre User Registration flow editor"/></p><p>This page allows you to add one or more Actions to the <em>Pre User Registration</em> Flow. You can add two types of Actions:</p><ul><li><em>Installed Actions</em>, i.e., ready to use <a href="https://marketplace.auth0.com/features/actions" target="_blank" rel="noreferrer noopener">Actions built by third parties and published in the Auth0 Marketplace</a>.</li><li><em>Custom Actions</em>, i.e., Actions you create from scratch.</li></ul><p>In this case, you will create your own custom Action. So, click the <em>+</em> icon to the upper-right corner of the <em>Add Action</em> section, and select the <em>Build Custom</em> menu item, as shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/WD1Alxdh14g8jrzztaD58/9597f8fd5a522f02b5816fdc525b4f60/add-custom-action-menu.png" alt="Add Custom Action menu"/></p><p>You will be asked to enter a name for the Action. Provide the <em>Start Trial Period</em> name and leave the other fields unchanged, as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5xcP8qv1OGdjDR2x2hYnUX/3669cde70d993814e1b617b6071ee499/create-action-dialog.png" alt="Create Action dialog"/></p><p>Now, click the <em>Create</em> button, and you will enter the Action editor. Your screen should be like the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4U14m0eatDAIQnhwSlB52y/dfe575a13dde7527d29984757e1af5e8/auth0-action-editor.png" alt="Auth0 Action editor"/></p><p>The code you find in the Action editor is the JavaScript function that will be executed after the user registers with the sample application. This function will be exported in the Node.js environment running on the Auth0 side.</p><p>The JavaScript function has an <code>event</code> parameter and an <code>api</code> parameter.</p><p>The <code>event</code> parameter provides some information about the current running environment. For example, it allows you to access the current user&#39;s data, the current request, the tenant, etc. For more details about <a href="https://auth0.com/docs/actions/triggers/pre-user-registration/event-object" target="_blank" rel="noreferrer noopener">the Pre User Registration <code>event</code> object, check out the documentation</a>.</p><p>The <code>api</code> parameter provides methods for changing the behavior of the Flow. For example, it allows you to deny access to your application or set specific metadata for the user or the application. For more details about <a href="https://auth0.com/docs/actions/triggers/pre-user-registration/api-object" target="_blank" rel="noreferrer noopener">the Pre User Registration <code>api</code> object, check out the documentation</a>.</p><p>To start the trial period for the user who is about to be registered, you have to write some code in the body of this JavaScript function. So, replace the content of the Action editor with the following code:</p><pre><code>exports<span>.</span><span>onExecutePreUserRegistration</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> today <span>=</span> <span>new</span> <span>Date</span><span>(</span><span>)</span><span>;</span>
  <span>const</span> expirationDate <span>=</span> <span>new</span> <span>Date</span><span>(</span><span>)</span><span>;</span>

  expirationDate<span>.</span><span>setDate</span><span>(</span>today<span>.</span><span>getDate</span><span>(</span><span>)</span> <span>+</span> <span>30</span><span>)</span><span>;</span>

  api<span>.</span>user<span>.</span><span>setAppMetadata</span><span>(</span><span>&#34;trial_expiration_date&#34;</span><span>,</span> expirationDate<span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>This code calculates the expiration date by adding 30 days to the current date and assigns it to the <code>trial_expiration_date</code> property of the <code>app_metadata</code> object bound to the current user. Actually, the <code><span>setAppMetadata</span><span>(</span><span>)</span></code> method creates a new custom property for the <code>app_metadata</code> object if it doesn&#39;t exist. To learn more about <a href="https://auth0.com/docs/users/metadata" target="_blank" rel="noreferrer noopener">managing metadata, check out the documentation</a>.</p><p>Now you have the Action that sets the trial expiration date for the user at registration time. Click the <em>Save Draft</em> button to save your changes, and then click the <em>Deploy</em> button to make the Action available to the <em>Pre User Registration</em> Flow. Then, go back to the Flow editor by clicking the <em>&lt;- Back to flow</em> link at the top left:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/63W5ueZ9Hy27DlaZvfjbH3/3dd6544c13c3b8535baf3ffcb3e107b0/auth0-action-editor-command-bar.png" alt="Auth0 Action editor&#39;s command bar"/></p><p>In the Flow editor, click the <em>Custom</em> tab of the <em>Add Action</em> section. Now you should see the Action you just created, as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2xHwQ4Mh8ioFsNQoptRdcx/b398e1438d651906321aa61969a8ce1f/auth0-flow-editor-with-custom-action.png" alt="Auth0 Flow editor with custom Action"/></p><p>Drag the <em>Start Trial Period</em> Action from the <em>Add Action</em> section and drop it between the <em>Start</em> and <em>Complete</em> nodes of the Flow diagram. You should get the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1jsCgX42Gex5CZibjDOYuo/118017f6c622200de5c94f33748c5e4a/pre-user-registration-flow-with-custom-action.png" alt="Pre User Registration Flow with custom Action"/></p><p>Click the <em>Apply</em> button to confirm your changes. Your application is now ready to create a trial period expiration date when a user registers with it.</p><h2 id="Checking-the-Trial-Validity">Checking the Trial Validity</h2><p>The next step focuses on checking if the trial period is not expired when the user logs in.</p><p>Move to <a href="https://manage.auth0.com/#/actions/flows" target="_blank" rel="noreferrer noopener">the list of Flows in the Auth0 Dashboard</a> and select the <em>Login</em> Flow. As you learned in the previous section, you have to create a custom Action by clicking the <em>Build Custom</em> menu item in the Add Action section of the Flow editor:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/WD1Alxdh14g8jrzztaD58/9597f8fd5a522f02b5816fdc525b4f60/add-custom-action-menu.png" alt="Add Custom Action menu"/></p><p>Assign the <em>Check Trial Validity</em> name your new Action and go to the Action editor by clicking the <em>Create</em> button. This time you will find the following code in the editor:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
<span>}</span><span>;</span></code></pre><p>This is the JavaScript function that will be executed after the user logs in. As before, this function has two parameters, <code>event</code> and <code>api</code>, related to information about the current running environment and methods for changing the behavior of the current Flow. Although these parameters have the same names as before, their structure is different since they are strictly related to the current Flow. Refer to the <a href="https://auth0.com/docs/actions/triggers/post-login/event-object" target="_blank" rel="noreferrer noopener">post-login <code>event</code> object</a> and <a href="https://auth0.com/docs/actions/triggers/post-login/api-object" target="_blank" rel="noreferrer noopener">post-login <code>api</code> object documentation</a> and <a href="https://auth0.com/docs/actions/triggers/post-login/api-object" target="_blank" rel="noreferrer noopener">post-login <code>api</code> object documentation</a> for specific details.</p><p>To check the validity of the trial period for the current user, replace the code in the Action editor with the following:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> today <span>=</span> <span>new</span> <span>Date</span><span>(</span><span>)</span><span>;</span>
  <span>const</span> expirationDate <span>=</span> <span>new</span> <span>Date</span><span>(</span>event<span>.</span>user<span>.</span>app_metadata<span>[</span><span>&#34;trial_expiration_date&#34;</span><span>]</span><span>)</span><span>;</span>

  <span>if</span> <span>(</span>today <span>&gt;</span> expirationDate<span>)</span> <span>{</span>
    api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span>&#34;trial_expiration&#34;</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>This code retrieves the expiration date from the <code>app_metadata</code> object for the current user and compares it with the current date. If the current date is before the expiration date, the Action does nothing. Otherwise, access is denied through the <code>api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span>)</span></code> method. The string <code>trial_expiration</code> passed to the <code><span>deny</span><span>(</span><span>)</span></code> method briefly explains the reason for the denied access.</p><p>Now that your second Action is ready, you know what to do: save it, then deploy it, finally go back to the flow and drop it there. And if you did everything so far, your <em>Login</em> Flow should look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6coyxG1rIyftprrUt1fnt/00f5646e05e3aa578dee0a04acc27872/login-flow-with-custom-action.png" alt="Login Flow with custom action"/></p><h2 id="Testing-the-Trial-Period">Testing the Trial Period</h2><p>Now you are ready to test what you&#39;ve built so far.</p><h3 id="Register-a-new-user">Register a new user</h3><p>If not already running, launch the sample application by typing the <code>dotnet run</code> command in a terminal window.</p><blockquote><p>Actions are implemented and deployed on the Auth0 side and they run when any of the Auth0 Flows are involved. So, it doesn&#39;t matter if your application is already running. You don&#39;t need to restart it.</p></blockquote><p>Then, click the <em>Login</em> link at the upper right corner of the application&#39;s home page. In the <a href="https://auth0.com/docs/login/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login page</a>, click the <em>Sign up</em> link highlighted below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6VizfIqgyfJkvIBtrOqrYt/f17bdf6d9f3d8f19f0d33cb1f880c9d4/auth0-universal-login-page.png" alt="Auth0 Universal Login page with the Sign up link highlighted"/></p><p>You will be asked to provide an email and a password to create a new user for your application. Once the new user is created, you can browse the application&#39;s catalog.</p><h3 id="Check-the-trial-expiration-date">Check the trial expiration date</h3><p>Let&#39;s take a look at what happened on the Auth0 side. Go to the <a href="https://manage.auth0.com/#/users" target="_blank" rel="noreferrer noopener">User Management section of your Auth0 Dashboard</a> and select the newly created user. Scrolling down the page containing the user data, you should find the <em>app_metadata</em> field with a JSON object similar to the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/31jivsHdHQySC4N3tYSAcS/0f4f68745716b0ef3bfcaecc52401f31/app_metadata-section.png" alt="app_metadata section for the user"/></p><p>As you can see, this field shows the <code>app_metadata</code> object with the <code>trial_expiration_date</code> the <em>Start Trial Period</em> Action set at registration time.</p><h3 id="Make-the-trial-period-expire">Make the trial period expire</h3><p>To verify that the Check Trial Validity Action works as expected, we can&#39;t wait... a month. You can accelerate the expiration of the trial period by simply editing the <em>app_metadata</em> field. So, change the value of the <code>trial_expiration_date</code> so that it is before the current date and click the <em>Save</em> button to update the user profile.</p><h3 id="Test-the-trial-period-expiration">Test the trial period expiration</h3><p>If you are logged in to the application, click the <em>Logout</em> link at the upper right corner of the page and log in to the application again.</p><p>This time you shouldn&#39;t be able to log in and access the application&#39;s catalog. What you will see is a page like the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/lD3EUGZ1bRfoML8DoykOP/8b51e6ee51f56cbf82ac936ed0abb3fd/access-denied-default-page.png" alt="Default page for access denied due to trial period expiration"/></p><p>You can deduce that you can&#39;t log in to the application because your trial period is expired, but the user experience is actually not the best you expected.</p><h2 id="Improving-the-User-Experience">Improving the User Experience</h2><p>The approach to handling the expiration of the trial period that we have implemented so far is a little crude. Actually, the user will not have a good experience with it unless your application catches the reason for non-access and gives user-friendly feedback.</p><blockquote><p>Properly handling the response from Auth0 and providing feedback to the user depends on your specific programming language and/or development framework.</p><p>What you have to know is that the <code><span>deny</span><span>(</span><span>)</span></code> method called on the Action side triggers a request to your <a href="https://auth0.com/docs/authenticate/login/redirect-users-after-login" target="_blank" rel="noreferrer noopener">callback URL</a> passing the <code>error</code> and <code>error_description</code> values as form data, as shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6vQOaKdXTqLz9Ep69zV9ct/0b7eae6e51824b842a77845cb799446f/trial-expiration-response.png" alt="Trial expiration response"/></p><p>In this section, you will learn how to deal with this response in the sample application, which uses the ASP.NET Core MVC programming model and the <a href="https://auth0.com/blog/exploring-auth0-aspnet-core-authentication-sdk/" target="_blank" rel="noreferrer noopener">Auth0 ASP.NET Core Authentication SDK</a>. </p></blockquote><p>To let the sample application users have a better experience when their trial period expires, you have to:</p><ol start="1"><li>Add a trial expiration dedicated page to your web application.</li><li>Catch the access denied error and redirect your user to this dedicated page when the trial period expires.</li></ol><h3 id="Adding-a-trial-expiration-page">Adding a trial expiration page</h3><blockquote><p>As said before, the sample application is built with C# in .NET. It uses the ASP.NET Core MVC framework, so the steps described in this subsection are strictly related to this development framework. <u>The goal of this step is to add a Web page to your application</u>, so feel free to adapt this step to your preferred development environment.</p></blockquote><p>Go to the folder where you downloaded the sample application. Then, move to the <code>Views<span>/</span>Home</code> folder and create a <code>TrialExpiration<span>.</span>cshtml</code> file. Put the following code into that file:</p><pre><code>@* Views/Home/TrialExpiration.cshtml *@

@{
    ViewData[&#34;Title&#34;] = &#34;Trial Expiration&#34;;
}
<span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>text-center<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>h1</span><span>&gt;</span></span>@ViewData[&#34;Title&#34;]<span><span><span>&lt;/</span>h1</span><span>&gt;</span></span>

    <span><span><span>&lt;</span>p</span><span>&gt;</span></span>
        Your trial period expired.<span><span><span>&lt;</span>br</span><span>&gt;</span></span>
        Subscribe to premium access!
    <span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span></code></pre><p>This is the markup of your trial expiration page.</p><p>Now, move to the <code>Controllers</code> folder under the project&#39;s root folder and add the code highlighted below to the <code>HomeController<span>.</span>cs</code> file:</p><pre><code><span>using</span> <span>System<span>.</span>Diagnostics</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>acme<span>.</span>Models</span><span>;</span>

<span>namespace</span> <span>acme<span>.</span>Controllers</span><span>;</span>

<span>public</span> <span>class</span> <span>HomeController</span> <span>:</span> <span><span>Controller</span></span>
<span>{</span>
  <span>// ...existing code...</span>
  
  <span>// üëá new code</span>
  <span>public</span> <span>IActionResult</span> <span>TrialExpiration</span><span>(</span><span>)</span>
  <span>{</span>
    <span>return</span> <span>View</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>
  <span>// üëÜ new code</span>
<span>}</span></code></pre><p>This code renders the markup of your trial expiration page within the application layout.</p><h3 id="Catching-the-access-denied-error">Catching the access denied error</h3><p>Now, let&#39;s enable the sample application to catch the access denied error and redirect users to the trial expiration page already created. Open the <code>Program<span>.</span>cs</code> file in the project&#39;s root folder and apply the changes highlighted in the following code snippet:</p><pre><code><span>using</span> <span>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span>
<span>// üëá new code</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>OpenIdConnect</span><span>;</span>
<span>// üëÜ new code</span>

<span><span>var</span></span> builder <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>;</span>

builder<span>.</span>Services
  <span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span> <span>{</span>
    options<span>.</span>Domain <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientId <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    options<span>.</span>Scope <span>=</span> <span>&#34;openid profile email&#34;</span><span>;</span>

    <span>// üëá new code</span>
    options<span>.</span>OpenIdConnectEvents <span>=</span> <span>new</span> <span>OpenIdConnectEvents</span><span>(</span><span>)</span> 
    <span>{</span>
      OnMessageReceived <span>=</span> <span>(</span>context<span>)</span> <span>=&gt;</span> <span>{</span>
        <span>if</span> <span>(</span>context<span>.</span>ProtocolMessage<span>.</span>Error <span>==</span> <span>&#34;access_denied&#34;</span> <span>&amp;&amp;</span>
              context<span>.</span>ProtocolMessage<span>.</span>ErrorDescription <span>==</span> <span>&#34;trial_expiration&#34;</span><span>)</span> <span>{</span>
            context<span>.</span><span>HandleResponse</span><span>(</span><span>)</span><span>;</span>
            context<span>.</span>Response<span>.</span><span>Redirect</span><span>(</span><span>&#34;/Home/TrialExpiration&#34;</span><span>)</span><span>;</span>
        <span>}</span>
        <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
      <span>}</span>
    <span>}</span><span>;</span>
    <span>// üëÜ new code</span>
  <span>}</span><span>)</span><span>;</span>

builder<span>.</span>Services<span>.</span><span>AddControllersWithViews</span><span>(</span><span>)</span><span>;</span>

<span>// ...existing code...</span></code></pre><p>The new code adds a handler to the OpenID Connect event <code>OnMessageReceived</code>. This handler simply checks that the received error is <code>access_denied</code> and the error description is <code>trial_expiration</code>. In this case, it redirects the user to the trial expiration page.</p><p>Now, stop your running application and restart it. As a result, the user will see the following page instead of the previously shown error page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/37m9KZmdC4amkk8MGzEiod/f58d2fe70e36849d4ad96f00845bf4a9/trial-expiration-page.png" alt="The trial expiration page"/></p><p>In the real world, the trial expiration page should provide a better user experience, like, for example, a form to sign up for the premium access and any other information that can help the user to continue using your application&#39;s services.</p><h2 id="Summary">Summary</h2><p>To recap, you started with a ready-to-use sample application already integrated with Auth0 and added a couple of Actions through the Auth0 Dashboard:</p><ul><li>The <em>Start Trial Period</em> Action, which associates the trial expiration date to the user when the user registers with the application, i.e., during the <em>Pre User Registration</em> Flow.</li><li>The <em>Check Trial Validity</em> Action, which verifies if the current date is beyond the expiration date  when the user logs in, i.e., during the <em>Login</em> Flow.</li></ul><p>These two simple Actions prepared the infrastructure to handle the trial period feature for the sample application. Finally, to improve the user experience, you created a page where to land users when their trial period expires.</p><p>By exploring this example, I hope you now have a better idea of what Auth0 Actions allow you to do and how you can customize the standard Auth0 integration behavior.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 19 Jan 2022 14:54:00 +0000</pubDate>
    </item>
    <item>
      <title>Add OpenID Connect to Angular Apps Quickly</title>
      <link>https://auth0.com/blog/add-oidc-to-angular-apps-quickly/</link>
      <description>This tutorial shows you how to add authentication to your Angular App with Auth0</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>AngularJS 1.0 was released in October 2010. At the time, it was considered one of the most revolutionary and popular web frameworks ever to see the light of day. Developers loved it, and created many apps with it. However, as a pioneer in the JS framework space, AngularJS had some growing pains and significant issues. The team went back to the drawing board for a major breaking release with Angular 2. It took two years to develop and influenced many devs to hop onto other frameworks in the meantime.</p><p>Today, five years after Angular 2 was released, we just call it ‚ÄúAngular‚Äù and its version numbers have far less meaning. Five years is a long time for a modern JS web framework to live and thrive. If you look at the number of Stack Overflow questions, you‚Äôll see that users struggle with React far more than Angular.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/59q6jcF1y3liZ2s5dHjFZ1/ff4258bdeac2cad19506a693b21c7e46/Uploaded_from_Add_OpenID_Connect_to_Angular_Apps_Quickly" alt="hotframeworks.com"/></p><p>I kid, I kid. üòÖ</p><p>I don‚Äôt think Stack Overflow tags indicate that developers have a hard time with the framework; I think they indicate a thriving community. The more people use technology, the more they submit questions for it.</p><p><a href="https://hotframeworks.com/" target="_blank" rel="noreferrer noopener">hotframeworks.com</a> lists a score that combines GitHub stars with Stack Overflow tags and says the top six web frameworks are as follows (at the time of this writing):</p><ol start="1"><li>React</li><li>ASP.NET MVC</li><li>Angular</li><li>Ruby on Rails</li><li>AngularJS</li><li>Vue.js</li></ol><p>Angular is still very popular among developers. If you‚Äôre developing an Angular app today, you probably need a way to authenticate your users. That‚Äôs where OpenID Connect (OIDC) can help you. OIDC is a layer on top of OAuth 2.0 that provides identity.</p><p>In this tutorial, I&#39;ll show you how to add OIDC authentication with Auth0 to a new Angular app in just a few steps.</p><h3 id="Prerequisites-">Prerequisites:</h3><ul><li>A favorite text editor or IDE. I recommend <a href="https://www.jetbrains.com/idea/" target="_blank" rel="noreferrer noopener">IntelliJ IDEA</a>, but I know many JavaScript developers prefer <a href="https://code.visualstudio.com/" target="_blank" rel="noreferrer noopener">Visual Studio Code</a>.</li><li><a href="http://nodejs.org/" target="_blank" rel="noreferrer noopener">Node.js</a> v14+ and npm installed.</li></ul><p>If you would rather follow along by watching a video, check out the screencast below from <a href="https://youtu.be/YiR7XFgsD8w" target="_blank" rel="noreferrer noopener">the OktaDev YouTube channel</a>.</p><p><iframe src="https://www.youtube.com/embed/YiR7XFgsD8w" frameborder="0" allowfullscreen=""></iframe></p><h2 id="Create-an-Angular-App">Create an Angular App</h2><p>First, you‚Äôll need to create a new Angular app with routing enabled. Install the Angular CLI globally, then create an app.</p><pre><code><span>npm</span> i -g @angular/cli@13
ng new auth0-demo --routing</code></pre><p>You‚Äôll be prompted to select your favorite stylesheet format. The selection you make doesn‚Äôt matter for this example since we‚Äôre focused on functionality rather than updating visuals.</p><h2 id="Add-Authentication-with-OpenID-Connect">Add Authentication with OpenID Connect</h2><p>To add authentication with Auth0, you‚Äôll first need a <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">free Auth0 account</a>. Install the <a href="https://github.com/auth0/auth0-cli#installation" target="_blank" rel="noreferrer noopener">Auth0 CLI</a> and run <code>auth0 login</code> to register your account. Then, run <code>auth0 apps create</code>. Use the name <code>auth0<span>-</span>demo</code> and specify a description of your choosing. Select Single Page Web Application and use <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>4200</span><span>/</span>home</code> for the Callback URL. Specify <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>4200</span></code> for the rest of the URLs. We‚Äôre using 4200 as the port here because that‚Äôs the default for local Angular development.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6treCQmKthgFUfWwzf3AfL/79c7378cb41c2b7fcdc603f7787b493e/Uploaded_from_Add_OpenID_Connect_to_Angular_Apps_Quickly" alt="Auth0 Apps Create"/></p><p>You can also use the Auth0 Console to create an OIDC app:</p><ul><li><a href="https://auth0.com/auth/login" target="_blank" rel="noreferrer noopener">Log in</a> to Auth0 or <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">create an account</a> if you don‚Äôt have one. Go to <strong>Applications</strong> &gt; <strong>Create Application</strong>.</li><li>Choose <strong>Single Page Web Applications</strong> as the application type and click <strong>Create</strong>.</li><li>Click <strong>Angular</strong>, then the <strong>Settings</strong> tab.</li><li>Add <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>4200</span><span>/</span>home</code> as an Allowed Callback URL and <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>4200</span></code> as a Logout URL.</li><li>Specify <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>4200</span></code> as an Allowed Origin and click <strong>Save Changes</strong> at the bottom.</li></ul><p>Once you have a new Angular app and Auth0 OIDC set up, you can use <a href="https://github.com/oktadev/schematics#angular--auth0" target="_blank" rel="noreferrer noopener">OktaDev Schematics</a> to add OAuth 2.0 and OIDC support to your Angular app. Be sure to execute this command in the folder for the app itself (<code>auth0<span>-</span>demo</code>) adjacent to <code><span>package</span><span>.</span>json</code>.</p><pre><code>ng <span>add</span> @oktadev/schematics --auth0</code></pre><p>The Auth0 CLI will prompt you for an issuer URL and client ID, which were displayed when setting up the app in Auth0. If you used the CLI, it would have shown the issuer URL right above the client ID.</p><pre><code><span>==</span><span>=</span> dev-0ua1y-go.us.auth0.com application created

  CLIENT ID            TJgZxGnlSkqUe6JfMFSipZcFsbpl6LS2</code></pre><p>This process will perform the following steps for you:</p><ol start="1"><li>Install the <a href="https://github.com/auth0/auth0-angular" target="_blank" rel="noreferrer noopener">Auth0 Angular SDK</a>.</li><li>Add <code>src<span>/</span>app<span>/</span>auth<span>-</span>routing<span>.</span>module<span>.</span>ts</code> with your OIDC configuration and initialization logic.</li><li>Configure an <code>AuthHttpInterceptor</code> that adds an <code>Authorization</code> header with an access token to outbound requests.</li><li>Create a <code>HomeComponent</code> and configure it with authentication logic.</li><li>Update unit tests for <code>AppComponent</code> and <code>HomeComponent</code> to mock Auth0.</li></ol><p>To see all the changes it makes to your files, see <a href="https://github.com/oktadev/auth0-angular-example/pull/1/files" target="_blank" rel="noreferrer noopener">this pull request on GitHub</a>. If you‚Äôre interested in learning more about Schematics, I recommend reading my <a href="https://developer.okta.com/blog/2019/02/13/angular-schematics" target="_blank" rel="noreferrer noopener">Use Angular Schematics to Simplify Your Life</a> tutorial.</p><h3 id="Test-your-Angular-authentication-flow">Test your Angular authentication flow</h3><p>Run <code>ng serve</code> in your app, and you should see a login button at <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>4200</span><span>/</span>home</code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/50ajbMEhMjKTlo8FFIrhcc/34ab5bd3e71ef2098232c1fa17094f7a/Uploaded_from_Add_OpenID_Connect_to_Angular_Apps_Quickly" alt="Auth0 Login button"/></p><p>Click the <strong>Login</strong> button and sign in with one of the configured users for your Auth0 application. Because this is just a demo, you probably haven‚Äôt done that - more likely, you should sign up as a new user.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4k6lvyaFm08105rMKbngMK/04946fb269344caaa466e995895816ee/Uploaded_from_Add_OpenID_Connect_to_Angular_Apps_Quickly" alt="Auth0 Login form"/></p><p>After login, you‚Äôll be redirected back to your app, and you‚Äôll see a <strong>Logout</strong> button displayed in the bottom left corner.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4wmWthcAoznrbP7iP9qQ6T/38b2188e91decdbdd2a3046a57410369/Uploaded_from_Add_OpenID_Connect_to_Angular_Apps_Quickly" alt="Auth0 Logout button"/></p><h3 id="Display-the-authenticated-user-s-name">Display the authenticated user‚Äôs name</h3><p>To display the authenticated user‚Äôs name, you can use the <code>user$</code> observable on the <code>AuthService</code> instance.</p><p>Modify <code>src<span>/</span>app<span>/</span>home<span>/</span>home<span>.</span>component<span>.</span>html</code> to display a welcome message to the user.</p><pre><code><span><span><span>&lt;</span>div</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>button</span> <span>*ngIf</span><span><span>=</span><span>&#34;</span>(auth.isAuthenticated$ | async) === false<span>&#34;</span></span> <span>(click)</span><span><span>=</span><span>&#34;</span>login()<span>&#34;</span></span> <span>id</span><span><span>=</span><span>&#34;</span>login<span>&#34;</span></span><span>&gt;</span></span>Login<span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>div</span> <span>*ngIf</span><span><span>=</span><span>&#34;</span>auth.user$ | async as user<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>h2</span><span>&gt;</span></span>Welcome, {{user?.name}}!<span><span><span>&lt;/</span>h2</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>button</span> <span>*ngIf</span><span><span>=</span><span>&#34;</span>auth.isAuthenticated$ | async<span>&#34;</span></span> <span>(click)</span><span><span>=</span><span>&#34;</span>logout()<span>&#34;</span></span> <span>id</span><span><span>=</span><span>&#34;</span>logout<span>&#34;</span></span><span>&gt;</span></span>Logout<span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span></code></pre><p>Refresh your app, and you should see your name displayed.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/40JjOQXUidYCgMIWgDYSdT/b012e9c1c44d0397f89145dc00521053/Uploaded_from_Add_OpenID_Connect_to_Angular_Apps_Quickly" alt="Display user&#39;s name"/></p><p>If everything works‚Äîcongrats!</p><h2 id="Learn-more-about-Angular-and-OpenID-Connect">Learn more about Angular and OpenID Connect</h2><p>I hope you enjoyed this quick tutorial on using Auth0 and OIDC for authentication in your Angular apps. If you‚Äôre looking for a more detailed step-by-step tutorial, please read <a href="https://auth0.com/blog/complete-guide-to-angular-user-authentication/" target="_blank" rel="noreferrer noopener">The Complete Guide to Angular User Authentication with Auth0</a>.</p><p>You can find the source code for the example on GitHub in the <a href="https://github.com/oktadev/auth0-angular-example" target="_blank" rel="noreferrer noopener">@oktadev/auth0-angular-example</a> repository.</p><p>To learn more about Angular and OIDC, check out the following blog posts:</p><ul><li><a href="https://developer.okta.com/blog/2021/11/10/angular-v13" target="_blank" rel="noreferrer noopener">What You Need to Know about Angular v13</a></li><li><a href="https://developer.okta.com/blog/2021/10/29/things-to-keep-in-mind-about-auth" target="_blank" rel="noreferrer noopener">The Things to Keep in Mind about Auth</a></li><li><a href="https://developer.okta.com/blog/2021/10/22/angular-graphql" target="_blank" rel="noreferrer noopener">A Quick Guide to Angular and GraphQL</a></li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2FKsfPuzkEluf4MALzOoLT/969e1b0d6b58723b2bf263a8799c5cd6/Uploaded_from_Add_OpenID_Connect_to_Angular_Apps_Quickly" alt="The Angular Mini-Book" width="392" height="512"/></p><p><i><a href="https://www.infoq.com/minibooks/angular-mini-book/" target="_blank" rel="noreferrer noopener">The Angular Mini-Book</a></i></p><p>I <a href="https://raibledesigns.com/rd/entry/the_angular_mini_book_1" target="_blank" rel="noreferrer noopener">just published a mini-book book on Angular</a> that might interest you too. It&#39;s called <a href="https://www.infoq.com/minibooks/angular-mini-book/" target="_blank" rel="noreferrer noopener">The Angular Mini-Book</a> and is available as a free download from InfoQ. The book is written tutorial-style and shows you how to develop a bare-bones application, test it, and deploy it. Then you&#39;ll move on to adding Bootstrap, Angular Material, continuous integration, and authentication. You&#39;ll also learn how to integrate Angular with Spring Boot (a popular REST API framework) and use security best practices like HTTPS and a content security policy.</p><p>If you liked this tutorial, chances are you&#39;ll like others we publish. Please follow <a href="https://twitter.com/auth0" target="_blank" rel="noreferrer noopener">Auth0</a> and <a href="https://twitter.com/oktadev" target="_blank" rel="noreferrer noopener">OktaDev</a> on Twitter to get notified when we publish new developer tutorials.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 18 Jan 2022 15:16:00 +0000</pubDate>
    </item>
    <item>
      <title>Send Slack Message After New User Sign Up with Auth0 Actions</title>
      <link>https://auth0.com/blog/send-slack-message-after-sign-up-with-auth0-actions/</link>
      <description>Use Auth0 Actions with webhooks to send a Slack message after a new user signs up.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Having a new person sign up for your website is an exciting experience. You feel a rush of energy every time someone chooses your service, enters their email and password into a &#34;Log in&#34; form, and clicks &#34;Sign Up.&#34; Get that jolt of excitement in real-time by creating an Auth0 Action to send a message to Slack when a new user registers an account.</p><h2 id="What-You-Need">What You Need</h2><ul><li><p>Auth0 Account. If you do not have one, you can sign up for a <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">free Auth0 account</a>.</p></li><li><p>Application in our Auth0 tenant. Any web-based, mobile, or desktop application will work. If you don&#39;t have any applications that use Auth0, you can download one from the <a href="https://auth0.com/docs/quickstarts/" target="_blank" rel="noreferrer noopener">Auth0 Quickstarts</a> page.</p></li><li><p>Slack account. If you belong to a Slack workspace, you already have one. If you don&#39;t have a Slack account, don&#39;t worry ‚Äî you can create one after creating a Slack workspace.</p></li><li><p>Slack workspace. You need access to a Slack workspace where the admins will approve your app, or one where you&#39;re an admin. If neither of these apply to you, follow the steps in the next section, where you&#39;ll set up a Slack workspace under your administrative control.</p></li></ul><h2 id="Create-a-Slack-Workspace">Create a Slack Workspace</h2><p>To approve apps in Slack, you need admin permissions. If you don&#39;t have a Slack workspace that you are the admin of, you can create your own free Slack workspace that will give you admin privileges. Go to the Slack <a href="https://slack.com/get-started#/createnew" target="_blank" rel="noreferrer noopener">Get Started page</a>. </p><p>Enter your email address and click <strong>Continue</strong>, or continue with Apple or Google. Check your email for a confirmation code. Enter your code, then click <strong>Create a Workspace</strong>. Go through the following pages to name the workspace and a channel. You can skip inviting people for this example. Congrats! Now you have a workspace, and you can create a Slack webhook.</p><h2 id="Create-a-Slack-Webhook">Create a Slack Webhook</h2><p>To post messages into Slack from outside sources, you need a webhook URL. <a href="https://en.wikipedia.org/wiki/Webhook" target="_blank" rel="noreferrer noopener">Webhooks</a> enable apps to &#34;talk&#34; to each other when something new happens. In this post, you&#39;ll take the email address the user entered into the Auth0 login box and send it to Slack as a message.</p><p>First, you&#39;ll need an app in your Slack workspace to send the webhook information to your Slack channel. Go to <a href="https://api.slack.com" target="_blank" rel="noreferrer noopener">api.slack.com</a> and click <strong>Create an app</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1r6NCn0k67X5fm6n418hPm/2bccddd6addc4eab2a8d312ad130adca/api.slack.com.png" alt="Slack API homepage"/></p><p>This will bring up the <em>Create an App</em> modal. Click <strong>From scratch</strong>. </p><p>The next modal you&#39;ll see is <em>Name app &amp; choose workspace</em>. Fill in an app name; you can use &#34;slack-test&#34; if you can&#39;t come up with something better. You can always change the name later when you think of something else. </p><p>Then select the workspace that you want to connect the app to. Make sure this is the correct app because you can&#39;t change the app&#39;s workspace later. After you pick a workspace, click <strong>Create App</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2gEJlNDHCE4pAVsnVK5pQ5/3820f59a4a5517fc32bfaff0dae304e6/name_app_workspace_page.png" alt="Slack Name app &amp; create workspace modal"/></p><p>You&#39;ll be taken to the Basic Information page. This page is where you turn on the ability to use webhooks and get your webhook URL. On the left side of the page, Click <strong>Incoming Webhooks</strong>. Click the toggle button on, and Slack will create a bot user if you don&#39;t already have one.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7GDOR9bo5twAIA9dyfSzx6/4d594a84e30394351cf05e8a0fb35611/turn_on_webhooks.png" alt="Slack Activate Incoming Webhooks page"/></p><p>The page will refresh, and a shiny new section, <em>Webhook URLs for Your Workspace,</em> will appear. To activate the webhook and create the URL used in your Auth0 Action, scroll to the bottom of the page and click <strong>Add New Webhook to Workspace</strong>. This button makes a shortcut to install Slack apps, and using it means you don&#39;t have to write any code to generate a webhook URL.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/234YTEWqT0T66SvEvnXb3p/8f64036f18b0a291e21a84eef10679ce/add_webhook_to_workspace.png" alt="Slack Add New Webhook to Workspace section"/></p><p>This next screen lets you know that your app wants to access the workspace. It will ask you what channel you want the app to post and give you a drop-down to choose what channel in your workspace you want the app to post in. Once you have selected the channel, click <strong>Allow</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1Xv1RqErttgUYQyCDEQzVn/babd1c8c1e20a3ad2dfdb8a3edf8131f/permissions_page.png" alt="Slack app permissions page"/></p><p>You&#39;re taken back to the <em>Incoming Webhooks</em> page. You&#39;ll now see the webhook URL has been filled in with a value, with the channel you selected for it and the date it was added. Copy and save the webhook URL somewhere safe; you&#39;ll need that later when you create a new Auth0 Action.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4VU8xMikQhXe20WvoNgMg6/0a5e8a29057ca51f305c45ef7af23a4b/webhooks_url.png" alt="Slack webhooks URL section"/></p><blockquote><p>Your webhook URL contains a secret. Don&#39;t share it online, including public Git repositories.</p></blockquote><p>Now that you have your webhook URL created for Slack, you need to head to <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0.com</a>, sign in, and create an Auth0 Action that will send Slack messages.</p><h2 id="Create-Post-User-Registration-Action">Create Post User Registration Action</h2><p>Auth0 Actions allow you to customize events like login and registration to add behaviors that go beyond the default Auth0 features. Actions have an in-browser code editor where you can write Node.js code that is stored and runs on infrastructure owned and maintained by Auth0.</p><p>Create your Action by clicking <strong>Actions &gt; Library</strong> on the left side of the Auth0 Dashboard.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1z3vTIqDIBzrT29Q3xI6IW/f7918c0dbcbac8bfc0583ad4f56b76c1/action_library.png" alt="Auth0 Dashboard"/></p><p>This page lists the Actions that have already been installed, and there&#39;s a <strong>Custom</strong> tab for actions you created. On the upper right side, click <strong>Build Custom</strong>. You&#39;ll see the <em>Create Action</em> modal, which asks to name your Action, assign when you want it to run, and which Node.js version you wish to use.</p><p>First, give your Action a name like &#34;Slack Message.&#34; Next, select the event that will cause the Action to run from the <strong>Trigger</strong> drop-down. For this example, select <strong>Post User Registration</strong>. Leave the <strong>Runtime</strong> selection set to the recommended version (Node 16 at the time of writing). Finally, with all those details filled in, click <strong>Create</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5Y0Jsw8yiTyxk8oFDd2rxX/bf1ffda407d666b3e9b6c2552df4ff3f/create_action_modal.png" alt="Auth0 Create Action Modal"/></p><p>You&#39;ll now see the in-browser code editor where you write the code that will run when your Action is triggered. Take a look around the code editor first. You&#39;ll see a &#34;play button&#34; icon for testing your Action before deploying it on the left. Under that, you&#39;ll see a key icon to enter secrets (such as webhook URLs). The box icon is where you click to add modules from NPM.</p><p>Above the code editor and to the right, there are three buttons. <strong>Version history</strong> lets you see and revert back to previous versions of the Action. Next is <strong>Save Draft</strong>; if you&#39;re not ready to finalize everything in your Action, you can save it as a draft to work on later. Lastly, there&#39;s <strong>Deploy</strong>, which you use when you&#39;ve tested your Action and it&#39;s ready for prime time!</p><p>The code editor is pre-populated with the appropriate code for the kind of Action you&#39;re writing. In this case, it contains the <code>onExecutePostUserRegistration</code> function. Inside this function, you&#39;ll write the code to run after the user registers a new account.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2ch3BgnVO8yVTMQUV5zld9/265f5d7076d825e224736fb8e4add861/actions_code_editor.png" alt="Actions Code Editor"/></p><h3 id="Add-webhook-URL-as-a-Secret">Add webhook URL as a Secret</h3><p>Time to use that webhook URL you&#39;ve been keeping safe! Click the key icon on the left side of the code editor. This will open the side menu; click the blue <strong>Add Secret</strong> button. This opens up the <strong>Define Secret</strong> modal, which has fields for the name of the secret and the value it will hold. </p><p>Name the secret <code><span>SLACK_WEBHOOK_URL</span></code> in the key field, then paste your Slack webhook URL into the value field. Now click <strong>Create</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3a0jfV88wbvNLC0f7WiypP/754705989067ae70d60cc1e5e8c21b37/define_secret_modal.png" alt="Auth0 Actions Define Secrets Modal"/></p><p>The page will refresh, and you&#39;ll see your secret has been added to the <em>Secrets</em> menu.</p><blockquote><p>When secrets are created, their values are never revealed. Auth0 encrypts and stores all secrets securely.</p></blockquote><h3 id="Add-npm-package">Add npm package</h3><p>With Actions, you can choose from over 1,000,000 public npm packages and add their functionality to your Action. This action will use the &#39;slack-notify&#39; npm package. It&#39;s a Node.js wrapper around the Slack webhook API that makes it easy to send notifications to Slack from external applications.</p><p>Click the box icon to bring up the <em>Modules</em> side menu and click the blue <strong>Add Module</strong> button. In this modal, you add the name and version of the npm package. Enter <strong>slack-notify</strong> for the name. The name has to match the package&#39;s name as listed in npm, so make sure you check its name to be sure you&#39;re providing the correct one. The version is set to the latest by default. Now click <strong>Create</strong>, and all the pieces to write the code that will send a message to Slack will be in place.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2w6qekeLIQ9Uz0csHjBbsu/83e7cdf29cc6a511afa9de96921fdf0d/add_module_modal.png" alt="Auth0 Actions add module modal"/></p><h3 id="Write-custom-logic">Write custom logic</h3><p>The in-dashboard code editor works like your own editor that you know and love. The code that you enter into it is hosted and maintained by Auth0. Whenever you want to make changes to your Action in the future, you can do so without touching your codebase.</p><p>First, you&#39;ll add the slack-notify npm package at the top of the code editor by typing <code><span>const</span> initSlackNotify <span>=</span> <span>require</span><span>(</span>slack<span>-</span>notify<span>)</span><span>.</span></code></p><p>Next, you&#39;ll see the <code>onExecutePostUserRegistration</code> function. This async JavaScript function will run after a user is registered and saved to the database. Create a <code>slack</code> variable and pass the slack-notify module with your secret webhook URL inside this function.</p><p>Every Action has an <code>event</code> object that has information related to the trigger. You&#39;ll use it to get access to the webhook URL you stored as a secret earlier. The code will look like this:</p><pre><code><span>const</span> slack <span>=</span> <span>initSlackNotify</span><span>(</span>event<span>.</span>secrets<span>.</span><span>SLACK_WEBHOOK_URL</span><span>)</span></code></pre><p>Then, below the <code>slack</code> variable, create a <code>message</code> variable that will include the text to be sent to the Slack channel. Set it to a template string with the text &#34;New User&#34; and the user&#39;s email address. The <code>event</code> object has the newly registered user&#39;s email address. You can display it by passing <code>event<span>.</span>user<span>.</span>email</code> to the template.</p><pre><code><span>const</span> message <span>=</span> <span><span>`</span><span>New User: </span><span><span>${</span>event<span>.</span>user<span>.</span>email<span>}</span></span><span>`</span></span></code></pre><p>Lastly, write the code to actually send the message. The slack-notify npm package has 3 different notification methods bundled already: <code>bug<span>,</span></code> <code>success<span>,</span></code> and <code>alert</code>.</p><ul><li><code>bug</code> <ul><li>used for errors.</li></ul></li><li><code>alert</code> <ul><li>used for when something important happens.</li></ul></li><li><code>success</code> <ul><li>used for when messages go through with no errors.</li></ul></li></ul><p>You&#39;ll use the <code>success</code> method in this example. Within the <code>success</code> method, pass in an object with a key of <code>text</code> (which is one of the built-in custom fields of the slack-notify package) set its value to the <code>message</code> variable.</p><pre><code>slack<span>.</span><span>success</span><span>(</span><span>{</span>
    text<span>:</span> message
  <span>}</span><span>)</span>
<span>}</span><span>;</span></code></pre><p>With this code, when a new user successfully signs up, a message with the user&#39;s email will be sent to Slack. </p><p>You should make sure it works as intended before deploying it. You can do this inside the Auth0 dashboard without having to leave the site. Click <strong>Save Draft</strong> in the upper right corner before starting the test.</p><p>Here is the complete code for the Action:</p><pre><code><span>const</span> initSlackNotify <span>=</span> <span>require</span><span>(</span><span>&#39;slack-notify&#39;</span><span>)</span>

exports<span>.</span><span>onExecutePostUserRegistration</span> <span>=</span> <span>async</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> slack <span>=</span> <span>initSlackNotify</span><span>(</span>event<span>.</span>secrets<span>.</span><span>SLACK_WEBHOOK_URL</span><span>)</span><span>;</span>
  <span>const</span> message <span>=</span> <span><span>`</span><span>New User: </span><span><span>${</span>event<span>.</span>user<span>.</span>email<span>}</span></span><span>`</span></span>

  slack<span>.</span><span>success</span><span>(</span><span>{</span>
    text<span>:</span> message
  <span>}</span><span>)</span>
<span>}</span><span>;</span></code></pre><h2 id="Test-the-Action--Then-Deploy-It">Test the Action, Then Deploy It</h2><p>With Actions, you can run tests right in the browser without making any changes in your app or &#34;live-testing&#34; with users. Click the &#34;play button&#34; icon on the left side of the code editor. With this section open, you can see the contents of the event object in case you want to use some of the other information. At the bottom of the page, click the <strong>Run</strong> button at the bottom of the screen. The &#34;Test Results&#34; screen slides up, and the <em>Commands</em> and <em>Error</em> fields should be empty.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/WvnMTcD6Vy7g1dA3ppecN/5a0e10a1dcfee7b03b24b83c9bbd796a/actions_test_results.png" alt="Auth0 Actions Test Results"/></p><p>Go to the Slack workspace you created earlier, and see the new message with the sample email address provided by the test event object.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4FjY3CKPEtfhejwhf2fWqP/d124c092d3a71d7b6a444e0cf75d43fe/slack-test-message.png" alt="Slack test message"/></p><p>With everything in working order, click <strong>Deploy</strong>. This will record the Action and give it a version number. This way, you can continue to make changes to the Action without affecting the deployed version. </p><p>Now that the Action is deployed, it&#39;s time to add it to your Auth0 tenant so you&#39;ll get notified when a new user signs up for your site!</p><h2 id="Add-the-Action-to-the-Post-User-Registration-Flow">Add the Action to the Post User Registration Flow</h2><p>The last thing to do is attach your new Action to a flow. Flows are different points in the Auth0 lifecycle, from logging in to saving a new user to the database. When you add an Action to one or more of these points, the Actions will trigger in the order in which they are listed.</p><p>You&#39;ll use the <em>Post User Registration</em> flow in this tutorial. On the left side of the screen, click <strong>Actions &gt; Flows</strong>. This will display all the currently available flows. Select <strong>Post User Registration</strong>, which executes after a user is added to the tenant‚Äôs user database.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6yrPstgkYrypbQvBm3rl36/1e4994a13aea747e09854d79ea5aab99/choose_flow.png" alt="Auth0 Actions Choose Flow page"/></p><p>The following pages show the Actions drag and drop flow visualizer. Here you can add one or more Actions that will run in order after the selected trigger. The Actions are on the right; this section has a tab for installed Actions from the Auth0 marketplace and a custom tab for Actions you created. Click <strong>Custom</strong>, then drag and drop your Slack action between the <em>Start</em> and <em>Complete</em> points.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3FULQXi17MPJEnpIcAFo7B/50c27ca253d113dc8dac29a215b04ae1/actions_flow.png" alt="Auth0 Actions Flow visualizer"/></p><p>Once that is done, click <strong>Apply</strong>. Now the Action is ready for prime time and real users! </p><p>Sign up a new user on any of the sites in your Auth0 tenant, and you should see that user‚Äôs email address appears in Slack.</p><blockquote><p>You could also use the <em>Try your Login</em> box option in the Auth0 dashboard&#39;s <em>Getting Started</em> page.</p></blockquote><h2 id="Conclusion">Conclusion</h2><p>Actions offer you new opportunities to build authentication experiences that are truly unique to you and your application. The access to npm packages lets you add custom code and reduce maintenance for you. Testing your code in the browser without running a local build saves you time. The drag-and-drop editor lets you add a new feature without touching your own codebase, because the Actions code is hosted by Auth0!</p><p>Now that you know to create a custom Action, check out the <a href="https://auth0.com/docs/customize/actions/triggers" target="_blank" rel="noreferrer noopener"><em>Actions Triggers</em> page</a> in the Auth0 docs to see what other kinds of Actions you could develop.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 18 Jan 2022 15:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Skyscanner Wins KuppingerCole Customer Authentication Award with Auth0</title>
      <link>https://auth0.com/blog/skyscanner-wins-kuppingercole-customer-authentication-award-with-auth0/</link>
      <description>Global travel marketplace uses Auth0 to eliminate passwords and block suspicious login activity for millions of customers</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>LONDON ‚Äì 13 January 2021</strong> ‚Äì<a href="https://auth0.com" target="_blank" rel="noreferrer noopener"> Auth0</a>, a product unit within<a href="https://www.okta.com/" target="_blank" rel="noreferrer noopener"> Okta</a> (NASDAQ: OKTA), today congratulates its customer, <a href="https://skyscanner.net" target="_blank" rel="noreferrer noopener">Skyscanner</a>, the global travel marketplace, on receiving the 2021 European Identity and Cloud Award for Customer Authentication, presented by <a href="https://www.kuppingercole.com/" target="_blank" rel="noreferrer noopener">KuppingerCole Analysts AG</a>. The winning customer identity project, designed to put travelers first with a simple and secure user experience, helped Skyscanner eliminate nearly all passwords for millions of customers, while blocking suspicious login activity that could signal an attack.</p><p>‚ÄúSkyscanner‚Äôs mission is to lead the global transformation for modern and sustainable travel. This includes leveraging Auth0‚Äôs modern identity platform to give our customers a complete booking experience, while keeping their data secure,‚Äù said Brett Bunting, principal product manager at Skyscanner. ‚ÄúIt is an honor and a privilege to receive this award from KuppingerCole, as we work to make booking travel safe and friction-free for everyone.‚Äù</p><p>Using the Auth0 platform, Skyscanner‚Äôs development team introduced <a href="https://auth0.com/resources/whitepapers/passwordless-authentication" target="_blank" rel="noreferrer noopener">‚Äúpasswordless‚Äù authentication</a>, along with intelligent security features to detect and stop malicious attempts to access user accounts. Travelers can now sign up for a Skyscanner account simply and securely with just one click using either a one-time password (OTP) delivered via email, or Google One Tap, which prompts users to log in with their existing Google account. </p><p>Skyscanner was also among the first to use Auth0‚Äôs Attack Protection suite to defend against breached passwords, suspicious IP addresses, and bots and scripted attacks, without adding friction for legitimate customers. Travel and retail brands are targeted most by brute force attacks, followed by organizations in the industrial services, government, and technology sectors, according to <a href="https://auth0.com/resources/whitepapers/state-of-security-identity-report" target="_blank" rel="noreferrer noopener">Auth0‚Äôs 2021 State of Secure Identity Report</a>. </p><p>‚ÄúEliminating passwords and replacing them with strong yet adaptive and frictionless multi-factor authentication is the approach we as security experts have been promoting for years, and yet successful projects of this kind are still quite rare,‚Äù said KuppingerCole Senior Analyst Alexei Balaganski in his laudation at the award ceremony. ‚ÄúAll this makes the project we honor today even more impressive, considering its sheer scale: Skyscanner serves millions of users from all around the world, seamlessly supporting a broad range of authentication options and protecting its customers and own infrastructure from cyberattacks.‚Äù</p><p>For the list of 2021 European Identity and Cloud Award winners, please visit the <a href="https://www.kuppingercole.com/eic-2021-awards" target="_blank" rel="noreferrer noopener">KuppingerCole website</a>.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Thu, 13 Jan 2022 15:22:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Public Sector Index Shows Governments Struggle to Provide Trustworthy Online Citizen Services</title>
      <link>https://auth0.com/blog/auth0-public-sector-index-shows-governments-struggle-to-provide-trustworthy-online-citizen-services/</link>
      <description>New global report highlights how identity is foundational in helping governments improve existing services, and launch new ones faster and more securely</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>BELLEVUE, Wash.</strong> <strong>‚Äì January 12, 2022</strong> ‚Äì<a href="https://auth0.com/" target="_blank" rel="noreferrer noopener"> Auth0</a>, a product unit within<a href="https://www.okta.com/" target="_blank" rel="noreferrer noopener"> Okta</a> (NASDAQ: OKTA), today released the findings of its first <a href="https://www.auth0.com/public-sector/identity-index-report" target="_blank" rel="noreferrer noopener">Public Sector Identity Index</a>, a global research report that provides government technology leaders with insight into the identity maturity of public sector organizations around the world. The report highlights the importance of a centralized identity strategy in putting safe and accessible services into the hands of citizens faster.</p><p>Over the past two years, many public sector organizations were prompted by the immediate need to deploy digital infrastructure to maintain continuity of their services amid the COVID-19 pandemic ‚Äî such as offering citizens license renewals online and virtual education ‚Äî and are now grappling with the impacts on cybersecurity and user experience. From the Executive Order on ‚ÄòImproving the Nation‚Äôs Cybersecurity‚Äô in the U.S., to digital identity and Single Sign-On (SSO) initiatives in the UK and Australia, enabling employees, citizens, and other government entities to access all of these applications easily and securely has become a demand around the world. </p><p>The 2022 Public Sector Identity Index, conducted by Auth0 and <a href="https://www.marketconnectionsinc.com/" target="_blank" rel="noreferrer noopener">Market Connections</a>, captures the perceptions of 850 IT and line of business decision-makers within national and state/local government organizations across the U.S., UK, and ANZ (Australia and New Zealand) with regard to their <a href="https://auth0.com/resources/whitepapers/how-identity-forms-a-foundation-for-digital-govenrment" target="_blank" rel="noreferrer noopener">Identity and Access Management (IAM)</a> strategy.</p><p>The report‚Äôs key findings include:</p><ul><li>Only one in five are extremely confident in either the security (17%) or ease of use (19%) of their current authentication solution.</li><li>Username and password is the most frequently used authentication method by citizens (86%), compared to very little usage of biometric or passwordless authentication (16%).</li><li>Four in ten are currently building their own IAM solution in-house (41%), and cite speed to implementation (83%) and using internal staff to manage IAM internally (82%) as two of the biggest pain points in doing so.</li><li>Most governments are looking to expand their digital services in the next two years (75%) and rank protecting citizen‚Äôs privacy and data as most important when thinking about citizen services (73%).</li></ul><p>Regional analysis shows U.S. respondents rank ensuring citizens‚Äô trust in digital services as an area of high importance (71%), but have less confidence in their organization‚Äôs ability to deliver this (56%). Similar discrepancies in importance versus confidence in delivery include speed in adding new services in the UK (66% importance vs. 48% confidence), and improving the user experience in ANZ (72% importance vs. 60% confidence).</p><p>Dean Scontras, Vice President of State and Local Government and Education (SLED) at Okta, said: ‚ÄúDigitization is likely to continue in light of Zero Trust mandates and mounting consumer expectations. Public sector organizations greatly benefit from bringing their identity management strategy in line with their digital goals. While there is a strong focus on securing citizen data, the vast majority of applications are still protected by a username and password, despite their well-documented security risks.‚Äù</p><p>According to Forrester Research, the public sector has a massive influence on the entire economy making up 30% of the global GDP and 33% of the global workforce, and the global research firm predicts that more governments will adopt Zero Trust frameworks to revive public trust in digital services.<a href="#1"><sup>1</sup></a></p><p>An <a href="https://www.youtube.com/watch?v=g7ZzOJQwRsE" target="_blank" rel="noreferrer noopener">Identity-First approach</a> puts identity at the center of government digital transformation, while also laying the foundation for a Zero Trust security model. Key to this approach are modern login technologies that replace traditional passwords, and introduce friction only when suspicious behavior is detected. By making the shift to Identity-First, organizations like <a href="https://auth0.com/case-studies/larimer-county/" target="_blank" rel="noreferrer noopener">Larimer County</a> provide easy and seamless access for legitimate users, while decreasing the risk of security and compliance breaches.</p><p>Jessica Figueras, a cybercrime and digital identity advisor to governments and Okta consultant, said: ‚ÄúIn the face of increasing digitization, skills shortages, and online harms, governments are taking a hard look at the technologies they can bring onboard to help them reach their digital goals. The research suggests that identity is one such technology that can help the public sector do more with less.‚Äù</p><p>To learn more and download the full report, please visit: <a href="https://www.auth0.com/public-sector/identity-index-report" target="_blank" rel="noreferrer noopener">2022 Auth0 Public Sector Identity Index</a>.</p><h2 id="Methodology">Methodology</h2><p>Auth0 engaged Market Connections to design an online survey of 850 IT and line of business decision-makers within national and state/local governments in the U.S. (200 federal, 200 state &amp; local), UK (100 federal, 100 state &amp; local), and ANZ (Australia and New Zealand) (155 federal/national, 95 state &amp; local), fielded in September-October 2021.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h2 id="About-Okta">About Okta</h2><p>Okta is the leading independent identity provider. The Okta Identity Cloud enables organizations to securely connect the right people to the right technologies at the right time. With more than 7,000 pre-built integrations to applications and infrastructure providers, Okta provides simple and secure access to people and organizations everywhere, giving them the confidence to reach their full potential. More than 14,000 organizations, including JetBlue, Nordstrom, Siemens, Slack, Takeda, Teach for America, and Twilio, trust Okta to help protect the identities of their workforces and customers.</p><h3 id="Media-Contacts">Media Contacts</h3><p>Global Communications<br/>Auth0 <br/><a href="mailto:press@auth0.com" target="_blank" rel="noreferrer noopener">press@auth0.com</a><br/></p><p>Okta<br/><a href="mailto:press@okta.com" target="_blank" rel="noreferrer noopener">press@okta.com</a><br/></p><h3 id="Investor-Contact-">Investor Contact:</h3><p>Investor Relations <br/><a href="mailto:investor@okta.com" target="_blank" rel="noreferrer noopener">investor@okta.com</a><br/></p><p><strong>Disclaimer:</strong>
Research reports and related summaries referenced herein are provided for informational purposes only, and consist of the opinions of the organizations publishing such research and should not be construed as statements of fact. Okta and Auth0 make no representations, warranties, or other assurances with respect to such research.</p>
</div></div>]]></content:encoded>
      <pubDate>Wed, 12 Jan 2022 13:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Quick Tips and Tricks for Auth0 Actions</title>
      <link>https://auth0.com/blog/quick-tips-tricks-auth0-actions/</link>
      <description>Here‚Äôs a collection of Actions that you can write quickly to perform useful tasks.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><a href="https://auth0.com/docs/actions" target="_blank" rel="noreferrer noopener">Actions</a> make it possible for you to customize the way Auth0 works. They do this by letting you insert scripts ‚Äî called <em>Actions</em> ‚Äî into various Auth0 workflows to add functionality and enhance your users‚Äô experience.</p><p>Actions can be complex, but they don‚Äôt need to be. In this article, I‚Äôll show you a handful of Actions that can you can enter in a minute or two, but perform tasks that you‚Äôll find useful in the day-to-day running of your applications.</p><h2 id="Redirect-Users-to-a--Downtime--Page">Redirect Users to a ‚ÄúDowntime‚Äù Page</h2><p>Sooner or later, your application will have downtime. If all goes well, it will be <em>scheduled</em> downtime, but there will likely be <em>unscheduled</em> downtime too. In either case, it‚Äôs useful to have a web page where you can redirect users to inform them that your application is unavailable and provide additional details.</p><p>You can do this by adding the following Action to the <a href="https://manage.auth0.com/#/actions/flows/login/" target="_blank" rel="noreferrer noopener">Login flow</a>, replacing <code><span>{</span><span>SYSTEM</span> <span>DOWNTIME</span> <span>PAGE</span> <span>URL</span><span>}</span></code> with the location of the web page explaining the downtime:</p><pre><code><span>// Login flow</span>

exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  api<span>.</span>redirect<span>.</span><span>sendUserTo</span><span>(</span><span>&#34;{SYSTEM DOWNTIME PAGE URL}&#34;</span><span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>When your application is down, drag this Action into your tenant‚Äôs Login flow. It uses the <code>api<span>.</span>redirect<span>.</span><span>sendUserTo</span><span>(</span><span>)</span></code> method to redirect the user to the given URL after they log in.</p><p>Keep in mind that users will see the downtime page only after logging in successfully.</p><h2 id="Temporarily-Disable-New-Account-Sign-ups">Temporarily Disable New Account Sign-ups</h2><p>It <em>is</em> possible to have too much of a good thing. You generally want many users signing up to use your application, but there can be times when you need to stop registration to scale up your systems or allow your staff to catch up.</p><p>If you‚Äôre ever in this kind of situation, one of the measures you can take is to disable sign-ups temporarily. You can do this by creating a new Action named ‚ÄúRefuse New Sign-ups‚Äù in the <a href="https://manage.auth0.com/#/actions/flows/pre-user-signup/" target="_blank" rel="noreferrer noopener">Pre User Registration flow</a>:</p><pre><code><span>// Pre User Registration flow</span>

exports<span>.</span><span>onExecutePreUserRegistration</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span>&#39;too_many_signups&#39;</span><span>,</span> <span>&#34;We‚Äôre not accepting sign-ups at the moment.&#34;</span><span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>This Action uses the <code>api<span>.</span>access<span>.</span><span>deny</span><span>(</span><span>)</span></code> method, which cancels the user registration process and any subsequent Actions. It takes two arguments:</p><ul><li><code>reason</code>: This is a string that provides an internal reason why you‚Äôre denying the user‚Äôs attempt to sign up for an account. This is for the benefit of the application‚Äôs developers and administrators and will appear in the tenant‚Äôs logs. We recommend that this be a short label rather than a sentence.</li><li><code>userMessage</code>: This is also a string, and it‚Äôs the <em>user-facing</em> reason why they‚Äôre not able to sign up for an account. You want this message to be user-friendly, and we recommend that this be a full sentence.</li></ul><p>With the ‚ÄúRefuse New Sign-ups‚Äù Action deployed and added to the Pre User Registration flow, this is what the user will see when they attempt to sign up:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1vuCHpnYHpEWrtbjREPvBN/32ae15dbc0db8e5f02d2bc7e25f9bb54/refuse_sign-up_action_1.png" alt="‚ÄúSign up‚Äù screen displaying the message ‚ÄúWe‚Äôre not accepting sign-ups at the moment.‚Äù"/></p><p>While the login box shows the ‚ÄúWe‚Äôre not accepting sign-ups at the moment‚Äù message, you can see that the message is dwarfed by the big red box containing password requirements. </p><p>At the moment, there‚Äôs no way to ‚Äúturn off‚Äù that big red box, which was created before we had Actions and the Pre User Registration flow. For now, you should use messages that are at least two sentences long in order for them to be more easily seen:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Cafl2dxdCzPCF1Po4mNcH/47721e5f44f0cd693432cf189c7384ba/refuse_sign-up_action_2.png" alt="‚ÄúSign up‚Äù screen displaying a longer version of the mesage ‚ÄúWe‚Äôre not accepting sign-ups at the moment.‚Äù"/></p><p>Every Auth0 user account stores information about the user as metadata, which your application access. Two kinds of metadata are stored:</p><ol start="1"><li><strong>User metadata:</strong> A set of attributes about the user that <em>don‚Äôt</em> affect the app‚Äôs core functionality. The user <em>can</em> view and modify this information, which typically comprises user preferences and settings.</li><li><strong>App metadata:</strong>  A set of attributes about the user that <em>do</em> affect the app‚Äôs core functionality.  The user <em>cannot</em> view and modify this information, which includes things such as their status and state within the application, or any other settings that determine what features or activities are available to the user.</li></ol><p>You can use an Action in the Pre User Registration flow to set the user‚Äôs user and app metadata to their initial values. In the example below, the Action sets values in both a newly-created user‚Äôs user metadata and app metadata:</p><pre><code><span>// Pre User Registration flow</span>

exports<span>.</span><span>onExecutePreUserRegistration</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  api<span>.</span>user<span>.</span><span>setUserMetadata</span><span>(</span><span>&#34;ui_color&#34;</span><span>,</span> <span>&#34;default&#34;</span><span>)</span><span>;</span>
  api<span>.</span>user<span>.</span><span>setUserMetadata</span><span>(</span><span>&#34;use_verbose_messages&#34;</span><span>,</span> <span>false</span><span>)</span><span>;</span>  
  api<span>.</span>user<span>.</span><span>setAppMetadata</span><span>(</span><span>&#34;is_new_user&#34;</span><span>,</span> <span>true</span><span>)</span><span>;</span>
  api<span>.</span>user<span>.</span><span>setAppMetadata</span><span>(</span><span>&#34;reward_status&#34;</span><span>,</span> <span>0</span><span>)</span>
<span>}</span><span>;</span></code></pre><p>The code above uses two methods ‚Äî <code>api<span>.</span>user<span>.</span><span>setUserMetadata</span><span>(</span><span>)</span></code> and <code>api<span>.</span>user<span>.</span><span>setAppMetadata</span><span>(</span><span>)</span></code> ‚Äî to initialize the new user‚Äôs user and app metadata respectively.</p><p>With this Action inserted into the Pre User Registration flow, every new user ‚Äî whether created by clicking the <strong>Sign up</strong> link in the login box, or through the Auth0 dashboard or management API ‚Äî will have the following user and app metadata:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2h5wwSK8OlMj6k0uqQMLw8/eacb8b3157c4bebc9b65b38de5d244f7/new_user_metadata.png" alt="A user account‚Äôs user and app metadata displaying the initialized metadata after the Action is run."/></p><h2 id="Email-the-User-after-a-Password-Change">Email the User after a Password Change</h2><p>It‚Äôs good to email the user immediately after the password to their account changes. If the user made the change, the email is a reminder of when they last updated their password. If the user <em>didn‚Äôt</em> make the change, it could be a sign that an unwanted party has access to their account. </p><p>You can set up this kind of email notification by adding an Action to the <a href="https://manage.auth0.com/#/actions/flows/post-change-password/" target="_blank" rel="noreferrer noopener">Post Change Password flow</a>, as shown below:</p><pre><code><span>// Post Change Password flow</span>

<span>function</span> <span>sendGmail</span><span>(</span><span>username<span>,</span> password<span>,</span> emailAddress<span>,</span> subject<span>,</span> message</span><span>)</span> <span>{</span>
  <span>try</span> <span>{</span>
    <span>const</span> send <span>=</span> <span>require</span><span>(</span><span>&#39;gmail-send&#39;</span><span>)</span><span>(</span><span>{</span>
      user<span>:</span> username<span>,</span>
      pass<span>:</span> password<span>,</span>
      to<span>:</span> emailAddress<span>,</span>
      subject<span>:</span> subject<span>,</span>
    <span>}</span><span>)</span><span>;</span>
    <span>send</span><span>(</span><span>{</span>
      text<span>:</span> message<span>,</span>  
    <span>}</span><span>,</span> <span>(</span><span>error<span>,</span> result<span>,</span> fullResult</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span>error<span>)</span> console<span>.</span><span>error</span><span>(</span>error<span>)</span><span>;</span>
      console<span>.</span><span>log</span><span>(</span>result<span>)</span><span>;</span>
    <span>}</span><span>)</span>
  <span>}</span> <span>catch</span> <span>(</span>err<span>)</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span><span>`</span><span>Error sending email to </span><span><span>${</span>emailAddress<span>}</span></span><span>:</span><span>`</span></span><span>,</span> err<span>.</span>message<span>)</span>
  <span>}</span>
<span>}</span>

exports<span>.</span><span>onExecutePostChangePassword</span> <span>=</span> <span>async</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>sendGmail</span><span>(</span>
    event<span>.</span>secrets<span>.</span><span>GMAIL_USERNAME</span><span>,</span>
    event<span>.</span>secrets<span>.</span><span>GMAIL_PASSWORD</span><span>,</span>
    event<span>.</span>user<span>.</span>email<span>,</span>
    <span>&#34;Your password has been changed&#34;</span><span>,</span>
    <span><span>`</span><span>
This is a quick message to let you know that your password has been changed. If you made this change,
you can ignore this email. If you DIDN‚ÄôT make this change, please contact the administrator.
    </span><span>`</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>This is a more complex Action than the previous examples. It requires more setup, which I‚Äôve outlined below.</p><h3 id="Wait--a--Gmail--account-">Wait‚Ä¶ a <em>Gmail</em> account?</h3><p>While you shouldn‚Äôt use Gmail as an email server for a production app, I find that a Gmail account dedicated to testing can be useful for prototyping.</p><p>To set up such an account, <a href="https://accounts.google.com/signup" target="_blank" rel="noreferrer noopener">sign up for a new Gmail account</a>. Don‚Äôt enable two-factor authentication on this account, because doing so makes the next step in the process unavailable.</p><p><a href="https://myaccount.google.com/" target="_blank" rel="noreferrer noopener">Go to the home page for your newly-created account</a> and select <em>Security</em> from the menu on the left side of the page. Scroll down until you see the <em>Less secure app access</em> section and click on the <em>Turn on access (not recommended)</em> link. Set the <em>Allow less secure apps</em> switch to the ON position.</p><p>You will now be able to use this Gmail account to send emails on behalf of your Action.</p><p>Please remember you should use this account for testing purposes only! For a production application, use a dedicated email-sending API.</p><blockquote><p>Don‚Äôt forget that <a href="https://developers.google.com/gmail/api" target="_blank" rel="noreferrer noopener">Gmail has an API</a> that provides authorized access to the data in a user‚Äôs Gmail account and can be used to perform several actions, including reading, sorting, sending, and backing up mail, as well as managing user settings such as aliases, signatures, filtering, and forwarding.</p></blockquote><h3 id="Store-your-secrets">Store your secrets</h3><p>The <code><span>onExecutePostChangePassword</span><span>(</span><span>)</span></code> function delegates the sending of email to another function, <code><span>sendGmail</span><span>(</span><span>)</span></code>. When the time comes to move the Action out of the prototyping phase, I can have <code><span>onExecutePostChangePassword</span><span>(</span><span>)</span></code> call a different function with the same parameters that accesses an email API that‚Äôs more suitable for production.</p><p>You may have noticed that I didn‚Äôt hard-code the Gmail account‚Äôs username and password values into the Action. Instead, they appear to be properties of the <code>event<span>.</span>secrets</code> object. These are <strong><em>secrets</em></strong> ‚Äî values that are securely stored in the <em>Secrets</em> section of the action.</p><p>To manage an Action‚Äôs secrets, click on the key icon on the left side of the Action editor. This will open the <em>Secrets</em> panel, where you can add, edit, and delete values that you want to keep secret:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1wINrTk7gpX8oZsg4WbpUg/2f8c8b27c033256d2280790d911a8045/secrets_panel.png" alt="The ‚ÄúSecrets‚Äù panel and its controls."/></p><p>When you click the <em>Add Secret</em> button, a pop-up appears, allowing you to define a secret as a key-value pair:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/N8Y5cvyvcAL8ybLaKkzmz/6f7d7fa02932b4f1755595608dfa1c4a/define_secret.png" alt="The ‚ÄúDefine Secret‚Äù dialog box."/></p><p>Once defined, you can access secrets as properties of the <code>event<span>.</span>secrets</code> object. The two secrets that I defined ‚Äî¬†<code><span>GMAIL_USERNAME</span></code> for the username of my prototyping Gmail account and <code><span>GMAIL_PASSWORD</span></code> for its password ‚Äî can be accessed in the Action code as <code>event<span>.</span>secrets<span>.</span><span>GMAIL_USERNAME</span></code> and <code>event<span>.</span>secrets<span>.</span><span>GMAIL_PASSWORD</span></code>.</p><h3 id="Add-modules">Add modules</h3><p>The <code><span>sendGmail</span><span>(</span><span>)</span></code> function uses the <code><span>require</span><span>(</span><span>)</span></code> function to include the <code>gmail<span>-</span>send</code> npm module to send email notifications to the user through Gmail. But how do you make <code>gmail<span>-</span>send</code> available to your Action?</p><p>You do it using the <em>Modules</em> panel, which you can access by clicking on the package icon on the left side of the Action editor:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5x4ommIbuuJMF4Y5da7JFG/a55ecf98020fa510ab0e3bd9349b2891/modules_panel.png" alt="The ‚ÄúModules‚Äù panel and its controls."/></p><p>The <em>Modules</em> panel lets you bring in functionality from any combination of modules in npm‚Äôs vast collection. </p><p>To add a module to your Action, click the <em>Add Module</em> button. A pop-up will appear, allowing you to specify an npm module to include and optionally, which version:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2EbQuMtGl1ELWQiPrZxZ2d/d592ca4a09e572aa19a48d9f63c396f3/add_module.png" alt="The ‚ÄúAdd Module‚Äù dialog box."/></p><p>I added the latest version of the <code>gmail<span>-</span>send</code> module to the Action.</p><h2 id="Conclusion">Conclusion</h2><p>As I mentioned in the beginning, Actions don‚Äôt need to be lengthy or complicated to achieve useful results. Sometimes a single line is all you need!</p><p>You should use the Actions provided above as a ‚Äújumping-off point‚Äù for writing your own custom Actions to meet your users‚Äô¬†needs. Use your imagination, and don‚Äôt be afraid to experiment!</p></div></div>]]></content:encoded>
      <pubDate>Tue, 11 Jan 2022 15:01:00 +0000</pubDate>
    </item>
    <item>
      <title>AWS re:Invent is Back!</title>
      <link>https://auth0.com/blog/recapping-aws-reinvent-2021/</link>
      <description>If you missed Okta/Auth0 in person at AWS re:Invent 2021, here‚Äôs what you want to know.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>At the recently celebrated 10th anniversary of AWS re:Invent, partners and customers from all over the world came together (in person) to raise the bar on how they build, run, and best serve customers on AWS. In line with industry trends, a central theme this year was Zero Trust. Booth visitors wanted to know how Okta/Auth0 best mitigates risk and increases brand loyalty through continual verification.  </p><blockquote><p><a href="https://www.okta.com/zero-trust/" target="_blank" rel="noreferrer noopener">Zero Trust</a> (the concept of never trust, always verify) was a hot topic at this year‚Äôs re:Invent. </p></blockquote><p>The pandemic sparked the rapid digitization of healthcare, financial, and community service industries. With this digital shift, came increased exposure and subsequent risk. Companies have more information than ever before to safeguard against malicious activity and need to understand their customers on a digital level. Users have an ever-increasing digital footprint to secure and need to know they can trust corporations with Personally Identifiable Information. </p><p>The pandemic also restricted face-to-face meetings, making virtual ones (via Zoom, Chime, etc) increasingly prevalent. With no shortage of ‚ÄúZoom Fatigue,‚Äù many were eager to come back together in real life.</p><p>Now, for the first time in over a year, the re:Invent conference was held in person, in Las Vegas, NV, from November 29 - December 3rd. Many participants were meeting their own team members for the first time and the energy was palpable. You may not have been able to see behind the masks, but we were all smiling. </p><p>There was a lot to smile about as AWS celebrated with lots of festivities. Live bands prefaced keynote speakers, and developers flocked to a number of game days, hackathons, and hands-on workshops. There was also a virtual option for those unable to attend in person. Those who were able to attend, and made it past the loud, celebratory music, through the AWS DeepRacer simulation, to the giant Expo hall full of AWS and partner booths, found the partner stage!</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/72RI5jH3MDy08A7vesvq8g/7d3b6aaaf808187042e25fb5d96e76e6/aws_body_01.jpg" alt="AWS Re:Invent 2021"/></p><p>First on stage to kick off a series of partner talks (10:30AM Wednesday) was Auth0 Solutions Engineer, <a href="https://virtual.reinvent.awsevents.com/session-virtual/?v2477da705118cc74fd14460db021e1784e2eed5a7982c6482ec95cb2e86d259644b8741959f52a49e0e6908b82a9d860=362BCDE0FFB2962F09B451EA4F38DF45740387FD6E00B5DAC1E5F5F3874F01A9CD85A2F6DB63249ACDCBD4FA8250255F" target="_blank" rel="noreferrer noopener">Jeet Shah</a>. An in-person audience of 25 joined multiple virtual attendees to learn how Auth0 enables developers at companies like <a href="https://aws.amazon.com/partners/success/headspace-auth0/" target="_blank" rel="noreferrer noopener">Headspace</a>, <a href="https://auth0.com/case-studies/flo-health/" target="_blank" rel="noreferrer noopener">Flo</a>, and <a href="https://auth0.com/blog/auth0-delivers-secure-authentication-for-slice/" target="_blank" rel="noreferrer noopener">Slice</a>, to quickly incorporate Identity into customer-facing, revenue-generating applications. Shah shared details of the <a href="https://auth0.com/docs/rules" target="_blank" rel="noreferrer noopener">Auth0 Rules</a> Engine and answered a number of questions regarding how Auth0 manages <a href="https://auth0.com/resources/whitepapers/interoperability-in-healthcare#!" target="_blank" rel="noreferrer noopener">interoperability</a> and <a href="https://auth0.com/docs/login/mfa/adaptive-mfa" target="_blank" rel="noreferrer noopener">adaptive MFA</a>. </p><p>Okta Solutions Engineer, <a href="https://virtual.reinvent.awsevents.com/session-virtual/?v2477da705118cc74fd14460db021e1784e2eed5a7982c6482ec95cb2e86d259644b8741959f52a49e0e6908b82a9d860=F6ECDA2A845F0F4DD141B864720164AF6CB22B97D1826DF39B5B5779D1306D3088FD42E31D0D79B31CFA61935C1FD7CB" target="_blank" rel="noreferrer noopener">Kapil Patil</a>, came on in the afternoon (1PM Wednesday) to showcase Okta‚Äôs capabilities in managing workforce and customer Identities for companies like <a href="https://www.okta.com/blog/2021/07/how-wabtec-protects-its-trains-customers-and-bottomline-from-downtime-and-disruption/" target="_blank" rel="noreferrer noopener">Wabtec</a>, <a href="https://www.okta.com/blog/2021/11/jetblues-digital-transformation-takes-flight/" target="_blank" rel="noreferrer noopener">JetBlue</a>, and <a href="https://www.okta.com/blog/2021/01/how-athenahealth-created-a-secure-scalable-healthcare-ecosystem/" target="_blank" rel="noreferrer noopener">Athenahealth</a>. Okta exists to give the right person, the right level of access, to the right content (including AWS resources) at any given time. Enabling customers to SSO, automate workflows, and manage user lifecycles including onboarding, role changes, and deprovisioning.</p><p>After listening to Shah and Patil, those with follow-up questions migrated to our booth. Or rather - booths.  To learn how Okta/Auth0 have joined forces to solve the most complex, large-scale Identity use-cases on AWS. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/LXRwT1xat2EaoH8lawOKc/d01fb04701c1022d907202e19b163006/aws_body_02.jpg" alt="AWS Re:Invent 2021"/></p><p>Conducive to our complimentary Identity Products, Okta/Auth0 had each other‚Äôs back quite literally as well in terms of booth representation. Auth0‚Äôs booth was smartly branded The Log INN where booth staffers, concierges were dressed in flannel. Most visitors wanted to check out Auth0‚Äôs <a href="https://auth0.com/docs/login/mfa/adaptive-mfa" target="_blank" rel="noreferrer noopener">Adaptive MFA</a>. As a way to trigger additional verification at sensitive moments (like changing one‚Äôs billing address or making a purchase) for an equally frictionless and secure customer experience. </p><p>Next door, Okta‚Äôs booth targeted Workforce Identity and the thousands of integrations supporting workflow. Among the most popular, the integration with <a href="https://www.okta.com/partners/aws/" target="_blank" rel="noreferrer noopener">AWS Services</a>. Aside from inquiring about free tee-shirts, the most common question amongst thousands of documented booth visitors was: </p><blockquote><p>‚ÄúWhat will be the impact of the Okta acquisition of Auth0 in relation to Zero Trust?‚Äù</p></blockquote><p>The reality is, that when it comes to your customer engagement strategy, trust is everything. Traditionally, access control systems have treated legitimate users and attackers as equals and the problem is that it either grants attackers too little resistance, or legitimate users too much. Secure and smart identity management directly translates into user trust, which in turn, elevates the customer‚Äôs perception of your brand. To put it simply:</p><h2 id="Identity-is-Trust">Identity is Trust</h2><p>Where Okta has traditionally handled enterprise Identity, Auth0, in contrast, was built by and for developers. The Okta acquisition of Auth0 for $6.5B dollars in May 2021, served to close the gap on providing SSO for an increasing number of applications regardless of use-case, industry, or Identity Provider.</p><p>Today, developers and enterprise IT teams, alike, struggle with siloed designs, broken access control, unlinked digital identities, and a disparate user experience. There‚Äôs a common objective to create a more robust experience by increasing customer engagement and adoption, as well as employee efficiency. Together, Okta/Auth0 enables companies to best serve their customers on AWS. Here‚Äôs how:</p><h2 id="Better-Together">Better Together</h2><p>For developers building applications, or IT teams working to streamline disparate systems, Identity is not always top of mind. However, at Okta/Auth0 we take Identity seriously. It‚Äôs the front door to how all customers and partners engage with a brand, and the synergy of convenience, security, and privacy. </p><h3 id="Convenience-">Convenience:</h3><ul><li>Auth0 has <a href="https://auth0.com/docs/libraries" target="_blank" rel="noreferrer noopener">60+ pre-built SDKs</a> and <a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">100‚Äôs of Integrations</a> enabling 94% of customers to full production in under 30 days.</li><li>Okta has <a href="https://www.okta.com/platform/integrations/" target="_blank" rel="noreferrer noopener">7,000+ Integrations</a> and supports user<a href="https://www.okta.com/products/lifecycle-management/" target="_blank" rel="noreferrer noopener"> lifecycle management</a> for 250+ cloud and on-prem apps helping users log in 50% faster and reduce helpdesk calls by 75%.</li></ul><h3 id="Security-">Security:</h3><ul><li>Auth0 ensures <a href="https://auth0.com/login-security" target="_blank" rel="noreferrer noopener">world-class security</a> through continuous vulnerability assessments, third-party penetration testing, and a bug bounty program with BugCrowd.</li><li>Okta continuously synchronizes users from a target directory with the ability to <a href="https://www.okta.com/blog/2020/07/what-is-provisioning-and-deprovisioning/" target="_blank" rel="noreferrer noopener">deprovision</a> when and where needed.</li></ul><h3 id="Privacy-">Privacy:</h3><ul><li>Auth0 offers a fully customizable <a href="https://auth0.com/docs/login/universal-login" target="_blank" rel="noreferrer noopener">Universal Login</a> and <a href="https://auth0.com/docs/organizations" target="_blank" rel="noreferrer noopener">Organizations</a> to centralize Identity across unique brands and experiences.</li><li>Okta‚Äôs <a href="https://www.okta.com/products/advanced-server-access/" target="_blank" rel="noreferrer noopener">Advanced Server Access</a> provides centralized control across any hybrid or multi cloud environment.</li></ul><p>Together, Okta/Auth0 provides Identity at scale to over 14K global customers, most of whom are also all-in customers on AWS. What does that mean for you?</p><h2 id="What-s-Next-">What‚Äôs Next?</h2><p>If you missed us re:Invent, it‚Äôs not too late! If you‚Äôd like to learn more about Okta, Auth0, and Zero Trust, there are a number of ways to connect. </p><ul><li><strong>High Level:</strong> Visit our virtual booth <a href="https://virtual.reinvent.awsevents.com/virtual-exhibitor/?status=1&amp;v4b4342b0f72f3260e37d74de68eab433fee0c641d933e76d52be7eb34b211371656f07b5a54b2e522db3ac7b27c7d555=B59EC82E1B284B10F363E306BEB2CF36278B1B3001AB3C914C1585B0E4EA159072AE418AE9E6A898BF553D8D6AC94DE7" target="_blank" rel="noreferrer noopener">Auth0</a> through February, 2022.</li><li><strong>Hands-On:</strong> Try <a href="https://okta.com/free-trial" target="_blank" rel="noreferrer noopener">Okta</a> and <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">Auth0</a> for free!</li><li><strong>Deep Dive:</strong> Book a technical demo with our <a href="https://www.okta.com/request-advanced-server-access-demo/" target="_blank" rel="noreferrer noopener">Okta</a> and <a href="https://info.auth0.com/auth0-at-aws-reinvent-2021.html" target="_blank" rel="noreferrer noopener">Auth0</a> Solutions Engineers.</li></ul><h2 id="Okta-Auth0">Okta/Auth0</h2><p>The Okta/Auth0 Identity Platform, takes a modern approach to identity management, enabling organizations to provide secure access to any application, running on any device, for any end-user. Securing more than 5 Billion logins monthly, Okta/Auth0 deliver equal parts convenience, security, and privacy, closing the gap on authentication-related risk through continual and frictionless verification. Trust us to handle Identity, so you can focus on innovation.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 29 Dec 2021 15:02:00 +0000</pubDate>
    </item>
    <item>
      <title>Enable Multi-factor Authentication with Auth0 and Twilio</title>
      <link>https://auth0.com/blog/enable-mfa-with-twilio-and-auth0/</link>
      <description>Quickly integrate Twilio for SMS-based multi-factor authentication</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Your users&#39; most trustworthy interaction with your business is when they type each letter on their keyboard to enter their username and password into your login box. After they hit enter and send this confidential information through the internet tubes, they trust that your application has done everything possible to keep their data safe from bad actors.</p><p>Even with proper protocols, expert attackers still find shortcuts and backdoors to access users&#39; credentials and confidential information. The good news is you can add another layer of protection for your users by adding Multi-factor Authentication (MFA) to your Application. MFA lets you add another factor to verify so users can prove who they say they are. There are several types of MFA methods. Some of them are SMS-based, One-time passwords (OTP), Authenticator apps, and Biometrics, to name a few. </p><blockquote><p>To learn more about MFA methods, <a href="https://auth0.com/blog/multifactor-authentication-mfa/" target="_blank" rel="noreferrer noopener">check out this MFA Guide</a>.</p></blockquote><p>Today, you will add SMS-based MFA with Auth0 using Twilio as the SMS provider. Twilio is a popular customer engagement platform that you can easily integrate with Auth0.</p><p>If you prefer, you can also watch this video on the same topic:</p><p><iframe src="https://www.youtube.com/embed/lF7stm2nUHQ" frameborder="0" allowfullscreen=""></iframe></p><h2 id="What-Will-You-Need-">What Will You Need?</h2><ul><li>An Auth0 Account. If you don&#39;t have one, <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">you can register for free</a></li><li>A Twilio Account</li><li>A mobile phone</li></ul><h2 id="Set-Up-and-Configure-Auth0-React-Demo-Application">Set Up and Configure Auth0 React Demo Application</h2><blockquote><p>If you already have a Single Page Application registered in your Auth0 dashboard, you can skip to <a href="#Create-Twilio-Account-and-Get-Credentials">Create Twilio Account and Get Credentials</a>.</p></blockquote><h3 id="Clone-the-demo-application">Clone the demo application</h3><p>Start by cloning the <a href="https://github.com/auth0-samples/auth0-react-samples/tree/master/Sample-01" target="_blank" rel="noreferrer noopener">Auth0 React SDK Sample Application from GitHub</a>. This is a sample React app set up and connected with Auth0. Once you have the Application installed on your machine <code>cd</code> into <code>auth0<span>-</span>react<span>-</span>samples</code> then again into <code>Sample<span>-</span><span>01</span></code>, use npm to install the project&#39;s dependencies.</p><pre><code><span>npm</span> <span>install</span></code></pre><p>Once the dependencies are finished installing, run <code>npm run dev</code> in your terminal and in your browser visit <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>3000</span></code>, if it doesn&#39;t automatically start. Now you&#39;ll see the React sample project with a login button in the upper right corner of the screen.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4B7KxXicKfMF4SS7an6RxB/9c29ccdcc08572b11dd9691923c328c5/React_SDK_Local.png" alt="Auth0 Sample Project Login Screen"/></p><p>In the project&#39;s <code>src</code> folder, you&#39;ll find the <code>auth_config<span>.</span>json<span>.</span>example</code> file. There&#39;s a JSON object with placeholder values inside this file. Copy it, then create a new file in the same folder named <code>auth_config<span>.</span>json</code>. With this file created, you need to replace the placeholder values with your own credentials from the Auth0 dashboard. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6cM6y7s5CqxfC4DpMbDI8r/0b22c0cdc5ed736bc0631b52e2028080/Screen_Shot_2021-12-02_at_7.44.45_PM.png" alt="Auth0 Config File"/></p><h2 id="Get-Credentials-from-Auth0-Dashboard">Get Credentials from Auth0 Dashboard</h2><p>Now go to your Auth0 Dashboard; click <em>Applications</em>, then click <em>Applications</em> again when the options dropdown on the right-side panel. Click <em>Create Application</em> if you don&#39;t already have an application in your Auth0 account.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3IP95iBgYyz7XJ62rwqbyW/f6862e32b8169566bbd7343ff892966c/Screen_Shot_2021-12-02_at_8.19.52_PM.png" alt="Auth0 Dashboard Application Page"/></p><p>On the Create Application screen, you&#39;ll give your Application a name. You can use &#34;Twilio MFA Test.&#34; </p><p>Next, you&#39;ll choose the application type; select <em>Single Page Application</em> since this is a React application. Then click <em>Create</em>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5ZxkkuVUS3nmhqWvQuu8aZ/67bef7be2b4cca5460f8311c2be69655/Screen_Shot_2021-12-02_at_8.45.53_PM.png" alt="Auth) Dashboard Create Application Page"/></p><p>Since you already have the sample application on your machine, skip Quick Start and click <em>Settings</em>. This is where you will find the Domain and Client ID, that you need to replace the placeholder values in the <code>auth_config<span>.</span>json</code> file. You can copy the values from the dashboard into your code editor.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/nQMYVh3ZDtMSYUCog7e5r/e8b8b471b7097d36918547037c78ce5f/Screen_Shot_2021-12-02_at_9.11.39_PM.png" alt="Application Settings Page"/></p><p>Next, scroll down to the Application URIs section to fill in Allowed Callback URLs, Allowed Logout URL, and Allowed Web Origins. This example is running locally, so enter <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>3000</span></code> into each field. When you&#39;re finished, scroll to the bottom of the page and click <em>Save Changes</em>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6kXeY9LVo5sincLcxSdrk1/e25a7bfd89bcda641f6c6625ad143aa5/Screen_Shot_2021-12-03_at_8.37.26_AM.png" alt="Application URIs"/></p><p>You can now run the Application locally again and click Login; enter a username and password, and the user will be successfully authenticated with Auth0. As you may have noticed the username and the password are the only factor being used to authenticate users. Make your application more secure by adding another factor for the user to verify. Twilio can add SMS-based authentication. You&#39;ll set that up next.</p><h2 id="Create-Twilio-Account-and-Get-Credentials">Create Twilio Account and Get Credentials</h2><p>If you don&#39;t have a Twilio account already, you can create one <a href="https://www.twilio.com/try-twilio" target="_blank" rel="noreferrer noopener">here</a>. Once you have created an account and logged in, you&#39;ll see the Twilio console. Here you&#39;ll see your Account SID and Auth Token, which you&#39;ll use later. The next step for a new Twilio account is getting a Twilio phone number. This will be the number that will send a one-time passcode to your user to verify and complete their authentication after they&#39;ve logged in with their username and password.</p><h3 id="Get-a-Twilio-trial-phone-number">Get a Twilio trial phone number</h3><p>In the Twilio Console, click <em>Get a trial phone number</em>. You&#39;ll automatically get assigned a number click Choose this Number. This number will now show on the Project Info section under Phone Number.</p><h3 id="Configure-Auth0-to-use-Twilio-for-MFA">Configure Auth0 to use Twilio for MFA</h3><p>Back at your Auth0 dashboard, look at the ride side menu, click Security, then Multi-factor Auth. On this page, you&#39;ll be shown all the factor options that you can use with Auth0. For this Application, click on <em>Phone Message</em>.</p><p>The first thing you need to do on the Phone Message page is click the toggle button on the upper left side corner to enable Phone Message MFA. You&#39;ll see a pop-in notification confirming it has been enabled.</p><p>Next, you&#39;ll need to Choose a delivery provider; you&#39;ll see that Twilio is one of the listed options making it easy to connect Twilio to your Auth0 account.
For <em>Choose a delivery method</em>, you have SMS, SMS, and Voice, or Voice to choose from. For simplicity, select SMS.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1Rhy8cNvQn76y81MQ9b81j/59ae57cdd0300d658456ef03b5ff0af9/Screen_Shot_2021-12-03_at_11.40.16_AM.png" alt="Phone Message Settings Page"/></p><p>When you select Twilio as the delivery provider, you will have some new fields appear to enter the Twilio SID, Twilio AuthToken, and the From phone number. You&#39;ll see all of those values in the Twilio console.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4SO3LiFDt5wt4MdOZFuFR1/446d53076c18666ac2d705de50b3f7f4/Screen_Shot_2021-12-03_at_10.59.05_PM.png" alt="Twilio Console"/></p><p>Copy each value to the matching field in the Auth0 Dashboard. The two template fields can customize the message the user gets sent. You&#39;ll leave these as they are in this example. Now click <em>Save</em>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/12Xd2Mg7Twq6Nk7eV5Ra1s/cfd809f4a460dca1c5c3ee4c82424971/Screen_Shot_2021-12-03_at_11.26.55_PM.png" alt="Phone Message Twilio Settings"/></p><p>Now you have everything configured to use Twilio as an SMS MFA provider, but there is still one more step left to actually make everything work!</p><h2 id="Enable-MFA-in-the-Auth0-Dashboard">Enable MFA in the Auth0 Dashboard</h2><p>Back on the Multi-factor Authentication page, there are two sections Factors, which we just completed, and Define Policies. Define Policies will tell Auth0 when you want to prompt the user to use MFA. In the Require Multi-factor Auth section, the default is Never, which is the exact opposite of what you wish to do after doing all that work of configuring MFA.</p><p>The second option is an add-on called Adaptive MFA. This takes a look at the user&#39;s environment and determines if it&#39;s risky and requires another authentication factor. For this example, you&#39;ll choose <em>Always</em>, then click <em>Save</em>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/62TwidbXDP7luY9XQHeECD/25425b0cc1c9638401c40922cf61b371/Screen_Shot_2021-12-03_at_11.41.27_PM_1.png" alt="Define Policies Section"/></p><p>You&#39;ll get a prompt asking if you want to continue and let you know all new and existing users are now required to enroll in MFA click <em>Continue</em>. That will update your MFA policy, and now, when a user registers or logins, they will be met with a prompt to add their phone number to enroll in MFA.</p><p>Now that everything MFA is enabled in your Application, you want to test it out to ensure everything goes smoothly.</p><h2 id="Test-MFA-on-Login">Test MFA on Login</h2><p>With your sample application running, click <em>Login</em> and enter your email and password. Next, you&#39;ll be prompted to add a phone number to secure the account. This is what your users will see the next time they log in after you enable MFA.</p><p>You can select the code for your country on the first line, then type in your phone number and click <em>Continue</em>. You&#39;ll then have an SMS message come to your phone with a verification code. Enter that code into the input box on your application. </p><p>Now you&#39;re successfully logged in, and your users have another layer of protection from their data being compromised. All thanks to you, pat yourself on the back!</p><h2 id="Summary">Summary</h2><p>You just added Multi-factor authentication to your application using Twilio as the provider. You entered your Auth0 credentials to the <code>auth_config<span>.</span>json</code> in the project files of your application. Then, you enabled Phone Message MFA in the Auth0 Dashboard and added your Twilio credentials.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 27 Dec 2021 14:56:00 +0000</pubDate>
    </item>
    <item>
      <title>Use Actions to Show Users an Announcement after Logging in (Or Rickroll Them)</title>
      <link>https://auth0.com/blog/use-actions-show-users-announcement-after-logging-in-or-rickroll-them/</link>
      <description>Learn how to use Auth0 Actions to redirect users to an announcement web page and back to the application (or just redirect them to Rick Astley‚Äôs video).</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Sooner or later, your application will need to present the user with an important announcement immediately after logging in. It could be about:</p><ul><li>Upcoming maintenance, during which time the application will be unavailable</li><li>Changes to the application that will affect its functionality or the user experience</li><li>Notifications about the user‚Äôs account, such as an approaching expiry date or that they are running out of storage space allotted to their account</li><li>Every system administrator‚Äôs worst nightmare: an outage</li></ul><p>The announcement is important enough to interrupt the usual Login flow with a separate page or screen that requires the user to activate a button, link, or other user interface control before proceeding to the application.</p><p>While you can predict some of these announcements (e.g., informing the user that their account is about to expire or is running out of storage space or some other resource), many situations that need these announcements will arise with little or no warning. This includes things that are hard to predict, such as unscheduled downtime.</p><p>When surprises like these appear, you shouldn‚Äôt make changes to your application just to display an announcement. This is especially true if your application has different versions for different platforms, requiring you to make changes in multiple codebases.</p><p>These situations need a way to insert a step into the login process to present the announcement to the user. That‚Äôs where Actions can help.</p><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong></p></blockquote><h2 id="Introducing-Actions">Introducing Actions</h2><p>Actions are Node.js functions that execute when triggered by specific events. They allow you to extend Auth0 beyond what it can do ‚Äúout of the box‚Äù by adding logic to login, user registration, password changes, and other events during authentication and other identity-related processes. </p><p>Instead of coding Actions into your application, you write and store them in the Auth0 dashboard, where they are part of your tenant‚Äôs settings. Like Auth0‚Äôs <a href="https://auth0.com/docs/login/universal-login" target="_blank" rel="noreferrer noopener">Universal Login</a> web page and authentication and authorization services, Actions are run by Auth0‚Äôs servers.</p><p>You write Actions to insert them into <em>flows</em>, which are processes that happen when using Auth0. The flows that currently support Actions are:</p><ul><li><strong>Login:</strong> Takes Actions that execute immediately after the user has logged in and before the ID token is issued.</li><li><strong>Machine to Machine:</strong> Takes Actions that execute during a <a href="https://auth0.com/machine-to-machine" target="_blank" rel="noreferrer noopener">machine-to-machine credentials exchange</a>, just after the ID token is requested and before it is issued.</li><li><strong>Pre User Registration:</strong> Takes Actions that execute immediately after a user has provided the information to register for a database or passwordless connection and before that connection is registered with Auth0.</li><li><strong>Post User Registration:</strong> Takes Actions that execute immediately after a user‚Äôs database or passwordless connection is registered with Auth0.</li><li><strong>Post Change Password:</strong>  Takes Actions that execute immediately after the user changes their password.</li><li><strong>Send Phone Message:</strong>  Takes Actions that execute immediately after a third-party multi-factor authentication provider is asked to send an authentication message to the user and before the message is sent.</li></ul><p>This tutorial covers showing an announcement immediately after login, which involves writing Actions for the Login flow.</p><h2 id="Prerequisites">Prerequisites</h2><p>You‚Äôll need the following for this tutorial‚Äôs exercises:</p><ul><li><strong>Auth0 account:</strong> Actions are an Auth0 feature, which means you need an Auth0 account to use them. <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">You can sign up for free,</a> and the process is pretty painless.</li><li><strong>Any application that uses your Auth0 tenant to provide Universal Login.</strong> Any web-based, mobile, or desktop application will do, just as long as it is one of your tenant‚Äôs applications. You‚Äôll need it to log in and see how defining Actions changes how login works. If you don‚Äôt have any applications that use Auth0 for authentication, you can download one from the <a href="https://auth0.com/docs/quickstarts/" target="_blank" rel="noreferrer noopener">Auth0 Quickstarts</a> page.</li><li><strong>Your favorite web application development environment.</strong> You‚Äôll need to write a small web application that accepts a query parameter and embeds it in a link. I‚Äôll provide implementations in <a href="https://expressjs.com/" target="_blank" rel="noreferrer noopener">Express</a> and <a href="https://flask.palletsprojects.com/en/2.0.x/" target="_blank" rel="noreferrer noopener">Flask</a>, but feel free to write the web application using your favorite framework or language.</li></ul><h2 id="Your-First-Action--A-Rickroll-">Your First Action: A Rickroll!</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7x6KaWGrzkHmpyL2JSCE6/ee6f825f6ca179c23918387980bb7345/never_gonna_log_you_out.png" alt="Login screen featuring an image of Rick Astley and the username field filled out with ‚ÄúNeverGonnaLogYouOut‚Äù"/></p><p>Let‚Äôs start with something fun: writing an Action that sends the user to the video for Rick Astley‚Äôs 1987 hit <em>Never Gonna Give You Up</em> after they log in.</p><blockquote><p>In case you‚Äôre not familiar with the Internet prank known as ‚ÄúRickrolling‚Äù, <a href="https://en.wikipedia.org/wiki/Rickrolling" target="_blank" rel="noreferrer noopener">here‚Äôs Wikipedia‚Äôs page on the topic</a>.</p></blockquote><h3 id="The-Login-flow">The Login flow</h3><p>üõ† Log into the <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a>, select <em>Actions</em> from the menu on the left side of the page, then select <em>Flows</em>. You‚Äôll be on the <em>Choose Flow</em> page, which lists the Auth0 flows that you can modify with one or more Actions:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6Urd7xOI45T2kfVRnSYVfg/2deba4f6affc4cf234e5874d99999ba2/select_the_login_flow.png" alt="The ‚ÄúChoose Flow‚Äù page of the Auth0 dashboard, with instructions to select the ‚ÄúLogin‚Äù flow."/></p><p>We want to change what happens after the user logs in, which we can do by modifying the Login flow. </p><p>üõ† Select the <em>Login</em> flow, which will take you to the <em>Login</em> flow page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7lgp4OyGh5EigXd8W6yZ8n/6c9dd5f1b3a162d8654fd97dcb629369/login_flow_page.png" alt="The ‚ÄúLogin‚Äù flow page of the Auth0 dashboard."/></p><p>The diagram in the center of the page shows the default Login flow‚Äôs two states:</p><ol start="1"><li><strong>Start:</strong> The user has just provided valid credentials.</li><li><strong>Complete:</strong> The system issues an ID token to the user.</li></ol><p>You add Actions between these states to add additional steps to the Login flow by dragging them from the <em>Add Action</em> panel on the right side of the page.</p><p>The <em>Add Action</em> panel has two tabs:</p><ol start="1"><li><strong>Installed:</strong> These are Actions that you have selected from the <a href="https://marketplace.auth0.com/features/actions" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a>, where Auth0 partners provide you with Actions that integrate with their services to add extra functionality to your flows. These Actions do things such as presenting terms and conditions to the user, requesting and collecting additional authentication credentials, sending SMS messages, and more. We won‚Äôt be using any of them in this tutorial‚Äôs exercises, but you‚Äôll want to explore them later.</li><li><strong>Custom:</strong> You write these Actions in the Auth0 dashboard. The dashboard‚Äôs code editor checks your syntax and versions your functions&#39; code so that you can always revert to a previous version if needed. You‚Äôll write custom Actions in this tutorial‚Äôs exercises.</li></ol><h3 id="Define--Rickroll---your-first-custom-Action">Define ‚ÄúRickroll,‚Äù your first custom Action</h3><p>üõ† Click the <em>+</em> button to the right of the <em>Add Action</em> heading of the <em>Add Action</em> panel on the right side of the page. Select <em>Build Custom</em> from the menu that appears:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4AlGcWH9I7XWxYaG9BGpgt/7bc82776e321c1fe97b3e91a06667439/add_action.png" alt="The ‚ÄúAdd Action‚Äù panel, with instructions to click the ‚Äú+‚Äù button and then click the ‚ÄúBuild Custom‚Äù item in the menu that appears."/></p><p>üõ† The <em>Create Action</em> dialog box will appear. Enter a name for the Action (I used ‚ÄúRickroll‚Äù) and make sure that <em>Login / Post Login</em> is selected under <em>Trigger</em> and that <em>Node 16</em> is selected under <em>Runtime</em>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7fTn7AHdvt7M8SpAdzLOVV/f3c35b96f17762e872be0b8661a4864b/create_action_dialog.png" alt="The ‚ÄúCreate Action‚Äù dialog box"/></p><p>üõ† Click the <em>Create</em> button. You‚Äôll be taken to the editor page for your newly created <em>Rickroll</em> Action:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4QzQ7MEW2y61dQdwB8h8M8/6eaea1c771f0ad351c5d961ca1064222/rickroll_editor.png" alt="The editor page for the ‚ÄúRickroll‚Äù Action"/></p><p>Look at the contents of the editor. You‚Äôll see that there are two JavaScript arrow functions:</p><ol start="1"><li><code>onExecutePostLogin</code>: Defines what should happen immediately after the user provides login credentials that Auth0 recognizes. This function takes two parameters, which provide access to Auth0 objects:
 <ul><li><code>event</code>: Contains details about the user and the context in which they are logging in.</li><li><code>api</code>: Contains methods that can change the login‚Äôs behavior.</li></ul></li><li><code>onContinuePostLogin</code>: Defines what should happen when control returns to the Login Action after a redirect to another web page. It‚Äôs used only when the user returns after being redirected, which is why it‚Äôs commented out by default. We‚Äôll take a closer look at this function in the next exercise.</li></ol><p>üõ† Update <code>onExecutePostLogin</code> to the following:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  api<span>.</span>redirect<span>.</span><span>sendUserTo</span><span>(</span><span>&#39;https://www.youtube.com/watch?v=dQw4w9WgXcQ&#39;</span><span>)</span>
<span>}</span><span>;</span></code></pre><p>You‚Äôve just added a single line of code to <code>onExecutePostLogin</code>. That line uses <code>onExecutePostLogin</code>‚Äôs <code>api</code> argument to access its <code>redirect</code> property, an object that contains redirection methods. We‚Äôre using <code>redirect</code>‚Äôs <code><span>sendUserTo</span><span>(</span><span>)</span></code> method to redirect the user to one of the most popular YouTube pages of all time.</p><p>üõ† Click the <em>Deploy</em> button to save your changes.</p><p>You‚Äôve just defined your first custom Action. It‚Äôs time to insert it into the Login flow.</p><h3 id="Add-the-Action-to-the-Login-flow">Add the Action to the Login flow</h3><p>üõ† Click the <em>Back to flow</em> link near the upper left corner of the page to return to the <em>Login</em> flow page.</p><p>üõ† In the <em>Add Action</em> panel, click the <em>Custom</em> tab to reveal your collection of custom Actions. Drag the <em>Rickroll</em> Action to the flow diagram in the center of the page and drop it on the area labeled <em>Drop here</em>: </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2cfG3jovZTlQSjk4LgngRJ/1ceb53bc81044a1c9e6e4cbcc8d12449/darg_and_drop.png" alt="Dragging and dropping the ‚ÄúRickroll‚Äù Action into the Login flow."/></p><p>The flow diagram should now look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/72vAoVa1PvMHKsrq53fTaL/8fae0d32d0185420a155db6cff1e8867/updated_login_flow.png" alt="The updated Login flow, featuring the ‚ÄúRickroll‚Äù Action"/></p><p>üõ† Click the <em>Apply</em> button at the upper right corner of the page to apply the new Login flow you just defined.</p><h3 id="Test-the-Action-and-get-Rickrolled">Test the Action and get Rickrolled</h3><p>üõ† And now comes the fun part: log into any of your tenant‚Äôs applications that use Universal Login and see what happens!</p><blockquote><p>You could also use the <em>Try your Login box</em> option in the Auth0 dashboard‚Äôs <em>Getting Started</em> page (select <em>Getting Started</em> in the left-side menu, then click <em>Try it out</em> in the <em>Try your Login box</em> section).</p></blockquote><p>Instead of going to the screen that your application shows immediately after login, you‚Äôll see a video so beloved it has over a <em>billion</em> views. This will happen as long as the application uses Universal Login, whether it‚Äôs a web application, desktop application, or even a mobile app:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5n0lwayEZoB96CQEFUTEV9/0221d38eb7891dfd6f1b8404d98432e0/never_gonna_give_you_up.jpg" alt="Rick Astley‚Äôs ‚ÄúNever Gonna Give You Up‚Äù YouTube video, as seen on a mobile phone"/></p><h2 id="Redirecting-to-a-Page-and-Back-to-the-Application">Redirecting to a Page and Back to the Application</h2><p>The Rickroll Action, while not terribly useful, demonstrates that you can change the default Login flow to redirect the user to a web page after they log in. </p><p>It‚Äôs one of the few cases when you‚Äôd want to send the user to another page after logging in without returning to the application. The more likely scenario is where you send users to an intermediate page after login, then bring them back to the application once they‚Äôve finished with the page.</p><h3 id="The---continue--endpoint">The <code><span>/</span><span>continue</span></code> endpoint</h3><p>After you send the user to another web page after they log in, how do you bring them back to the application?</p><p>Fortunately, there‚Äôs an endpoint that redirects the user back to the Login flow, issues them an ID token, and returns them to the application. It‚Äôs called the <em><code><span>/</span><span>continue</span></code> endpoint</em> and it takes this form:</p><pre><code>https<span>:</span><span>/</span><span>/</span><span>{</span><span>YOUR</span> <span>TENANT</span> <span>DOMAIN</span><span>}</span><span>/</span><span>continue</span><span>?</span>state<span>=</span><span>{</span><span>STATE</span><span>}</span></code></pre><p>The two values you need to replace are:</p><ul><li><code><span>{</span><span>YOUR</span> <span>TENANT</span> <span>DOMAIN</span><span>}</span></code>: The domain of your tenant, which you can find in the Auth0 dashboard.</li><li><code><span>{</span><span>STATE</span><span>}</span></code>: The value in a query parameter named <code>state</code> that Auth0 includes in the URL when an Action redirects the user to another web page. This value is proof that an Action redirected you and prevents unauthorized parties from using the <code><span>/</span><span>continue</span></code> endpoint to access the application.</li></ul><p>The announcement page will have a link that uses this endpoint. Once the user has finished reading the announcement, they‚Äôll follow the link and return to the application.</p><h3 id="Create-an-announcement-page">Create an announcement page</h3><p>Let‚Äôs create a web application that outputs an announcement page containing a link to the <code><span>/</span><span>continue</span></code> endpoint. Once we do this, we can create a new login Action that redirects the user to this web application.</p><p>If you want to use Express or Flask to make the application, you can use the scripts below. If you use another web application framework, you can use the scripts below as examples to follow.</p><p>Here‚Äôs the Express version of this web application...</p><pre><code><span>var</span> express <span>=</span> <span>require</span><span>(</span><span>&#39;express&#39;</span><span>)</span><span>;</span>
<span>var</span> app <span>=</span> <span>express</span><span>(</span><span>)</span><span>;</span>

app<span>.</span><span>get</span><span>(</span><span>&#39;/&#39;</span><span>,</span> <span>function</span><span>(</span><span>req<span>,</span> res</span><span>)</span><span>{</span>
    <span>// Retrieve the value for the `state` parameter</span>
    <span>const</span> state <span>=</span> req<span>.</span>query<span>.</span>state<span>;</span>
    
    <span>// Don‚Äôt forget to fill in {YOUR TENANT DOMAIN}!</span>
    <span>const</span> continueUrl <span>=</span> <span><span>`</span><span>https://{YOUR TENANT DOMAIN}/continue?state=</span><span><span>${</span>state<span>}</span></span><span>`</span></span><span>;</span>
    
    pageContent <span>=</span> <span><span>`</span><span>
&lt;!doctype html&gt;
&lt;html lang=en&gt;
&lt;head&gt;
    &lt;meta charset=utf-8&gt;
    &lt;title&gt;Special Announcement&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Special Announcement&lt;/h1&gt;
    &lt;p&gt;Here‚Äôs some material that you should read before using the app...&lt;/p&gt;
    &lt;p&gt;&lt;a href=&#34;</span><span><span>${</span>continueUrl<span>}</span></span><span>&#34;&gt;Continue to the app&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</span><span>`</span></span><span>;</span>
    res<span>.</span><span>send</span><span>(</span>pageContent<span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>...and here‚Äôs the Flask version:</p><pre><code><span>from</span> flask <span>import</span> Flask<span>,</span> request

app <span>=</span> Flask<span>(</span>__name__<span>)</span>

<span>@app<span>.</span>route</span><span>(</span><span>&#39;/&#39;</span><span>)</span>
<span>def</span> <span>index</span><span>(</span><span>)</span><span>:</span>
    <span># Retrieve the value for the `state` parameter</span>
    state <span>=</span> request<span>.</span>args<span>.</span>get<span>(</span><span>&#39;state&#39;</span><span>)</span> 
    
    <span># Don‚Äôt forget to fill in {YOUR TENANT DOMAIN}!</span>
    continue_url <span>=</span> <span><span>f&#39;https://</span><span><span>{</span>YOUR TENANT DOMAIN<span>}</span></span><span>/continue?state=</span><span><span>{</span>state<span>}</span></span><span>&#39;</span></span>
    
    page_content <span>=</span> <span><span>f&#34;&#34;&#34;
&lt;!doctype html&gt;
&lt;html lang=en&gt;
&lt;head&gt;
    &lt;meta charset=utf-8&gt;
    &lt;title&gt;Special Announcement&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h1&gt;Special Announcement&lt;/h1&gt;
    &lt;p&gt;Here‚Äôs some material that you should read before using the app...&lt;/p&gt;
    &lt;p&gt;&lt;a href=&#34;</span><span><span>{</span>continue_url<span>}</span></span><span>&#34;&gt;Continue to the app&lt;/a&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
    &#34;&#34;&#34;</span></span>
    <span>return</span> page_content

<span>if</span> __name__ <span>==</span> <span>&#39;__main__&#39;</span><span>:</span>
    app<span>.</span>run<span>(</span><span>)</span></code></pre><h3 id="Remove--Rickroll--from-the-Login-flow">Remove <em>Rickroll</em> from the Login flow</h3><p>Before we create a new Action to redirect the user to the announcement page, we need to remove the <em>Rickroll</em> Action first.</p><p>üõ† In the Auth0 dashboard, return to the <em>Flows</em> page (select <em>Actions</em> ‚Üí <em>Flows</em> from the left-side menu), then select <em>Login</em>. This will take you to the <em>Login</em> flow page, which will show that the <em>Rickroll</em> Action is currently part of the Login flow:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/72vAoVa1PvMHKsrq53fTaL/8fae0d32d0185420a155db6cff1e8867/updated_login_flow.png" alt="The current Login flow, featuring the ‚ÄúRickroll‚Äù Action"/></p><p>üõ† To remove the <em>Rickroll</em> Action, select it in the Login flow diagram. The panel on the right side of the page will update to display controls for the selected Action. Click the <em>Remove</em> button at the bottom of the panel:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2bpPf12Qcn2B3o3ZxqP80o/2e98e4ad8a54790b30c1c2332eb8c9bd/remove_rickroll_action.png" alt="Removing the ‚ÄúRickroll‚Äù Action from the Login flow"/></p><p>The Login flow will return to its original state:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7lgp4OyGh5EigXd8W6yZ8n/6c9dd5f1b3a162d8654fd97dcb629369/login_flow_page.png" alt="The ‚ÄúLogin‚Äù flow page of the Auth0 dashboard."/></p><h3 id="Define-a-new-custom-Action---Announcement-">Define a new custom Action: <em>Announcement</em></h3><p>üõ† Let‚Äôs create the new Action. Once again, click the <em>+</em> button to the right of the <em>Add Action</em> heading of the <em>Add Action</em> panel on the right side of the page. Select <em>Build Custom</em> from the menu that appears:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4AlGcWH9I7XWxYaG9BGpgt/7bc82776e321c1fe97b3e91a06667439/add_action.png" alt="The ‚ÄúAdd Action‚Äù panel, with instructions to click the ‚Äú+‚Äù button and then click the ‚ÄúBuild Custom‚Äù item in the menu that appears."/></p><p>üõ† You‚Äôll see the <em>Create Action</em> dialog box again. Enter a name for the Action (I used ‚ÄúAnnouncement‚Äù) and make sure that <em>Login / Post Login</em> is selected under <em>Trigger</em> and that <em>Node 16</em> is selected under <em>Runtime</em>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2jPO10XAwir5BhZ6kzRerd/9419c20689c1b198ddcb25bd52781c98/create_action_dialog_2.png" alt="The ‚ÄúCreate Action‚Äù dialog box"/></p><p>üõ† Click the <em>Create</em> button. You‚Äôll be taken to the editor page for your newly created <em> Announcement</em> Action.</p><p>üõ† In the editor, update the <code>onExecutePostLogin</code> arrow function to the following:</p><pre><code><span>// Redirect the user to the announcement page</span>

exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  api<span>.</span>redirect<span>.</span><span>sendUserTo</span><span>(</span><span>&#39;{ANNOUNCEMENT PAGE URL}&#39;</span><span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>üõ† In the code above, replace <code><span>{</span><span>ANNOUNCEMENT</span> <span>PAGE</span> <span>URL</span><span>}</span></code> with the URL for the announcement page. </p><p>Remember that <code>onExecutePostLogin</code> executes after the user submits valid login credentials. When that happens, the function will redirect the user to the URL for the announcement page. That URL will have a query parameter named <code>state</code> added to it.</p><p>üõ† Uncomment the last two lines of code in the editor, which will enable the <code>onContinuePostLogin</code> arrow function. They should look like this:</p><pre><code>exports<span>.</span><span>onContinuePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
<span>}</span><span>;</span></code></pre><p><code>onContinuePostLogin</code> executes after the user returns from a redirect made in the <code>onExecutePostLogin</code> function by following the <code><span>/</span><span>continue</span></code> endpoint. Even though this function is empty, it‚Äôs still necessary when the user is expected to return to the application after being redirected.</p><blockquote><p><strong>üö®Warning:üö®</strong> If the user returns after being redirected and the <code>onContinuePostLogin</code> function isn‚Äôt defined ‚Äî even as an empty function ‚Äî the login process will fail, and the user will see a web page with a single word: <em>Unauthorized</em>.</p></blockquote><p>üõ† Click the <em>Deploy</em> button to save your changes.</p><h3 id="Add-the-Action-to-the-Login-flow">Add the Action to the Login flow</h3><p>Just as you added the <em>Rickroll</em> Action to the Login flow earlier, it‚Äôs time to add the  <em>Announcement</em> Action. </p><p>üõ† Follow these steps:</p><ul><li>Click the <em>Back to flow</em> link near the upper left corner of the page to return to the <em>Login</em> flow page.</li><li>In the <em>Add Action</em> panel, click the <em>Custom</em> tab to reveal your collection of custom Actions.</li><li>Drag the <em>Announcement</em> Action to the flow diagram in the center of the page and drop it on the area labeled <em>Drop here</em>:</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3i95ELoEQVksdo3XnuIUzD/3941fed1d0f63cc707c6e680e7cab2e3/drag_and_drop_2.png" alt="Dragging and dropping the ‚ÄúAnnouncement‚Äù Action into the Login flow."/></p><p>üõ† Finally, click the <em>Apply</em> button at the upper right corner of the page to apply this new Login flow.</p><h3 id="Test-the-Action">Test the Action</h3><p>üõ† Try the Action! Run the web application that generates the announcement page and log into any application that uses your tenant and Universal Login.</p><p>Instead of being Rickrolled, you‚Äôll see the announcement page this time (you‚Äôll probably want to make a better-looking one for a production application). Here‚Äôs what it looks like on an Android emulator:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/44lmTZfe5KuJJxKERfi4RC/6c9a5383087922d9155effb8ecba74f6/announcement_page_on_mobile.png" alt="The announcement page, as seen on an Android emulator"/></p><p>Note that the browser displaying the Universal Login page contains the URL for the announcement page, complete with the <code>state</code> query parameter. That parameter is also used in the URL for the ‚ÄúContinue to the app‚Äù link.</p><p>üõ† Click or tap on the ‚ÄúContinue to the app‚Äù link. The Universal Login page will disappear, and you‚Äôll now be in the application. Behind the scenes, Auth0 will have issued an ID token to the application.</p><p>You now have an announcement page that appears after the user provides valid credentials and before the application starts.</p><h2 id="Improving-the--Announcement--Action">Improving the <em>Announcement</em> Action</h2><p>In its current state, the announcement page has a couple of issues:</p><ol start="1"><li>It appears every time the user logs in. You might prefer that each user sees the announcement page only once.</li><li>It appears for every application in your tenant. You probably want the announcement to appear only for a specific application.</li></ol><h3 id="Track-when-the-user-has-seen-the-announcement">Track when the user has seen the announcement</h3><p>Users might get annoyed if they see the announcement every time they log in. Let‚Äôs make a change so that they see it only once. To do this, we‚Äôll need to store a value that tracks if the user has viewed the announcement ‚Äî <em>for every user</em>.</p><p>Rather than set up a database to track which users have seen the announcement, let‚Äôs take advantage of the metadata stored with every user account.</p><p>Each Auth0 user account stores two kinds of metadata for each user:</p><ol start="1"><li><strong>User metadata:</strong> Stores data about the user that the user <em>can</em> view and edit. It‚Äôs meant for data that <em>doesn‚Äôt</em> affect the application‚Äôs key functionality. It‚Äôs for storing information such as user settings and preferences.</li><li><strong>App metadata:</strong> Stores data that the user <em>cannot</em> view or edit ‚Äî only the application can access and modify this data. It‚Äôs meant for data that <em>does</em> affect the application‚Äôs key functionality. It‚Äôs for storing information about the user‚Äôs state, making it a good place to store a flag indicating that the user has seen an announcement.</li></ol><p>User metadata and app metadata are stored as collections of key-value pairs. When you interact with them in JavaScript, these collections are in dictionary form.</p><p>Let‚Äôs update the <code>onExecutePostLogin</code> function in the <em>Announcements</em> Action to check for the presence of a <code>viewed_announcement_page</code> key in the user‚Äôs app metadata dictionary. If the key doesn‚Äôt exist, we‚Äôll send the user to the announcement page.</p><p>üõ† Change <code>onExecutePostLogin</code> in the <em>Announcements</em> Action to the following:</p><pre><code><span>// Show the announcement page if the user hasn‚Äôt seen it yet</span>
exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>if</span> <span>(</span><span>!</span>event<span>.</span>user<span>.</span>app_metadata<span>[</span><span>&#39;viewed_announcement_page&#39;</span><span>]</span><span>)</span> <span>{</span>
    api<span>.</span>redirect<span>.</span><span>sendUserTo</span><span>(</span><span>&#34;{ANNOUNCEMENT PAGE URL}&#34;</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>In the code above, we‚Äôre using <code>onExecutePostLogin</code>‚Äôs <code>event</code> argument to access its <code>user</code> property. The <code>user</code> object contains an object representing the account of the user who just logged in. <code>user</code>‚Äôs properties contain data about the user, and one of them is <code>app_metadata</code>. We‚Äôre checking to see if it <em>doesn‚Äôt</em> contain a key named <code>viewed_announcement_page</code>, and if that‚Äôs the case, we redirect the user to the announcement.</p><p>We‚Äôll also need to record that the user has seen the announcement. We can do that in the <code>onContinuePostLogin</code> function, which executes only after the user has returned from the announcement page.</p><p>üõ† Change <code>onContinuePostLogin</code> in the <em>Announcements</em> Action to the following:</p><pre><code><span>// After returning from the announcement page,</span>
<span>// record that the user has seen it.</span>
exports<span>.</span><span>onContinuePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  api<span>.</span>user<span>.</span><span>setAppMetadata</span><span>(</span><span>&#39;viewed_announcement_page&#39;</span><span>,</span> <span>true</span><span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>The <code>user</code> property of the <code>api</code> object lets us add or modify key-value pairs in the user metadata and the app metadata. We‚Äôll use it to add a new key, <code>viewed_announcement_page</code>, to the app metadata if it doesn‚Äôt already exist, then set that key‚Äôs value to <code><span>true</span></code>.</p><p>üõ† Once you‚Äôve made these changes, click the <em>Deploy</em> button at the upper right corner of the page.</p><p>üõ† Make sure that the web application that generates the announcement page is running and log into any application that uses your tenant and Universal Login. The first time you do this, you‚Äôll see the announcement.</p><p>üõ† Log out of the application, then log in again with the same user. This time, you won‚Äôt be redirected to the announcement page.</p><p>If you go to the <em>Details</em> page for the user‚Äôs account in the Auth0 dashboard (select <em>User Management</em> from the left-side menu, then <em>Users</em>, then the user, and make sure the <em>Details</em> tab is selected), you‚Äôll see that the <em>app_metadata</em> section contains the following key-value pair: <code><span>&#34;viewed_announcement_page&#34;</span><span>:</span> <span>true</span></code>.</p><blockquote><p>Remember that you can edit any user‚Äôs user and app metadata directly from their account page in the dashboard.</p></blockquote><h3 id="Limit-the-announcement-to-a-specific-app">Limit the announcement to a specific app</h3><p>To ensure that the only users logging into a specific application see the announcement, we need to write code to identify the application.</p><p>There are a couple of ways to identify the application that the user is logging into, and they‚Äôre both accessible from the <code>event</code> object‚Äôs <code>client</code> property:</p><ul><li><code>event<span>.</span>client<span>.</span>client_id</code>: The client ID of the app that the user is logging into.</li><li><code>event<span>.</span>client<span>.</span>name</code>: The name of the app that the user is logging into.</li></ul><p>I don‚Äôt recommend identifying the application by its name. This value is editable in the dashboard, which means you could unknowingly break your Action simply by renaming an application. You should identify applications by their client ID, which can‚Äôt be changed.</p><p>Select an application in your tenant that you want to display the announcement. Make a note of its client ID (client IDs are listed with the applications on the dashboard‚Äôs <em>Applications</em> page).</p><p>üõ† Change <code>onExecutePostLogin</code> in the <em>Announcements</em> Action to the following:</p><pre><code>exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>if</span> <span>(</span><span>(</span>event<span>.</span>client<span>.</span>client_id <span>===</span> <span>&#39;{CLIENT ID}&#39;</span><span>)</span> <span>&amp;&amp;</span>
    <span>(</span><span>!</span>event<span>.</span>user<span>.</span>app_metadata<span>[</span><span>&#39;viewed_announcement_page&#39;</span><span>]</span><span>)</span><span>)</span> <span>{</span>
      api<span>.</span>redirect<span>.</span><span>sendUserTo</span><span>(</span><span>&#39;{ANNOUNCEMENT PAGE URL}&#39;</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>üõ† In the code above:</p><ul><li>Replace <code><span>{</span><span>CLIENT</span> <span>ID</span><span>}</span></code> with the client ID of the application that will display the announcement.</li><li>Replace <code><span>{</span><span>ANNOUNCEMENT</span> <span>PAGE</span> <span>URL</span><span>}</span></code> with the URL of the page that you want to redirect the user to.</li></ul><p>üõ† Once you‚Äôve made this change, click the <em>Deploy</em> button at the upper right corner of the page.</p><p>üõ† Select a user that you will use to log in. Visit their page and remove any instance of <code><span>&#34;viewed_announcement_page&#34;</span><span>:</span> <span>true</span></code> from the <em>app_metadata</em> section of their page.</p><p>üõ† Make sure that the web application that generates the announcement page is running.</p><p>üõ† Log into an application that isn‚Äôt supposed to show the announcement after login. You should <em>not</em> see the announcement.</p><p>üõ† Now log into the application that is supposed to show the announcement. You should see the announcement the first time you log in, but not after subsequent logins.</p><p>You now have an Action that displays an announcement for a specific application after login if the user hasn‚Äôt seen the announcement before!</p><h2 id="Ideas-to-Try">Ideas to Try</h2><p>We designed Actions to help you customize how Auth0 works with your applications and enhance what it already does. I showed you only a couple of creative ways to write Login flow-based Actions that redirect the user; here are a few more ideas you might want to try:</p><ul><li><strong>A better Rickroll:</strong> Instead of redirecting the user to the <em>Never Gonna Give You Up</em> YouTube page, redirect the user to a page containing the video <em>and</em> a <code><span>/</span><span>continue</span></code> endpoint link to get back to the application.</li><li><strong>‚ÄúApril Fools‚Äô‚Äù and similar holidays:</strong> Many cultures have <a href="https://en.wikipedia.org/wiki/April_Fools%27_Day" target="_blank" rel="noreferrer noopener">‚ÄúApril Fools‚Äô Day‚Äù</a> or a similar day where people play practical jokes and pranks on each other. You could use redirect the user to a joke page similar to the one proposed in A better Rickroll.</li><li><strong>System downtime:</strong> I mentioned this earlier, but it‚Äôs so useful that it bears repeating. Suppose the system(s) hosting your application are down or experiencing connection issues. In that case, you could use an Action and the Login flow to redirect the user to a page announcing the downtime after login. This page doesn‚Äôt need the <code><span>continue</span></code> endpoint and should be hosted on a different system than the one(s) hosting your application.</li><li><strong>Getting additional information from first-time users:</strong> If the user doesn‚Äôt have a ‚Äúfirst-time user‚Äù flag in their app metadata, you can redirect them to a page where they can provide additional information and return them to the application afterward.</li><li><strong>Enforcing security requirements:</strong> One of my favorite examples comes from <a href="https://auth0.com/blog/auth0-announces-the-winners-of-the-actions-hackathon/" target="_blank" rel="noreferrer noopener">the winners of the Auth0 Actions Hackathon,</a> who used the Login flow and redirection to authenticate the user‚Äôs VPN during login. The Action they created redirects the user to a page that verifies if the user is currently in the corporate network and, if not, starts the VPN client software on the user machine to connect to VPN.</li></ul><p>Actions are a great place to get creative and experiment. See what you can come up with!</p></div></div>]]></content:encoded>
      <pubDate>Thu, 23 Dec 2021 15:26:00 +0000</pubDate>
    </item>
    <item>
      <title>Customize User Registration Experience with Auth0 Actions</title>
      <link>https://auth0.com/blog/customize-user-registration-experience-with-auth0-actions/</link>
      <description>Learn how to customize the user registration experience with Auth0 Actions.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Did you know that you can customize some of the features Auth0 provides? You can do it with Actions. Are you looking for an example? Let me show you how to customize the user experience when they register with an application.</p><h2 id="Auth0-and-User-Registration">Auth0 and User Registration</h2><p>Using Auth0 to secure your application offers a lot of simplification right from the user&#39;s initial visual impression: the login page. The <a href="https://auth0.com/docs/login/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login</a> page not only relieves you of the burden of authenticating users but also of the task of managing their self-registration. In fact, in the default configuration, if the user doesn&#39;t have an account to access your application, they have the opportunity to register themselves through the <em>Sign up</em> link highlighted in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6VizfIqgyfJkvIBtrOqrYt/f17bdf6d9f3d8f19f0d33cb1f880c9d4/auth0-universal-login-page.png" alt="Auth0 Universal Login page with user registration"/></p><p>Following that link, the user can provide an email address and a password to start the registration and authentication process in no time.</p><p>All this happens without any intervention on your side. It&#39;s all-inclusive!</p><h2 id="Customize-the-User-Registration-Experience">Customize the User Registration Experience</h2><p>That&#39;s pretty fine, but maybe you are wondering how to customize the user registration experience, for example, by sending a custom welcome email message. Say you want to thank the user for registering and make them aware of the terms and conditions for using the application. This is what you are going to learn right in this article!</p><p>You will learn that you can extend Auth0 standard flows and customize them for your needs. In particular, you will use <a href="https://auth0.com/docs/actions" target="_blank" rel="noreferrer noopener">Auth0 Actions</a> to send your welcome email message after the user signs up for your application.</p><p>Let&#39;s start!</p><h2 id="The-Sample-Application">The Sample Application</h2><p>For this purpose, you will use a sample application that will let you experience the proposed solution firsthand.</p><blockquote><p>The sample application you are going to use in this article is built with C# and requires <a href="https://dotnet.microsoft.com/en-us/download" target="_blank" rel="noreferrer noopener">.NET</a> installed on your machine. However, <u>the user registration customization you are going to implement is independent of your application&#39;s specific programming language and framework.</u></p></blockquote><p>To get that sample application, clone it from GitHub with the following command:</p><pre><code><span>git</span> clone https://github.com/auth0-blog/acme-aspnet-mvc.git</code></pre><p>After you download the application, follow the instructions in the <a href="https://github.com/auth0-blog/acme-aspnet-mvc/blob/main/README.md" target="_blank" rel="noreferrer noopener">README file</a> to configure it in order to use Auth0. Of course, you need an Auth0 account. If you don&#39;t have it, <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">you can get one for free</a>.</p><blockquote><p>If you want to learn more about how the sample application was built, you can check out <a href="https://auth0.com/blog/add-authentication-aspnet-core-mvc" target="_blank" rel="noreferrer noopener">this blog post</a>.</p></blockquote><p>After configuring the sample application, you can run it with the following command:</p><pre><code>dotnet run</code></pre><p>Pointing your browser to the <a href="https://localhost:7095/" target="_blank" rel="noreferrer noopener">https://localhost:7095/</a> address, you should get the following page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5yO9ER9JsSrsFGXj5e1w6e/3c4f71b3286b43249d0e89a3e7e44c70/acme-homepage-login.png" alt="Sample app home page"/></p><h2 id="What-Are-Auth0-Actions-">What Are Auth0 Actions?</h2><p>As said, you are going to use Auth0 Actions to customize the user registration process.</p><p>Auth0 Actions are JavaScript functions running in a Node.js environment executed when specific events happen in some internal Auth0 flows.</p><p>For example, you can run one or more Auth0 Actions when a user authenticates or change their password. You can run them before or after the user registers or when you send an SMS to your provider for multi-factor authentication. You can see Actions as event handlers that run when a specific Auth0 event fires. For example, in our specific case, you want to handle the event that fires right after the user registers with Auth0. When this event happens, you want to run your code to send a customized welcome email message. You can imagine this event handling as shown by the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5RPXK0K8xtuQTljcOSYYFH/5e6705b448cfc558a31533aee1d819ce/post-registration-auth0-action.png" alt="Post user registration Auth0 Action"/></p><p>To implement this behavior, you are going to use the Auth0 Dashboard, which provides you with an editor, a test environment, an integrated deployment environment, and a versioning tool.</p><p>You can check out these blog posts for <a href="https://auth0.com/blog/introducing-auth0-actions/" target="_blank" rel="noreferrer noopener">a quick introduction to Auth0 Actions</a> and how they <a href="https://auth0.com/blog/actions-now-generally-available/" target="_blank" rel="noreferrer noopener">compare with the deprecated Rules and Hooks</a>.</p><h2 id="Implement-the-Email-Sender-Action">Implement the Email Sender Action</h2><p>Let&#39;s start implementing our customization. Go to your <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a> and select <a href="https://manage.auth0.com/#/actions/library" target="_blank" rel="noreferrer noopener">Library under the Actions item</a> from the left side menu. You will access a page where all your Actions are located. If you have never created any Actions, the page will appear as in this picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3BA4BOqfV2JXCZbcmhMBrA/08201459e1b678f8fef5501e8663ba8e/auth0-actions-library-page.png" alt="Auth0 Actions Library page"/></p><p>You can create your own Action or install a <a href="https://marketplace.auth0.com/features/actions" target="_blank" rel="noreferrer noopener">third-party Action from the Auth0 Marketplace</a>. In the first case, you will start by clicking the <em>Build Custom</em> button, and the resulting Action will be listed in the <em>Custom</em> tab. In the second case, you will start by clicking the <em>+ Add Action</em> button, selecting one of the ready-to-use available Actions, and the new Action will be listed in the <em>Installed</em> tab.</p><h3 id="Create-a-new-Action">Create a new Action</h3><p>For the current project, you will build a custom Action. So, click the <em>Build Custom</em> button and fill the pop-up form. You should provide a friendly name for the Action and select the trigger that will run it, i.e., the event you are going to handle with this Action. For our project, you should select the <em>Post User Registration</em> trigger, as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6TzhULLz688fdjQxJqm8Yb/02a5f3c416c5b4a31c358171308dd0d6/create-custom-action-dialog.png" alt="Create custom Action dialog"/></p><p>Once you click the <em>Create</em> button, you enter the Action editor, where you find the following code:</p><pre><code>exports<span>.</span><span>onExecutePostUserRegistration</span> <span>=</span> <span>async</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span>
<span>}</span><span>;</span></code></pre><p>This is the JavaScript function that will be executed after the user registers with your application. This function will be exported in the Node.js environment running on the Auth0 side.</p><p>As you can see, the function has an <code>event</code> parameter, which provides some information about the current running environment. For example, it allows you to access the current user&#39;s data, the current request, the tenant, etc. For more details about <a href="https://auth0.com/docs/actions/triggers/post-user-registration/event-object" target="_blank" rel="noreferrer noopener">the Post User Registration event object, check out the documentation</a>.</p><p>To go straight to the solution, replace the current code in the Action editor with the following:</p><pre><code><span>const</span> axios <span>=</span> <span>require</span><span>(</span><span>&#34;axios&#34;</span><span>)</span><span>;</span>

exports<span>.</span><span>onExecutePostUserRegistration</span> <span>=</span> <span>async</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>try</span> <span>{</span>
    axios<span>.</span><span>post</span><span>(</span><span>&#39;https://api.sendgrid.com/v3/mail/send&#39;</span><span>,</span>
      <span>{</span>
        personalizations<span>:</span> <span>[</span><span>{</span>
          to<span>:</span> <span>[</span><span>{</span> email<span>:</span> event<span>.</span>user<span>.</span>email <span>}</span><span>]</span>
        <span>}</span><span>]</span><span>,</span>
        <span>from</span><span>:</span> <span>{</span> email<span>:</span> <span>&#39;no-reply@acme-demo-corporation.com&#39;</span> <span>}</span><span>,</span>
        subject<span>:</span> <span>&#39;Welcome to ACME Corporation website&#39;</span><span>,</span>
        content<span>:</span> <span>[</span><span>{</span>
          type<span>:</span> <span>&#39;text/html&#39;</span><span>,</span>
          value<span>:</span> <span><span>`</span><span>Hello </span><span><span>${</span>event<span>.</span>user<span>.</span>name<span>}</span></span><span>,&lt;br&gt;
          Welcome to our website!&lt;br&gt;
          As an ACME user, you can take advantage of our catalog and services.
          Please, take a look at our &lt;a href=&#34;https://acme-demo-corporation.com/terms-and-conditions&#34;&gt;terms and conditions&lt;/a&gt;.&lt;br&gt;
          &lt;br&gt;          
          Kind regards,&lt;br&gt;
          ACME Corporation&lt;br&gt;</span><span>`</span></span>
        <span>}</span><span>]</span>
      <span>}</span><span>,</span>
      <span>{</span>
        headers<span>:</span> <span>{</span>
          <span>&#39;Authorization&#39;</span><span>:</span> <span>&#39;Bearer &#39;</span> <span>+</span> event<span>.</span>secrets<span>.</span><span>SENDGRID_API_KEY</span>
        <span>}</span>
      <span>}</span>
    <span>)</span><span>;</span>
  <span>}</span> <span>catch</span> <span>(</span>err<span>)</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span><span>`</span><span>Error sending email to </span><span><span>${</span>event<span>.</span>user<span>.</span>email<span>}</span></span><span>:</span><span>`</span></span><span>,</span> err<span>.</span>message<span>)</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>This code uses <a href="https://axios-http.com/" target="_blank" rel="noreferrer noopener">Axios</a> as the HTTP client that makes requests to the <a href="https://sendgrid.com/solutions/email-api/" target="_blank" rel="noreferrer noopener">SendGrid API</a> to send your welcome email message.</p><blockquote><p>The Action implemented in this example uses SendGrid to send emails. Of course, you can adapt the code to use your favorite email provider.</p></blockquote><p>Basically, the Action&#39;s code sends an HTTP POST message to SendGrid&#39;s <code>mail<span>/</span>send</code> endpoint with some data that define the email. To learn more about the specific SendGrid API, check out <a href="https://sendgrid.api-docs.io/v3.0/mail-send/v3-mail-send" target="_blank" rel="noreferrer noopener">the official documentation</a>.</p><h3 id="Configure-your-Action">Configure your Action</h3><p>Looking at the Action&#39;s code, there are a couple of things you should pay attention to:</p><ul><li>You get the user&#39;s email and name by accessing <code>event<span>.</span>user<span>.</span>email</code> and <code>event<span>.</span>user<span>.</span>name</code>, respectively.</li><li>You use the <code>event<span>.</span>secrets<span>.</span><span>SENDGRID_API_KEY</span></code> property to access the API key required by SendGrid to authorize your requests.</li></ul><p>While the user&#39;s data are automatically provided by Auth0 through the <code>event</code> parameter, you need to manually configure the SendGrid API key as a secret. For this purpose, click the key icon on the left side of the Action editor and then click the <em>Add Secret</em> button in the sliding panel that opens. You should get a pop-up window similar to the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7hI5RucTwqPP6XTDBPZEDt/773ed0952c252f848c415e346108c040/configure-auth0-action-secret.png" alt="Configure Auth0 Action secret"/></p><p>Fill the form with <code><span>SENDGRID_API_KEY</span></code> in the <em>Key</em> field and your SendGrid API key in the <em>Value</em> field.</p><p>To complete the Action configuration, you need to make the Axios library available to the Node.js environment. So, click the cube icon on the left side of the Action editor and then click the <em>Add Module</em> button in the sliding panel that opens. This time you should see a pop-up window like the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7clXWV3UNjHqaeNWs36cyq/2966b30f21df9f257db625845c908769/add-auth0-action-dependency.png" alt="Add Auth0 Action dependency"/> </p><p>Fill the form with the <code>axios</code> string in the <em>Name</em> field. Unless you want to install a specific version of the library, you don&#39;t need to specify anything else.</p><p>Save your current work by clicking the <em>Save Draft</em> button.</p><h3 id="Test-your-Action">Test your Action</h3><p>Now your Action is ready to run. However, before putting it into production, it is appropriate to do some tests and make sure that everything works as expected.</p><p>Click the triangle icon on the left side of the Action editor. A panel opens with an event instance as shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7fXpzlolnINotm8DRlaQsz/287e377b8184c048c6353764c3e18a62/test-auth0-action.png" alt="Testing an Auth0 Action"/></p><p>This event object is the argument that will be passed to your Action when you click the <em>Run</em> button at the bottom of the test panel. Before running the test, you have the opportunity to modify that event object. For example, you can detect the <code>user</code> object within the event and change its <code>email</code> property with your personal email address. This way, by running the test, you can  receive the email sent by the Action and verify that it works.</p><p>So, change the user&#39;s email address in the event object and click the <em>Run</em> button. If everything works as it should, you should see a window at the bottom right, as this picture shows:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5y06GPj4vRRMYBiaSXM895/1e3bd365d3c177ff0e773754927f744d/test-result-auth0-action.png" alt="Test results of an Auth0 Action"/></p><p>This new window gives you some feedback on test execution. Of course, your test is successful if you receive the expected email in your mailbox.</p><h3 id="Deploy-your-Action">Deploy your Action</h3><p>So far, your Action lives just in your development environment. You can&#39;t still use it in production. To make it available to your Auth0 production environment, you need to deploy it. That is easily achievable by clicking the <em>Deploy</em> button above the Action editor.</p><p>Separating the development and production environments is crucial, especially when you already have a working Action in production and need to apply some changes. You can apply your changes to the Action and test them in the editor without worrying about breaking the production environment. When you are confident with the changes, you can deploy the new version of the Action to update it in production.</p><p>Also, the Action editor keeps track of the various versions of your Action. You can see them by clicking the <em>Version history</em> button. You will see the list of your current and previous versions as in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5Yi9izjH5jgVP1zW7VPYQY/5d64d0d6a2733be39956412e9dc474f3/auth0-action-version-history.png" alt="Auth0 Action version history"/></p><p>Through this list, you can inspect the Action&#39;s previous versions, and, if needed, you can revert the current version with one of them.</p><h3 id="Add-your-Action-to-the-Post-User-Registration-Flow">Add your Action to the Post User Registration Flow</h3><p>Once deployed, your Action will be available in the <em>Custom</em> tab of the <a href="https://manage.auth0.com/#/actions/library" target="_blank" rel="noreferrer noopener">Action&#39;s Library page of the Auth0 Dashboard</a>. The next step to achieve the goal stated at the beginning of this article is to make the just-created Action run right after the user registers with your app.</p><p>For this purpose, select <a href="https://manage.auth0.com/#/actions/flows" target="_blank" rel="noreferrer noopener"><em>Flows</em> under the <em>Actions</em> item</a> from the left side menu of the Auth0 Dashboard. You will see a page showing the possible flows you can configure:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2kEyKU7ezUFe8xQjAazjCO/7ee44da12d808eaf393bf8aa409a5397/auth0-flows.png" alt="Auth0 flows"/></p><p>For your goal, you will choose the <em>Post User Registration</em> flow. You will enter the flow editor, which provides you with a visual diagram of the flow, as in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3NTsE7zdq101rOObLXMjZE/3ca40fe50dcb291d13a88dd2a1ae001e/auth0-flow-editor.png" alt="Auth0 flow editor"/></p><p>On the right side of the editor, you have the list of the available Actions. As with the Library page, you have the Actions classified as <em>Installed</em> and <em>Custom</em>. You will find your <em>Send Welcome Message</em> Action in the <em>Custom</em> tab. All you need to do at this point is to drag the <em>Send Welcome Message</em> box from the right side of the editor and drop it in the middle of the flow diagram, between the <em>Start</em> and the <em>Complete</em> node. Your final result will look like the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/58igmA2MYoMejsd9dAN1Mm/fe160aaddb6913b4736cecc2699be266/post-user-registration-auth0-flow-with-action.png" alt="Post user registration Auth0 flow with Action"/></p><p>Keep in mind that, in general, you can add as many Actions as you need to an Auth0 Flow.</p><h2 id="The-New-User-Registration-at-Work">The New User Registration at Work</h2><p>Now, everything is ready. Move back to <a href="https://localhost:7095/" target="_blank" rel="noreferrer noopener">your sample application</a>, click the <em>Login</em> link on the upper right corner of the page, and click the <em>Sign up</em> link in the Auth0 Universal Login page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6VizfIqgyfJkvIBtrOqrYt/f17bdf6d9f3d8f19f0d33cb1f880c9d4/auth0-universal-login-page.png" alt="Auth0 Universal Login page with user registration"/></p><p>Create a new user by providing an email and a password. After a minute, you should receive the welcome email message you created in the <em>Send Welcome Message</em> Action.</p><p>That&#39;s all! Now you have the basic knowledge to create your own Auth0 Actions to customize the various Auth0 flows.</p><h2 id="Recap">Recap</h2><p>At the end of this article, I&#39;m sure you learned a lot of things. You learned what Actions are and how to create them to customize your user experience with their registration process. Although this article focused on a specific example of Action, you learned features that are valid for Auth0 Actions in general. For example, you learned how to manage dependencies and store secrets for an Action, test it and deploy it into production, check the Action&#39;s version history and possibly revert to a previous version, and add an Action to an Auth0 flow.</p><p>By using Auth0 Actions, you will be able to customize the default Auth0 behavior to fulfill your specific needs.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 22 Dec 2021 15:16:00 +0000</pubDate>
    </item>
    <item>
      <title>Building an Edge API Gateway with Fauna and Securing It with Auth0</title>
      <link>https://auth0.com/blog/building-an-edge-api-gateway-with-fauna-and-securing-it-with-auth0/</link>
      <description>In this tutorial, we‚Äôll explore architecting REST APIs in a fully serverless manner by leveraging Fastly‚Äôs Compute@Edge, Fauna, and Auth0</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>When building an application, ensuring a great user experience is a key to user engagement, ultimately impacting how happy your users are with your product. A critical aspect of how a user experiences your application is latency. This is especially true when end-users are globally distributed, as latency is dependent on the distance between the end-user and where the application is being served.</p><p>Yesterday‚Äôs applications didn‚Äôt need to provide millisecond response times for users anywhere in the world, so most compute and database options found in production today cannot handle the use case. But with edge computing, there may finally be an easy way to move applications closer to the end-user, if only databases were quick to adapt to this new architecture. If you‚Äôre building an API today, you cannot simply ‚Äúdeploy‚Äù any database at the edge like the picture shown below, as the edge cannot fully replace the function of a true server.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/67auSB1QgE4vXfTty0LrkL/754afaac91ac10e814bad62a34ed7127/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="Databases Are Meant To Be Connected To Servers.drawio"/></p><p>So what you‚Äôre left with is placing the API (still requiring the app server, database, and all) behind the edge, in the configuration shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2FdjMAEVIlFKASbIqLqHf8/b7862361c1e09bbfa0ca9c2ad9618e7b/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="better"/></p><p>This is still an improvement, as it adds resiliency and reduces latency by caching results where possible. But if speed is the goal, can you do better? Notice the database still has to sit somewhere relative to the edge locations everywhere. What if the database is far from the user? Engineers have solved this by implementing globally <a href="https://www.digitalocean.com/community/tutorials/understanding-database-sharding" target="_blank" rel="noreferrer noopener">sharded</a> databases. But that‚Äôs complicated and expensive.</p><p>If you have the luxury of starting fresh and want to realize the full promise of scale, resiliency, and performance that edge computing provides, you need a globally distributed, serverless database that edge functions simply access using <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" target="_blank" rel="noreferrer noopener">fetch</a>. This is where <a href="https://fauna.com/" target="_blank" rel="noreferrer noopener">Fauna</a> comes into the picture.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/kq1p1t1Cp2wAzs3o6aVdm/912fefb267f3a76db421694502a1d2dc/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="Edge to Cloud API.drawio"/></p><h2 id="What-We-re-Building">What We‚Äôre Building</h2><blockquote><p>See the full sample of this <a href="https://github.com/fauna-labs/edge-gateway-sample-fastly" target="_blank" rel="noreferrer noopener">tutorial‚Äôs content</a>.</p></blockquote><p>In this tutorial, we‚Äôll explore architecting REST APIs in a fully serverless manner by leveraging <a href="https://www.fastly.com/products/edge-compute/serverless" target="_blank" rel="noreferrer noopener"></a>edge computing and Fauna, and we‚Äôre going to secure the API requests with Auth0. In the interest of emphasizing speed, we‚Äôll use Fastly‚Äôs Compute@Edge, which provides ultralow startup times and a low memory footprint via its WASI runtime. The examples below will walk you through building a user registration flow for a website. You‚Äôll be implementing the /users resource and its GET, POST, and PUT methods.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/pwn6amsnHoKAieO3LzHVH/2980da0f6f919c8b3ba5061395335843/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="C@E demo registration.drawio"/></p><p>We‚Äôll also demonstrate two powerful features of Fauna:</p><ol start="1"><li>With <a href="https://docs.fauna.com/fauna/current/api/fql/region_groups" target="_blank" rel="noreferrer noopener">Region Groups</a> you can create your databases in geographic regions of your choice. You can then easily build GDPR compliant architectures by routing requests to specific region groups ‚Äî with the help of the edge ‚Äî depending on where the user is making the request from. The performance also benefits by having the request from the client to edge to the database being as close to each other as possible.</li><li>Fauna supports <a href="https://docs.fauna.com/fauna/current/security/external/" target="_blank" rel="noreferrer noopener">external authentication</a> with any Identity Provider (IdP) that supports the OpenID Connect protocol, allowing you to leverage a service such as <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a> so that you can focus on developing features instead of worrying about security.</li></ol><p><img src="https://images.ctfassets.net/23aumh6u8s0i/30QRsNGnCJtPorHVzoMaUB/65e172cb8cebe11ecd9dc0ab49135f7f/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="Fastly Fauna Auth0.drawio"/></p><h2 id="What-s-Needed-to-Complete-This-Tutorial-">What‚Äôs Needed to Complete This Tutorial?</h2><ul><li>An <a href="https://auth0.com/sign-up" target="_blank" rel="noreferrer noopener">Auth0</a> account</li><li>A <a href="https://dashboard.fauna.com/accounts/register" target="_blank" rel="noreferrer noopener">Fauna</a> account</li><li>A <a href="https://www.fastly.com/signup/" target="_blank" rel="noreferrer noopener">Fastly</a> account</li><li>An API Client such as <a href="https://www.postman.com/" target="_blank" rel="noreferrer noopener">Postman</a> or curl</li><li><a href="https://nodejs.org/en/" target="_blank" rel="noreferrer noopener">Node.js</a> installed on your system</li></ul><p>...and nothing else! No infrastructure is required because you won‚Äôt be standing up or deploying any servers.</p><h2 id="Setting-up-Fauna">Setting up Fauna</h2><p>Your first step will be to configure a database through Fauna&#39;s dashboard. <a href="https://dashboard.fauna.com/" target="_blank" rel="noreferrer noopener">Login to the dashboard</a>, and create a new database named <em>client-serverless-api</em>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/58Z4Tv7J4SYOaPnfqKdH0m/ef9c60ff3a6cb87b2266c9e384086b41/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_create_database_eu450"/></p><ul><li>For Region Group, choose Europe (EU) (for the sake of demonstrating Fauna‚Äôs multi Region Group capability).</li></ul><h3 id="Create-the-User-Collection">Create the User Collection</h3><p>From the left navigation, select Collections and click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">NEW COLLECTION</a>. Provide a name, i.e. <em>User</em> and click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">SAVE</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1td3iOxeISeuIwuJBUWL2y/11f96a84a7982dafc000dcef8e082611/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_create_new_fauna_collection"/></p><h3 id="The-user-model">The user model</h3><p>Below is the design of our <em>User</em> model:</p><pre><code><span>{</span>
<span>&#34;user\_id&#34;</span><span>:</span> <span>&#34;57a9160561254be4229bca97&#34;</span><span>,</span>
<span>&#34;email&#34;</span><span>:</span> <span>&#34;rainer.theo@mailinator.com&#34;</span>
<span>&#34;profile&#34;</span><span>:</span> <span>{</span>
<span>&#34;name&#34;</span><span>:</span> <span>&#34;Rainer Theo&#34;</span><span>,</span>
<span>&#34;countryCode&#34;</span><span>:</span> <span>&#34;DE&#34;</span><span>,</span>
<span>&#34;age&#34;</span><span>:</span> <span>&#34;23&#34;</span>
<span>}</span>
<span>}</span></code></pre><ul><li><code>user_id</code> ‚Äî stores the Auth0 user id</li><li><code>email</code> ‚Äî A required field</li><li><code>profile</code> ‚Äî An optional field freeform JSON object</li></ul><h3 id="Create-an-index">Create an index</h3><p>There will be a <code><span>GET</span> <span>/</span>users<span>/</span><span>{</span>id<span>}</span></code> and a <code><span>POST</span> <span>/</span>users<span>/</span><span>{</span>id<span>}</span></code> API. So you‚Äôll need to create an index which will allow you to query by user_id.</p><p><em>In the interest of learning, we‚Äôll execute all our Fauna commands in the shell going forward, even though some resource configurations (such as creating and updating Collections and Indexes) are available using the UI.</em></p><p>From your Fauna dashboard, use the left navigation and select Shell. Enter the following query into the shell at the bottom of the screen then click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">RUN QUERY</a>.</p><pre><code><span>CreateIndex</span><span>(</span><span>{</span>
  name<span>:</span> <span>&#34;user_by_id&#34;</span><span>,</span>
  source<span>:</span> <span>Collection</span><span>(</span><span>&#34;User&#34;</span><span>)</span><span>,</span>
  terms<span>:</span> <span>[</span>
    <span>{</span> field<span>:</span> <span>[</span><span>&#34;data&#34;</span><span>,</span> <span>&#34;user_id&#34;</span><span>]</span> <span>}</span>
  <span>]</span><span>,</span>
  unique<span>:</span> <span>true</span>
<span>}</span><span>)</span></code></pre><p><em>Since <code>user_id</code> should be unique, we specify the <code>unique<span>:</span> <span>true</span></code> argument.</em></p><h3 id="User-defined-functions">User defined functions</h3><p><img src="https://images.ctfassets.net/23aumh6u8s0i/39zicypQMxWFOZmV596lmB/b2a908110a56fdbff4d2ebb0390cfacf/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="REST to UDF.drawio"/></p><p>The feature-rich, expressive nature of FQL combined with the ability to save them as UDFs makes our implementation straightforward. The key approach will be to map each of the three API calls to their own UDF and then push as much logic as possible down to Fauna (the UDF) so that code running at the edge is really lightweight.</p><p>Let&#39;s start with <code><span>POST</span> <span>/</span>users</code>, which we spec out as such:</p><p>POST /users</p><p>Parameters: JSON body containing <code>email</code> (optional) and an embedded profile <code><span>JSON</span></code> (optional). Headers: Authorization Bearer {{token}} <em>Request example:</em></p><pre><code>curl <span>-</span><span>X</span> <span>POST</span> <span>-</span><span>H</span> <span>&#34;Content-Type: application/json&#34;</span> \
<span>-</span><span>H</span> <span>&#34;Authorization: Bearer eyJhb...&#34;</span> \
<span>-</span>d <span>&#39;{&#34;email&#34;:&#34;rainer.theo@mailinator.com&#34;, &#34;profile&#34;: { &#34;name&#34;: &#34;Rainer Theo&#34; } }&#39;</span> \

https<span>:</span><span>/</span><span>/</span>example<span>.</span>domain<span>.</span>eu<span>/</span>api<span>/</span>users</code></pre><p><em>Response example:</em></p><pre><code><span>{</span>
<span>&#34;user\_id&#34;</span><span>:</span> <span>&#34;57a9160561254be4229bca97&#34;</span><span>,</span>
<span>&#34;email&#34;</span><span>:</span> <span>&#34;rainer.theo@mailinator.com&#34;</span><span>,</span>
<span>&#34;profile&#34;</span><span>:</span> <span>{</span>
<span>&#34;name&#34;</span><span>:</span> <span>&#34;Rainer Theo&#34;</span>
<span>}</span>
<span>}</span></code></pre><ul><li><code>user_id</code> is automatically populated using the <code>sub</code> (subject) claim in the bearer token. Any <code>user_id</code> value provided in a <code><span>POST</span> <span>/</span>users</code> request body will be ignored.</li><li>Auth0 populates <code>sub</code> with its internal <code>user_id</code>, e.g. <code>auth0<span>|</span><span>57</span>a9160561254be4229bca97</code>.</li></ul><p>The first thing you‚Äôll do is create your first role. Custom roles can be defined and attached to UDFs, providing them permissions to operate on resources. You‚Äôll need a role that can <em>read</em>, <em>write,</em> and <em>create</em> <em>Users</em> (you‚Äôll then attach this role to the ‚ÄúCreate User‚Äù UDF). Run the following query:</p><pre><code><span>CreateRole</span><span>(</span><span>{</span>
  name<span>:</span> <span>&#34;usersCRUD&#34;</span><span>,</span>
  privileges<span>:</span> <span>[</span>
    <span>{</span>
      resource<span>:</span> <span>Collection</span><span>(</span><span>&#34;User&#34;</span><span>)</span><span>,</span>
      actions<span>:</span> <span>{</span>
        read<span>:</span> <span>true</span><span>,</span>
        write<span>:</span> <span>true</span><span>,</span>
        create<span>:</span> <span>true</span><span>,</span>
      <span>}</span>
    <span>}</span><span>,</span>
    <span>{</span>
      resource<span>:</span> <span>Index</span><span>(</span><span>&#34;user_by_id&#34;</span><span>)</span><span>,</span>
      actions<span>:</span> <span>{</span>
        unrestricted_read<span>:</span> <span>true</span>
      <span>}</span>
    <span>}</span>    
  <span>]</span>
<span>}</span><span>)</span></code></pre><ul><li>We‚Äôre also going to need this role later on when we implement GET and PUT, so it should also have the permission to read the <em>user</em>by<em>id</em> index.</li></ul><p>Now, run this query to create the <em>CreateUser</em> UDF:</p><pre><code><span>CreateFunction</span><span>(</span><span>{</span>
  name<span>:</span> <span>&#34;CreateUser&#34;</span><span>,</span>
  body<span>:</span> <span>Query</span><span>(</span>
    <span>Lambda</span><span>(</span>
      <span>[</span><span>&#34;body&#34;</span><span>]</span><span>,</span>
      <span>Let</span><span>(</span>
        <span>{</span>
          email<span>:</span> <span>Select</span><span>(</span><span>[</span><span>&#34;email&#34;</span><span>]</span><span>,</span> <span>Var</span><span>(</span><span>&#34;body&#34;</span><span>)</span><span>,</span> <span>null</span><span>)</span><span>,</span>
          profile<span>:</span> <span>Select</span><span>(</span><span>[</span><span>&#34;profile&#34;</span><span>]</span><span>,</span> <span>Var</span><span>(</span><span>&#34;body&#34;</span><span>)</span><span>,</span> <span>null</span><span>)</span><span>,</span>
          dataForCreate<span>:</span> <span>{</span>
            user_id<span>:</span> <span>CurrentIdentity</span><span>(</span><span>)</span><span>,</span>
            email<span>:</span> <span>Var</span><span>(</span><span>&#34;email&#34;</span><span>)</span><span>,</span>
            profile<span>:</span> <span>Var</span><span>(</span><span>&#34;profile&#34;</span><span>)</span>
          <span>}</span>
        <span>}</span><span>,</span>
        <span>Do</span><span>(</span>
          <span>Create</span><span>(</span><span>Collection</span><span>(</span><span>&#34;User&#34;</span><span>)</span><span>,</span> <span>{</span> data<span>:</span> <span>Var</span><span>(</span><span>&#34;dataForCreate&#34;</span><span>)</span> <span>}</span><span>)</span><span>,</span>
          <span>Var</span><span>(</span><span>&#34;dataForCreate&#34;</span><span>)</span>
        <span>)</span>
      <span>)</span>
    <span>)</span>
  <span>)</span><span>,</span>
  role<span>:</span> <span>Role</span><span>(</span><span>&#34;usersCRUD&#34;</span><span>)</span>
<span>}</span><span>)</span></code></pre><ul><li>When you authenticate Fauna with a JWT (External Authentication), the CurrentIdentity() function returns the <code>sub</code> claim of the JWT.</li><li>FQL allows us to return precise responses to the caller. Because we want the API response to look like what we defined in our spec, we call <code><span>Var</span><span>(</span><span>&#34;dataForCreate&#34;</span><span>)</span></code> right at the end. Otherwise, we&#39;ll get the standard response of <code><span>Create</span><span>(</span><span>)</span></code>, which won&#39;t look the same.</li></ul><h3 id="Auth0-AccessProvider-setup">Auth0 AccessProvider setup</h3><p>You‚Äôre almost ready to test <em>CreateUser</em>, but first, you‚Äôll need a JWT from Auth0 and there‚Äôs an integration to complete.</p><p>Step 1: Create an AccessProvider in Fauna: Create a role that has access to call the <em>CreateUser</em> function:</p><pre><code><span>CreateRole</span><span>(</span><span>{</span>
  name<span>:</span> <span>&#34;APIsRole&#34;</span><span>,</span>
  privileges<span>:</span> <span>[</span>
    <span>{</span>
      resource<span>:</span> <span>Function</span><span>(</span><span>&#34;CreateUser&#34;</span><span>)</span><span>,</span>
      actions<span>:</span> <span>{</span>
        call<span>:</span> <span>true</span>
      <span>}</span>
    <span>}</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span></code></pre><p><em>This sets up a custom role for our Auth0 integration, which we‚Äôll need when configuring the Auth0 AccessProvider.</em></p><p>Next, use the UI to create an AccessProvider: From the left navigation panel, select Security &gt; Providers. Then click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">NEW ACCESS PROVIDER</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5KHU1ex6QdAZFGobzdceKs/9007112b4abc04aeaaaf245d328277b9/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_Auth0_For_EU650"/></p><ul><li>Provide a name. e.g. Auth0-For-EU.</li><li>Copy the Audience value for &#34;Step 2&#34; (after this section).</li><li>Set Issuer = <code>https<span>:</span><span>/</span><span><span>/</span><span>&lt;&lt;your auth0 domain&gt;&gt;.auth0.com</span><span>/</span></span></code> and JWKS endpoint = <code>https<span>:</span><span>/</span><span><span>/</span><span>&lt;&lt;your auth0 domain&gt;&gt;.auth0.com</span><span>/</span></span><span>.</span>well<span>-</span>known<span>/</span>jwks<span>.</span>json</code> and replace <code><span>&lt;&lt;</span>your auth0 domain<span>&gt;&gt;</span></code> with your own Auth0 domain name. (Your Auth0 domain can be found in the top left-hand corner of your Auth0 dashboard. See screenshot below.)</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/54oBkKLxxdSiQonJJZHGgJ/e9e50c295e775b4be334191c237fa2b6/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="Activity"/></p><p><em>Note: Depending on the version of your Auth0 account, you may have a subdomain variation that includes region, e.g. <code>https<span>:</span><span>/</span><span><span>/</span><span>mydomain.us.auth0.com</span><span>/</span></span></code></em></p><ul><li>Select the APIsRole role (from the previous step) where the ‚ÄúSelect a role‚Äù dropdown is.</li><li>Click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">SAVE</a>.</li></ul><p>Step 2: Setup an API in Auth0:</p><p>Sign in to Auth0. From the left navigation panel, select Applications &gt; APIs. Provide a Name, e.g. <em>client-serverless-api,</em> and paste the Audience value copied in the previous step into the Identifier field. Click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">Create</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7mzPHu0xafaWBTSBtHSko1/df05bf68f2b942afe9fd375f9562e3b1/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_auth0_new_api450"/></p><p>Once that API is created, navigate to the Test tab. Copy the value of access_token from the sample response (see screenshot below), then head back to the Fauna shell.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7Dky634AN2ahbpWSgkkfA8/5027d2959b83ad63e5a1e7277665c967/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_testJWT"/></p><blockquote><p>Note: When you created the API, Auth0 automatically created a test application that can use the <code>client_credentials</code> grant, which allows generation of <code>access_tokens</code> without a user logging in. The <code>sub</code> (subject) claim in the access_token above refers to the test application instead of any user and you‚Äôll notice that it has a different format. e.g. <code>uf7TdWaOKyWvLahkO2oxJi0AWBdVg24K@clients<span>.</span></code></p></blockquote><p>Step 3: Use the sample access_token in the Fauna shell</p><p>At the bottom of the screen, next to the <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">RUN QUERY</a> button, click ‚ÄúRUN AS‚Äù and change the value of the dropdown from ‚ÄúAdmin‚Äù to ‚ÄúSpecify a secret.‚Äú Paste the access_token copied from the previous step into the box next to it, as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3MeA1NHXzY4wNiTAWkZnCL/bb2cc716b22d59c2a7282f9a5f3e3ad2/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="Run query as"/></p><p>Test your <em>CreateUser</em> UDF by executing this query:</p><pre><code><span>Call</span><span>(</span>
  <span>Function</span><span>(</span><span>&#39;CreateUser&#39;</span><span>)</span><span>,</span> 
  <span>{</span>
    email<span>:</span> <span>&#34;rainer.theo@mailinator.com&#34;</span><span>,</span>
    profile<span>:</span> <span>{</span>
      name<span>:</span> <span>&#34;Rainer Theo&#34;</span><span>,</span>
      country<span>:</span> <span>&#34;DE&#34;</span>
    <span>}</span>
  <span>}</span>
<span>)</span></code></pre><p>Here‚Äôs a sample response:</p><pre><code><span>{</span>
  user_id<span>:</span> <span>&#34;uf7TdWaOKyWvLahkO2oxJi0AWBdVg24K@clients&#34;</span><span>,</span>
  email<span>:</span> <span>&#34;rainer.theo@mailinator.com&#34;</span><span>,</span>
  profile<span>:</span> <span>{</span>
    name<span>:</span> <span>&#34;Rainer Theo&#34;</span><span>,</span>
    country<span>:</span> <span>&#34;DE&#34;</span>
  <span>}</span>
<span>}</span></code></pre><p>You should see a response similar to the above, confirming that the UDF is working. To be certain that it created the User, navigate to Collections, then click on User to inspect the collection. The UI allows us to preview all its documents. Notice that a new <em>User</em> document has been successfully created. This should confirm that the UDF is working.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Fh0nSnxVSR8GlWtyeApEz/b02b3ed155116ecb611576fdd3a63d6a/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="User document"/></p><h3 id="Compute-Edge">Compute@Edge</h3><p>With the UDF and Auth0 integration completed, let‚Äôs finally get down to implementing the POST /users endpoint (and take it live) with Compute@Edge.</p><p>Create a service</p><p><a href="https://manage.fastly.com/auth/sign-in" target="_blank" rel="noreferrer noopener">Sign in</a> to Fastly. Navigate to the ‚ÄúCompute‚Äú tab at the top of the screen and click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">Create a Compute service</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4AYecaU7ypmzxKA6cPb7fy/8d5dd4001c768e067c02ef1205119dbe/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastl_create_a_computer_service"/></p><p>After the screen updates, update the default name by clicking on it. Change it to something descriptive, e.g. <code>client<span>-</span>serverless<span>-</span>api</code> as we‚Äôre going to reference it again later.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/13iFGgnqNAqHQYlsgg3qqG/5a68d68f563087f52fe88fda865f42e3/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_update_service_name"/></p><p>Click on the ‚ÄúService configuration‚Äù tab. From there, use the left navigation pane and select Origins &gt; Hosts. In the empty field, add the value <code>db<span>.</span>eu<span>.</span>fauna<span>.</span>com</code> and click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">Add</a>. Doing this whitelists Fauna‚Äôs EU domain for use as a <a href="https://docs.fastly.com/en/guides/working-with-hosts" target="_blank" rel="noreferrer noopener">valid host</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/50nox3NWpt6qIlH4Y0QPH6/bacb514fd04e2a94231bfc086c650b8f/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_origins_hosts"/></p><p>After adding the host, it is given a default name that you‚Äôll now override to something more descriptive, since later on in the tutorial, you‚Äôll be referencing this value. To edit the name, first click on it to enter edit mode. Enter the new value <code>db_eu_fauna_com</code> then scroll to the bottom of the screen and click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">Update</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2HG1XeNVqPorFGi9GMquiF/b34e6d8978583fe5eced1368baccdfe8/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_edit_this_host_600"/></p><p>Get a personal API token</p><p>From the top right corner of your Fastly dashboard, click on your username to activate a dropdown menu. Choose ‚ÄúAccount‚Äù to enter the Account Settings page. Use the left navigator panel and select Personal API Tokens. Click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">Create Token</a> and configure these settings:</p><ul><li>Provide a name, e.g. client-serverless-api.</li><li>Service Access = A specific service. From the dropdown, select the service you created earlier.</li><li>Scope = Global API access</li><li>Expiration = Never expire</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1fbUjmjFCs49bIn5rPDj8Q/d64b164b5ea0855949f2e7cfdf622712/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="Create a token"/></p><ul><li>Click <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">Create Token</a>. On the next screen, copy the generated value and save it somewhere safe for future reference. You won‚Äôt be able to access this value again.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3tFfrX2VMZDlLX2buefrIR/68e023aa2ff167c043335235ec1c5968/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_personal_api_token400"/></p><p>Use the Fastly CLI and edit the service handlers</p><p>Install the <a href="https://github.com/fastly/cli" target="_blank" rel="noreferrer noopener">Fastly CLI</a>. Create a project directory and <code>cd</code> into it. Run <code>fastly compute init</code> and follow the prompts to create a project.</p><ul><li>When prompted for Language, choose Javascript.</li><li>When prompted for Starter kit, select the Default.Open up your favorite IDE to the project that was cloned into the directory. Within the project, create a file <code>utils<span>.</span>js</code> in the <code><span>/</span>src</code> folder with the following content:</li></ul><pre><code><span>/* 
 * Fauna embeds its own error ‚Äúcodes‚Äù (actually string text) in the response body. 
 * This function parses out the error codes and translate it back to HTTP error codes.
 */</span>
<span>export</span> <span>function</span> <span>getFaunaError</span><span>(</span><span>response</span><span>)</span> <span>{</span>
  <span>try</span> <span>{</span>
    <span>const</span> errors <span>=</span> response<span>.</span>errors<span>[</span><span>0</span><span>]</span>
    <span>let</span> <span>{</span> code<span>,</span> description<span>,</span> cause <span>}</span> <span>=</span> errors<span>;</span>
    <span>let</span> status<span>;</span>

    <span>try</span> <span>{</span>
      <span>// report on the inner errors if they exist</span>
      code <span>=</span> cause<span>[</span><span>0</span><span>]</span><span>.</span>code<span>;</span>
      description <span>=</span> cause<span>[</span><span>0</span><span>]</span><span>.</span>description<span>;</span>
      <span>if</span> <span>(</span>code <span>==</span> <span>&#39;transaction aborted&#39;</span><span>)</span> <span>{</span>
        <span>// Inside UDFs use &#39;transaction aborted&#39; status to bubble up the actual error code in the description.</span>
        code <span>=</span> description<span>;</span>
      <span>}</span>
    <span>}</span> <span>catch</span> <span>{</span>
      <span>// no error causes</span>
    <span>}</span>

    <span>switch</span> <span>(</span>code<span>)</span> <span>{</span>
      <span>case</span> <span>&#39;instance not found&#39;</span><span>:</span>
        status <span>=</span> <span>404</span><span>;</span>
        <span>break</span><span>;</span>
      <span>case</span> <span>&#39;instance not unique&#39;</span><span>:</span>
        status <span>=</span> <span>409</span><span>;</span>
        <span>break</span><span>;</span>
      <span>case</span> <span>&#39;permission denied&#39;</span><span>:</span>
        status <span>=</span> <span>403</span><span>;</span>
        <span>break</span><span>;</span>
      <span>case</span> <span>&#39;unauthorized&#39;</span><span>:</span>
      <span>case</span> <span>&#39;authentication failed&#39;</span><span>:</span>
        status <span>=</span> <span>401</span><span>;</span>
        <span>break</span><span>;</span>
      <span>default</span><span>:</span>
        status <span>=</span> <span>500</span><span>;</span>
    <span>}</span>
    <span>return</span> <span>{</span> code<span>,</span> description<span>,</span> status <span>}</span><span>;</span>
  <span>}</span> <span>catch</span> <span>{</span>
    <span>// no errors in response</span>
    <span>return</span> <span>false</span><span>;</span>
  <span>}</span>
<span>}</span>

<span>/*
 * Doesn‚Äôt do much for now. We&#39;ll come back here later when we
 * utilize Geo-IP at the edge functionality 
 */</span>
<span>export</span> <span>function</span> <span>resolveBackend</span><span>(</span><span>request</span><span>)</span> <span>{</span>
  <span>try</span> <span>{</span>
    <span>const</span> bearerToken <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>&#39;Authorization&#39;</span><span>)</span><span>.</span><span>split</span><span>(</span><span>&#39;Bearer &#39;</span><span>)</span><span>[</span><span>1</span><span>]</span><span>;</span>

    <span>let</span> backend <span>=</span> <span>&#39;db_eu_fauna_com&#39;</span><span>;</span>
    <span>let</span> backendUrl <span>=</span> <span>&#39;https://db.eu.fauna.com&#39;</span><span>;</span>

    <span>return</span> <span>{</span> backend<span>,</span> backendUrl<span>,</span> bearerToken <span>}</span><span>;</span>
  <span>}</span> <span>catch</span> <span>(</span>e<span>)</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span><span>`</span><span><span>${</span>e<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
    <span>throw</span> e<span>;</span>
  <span>}</span>
<span>}</span>

<span>/*
 * Fauna‚Äôs UDF needs to distinguish arguments between scalar and object types.
 * Objects must be wrapped with &#34;object&#34;.
 * Example: a UDF input argument of type object:
 * {
 *   foo: { 
 *     bar: {
 *        key: &#39;value&#39;
 *     }
 *   }
 * }
 * ...must be formatted for REST call:
 * object: {
 *   foo: {
 *     object: {
 *       bar: {
 *         object: {
 *           key: &#39;value&#39;
 *         }
 *       }
 *     }
 *   }
 * }
 */</span>
<span>export</span> <span>function</span> <span>wrapWithObject</span><span>(</span><span>obj</span><span>)</span> <span>{</span>
  <span>let</span> result <span>=</span> <span>{</span><span>}</span><span>;</span>
  <span>for</span> <span>(</span><span>const</span> <span>[</span>key<span>,</span> value<span>]</span> <span>of</span> Object<span>.</span><span>entries</span><span>(</span>obj<span>)</span><span>)</span> <span>{</span>
    <span>if</span> <span>(</span><span>typeof</span> value <span>===</span> <span>&#39;object&#39;</span><span>)</span> <span>{</span>
      result<span>[</span>key<span>]</span> <span>=</span> <span>{</span>
        object<span>:</span> <span>wrapWithObject</span><span>(</span>value<span>)</span>
      <span>}</span>
    <span>}</span> <span>else</span> <span>{</span>
      result<span>[</span>key<span>]</span> <span>=</span> value<span>;</span>
    <span>}</span>
  <span>}</span>
  <span>return</span> result<span>;</span>
<span>}</span>

<span>/* 
 * Translates Call(Function(&#39;name&#39;)) to REST
 */</span>
<span>export</span> <span>function</span> <span>formatFaunaCallFunction</span><span>(</span><span>functionName<span>,</span> id<span>,</span> requestBody</span><span>)</span> <span>{</span>
  <span>let</span> payload <span>=</span> <span>{</span>
    call<span>:</span> <span>{</span> <span>function</span><span>:</span> functionName <span>}</span><span>,</span>
    arguments<span>:</span> <span>[</span><span>]</span>
  <span>}</span><span>;</span>
  <span>if</span> <span>(</span>id<span>)</span> <span>{</span>
    payload<span>.</span>arguments<span>.</span><span>push</span><span>(</span>id<span>)</span><span>;</span>
  <span>}</span>
  <span>if</span> <span>(</span>requestBody<span>)</span> <span>{</span>
    payload<span>.</span>arguments<span>.</span><span>push</span><span>(</span><span>{</span> object<span>:</span> <span>wrapWithObject</span><span>(</span>requestBody<span>)</span> <span>}</span><span>)</span><span>;</span>
  <span>}</span>
  <span>return</span> payload<span>;</span>
<span>}</span>

<span>export</span> <span>function</span> <span>badRequest</span><span>(</span><span>)</span> <span>{</span>
  <span>return</span> <span>new</span> <span>Response</span><span>(</span><span>&#39;Bad request&#39;</span><span>,</span> <span>{</span> 
    headers<span>:</span> <span>{</span> <span>&#34;access-control-allow-origin&#34;</span><span>:</span> <span>&#34;*&#34;</span> <span>}</span><span>,</span>
    status<span>:</span> <span>400</span> 
  <span>}</span><span>)</span><span>;</span>
<span>}</span>
`</code></pre><p>Then overwrite the file <code><span>/</span>src<span>/</span>index<span>.</span>js</code> with these contents. Here‚Äôs where everything comes together.</p><pre><code><span>import</span> <span>{</span>
  badRequest<span>,</span> getFaunaError<span>,</span>
  resolveBackend<span>,</span> formatFaunaCallFunction
<span>}</span> <span>from</span> <span>&#39;./utils.js&#39;</span><span>;</span>

<span>addEventListener</span><span>(</span><span>&#39;fetch&#39;</span><span>,</span> <span>event</span> <span>=&gt;</span> event<span>.</span><span>respondWith</span><span>(</span><span>handleRequest</span><span>(</span>event<span>)</span><span>)</span><span>)</span><span>;</span>

<span>async</span> <span>function</span> <span>handleRequest</span><span>(</span><span>event</span><span>)</span> <span>{</span>
  <span>const</span> req <span>=</span> event<span>.</span>request<span>;</span>

  <span>const</span> <span>VALID_METHODS</span> <span>=</span> <span>[</span><span>&#34;GET&#34;</span><span>,</span> <span>&#34;POST&#34;</span><span>,</span> <span>&#34;PUT&#34;</span><span>]</span><span>;</span>
  <span>if</span> <span>(</span><span>!</span><span>VALID_METHODS</span><span>.</span><span>includes</span><span>(</span>req<span>.</span>method<span>)</span><span>)</span> <span>{</span>
    <span>const</span> response <span>=</span> <span>new</span> <span>Response</span><span>(</span><span>&#34;This method is not allowed&#34;</span><span>,</span> <span>{</span>
      status<span>:</span> <span>405</span>
    <span>}</span><span>)</span><span>;</span>
    <span>return</span> response<span>;</span>
  <span>}</span>

  <span>const</span> method <span>=</span> req<span>.</span>method<span>;</span>
  <span>const</span> url <span>=</span> <span>new</span> <span>URL</span><span>(</span>event<span>.</span>request<span>.</span>url<span>)</span><span>;</span>
  <span>const</span> pathname <span>=</span> url<span>.</span>pathname<span>;</span>

  <span>// POST /users</span>
  <span>if</span> <span>(</span>method <span>==</span> <span>&#34;POST&#34;</span> <span>&amp;&amp;</span> pathname <span>==</span> <span>&#34;/users&#34;</span><span>)</span> <span>{</span>
    <span>try</span> <span>{</span>
      <span>const</span> reqBody <span>=</span> <span>await</span> req<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>
      <span>if</span> <span>(</span><span>!</span>reqBody<span>.</span>email<span>)</span> <span>{</span>
        <span>return</span> <span>new</span> <span>Response</span><span>(</span><span>&#39;Email is required&#39;</span><span>,</span> <span>{</span> status<span>:</span> <span>400</span> <span>}</span><span>)</span><span>;</span>
      <span>}</span>      
      <span>return</span> <span>await</span> <span>callUDF</span><span>(</span>req<span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>return</span> <span>formatFaunaCallFunction</span><span>(</span><span>&#39;CreateUser&#39;</span><span>,</span> <span>null</span><span>,</span> reqBody<span>)</span><span>;</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span> <span>catch</span> <span>{</span>
      <span>return</span> <span>badRequest</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>

  <span>return</span> <span>new</span> <span>Response</span><span>(</span><span>&#34;The page you requested could not be found&#34;</span><span>,</span> <span>{</span>
    status<span>:</span> <span>404</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>async</span> <span>function</span> <span>callUDF</span><span>(</span><span>request<span>,</span> formatHandler</span><span>)</span> <span>{</span>
  <span>try</span> <span>{</span>
    <span>const</span> <span>{</span> backend<span>,</span> backendUrl<span>,</span> bearerToken <span>}</span> <span>=</span> <span>resolveBackend</span><span>(</span>request<span>)</span><span>;</span>

    <span>// formatHandler translates REST request into FQL &#34;Call(Function(&#39;name&#39;))&#34; equivalent</span>
    <span>const</span> body <span>=</span> <span>formatHandler</span><span>(</span><span>)</span><span>;</span>

    <span>const</span> headers <span>=</span> <span>new</span> <span>Headers</span><span>(</span><span>{</span>
      <span>&#34;Authorization&#34;</span><span>:</span> <span><span>`</span><span>Bearer </span><span><span>${</span>bearerToken<span>}</span></span><span>`</span></span><span>,</span>
      <span>&#34;Content-Type&#34;</span><span>:</span> <span>&#34;application/json&#34;</span>
    <span>}</span><span>)</span><span>;</span>

    <span>const</span> faunaRest <span>=</span> <span>new</span> <span>Request</span><span>(</span>backendUrl<span>,</span> <span>{</span>
      method<span>:</span> <span>&#34;POST&#34;</span><span>,</span>
      headers<span>:</span> headers<span>,</span>
      body<span>:</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span>body<span>)</span>
    <span>}</span><span>)</span><span>;</span>

    <span>const</span> res <span>=</span> <span>await</span> <span>fetch</span><span>(</span>faunaRest<span>,</span> <span>{</span> backend<span>:</span> backend <span>}</span><span>)</span><span>;</span>

    <span>let</span> response <span>=</span> <span>await</span> res<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>

    <span>// If FQL throws an error, return error</span>
    <span>const</span> faunaErrors <span>=</span> <span>getFaunaError</span><span>(</span>response<span>)</span><span>;</span>
    <span>if</span> <span>(</span>faunaErrors<span>)</span> <span>{</span>
      <span>return</span> <span>new</span> <span>Response</span><span>(</span>
        faunaErrors<span>.</span>description<span>,</span> <span>{</span>
        headers<span>:</span> <span>{</span> 
          <span>&#34;content-type&#34;</span><span>:</span> <span>&#34;application/json;charset=UTF-8&#34;</span><span>,</span>
          <span>&#34;Access-Control-Allow-Origin&#34;</span><span>:</span> <span>&#34;*&#34;</span>
        <span>}</span><span>,</span>          
        status<span>:</span> faunaErrors<span>.</span>status
      <span>}</span><span>)</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>return</span> <span>new</span> <span>Response</span><span>(</span>
        <span>JSON</span><span>.</span><span>stringify</span><span>(</span>response<span>.</span>resource<span>)</span><span>,</span> <span>{</span>
        headers<span>:</span> <span>{</span> 
          <span>&#34;content-type&#34;</span><span>:</span> <span>&#34;application/json;charset=UTF-8&#34;</span><span>,</span>
          <span>&#34;Access-Control-Allow-Origin&#34;</span><span>:</span> <span>&#34;*&#34;</span>
        <span>}</span><span>,</span>
        status<span>:</span> <span>200</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span> <span>catch</span> <span>(</span>e<span>)</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span><span>`</span><span><span>${</span>e<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
    <span>return</span> <span>new</span> <span>Response</span><span>(</span><span><span>`</span><span><span>${</span>e<span>}</span></span><span>`</span></span><span>,</span> <span>{</span> status<span>:</span> <span>500</span> <span>}</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Deploy the service</p><p>Set the environment variable <code><span>FASTLY_API_TOKEN</span></code> to the Personal API Token obtained previously.</p><pre><code><span>export</span> <span>FASTLY_API_TOKEN</span><span>=</span><span>&lt;&lt;</span>token<span>&gt;&gt;</span></code></pre><p>In your Fastly dashboard, locate the service ID (see the screenshot below for reference) then update the <code>fastly<span>.</span>toml</code> file and set the <code>service_id</code> to this value.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4kHgqigPwVeJW8kJfNIauq/33cba121f1bd37ecaa6b71993b80de51/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_ServiceId"/></p><p>Build the project:</p><pre><code>fastly compute build</code></pre><p>Then deploy the service with this command:</p><pre><code>fastly compute deploy</code></pre><ul><li>When prompted to provide a domain, click Enter to accept the generated value. Wait a few seconds for the service to deploy. You should see the progress on the terminal. Once deployed (give it about 30 seconds to fully propagate), test out the live API.</li></ul><h3 id="Test-your-API">Test your API</h3><p>Back at your Fauna dashboard, from the left navigator pane, select Collections then click User. Next to the user record you created earlier, there should be a delete icon. Go ahead and delete that user. We‚Äôll need to do this because <code>user_id</code> is unique, and we‚Äôre about to test with the same access_token.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4ApQek9WQ0AK1aBA4n7567/2b7eea338aef626d558d477615b19582/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="Delete user"/></p><p>Call the live API with your tool of choice, e.g. Postman, or curl:</p><pre><code>curl <span>--</span>location <span>--</span>request <span>POST</span> <span>&#39;https://frequently-faithful-mouse.edgecompute.app/users&#39;</span> \
<span>--</span>header <span>&#39;Authorization: Bearer eyJhbGciOiJ...&#39;</span> \
<span>--</span>header <span>&#39;Content-Type: application/json&#39;</span> \
<span>--</span>data<span>-</span>raw &#39;<span>{</span>
    <span>&#34;email&#34;</span><span>:</span> <span>&#34;rainer.theo@mailinator.com&#34;</span><span>,</span>
    <span>&#34;profile&#34;</span><span>:</span> <span>{</span>
        <span>&#34;name&#34;</span><span>:</span> <span>&#34;Rainer Theo&#34;</span><span>,</span>
        <span>&#34;city&#34;</span><span>:</span> <span>&#34;Frankfurt&#34;</span><span>,</span>
        <span>&#34;country&#34;</span><span>:</span> <span>&#34;DE&#34;</span>
    <span>}</span>
<span>}</span>&#39;</code></pre><p>If the request goes through, check the response to see if it matches our spec. Then check the Fauna dashboard to see if the Users document was created successfully.</p><p>If everything checks out we‚Äôre ready to move on to the next API. So let‚Äôs spec out <code><span>GET</span> <span>/</span>users</code> and <code><span>PUT</span> <span>/</span>users</code>:</p><p>GET /users/{id}</p><p><em>Parameters:</em></p><ul><li><code><span>{</span>id<span>}</span></code> (Required)
<ul><li>Must match the ‚Äúuser<em>id‚Äù embedded in the access</em>token‚Äôs <code>sub</code> claim (<em>users can read themselves</em>).</li></ul></li></ul><p><em>Headers:</em></p><ul><li>Authorization Bearer {{token}}</li></ul><p><em>Request Example:</em></p><pre><code>curl <span>-</span><span>H</span> <span>&#34;Authorization: Bearer eyJhb...&#34;</span> \

https<span>:</span><span>/</span><span>/</span>frequently<span>-</span>faithful<span>-</span>mouse<span>.</span>edgecompute<span>.</span>app<span>/</span>users<span>/</span>auth0<span>%</span><span>7</span>C57a9160561254be4229bca97</code></pre><p><em>Response example:</em></p><pre><code><span>{</span>
  <span>&#34;user_id&#34;</span><span>:</span> <span>&#34;auth0|57a9160561254be4229bca97&#34;</span><span>,</span>
  <span>&#34;email&#34;</span><span>:</span> <span>&#34;rainer.theo@mailinator.com&#34;</span>
  <span>&#34;profile&#34;</span><span>:</span> <span>{</span>
    <span>&#34;name&#34;</span><span>:</span> <span>&#34;Rainer Theo&#34;</span><span>,</span>
    <span>&#34;country&#34;</span><span>:</span> <span>&#34;DE&#34;</span><span>,</span>
    <span>&#34;age&#34;</span><span>:</span> <span>&#34;23&#34;</span>
  <span>}</span> 
<span>}</span></code></pre><p>PUT /users/{id}</p><p><em>Parameters:</em></p><ul><li><code><span>{</span>id<span>}</span></code> (Required). Must match the ‚Äúuser_id‚Äù embedded in the access<em>token‚Äôs <code>sub</code>claim (</em>users can update only themselves_).</li><li>JSON body of our User schema.</li></ul><p><em>Headers:</em></p><ul><li>Authorization Bearer {{token}}</li></ul><p><em>Request Example:</em></p><pre><code>curl <span>-</span><span>X</span> <span>PUT</span>  <span>-</span><span>H</span> <span>&#34;Content-Type: application/json&#34;</span> \
     <span>-</span><span>H</span> <span>&#34;Authorization: Bearer eyJhb...&#34;</span>  \
     <span>-</span>d <span>&#39;{&#34;email&#34;:&#34;rainer.theo@mailinator.com&#34;, &#34;profile&#34;: { &#34;name&#34;: &#34;Rainer Theo&#34;, &#34;country&#34;: &#34;DE&#34;, &#34;age&#34;: 30 } }&#39;</span> \
     https<span>:</span><span>/</span><span>/</span>frequently<span>-</span>faithful<span>-</span>mouse<span>.</span>edgecompute<span>.</span>app<span>/</span>users<span>/</span>auth0<span>%</span><span>7</span>C57a9160561254be4229bca97</code></pre><p><em>Response example:</em></p><pre><code><span>{</span>
  <span>&#34;user_id&#34;</span><span>:</span> <span>&#34;auth0|57a9160561254be4229bca97&#34;</span><span>,</span>
  <span>&#34;email&#34;</span><span>:</span> <span>&#34;rainer.theo@mailinator.com&#34;</span>
  <span>&#34;profile&#34;</span><span>:</span> <span>{</span>
    <span>&#34;name&#34;</span><span>:</span> <span>&#34;Rainer Theo&#34;</span><span>,</span>
    <span>&#34;country&#34;</span><span>:</span> <span>&#34;DE&#34;</span><span>,</span>
    <span>&#34;age&#34;</span><span>:</span> <span>30</span>
  <span>}</span> 
<span>}</span></code></pre><p>Back in your Fauna dashboard. Navigate to the shell and change the run <a href="https://fauna.com/blog/how-to-build-an-edge-api-gateway-with-fastlys-compute-edge-and-fauna" target="_blank" rel="noreferrer noopener">RUN QUERY AS</a> back to Admin so that you can define these next UDFs.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6PejHiffD32IAbvTThCiew/a8d3259ae42796ccd102d187abde46ab/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="fastly_run_as_admin45h"/></p><p>Now define the <em>GetUser UDF</em>:</p><pre><code><span>CreateFunction</span><span>(</span><span>{</span>
  name<span>:</span> <span>&#39;GetUser&#39;</span><span>,</span>
  body<span>:</span> <span>Query</span><span>(</span>
    <span>Lambda</span><span>(</span>
      <span>[</span><span>&#34;ID&#34;</span><span>]</span><span>,</span>
      <span>Let</span><span>(</span>
        <span>{</span> user<span>:</span> <span>Select</span><span>(</span><span>[</span><span>&#34;data&#34;</span><span>]</span><span>,</span> <span>Get</span><span>(</span><span>Match</span><span>(</span><span>Index</span><span>(</span><span>&#34;user_by_id&#34;</span><span>)</span><span>,</span> <span>Var</span><span>(</span><span>&#34;ID&#34;</span><span>)</span><span>)</span><span>)</span><span>)</span> <span>}</span><span>,</span>
        <span>Do</span><span>(</span>
          <span>If</span><span>(</span>
            <span>Equals</span><span>(</span><span>CurrentIdentity</span><span>(</span><span>)</span><span>,</span> <span>Select</span><span>(</span><span>[</span><span>&#34;user_id&#34;</span><span>]</span><span>,</span> <span>Var</span><span>(</span><span>&#34;user&#34;</span><span>)</span><span>)</span><span>)</span><span>,</span>
            <span>true</span><span>,</span>
            <span>Abort</span><span>(</span><span>&#34;permission denied&#34;</span><span>)</span>
          <span>)</span><span>,</span>
          <span>Var</span><span>(</span><span>&#34;user&#34;</span><span>)</span>
        <span>)</span>
      <span>)</span>
    <span>)</span>
  <span>)</span><span>,</span>
  role<span>:</span> <span>Role</span><span>(</span><span>&#34;usersCRUD&#34;</span><span>)</span>
<span>}</span><span>)</span></code></pre><ul><li>Per our API spec, user‚Äôs <code>user_id</code> must match the <code>sub</code> claim. So we test it with <code><span>If</span><span>(</span><span>Equals</span><span>(</span><span>...</span><span>)</span><span>...</span><span>)</span></code> and <code><span>Abort</span><span>(</span><span>)</span></code> if <code><span>false</span></code>.</li></ul><p>And do the same for <em>UpdateUser</em>:</p><pre><code><span>CreateFunction</span><span>(</span><span>{</span>
  name<span>:</span> <span>&#39;UpdateUser&#39;</span><span>,</span>
  body<span>:</span> <span>Query</span><span>(</span>
    <span>Lambda</span><span>(</span>
      <span>[</span><span>&#34;ID&#34;</span><span>,</span> <span>&#34;data&#34;</span><span>]</span><span>,</span>
      <span>Let</span><span>(</span>
        <span>{</span>
          match<span>:</span> <span>Match</span><span>(</span><span>Index</span><span>(</span><span>&#34;user_by_id&#34;</span><span>)</span><span>,</span> <span>Var</span><span>(</span><span>&#34;ID&#34;</span><span>)</span><span>)</span><span>,</span>
          user<span>:</span> <span>Get</span><span>(</span><span>Var</span><span>(</span><span>&#34;match&#34;</span><span>)</span><span>)</span>
        <span>}</span><span>,</span>
        <span>Do</span><span>(</span>
          <span>If</span><span>(</span>
            <span>Equals</span><span>(</span><span>CurrentIdentity</span><span>(</span><span>)</span><span>,</span> <span>Select</span><span>(</span><span>[</span><span>&#34;data&#34;</span><span>,</span> <span>&#34;user_id&#34;</span><span>]</span><span>,</span> <span>Var</span><span>(</span><span>&#34;user&#34;</span><span>)</span><span>)</span><span>)</span><span>,</span>
            <span>true</span><span>,</span>
            <span>Abort</span><span>(</span><span>&#34;permission denied&#34;</span><span>)</span>
          <span>)</span><span>,</span>
          <span>Let</span><span>(</span>
            <span>{</span>
              ref<span>:</span> <span>Select</span><span>(</span><span>[</span><span>&#34;ref&#34;</span><span>]</span><span>,</span> <span>Var</span><span>(</span><span>&#34;user&#34;</span><span>)</span><span>,</span> <span>null</span><span>)</span><span>,</span>
              email<span>:</span> <span>Select</span><span>(</span>
                <span>[</span><span>&#34;email&#34;</span><span>]</span><span>,</span>
                <span>Var</span><span>(</span><span>&#34;data&#34;</span><span>)</span><span>,</span>
                <span>Select</span><span>(</span><span>[</span><span>&#34;data&#34;</span><span>,</span> <span>&#34;email&#34;</span><span>]</span><span>,</span> <span>Var</span><span>(</span><span>&#34;user&#34;</span><span>)</span><span>,</span> <span>null</span><span>)</span>
              <span>)</span><span>,</span>
              profile<span>:</span> <span>Select</span><span>(</span>
                <span>[</span><span>&#34;profile&#34;</span><span>]</span><span>,</span>
                <span>Var</span><span>(</span><span>&#34;data&#34;</span><span>)</span><span>,</span>
                <span>Select</span><span>(</span><span>[</span><span>&#34;data&#34;</span><span>,</span> <span>&#34;profile&#34;</span><span>]</span><span>,</span> <span>Var</span><span>(</span><span>&#34;user&#34;</span><span>)</span><span>,</span> <span>null</span><span>)</span>
              <span>)</span><span>,</span>
              updateData<span>:</span> <span>Merge</span><span>(</span>
                <span>{</span> email<span>:</span> <span>Var</span><span>(</span><span>&#34;email&#34;</span><span>)</span> <span>}</span><span>,</span>
                <span>{</span> profile<span>:</span> <span>Var</span><span>(</span><span>&#34;profile&#34;</span><span>)</span> <span>}</span>
              <span>)</span>
            <span>}</span><span>,</span>
            <span>Update</span><span>(</span><span>Var</span><span>(</span><span>&#34;ref&#34;</span><span>)</span><span>,</span> <span>{</span> data<span>:</span> <span>Var</span><span>(</span><span>&#34;updateData&#34;</span><span>)</span> <span>}</span><span>)</span>
          <span>)</span><span>,</span>
          <span>Select</span><span>(</span><span>[</span><span>&#34;data&#34;</span><span>]</span><span>,</span> <span>Get</span><span>(</span><span>Var</span><span>(</span><span>&#34;match&#34;</span><span>)</span><span>)</span><span>)</span>
        <span>)</span>
      <span>)</span>
    <span>)</span>
  <span>)</span><span>,</span>
  role<span>:</span> <span>Role</span><span>(</span><span>&#34;usersCRUD&#34;</span><span>)</span>
<span>}</span><span>)</span></code></pre><ul><li>Similar to <em>GetUser</em>, the UDF allows updates only if the JWT <code>sub</code> is the same as the User being updated.</li><li>To enforce our REST APIs Users schema, any field other than <code>email</code> or <code>profile</code> will be ignored if present in the request body. So we use <code><span>Merge</span><span>(</span><span>{</span> email<span>:</span> <span>...</span><span>}</span><span>,</span> <span>{</span> profile<span>:</span> <span>...</span><span>}</span><span>)</span></code> to do this.</li></ul><p>Finally, update the <em>APIsRole</em> role so that it can execute the 2 new UDFs above:</p><pre><code><span>Update</span><span>(</span><span>Role</span><span>(</span><span>&#39;APIsRole&#39;</span><span>)</span><span>,</span>
  <span>{</span>
    privileges<span>:</span> <span>[</span>
      <span>{</span> resource<span>:</span> <span>Function</span><span>(</span><span>&#34;CreateUser&#34;</span><span>)</span><span>,</span> actions<span>:</span> <span>{</span> call<span>:</span> <span>true</span> <span>}</span> <span>}</span><span>,</span>
      <span>{</span> resource<span>:</span> <span>Function</span><span>(</span><span>&#34;GetUser&#34;</span><span>)</span><span>,</span> actions<span>:</span> <span>{</span> call<span>:</span> <span>true</span> <span>}</span> <span>}</span><span>,</span>
      <span>{</span> resource<span>:</span> <span>Function</span><span>(</span><span>&#34;UpdateUser&#34;</span><span>)</span><span>,</span> actions<span>:</span> <span>{</span> call<span>:</span> <span>true</span> <span>}</span> <span>}</span>
    <span>]</span>
  <span>}</span>
<span>)</span></code></pre><p>As you‚Äôve already realized, these UDFs got pretty elaborate as Fauna lets us do everything we need including validating the JWT for embedded permissions and formatting our specific API responses. This allowed us to stick to our goal of pushing the bulk of logic down to Fauna while keeping the implementation at the edge pretty lightweight.</p><p>Now we‚Äôll just have to update <code><span>/</span>src<span>/</span>index<span>.</span>js</code> to handle <code><span>GET</span></code> and <code><span>PUT</span></code> by calling the 2 new UDFs. While we‚Äôre at it, let&#39;s also finish the whole implementation by also handling <code><span>GET</span> <span>/</span></code>, which should return our Single Page Application (SPA). With this, our service is serving both REST APIs and the SPA.</p><pre><code><span>import</span> <span>{</span>
  badRequest<span>,</span> getFaunaError<span>,</span>
  resolveBackend<span>,</span> formatFaunaCallFunction
<span>}</span> <span>from</span> <span>&#39;./utils.js&#39;</span><span>;</span>

<span>addEventListener</span><span>(</span><span>&#39;fetch&#39;</span><span>,</span> <span>event</span> <span>=&gt;</span> event<span>.</span><span>respondWith</span><span>(</span><span>handleRequest</span><span>(</span>event<span>)</span><span>)</span><span>)</span><span>;</span>

<span>async</span> <span>function</span> <span>handleRequest</span><span>(</span><span>event</span><span>)</span> <span>{</span>
  <span>const</span> req <span>=</span> event<span>.</span>request<span>;</span>

  <span>// Allows the edge to respond to CORS</span>
  <span>if</span> <span>(</span>req<span>.</span>method <span>===</span> <span>&#34;OPTIONS&#34;</span> <span>&amp;&amp;</span> req<span>.</span>headers<span>.</span><span>has</span><span>(</span><span>&#34;Origin&#34;</span><span>)</span> <span>&amp;&amp;</span> <span>(</span>
    req<span>.</span>headers<span>.</span><span>has</span><span>(</span><span>&#34;access-control-request-headers&#34;</span><span>)</span> <span>||</span>
    req<span>.</span>headers<span>.</span><span>has</span><span>(</span><span>&#34;access-control-request-method&#34;</span><span>)</span><span>)</span>
  <span>)</span> <span>{</span>
    <span>return</span> <span>new</span> <span>Response</span><span>(</span><span>null</span><span>,</span> <span>{</span>
      status<span>:</span> <span>204</span><span>,</span>
      headers<span>:</span> <span>{</span>
        <span>&#34;access-control-allow-origin&#34;</span><span>:</span> <span>&#34;*&#34;</span><span>,</span>
        <span>&#34;access-control-allow-methods&#34;</span><span>:</span> <span>&#34;GET,HEAD,POST,PUT,OPTIONS&#34;</span><span>,</span>
        <span>&#34;access-control-allow-headers&#34;</span><span>:</span> req<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>&#39;access-control-request-headers&#39;</span><span>)</span> <span>||</span> <span>&#39;&#39;</span><span>,</span>
        <span>&#34;access-control-max-age&#34;</span><span>:</span> <span>86400</span><span>,</span>
      <span>}</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>const</span> <span>VALID_METHODS</span> <span>=</span> <span>[</span><span>&#34;GET&#34;</span><span>,</span> <span>&#34;POST&#34;</span><span>,</span> <span>&#34;PUT&#34;</span><span>]</span><span>;</span>
  <span>if</span> <span>(</span><span>!</span><span>VALID_METHODS</span><span>.</span><span>includes</span><span>(</span>req<span>.</span>method<span>)</span><span>)</span> <span>{</span>
    <span>const</span> response <span>=</span> <span>new</span> <span>Response</span><span>(</span><span>&#34;This method is not allowed&#34;</span><span>,</span> <span>{</span>
      status<span>:</span> <span>405</span>
    <span>}</span><span>)</span><span>;</span>
    <span>return</span> response<span>;</span>
  <span>}</span>

  <span>const</span> method <span>=</span> req<span>.</span>method<span>;</span>
  <span>const</span> url <span>=</span> <span>new</span> <span>URL</span><span>(</span>event<span>.</span>request<span>.</span>url<span>)</span><span>;</span>
  <span>const</span> pathname <span>=</span> url<span>.</span>pathname<span>;</span>

  <span>// GET &#34;/&#34;, &#34;/js&#34;, &#34;/css&#34;, &#34;/favicon.ico&#34; returns static contents from Object store bucket</span>
  <span>if</span> <span>(</span>method <span>==</span> <span>&#34;GET&#34;</span> <span>&amp;&amp;</span>
    <span>[</span><span>&#34;&#34;</span><span>,</span> <span>&#34;js&#34;</span><span>,</span> <span>&#34;css&#34;</span><span>,</span> <span>&#34;favicon.ico&#34;</span><span>]</span><span>.</span><span>includes</span><span>(</span>pathname<span>.</span><span>split</span><span>(</span><span>&#34;/&#34;</span><span>)</span><span>[</span><span>1</span><span>]</span><span>)</span><span>)</span> <span>{</span>

    <span>// Below is an example. Update and point to your own bucket </span>
    <span>const</span> <span>SPA_HOST</span> <span>=</span> <span>&#39;example-bucket.s3-website-us-west-2.amazonaws.com&#39;</span><span>;</span>
    <span>const</span> <span>SPA_BACKEND</span> <span>=</span> <span>&#39;s3staticwebsite&#39;</span><span>;</span>

    <span>const</span> s3StaticWebsite <span>=</span> <span>new</span> <span>Request</span><span>(</span><span><span>`</span><span>http://</span><span><span>${</span><span>SPA_HOST</span><span>}</span></span><span><span>${</span>pathname<span>}</span></span><span>`</span></span><span>,</span> <span>{</span>
      method<span>:</span> <span>&#34;GET&#34;</span>
    <span>}</span><span>)</span><span>;</span>

    <span>const</span> s3res <span>=</span> <span>await</span> <span>fetch</span><span>(</span>s3StaticWebsite<span>,</span> <span>{</span> backend<span>:</span> <span>SPA_BACKEND</span> <span>}</span><span>)</span><span>;</span>

    <span>let</span> headers <span>=</span> <span>new</span> <span>Headers</span><span>(</span><span>)</span><span>;</span>
    <span>const</span> resource <span>=</span> pathname<span>.</span><span>split</span><span>(</span><span>&#34;/&#34;</span><span>)</span><span>[</span><span>1</span><span>]</span><span>;</span>
    <span>if</span> <span>(</span>resource <span>==</span> <span>&#39;js&#39;</span><span>)</span>
      headers<span>.</span><span>set</span><span>(</span><span>&#39;Content-Type&#39;</span><span>,</span> <span>&#39;application/javascript&#39;</span><span>)</span><span>;</span>
    <span>else</span> <span>if</span> <span>(</span>resource <span>==</span> <span>&#39;css&#39;</span><span>)</span>
      headers<span>.</span><span>set</span><span>(</span><span>&#39;Content-Type&#39;</span><span>,</span> <span>&#39;text/css; charset=utf-8&#39;</span><span>)</span><span>;</span>
    <span>else</span> <span>if</span> <span>(</span>resource <span>==</span> <span>&#39;favicon.ico&#39;</span><span>)</span>
      headers<span>.</span><span>set</span><span>(</span><span>&#39;Content-Type&#39;</span><span>,</span> <span>&#39;image/x-icon&#39;</span><span>)</span><span>;</span>
    <span>else</span>
      headers<span>.</span><span>set</span><span>(</span><span>&#39;Content-Type&#39;</span><span>,</span> <span>&#39;text/html; charset=utf-8&#39;</span><span>)</span><span>;</span>

    <span>return</span> <span>new</span> <span>Response</span><span>(</span><span>await</span> s3res<span>.</span><span>text</span><span>(</span><span>)</span><span>,</span> <span>{</span>
      status<span>:</span> <span>200</span><span>,</span>
      headers
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>// POST /users</span>
  <span>if</span> <span>(</span>method <span>==</span> <span>&#34;POST&#34;</span> <span>&amp;&amp;</span> pathname <span>==</span> <span>&#34;/users&#34;</span><span>)</span> <span>{</span>
    <span>try</span> <span>{</span>
      <span>const</span> reqBody <span>=</span> <span>await</span> req<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>
      <span>return</span> <span>await</span> <span>callUDF</span><span>(</span>req<span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>return</span> <span>formatFaunaCallFunction</span><span>(</span><span>&#39;CreateUser&#39;</span><span>,</span> <span>null</span><span>,</span> reqBody<span>)</span><span>;</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span> <span>catch</span> <span>{</span>
      <span>return</span> <span>badRequest</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>

  <span>if</span> <span>(</span>pathname<span>.</span><span>match</span><span>(</span><span><span>`</span><span>\/users\/[^\/]+(\/)?$</span><span>`</span></span><span>)</span><span>)</span> <span>{</span>

    <span>const</span> userId <span>=</span> <span>decodeURI</span><span>(</span>pathname<span>.</span><span>split</span><span>(</span><span>&#39;/&#39;</span><span>)</span><span>[</span><span>2</span><span>]</span><span>)</span><span>;</span>

    <span>// GET /users/{id}</span>
    <span>if</span> <span>(</span>method <span>==</span> <span>&#34;GET&#34;</span><span>)</span> <span>{</span>
      <span>return</span> <span>await</span> <span>callUDF</span><span>(</span>req<span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>return</span> <span>formatFaunaCallFunction</span><span>(</span><span>&#39;GetUser&#39;</span><span>,</span> userId<span>,</span> <span>null</span><span>)</span><span>;</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span>

    <span>// PUT /users/{id}</span>
    <span>if</span> <span>(</span>method <span>==</span> <span>&#34;PUT&#34;</span><span>)</span> <span>{</span>
      <span>try</span> <span>{</span>
        <span>const</span> reqBody <span>=</span> <span>await</span> req<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>
        <span>return</span> <span>await</span> <span>callUDF</span><span>(</span>req<span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
          <span>return</span> <span>formatFaunaCallFunction</span><span>(</span><span>&#39;UpdateUser&#39;</span><span>,</span> userId<span>,</span> reqBody<span>)</span><span>;</span>
        <span>}</span><span>)</span><span>;</span>
      <span>}</span> <span>catch</span> <span>{</span>
        <span>return</span> <span>badRequest</span><span>(</span><span>)</span><span>;</span>
      <span>}</span>
    <span>}</span>
  <span>}</span>

  <span>return</span> <span>new</span> <span>Response</span><span>(</span><span>&#34;The page you requested could not be found&#34;</span><span>,</span> <span>{</span>
    status<span>:</span> <span>404</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>async</span> <span>function</span> <span>callUDF</span><span>(</span><span>request<span>,</span> formatHandler</span><span>)</span> <span>{</span>
  <span>try</span> <span>{</span>
    <span>const</span> <span>{</span> backend<span>,</span> backendUrl<span>,</span> bearerToken <span>}</span> <span>=</span> <span>resolveBackend</span><span>(</span>request<span>)</span><span>;</span>

    <span>// formatHandler translates REST request into FQL &#34;Call(Function(&#39;name&#39;))&#34; equivalent</span>
    <span>const</span> body <span>=</span> <span>formatHandler</span><span>(</span><span>)</span><span>;</span>

    <span>const</span> headers <span>=</span> <span>new</span> <span>Headers</span><span>(</span><span>{</span>
      <span>&#34;Authorization&#34;</span><span>:</span> <span><span>`</span><span>Bearer </span><span><span>${</span>bearerToken<span>}</span></span><span>`</span></span><span>,</span>
      <span>&#34;Content-Type&#34;</span><span>:</span> <span>&#34;application/json&#34;</span>
    <span>}</span><span>)</span><span>;</span>

    <span>const</span> faunaRest <span>=</span> <span>new</span> <span>Request</span><span>(</span>backendUrl<span>,</span> <span>{</span>
      method<span>:</span> <span>&#34;POST&#34;</span><span>,</span>
      headers<span>:</span> headers<span>,</span>
      body<span>:</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span>body<span>)</span>
    <span>}</span><span>)</span><span>;</span>

    <span>const</span> res <span>=</span> <span>await</span> <span>fetch</span><span>(</span>faunaRest<span>,</span> <span>{</span> backend<span>:</span> backend <span>}</span><span>)</span><span>;</span>

    <span>let</span> response <span>=</span> <span>await</span> res<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>

    <span>// If FQL throws an error, return error</span>
    <span>const</span> faunaErrors <span>=</span> <span>getFaunaError</span><span>(</span>response<span>)</span><span>;</span>
    <span>if</span> <span>(</span>faunaErrors<span>)</span> <span>{</span>
      <span>return</span> <span>new</span> <span>Response</span><span>(</span>
        faunaErrors<span>.</span>description<span>,</span> <span>{</span>
        headers<span>:</span> <span>{</span> 
          <span>&#34;content-type&#34;</span><span>:</span> <span>&#34;application/json;charset=UTF-8&#34;</span><span>,</span>
          <span>&#34;Access-Control-Allow-Origin&#34;</span><span>:</span> <span>&#34;*&#34;</span>
        <span>}</span><span>,</span>          
        status<span>:</span> faunaErrors<span>.</span>status
      <span>}</span><span>)</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>return</span> <span>new</span> <span>Response</span><span>(</span>
        <span>JSON</span><span>.</span><span>stringify</span><span>(</span>response<span>.</span>resource<span>)</span><span>,</span> <span>{</span>
        headers<span>:</span> <span>{</span> 
          <span>&#34;content-type&#34;</span><span>:</span> <span>&#34;application/json;charset=UTF-8&#34;</span><span>,</span>
          <span>&#34;Access-Control-Allow-Origin&#34;</span><span>:</span> <span>&#34;*&#34;</span>
        <span>}</span><span>,</span>
        status<span>:</span> <span>200</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span> <span>catch</span> <span>(</span>e<span>)</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span><span>`</span><span><span>${</span>e<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
    <span>return</span> <span>new</span> <span>Response</span><span>(</span><span><span>`</span><span><span>${</span>e<span>}</span></span><span>`</span></span><span>,</span> <span>{</span> status<span>:</span> <span>500</span> <span>}</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span>
`</code></pre><ul><li>In the above code, notice that Compute@Edge is performing a fetch from the object store that hosts the SPA, so the domain of SPA_HOST must also be whitelisted as a ‚Äúhost‚Äù in the Compute@Edge service‚Äôs Origins &gt; Hosts settings. (We did this step with the Fauna EU domain endpoint)</li></ul><p>Now build with the same command used previously:</p><pre><code>fastly compute build</code></pre><p>And then deploy:</p><pre><code>fastly compute deploy</code></pre><p>After the command completes, wait just a few seconds (about 30 seconds) for the service to fully propagate. Then you should be able to test:</p><p>Example GET /users/{id} test with curl</p><pre><code>curl <span>-</span><span>H</span> <span>&#34;Authorization: Bearer eyJhb...&#34;</span>

https<span>:</span><span>/</span><span>/</span>frequently<span>-</span>faithful<span>-</span>mouse<span>.</span>edgecompute<span>.</span>app<span>/</span>users<span>/</span>uf7TdWaOKyWvLahkO2oxJi0AWBdVg24K@clients</code></pre><ul><li>Replace <code>uf7TdWaOKyWvLahkO2oxJi0AWBdVg24K@clients</code> with your own user_id</li></ul><p><em>Response</em>:</p><pre><code><span>{</span>
  <span>&#34;user_id&#34;</span><span>:</span> <span>&#34;uf7TdWaOKyWvLahkO2oxJi0AWBdVg24K@clients&#34;</span><span>,</span>
  <span>&#34;email&#34;</span><span>:</span> <span>&#34;rainer.theo@mailinator.com&#34;</span>
  <span>&#34;profile&#34;</span><span>:</span> <span>{</span>
    <span>&#34;name&#34;</span><span>:</span> <span>&#34;Rainer Theo&#34;</span><span>,</span>
    <span>&#34;country&#34;</span><span>:</span> <span>&#34;DE&#34;</span><span>,</span>
    <span>&#34;age&#34;</span><span>:</span> <span>&#34;23&#34;</span>
  <span>}</span> 
<span>}</span></code></pre><p>Example PUT /users/{id} test with curl</p><pre><code>curl <span>-</span><span>X</span> <span>PUT</span>  <span>-</span><span>H</span> <span>&#34;Content-Type: application/json&#34;</span> \
     <span>-</span><span>H</span> <span>&#34;Authorization: Bearer eyJhb...&#34;</span>  \
     <span>-</span>d <span>&#39;{&#34;email&#34;:&#34;rainer.theo@mailinator.com&#34;, &#34;profile&#34;: { &#34;name&#34;: &#34;Rainer Theo&#34;, &#34;country&#34;: &#34;DE&#34;, &#34;age&#34;: 30 } }&#39;</span> \
     https<span>:</span><span>/</span><span>/</span>frequently<span>-</span>faithful<span>-</span>mouse<span>.</span>edgecompute<span>.</span>app<span>/</span>users<span>/</span>uf7TdWaOKyWvLahkO2oxJi0AWBdVg24K@clients</code></pre><ul><li>Replace <code>uf7TdWaOKyWvLahkO2oxJi0AWBdVg24K@clients</code> with your own user_id</li></ul><p><em>Response</em>:</p><pre><code><span>{</span>
  <span>&#34;user_id&#34;</span><span>:</span> <span>&#34;uf7TdWaOKyWvLahkO2oxJi0AWBdVg24K@clients&#34;</span><span>,</span>
  <span>&#34;email&#34;</span><span>:</span> <span>&#34;rainer.theo@mailinator.com&#34;</span>
  <span>&#34;profile&#34;</span><span>:</span> <span>{</span>
    <span>&#34;name&#34;</span><span>:</span> <span>&#34;Rainer Theo&#34;</span><span>,</span>
    <span>&#34;country&#34;</span><span>:</span> <span>&#34;DE&#34;</span><span>,</span>
    <span>&#34;age&#34;</span><span>:</span> <span>30</span>
  <span>}</span> 
<span>}</span></code></pre><p>If you configured <code><span>SPA_HOST</span></code> and <code><span>SPA_BACKEND</span></code> (and have uploaded a SPA to the <code><span>SPA_HOST</span></code>), you‚Äôll be able to see it by opening a browser to / at the Compute@Edge domain, e.g. <code>https<span>:</span><span>/</span><span><span>/</span><span>frequently-faithful-mouse.edgecompute.app</span><span>/</span></span></code>.</p><h2 id="Sample-App">Sample App</h2><p>We‚Äôve built a <a href="https://github.com/fauna-labs/vue-fauna-edge-api" target="_blank" rel="noreferrer noopener">sample app</a> to demonstrate how the solution comes together. One of the beauties of using Auth0 is we don‚Äôt even have to build a login and signup page as it is provided out-of-the-box.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4s8CdrEaim6nLoZjOD6zTm/0d7180da7e3debb8168ef769e546f72d/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0"/></p><h2 id="Going-to-the-Next-Level">Going to the Next Level</h2><p>Being able to run logic at the edge provides you full control over the routing of your application. In addition to what‚Äôs already been covered in this tutorial, you can also:</p><ul><li>Stitch together multiple backends.</li><li>Route to other resources (other than Fauna) and serve them under the same domain.</li><li>Etc.</li></ul><p>Take a look at some <a href="https://developer.fastly.com/solutions/examples/javascript/" target="_blank" rel="noreferrer noopener">examples</a> to get a feel of what you can achieve.</p><p>An advanced capability involves Geo-IP‚Äôing the requests at the edge, allowing us to serve region specific traffic based on the location of the client. Let‚Äôs go back to this picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/72F9duizmcoHuJ7PB4RtTW/77697bf18ec0779b515f0a1ae7c8fee2/Uploaded_from_Building_an_edge_API_gateway_with_Fauna_and_securing_it_with_Auth0" alt="Fastly Fauna GDPR.drawio"/></p><p>Let‚Äôs assume that our requirements are that EU users&#39; data must be stored in the EU. As for users coming from anywhere else, it doesn‚Äôt matter. We‚Äôre also going to serve a different version of the SPA to EU users ‚Äî one that has additional consent screening as well as EU-specific content.</p><p>A high-level walkthrough of how we‚Äôll enhance our setup is as follows:</p><p>Use <a href="https://developer.fastly.com/solutions/examples/geo-ip-api-at-the-edge" target="_blank" rel="noreferrer noopener">event.client.geo</a> to detect if requests come from the EU or not. As an example, within <code><span>handleRequest</span><span>(</span><span>)</span></code> of <code>index<span>.</span>js</code>, we can include the following code to logically send an EU or non-EU version of the SPA to users:</p><pre><code><span>const</span> clientGeo <span>=</span> event<span>.</span>client<span>.</span>geo<span>;</span>
<span>if</span> <span>(</span>clientGeo<span>.</span>continent <span>==</span> <span>&#39;EU&#39;</span><span>)</span> <span>{</span>
    <span>SPA_HOST</span> <span>=</span> <span>&#39;eu-version.s3-website-eu-central-1.amazonaws.com&#39;</span><span>;</span>
    <span>SPA_BACKEND</span> <span>=</span> <span>&#39;s3staticwebsite-eu&#39;</span><span>;</span>
<span>}</span> <span>else</span> <span>{</span>
    <span>SPA_HOST</span> <span>=</span> <span>&#39;base-version.s3-website-us-east-1.amazonaws.com&#39;</span><span>;</span>
    <span>SPA_BACKEND</span> <span>=</span> <span>&#39;s3staticwebsite&#39;</span><span>;</span>
<span>}</span>
`</code></pre><p>Then, create a US Region Group (or Classic Region Group) Fauna database and replicate everything we‚Äôve setup in the tutorial. This includes setting up the AccessProvider in Fauna and corresponding API in Auth0. Thus, a user logging in to the EU website gets a different <code>aud</code> claim than a user logging in from the non-EU website. We then update <code><span>resolveBackend</span><span>(</span><span>)</span></code> in <code>utils<span>.</span>js</code> to route API requests to the EU Region Group or US Region Group as follows:</p><pre><code><span>export</span> <span>function</span> <span>resolveBackend</span><span>(</span><span>request</span><span>)</span> <span>{</span>
  <span>try</span> <span>{</span>
    <span>const</span> bearerToken <span>=</span> request<span>.</span>headers<span>.</span><span>get</span><span>(</span><span>&#39;Authorization&#39;</span><span>)</span><span>.</span><span>split</span><span>(</span><span>&#39;Bearer &#39;</span><span>)</span><span>[</span><span>1</span><span>]</span><span>;</span>

    <span>const</span> decodedPayload <span>=</span> <span>JSON</span><span>.</span><span>parse</span><span>(</span>
      Buffer<span>.</span><span>from</span><span>(</span>jwtPayload<span>,</span> <span>&#39;base64&#39;</span><span>)</span><span>.</span><span>toString</span><span>(</span><span>&#39;utf-8&#39;</span><span>)</span>
    <span>)</span><span>;</span>
    <span>const</span> aud <span>=</span> decodedPayload<span>[</span><span>&#39;aud&#39;</span><span>]</span><span>;</span>

    <span>// we can store and lookup our audiences in the edge dictionary</span>
    <span>const</span> exampleDictionary <span>=</span> <span>new</span> <span>Dictionary</span><span>(</span><span>&#34;example_dictionary&#34;</span><span>)</span><span>;</span>
    <span>const</span> audEU <span>=</span> exampleDictionary<span>.</span><span>get</span><span>(</span><span>&#34;aud_eu&#34;</span><span>)</span><span>;</span>

    <span>if</span> <span>(</span>aud <span>==</span> audEU<span>)</span> <span>{</span>
      backend <span>=</span> <span>&#39;db_eu_fauna_com&#39;</span><span>;</span>
      backendUrl <span>=</span> <span>&#39;https://db.eu.fauna.com&#39;</span><span>;</span>    
    <span>}</span> <span>else</span> <span>{</span>
      backend <span>=</span> <span>&#39;db_us_fauna_com&#39;</span><span>;</span>
      backendUrl <span>=</span> <span>&#39;https://db.us.fauna.com&#39;</span><span>;</span>        
    <span>}</span>

    <span>return</span> <span>{</span> backend<span>,</span> backendUrl<span>,</span> bearerToken <span>}</span><span>;</span>
  <span>}</span> <span>catch</span> <span>(</span>e<span>)</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span><span>`</span><span><span>${</span>e<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
    <span>throw</span> e<span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>And now, when the edge detects that the request is coming from the EU region, the EU version of the website is shown. And users are automatically created in the EU Region Group. Conversely, requests coming from outside the EU will be served the international version of the site and users created in the US/Classic Region Group.</p><h2 id="Wrapping-Up">Wrapping Up</h2><p>Edge computing enables developers to deploy application logic closer to the end-user for reduced latency. But if the database is itself a performance bottleneck due to its distance from the user, we haven‚Äôt solved the latency problem. Fauna is a globally distributed database, making it a great fit for developers to pair with Fastly‚Äôs Compute@Edge ‚Äì keeping both compute and the data close to the end-user, and in turn keeping global latency low.</p><p>Auth0 allows developers to focus on building applications and worry less about security and building their own authentication and identity solutions. And Fauna natively integrates with Auth0, further enhancing our promise to drive developer productivity. Finally, the architecture‚Äôs completely serverless footprint allows developers to focus more on building and less on managing infrastructure.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 21 Dec 2021 15:44:00 +0000</pubDate>
    </item>
    <item>
      <title>Forbidden, Unauthorized, or What Else?</title>
      <link>https://auth0.com/blog/forbidden-unauthorized-http-status-codes/</link>
      <description>How to use HTTP status code in the authorization context? When to use &#34;401 Unauthorized&#34; status code? When to use &#34;403 Forbidden&#34;? Let&#39;s try to clarify.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Assume your Web API is protected and a client attempts to access it without the appropriate credentials. How do you deal with this scenario? Most likely, you know you have to return an HTTP status code. But what is the more appropriate one? Should it be <code><span>401</span> Unauthorized</code> or <code><span>403</span> Forbidden</code>? Or maybe something else?</p><p>As usual, it depends üôÇ. It depends on the specific scenario and also on the security level you want to provide. Let&#39;s go a little deeper.</p><p>If you prefer, you can watch a video on the same topic:</p><p><iframe src="https://www.youtube.com/embed/WV0cZ65EVig" frameborder="0" allowfullscreen=""></iframe></p><h2 id="Web-APIs-and-HTTP-Status-Codes">Web APIs and HTTP Status Codes</h2><p>Before going into the specific topic, let&#39;s take a quick look at the rationale of HTTP status codes in general. Most Web APIs are inspired by the <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="noreferrer noopener">REST paradigm</a>. Although the vast majority of them <a href="https://dzone.com/articles/please-dont-call-them-restful" target="_blank" rel="noreferrer noopener">don&#39;t actually implement REST</a>, they usually follow a few RESTful conventions when it comes to HTTP status codes.</p><p>The basic principle behind these conventions is that <strong>a status code returned in a response must make the client aware of what is going on and what the server expects the client to do next</strong>. You can fulfill this principle by giving answers to the following questions:</p><ul><li>Is there a problem or not?</li><li>If there is a problem, on which side is it? On the client or on the server side?</li><li>If there is a problem, what should the client do?</li></ul><p>This is a general principle that applies to all the HTTP status codes. For example, if the client receives a <code><span>200</span> <span>OK</span></code> status code, it knows there was no problem with its request and expects the requested resource representation in the response&#39;s body. If the client receives a <code><span>201</span> Created</code> status code, it knows there was no problem with its request, but the resource representation is not in the response&#39;s body. Similarly, when the client receives a <code><span>500</span> Internal Server Error</code> status code, it knows that this is a problem on the server side, and the client can&#39;t do anything to mitigate it.</p><p>In summary, your Web API&#39;s response should provide the client with enough information to realize how it can move forward opportunely.</p><p>Let&#39;s consider the case when a client attempts to call a protected API. If the client provides the appropriate credentials (e.g., a valid <a href="https://auth0.com/docs/security/tokens/access-tokens" target="_blank" rel="noreferrer noopener">access token</a>), its request is accepted and processed. What happens when the client has no appropriate credentials? What status code should your API return when a request is not legitimate? What information should it return, and how to guarantee the best security experience?</p><p>Fortunately, in the <a href="https://datatracker.ietf.org/doc/html/rfc6750" target="_blank" rel="noreferrer noopener">OAuth security context, you have some guidelines</a>. Of course, you can use them even if you don&#39;t use <a href="https://auth0.com/docs/authorization/protocols/protocol-oauth2" target="_blank" rel="noreferrer noopener">OAuth</a> to secure your API.</p><blockquote><a href="https://twitter.com/intent/tweet?text=&#34;The%20basic%20principle%20behind%20REST%20status%20code%20conventions%20is%20that%20a%20status%20code%20must%20make%20the%20client%20aware%20of%20what%20is%20going%20on%20and%20what%20the%20server%20expects%20the%20client%20to%20do%20next&#34; via @auth0 https://auth0.com/blog/forbidden-unauthorized-http-status-codes" target="_blank" rel="noopener noreferrer"><p>&#34;The basic principle behind REST status code conventions is that a status code must make the client aware of what is going on and what the server expects the client to do next&#34;</p><div><p><img alt="Tweet" src="https://cdn.auth0.com/blog/resources/twitter.svg"/></p><h4>Tweet This</h4></div></a></blockquote><h2 id="When-to-Use-400-Bad-Request-">When to Use 400 Bad Request?</h2><p>Let&#39;s start with a simple case: a client calls your protected API, omitting a required parameter. In this case, your API should respond with a <code><span>400</span> Bad Request</code> status code. In fact, if that parameter is required, your API can&#39;t even process the client request. The client&#39;s request is malformed.</p><p>Your API should return the same status code even when the client provides an unsupported parameter or repeats the same parameter multiple times in its request. In both cases, <strong>the client&#39;s request is not as expected and should be refused</strong>.</p><p>Following the general principle discussed above, the client should be empowered to understand what to do to fix the problem. So, you should add in your response&#39;s body what was wrong with the client&#39;s request. You can provide those details in the format you prefer, such as simple text, XML, JSON, etc. However, using a standard format like the one proposed by the <a href="https://datatracker.ietf.org/doc/html/rfc7807" target="_blank" rel="noreferrer noopener">Problem Details for HTTP APIs</a> specifications would be more appropriate to enable uniform problem management across clients.</p><p>For example, if your client calls your API with an empty value for the required <code>data</code> parameter, the API could reply with the following response:</p><pre><code><span>HTTP/1.1 <span>400 Bad Request</span></span>
<span>Content-Type:</span> application/problem+json
<span>Content-Language:</span> en

{
  &#34;type&#34;: &#34;https://myapi.com/validation-error&#34;,
  &#34;title&#34;: &#34;Validation error&#34;,
  &#34;detail&#34;: &#34;Your request parameters are not valid.&#34;,
  &#34;invalid-params&#34;: [
    {
      &#34;name&#34;: &#34;data&#34;,
      &#34;reason&#34;: &#34;cannot be blank.&#34;
    }
  ]
}</code></pre><p>Now, let&#39;s assume that the client calls your protected API with a well-formed request but no valid credentials. For example, in the OAuth context, this may fall in one of the following cases:</p><ul><li>An access token is missing.</li><li>An access token is expired, revoked, malformed, or invalid for other reasons.</li></ul><p>In both cases, the appropriate status code to reply with is <code><span>401</span> Unauthorized</code>. In the spirit of mutual collaboration between the client and the API, the response must include a hint on how to obtain such authorization. That comes in the form of the <code><span>WWW</span><span>-</span>Authenticate</code> header with the specific <a href="https://www.iana.org/assignments/http-authschemes/http-authschemes.xhtml" target="_blank" rel="noreferrer noopener">authentication scheme</a> to use. For example, in the case of OAuth2, the response should look like the following:</p><pre><code><span>HTTP/1.1 <span>401 Unauthorized</span></span>
<span>WWW-Authenticate:</span> Bearer realm=&#34;example&#34;</code></pre><p>You have to use the <code>Bearer</code> scheme and provide the <a href="https://datatracker.ietf.org/doc/html/rfc7235#section-2.2" target="_blank" rel="noreferrer noopener"><code>realm</code> parameter</a> to indicate the set of resources the API is protecting.</p><p>If the client request does not include any access token, demonstrating that it wasn&#39;t aware that the API is protected, the API&#39;s response should not include any other information.</p><p>On the other hand, if the client&#39;s request includes an expired access token, the API response could include the reason for the denied access, as shown in the following example:</p><pre><code><span>HTTP/1.1 <span>401 Unauthorized</span></span>
<span>WWW-Authenticate:</span> Bearer realm=&#34;example&#34;,
                  error=&#34;invalid_token&#34;,
                  error_description=&#34;The access token expired&#34;</code></pre><h2 id="When-to-Use-403-Forbidden-">When to Use 403 Forbidden?</h2><p>Let&#39;s explore a different case now. Assume, for example, that your client sends a request to modify a document and provides a valid access token to the API. However, that token doesn&#39;t include or imply any permission or scope that allows the client to perform the desired action.</p><p>In this case, your API should respond with a <code><span>403</span> Forbidden</code> status code. With this status code, your API tells the client that the credentials it provided (e.g., the access token) are valid, but it needs appropriate privileges to perform the requested action.</p><p>To help the client understand what to do next, your API may include what privileges are needed in its response. For example, according to the <a href="https://datatracker.ietf.org/doc/html/rfc6750#section-3.1" target="_blank" rel="noreferrer noopener">OAuth2 guidelines</a>, your API may include information about the missing scope to access the protected resource.</p><p>Try out the most powerful authentication platform for free.<a target="_blank" href="https://auth0.com/signup?promo=sup&amp;place=in-blog-banner&amp;type=link&amp;text=get-started&amp;origin=blog">Get started ‚Üí</a></p><h2 id="Security-Considerations">Security Considerations</h2><p>When you plan how to respond to your client&#39;s requests, always keep security in mind.</p><h3 id="How-to-deal-with-response-details">How to deal with response details</h3><p>A primary security concern is to <strong>avoid providing useful information to potential attackers</strong>. In other words, returning detailed information in the API responses to attempts to access protected resources may be a security risk.</p><p>For example, suppose your API returns a <code><span>401</span> Unauthorized</code> status code with an error description like <code>The access token is expired</code>. In this case, it gives information about the token itself to a potential attacker. The same happens when your API responds with a <code><span>403</span> Forbidden</code> status code and reports the missing scope or privilege.</p><p>In other words, sharing this information can improve the collaboration between the client and the server, according to the basic principle of the REST paradigm. However, <strong>the same information may be used by malicious attackers to elaborate their attack strategy</strong>.</p><p>Since this additional information is optional for both the HTTP specifications and the OAuth2 bearer token guidelines, maybe you should think carefully about sharing it. The basic principle on sharing that additional information should be based on the answer to this question: <strong>how would the client behave any differently if provided with more information?</strong></p><p>For example, in the case of a response with a <code><span>401</span> Unauthorized</code> status code, does the client&#39;s behavior change when it knows that its token is expired or revoked? In any case, it must request a new token. So, adding that information doesn&#39;t change the client&#39;s behavior.</p><p>Different is the case with <code><span>403</span> Forbidden</code>. By informing your client that it needs a specific permission, your API makes it learn what to do next, i.e., requesting that additional permission. If your API doesn&#39;t provide this additional information, it will <em>behave differently</em> because it doesn&#39;t know what to do to access that resource.</p><h3 id="Don-t-let-the-client-know---">Don&#39;t let the client know...</h3><p>Now, assume your client attempts to access a resource that it MUST NOT access at all, for example, because it belongs to another user. What status code should your API return? Should it return a <code><span>403</span></code> or a <code><span>401</span></code> status code?</p><p>You may be tempted to return a <code><span>403</span></code> status code anyway. But, actually, you can&#39;t suggest any missing permission because that client has no way to access that resource. So, the <code><span>403</span></code> status code gives no actual helpful information. You may think that returning a <code><span>401</span></code> status code makes sense in this case. After all, the resource belongs to another user, so the request should come from a different user.</p><p>However, since that resource shouldn&#39;t be reached by the current client, the best option is to hide it. Letting the client (and especially the user behind it) know that resource exists could possibly lead to <a href="https://portswigger.net/web-security/access-control/idor" target="_blank" rel="noreferrer noopener">Insecure Direct Object References (IDOR)</a>, an access control vulnerability based on the knowledge of resources you shouldn&#39;t access. Therefore, in these cases, your API should respond with a <code><span>404</span> Not Found</code> status code. This is an option provided by the <a href="https://www.rfc-editor.org/rfc/rfc7231#section-6.5.3" target="_blank" rel="noreferrer noopener">HTTP specification</a>:</p><blockquote><p>An origin server that wishes to &#34;hide&#34; the current existence of a  forbidden target resource MAY instead respond with a status code of  404 (Not Found).</p></blockquote><p>For example, this is the strategy adopted by GitHub when you don&#39;t have any permission to access a repository. This approach avoids that an attacker attempts to access the resource again with a slightly different strategy.</p><h3 id="How-to-deal-with-bad-requests">How to deal with bad requests</h3><p>When a client sends a malformed request, you know you should reply with a <code><span>400</span> Bad Request</code> status code. You may be tempted to analyze the request&#39;s correctness before evaluating the client credentials. You shouldn&#39;t do this for a few reasons:</p><ul><li>By evaluating the client credentials before the request&#39;s validity, you avoid your API processing requests that aren&#39;t allowed to be there.</li><li>A potential attacker could figure out how a request should look without being authenticated, even before obtaining or stealing a legitimate access token.</li></ul><p>Also, consider that in infrastructures with an API gateway, the client credentials will be evaluated beforehand by the gateway itself, which doesn&#39;t know at all what parameters the API is expecting.</p><blockquote><p>The security measures discussed here must be applied in the production environment. Of course, in the development environment, your API can provide all the information you need to be able to diagnose the causes of an authorization failure.</p></blockquote><h2 id="Recap">Recap</h2><p>Throughout this article, you learned that:</p><ul><li><code><span>400</span> Bad Request</code> is the status code to return when the form of the client request is not as the API expects.</li><li><code><span>401</span> Unauthorized</code> is the status code to return when the client provides no credentials or invalid credentials.</li><li><code><span>403</span> Forbidden</code> is the status code to return when a client has valid credentials but not enough privileges to perform an action on a resource.</li></ul><p>You also learned that some security concerns might arise when your API exposes details that malicious attackers may exploit. In these cases, you may adopt a more restricted strategy by including just the needed details in the response body or even using the <code><span>404</span> Not Found</code> status code instead of <code><span>403</span> Forbidden</code> or <code><span>401</span> Unauthorized</code>.</p><p>The following cheat sheet summarizes what you learned:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2CSdQcMBYLQv02lalUIIT3/9d4d5695b6b43868c2f01cb1ad043f17/4xx-http-status-code-cheat-sheet.jpg" alt="4xx HTTP status codes cheat sheet"/></p></div></div>]]></content:encoded>
      <author>When to Use 401 Unauthorized?</author>
      <pubDate>Mon, 20 Dec 2021 16:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0‚Äôs Response to Log4J</title>
      <link>https://auth0.com/blog/auth0s-response-to-log4j/</link>
      <description>CISO Jameeka Green Aaron on Auth0‚Äôs actions around this insidious vulnerability</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>On Thursday, December 9, 2021, a vulnerability in the Java logging library Log4j was disclosed and assigned the CVE ID <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228" target="_blank" rel="noreferrer noopener">CVE-2021-44228</a>, also nicknamed Log4Shell. The Cybersecurity and Infrastructure Agency (CISA) also released an <a href="https://www.cisa.gov/uscert/ncas/current-activity/2021/12/10/apache-releases-log4j-version-2150-address-critical-rce" target="_blank" rel="noreferrer noopener">alert</a> on the 10th of December.</p><p>This is an incredibly serious vulnerability that has had security teams in every industry on high alert, working around-the-clock to ensure that their systems are secure. At a high level, Log4J allows Remote Code Execution (RCE) on an affected server, granting an attacker full control. A detailed explanation was published by <a href="https://www.lunasec.io/docs/blog/log4j-zero-day/" target="_blank" rel="noreferrer noopener">LunaSec</a>.</p><p>Security is our top priority at Auth0 and we recognize the critical role our platform plays for our customers. Since the vulnerability came to light, Auth0 teams across Engineering, Product, Customer Success, and Security, led by our Detection and Response team have been all hands on deck to evaluate any potential impact on our platform. This is one of the most dangerous vulnerabilities that our industry has seen and we have treated it with that level of seriousness. It also has the potential to be very widespread and takes time to methodically review code and systems. We started with our most critical assets and worked outwards, gaining more assurance as we progressed.</p><p>As we stated in our tweet last <a href="https://twitter.com/auth0/status/1470086301902721024" target="_blank" rel="noreferrer noopener">weekend</a>, we did not see direct impact then, nor do we now, after continuous assessment and monitoring. We can confirm that there were no signs of exploitation, and the Log4j library is not used in our core service code base. </p><p>Auth0 does use a very small number of third-party components that were vulnerable to Log4Shell. We have been working closely with our partners throughout the incident response process, firstly to apply patches as soon as they are released, and secondly to identify if they could have been used as a potential path to compromise our service. Again, our review has not shown any signs of abuse from the vulnerability.</p><p>The speed of response from our teams and our existing security architecture was essential here. Using our existing security tooling, we were able to scan our entire code base and containers for the affected library and quickly get assurance that we were not affected. We also deployed WAF rules on our edge for an extra layer of protection and then focused our efforts on assuring our supply chain. Finally our Red Team has been trying to actively use the vulnerability against the Auth0 platform, further increasing our levels of assurance through offensive testing.</p><p>This vulnerability is very serious. We recommend that all of our customers continue to closely review and monitor their own systems and third-party components for the vulnerability and any signs of compromise. And critically make sure you are running the latest versions of any impacted software (please see <a href="https://sec.okta.com/articles/2021/12/log4shell" target="_blank" rel="noreferrer noopener">Okta‚Äôs blog</a> for details of the impact to the Okta products).</p><p>Subsequently other vulnerabilities have been reported in Log4j (<a href="https://nvd.nist.gov/vuln/detail/CVE-2021-45046" target="_blank" rel="noreferrer noopener">CVE-2021-45046</a> and <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-45105" target="_blank" rel="noreferrer noopener">CVE-2021-45105</a>) and we expect there to be more as the library gets further attention from security researchers. We will continue to closely monitor and investigate the situation, and provide prompt notification if the situation changes.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 20 Dec 2021 13:12:00 +0000</pubDate>
    </item>
    <item>
      <title>Enable SMS MFA with Plivo and Auth0 Actions</title>
      <link>https://auth0.com/blog/mfa-with-auth0-actions-and-plivo/</link>
      <description>Use Auth0 Actions to enable SMS-based MFA with Plivo.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Logging into a website with your username and password is a straightforward way to log in and access your content. You&#39;ve been doing it for years, you&#39;ve created several passwords, and it works. Logging in with <strong>just</strong> a password isn&#39;t as secure for your users as it used to be. Hackers can steal passwords from one site and use <a href="https://auth0.com/blog/what-is-credential-stuffing/" target="_blank" rel="noreferrer noopener">credential stuffing</a> to pose as your user and gain access to other sites. It&#39;s common for your users to re-use passwords since they have several to remember across all their applications. You can help keep your users&#39; data secure by offering another layer of protection by enabling Multi-factor Authentication (MFA).</p><blockquote><p>To learn more, read <a href="https://auth0.com/blog/multifactor-authentication-mfa/" target="_blank" rel="noreferrer noopener">this guide about MFA and its different methods on the Auth0 blog</a>.</p></blockquote><p>You&#39;ve likely experienced MFA in real life. For example, if you start working for a new company, they may ask for your ID card and a birth certificate. Those are two different <em>factors</em> of identification. It helps verify you are who you say you are to make sure your paycheck goes to you and lowers the success rate of someone posing as you.</p><p>In this blog post, you&#39;ll learn how to implement SMS-based MFA with Auth0 Actions and <a href="https://www.plivo.com/" target="_blank" rel="noreferrer noopener">Plivo</a>.</p><h2 id="Prerequisites">Prerequisites</h2><ul><li>An Auth0 account</li><li>A Plivo account</li><li>A Plivo phone number</li></ul><p>If you do not have a Plivo account or an Auth0 account, you can sign up for a <a href="https://console.plivo.com/accounts/register/" target="_blank" rel="noreferrer noopener">free Plivo account</a> and a <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">free Auth0 account</a>.</p><p>If you already have an application created in your Auth0 account, you can skip to <a href="#Create-Action-for-MFA">Create Action for MFA</a>.</p><h2 id="Set-up---Configure-a-React-App-Application-with-Auth0">Set up &amp; Configure a React App Application with Auth0</h2><p>In the Auth0 dashboard, create a new application by clicking on <strong>Applications &gt; Applications &gt; Create Application</strong>. On the next screen, create a name for your application and select <strong>Single Page Web Applications</strong> since you&#39;re using a React app. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7ffrE0TIKPuvwAmyAHETGV/3704b624e8b568fba9288b1c6236872d/auth0-create-application-page.png" alt="Auth0 Create Application Page"/></p><p>The next screen will ask you, &#34;What technology are you using for your web app?&#34; Select <strong>React</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Is0KXk07ueIJadkrrHnbl/804f4ad53e8af5b28916481b92778fdc/auth0-technology-selection-page.png" alt="Auth0 Technology Selection Page"/></p><p>To get up and running quickly, you can download a sample <a href="https://github.com/auth0-samples/auth0-react-samples/tree/master/Sample-01" target="_blank" rel="noreferrer noopener">React application integrated with Auth0 on GitHub</a>.
Once it is downloaded, type <code>cd auth0<span>-</span>react<span>-</span>samples</code> on your terminal, then run <code>npm install</code> to install the dependencies.</p><h2 id="Configure-Auth0-Credentials">Configure Auth0 Credentials</h2><p>For the authentication flow to work, the project needs your Auth0 domain and client ID. In your code editor, copy the content of <code>src<span>/</span>auth_config<span>.</span>json<span>.</span>example</code> into a new file in the same src folder called <code>auth_config<span>.</span>json</code>, and replace the values with your own Auth0 application credentials:</p><pre><code><span>{</span>
  <span>&#34;domain&#34;</span><span>:</span> <span>&#34;{YOUR AUTH0 DOMAIN}&#34;</span><span>,</span>
  <span>&#34;clientId&#34;</span><span>:</span> <span>&#34;{YOUR AUTH0 CLIENT ID}&#34;</span><span>,</span>
<span>}</span></code></pre><p>You can get the client ID and domain from the settings tab on your new application page.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1GFtgZeJursgHKHzNXQFVh/7496cb3bc06a7411096386c3109be8ed/auth0-application-settings.png" alt="Auth0 Application Settings Page"/></p><p>Next, scroll down to the Application URIs section to fill in Allowed Callback URLs, Allowed Logout URL, and Allowed Web Origins. This example is running locally, so enter <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>3000</span></code> into each field. When you&#39;re finished, scroll to the bottom of the page and click <em>Save Changes</em>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6kXeY9LVo5sincLcxSdrk1/e25a7bfd89bcda641f6c6625ad143aa5/Screen_Shot_2021-12-03_at_8.37.26_AM.png" alt="Auth0 Dashboard Application URIs section"/></p><h2 id="Create-Action-for-MFA">Create Action for MFA</h2><p>With an application linked to the Auth0 dashboard, you can create an Action that will run globally for all applications in your Auth0 tenant. Actions are functions written in Node.js that you set to run at specific events based on your users&#39; actions. Actions let you write custom code that fits your needs and integrates third-party vendors with Auth0 to work together. This post is going to focus on integrating with Plivo. </p><p>To get started with Actions, you need to add an Action to your library. On the Auth0 dashboard side menu, click <strong>Actions &gt; Library</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6q9LRH1DvQMiF3mU7t6Wy7/8481bc4376718299a2806a165e49ed56/auth0-action-selection.png" alt="Auth0 Actions Selection"/></p><p>On the Library Page, click <strong>Add Action</strong>. On the Browse Actions page, search for <strong>Plivo</strong> and click on it. On the next page, click on <strong>Add Integration</strong>.
You&#39;ll then be met with a prompt telling you, &#34;Plivo will need access to: Read and share user profile information&#34; if you agree, click <strong>Continue</strong>.</p><h2 id="Access-and-Add-Plivo-Credentials">Access and Add Plivo Credentials</h2><p>This will bring up a page to enter your Plivo credentials such as Plivo authorization ID, Plivo phone number, and Plivo authorization token. You can find the authorization ID and Token on the Account and Payments section of your Plivo dashboard.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Dttg4mSQ9R20tnFzsRuVr/01c5fe787a262c6e5793642703785064/plivo-accounts-and-payments.png" alt="Plivo Accounts and Payments Page"/></p><p>Access your Plivo phone number by clicking on <strong>Phone Numbers</strong> on the left side menu. If you don&#39;t have a Plivo phone number, you can rent one <a href="https://www.plivo.com/docs/numbers/guides/buy-a-number/" target="_blank" rel="noreferrer noopener">following these instructions on the Plivo Docs</a>.</p><blockquote><p>Make sure you add the phone number in the E.164 format(ex. +15554443232)</p></blockquote><p>Then click <strong>Create</strong>, and you&#39;ll go to the Library page. You can create an Action Flow from here. You&#39;ll learn how to use flows next.</p><h2 id="Create-Send-Phone-Message-Flow">Create Send Phone Message Flow</h2><p>You should now see the Plivo Action on the installed tab of the Library page. Click the three dot menu on the right and select <strong>Add to flow</strong>. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5IbEG0QKPAbyIoi9buA2NL/ba6df3e83c1cc498b248eafd48fc5362/auth0-add-to-flow.png" alt="Actions Library Page"/></p><p>This will take you directly to the <strong>Send Phone Message</strong> flow. Flows are the steps your application takes when using Auth0 as your identity provider. You&#39;ll see the <strong>Start</strong> and <strong>Complete</strong> trigger points in the flow in Action flow visualizer in the middle of the screen. On the ride side of the screen, you&#39;ll see the <strong>Add Action</strong> section. This will show a list of installed Actions like the Plivo one we created, and there is also a tab for custom Actions.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/ITasqHfe5OIyRImhGGxis/0a125823cda2f4ee84c2f19d5f6b97ae/auth0-actions-flow-visualizer.png" alt="Auth0 Actions Visualizer"/></p><p>You can drag and drop the Actions to the point in the flow that you want them to trigger. Grab the Plivo Action and drop it in between <strong>Start</strong> and <strong>Complete</strong>, then click <strong>Apply</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/YYUxv5wmVMjjcFA6ictqN/0683342bf45d6a9e0661e7cbd0febd7e/auth0-actions-added.png" alt="Auth0 Actions Flow Visulizer"/></p><p>Now, when an SMS message is requested, your application will signal Pilvo to send an SMS message. But how do you trigger the message request? You have to turn on SMS-based Multi-factor Authentication.</p><h2 id="Turn-on-MFA-in-Auth0-Dashboard">Turn on MFA in Auth0 Dashboard</h2><p>On the left side menu in the Auth0 dashboard, click <strong>Security &gt; Multi-factor Auth</strong>. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4UUXYlr7UjlSqt3mxPoyrq/17d0e5470369da629062de484fb59862/auth0-mfa-page.png" alt="Auth0 MFA page"/></p><p>In the <strong>Factors</strong> section, scroll down and click <strong>Phone Message</strong>. Click the toggle on the upper right side of the screen to enable Phone Message. With this turned on, it requests a phone message be sent to your users with a code to verify their login. </p><p>Under <strong>Choose a delivery provider</strong>, select <strong>Custom</strong>, since you created the Plivo &#34;Send Phone Message&#34; hook to handle sending an SMS to users. For <strong>Choose a delivery method</strong>, choose <strong>SMS</strong>. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3lfkktB82h2DkLrnl8OCBy/1fa9fb6ec90eb3519b6cc48546cbaeae/auth0-phone-message-screen.png" alt="Auth0 Phone Message Screen"/></p><p>Scroll to the bottom of the page and click <strong>Save</strong> to save these settings.</p><p>Return to the <strong>Multi-factor Authentication</strong> page and scroll down to the <strong>Define policies</strong> section. This section tells Auth0 when you want the Phone Message MFA request to trigger. For this example, select <strong>Always</strong> to ensure your users have an extra layer of protection each time they log in. Then click <strong>Save</strong>.</p><p>You will then be asked, &#34;Are you sure you want to continue?&#34; This prompt also lets you know that all users will be required to enroll in MFA and that all applications in your Auth0 tenant will now use MFA. Click <strong>Continue</strong>. </p><p>You have everything set up to require your users to receive an SMS message with a verification code from Plivo after logging in. But it&#39;s always a good idea to test out new features after you add them.</p><h2 id="Test-Your-MFA-Login-Flow">Test Your MFA Login Flow</h2><p>Run your sample application locally by launching the <code>npm run dev</code> command in the project&#39;s root folder. Then, head your browser to the <a href="http://localhost:3000" target="_blank" rel="noreferrer noopener">http://localhost:3000</a> address and click <strong>Login</strong> on the home page. On the login page, enter your email and password. Next, you&#39;ll be prompted to add a phone number to secure the account. This is what your users will see the next time they log in after you enable MFA.</p><p>You can select the code for your country on the first line, then type in your phone number and click <strong>Continue</strong>. You&#39;ll revieve an SMS message with a verification code. Enter that code into the input box on your application.</p><p>You&#39;ve successfully added another factor of protection for your users!</p><h2 id="Test-MFA-flow-in-Auth0-Dashboard">Test MFA flow in Auth0 Dashboard</h2><p>Another way you can test the MFA flow is by using the Auth0 dashboard. You can test Actions you created without having to run your entire application.</p><p>Click <strong>Getting Started</strong> at the top of the left menu on the Auth0 dashboard. You&#39;ll go to the <strong>Getting Started</strong> page, where you&#39;ll see the option to <strong>Try your Login box</strong>. Clicking <strong>Try it out</strong> will bring you to the login box that your app will use. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6x1ti069gOiQQEfKMxJOkA/1a574fcaa21a63c27af49c46f945ac5d/auth0-try-login-box.png" alt="Auth0 Dashboard Getting Started page"/></p><p>Log in as one of the users in your tenant (If you don&#39;t have any users, click <strong>Sign up</strong>).</p><p>Once logged in, you&#39;ll be asked to provide a phone number. Enter the number for your mobile phone. You&#39;ll receive an SMS message from your Plivo phone number with a six-digit code. Enter this code into the Auth0 login box and click <strong>Continue</strong>. You&#39;ll be greeted with the <strong>It Works</strong> page, confirming that your MFA Action worked!</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2TPUwfu11Te9Yb27M3920C/34f3bc3c726eeb0b76cc971c7fd1f5c3/auth0-it-works-screen.png" alt="Auth0 It Works web page"/></p><h2 id="Conclusion">Conclusion</h2><p>Congrats! You just added another layer of protection to keep your users&#39; data safe. First, you included the Plivo integration from Actions Library. You then created a &#34;Send Phone Message&#34; flow using the Plivo integration and the Actions drag and drop interface. After that, you enabled the Action by turning on MFA in the Auth0 dashboard. Finally, you tested everything out using &#34;Try your Login box&#34; in the Auth0 dashboard.</p></div></div>]]></content:encoded>
      <pubDate>Fri, 17 Dec 2021 15:21:00 +0000</pubDate>
    </item>
    <item>
      <title>Working with Auth0 User Profile Information and Metadata in Android Apps</title>
      <link>https://auth0.com/blog/working-auth0-user-profile-information-metadata-android-apps/</link>
      <description>Learn about the three kinds of information stored with each Auth0 user account and how to access them in your Android apps.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>After authenticating your Android app‚Äôs users (which you can learn in this tutorial), you‚Äôll probably want to know more about them and even store information about them as well. </p><p>Your app might need to know the email addresses associated with the user‚Äôs account or the user‚Äôs various names (given name, family name, or perhaps a nickname). You will probably store the settings and preferences that the user provides. You may also want to keep track of values that affect the app‚Äôs functionality. In a game, these could be things like the current level or high score; in a productivity app, these might be information such as if the user has performed a specific action or where the user is in a given workflow.</p><p>You might not be aware that Auth0‚Äôs user accounts store different kinds of information about each user. In this article, you‚Äôll learn about the information in Auth0 user accounts by adding the functionality to access this information to an existing app.</p><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong></p></blockquote><h2 id="What-You-ll-Build">What You‚Äôll Build</h2><p>You‚Äôll start with a pre-built simple, single-screen Android app that will allow the user to log in and log out using Auth0. You‚Äôll write some additional code that will give the app the ability to access these three different kinds of information about the user:</p><ol start="1"><li>Their user profile</li><li>Their user metadata</li><li>Their app metadata</li></ol><p>I‚Äôll explain what these are as I take you on a tour of the app.</p><p>The purpose of this app is to demonstrate how you access the three different kinds of user information stored in each user account. Let‚Äôs look at them in detail.</p><h3 id="The-user-profile">The user profile</h3><p>When the user runs the app and logs in successfully, the first set of user information they‚Äôll see is the <strong><em>user profile</em></strong>. It takes up most of the app‚Äôs screen, and you‚Äôll need to scroll to see it all. Here‚Äôs the first part...</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/tClYf5lRreoksoX2MCYn9/d3b9892bff2bc8b392c83122156b44bc/complete_android_app_-_part_1.png" alt="The top portion of the app‚Äôs main screen, featuring the ‚ÄúLog in‚Äù/‚ÄúLog out‚Äù buttons and user data"/></p><p>...and here‚Äôs the rest:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7xK6m0AJenuskBLJmvZwlB/2aeba904161494cb4a23133aff9e297b/complete_android_app_-_part_2.png" alt="The bottom portion of the app‚Äôs main screen, featuring the user metadata and app metadata"/></p><p>The user profile is a small set of essential user data that can be found in most user accounts, regardless of identity provider. The Auth0 Android library provides access to this information as properties of a <code>UserProfile</code> object. These properties are:</p><ul><li><strong><code>name</code></strong>: The user‚Äôs full name, typically their first and last names, as a single string.</li><li><strong><code>givenName</code></strong>: The user‚Äôs given name, or what we would call the user‚Äôs ‚Äúfirst name‚Äù in the western world.</li><li><strong><code>familyName</code></strong>: The user‚Äôs family name.</li><li><strong><code>nickname</code></strong>: The user‚Äôs nickname. This is often the name used to log in.</li><li><strong><code>email</code></strong>: The email address associated with this user account.</li><li><strong><code>isEMailVerified</code></strong>: A boolean whose value is <code><span>true</span></code> if the user verified that the value in <code>email</code> is their email address.</li><li><strong><code>pictureURL</code></strong>: The URL for an image of the user or some representation of the user.</li><li><strong><code>createdAt</code></strong>: The date and time when the user account was created.</li><li><strong><code>extraInfo</code></strong>: Extra information associated with the user account, stored as a JSON dictionary converted into a <code>Map<span>&lt;</span>String<span>,</span> Any<span>&gt;</span></code> instance. The kind of information stored in this value depends on the identity provider.</li></ul><h3 id="User-metadata">User metadata</h3><p>You‚Äôll find the <strong><em>user metadata</em></strong> when you scroll to the bottom of the app‚Äôs screen:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/37PCpShh5k6zBisyuGBSwB/94292112593866a6b16c32915dfacae3/android_app_user_metadata.png" alt="The bottom portion of the app‚Äôs main screen, with the user metadata highlighted"/></p><p>The user metadata is a set of attributes about the user that <em>don‚Äôt</em> affect the app‚Äôs core functionality. The user should be able to view and modify this information, and as such, it‚Äôs typically used to store user preferences and settings.</p><p>The Auth0 tenant sends user metadata as a JSON dictionary, which the Android library converts into a <code>Map<span>&lt;</span>String<span>,</span> Any<span>&gt;</span></code> object.</p><p>The app displays the user metadata object and lets the user enter or edit two values stored within it: their country and favorite color.</p><h3 id="App-metadata">App metadata</h3><p>Below the user metadata, you‚Äôll find the <strong><em>app metadata</em></strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1NztLfAuwenc5wVuXDp1vJ/f365655a7a45a9154acfb2374a5b0ad6/android_app_app_metadata.png" alt="The bottom portion of the app‚Äôs main screen, with the app metadata highlighted"/></p><p>Unlike the user metadata, the app metadata is a set of attributes about the user that <em>do</em> affect the app‚Äôs core functionality. This includes information such as:</p><ul><li>The user‚Äôs status (e.g., if the user is using the app on a trial basis or is a paying customer)</li><li>The user‚Äôs state. In a workplace app, this might be a flag representing whether the user completed a mandatory step. In a game app, this could be the user‚Äôs score and the level they reached in their last session.</li><li>Other information determining what features or activities should be available to the user.</li></ul><p>The Auth0 tenant sends app metadata as a JSON dictionary, which the Android library converts into a <code>Map<span>&lt;</span>String<span>,</span> Any<span>&gt;</span></code> object.</p><h2 id="Prerequisites">Prerequisites</h2><p>You‚Äôll need the following for this coding exercise:</p><h3 id="What-you-ll-need">What you‚Äôll need</h3><ul><li><strong>An Android development setup.</strong> Make sure you have the following, in the order given below:
  <ul><li><a href="https://www.oracle.com/java/technologies/javase-jdk16-downloads.html" target="_blank" rel="noreferrer noopener"><strong>Java SE Developer Kit (JDK), version 11 or later.</strong></a> You can find out which version is on your computer by opening a command-line interface and entering java --version.</li><li><a href="https://developer.android.com/studio" target="_blank" rel="noreferrer noopener"><strong>Android Studio,</strong></a> version 3.6 (February 2020) or later. I used the current stable version of Android Studio when writing this article: version 2020.3.1, also known as ‚ÄúArctic Fox‚Äù.</li><li><strong>At least one Android SDK (Software Development Kit) platform.</strong> You can confirm that you have one (and install one if you don‚Äôt) in Android Studio. Open <strong>Tools</strong> ‚Üí <strong>SDK Manager</strong>. You‚Äôll see a list of Android SDK platforms. Make sure that the current SDK (<strong>Android 11.0 (R)</strong> at the time of writing) is checked; if it isn‚Äôt, check it, click the <strong>Apply</strong> button, and click the <strong>OK</strong> button in the confirmation dialog that appears. Wait for the SDK platform to install and click the <strong>Finish</strong> button when installation is complete.</li></ul></li><li><strong>An Android device, real or virtual:</strong>
  <ul><li><strong>Using a real device:</strong> Connect the device to your computer with a USB cable. Make sure that your device has Developer Options and USB debugging enabled.</li><li><strong>Using a virtual device:</strong> Using Android Studio, you can build a virtual device (emulator) that runs on your computer. Here‚Äôs my recipe for a virtual device that simulates a current-model inexpensive Android phone:
 <ol start="1"><li>Open <strong>Tools ‚Üí AVD Manager</strong> (AVD is short for ‚ÄúAndroid Virtual Device‚Äù). The <strong>Your Virtual Devices</strong> window will appear. Click the <strong>Create Virtual Device...</strong> button.</li><li>The <strong>Select Hardware</strong> window will appear. In the <strong>Phone</strong> category, select <strong>Pixel 3a</strong> and click the <strong>Next</strong> button.</li><li>The <strong>System Image</strong> window will appear, and you‚Äôll see a list of Android versions. Select <strong>R</strong> (API 30, also known as Android 11.0). If you see a <strong>Download</strong> link beside R, click it, wait for the OS to download, then click the <strong>Finish</strong> button. Then click the <strong>Next</strong> button.</li><li>The <strong>Android Virtual Device (AVD)</strong> window will appear. The <strong>AVD Name</strong> field should contain <strong>Pixel 3a API 30</strong>, the two rows below it should have the titles <strong>Pixel 3a</strong> and <strong>R</strong>, and in the <strong>Startup orientation</strong> section, <strong>Portrait</strong> should be selected. Click the <strong>Finish</strong> button.</li><li>You will be back at the <strong>Your Virtual Devices</strong> window. The list will now contain <strong>Pixel 3a API 30</strong>, and that device will be available to you when you run the app.</li></ol></li></ul></li><li><strong>An Auth0 account.</strong> If you don‚Äôt have one, <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one now</a> ‚Äî you‚Äôll need it in the next step.</li></ul><h2 id="Download--Configure-and-Run-the-Starter-Project">Download, Configure and Run the Starter Project</h2><h3 id="Download-the-starter-project">Download the starter project</h3><p>I wanted to keep the focus of this tutorial on the user profile, user metadata, and app metadata in this tutorial. To do this, I‚Äôve provided a starter project that incorporates authentication and provides a functioning user interface. By starting with this pre-made project, you‚Äôll be able to focus your attention on accessing user information.</p><p>The starter project is in <a href="https://github.com/auth0-blog/auth0-android-user-demo/tree/starter" target="_blank" rel="noreferrer noopener">the <em>starter</em> branch</a>, and [you can download its .zip file here.]</p><p>üõ† <a href="https://github.com/auth0-blog/auth0-android-user-demo/archive/refs/heads/starter.zip" target="_blank" rel="noreferrer noopener">Download the .zipped starter project</a> and unzip it or clone it from <a href="https://github.com/auth0-blog/auth0-android-user-demo/tree/starter" target="_blank" rel="noreferrer noopener">the <em>starter</em> branch of this tutorial‚Äôs GitHub repository.</a></p><h3 id="Configure-the-starter-project">Configure the starter project</h3><p>Since the app delegates authentication to Auth0, you need to do some configuration in the Auth0 dashboard and within the app. Let‚Äôs do this now.</p><h4 id="Configure-the-project-on-the-Auth0-dashboard">Configure the project on the Auth0 dashboard</h4><p>In this configuration step, you‚Äôll register the Android app with Auth0, get two key pieces of information you‚Äôll need to enter into the app and specify how Auth0 should notify your app when a user has logged in and logged out.</p><p>üõ† Log into your Auth0 account and create a new <strong>Native</strong> application for this project with the name <strong>Android User Demo</strong>.</p><p>üõ† Go to the <strong>Settings</strong> tab for your newly-created application and find the <strong>Domain</strong> and <strong>Client ID</strong> fields. Make of note of their values; you‚Äôll use them shortly.</p><p>üõ† Scroll down to the <strong>Application URIs</strong> section. This is where you provide two pieces of information that Auth0 needs to know about your app, which are:</p><ol start="1"><li>One or more <strong>Allowed Callback URLs</strong>: the URLs that Auth0 will redirect to after the user successfully logs in.</li><li>One or more <strong>Allowed Logout URLs</strong>: the URL that Auth0 will redirect to after the user logs out.</li></ol><p>Auth0 uses these values even though Android apps don‚Äôt use web pages and URLs, but <a href="http://tutorials.jenkov.com/android/activity.html" target="_blank" rel="noreferrer noopener">activities</a> and <a href="https://developer.android.com/guide/components/intents-filters" target="_blank" rel="noreferrer noopener">intents</a> instead. </p><p>In the case of native applications, the callback and logout URLs are the same string, and Auth0 sends that string to your app to inform it that a user has logged in or logged out. For Android native apps, the string follows this format:</p><pre><code><span>{</span><span>SCHEME</span><span>}</span><span>:</span><span>/</span><span>/</span><span>{</span><span>YOUR_DOMAIN</span><span>}</span><span>/</span>android<span>/</span><span>{</span><span>YOUR_APP_PACKAGE_NAME</span><span>}</span><span>/</span>callback</code></pre><p>üõ† Construct the string that goes into the <strong>Allowed Callback URLs</strong> and <strong>Allowed Logout URLs</strong> by doing the following:</p><ul><li>Replace <code><span>{</span><span>SCHEME</span><span>}</span></code> with app. <code><span>{</span><span>SCHEME</span><span>}</span></code> is the URL‚Äôs protocol. If you were writing a web app, this value would be <code>http</code>, or better, <code>https</code>. Since this is an Android native app, you can pick any string for this value. I like to use <code>app</code>.</li><li>Replace <code><span>{</span><span>YOUR_DOMAIN</span><span>}</span></code> with your tenant‚Äôs domain, which was in the <strong>Domain</strong> field that you saw earlier on this page.</li><li>Replace <code><span>{</span><span>YOUR_APP_PACKAGE_NAME</span><span>}</span></code> with <code>com<span>.</span>example<span>.</span>auth0userdemo</code>, which is the package name of the Android starter project app.</li></ul><p>üõ† Save your changes by clicking the <strong>Save Changes</strong> button at the bottom of the page.</p><p>üõ† If there are no users in your tenant, create one now ‚Äî you‚Äôll need one to log into the app. Do this by clicking on <strong>User Management</strong> in the dashboard‚Äôs left side menu and then clicking on <strong>Users</strong> in the submenu that appears. Click the <strong>Create User</strong> button and create a new user by providing a name and password and selecting <strong>Username-Password-Authentication</strong> for that user‚Äôs <strong>Connection</strong>.</p><h4 id="Configure-the-project-within-the-app">Configure the project within the app</h4><p>In this configuration step, you‚Äôll provide the app with the two key pieces of information that you got from the Auth0 dashboard in the previous step.</p><p>üõ† Open the <code>auth0<span>.</span>xml</code> file in the app project. If you set Android Studio‚Äôs <strong>Project</strong> pane menu to <strong>Android</strong>, you‚Äôll find it in the <code>app<span>/</span>res<span>/</span>values</code> folder:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7izDgt1UVL4ONX0pflG53I/c06a7b6c5474955cc7e4078f4393e82b/open_this_file.png" alt="Android app structure with ‚Äúauth0.xml‚Äù file highlighted"/></p><p>When you open the file, you‚Äôll see this:</p><pre><code><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span><span><span>&lt;</span>resources</span><span>&gt;</span></span>

    <span>&lt;!--
    Auth0 identifiers
    ===========================
    Your tenant‚Äôs domain and your app client ID grant access to your Auth0 tenant.
    Don‚Äôt check this file into public version control without sanitizing its values first!
    --&gt;</span>

    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>com_auth0_domain<span>&#34;</span></span><span>&gt;</span></span>Insert your Auth0 tenant‚Äôs domain here.<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>com_auth0_client_id<span>&#34;</span></span><span>&gt;</span></span>Insert your app‚Äôs Auth0 client ID here.<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

<span><span><span>&lt;/</span>resources</span><span>&gt;</span></span></code></pre><p>üõ† Replace <code>Insert your Auth0 tenant‚Äôs domain here<span>.</span></code> with your tenant‚Äôs domain and <code>Insert your app‚Äôs Auth0 client <span>ID</span> here<span>.</span></code> with your app‚Äôs client ID.</p><h3 id="Run-the-starter-project">Run the starter project</h3><p>Now that you‚Äôve configured the project, it‚Äôs time to confirm that the app works.</p><p>üõ† Select an emulator or device, run the app, and log in using any of the users registered with your tenant. The app should look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/49fkmY5hT4nQ4IJTx4g5uB/6ae0ba673e28049f8dc02699dd43814a/initial_android_app_-_part_1.png" alt="The top portion of the app‚Äôs main screen, with every user data field blank"/></p><p>If you scroll to the bottom of the screen, you‚Äôll see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6t8embEKnIVBaXjiKOWBuS/05c81d30e2aeadd9061fd49d09073632/initial_android_app_-_part_2.png" alt="The bottom portion of the app‚Äôs main screen, with the user metadata and app metadata fields blank"/></p><p>The authentication part of the app works. It‚Äôs performed by the <code><span>login</span><span>(</span><span>)</span></code> method, shown below with additional numbered comments:</p><pre><code><span>private</span> <span>fun</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
  WebAuthProvider  <span>// 1  </span>
    <span>.</span><span>login</span><span>(</span>account<span>)</span> <span>// 2</span>
    <span>.</span><span>withScheme</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_scheme<span>)</span><span>)</span> <span>// 3</span>
    <span>.</span><span>withScope</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_scopes<span>)</span><span>)</span>  <span>// 4</span>
    <span>.</span><span>withAudience</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_audience<span>,</span>  <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_domain<span>)</span><span>)</span><span>)</span> <span>// 5</span>
    <span>.</span><span>start</span><span>(</span><span>this</span><span>,</span> <span>object</span> <span>:</span> Callback<span>&lt;</span>Credentials<span>,</span> AuthenticationException<span>&gt;</span> <span>{</span> <span>// 6</span>
    
      <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> AuthenticationException<span>)</span> <span>{</span>
        <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_failure_message<span>,</span> exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
      <span>}</span>

      <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>credentials<span>:</span> Credentials<span>)</span> <span>{</span>
        cachedCredentials <span>=</span> credentials
        <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_success_message<span>,</span> credentials<span>.</span>accessToken<span>)</span><span>)</span>
        
        <span>// TODO: Get the user‚Äôs profile information</span>

        <span>updateUI</span><span>(</span><span>)</span>
      <span>}</span>
    <span>}</span><span>)</span>
<span>}</span></code></pre><p>Here‚Äôs a quick overview of what‚Äôs happening in <code><span>login</span><span>(</span><span>)</span></code>. The list item numbers correspond to the numbered comments in the code above:</p><ol start="1"><li><code>WebAuthProvider</code> is a class in the Auth0 Android library.  It provides Auth0‚Äôs web page-based login to the app. The app uses this to log the user in via a login page in a web browser and log the user out.</li><li><code><span>login</span><span>(</span><span>)</span></code> initiates the login process and specifies the Auth0 account used by the application.</li><li><code><span>withScheme</span><span>(</span><span>)</span></code> specifies the scheme to use for the URL that Auth0 redirects to after a successful login. For web apps, the scheme is <code>http</code> or <code>https</code>. This value is arbitrary for native mobile apps, so we use <code>app</code> to make it clear to other developers and other people who may use the Auth0 settings for this app that the redirect is not to a web page.</li><li><code><span>withScope</span><span>(</span><span>)</span></code> specifies which sets of user data the app is authorized to use if the user logs in successfully. The OpenID Connect and OAuth frameworks, on which Auth0‚Äôs authentication and authorization are based, use the term scope to represent the authorization to access user‚Äôs data and resources. The method takes a space-delimited string as its argument, where each ‚Äúword‚Äù in the string specifies a different scope. The string used in this app contains these scopes:
 <ul><li><code>openid</code>: Indicates that application that uses OpenID Connect for authentication. This is the only required scope; all other scopes are optional.
<ul><li><code>profile</code>: Authorizes the application to access basic user profile information, including first name, surname, nickname, their photo or avatar, and so on.</li><li><code>email</code>: Authorizes the application to access the user‚Äôs email address.</li><li><code>read<span>:</span>current_user</code>: Authorizes the application with read-only access to the current_user claim.</li><li><code>update<span>:</span>current_user_metadata</code>: Authorizes the application with read and write access to the <code>current_user_metadata</code> claim. This scope allows us to get and set values in the user‚Äôs metadata.</li></ul></li></ul></li><li><code><span>withAudience</span><span>(</span><span>)</span></code> specifies the URL that the app will use to connect to Auth0‚Äôs login service. This URL is constructed using the domain of the Auth0 tenant used by the app and the endpoint for the Auth0 authentication API.</li><li><code><span>start</span><span>(</span><span>)</span></code> takes the <code>WebAuthProvider</code> object constructed by all the previous methods in the chain and opens the browser window to display the login page. It takes two parameters: a context (a reference to the <code>Activity</code> that‚Äôs initiating the browser window) and an anonymous object with two callback methods:
<ul><li><code><span>onFailure</span><span>(</span><span>)</span></code>: Defines what should happen if the user returns from the browser login screen without successfully logging in. This typically happens when the user closes the browser login screen or taps the ‚Äúback‚Äù button while on that screen. The app displays a <code>SnackBar</code> that notifies the user that login failed, followed by an error code.</li><li><code><span>onSuccess</span><span>(</span><span>)</span></code>: Defines what should happen if the user returns from the browser login screen after successfully logging in. The app processes the successful response, displays a <code>SnackBar</code> notifying the user that login was successful, and updates the UI to its ‚Äúlogged in‚Äù state.</li></ul></li></ol><p>üõ† Note that <code><span>onSuccess</span><span>(</span><span>)</span></code> contains the following comment:</p><pre><code><span>// TODO: Get the user‚Äôs profile information</span></code></pre><p>üõ† Replace that comment with the following:</p><pre><code><span>getUserProfile</span><span>(</span><span>)</span></code></pre><p>If you look just below <code><span>login</span><span>(</span><span>)</span></code>, you‚Äôll see three empty methods:</p><pre><code><span>private</span> <span>fun</span> <span>getUserProfile</span><span>(</span><span>)</span> <span>{</span>
  <span>// TODO: Implement this method!</span>
<span>}</span>

<span>private</span> <span>fun</span> <span>getUserMetadata</span><span>(</span><span>)</span> <span>{</span>
  <span>// TODO: Implement this method!</span>
<span>}</span>

<span>private</span> <span>fun</span> <span>setUserMetadata</span><span>(</span><span>)</span> <span>{</span>
  <span>// TODO: Implement this method!</span>
<span>}</span></code></pre><p>In this tutorial, you‚Äôll fill these empty methods, starting with <code><span>getUserProfile</span><span>(</span><span>)</span></code>, which will retrieve the user‚Äôs profile, including their basic user profile information.</p><h2 id="Get-the-User-Profile-Information-and-Display-It">Get the User Profile Information and Display It</h2><p>Let‚Äôs add code to <code><span>getUserProfile</span><span>(</span><span>)</span></code> a little bit at a time. I‚Äôll explain what each bit of code does after you enter it.</p><p>üõ† Update the <code><span>getUserProfile</span><span>(</span><span>)</span></code> method to the following:</p><pre><code><span>private</span> fun <span>getUserProfile</span><span>(</span><span>)</span> <span>{</span>
  <span>// Guard against showing the profile the user isn‚Äôt logged in</span>
  <span>if</span> <span>(</span>cachedCredentials <span>==</span> <span>null</span><span>)</span> <span>{</span>
    <span>return</span>
  <span>}</span>
  
<span>}</span></code></pre><p>This tests to see if the <code>cachedCredentials</code> property contains a <code>Credentials</code> instance. We need that instance to retrieve the user profile. If it‚Äôs not there, it‚Äôs better to exit this method immediately.</p><p>üõ† Add the following code to <code><span>getUserProfile</span><span>(</span><span>)</span></code>:</p><pre><code><span>val</span> client <span>=</span> <span>AuthenticationAPIClient</span><span>(</span>account<span>)</span></code></pre><p>The line above creates an instance of <code>AuthenticationAPIClient</code>, an object for contacting the Auth0 API for account information. This object will be used to request the user‚Äôs profile information.</p><p>üõ† Add the following code to complete <code><span>getUserProfile</span><span>(</span><span>)</span></code>:</p><pre><code>client
  <span>.</span><span>userInfo</span><span>(</span>cachedCredentials<span>!!</span><span>.</span>accessToken<span>!!</span><span>)</span>
  <span>.</span><span>start</span><span>(</span><span>object</span> <span>:</span> Callback<span>&lt;</span>UserProfile<span>,</span> AuthenticationException<span>&gt;</span> <span>{</span>
  
      <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> AuthenticationException<span>)</span> <span>{</span>
      <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
        exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
    <span>}</span>

    <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>userProfile<span>:</span> UserProfile<span>)</span> <span>{</span>
      cachedUserProfile <span>=</span> userProfile
      <span>getUserMetadata</span><span>(</span><span>)</span>
      <span>updateUI</span><span>(</span><span>)</span>
    <span>}</span>

  <span>}</span><span>)</span></code></pre><p>This is the code that makes the request for the user‚Äôs profile information.</p><p>It calls <code>AuthenticationAPIClient</code> ‚Äôs <code><span>userInfo</span><span>(</span><span>)</span></code> method to create a request for the user‚Äôs profile information. This method requires a valid access token, which it extracts from the <code>cachedCredentials</code> property. It returns a <code>Request</code> object.</p><p>The <code>Request</code> object‚Äôs <code><span>start</span><span>(</span><span>)</span></code> method transmits the user profile request to Auth0. In using it, you need to provide two callback methods:</p><ul><li><code><span>onFailure</span><span>(</span><span>)</span></code>, which is called if the request for user profile information did not succeed. When this happens, the app displays a <code>SnackBar</code> that tells the user that an exception occurred and displays a little debugging information.</li><li><code><span>onSuccess</span><span>(</span><span>)</span></code>, which is called if the request for user profile information succeeds. When this happens, the app receives a <code>UserProfile</code> object and copies it into the <code>cachedUserProfile</code> property. The app then calls <code><span>getUserMetadata</span><span>(</span><span>)</span></code> (which currently does nothing) and then updates the UI to display the newly-received information.</li></ul><p>üõ† Run the app and log in. This time, you‚Äôll see that most of the fields in the <strong>User Data</strong> section are now filled in:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/fasfyKr8mXqoDb2BvLSRF/9cb3efb22c3bb3082afa456849bd669e/android_user_profile_enabled_-_part_1.png" alt="The top portion of the app‚Äôs main screen, with the user data fields filled out"/></p><p>Here‚Äôs what the lower part of the screen looks like:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/FCFIDeEBBRaoNP2lfBO1C/6e21780b71f1db94d3b2ddfd977ac63c/android_user_profile_enabled_-_part_2.png" alt="The bottom portion of the app‚Äôs main screen, with the ‚ÄòcreatedAt‚Äô, user metadata and app metadata fields not filled"/></p><p>If you look at the <code><span>updateUI</span><span>(</span><span>)</span></code> method, you‚Äôll see that that it calls the <code><span>updateUserInfoUI</span><span>(</span><span>)</span></code> method. <code><span>updateUserInfoUI</span><span>(</span><span>)</span></code> accesses the user profile-related properties of <code>cachedUserProfile</code> and displays them onscreen. </p><p>Note that the <code>createdAt</code> property is <code><span>null</span></code>. That‚Äôs because this information hasn‚Äôt been retrieved yet. That happens in the next step when we retrieve the metadata.</p><h3 id="Implement--getUserMetadata---">Implement <code><span>getUserMetadata</span><span>(</span><span>)</span></code></h3><p>Let‚Äôs add code to <code><span>getUserMetadata</span><span>(</span><span>)</span></code> a little bit at a time. It‚Äôs similar to the code in <code><span>getUserProfile</span><span>(</span><span>)</span></code>. I‚Äôll explain what each bit of code does after you enter it.</p><p>üõ† Update the <code><span>getUserMetadata</span><span>(</span><span>)</span></code> method to the following:</p><pre><code><span>private</span> <span>fun</span> <span>getUserMetadata</span><span>(</span><span>)</span> <span>{</span>
  <span>// Guard against getting the metadata when no user is logged in</span>
  <span>if</span> <span>(</span>cachedCredentials <span>==</span> <span>null</span> <span>||</span> cachedUserProfile <span>==</span> <span>null</span><span>)</span> <span>{</span>
    <span>return</span>
  <span>}</span>
  
<span>}</span></code></pre><p>This tests to see if the <code>cachedCredentials</code> property contains a <code>Credentials</code> instance <em>and</em> the <code>cachedUserProfile</code> property contains a <code>UserProfile</code> instance. We need both instances to retrieve the metadata. If both aren‚Äôt there, it‚Äôs better to exit this method immediately.</p><p>üõ† Add the following code to <code><span>getUserMetadata</span><span>(</span><span>)</span></code>:</p><pre><code><span>val</span> usersClient <span>=</span> <span>UsersAPIClient</span><span>(</span>account<span>,</span> cachedCredentials<span>!!</span><span>.</span>accessToken<span>!!</span><span>)</span></code></pre><p>The line above creates an instance of <code>UsersAPIClient</code>, an object for contacting the Auth0 API for additional account information. Creating this instance requires a valid access token, which it extracts from the <code>cachedCredentials</code> property.</p><p>üõ† Add the following code to complete <code><span>getUserMetadata</span><span>(</span><span>)</span></code>:</p><pre><code>usersClient
  <span>.</span><span>getProfile</span><span>(</span>cachedUserProfile<span>!!</span><span>.</span><span>getId</span><span>(</span><span>)</span><span>!!</span><span>)</span>
  <span>.</span><span>start</span><span>(</span><span>object</span> <span>:</span> Callback<span>&lt;</span>UserProfile<span>,</span> ManagementException<span>&gt;</span> <span>{</span>
  
    <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> ManagementException<span>)</span> <span>{</span>
      <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
        exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
    <span>}</span>

    <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>userProfile<span>:</span> UserProfile<span>)</span> <span>{</span>
      cachedUserProfile <span>=</span> userProfile
      <span>updateUI</span><span>(</span><span>)</span>
    <span>}</span>

  <span>}</span><span>)</span></code></pre><p>This is the code that makes the request for the metadata associated with the user.</p><p>It calls <code>UsersAPIClient</code>‚Äôs <code><span>getProfile</span><span>(</span><span>)</span></code> method to create a request for additional user information information. This method requires the user‚Äôs unique identifier, which it extracts from the <code>cachedUserProfile</code> property. It returns a <code>Request</code> object.</p><p>The <code>Request</code> object‚Äôs <code><span>start</span><span>(</span><span>)</span></code> method transmits the additional information request to Auth0. In using it, you need to provide two callback methods:</p><ul><li><code><span>onFailure</span><span>(</span><span>)</span></code>, which is called if the request for additional information did not succeed. When this happens, the app displays a <code>SnackBar</code> that tells the user that an exception occurred and displays a little debugging information.</li><li><code><span>onSuccess</span><span>(</span><span>)</span></code>, which is called if the request for additional information succeeds. When this happens, the app receives a <code>UserProfile</code> object containing both the user profile information and the additional metadata. This object is copied into the <code>cachedUserProfile</code> property. The app then updates the UI to display the newly-received information.</li></ul><h3 id="Provide-some-metadata-for-the-app-to-display">Provide some metadata for the app to display</h3><p>The app can now display the user metadata and the app metadata associated with the user‚Äôs account, but there‚Äôs a problem: there‚Äôs no metadata to show! One way to solve this problem is to edit that metadata manually in the Auth0 dashboard.</p><p>üõ† Open the user page for the user you intend to use when logging into the app. Do this by clicking on <strong>User Management</strong> in the dashboard‚Äôs left side menu, then <strong>Users</strong> in the submenu that appears, and finally the user.</p><p>Scroll halfway down the page until you see the <strong>Metadata</strong> section. It should look like the screenshot below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3j0OxAAVDZU4r7NIVUOHqN/c26bddccf3f99082207298c843af8cba/Auth0_dashboard_-_empty_metadata_section_of_user_page.png" alt="The user‚Äôs metadata in the Auth0 dashboard, showing that there is no user metadata or app metadata"/></p><p>Unless you‚Äôve already played around with the user‚Äôs metadata, both the <strong>User_metadata</strong> and <strong>app_metadata</strong> fields should be empty.</p><p>üõ† Update the contents of the <strong>user_metadata</strong> field to the following:</p><pre><code><span>{</span>
  <span>&#34;country&#34;</span><span>:</span> <span>&#34;New Zealand&#34;</span><span>,</span>
  <span>&#34;favorite_color&#34;</span><span>:</span> <span>&#34;blue&#34;</span>
<span>}</span></code></pre><p>üõ† Update the contents of the <strong>app_metadata</strong> field to the following:</p><pre><code><span>{</span>
  <span>&#34;reward_points&#34;</span><span>:</span> <span>5.0</span>
<span>}</span></code></pre><p>üõ† Click the <strong>Save button</strong> just below <strong>app_metadata</strong> field.</p><p>Now that there‚Äôs metadata associated with the user let‚Äôs see what it looks like in the app!</p><p>üõ† Run the app, log in, and scroll to the bottom of the screen. This time, you‚Äôll see that all the fields in the <strong>User Data</strong>, <strong>User Metadata</strong>, and <strong>App Metadata</strong> sections are filled in:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3N6Z5t8RECsTPhcguMtXwp/92db27d1e7d06f289e1c789312009c06/android_user_-_getmetadata_enabled.png" alt="The bottom portion of the app‚Äôs main screen, with ‚ÄúNew Zealand‚Äù in the ‚Äúcountry‚Äù field and ‚Äúblue‚Äù in the ‚Äúfavorite_color‚Äù field, and ‚Äú{reward_points=5.0}‚Äù in the ‚Äúapp_metadata‚Äù field"/></p><h3 id="A-few-things-worth-noting">A few things worth noting</h3><h4 id="Some-differences-in-the-user-profile-information">Some differences in the user profile information</h4><p>You may have noticed some changes in the last two fields in the <strong>User Data</strong> section:</p><ol start="1"><li>The <strong>createdAt</strong> field no longer displays <code><span>null</span></code> but instead shows the date and time when the user‚Äôs Auth0 account was created.</li><li>The <strong>extra info</strong> field displays more information now that the app is retrieving both user profile information and metadata:
 <ul><li><code>last_ip</code>: The IP address from which the user last logged in.</li><li><code>last_login</code>: The date and time when the user last logged in.</li><li><code>logins_count</code>: The number of times the user logged in.</li></ul></li></ol><p>Your app can access the <strong>extra info</strong> information by calling on <code>cachedUserProfile</code> ‚Äôs <code><span>getExtraInfo</span><span>(</span><span>)</span></code> method, which returns these values as a <code>Map<span>&lt;</span>String<span>,</span> Any<span>&gt;</span></code> object.</p><h4 id="-cachedUserProfile-"><code>cachedUserProfile</code></h4><p>You may also have noticed that the <code>cachedUserProfile</code> property gets set <em>twice</em>:</p><ol start="1"><li><code>cachedUserProfile</code> is set first in the <code><span>getUserProfile</span><span>(</span><span>)</span></code> method when the app provides Auth0 with an access token and gets a <code>UserProfile</code> object in response. This <code>UserProfile</code> object contains only the user profile information and none of the metadata. If this method succeeds in getting the user profile information, it calls the <code><span>getUserMetadata</span><span>(</span><span>)</span></code> method.</li><li><code>cachedUserProfile</code> is set again immediately after in the <code><span>getUserMetadata</span><span>(</span><span>)</span></code> method, when the app provides Auth0 with the user‚Äôs ID (which it gets from the cached <code>UserProfile</code> object) and gets another <code>UserProfile</code> object in response. When <code><span>getUserMetadata</span><span>(</span><span>)</span></code> completes successfully, <code>cachedUserProfile</code> contains <em>both</em> the user profile information <em>and</em> the metadata.</li></ol><p>Simply put, you need to fetch the user‚Äôs profile information twice in order to get all the information associated with the user. This is because you need the user‚Äôs ID in order to retrieve their metadata, and the user‚Äôs ID comes from the user‚Äôs profile!</p><p>There‚Äôs one last bit of functionality that you need to code: the ability for the user to edit their user metadata. Remember that anything stored in the user metadata should be both user-<em>readable</em> and user-<em>editable</em>.</p><p>Let‚Äôs add code to <code><span>setUserMetadata</span><span>(</span><span>)</span></code>, which is called when the user presses the <strong>Set User Metadata</strong> button. It‚Äôs similar to the code in <code><span>getUserMetadata</span><span>(</span><span>)</span></code>. We‚Äôll enter the code a little bit at a time; I‚Äôll explain what each bit of code does after you enter it.</p><p>üõ† Update the <code><span>setUserMetadata</span><span>(</span><span>)</span></code> method to the following:</p><pre><code><span>private</span> <span>fun</span> <span>setUserMetadata</span><span>(</span><span>)</span> <span>{</span>
  <span>// Guard against getting the metadata when no user is logged in</span>
  <span>if</span> <span>(</span>cachedCredentials <span>==</span> <span>null</span><span>)</span> <span>{</span>
    <span>return</span>
  <span>}</span>
  
<span>}</span></code></pre><p>Once again, this is a test to confirm that <code>cachedCredentials</code> contains a <code>Credentials</code> object, which has access token. We need the access token to make changes to the user metadata.</p><p>üõ† Add the following code to <code><span>setUserMetadata</span><span>(</span><span>)</span></code>:</p><pre><code><span>val</span> usersClient <span>=</span> <span>UsersAPIClient</span><span>(</span>account<span>,</span> cachedCredentials<span>!!</span><span>.</span>accessToken<span>!!</span><span>)</span>
<span>val</span> metadata <span>=</span> <span>mapOf</span><span>(</span>
  <span>&#34;country&#34;</span> <span>to</span> binding<span>.</span>countryEdittext<span>.</span>text<span>.</span><span>toString</span><span>(</span><span>)</span><span>.</span><span>trim</span><span>(</span><span>)</span><span>,</span>
  <span>&#34;favorite_color&#34;</span> <span>to</span> binding<span>.</span>favoriteColorEdittext<span>.</span>text<span>.</span><span>toString</span><span>(</span><span>)</span><span>.</span><span>trim</span><span>(</span><span>)</span>
<span>)</span></code></pre><p>The code above starts the process of updating the user metadata. </p><p>Just as we did with <code><span>setUserMetadata</span><span>(</span><span>)</span></code>, we‚Äôre creating an instance of <code>UsersAPIClient</code> to contacting the Auth0 API about account information. This process requires a valid access token, which comes from the <code>cachedCredentials</code> property.</p><p>The code then creates a <code>Map</code> with two key-value pairs:</p><ul><li>The <code>country</code> key and its corresponding value, the contents of the <strong>country</strong>  <code>EditText</code> field.</li><li><ul><li>The <code>favorite_color</code> key and its corresponding value, the contents of the <strong>favorite_color</strong>  <code>EditText</code> field.</li></ul></li></ul><p>üõ† Add the following code to complete <code><span>setUserMetadata</span><span>(</span><span>)</span></code>:</p><pre><code>usersClient
  <span>.</span><span>updateMetadata</span><span>(</span>cachedUserProfile<span>!!</span><span>.</span><span>getId</span><span>(</span><span>)</span><span>!!</span><span>,</span> metadata<span>)</span>
  <span>.</span><span>start</span><span>(</span><span>object</span> <span>:</span> Callback<span>&lt;</span>UserProfile<span>,</span> ManagementException<span>&gt;</span> <span>{</span>

    <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> ManagementException<span>)</span> <span>{</span>
      <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>
      R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span> exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
    <span>}</span>

    <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>profile<span>:</span> UserProfile<span>)</span> <span>{</span>
      cachedUserProfile <span>=</span> profile
      <span>updateUI</span><span>(</span><span>)</span>
      <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_success_message<span>)</span><span>)</span>
    <span>}</span>

  <span>}</span><span>)</span></code></pre><p>This is the code that makes the request to update the user‚Äôs user metadata.</p><p>It calls <code>UsersAPIClient</code>‚Äôs <code><span>updateMetadata</span><span>(</span><span>)</span></code> method, whose name is also its job. This method requires the user‚Äôs unique identifier, which it extracts from the <code>cachedUserProfile</code> property. It returns a <code>Request</code> object.</p><p>The <code>Request</code> object‚Äôs <code><span>start</span><span>(</span><span>)</span></code> method transmits the update request to Auth0. In using it, you need to provide two callback methods:</p><ul><li><code><span>onFailure</span><span>(</span><span>)</span></code>, which is called if the request to update the user metadata did not succeed. When this happens, the app displays a <code>SnackBar</code> that tells the user that an exception occurred and displays a little debugging information.</li><li><code><span>onSuccess</span><span>(</span><span>)</span></code>, which is called if the request to update the user metadata succeeded. When this happens, the app receives a <code>UserProfile</code> object containing both the user profile information and the updated metadata. This object is copied into the <code>cachedUserProfile</code> property. The app then updates the UI to display the updated information.</li></ul><p>üõ† Run the app, log in, and scroll to the bottom of the screen. Change the values of both the <strong>country</strong> and <strong>favorite_color</strong> text fields and press the <strong>Set User Metadata</strong> button.</p><p>Check the <strong>user_metadata</strong> field. You‚Äôll see that its values have been updated:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5pn1O2uSNV6cJUidWcgD0c/a315c93af62828f4c9f9e3547e800e36/android_user_-_setmetadata_enabled_-_app.png" alt="The bottom portion of the app‚Äôs main screen, with ‚Äúuser_metadata‚Äù updated, ‚ÄúMorocco‚Äù in the ‚Äúcountry‚Äù field, and ‚Äúorange‚Äù in the ‚Äúfavorite_color‚Äù field"/></p><p>You can also see the updated values in the <strong>Metadata</strong> section of the user‚Äôs page in the Auth0 dashboard:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/Yn73Z9KvqpNEaVLxgqBdO/d4c32703477d8e3b078d07717c69f6e8/updated_metadata_in_dashboard.png" alt="The user‚Äôs metadata in the Auth0 dashboard, showing the updated values"/></p><h2 id="Other-Ways-to-Change-User-Information">Other Ways to Change User Information</h2><p>The Android library limits the changes that an app can make to a user‚Äôs information to the user metadata. It doesn‚Äôt provide a way for apps to make changes to a user‚Äôs profile information or app metadata ‚Äî at least not directly.</p><p>However, there are cases when an app might need to change the information in the user‚Äôs profile, such as when they want to change their name or email address. There‚Äôs also the fact that while the user shouldn‚Äôt be able to change their app metadata, the app or its back end will need to do it.</p><p>For these cases, you can use the Auth0 Management API, which gives applications the ability to do anything you can do in the Auth0 dashboard, and even a little more. It‚Äôs one way to make changes to the user‚Äôs profile information or their metadata, and you can find out more on the Auth0 documentation page titled <a href="https://auth0.com/docs/users/metadata/manage-metadata-api" target="_blank" rel="noreferrer noopener"><em>Manage Metadata Using the Management API</em></a>.</p><p>You can also make changes to the user‚Äôs metadata using <a href="https://auth0.com/docs/actions" target="_blank" rel="noreferrer noopener">Actions</a>, which are a small bit of Node.js code that execute during certain events of the Auth0 workflow, such as when the user logs in, changes their password, registers for a user account, and more. </p><h2 id="Conclusion">Conclusion</h2><p>You now have an app that demonstrates how to access the various kinds of information associated with each user account:</p><p><strong>User profile:</strong> Very basic user identity data found in most user accounts, regardless of identity provider. It stores information such as the user‚Äôs various names, email address, and the URL for their picture.
<strong>User metadata:</strong>  Information about the user which the user can view and modify. The data should <em>not</em> affect the app‚Äôs core functionality. It‚Äôs most often used for storing preferences and settings.
<strong>App metadata:</strong> Information about the user that <em>does</em> affect the app‚Äôs core functionality and is usually ‚Äúbehind the scenes‚Äù and not directly shown to the user. It‚Äôs most often to store the user‚Äôs state.</p><p>Try experimenting and see how handy it can be to be able to access information about the user information directly from their Auth0 user account!</p><blockquote><p><a href="https://github.com/auth0-blog/auth0-android-user-demo" target="_blank" rel="noreferrer noopener">You can find this tutorial‚Äôs project on GitHub</a>. The starter project is in <a href="https://github.com/auth0-blog/auth0-android-user-demo/tree/starter" target="_blank" rel="noreferrer noopener">the <em>starter</em> branch</a>, and <a href="https://github.com/auth0-blog/auth0-android-user-demo/archive/refs/heads/starter.zip" target="_blank" rel="noreferrer noopener">you can download its .zip file here.</a> The finished project is in <a href="https://github.com/auth0-blog/auth0-android-user-demo/tree/main" target="_blank" rel="noreferrer noopener">the <em>main</em> branch</a> and <a href="https://github.com/auth0-blog/auth0-android-user-demo/archive/refs/heads/main.zip" target="_blank" rel="noreferrer noopener">you can download its .zip file here.</a></p></blockquote></div></div>]]></content:encoded>
      <pubDate>Thu, 16 Dec 2021 15:05:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Fine Grained Authorization: Developer Community Preview Release</title>
      <link>https://auth0.com/blog/auth0-fine-grained-authorization-developer-community-preview-release/</link>
      <description>We are excited to announce the Developer Community Preview for Auth0 Fine Grained Authorization (FGA), our upcoming SaaS to solve authorization-at-scale for developers.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><a href="https://auth0.com/intro-to-iam/authentication-vs-authorization/" target="_blank" rel="noreferrer noopener">Authentication is about who the user is. Authorization is about what they can do.</a></p><p>Historically, software applications have, in general, handled <a href="https://auth0.com/intro-to-iam/what-is-authorization/" target="_blank" rel="noreferrer noopener">authorization</a> in a coarse grained manner. A user has one or more roles in an application, which grants them permissions to perform certain actions across the application. This worked well for a while because users didn&#39;t create content in systems. As social and work collaboration applications become mainstream, a different kind of authorization became necessary: fine grained authorization.</p><p>An application implements fine grained authorization when it can determine a user&#39;s permission to perform actions on any object in the application, and users can create objects in the application and manage permissions to those objects.</p><p>This is &#34;fine grained&#34; because there is no lower limit to the granularity at which builders of the system can make authorization decisions. It is up to the builders of the system to determine how granular they want authorization to be, and up to the users of the system to determine who has specific permissions on objects.</p><h2 id="Why-Is-Fine-Grained-Authorization-Important-">Why Is Fine Grained Authorization Important?</h2><p>Fine grained authorization is increasingly becoming a critical element in software. For example:</p><ul><li><strong>Collaboration and social</strong> features are things users expect, such as the ‚ÄòShare‚Äô button you see in so many applications. This applies to both business-related assets, such as documents and project boards, and personal assets like pictures and home IoT devices. Specifically sharing one of these objects with another user is a Fine Grained Authorization use case.</li><li><strong>Security, compliance, and privacy</strong> are musts for any software application from day 1, and authorization is a big part of solving those concerns. In fact, the <a href="https://owasp.org/Top10/" target="_blank" rel="noreferrer noopener">TOP OWASP 2021 risk is broken access control</a>.</li></ul><p>However, solving authorization in an application is not a trivial matter. We believe applications solve authorization correctly if their authorization solution has the following characteristics:</p><ol start="1"><li><strong>Reviewable:</strong> It should be easy to determine &#34;who can access what,&#34; essentially understand the rules used to enforce access control.</li><li><strong>Easy to manage change:</strong> Authorization related changes must be explicit and traceable. Change management control for authorization is important.</li><li><strong>Auditable:</strong> It should be possible to know what happened with regards to authorization, in essence &#34;who tried to access what, and when?&#34;.</li><li><strong>Reliable:</strong> Authorization decisions are made as part of most flows/requests, so authorization components need to always be running and returning the expected results.</li><li><strong>Fast:</strong> Authorization decisions are made as part of most flows/requests, so they need to be fast. If authorization decisions are slow, then the end-user experience is slow as a whole.</li></ol><p>Implementing all of the above is complex, even with expertise. So we looked at how we could solve authorization for our customers, and allow them to focus on their core business. This is what led us to create <strong>Auth0 Fine Grained Authorization.</strong></p><h2 id="What-Is-Auth0-Fine-Grained-Authorization-">What Is Auth0 Fine Grained Authorization?</h2><p>Auth0 Fine Grained Authorization (FGA) is a SaaS to solve <strong>fine grained authorization at scale for developers</strong>. It is inspired by <a href="http://zanzibar.academy" target="_blank" rel="noreferrer noopener">Google Zanzibar</a>, the <a href="https://auth0.com/blog/auth0-introduces-zanzibar-academy/" target="_blank" rel="noreferrer noopener">system Google uses to solve authorization</a> across all their products, such as Google Drive, Youtube, Google Cloud, and others.</p><p>Auth0 FGA does not require you to be using Auth0 already. You can use Auth0 FGA with any identity provider: your own user database (e.g. MySQL, PostgreSQL), Auth0, Okta or anything else.</p><p>Auth0 FGA centralizes your authorization. It becomes your &#34;authorization (micro)service&#34; if you will. It&#39;s a single place for you to define your authorization model, store your authorization data and make your authorization decisions, across all your apps and products.</p><p>Centralizing your authorization logic and decisions into a single service that has the flexibility to handle use cases across your different products gives you distinct advantages:</p><ul><li><strong>Simplify security auditing:</strong> Explicit authorization rules are easier to audit by internal and external parties.</li><li><strong>Lower costs:</strong> Standardizing how authorization is done across your company makes it easier for developers to switch teams.</li><li><strong>Deliver faster:</strong> You‚Äôll be able to ship features and products faster, as the system is easily extensible to new requirements.</li><li><strong>Security logging:</strong> The Auth0 FGA service generates logs for all operations out-of-the-box, both reads and writes.</li><li><strong>Empower your users:</strong> Allow users to take control of granting access to their data directly in your application.</li><li><strong>Fast and reliable at scale:</strong> A centralized service dedicated to fine grained authorization should scale as your business and products grow. Since Auth0 FGA specializes in fine grained authorization and nothing else, it can be particularly optimized for access control patterns and use cases, improving the latency and reliability of your authorization approach.</li></ul><p>Auth0 FGA supports granting access at an atomic object level in any system, easily enabling collaboration between users, going far beyond typical role-based access control (RBAC). It also supports building custom roles into any system, empowering your customers to define how to manage access. Auditing capabilities provide fundamental building blocks for security and compliance teams. The more we‚Äôve spoken to customers about it, the more we‚Äôve learned just how many use cases it can solve for.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/21LaMJQrrDSNHmIEP2oWhO/17fd5e2a825a937590557973d59678b3/Uploaded_from_Auth0_Fine_Grained_Authorization__Developer_Community_Preview_Release" alt="Auth0 FGA"/></p><p>Organizations like <a href="https://medium.com/airbnb-engineering/himeji-a-scalable-centralized-system-for-authorization-at-airbnb-341664924574" target="_blank" rel="noreferrer noopener">AirBNB</a> and <a href="https://medium.com/building-carta/authz-cartas-highly-scalable-permissions-system-782a7f2c840f" target="_blank" rel="noreferrer noopener">Carta</a> have built <a href="https://zanzibar.academy/" target="_blank" rel="noreferrer noopener">Zanzibar-like</a> systems to solve their authorization needs. We don‚Äôt think organizations should build the same authorization tooling, again and again, so we set out to build one version everyone can use. We developed Auth0 FGA as a service so you don&#39;t have to.</p><h2 id="How-Do-I-Get-Started-">How Do I Get Started?</h2><p>To start using Auth0 FGA you need to do three things:</p><ol start="1"><li>Define your authorization model (<a href="https://docs.fga.dev/modeling" target="_blank" rel="noreferrer noopener">docs</a>)</li><li>Write authorization data from your system to Auth0 FGA (<a href="https://docs.fga.dev/writing-data" target="_blank" rel="noreferrer noopener">docs</a>)</li><li>Add authorization to your API by adding access control checks to your system (<a href="https://docs.fga.dev/integration" target="_blank" rel="noreferrer noopener">docs</a>)</li></ol><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"></path></svg><p><strong>Note:</strong><br/><b></b></p><p>The Developer Community Preview is meant to help us learn how customers use the product. If you have feedback, reach out on our <a href="https://discord.gg/6jsgXhVBu6" target="_blank" rel="noreferrer noopener">Community Discord</a>.<br/> </p></div><p>From that point on, all authorization decisions are centralized and made by Auth0 FGA. You can think of it as your &#34;authorization microservice.&#34;</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/tROyM1vl5FzzqImS1xjNU/d6a4a8f07e6aca48aed81f4aafadd821/Uploaded_from_Auth0_Fine_Grained_Authorization__Developer_Community_Preview_Release" alt="Auth0 FGA"/></p><h3 id="A-brief-example">A brief example</h3><p>Let&#39;s say you were to start from a Node.js API to manage projects. That API doesn&#39;t have authorization capabilities yet, but it does have authentication.</p><p>You have an endpoint that would return a particular project given its project ID. In that endpoint, you might have code like the one from the following snippet. The second line verifies the <a href="https://jwt.io/" target="_blank" rel="noreferrer noopener">JSON Web Token</a> (JWT) sent as part of the request to perform <a href="https://auth0.com/intro-to-iam/what-is-authentication/" target="_blank" rel="noreferrer noopener">authentication</a>, using <a href="https://www.npmjs.com/package/express-jwt" target="_blank" rel="noreferrer noopener">express-jwt</a>.</p><pre><code>app<span>.</span><span>get</span><span>(</span><span>&#39;/project/:id&#39;</span><span>,</span>
    <span>jwt</span><span>(</span><span>{</span> secret<span>:</span> <span>PUBLIC_KEY</span><span>,</span> algorithms<span>:</span> <span>[</span><span>&#39;RS256&#39;</span><span>]</span> <span>}</span><span>)</span><span>,</span>
    <span>// authorize access</span>
    <span>async</span> <span>function</span><span>(</span><span>req<span>,</span> res<span>,</span> next</span><span>)</span> <span>{</span>
        <span>// your business logic</span>
    <span>}</span>
<span>)</span><span>;</span></code></pre><p>Now we want to add <a href="https://auth0.com/docs/authorization" target="_blank" rel="noreferrer noopener">authorization</a> so only users that can <strong>read</strong> a project can call this endpoint.</p><p>First, we would install and setup the Auth0 Fine Grained Authorization Node.js SDK. You would need to obtain some data from your Auth0 Fine Grained Authorization account, and follow <a href="https://docs.fga.dev/integration/getting-your-api-keys" target="_blank" rel="noreferrer noopener">these steps</a> to get it.</p><pre><code><span>const</span> <span>{</span> Auth0FgaApi <span>}</span> <span>=</span> <span>require</span><span>(</span><span>&#39;@auth0/fga&#39;</span><span>)</span><span>;</span>

<span>const</span> auth0Fga <span>=</span> <span>new</span> <span>Auth0FgaApi</span><span>(</span><span>{</span>
  environment<span>:</span> <span>AUTH0_FGA_ENVIRONMENT</span><span>,</span>
  storeId<span>:</span> <span>AUTH0_FGA_STORE_ID</span><span>,</span>
  clientId<span>:</span> <span>AUTH0_FGA_CLIENT_ID</span><span>,</span>
  clientSecret<span>:</span> <span>AUTH0_FGA_CLIENT_SECRET</span><span>,</span>
<span>}</span><span>)</span><span>;</span>

<span>...</span>

app<span>.</span><span>get</span><span>(</span><span>&#39;/project/:id&#39;</span><span>,</span>
    <span>jwt</span><span>(</span><span>{</span> secret<span>:</span> <span>PUBLIC_KEY</span><span>,</span> algorithms<span>:</span> <span>[</span><span>&#39;RS256&#39;</span><span>]</span> <span>}</span><span>)</span><span>,</span>
    <span>function</span><span>(</span><span>req<span>,</span> res</span><span>)</span> <span>{</span>
        <span>// your business logic</span>
    <span>}</span>
<span>)</span><span>;</span></code></pre><p>You would then add a new middleware that calls Auth0 Fine Grained Authorization to perform authorization on every request, after authentication has taken place. You know who the user is (authentication), now you want to check what they can do (authorization):</p><pre><code>app<span>.</span><span>get</span><span>(</span><span>&#39;/project/:id&#39;</span><span>,</span>
    <span>jwt</span><span>(</span><span>{</span> secret<span>:</span> <span>PUBLIC_KEY</span><span>,</span> algorithms<span>:</span> <span>[</span><span>&#39;RS256&#39;</span><span>]</span> <span>}</span><span>)</span><span>,</span>
    <span>async</span> <span>function</span><span>(</span><span>req<span>,</span> res<span>,</span> next</span><span>)</span> <span>{</span>
        <span>try</span> <span>{</span>
            <span>const</span> result <span>=</span> <span>await</span> auth0Fga<span>.</span><span>check</span><span>(</span><span>{</span>
              tuple_key<span>:</span> <span>{</span>
                user<span>:</span> req<span>.</span>user<span>.</span>sub<span>,</span>
                relation<span>:</span> <span>&#39;read&#39;</span><span>,</span>
                object<span>:</span> <span><span>`</span><span>project:</span><span><span>${</span>req<span>.</span>params<span>.</span>id<span>}</span></span><span>`</span></span><span>,</span>
              <span>}</span><span>,</span>
            <span>}</span><span>)</span><span>;</span>

            <span>if</span> <span>(</span><span>!</span>result <span>||</span> <span>!</span>result<span>.</span>allowed<span>)</span> <span>{</span>
                <span>return</span> res<span>.</span><span>status</span><span>(</span><span>403</span><span>)</span>
                    <span>.</span><span>send</span><span>(</span><span>{</span> code<span>:</span> <span>&#39;missing_permissions&#39;</span><span>,</span> message<span>:</span> <span><span>`</span><span>ForbiddenError: Not allowed to access object </span><span><span>${</span>req<span>.</span>params<span>.</span>id<span>}</span></span><span>`</span></span> <span>}</span><span>)</span><span>;</span>
            <span>}</span>

            <span>next</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>  <span>catch</span> <span>(</span>err<span>)</span> <span>{</span>
            <span>// handle error</span>
            <span>return</span> <span>next</span><span>(</span>err<span>)</span><span>;</span>
        <span>}</span>
    <span>}</span><span>,</span>
    <span>function</span><span>(</span><span>req<span>,</span> res</span><span>)</span> <span>{</span>
        <span>// your business logic</span>
    <span>}</span>
<span>)</span><span>;</span></code></pre><p>The key part of the new middleware is this one, where we call the Auth0 Fine Grained Authorization API:</p><pre><code><span>const</span> result <span>=</span> <span>await</span> auth0Fga<span>.</span><span>check</span><span>(</span><span>{</span>
  tuple_key<span>:</span> <span>{</span>
    user<span>:</span> req<span>.</span>user<span>.</span>sub<span>,</span>
    relation<span>:</span> <span>&#34;read&#34;</span><span>,</span>
    object<span>:</span> <span><span>`</span><span>project:</span><span><span>${</span>req<span>.</span>params<span>.</span>id<span>}</span></span><span>`</span></span><span>,</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>We are conceptually asking the question <strong>&#34;can the {user} read project:{id}&#34;?</strong>:</p><ul><li>The <strong>user</strong> identifier is obtained from the JWT <a href="https://datatracker.ietf.org/doc/html/rfc7519#section-4.1.2" target="_blank" rel="noreferrer noopener">sub (subject) claim</a>, as the JWT validation middleware sets all claims for the JWT in the <strong>req.user</strong> object as properties. Whatever your existing authentication method is, you can easily integrate it with Auth0 FGA.</li><li>The <strong>relation</strong> is &#34;read&#34; because the endpoint is a <strong>GET</strong>, it allows the caller to &#34;<strong>read&#34;</strong> one project. For <strong>PUT</strong> or <strong>PATCH</strong> you would use <strong>&#34;write&#34;</strong>.</li><li>The <strong>object</strong> is made up of the object type (project) and the project ID. The <strong>object</strong> <strong>ID</strong> comes from the request parameters (the path). A full URL for the request might be GET {API_URL}/projects/1234, so the <strong>object</strong> would be <strong>project:1234</strong>.</li></ul><p>You can learn about <strong>CHECK</strong> requests in depth <a href="https://docs.fga.dev/intro/auth0-fga-concepts#what-is-a-check-request" target="_blank" rel="noreferrer noopener">here</a>.</p><p>The previous example is intentionally verbose to show you the inner workings of things. You can imagine having SDKs for any web framework, API Gateway, and even policy languages that easily allow you to configure authorization per endpoint. For example:</p><pre><code>app<span>.</span><span>get</span><span>(</span><span>&#39;/projects/:id&#39;</span><span>,</span>
    <span>jwt</span><span>(</span><span>{</span> secret<span>:</span> <span>PUBLIC_KEY</span><span>,</span> algorithms<span>:</span> <span>[</span><span>&#39;RS256&#39;</span><span>]</span> <span>}</span><span>)</span><span>,</span>
    <span>authorize</span><span>(</span><span>req</span> <span>=&gt;</span> <span>(</span><span>{</span>
        user<span>:</span> req<span>.</span>user<span>.</span>sub<span>,</span>
        relation<span>:</span> <span>&#39;read&#39;</span><span>,</span>
        object<span>:</span> <span><span>`</span><span>project:</span><span><span>${</span>req<span>.</span>params<span>.</span>id<span>}</span></span><span>`</span></span>
    <span>}</span><span>)</span><span>)</span><span>,</span>
    <span>function</span><span>(</span><span>req<span>,</span> res</span><span>)</span> <span>{</span>
        <span>// your business logic</span>
    <span>}</span>
<span>)</span><span>;</span></code></pre><p>The Auth0 FGA Developer Community Preview is completely free and includes the features below. This is a chance for you and your teams to try the product out, assess how you&#39;d integrate it with your apps, and give us your feedback.</p><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0"></path></svg><p><strong>Note:</strong><br/><b></b></p><p>The rate limits in the API are intentionally set low and there are no SLAs, as the Developer Community Preview is meant to help us learn how customers use the product. For additional inquires, please reach out on the <a href="https://discord.gg/6jsgXhVBu6" target="_blank" rel="noreferrer noopener">Community Discord</a>.<br/> </p></div><h3 id="Management-dashboard">Management dashboard</h3><p>The management dashboard (<a href="https://dashboard.fga.dev/" target="_blank" rel="noreferrer noopener">https://dashboard.fga.dev/</a>) allows you to create an account and a store. You can use the dashboard to define your authorization model, write authorization data, and perform authorization checks.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3BFXmCWtMBx8Bqtrrj2sh0/91674dba44c3c779518b3421a2f16df1/02.jpg" alt="Management dashboard"/></p><h3 id="Documentation">Documentation</h3><p>We have written extensive documentation (<a href="https://docs.fga.dev/" target="_blank" rel="noreferrer noopener">https://docs.fga.dev/</a>) to help you learn the main concepts, get started, and explore advanced use cases.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7wFQjqES9oqiEXTYOpshM1/aa3e08e49cdb20a80d6b24b9ca2639b0/01.jpg" alt="Documentation"/></p><h3 id="HTTP-API-and-SDKs">HTTP API and SDKs</h3><p>Auth0 FGA is a product built for developers. We‚Äôve created an API for developers to integrate Auth0 FGA into their systems. Everything you can do with the dashboard you can also do with the API.</p><p>At launch, we are shipping with SDKs for <a href="https://github.com/auth0-lab/fga-js-sdk" target="_blank" rel="noreferrer noopener">Javascript</a> and <a href="https://github.com/auth0-lab/fga-go-sdk" target="_blank" rel="noreferrer noopener">Golang</a>. If you&#39;d like an SDK for another language let us know in <a href="https://discord.gg/6jsgXhVBu6" target="_blank" rel="noreferrer noopener">Discord</a>. We can easily generate it from our OpenAPI definitions.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5Tdtrh6uySJPvMPsH2ms6/54517d4f5b1749909bce5f32c529a806/03.jpg" alt="Auth0 FGA"/></p><h2 id="What-s-Next-">What&#39;s Next?</h2><p>We are excited about the capabilities that Auth0 FGA will unlock for our customers. We want to make sure our roadmap items are driven by customer feedback and input. So if you‚Äôre interested in the product, please let us know your thoughts by joining our Auth0 Lab community <a href="https://discord.gg/6jsgXhVBu6" target="_blank" rel="noreferrer noopener">here</a>.</p><p>We are also looking forward to the future, especially the &#34;better together&#34; use cases that Auth0 Fine Grained Authorization will enable for both Auth0 and Okta customers.</p><p>We hope you&#39;ll join us on this journey and are eager to hear your thoughts on what we‚Äôve built so far.</p><p>Take a look, try it out at <a href="https://auth0.com/developers/lab/fine-grained-authorization" target="_blank" rel="noreferrer noopener">https://auth0.com/developers/lab/fine-grained-authorization</a>, and let&#39;s learn together!</p></div></div>]]></content:encoded>
      <author>What Is Fine Grained Authorization?</author>
      <pubDate>Wed, 15 Dec 2021 14:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Add Authentication to Your ASP.NET Core MVC Application</title>
      <link>https://auth0.com/blog/add-authentication-aspnet-core-mvc/</link>
      <description>Learn how to add authentication to your ASP.NET Core MVC Application by using Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>ASP.NET Core MVC is a popular framework for building web applications in .NET. It uses the well-known <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller" target="_blank" rel="noreferrer noopener">Model-View-Controller design pattern</a>, which helps you achieve separation of concerns for your application UI. In this article, you will learn how to integrate authentication in an ASP.NET Core MVC application by using the Auth0 ASP.NET Core Authentication SDK.</p><h2 id="The-Sample-Application">The Sample Application</h2><p>To focus adding authentication, you will use an existing ASP.NET Core MVC application, which will be described in a moment.</p><h3 id="Prerequisites">Prerequisites</h3><p>Before starting, make sure you have the <a href="https://dotnet.microsoft.com/download/dotnet/6.0" target="_blank" rel="noreferrer noopener">.NET 6 SDK</a> installed on your machine. In fact, the application you are going to modify uses some features of C# 10. To get <a href="https://auth0.com/blog/dotnet6-whats-new/" target="_blank" rel="noreferrer noopener">a quick overview of what&#39;s new with .NET 6, check out this article</a>.</p><p>Also, this article will use the .NET CLI to build and run the application, but you can use Visual Studio 2022 if you prefer.</p><h3 id="Get-and-run-the-sample-application">Get and run the sample application</h3><p>You can get the sample application by running the following command in a terminal window:</p><pre><code><span>git</span> clone -b starter --single-branch https://github.com/auth0-blog/acme-aspnet-mvc.git</code></pre><p>Once you download it, move to the <code>acme<span>-</span>aspnet<span>-</span>mvc</code> folder and type the following command to launch the application:</p><pre><code>dotnet <span>watch</span></code></pre><p>This command will run the sample application and wait for possible changes to the code. If you change the application code, it will be automatically rebuilt.</p><blockquote><p>Note that some specific changes to your code, known as <em>rude edits</em>, may require restarting your application. Read <a href="https://devblogs.microsoft.com/dotnet/introducing-net-hot-reload/#supported-unsupported-changes-and-languages" target="_blank" rel="noreferrer noopener">this</a> to learn more.</p></blockquote><p>Now, point your browser to <a href="https://localhost:7095" target="_blank" rel="noreferrer noopener"><code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7095</span></code></a>. You should get the following page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2iq9O4t0D7KNYj2gqbhkWz/c47d25c5ff96c38fa6909db3f07c52ef/acme-website-homepage.png" alt="ACME website home page"/></p><p>This is the home page of the fictional company <a href="https://en.wikipedia.org/wiki/Acme_Corporation" target="_blank" rel="noreferrer noopener">ACME Corporation</a>.</p><p>By clicking the <em>Catalog</em> link in the header, you can navigate their catalog, which will look as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4HFEvrezMulNWyEldb4Yjk/696b9018a58adfa7b4591da6a54161c5/acme-catalog.png" alt="ACME catalog"/></p><p>Actually, the <em>Buy now!</em> button is not working. This page is just a placeholder for a page that users would expect to be protected. In other words, only authenticated users should access the catalog page. This is what you are going to implement in the next few sections.</p><h2 id="Register-with-Auth0">Register with Auth0</h2><p>Before making any changes, you must register the application with Auth0. You need an Auth0 account, of course. If you don&#39;t yet have it, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one</a>.</p><p>Once in the dashboard, move to the <a href="https://manage.auth0.com/#/applications" target="_blank" rel="noreferrer noopener">Applications section</a> and follow these steps:</p><ol start="1"><li>Click on <em>Create Application</em>.</li><li>Provide a friendly name for your application (for example, <em>ACME Web App</em>) and choose <em>Regular Web Applications</em> as the application type.</li><li>Finally, click the <em>Create</em> button.</li></ol><p>These steps make Auth0 aware of your ASP.NET Core MVC application and will allow you to control access.</p><p>After the application has been created, move to the <em>Settings</em> tab and take note of your Auth0 domain and your client id. Then, in the same form, assign the value <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7095</span><span>/</span>callback</code> to the <em>Allowed Callback URLs</em> field and the value <code>https<span>:</span><span>/</span><span><span>/</span><span>localhost:7095</span><span>/</span></span></code> to the <em>Allowed Logout URLs</em> field.</p><p>The first value tells Auth0 which URL to call back after the user authentication. The second value tells Auth0 which URL a user should be redirected to after their logout.</p><p>Click the <em>Save Changes</em> button to apply them.</p><p>Now, head back to the root folder of the sample application project, open the <code>appsettings<span>.</span>json</code> configuration file, and replace its content with the following:</p><pre><code><span>// appsettings.json</span>
<span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
    <span>&#34;LogLevel&#34;</span><span>:</span> <span>{</span>
      <span>&#34;Default&#34;</span><span>:</span> <span>&#34;Information&#34;</span><span>,</span>
      <span>&#34;Microsoft.AspNetCore&#34;</span><span>:</span> <span>&#34;Warning&#34;</span>
    <span>}</span>
  <span>}</span><span>,</span>
  <span>&#34;AllowedHosts&#34;</span><span>:</span> <span>&#34;*&#34;</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;YOUR_DOMAIN&#34;</span><span>,</span>
    <span>&#34;ClientId&#34;</span><span>:</span> <span>&#34;YOUR_CLIENT_ID&#34;</span>
  <span>}</span>
<span>}</span></code></pre><p>Replace the placeholders <code><span>YOUR_DOMAIN</span></code> and <code><span>YOUR_CLIENT_ID</span></code> with the respective values taken from the Auth0 dashboard.</p><h2 id="Add-Authentication">Add Authentication</h2><p>At this point, the basic settings for connecting your application to Auth0 are in place. To add authentication, you need to apply some changes to your application and use those settings. Let&#39;s go one step at a time.</p><h3 id="Install-the-Auth0-SDK">Install the Auth0 SDK</h3><p>As your first step, install the <a href="https://github.com/auth0/auth0-aspnetcore-authentication" target="_blank" rel="noreferrer noopener">Auth0 ASP.NET Core Authentication SDK</a> by running the following command in your terminal window:</p><pre><code>dotnet <span>add</span> package Auth0.AspNetCore.Authentication</code></pre><p>The Auth0 ASP.NET Core SDK lets you easily integrate <a href="https://auth0.com/docs/authorization/protocols/openid-connect-protocol" target="_blank" rel="noreferrer noopener">OpenID Connect</a>-based authentication in your app without dealing with all its low-level details.</p><p>If you want to learn a bit more, this blog post provides you with <a href="https://auth0.com/blog/exploring-auth0-aspnet-core-authentication-sdk/" target="_blank" rel="noreferrer noopener">an overview of the Auth0 ASP.NET Core SDK</a>.</p><h3 id="Set-up-authentication">Set up authentication</h3><p>Now, let&#39;s modify the application code to support authentication. Open the <code>Program<span>.</span>cs</code> file and change its content as follows:</p><pre><code><span>// Program.cs</span>

<span>using</span> <span>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span> <span>// üëà new code</span>

<span><span>var</span></span> builder <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>;</span>

<span>// üëá new code</span>
builder<span>.</span>Services
    <span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span> <span>{</span>
      options<span>.</span>Domain <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
      options<span>.</span>ClientId <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>// üëÜ new code</span>

<span>// Add services to the container.</span>
builder<span>.</span>Services<span>.</span><span>AddControllersWithViews</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> app <span>=</span> builder<span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

<span>// Configure the HTTP request pipeline.</span>
<span>if</span> <span>(</span><span>!</span>app<span>.</span>Environment<span>.</span><span>IsDevelopment</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
    app<span>.</span><span>UseExceptionHandler</span><span>(</span><span>&#34;/Home/Error&#34;</span><span>)</span><span>;</span>
    app<span>.</span><span>UseHsts</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

app<span>.</span><span>UseHttpsRedirection</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseStaticFiles</span><span>(</span><span>)</span><span>;</span>

app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>

app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span> <span>// üëà new code</span>
app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>

app<span>.</span><span>MapControllerRoute</span><span>(</span>
    <span>name</span><span>:</span> <span>&#34;default&#34;</span><span>,</span>
    <span>pattern</span><span>:</span> <span>&#34;{controller=Home}/{action=Index}/{id?}&#34;</span><span>)</span><span>;</span>

app<span>.</span><span>Run</span><span>(</span><span>)</span><span>;</span></code></pre><p>Following the highlighted code, you added a reference to the <code>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</code> namespace at the beginning of the file. Then you invoked the <code><span>AddAuth0WebAppAuthentication</span><span>(</span><span>)</span></code> method with the Auth0 domain and client id as arguments. Finally, you called the <code><span>UseAuthentication</span><span>(</span><span>)</span></code> method to enable the authentication middleware.</p><p>These changes lay the groundwork for supporting authentication via Auth0.</p><h3 id="Implement-login">Implement login</h3><p>To implement login, add a <code>AccountController<span>.</span>cs</code> file to the <code>Controllers</code> folder with the following content:</p><pre><code><span>// Controllers/AccountController.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span>
<span>using</span> <span>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>

<span>public</span> <span>class</span> <span>AccountController</span> <span>:</span> <span><span>Controller</span></span>
<span>{</span>
    <span>public</span> <span>async</span> <span>Task</span> <span>Login</span><span>(</span><span><span>string</span></span> returnUrl <span>=</span> <span>&#34;/&#34;</span><span>)</span>
    <span>{</span>
        <span><span>var</span></span> authenticationProperties <span>=</span> <span>new</span> <span>LoginAuthenticationPropertiesBuilder</span><span>(</span><span>)</span>
            <span>.</span><span>WithRedirectUri</span><span>(</span>returnUrl<span>)</span>
            <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

        <span>await</span> HttpContext<span>.</span><span>ChallengeAsync</span><span>(</span>Auth0Constants<span>.</span>AuthenticationScheme<span>,</span> authenticationProperties<span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>This class defines a controller meant to handle typical user account operations. In the code above, you implemented the login operation through the <code><span>Login</span><span>(</span><span>)</span></code> method. This method creates a set of authentication properties required for the login and triggers the authentication process via Auth0.</p><p>To enable this login operation, you need to change the UI. So, open the <code>_Layout<span>.</span>cshtml</code> file under the <code>Views<span>/</span>Shared</code> folder and update its content as follows:</p><pre><code>// Views/Shared/_Layout.cshtml

<span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>&gt;</span></span>
<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>&#34;</span>en<span>&#34;</span></span><span>&gt;</span></span>
  
<span>&lt;!-- ...existing code --&gt;</span>
  
  <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-collapse collapse d-sm-inline-flex justify-content-between<span>&#34;</span></span><span>&gt;</span></span>
    // üëá new code
    @if (User.Identity.IsAuthenticated)
    {
    // üëÜ new code
      <span><span><span>&lt;</span>ul</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-nav<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>li</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-item<span>&#34;</span></span><span>&gt;</span></span>
          <span><span><span>&lt;</span>a</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-link text-dark display-6<span>&#34;</span></span> <span>asp-area</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span> 
             <span>asp-controller</span><span><span>=</span><span>&#34;</span>Catalog<span>&#34;</span></span> 
             <span>asp-action</span><span><span>=</span><span>&#34;</span>Index<span>&#34;</span></span><span>&gt;</span></span>Catalog<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
      <span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
    // üëá new code
    } else {
      <span><span><span>&lt;</span>ul</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-nav ms-auto<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>li</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-item<span>&#34;</span></span><span>&gt;</span></span>
          <span><span><span>&lt;</span>a</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-link text-dark display-6<span>&#34;</span></span> <span>asp-area</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span> 
             <span>asp-controller</span><span><span>=</span><span>&#34;</span>Account<span>&#34;</span></span> 
             <span>asp-action</span><span><span>=</span><span>&#34;</span>Login<span>&#34;</span></span><span>&gt;</span></span>Login<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
      <span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
      }
      // üëÜ new code
  <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  
<span>&lt;!-- ...existing code --&gt;</span></code></pre><p>You modify the page&#39;s markup by adding a check on the <code>User<span>.</span>Identity<span>.</span>IsAuthenticated</code> property. As you may have figured out, this property lets you know if the current user is authenticated or not. If the user is not authenticated, a <em>Login</em> link will be shown on the right side of the navigation bar.</p><h3 id="Test-login">Test login</h3><p>Everything is ready. Go to your browser, and you should see the <em>Login</em> link as shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/KGIf8rXuMMDPdGVq4zw9y/319cb0769030d6176275fd58d9dd8d38/acme-homepage-login.png" alt="ACME home page with login"/></p><p>When you click that link, you will be redirected to the <a href="https://auth0.com/docs/login/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login page</a>, as shown in the following screenshot:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4gmijhzJ7Kk66uR7qo91Xp/b286202e8b79b9c2006a798f4427d5fa/auth0-login.png" alt="Log in with Auth0"/></p><p>The first time the user authenticates, they will be prompted with a page similar to the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7ICERuAMxlDHUoPDgCM5l7/02f058ab83b670d66b4a419820317349/consent-screen.png" alt="Consent screen"/></p><p>This page is known as the consent screen, which informs the user that the sample application will access their user profile data. After accepting, you are redirected back to the sample application and should see the <em>Catalog</em> link appearing on the left side of the navigation bar:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Ws2K5PzT2Qyv5bLM4BR7b/a70d81a0ead954026b48bb8d102a5216/acme-homepage-logged-in.png" alt="ACME home page after login"/></p><p>Congratulations! You added authentication to your ASP.NET Core MVC application!</p><h2 id="Protect-Private-Views">Protect Private Views</h2><p>Although you have to authenticate to see the <em>Catalog</em> link in the navigation bar, the catalog view itself is not protected. You can verify this by accessing the <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7095</span><span>/</span>Catalog</code> address directly.</p><p>You need to restrict access to the catalog only to authenticated users.</p><h3 id="Protect-the-catalog-view">Protect the catalog view</h3><p>For this purpose, edit the <code>CatalogController<span>.</span>cs</code> file under the <code>Controllers</code> folder as shown below:</p><pre><code><span>// Controllers/CatalogController.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</span><span>;</span> <span>// üëà new code</span>

<span>namespace</span> <span>acme<span>.</span>Controllers</span><span>;</span>

<span>public</span> <span>class</span> <span>CatalogController</span> <span>:</span> <span><span>Controller</span></span> <span>{</span>
    <span>private</span> <span>readonly</span> <span>ILogger<span>&lt;</span>HomeController<span>&gt;</span></span> _logger<span>;</span>

    <span>public</span> <span>CatalogController</span><span>(</span><span>ILogger<span>&lt;</span>HomeController<span>&gt;</span></span> logger<span>)</span>
    <span>{</span>
        _logger <span>=</span> logger<span>;</span>
    <span>}</span>

    <span>[</span><span><span>Authorize</span></span><span>]</span> <span>// üëà new code</span>
    <span>public</span> <span>IActionResult</span> <span>Index</span><span>(</span><span>)</span>
    <span>{</span>
        <span>return</span> <span>View</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>You added a reference to the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</code> namespace, which provides you with the <code>Authorize</code> attribute. You use this attribute by attaching it to the <code><span>Index</span><span>(</span><span>)</span></code> method of the controller. This simple change enables the authorization check on the catalog view so that only authenticated users can access it.</p><h3 id="Implement-logout">Implement logout</h3><p>Another missing thing to make your application usable is logout. In fact, currently, when you log in to the application, you stay logged in until your session on Auth0 expires. You may want to allow your user to explicitly log out of the application. For this purpose, open the <code>AccountController<span>.</span>cs</code> file in the <code>Controllers</code> folder and add the code highlighted below:</p><pre><code><span>// Controllers/AccountController.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span>
<span>using</span> <span>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</span><span>;</span> <span>// üëà new code</span>
<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>Cookies</span><span>;</span> <span>// üëà new code</span>

<span>public</span> <span>class</span> <span>AccountController</span> <span>:</span> <span><span>Controller</span></span>
<span>{</span>
  <span>// ...existing code...</span>
  
  <span>// üëá new code</span>
  <span>[</span>Authorize<span>]</span>
  <span>public</span> <span>async</span> <span>Task</span> <span>Logout</span><span>(</span><span>)</span>
  <span>{</span>
    <span><span>var</span></span> authenticationProperties <span>=</span> <span>new</span> <span>LogoutAuthenticationPropertiesBuilder</span><span>(</span><span>)</span>
        <span>.</span><span>WithRedirectUri</span><span>(</span>Url<span>.</span><span>Action</span><span>(</span><span>&#34;Index&#34;</span><span>,</span> <span>&#34;Home&#34;</span><span>)</span><span>)</span>
        <span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

    <span>await</span> HttpContext<span>.</span><span>SignOutAsync</span><span>(</span>Auth0Constants<span>.</span>AuthenticationScheme<span>,</span> authenticationProperties<span>)</span><span>;</span>
    <span>await</span> HttpContext<span>.</span><span>SignOutAsync</span><span>(</span>CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>)</span><span>;</span>
  <span>}</span>
  <span>// üëÜ new code</span>
<span>}</span></code></pre><p>You added the references to the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</code> and <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>Cookies</code> namespaces and defined a new method for the <code>AccountController</code> class: <code><span>Logout</span><span>(</span><span>)</span></code>. This method creates a set of required properties and triggers the logout process to destroy both the Auth0 session and the local session.</p><p>The next step is to make the logout link available to the user. So, update the content of the <code>_Layout<span>.</span>cshtml</code> file under <code>Views<span>/</span>Shared</code> folder as follows:</p><pre><code>// Views/Shared/_Layout.cshtml

<span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>&gt;</span></span>
<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>&#34;</span>en<span>&#34;</span></span><span>&gt;</span></span>
  
<span>&lt;!-- ...existing code --&gt;</span>
  
  <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-collapse collapse d-sm-inline-flex justify-content-between<span>&#34;</span></span><span>&gt;</span></span>
    @if (User.Identity.IsAuthenticated)
    {
      <span><span><span>&lt;</span>ul</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-nav<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>li</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-item<span>&#34;</span></span><span>&gt;</span></span>
          <span><span><span>&lt;</span>a</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-link text-dark display-6<span>&#34;</span></span> <span>asp-area</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span> 
             <span>asp-controller</span><span><span>=</span><span>&#34;</span>Catalog<span>&#34;</span></span> 
             <span>asp-action</span><span><span>=</span><span>&#34;</span>Index<span>&#34;</span></span><span>&gt;</span></span>Catalog<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
      <span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
      // üëá new code
      <span><span><span>&lt;</span>ul</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-nav ms-auto<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>li</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-item<span>&#34;</span></span><span>&gt;</span></span>
          <span><span><span>&lt;</span>a</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-link text-dark display-6<span>&#34;</span></span> <span>asp-area</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span> 
             <span>asp-controller</span><span><span>=</span><span>&#34;</span>Account<span>&#34;</span></span> 
             <span>asp-action</span><span><span>=</span><span>&#34;</span>Logout<span>&#34;</span></span><span>&gt;</span></span>Logout<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
         <span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
       <span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
      // üëÜ new code
    } else {
      <span><span><span>&lt;</span>ul</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-nav ms-auto<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>li</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-item<span>&#34;</span></span><span>&gt;</span></span>
          <span><span><span>&lt;</span>a</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-link text-dark display-6<span>&#34;</span></span> <span>asp-area</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span> 
             <span>asp-controller</span><span><span>=</span><span>&#34;</span>Account<span>&#34;</span></span> 
             <span>asp-action</span><span><span>=</span><span>&#34;</span>Login<span>&#34;</span></span><span>&gt;</span></span>Login<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
      <span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
      }
  <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  
<span>&lt;!-- ...existing code --&gt;</span></code></pre><p>You just added the logout link on the right side of the navigation bar when the user is authenticated. That link points to the <code><span>Logout</span><span>(</span><span>)</span></code> method of the <code>AccountController</code> class.</p><h3 id="Test-the-application">Test the application</h3><p>It&#39;s time to test this new version of the application. First of all, <strong>remove all cookies from your browser or use an incognito window</strong>. This is needed because you haven&#39;t had a chance to log out so far.</p><p>Now, after you log in again, the home page should look as follows:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6xACBYdNzeKlIgZ3CLjGvN/1de5db3e92d0fc6b8e78432c850edfa9/acme-homepage-with-logout.png" alt="ACME homepage with logout"/></p><p>When you click the <em>Logout</em> link, you will be disconnected from Auth0 and see the usual home page with only the <em>Login</em> link. </p><h2 id="Add-a-Profile-Page">Add a Profile Page</h2><p>Let&#39;s try to go one step further and add a page showing some data about the user.</p><h3 id="Specify-your-scopes">Specify your scopes</h3><p>As said before, the Auth0 ASP.NET Core Authentication SDK uses OpenID Connect (OIDC) to authenticate your users. OIDC provides your application with an <a href="https://auth0.com/docs/security/tokens/id-tokens" target="_blank" rel="noreferrer noopener">ID token</a> containing some basic data about the user. From a technical point of view, this user data is available because the SDK requests the <code>openid</code> and <code>profile</code> <a href="https://auth0.com/docs/configure/apis/scopes/openid-connect-scopes" target="_blank" rel="noreferrer noopener">scopes</a> by default. You don&#39;t see this because the SDK takes care of the whole authentication process and manages the ID token. So, by default, you have the user&#39;s name and possibly their picture. If you also want the user&#39;s email in their profile, you have to specify the scopes explicitly.</p><p>Open the <code>Program<span>.</span>cs</code> file and apply the following change:</p><pre><code><span>// Program.cs</span>

<span>// ...existing code...</span>

<span><span>var</span></span> builder <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>;</span>

builder<span>.</span>Services
    <span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span> <span>{</span>
      options<span>.</span>Domain <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
      options<span>.</span>ClientId <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
      options<span>.</span>Scope <span>=</span> <span>&#34;openid profile email&#34;</span><span>;</span> <span>// üëà new code</span>
    <span>}</span><span>)</span><span>;</span>

<span>// ...existing code...</span></code></pre><p>You assigned a string to the <code>Scope</code> option containing the default scopes mentioned before (<code>openid</code> and <code>profile</code>) and the <code>email</code> scope.</p><p>This causes the email to be added to the user profile.</p><h3 id="Create-the-profile-model">Create the profile model</h3><p>To show the user profile, let&#39;s start by creating a model. Add a <code>UserProfileViewModel<span>.</span>cs</code> file to the <code>Model</code> folder with the following content:</p><pre><code><span>// Model/UserProfileViewModel.cs</span>

<span>namespace</span> <span>acme<span>.</span>ViewModels</span><span>;</span>

<span>public</span> <span>class</span> <span>UserProfileViewModel</span>
<span>{</span>
  <span>public</span> <span><span>string</span></span> EmailAddress <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>

  <span>public</span> <span><span>string</span></span> ProfileImage <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
<span>}</span></code></pre><p>This code simply defines a class with the three elements of the user profile: the name, the email address, and the user&#39;s picture.</p><h3 id="Create-the-profile-view">Create the profile view</h3><p>To define the associated view, create an <code>Account</code> folder in the <code>Views</code> folder. Then add the <code>Profile<span>.</span>cshtml</code> file to the <code>Views<span>/</span>Account</code> folder with the following content:</p><pre><code>@* Views/Account/Profile.cshtml *@

@model acme.ViewModels.UserProfileViewModel
@{
    ViewData[&#34;Title&#34;] = &#34;User Profile&#34;;
}

<span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>row<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>col-md-12<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>row<span>&#34;</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>h2</span><span>&gt;</span></span>@ViewData[&#34;Title&#34;].<span><span><span>&lt;/</span>h2</span><span>&gt;</span></span>

            <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>col-md-2<span>&#34;</span></span><span>&gt;</span></span>
                <span><span><span>&lt;</span>img</span> <span>src</span><span><span>=</span><span>&#34;</span>@Model.ProfileImage<span>&#34;</span></span>
                     <span>alt</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span> <span>class</span><span><span>=</span><span>&#34;</span>img-rounded img-responsive<span>&#34;</span></span> <span>/&gt;</span></span>
            <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>col-md-4<span>&#34;</span></span><span>&gt;</span></span>
                <span><span><span>&lt;</span>h3</span><span>&gt;</span></span>@Model.Name<span><span><span>&lt;/</span>h3</span><span>&gt;</span></span>
                <span><span><span>&lt;</span>p</span><span>&gt;</span></span>
                    <span><span><span>&lt;</span>i</span> <span>class</span><span><span>=</span><span>&#34;</span>glyphicon glyphicon-envelope<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>i</span><span>&gt;</span></span> @Model.EmailAddress
                <span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
            <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>div</span><span>&gt;</span></span></code></pre><p>This markup shows the three properties of the user model.</p><h3 id="Create-the-profile-controller">Create the profile controller</h3><p>Let&#39;s complete the profile by creating the profile controller. Add the following method to the <code>AccountController</code> class:</p><pre><code><span>// Controllers/AccountController.cs</span>

<span>// ...existing code...</span>
<span>using</span> <span>System<span>.</span>Security<span>.</span>Claims</span><span>;</span>  <span>// üëà new code</span>
<span>using</span> <span>acme<span>.</span>ViewModels</span><span>;</span>    <span>// üëà new code</span>

<span>public</span> <span>class</span> <span>AccountController</span> <span>:</span> <span><span>Controller</span></span>
<span>{</span>
  <span>// ...existing code...</span>
  
  <span>// üëá new code</span>
  <span>[</span>Authorize<span>]</span>
  <span>public</span> <span>IActionResult</span> <span>Profile</span><span>(</span><span>)</span>
  <span>{</span>
    <span>return</span> <span>View</span><span>(</span><span>new</span> <span>UserProfileViewModel</span><span>(</span><span>)</span>
    <span>{</span>
      Name <span>=</span> User<span>.</span>Identity<span>.</span>Name<span>,</span>
      EmailAddress <span>=</span> User<span>.</span><span>FindFirst</span><span>(</span>c <span>=&gt;</span> c<span>.</span>Type <span>==</span> ClaimTypes<span>.</span>Email<span>)</span><span>?.</span>Value<span>,</span>
      ProfileImage <span>=</span> User<span>.</span><span>FindFirst</span><span>(</span>c <span>=&gt;</span> c<span>.</span>Type <span>==</span> <span>&#34;picture&#34;</span><span>)</span><span>?.</span>Value
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>
  <span>// üëÜ new code</span>
<span>}</span></code></pre><p>You add the references to the <code>System<span>.</span>Security<span>.</span>Claims</code> and <code>acme<span>.</span>ViewModels</code> namespaces and define the <code><span>Profile</span><span>(</span><span>)</span></code> method. This method returns a view based on the user profile model, whose property values are extracted by the currently logged <code>User</code> object. Notice that also the <code><span>Profile</span><span>(</span><span>)</span></code> method is marked with the <code>Authorized</code> attribute.</p><h3 id="Link-the-profile-page">Link the profile page</h3><p>Finally, let&#39;s make the profile page available to the user. Open the <code>_Layout<span>.</span>cshtml</code> file under the <code>Views<span>/</span>Shared</code> folder and update its content as follows:</p><pre><code>// Views/Shared/_Layout.cshtml

<span><span>&lt;!</span><span>DOCTYPE</span> <span>html</span><span>&gt;</span></span>
<span><span><span>&lt;</span>html</span> <span>lang</span><span><span>=</span><span>&#34;</span>en<span>&#34;</span></span><span>&gt;</span></span>
  
<span>&lt;!-- ...existing code --&gt;</span>
  
  <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-collapse collapse d-sm-inline-flex justify-content-between<span>&#34;</span></span><span>&gt;</span></span>
    @if (User.Identity.IsAuthenticated)
    {
      <span><span><span>&lt;</span>ul</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-nav<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>li</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-item<span>&#34;</span></span><span>&gt;</span></span>
          <span><span><span>&lt;</span>a</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-link text-dark display-6<span>&#34;</span></span> <span>asp-area</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span> 
             <span>asp-controller</span><span><span>=</span><span>&#34;</span>Catalog<span>&#34;</span></span> 
             <span>asp-action</span><span><span>=</span><span>&#34;</span>Index<span>&#34;</span></span><span>&gt;</span></span>Catalog<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
      <span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>ul</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-nav ms-auto<span>&#34;</span></span><span>&gt;</span></span>
        // üëá new code
        <span><span><span>&lt;</span>li</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-item<span>&#34;</span></span><span>&gt;</span></span>
          <span><span><span>&lt;</span>a</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-link text-dark display-6<span>&#34;</span></span> 
             <span>asp-controller</span><span><span>=</span><span>&#34;</span>Account<span>&#34;</span></span> 
             <span>asp-action</span><span><span>=</span><span>&#34;</span>Profile<span>&#34;</span></span><span>&gt;</span></span>Hello @User.Identity.Name!<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
        // üëÜ new code
        <span><span><span>&lt;</span>li</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-item<span>&#34;</span></span><span>&gt;</span></span>
          <span><span><span>&lt;</span>a</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-link text-dark display-6<span>&#34;</span></span> <span>asp-area</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span> 
             <span>asp-controller</span><span><span>=</span><span>&#34;</span>Account<span>&#34;</span></span> 
             <span>asp-action</span><span><span>=</span><span>&#34;</span>Logout<span>&#34;</span></span><span>&gt;</span></span>Logout<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
         <span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
       <span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
    } else {
      <span><span><span>&lt;</span>ul</span> <span>class</span><span><span>=</span><span>&#34;</span>navbar-nav ms-auto<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>li</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-item<span>&#34;</span></span><span>&gt;</span></span>
          <span><span><span>&lt;</span>a</span> <span>class</span><span><span>=</span><span>&#34;</span>nav-link text-dark display-6<span>&#34;</span></span> <span>asp-area</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span> 
             <span>asp-controller</span><span><span>=</span><span>&#34;</span>Account<span>&#34;</span></span> 
             <span>asp-action</span><span><span>=</span><span>&#34;</span>Login<span>&#34;</span></span><span>&gt;</span></span>Login<span><span><span>&lt;/</span>a</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>li</span><span>&gt;</span></span>
      <span><span><span>&lt;/</span>ul</span><span>&gt;</span></span>
      }
  <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  
<span>&lt;!-- ...existing code --&gt;</span></code></pre><p>You add the link to the profile view next to the logout link. That link will show a welcome message with the user name. Also, it will be shown only when the user is authenticated.</p><h3 id="Test-the-user-profile">Test the user profile</h3><p>Go back to your browser and authenticate again. As a first difference, you will notice that you will see the consent screen again. Why? Didn&#39;t you previously accept?</p><p>Actually, this time, your application is requesting a new piece of information about you: the email. If you compare this screen with the previous one, you will notice this subtle difference.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/MnHpwJ6YZwlpzODgKmore/53796ac45102b1c456faf0c589ba9949/consent-screen-2.png" alt="Consent screen with new the email scope"/></p><p>After you accept that screen, your new home page will look as follows:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/tz566526bZItFhS7yJJNy/b0e7730aa8e1d23a4714552dd046e7b1/ACME-homepage-with-profile-link.png" alt="ACME-homepage-with-profile-link"/></p><p>You can see the welcome message next to the logout link. If you click the welcome message, the user profile will be shown as in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1KwxDh0nZ5y7r6AyVaEkFb/b95c910405f3675eae734d9ea7fccfb1/user-profile.png" alt="User profile"/></p><h2 id="Summary">Summary</h2><p>Throughout this article, you learned how to integrate authentication in an ASP.NET Core MVC application via Auth0. You&#39;ve seen how the Auth0 ASP.NET Core Authentication SDK handles OpenID Connect for you under the hood, preventing you from dealing with the technical details. You also learned how to protect the private views of your application and how to implement logout. Finally, you were able to get the user&#39;s data to create a user profile page.</p><p>You can find the complete code of the ASP.NET Core MVC project in <a href="https://github.com/auth0-blog/acme-aspnet-mvc" target="_blank" rel="noreferrer noopener">this GitHub repository</a>.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 14 Dec 2021 15:04:00 +0000</pubDate>
    </item>
    <item>
      <title>Defending against XSS with CSP</title>
      <link>https://auth0.com/blog/defending-against-xss-with-csp/</link>
      <description>Learn how to use Content Security Policy (CSP) to prevent the execution of malicious script code in your application.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> Content Security Policy (CSP) started as a simple defense but quickly evolved into a complex security policy. This article investigates how to build an effective CSP policy to counter XSS vulnerabilities. Concretely, we use step-by-step examples to highlight bypasses against CSP and examine how to use nonces, hashes, and <code><span>&#39;strict-dynamic&#39;</span></code> to build a robust CSP policy for modern applications.</p><h2 id="What-Is-CSP-">What Is CSP?</h2><p>The first version of Content Security Policy (CSP) was implemented in 2010 and discussed in <a href="https://research.sidstamm.com/papers/csp-www2010.pdf" target="_blank" rel="noreferrer noopener">an academic paper authored by people from Mozilla</a>. The paper described how a developer could define a security policy to tell the browser exactly which resources can be loaded in a web application.</p><p>The idea behind CSP was met with great enthusiasm, but it turns out that controlling the loading of resources in modern applications is a bit more complicated than initially thought. Nonetheless, CSP has been under constant development and still is today.</p><p>An essential responsibility of a modern-day CSP policy is to act as <strong>a second line of defense</strong> against XSS vulnerabilities. Based on the historical track record of virtually every web application, it is almost certain that the application will be vulnerable at XSS at some point. What if CSP policy could stop the attacker from exploiting that vulnerability?</p><p>That&#39;s what we will explore in this article. We&#39;ll start with the basics and gradually dive deeper and deeper into more recent CSP features. </p><blockquote><p>Before we get started, note that deploying CSP does not absolve you from the responsibility of following <a href="https://auth0.com/blog/cross-site-scripting-xss/" target="_blank" rel="noreferrer noopener">secure coding guidelines to avoid XSS vulnerabilities</a> in the first place. CSP only offers a second line of defense in case something goes wrong. </p></blockquote><p>Let&#39;s dive in!</p><h2 id="Blocking-Script-Execution-with-CSP">Blocking Script Execution with CSP</h2><p>When an application contains an XSS vulnerability, user-provided data is picked up by the browser as executable code. For example, a malicious user can change their name to <code>philippe<span>&lt;</span>script<span>&gt;</span><span>evilCode</span><span>(</span><span>)</span><span>&lt;</span><span>/</span>script<span>&gt;</span></code>. When another user of the application visits the malicious user&#39;s profile, their browser will see the malicious code and execute it. That gives the malicious user control over the application&#39;s execution context in the victim&#39;s browser.</p><p>If this short recap of XSS vulnerabilities sounds confusing, I recommend you check out this <a href="https://auth0.com/blog/cross-site-scripting-xss/" target="_blank" rel="noreferrer noopener">in-depth article on XSS</a> first.</p><p>For the remainder of this article, we assume that the application contains an XSS vulnerability that a malicious user can exploit. To exploit such a vulnerability, the attacker can use a variety of payloads. This code snippet lists a few different options:</p><pre><code><span>&lt;!-- Inline code --&gt;</span>
<span><span><span>&lt;</span>img</span> <span>src</span><span><span>=</span><span>&#34;</span>none.png<span>&#34;</span></span> <span>onerror</span><span><span>=</span><span>&#34;</span>evilCode()<span>&#34;</span></span><span>&gt;</span></span>

<span>&lt;!-- Code block --&gt;</span>
<span><span><span>&lt;</span>script</span><span>&gt;</span></span><span><span><span>evilCode</span><span>(</span><span>)</span></span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span>

<span>&lt;!-- Remote code file --&gt;</span>
<span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>&#34;</span>https://evil.com/code.js<span>&#34;</span></span><span>&gt;</span></span><span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span></code></pre><p>CSP aims to prevent the execution of each of these attack vectors. To achieve that, CSP enforces restrictions on which script code can be executed. The snippet below shows a CSP response header with a minimal policy configuration:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> script<span>-</span>src <span>&#39;self&#39;</span></code></pre><p>The server includes this header on the response that sends an HTML page to the browser. This policy configuration tells the browser that this page can only execute scripts coming from its own origin. </p><p>Concretely, this means that if the application is running on <code>https<span>:</span><span>/</span><span>/</span>example<span>.</span>com<span>/</span>app</code>, the browser only executes remote JavaScript code coming from <code>https<span>:</span><span>/</span><span>/</span>example<span>.</span>com</code>. Anything else is blocked.</p><p>Our first attack vector from before relied on inline code to trigger the execution of malicious code. This code is present in the page, but the browser has no idea whether this code is supposed to be there. It is not loaded from <code>https<span>:</span><span>/</span><span>/</span>example<span>.</span>com</code>, so it will not execute.</p><p>Similarly, the provenance of inline code blocks is unknown, so they are not executed.</p><p>Finally, the remote code file is loaded from <code>https<span>:</span><span>/</span><span>/</span>evil<span>.</span>com</code>. Since <code>https<span>:</span><span>/</span><span>/</span>evil<span>.</span>com</code> does not correspond to the application&#39;s origin, <code>https<span>:</span><span>/</span><span>/</span>example<span>.</span>com</code>, the browser will refuse to load this file.</p><p>As you can see, CSP blocks the execution of all potentially dubious JavaScript code. Well, actually, this CSP policy blocks the execution of all JavaScript code that is not remotely loaded from the application&#39;s origin. </p><p>This means that if the application relies on inline event handlers, such as <code>onload</code> or <code>onclick</code>, that code will not execute. Similarly, if the application uses inline code blocks, they will not be executed.</p><p>üñ• <em>A running example of this setup is provided by the <code><span>/</span>basics</code> endpoint of <a href="https://github.com/auth0-blog/csp-against-xss-demo" target="_blank" rel="noreferrer noopener">this Express demo application</a>.</em> </p><p>Unsurprisingly, such a CSP policy is wildly incompatible with many applications. Even today, we often rely on inline code blocks to load JavaScript code into the application.</p><p>CSP Level 2 introduces hashes and nonces to address these incompatibilities.</p><h2 id="CSP-Level-2">CSP Level 2</h2><p>CSP Level 2 aims to make CSP more compatible with real-world applications without compromising security. Let&#39;s look at two mechanisms introduced in CSP Level 2: hashes and nonces.</p><h3 id="CSP-script-hashes">CSP script hashes</h3><p>Many applications rely on inline script blocks to load legitimate JavaScript code. The snippet below shows a simplified example:</p><pre><code><span><span><span>&lt;</span>button</span> <span>id</span><span><span>=</span><span>&#34;</span>hello<span>&#34;</span></span><span>&gt;</span></span>Say Hello!<span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
<span><span><span>&lt;</span>script</span><span>&gt;</span></span><span><span>
document<span>.</span><span>addEventListener</span><span>(</span><span>&#34;DOMContentLoaded&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  document<span>.</span><span>getElementById</span><span>(</span><span>&#34;hello&#34;</span><span>)</span>
      <span>.</span><span>addEventListener</span><span>(</span><span>&#34;click&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span> <span>alert</span><span>(</span><span>&#34;Hello!&#34;</span><span>)</span><span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span>
</span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span></code></pre><p>As discussed before, the configuration of a CSP policy prevents this legitimate code from executing. However, CSP Level 2 allows us to include the hash of a script block in our policy. The snippet below shows a CSP policy that allows this code block to execute:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> script<span>-</span>src <span>&#39;sha256-6X6+1K/DKkKDJXeIXoOfaIX+FzybN9LaGtutkR5DWpQ=&#39;</span></code></pre><p>When the browser loads the page, it encounters the script block. It now calculates the hash and checks if it is listed in the CSP policy as a legitimate script block. </p><p>üñ• <em>A running example of this setup is provided by the <code><span>/</span>hashes</code> endpoint of <a href="https://github.com/auth0-blog/csp-against-xss-demo" target="_blank" rel="noreferrer noopener">this Express demo application</a>.</em> </p><p>The security of this mechanism relies on the underlying properties of a hashing function. Only this exact piece of code will yield the hash we included in our policy. Changing a single character, or even adding a single space, would change the hash of the script code.</p><p><strong><em>In a nutshell, hashes only approve a single script block to execute</em></strong>. In CSP Level 2, hashes only work for inline code blocks, not for remote code files. Level 3 will likely support the use of <a href="https://www.w3.org/TR/CSP3/#external-hash" target="_blank" rel="noreferrer noopener">hashes for remote code files</a> as well. Note that at the time of writing, CSP Level 3 is still under development. </p><p>Finally, note that you typically do not calculate these hashes manually. If you load your application in a Chromium-based browser, you can find the expected hash in the error messages of the developer console, as shown below:</p><pre><code>Refused to execute inline script because it violates the following Content Security Policy directive: <span>&#34;script-src &#39;self&#39;&#34;</span><span>.</span>
Either the <span>&#39;unsafe-inline&#39;</span> keyword, a <span>hash</span> <span>(</span><span>&#39;sha256-6X6+1K/DKkKDJXeIXoOfaIX+FzybN9LaGtutkR5DWpQ=&#39;</span><span>)</span>, or a nonce <span>(</span><span>&#39;nonce-...&#39;</span><span>)</span> is required to <span>enable</span> inline execution.</code></pre><p>If you&#39;re confident that the hash shown in the message belongs to your legitimate code block, you can copy/paste it into the CSP policy.</p><h3 id="CSP-script-nonces">CSP script nonces</h3><p>CSP Level 2 introduces a second mechanism to allow the execution of legitimate JavaScript code: nonces. The snippet below shows the HTML of a legitimate application using nonces:</p><pre><code><span><span><span>&lt;</span>button</span> <span>id</span><span><span>=</span><span>&#34;</span>hello<span>&#34;</span></span><span>&gt;</span></span>Say Hello!<span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
<span><span><span>&lt;</span>script</span> <span>nonce</span><span><span>=</span><span>&#34;</span>1f40e4a23493<span>&#34;</span></span><span>&gt;</span></span><span><span>
document<span>.</span><span>addEventListener</span><span>(</span><span>&#34;DOMContentLoaded&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  document<span>.</span><span>getElementById</span><span>(</span><span>&#34;hello&#34;</span><span>)</span>
      <span>.</span><span>addEventListener</span><span>(</span><span>&#34;click&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span> <span>alert</span><span>(</span><span>&#34;Hello!&#34;</span><span>)</span><span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span>
</span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span></code></pre><p>As you can see, the script block is now configured with a <code>nonce</code> attribute. The same nonce value occurs in the CSP policy configuration, as shown below:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> script<span>-</span>src <span>&#39;nonce-1f40e4a23493&#39;</span></code></pre><p>When the browser encounters an inline script block, it compares the value of the <code>nonce</code> attribute to the value included in the CSP policy. Matching nonces imply that this code block is a part of the legitimate application instead of being injected by an attacker.</p><blockquote><p><strong><em>One crucial requirement for using nonces is that they have to be fresh on every page load</em></strong>. Nonces should be generated from a cryptographically secure random source and should never be re-used. Otherwise, an attacker can predict the nonce and include a valid nonce on injected code blocks.</p></blockquote><p>Contrary to hashes, nonces can also be used on remote code files. The CSP policy configuration from above does not approve any external sources for loading JavaScript. In practice, this means that the code file loaded in the snippet below should be blocked:</p><pre><code><span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>&#34;</span>https://analytics.example.com/1.js<span>&#34;</span></span> <span>nonce</span><span><span>=</span><span>&#34;</span>1f40e4a23493<span>&#34;</span></span><span>&gt;</span></span><span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span></code></pre><p>However, adding a nonce to the script tag loading a remote file suffices to tell the browser that this code is legitimate. </p><p>üñ• <em>A running example of this setup is provided by the <code><span>/</span>nonces</code> endpoint of <a href="https://github.com/auth0-blog/csp-against-xss-demo" target="_blank" rel="noreferrer noopener">this Express demo application</a>.</em> </p><h3 id="Ignoring--unsafe-inline-">Ignoring &#39;unsafe-inline&#39;</h3><p>Now that we have come this far, it&#39;s time for a confession. The statement that inline code cannot be executed without using nonces or hashes was not entirely correct. Even before CSP Level 2, there was a way to execute inline JavaScript code.</p><p>CSP supports a special keyword for the <code>script<span>-</span>src</code> directive: <code><span>&#39;unsafe-inline&#39;</span></code>. This keyword tells the browser to execute all inline JavaScript. This enables legitimate application code to execute, <strong><em>but also allows injected code to be executed</em></strong>. As a result, <code><span>&#39;unsafe-inline&#39;</span></code> disables the protections offered by CSP.</p><p>Surprisingly, CSP policies with <code><span>&#39;unsafe-inline&#39;</span></code> enabled are pretty standard. However, things are not always as they seem. CSP Level 2 states that if a policy contains a hash or a nonce, the browser should ignore any occurrence of <code><span>&#39;unsafe-inline&#39;</span></code>. </p><p>This detail will become relevant when discussing Google&#39;s universal CSP policy further down. </p><h2 id="CSP-by-Example">CSP by Example</h2><p>CSP hashes and nonces enable loading inline script blocks, and nonces and URLs allow the loading of remote code files. That&#39;s all we need to start building a CSP policy.</p><p>Let&#39;s build a CSP policy for a sample app. In our app, we have three relevant JavaScript features:</p><ul><li>We load custom script code from our own origin</li><li>We load the Bootstrap JavaScript script code from a CDN</li><li>We embed a Twitter timeline into our homepage</li></ul><p>üñ• <em>You can follow along in the running example. The <code><span>/</span>twitter<span>-</span>step0</code> endpoint of <a href="https://github.com/auth0-blog/csp-against-xss-demo" target="_blank" rel="noreferrer noopener">this Express demo application</a> offers a clean starting point without CSP. A screenshot of the application is shown below</em>: </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5JPTKZrASW2YJiKIKQY9nf/2575198daa5b8b6c22d8c1daae62411d/twitter-demo-step0.png" alt="A Twitter timeline demo application"/></p><h3 id="Approving-the-application-s-script-code">Approving the application&#39;s script code</h3><p>The application needs to load code from its own origin, so let&#39;s start by adding the following CSP configuration:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> script<span>-</span>src <span>&#39;self&#39;</span></code></pre><p>üñ• <em>You can find this setup in the <code><span>/</span>twitter<span>-</span>step1</code> endpoint of the demo. A screenshot of the application is shown below.</em> </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4hE5AI9FN1eumj3Olk6zJQ/e303296b4da08bfda681ddc8a619a9d2/twitter-demo-step1.png" alt="Twitter demo app with &#39;self&#39; CSP policy"/></p><h3 id="Loading-JS-from-a-CDN">Loading JS from a CDN</h3><p>Next, we want to load the Bootstrap code from the CDN. Let&#39;s update the policy to allow loading resources from that host:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> script<span>-</span>src <span>&#39;self&#39;</span> https<span>:</span><span>/</span><span>/</span>cdn<span>.</span>jsdelivr<span>.</span>net</code></pre><p>üñ• <em>You can find this setup in the <code><span>/</span>twitter<span>-</span>step2</code> endpoint of the demo. A screenshot of the application is shown below</em>: </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7G7RNs5U32BkXRB5OPnqeH/c3d780a3176aeafde0c92fb2942be3b9/twitter-demo-step2.png" alt="Twitter demo app with &#39;self&#39; and URL-based CSP policies"/></p><h3 id="Loading-the-Twitter-timeline">Loading the Twitter timeline</h3><p>So far, so good. The only error left to address is loading the Twitter code that will replace our anchor tag with the timeline. This code is included as in an inline code block. It is static code, so the easiest way to enable that is by including the hash of the code block:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> 
  script<span>-</span>src <span>&#39;self&#39;</span> https<span>:</span><span>/</span><span>/</span>cdn<span>.</span>jsdelivr<span>.</span>net
             <span>&#39;sha256-sJLd4PYo4s+MAefGQBAz5MPUGAPfv94fjxJBqfrunUA=&#39;</span></code></pre><p>üñ• <em>You can find this setup in the <code><span>/</span>twitter<span>-</span>step3</code> endpoint of the demo. A screenshot of the application is shown below.</em> </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2MwFx6G1O09tkPyIHenD1J/7cf01efa4fac9a75b2d735e4ed4df998/twitter-demo-step3.png" alt="Twitter demo app with hash-based CSP policy"/></p><p>Reloading the page does not give the expected result. This code block is trying to load additional resources from <code>https<span>:</span><span>/</span><span>/</span>platform<span>.</span>twitter<span>.</span>com<span>/</span>widgets<span>.</span>js</code>. We&#39;ll have to adjust our policy to allow that to happen:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> 
  script<span>-</span>src <span>&#39;self&#39;</span> https<span>:</span><span>/</span><span>/</span>cdn<span>.</span>jsdelivr<span>.</span>net
             <span>&#39;sha256-sJLd4PYo4s+MAefGQBAz5MPUGAPfv94fjxJBqfrunUA=&#39;</span>
             https<span>:</span><span>/</span><span>/</span>platform<span>.</span>twitter<span>.</span>com</code></pre><p>üñ• <em>You can find this setup in the <code><span>/</span>twitter<span>-</span>step4</code> endpoint of the demo. A screenshot of the application is shown below</em>: </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4Pfh8JhoT9n9mHq8hbjDTA/e0242766d9b822cd41045c9322bcbef3/twitter-demo-step4.png" alt="Twitter demo app with URL-based CSP policy"/></p><p>Reloading shows you that the <code>widgets<span>.</span>js</code> file is loaded, but it needs another code file. This time, the browser is trying to load a file from <code>https<span>:</span><span>/</span><span>/</span>cdn<span>.</span>syndication<span>.</span>twimg<span>.</span>com</code>. Let&#39;s adjust our policy for that new location.</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> 
  script<span>-</span>src <span>&#39;self&#39;</span> https<span>:</span><span>/</span><span>/</span>cdn<span>.</span>jsdelivr<span>.</span>net
             <span>&#39;sha256-sJLd4PYo4s+MAefGQBAz5MPUGAPfv94fjxJBqfrunUA=&#39;</span>
             https<span>:</span><span>/</span><span>/</span>platform<span>.</span>twitter<span>.</span>com
             https<span>:</span><span>/</span><span>/</span>cdn<span>.</span>syndication<span>.</span>twimg<span>.</span>com</code></pre><p>üñ• <em>You can find this setup in the <code><span>/</span>twitter<span>-</span>step5</code> endpoint of the demo. A screenshot of the application is shown below.</em> </p><p>Reloading the page once more should make you happy. We finally see our jokes!</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2qvlA8Ull94nLB0t2MkFcG/ca85f90d892ec1bf60835468c7f85880/twitter-demo-step5.png" alt="Twitter demo app protected from XSS with CSP"/></p><h3 id="Wrapping-up">Wrapping up</h3><p>üñ• <em>You can see the result in the <code><span>/</span>twitter<span>-</span>step5</code> endpoint of <a href="https://github.com/auth0-blog/csp-against-xss-demo" target="_blank" rel="noreferrer noopener">this Express demo application</a>.</em> </p><p>As we have shown, building real-world CSP policies can be quite challenging. It takes several iterations to get things right. Additionally, our policy is quite fragile. If Twitter decides to change its code tomorrow, our timeline may not load anymore because of CSP.</p><p>In a nutshell, not an ideal scenario. And it gets worse (before it gets better).</p><h2 id="CSP-is-Dead--Long-Live-CSP">CSP is Dead, Long Live CSP</h2><p>The title above is borrowed from <a href="https://research.google/pubs/pub45542/" target="_blank" rel="noreferrer noopener">a research paper that shook up the entire world of CSP</a>. Google security engineers looked into real-world complex CSP Level 2 policies, such as the one we built in our example before. They discovered that many of these CSP policies could be bypassed, effectively voiding most of their security benefits. Fortunately, they also offer a solution, so let&#39;s dive right in.</p><h3 id="The-issue-with-CSP">The issue with CSP</h3><p>So, what is the issue with CSP? In a nutshell, it turns out that many real-world CSP policies contain patterns that allow an attacker to bypass the policy.</p><p>Let&#39;s take a step back here. The goal of CSP was to prevent an injected XSS payload from executing. This implies that the application under protection has an XSS vulnerability, which allows an attacker to inject malicious code. </p><p>Under that assumption, the attacker can likely inject arbitrary code. A straight-up XSS payload, such as an inline script block, will be stopped by most real-world CSP policies. However, a carefully crafted payload may not be stopped. </p><p>One example provided in the paper is abusing a JSONP endpoint hosted on an approved CDN (See <a href="https://stackoverflow.com/a/2067584" target="_blank" rel="noreferrer noopener">this explanation</a> for more context on JSONP). We even have that exact vulnerability in our sample application hosting the Twitter timeline. We approved <code>https<span>:</span><span>/</span><span>/</span>cdn<span>.</span>syndication<span>.</span>twimg<span>.</span>com</code>, a CDN that contains Twitter code but also contains JSONP endpoints. </p><p>As a result, an attacker can inject a payload that uses the JSONP endpoint to return malicious code. Since this endpoint is hosted by Twitter&#39;s CDN, our CSP policy does not stop this code from being loaded. In essence, the policy fails to prevent the attacker from abusing the underlying XSS vulnerability.</p><p>Unfortunately, going deeper into the various bypasses against CSP would take us too far in this article. The <a href="https://research.google/pubs/pub45542/" target="_blank" rel="noreferrer noopener">paper</a> and <a href="https://www.youtube.com/watch?v=uf12a-0AluI" target="_blank" rel="noreferrer noopener">interesting conference talk by the authors</a> offer more details if you are interested. </p><p><strong>The vital part of this research is the take-away: URL-based CSP policies are ineffective.</strong> The paper recommends abandoning URL-based policies in favor of hash-based and nonce-based policies. </p><p>To make that work, we need a mechanism to enable cascading JavaScript loading, as we have in our Twitter timeline. That&#39;s where the <em>Long Live CSP</em> part comes in.</p><h3 id="Automatic-trust-propagation-with---strict-dynamic--">Automatic trust propagation with <code><span>&#39;strict-dynamic&#39;</span></code></h3><p>The paper we mentioned before introduces a new CSP keyword: <code><span>&#39;strict-dynamic&#39;</span></code>. This keyword loosely tells the browser:</p><blockquote><p>If you encounter a script that was loaded with a hash or a nonce, you can allow that script to load remote code dependencies by inserting additional <code>script</code> elements into the page</p></blockquote><p>In essence, <code><span>&#39;strict-dynamic&#39;</span></code> offers an automatic trust propagation mechanism, where previously trusted scripts are allowed to load additional resources. This approach may sound insecure but does nothing more than mimic the manual process we followed when building the policy to approve the Twitter timeline. We also added any host Twitter wanted to get the timeline working. <code><span>&#39;strict-dynamic&#39;</span></code> just automates the process.</p><p>Since <code><span>&#39;strict-dynamic&#39;</span></code> was introduced to counter URL-based bypass attacks, it is incompatible with URLs. <code><span>&#39;strict-dynamic&#39;</span></code> only allows scripts that have been approved with a nonce or a hash to load additional resources. In fact, when a browser encounters <code><span>&#39;strict-dynamic&#39;</span></code>, it will automatically ignore URL-based expressions.</p><p>In practice, this means we can update our Twitter timeline example and change the policy to the one shown below:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> script<span>-</span>src <span>&#39;nonce-aQFUZWWi5Xo4YzkEXxg1Xg==&#39;</span> <span>&#39;strict-dynamic&#39;</span></code></pre><p>This updated policy no longer contains URLs but relies on nonces and <code><span>&#39;strict-dynamic&#39;</span></code>. As a result, this policy no longer suffers from bypass attacks that load scripts from approved hosts.</p><p>üñ• <em>A running example of this setup is provided by the <code><span>/</span>strict<span>-</span>dynamic</code> endpoint of <a href="https://github.com/auth0-blog/csp-against-xss-demo" target="_blank" rel="noreferrer noopener">this Express demo application</a>.</em> </p><h3 id="Ramping-up-CSP-security">Ramping up CSP security</h3><p>In their research paper, the authors describe a couple of bypasses against traditional CSP policies. One of these involves the loading of vulnerable Flash files, which then trigger JavaScript code execution. </p><p>While Flash is mostly gone now, it still makes sense to prevent the loading of embedded content using the <code>object<span>-</span>src</code> directive. Below is an updated version of our CSP policy to mitigate this attack vector:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> 
  script<span>-</span>src <span>&#39;nonce-aQFUZWWi5Xo4YzkEXxg1Xg==&#39;</span> <span>&#39;strict-dynamic&#39;</span><span>;</span>
  object<span>-</span>src <span>&#39;none&#39;</span></code></pre><p>There&#39;s also a third CSP directive that should be present in every policy: <code>base<span>-</span>uri</code>. This directive prevents the injection of a malicious <code>base</code> tag, which can change how relative URLs are resolved. Such an attack is known as <em>base jumping</em>.</p><p>Setting the <code>base<span>-</span>uri</code> directive to <code><span>&#39;self&#39;</span></code> instructs the browser only to allow the application&#39;s origin as the base for relative URL resolution. This is a sane default for almost any application.</p><p>The policy shown below includes the addition of the <code>base<span>-</span>uri</code> directive:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> 
  script<span>-</span>src <span>&#39;nonce-aQFUZWWi5Xo4YzkEXxg1Xg==&#39;</span> <span>&#39;strict-dynamic&#39;</span><span>;</span>
  object<span>-</span>src <span>&#39;none&#39;</span><span>;</span> 
  base<span>-</span>uri <span>&#39;self&#39;</span></code></pre><h2 id="Google-s-Universal-CSP-Policy">Google&#39;s Universal CSP Policy</h2><p>We now have all the building blocks to create an effective CSP policy that acts as a second line of defense against XSS. </p><p>How you build a policy depends a bit on your specific situation. We will discuss a few scenarios for Single Page Applications in the second post in this series. For now, let&#39;s look at how Google opted to deploy Content Security Policy.</p><h3 id="The-policy">The policy</h3><p>Various Google properties rely on CSP as a second line of defense against XSS vulnerabilities. Google prefers a <strong><em>set and forget</em></strong> approach to CSP. Concretely, this means that they want to use a policy that offers effective protection against XSS vulnerabilities without potentially breaking any of their applications.</p><p>The snippet below shows the CSP policy Google uses, as observed on Google Hangouts (<a href="https://hangouts.google.com" target="_blank" rel="noreferrer noopener">https://hangouts.google.com</a>). Note that the policy is formatted for readability.:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> 
  script<span>-</span>src <span>&#39;report-sample&#39;</span> <span>&#39;nonce-3YCIqzKGd5cxaIoTibrW/A&#39;</span> <span>&#39;unsafe-inline&#39;</span>
             <span>&#39;strict-dynamic&#39;</span> https<span>:</span> http<span>:</span> <span>&#39;unsafe-eval&#39;</span><span>;</span>
  object<span>-</span>src <span>&#39;none&#39;</span><span>;</span>
  base<span>-</span>uri <span>&#39;self&#39;</span><span>;</span>
  report<span>-</span>uri <span>/</span>webchat<span>/</span>_<span>/</span>cspreport</code></pre><p>üñ• <em>A running example of this setup is provided by the <code><span>/</span>universal<span>-</span>csp</code> endpoint of <a href="https://github.com/auth0-blog/csp-against-xss-demo" target="_blank" rel="noreferrer noopener">this Express demo application</a>.</em> </p><p>A lot is going on with this policy, mainly to ensure backward compatibility with older browsers. Let&#39;s unpack this step by step.</p><h3 id="What-a-modern-browser-sees">What a modern browser sees</h3><p>Google&#39;s policy is designed to work with modern browsers that support <code><span>&#39;strict-dynamic&#39;</span></code>, which <a href="https://caniuse.com/mdn-http_headers_csp_content-security-policy_strict-dynamic" target="_blank" rel="noreferrer noopener">includes most browsers these days</a>.</p><p>The snippet below shows the policy as enforced by a modern browser. </p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> 
  script<span>-</span>src <span>&#39;report-sample&#39;</span> <span>&#39;nonce-3YCIqzKGd5cxaIoTibrW/A&#39;</span>
             <span>&#39;strict-dynamic&#39;</span> <span>&#39;unsafe-eval&#39;</span><span>;</span>
  object<span>-</span>src <span>&#39;none&#39;</span><span>;</span>
  base<span>-</span>uri <span>&#39;self&#39;</span><span>;</span>
  report<span>-</span>uri <span>/</span>webchat<span>/</span>_<span>/</span>cspreport</code></pre><p>That looks quite different than the policy sent by Google. Here&#39;s what changes:</p><ul><li>A modern browser recognizes the nonce, which causes the <code><span>&#39;unsafe-inline&#39;</span></code> keyword to be ignored.</li><li>A modern browser recognizes <code><span>&#39;strict-dynamic&#39;</span></code>, which causes any URL-based expressions (i.e., <code>http<span>:</span> https<span>:</span></code>) to be ignored.</li></ul><p>The resulting CSP policy is a nonce-based policy that uses <code><span>&#39;strict-dynamic&#39;</span></code> for automatic trust propagation. This is considered a secure policy that offers an effective second line of defense against XSS.</p><blockquote><p><em>Note that at the time of writing, the Safari Technology Preview added support for <code><span>&#39;strict-dynamic&#39;</span></code>. This feature is expected to land in Safari in 2022, bringing it up to speed with other modern browsers.</em></p></blockquote><h3 id="What-legacy-browsers-see">What legacy browsers see</h3><p>Legacy browsers that only support CSP Level 2, or even Level 1, will see a different policy. </p><p>The snippet below shows how Safari, which only supports CSP Level 2, observes the policy. </p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> 
  script<span>-</span>src <span>&#39;report-sample&#39;</span> <span>&#39;nonce-3YCIqzKGd5cxaIoTibrW/A&#39;</span>
             https<span>:</span> http<span>:</span> <span>&#39;unsafe-eval&#39;</span><span>;</span>
  object<span>-</span>src <span>&#39;none&#39;</span><span>;</span>
  base<span>-</span>uri <span>&#39;self&#39;</span><span>;</span>
  report<span>-</span>uri <span>/</span>webchat<span>/</span>_<span>/</span>cspreport</code></pre><p>Here&#39;s what changes in the policy when observed by Safari:</p><ul><li>Safari recognizes the nonce, which causes it to ignore <code><span>&#39;unsafe-inline&#39;</span></code>.</li><li>Safari has no idea what <code><span>&#39;strict-dynamic&#39;</span></code> means, so it ignores that value. Instead, it uses the URL-based expressions (i.e., <code>http<span>:</span> https<span>:</span></code>)</li></ul><p><strong>Concretely, this means that this CSP policy is no longer effective.</strong> It does not offer any meaningful protection against the exploitation of an XSS vulnerability in the application. </p><p>The only advantage of this policy is that it does not break the application on Safari. Without the URL-based expressions, Safari would not be able to load remote code files that are otherwise approved with <code><span>&#39;strict-dynamic&#39;</span></code>. In essence, the observed policy is an insecure backward-compatible version.</p><blockquote><p><em>Remember that at the time of writing, the Safari Technology Preview added support for <code><span>&#39;strict-dynamic&#39;</span></code>. This feature is expected to land in Safari in 2022, bringing it up to speed with other modern browsers.</em></p></blockquote><p>A similar story holds for Internet Explorer, which only supports CSP Level 1. That browser sees the following policy:</p><pre><code>Content<span>-</span>Security<span>-</span>Policy<span>:</span> 
  script<span>-</span>src <span>&#39;report-sample&#39;</span> <span>&#39;unsafe-inline&#39;</span>
             https<span>:</span> http<span>:</span> <span>&#39;unsafe-eval&#39;</span><span>;</span>
  object<span>-</span>src <span>&#39;none&#39;</span><span>;</span>
  base<span>-</span>uri <span>&#39;self&#39;</span><span>;</span>
  report<span>-</span>uri <span>/</span>webchat<span>/</span>_<span>/</span>cspreport</code></pre><p>In essence, this policy offers no protection but also does not cause the application to break in Internet Explorer. </p><h3 id="Additional-details">Additional details</h3><p>Finally, there are a couple of additional details in Google&#39;s policy that we have not yet discussed.</p><p>First, the <code>script<span>-</span>src</code> directive also includes the <code><span>&#39;unsafe-eval&#39;</span></code> keyword. By default, CSP prevents the use of the <code><span>eval</span><span>(</span><span>)</span></code> function in JavaScript. <code><span>eval</span><span>(</span><span>)</span></code> evaluates text as code, which is inherently insecure behavior. However, it turns out that abuses of <code><span>eval</span><span>(</span><span>)</span></code> are not as common as previously thought. Additionally, many applications rely on <code><span>eval</span><span>(</span><span>)</span></code> for some more exotic purposes. That&#39;s why many CSP policies re-enable the use of <code><span>eval</span><span>(</span><span>)</span></code> by adding <code><span>&#39;unsafe-eval&#39;</span></code>.</p><p>Second, you may have noticed the <code>report<span>-</span>uri</code> directive. This directive instructs the browser to send a report when it encounters a policy violation. We&#39;ll discuss reporting in more depth in a follow-up article.</p><p>Finally, the <code>script<span>-</span>src</code> directive also contains the <code><span>&#39;report-sample&#39;</span></code> keyword. This instructs the browser to include a piece of a blocked script when sending a report. We&#39;ll discuss that later when we dive into reporting.</p><h3 id="Final-words">Final words</h3><p>In a nutshell, this universal CSP policy discussed here offers a robust second line of defense against XSS attacks. Only code approved by a nonce will be executed when the browser parses the initial HTML page. Once a piece of code is loaded, it can load additional dependencies because of <code><span>&#39;strict-dynamic&#39;</span></code>.</p><p>The drawback of this policy is the lack of support for older browsers. To be fair, this drawback is not that significant. Modern browsers all support <code><span>&#39;strict-dynamic&#39;</span></code>, and building a secure CSP policy for IE 11 is virtually impossible.</p><p>Of course, you are recommended to evaluate which approach to CSP works best for your specific situation.</p><h2 id="Using-CSP-with-SPAs">Using CSP with SPAs</h2><p>CSP sounds awesome! But how can we use CSP in our Single Page Application? </p><p>Unfortunately, there is no easy question to that answer. SPAs rely on remote code files, which do not work with CSP hashes. Nonces have to be fresh on every page load, which conflicts with the static nature of a SPA application bundle.</p><p>In a follow-up article, we will investigate different approaches to use CSP on Single Page Applications. We will offer you concrete guidance on deploying CSP in your SPA.</p><div><h2 id="Aside--Auth0-Authentication-with-JavaScript">Aside: Auth0 Authentication with JavaScript</h2><p>At <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>, we make heavy use of full-stack JavaScript to help our customers to <a href="https://auth0.com/user-management" target="_blank" rel="noreferrer noopener">manage user identities, including password resets, creating, provisioning, blocking, and deleting users</a>. Therefore, it must come as no surprise that using our identity management platform on JavaScript web apps is a piece of cake.</p><p><a href="https://auth0.com/pricing" target="_blank" rel="noreferrer noopener">Auth0 offers a <strong>free tier</strong></a> to get started with modern authentication. Check it out, or <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free Auth0 account here</a>!</p><p>Then, go to <a href="https://manage.auth0.com/#/applications" target="_blank" rel="noreferrer noopener">the Applications section of the Auth0 Dashboard</a> and click on &#34;Create Application&#34;. On the dialog shown, set the name of your application and select <em>Single Page Web Applications</em> as the application type:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2NWZZCQV0Luc7KHCfpVDXv/3f9de446d7060d10be7bff4637ea5e45/js-aside_creating-javascript-application.png" alt="Creating JavaScript application"/></p><p>After the application has been created, click on &#34;Settings&#34; and take note of the domain and client id assigned to your application. In addition, set the <em>Allowed Callback URLs</em> and <em>Allowed Logout URLs</em> fields to the URL of the page that will handle login and logout responses from Auth0. In the current example, the URL of the page that will contain the code you are going to write (e.g. <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span></code>).</p><p>Now, in your JavaScript project, install the <a href="https://github.com/auth0/auth0-spa-js" target="_blank" rel="noreferrer noopener"><code>auth0<span>-</span>spa<span>-</span>js</code></a> library like so:</p><pre><code><span>npm</span> <span>install</span> @auth0/auth0-spa-js</code></pre><p>Then, implement the following in your JavaScript app:</p><pre><code><span>import</span> createAuth0Client <span>from</span> <span>&#39;@auth0/auth0-spa-js&#39;</span><span>;</span>

<span>let</span> auth0Client<span>;</span>

<span>async</span> <span>function</span> <span>createClient</span><span>(</span><span>)</span> <span>{</span>
  <span>return</span> <span>await</span> <span>createAuth0Client</span><span>(</span><span>{</span>
    domain<span>:</span> <span>&#39;YOUR_DOMAIN&#39;</span><span>,</span>
    client_id<span>:</span> <span>&#39;YOUR_CLIENT_ID&#39;</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>async</span> <span>function</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
  <span>await</span> auth0Client<span>.</span><span>loginWithRedirect</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>logout</span><span>(</span><span>)</span> <span>{</span>
  auth0Client<span>.</span><span>logout</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>async</span> <span>function</span> <span>handleRedirectCallback</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> isAuthenticated <span>=</span> <span>await</span> auth0Client<span>.</span><span>isAuthenticated</span><span>(</span><span>)</span><span>;</span>

  <span>if</span> <span>(</span><span>!</span>isAuthenticated<span>)</span> <span>{</span>
    <span>const</span> query <span>=</span> window<span>.</span>location<span>.</span>search<span>;</span>
    <span>if</span> <span>(</span>query<span>.</span><span>includes</span><span>(</span><span>&#39;code=&#39;</span><span>)</span> <span>&amp;&amp;</span> query<span>.</span><span>includes</span><span>(</span><span>&#39;state=&#39;</span><span>)</span><span>)</span> <span>{</span>
      <span>await</span> auth0Client<span>.</span><span>handleRedirectCallback</span><span>(</span><span>)</span><span>;</span>
      window<span>.</span>history<span>.</span><span>replaceState</span><span>(</span><span>{</span><span>}</span><span>,</span> document<span>.</span>title<span>,</span> <span>&#39;/&#39;</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>

  <span>await</span> <span>updateUI</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>async</span> <span>function</span> <span>updateUI</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> isAuthenticated <span>=</span> <span>await</span> auth0Client<span>.</span><span>isAuthenticated</span><span>(</span><span>)</span><span>;</span>

  <span>const</span> btnLogin <span>=</span> document<span>.</span><span>getElementById</span><span>(</span><span>&#39;btn-login&#39;</span><span>)</span><span>;</span>
  <span>const</span> btnLogout <span>=</span> document<span>.</span><span>getElementById</span><span>(</span><span>&#39;btn-logout&#39;</span><span>)</span><span>;</span>

  btnLogin<span>.</span><span>addEventListener</span><span>(</span><span>&#39;click&#39;</span><span>,</span> login<span>)</span><span>;</span>
  btnLogout<span>.</span><span>addEventListener</span><span>(</span><span>&#39;click&#39;</span><span>,</span> logout<span>)</span><span>;</span>

  btnLogin<span>.</span>style<span>.</span>display <span>=</span> isAuthenticated <span>?</span> <span>&#39;none&#39;</span> <span>:</span> <span>&#39;block&#39;</span><span>;</span>
  btnLogout<span>.</span>style<span>.</span>display <span>=</span> isAuthenticated <span>?</span> <span>&#39;block&#39;</span> <span>:</span> <span>&#39;none&#39;</span><span>;</span>

  <span>if</span> <span>(</span>isAuthenticated<span>)</span> <span>{</span>
    <span>const</span> username <span>=</span> document<span>.</span><span>getElementById</span><span>(</span><span>&#39;username&#39;</span><span>)</span><span>;</span>
    <span>const</span> user <span>=</span> <span>await</span> auth0Client<span>.</span><span>getUser</span><span>(</span><span>)</span><span>;</span>

    username<span>.</span>innerText <span>=</span> user<span>.</span>name<span>;</span>
  <span>}</span>
<span>}</span>

window<span>.</span><span>addEventListener</span><span>(</span><span>&#39;load&#39;</span><span>,</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  auth0Client <span>=</span> <span>await</span> <span>createClient</span><span>(</span><span>)</span><span>;</span>

  <span>await</span> <span>handleRedirectCallback</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><blockquote><p>Replace the <code><span>YOUR_DOMAIN</span></code> and <code><span>YOUR_CLIENT_ID</span></code> placeholders with the actual values for the domain and client id you found in your <a href="https://manage.auth0.com/dashboard" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a>.</p></blockquote><p>Then, create your UI with the following markup:</p><pre><code><span><span><span>&lt;</span>p</span><span>&gt;</span></span>Welcome <span><span><span>&lt;</span>span</span> <span>id</span><span><span>=</span><span>&#34;</span>username<span>&#34;</span></span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
<span><span><span>&lt;</span>button</span> <span>type</span><span><span>=</span><span>&#34;</span>submit<span>&#34;</span></span> <span>id</span><span><span>=</span><span>&#34;</span>btn-login<span>&#34;</span></span><span>&gt;</span></span>Sign In<span><span><span>&lt;/</span>button</span><span>&gt;</span></span>
<span><span><span>&lt;</span>button</span> <span>type</span><span><span>=</span><span>&#34;</span>submit<span>&#34;</span></span> <span>id</span><span><span>=</span><span>&#34;</span>btn-logout<span>&#34;</span></span> <span><span>style</span><span><span>=</span><span>&#34;</span><span><span>display</span><span>:</span>none<span>;</span></span><span>&#34;</span></span></span><span>&gt;</span></span>Sign Out<span><span><span>&lt;/</span>button</span><span>&gt;</span></span></code></pre><p>Your application is ready to authenticate with Auth0!</p><p>Check out the <a href="https://auth0.com/docs/libraries/auth0-spa-js" target="_blank" rel="noreferrer noopener">Auth0 SPA SDK documentation</a> to learn more about authentication and authorization with JavaScript and Auth0.</p></div></div></div>]]></content:encoded>
      <author>Philippe De Ryck</author>
      <pubDate>Mon, 13 Dec 2021 15:32:00 +0000</pubDate>
    </item>
    <item>
      <title>How to Add Auth0 Authentication to a Java Application in 5 Mins</title>
      <link>https://auth0.com/blog/auth0-authentication-java-web-application/</link>
      <description>Learn how to integrate a Java web application with Auth0 and implement OIDC/OAuth SSO for a Java</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In this step-by-step tutorial, you will learn how to integrate a Java web application with Auth0 using Datawiza to implement <a href="https://www.datawiza.com/blogs/azure-ad-migration" target="_blank" rel="noreferrer noopener">OIDC/OAuth SSO</a> for the Java web application.</p><h2 id="Prerequisites">Prerequisites</h2><ul><li>A favorite text editor or IDE</li><li><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noreferrer noopener">JDK 1.8</a> or later</li><li><a href="http://www.gradle.org/downloads" target="_blank" rel="noreferrer noopener">Gradle 4+</a> or <a href="https://maven.apache.org/download.cgi" target="_blank" rel="noreferrer noopener">Maven 3.2+</a></li><li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noreferrer noopener">Docker</a> (18.03+)</li><li><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noreferrer noopener">Docker Compose</a></li></ul><h2 id="Run-a-Java-Web-Application">Run a Java Web Application</h2><p>We use the sample offered in <a href="https://spring.io/guides/gs/spring-boot/#initial" target="_blank" rel="noreferrer noopener">Spring.io official Building an Application with Spring Boot</a> as the example in this section. The application running at port 8080 simply returns ‚ÄúGreetings from Spring Boot!‚Äù</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4XcFQXlX8odLIEORRMXePX/e4857dbc14b281600d7016416cb2de77/java_01.png" alt="Java Web Application"/></p><p>Suppose you want to add SSO authentication for a Java web application using Auth0. In that case, Auth0 provides quickstarts on adding the user login to <a href="https://auth0.com/docs/quickstart/webapp/java-ee" target="_blank" rel="noreferrer noopener">a Java EE web application</a> or <a href="https://auth0.com/docs/quickstart/webapp/java" target="_blank" rel="noreferrer noopener">a Java Servlet application</a> and integrating Auth0 with any new or existing Spring Boot 2 web application. What‚Äôs more, there is <a href="https://github.com/auth0/auth0-java" target="_blank" rel="noreferrer noopener">an official Java client library for the Auth0 platform</a> and <a href="https://github.com/auth0/java-jwt" target="_blank" rel="noreferrer noopener">a Java implementation of JSON Web Token (JWT)</a>. However, you will still need to invest significant time to clearly understand concepts related to Auth0, OIDC, Oauth2, JWT, and so on. And you cannot avoid heavy code changes. You deserve a better solution, and we are building one that will reduce the required time from weeks to just minutes.</p><h2 id="Introduction-to-the-Datawiza-Platform">Introduction to the Datawiza Platform</h2><p>The Datawiza Platform is a cloud-delivered, <a href="https://www.datawiza.com/blogs/why-access-management-as-a-service-amaas-why-now" target="_blank" rel="noreferrer noopener">SaaS-based access management solution</a>. It includes a data plane and a control plane: Datawiza Access Broker (DAB) and Datawiza Cloud Management Console (DCMC).</p><p><strong>DAB</strong> is a lightweight, container-based access proxy deployed close to your application via the sidecar (agent) or gateway mode. It talks to Auth0 on behalf of your applications, so you don‚Äôt need to worry about the integration work. <strong>DCMC</strong> is a cloud-based management console where you can configure and manage the policies of DABs. Such a SaaS-based design makes the whole platform much easier to use.</p><h2 id="Step-1--Create-an-Application-in-Auth0">Step 1: Create an Application in Auth0</h2><p>First, we need to create an <a href="https://auth0.com/docs/applications" target="_blank" rel="noreferrer noopener">Auth0 application</a> in the <a href="https://manage.auth0.com/dashboard" target="_blank" rel="noreferrer noopener">Auth0 console</a>. When performing this step, make sure to log in to your account on Auth0. Visit the link <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">here</a> to create a developer account.</p><p>You can skip this step if you already have an application with the following values: Domain, Client ID, and Client Secret.</p><p>Create an application after you log in to Auth0.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5KPM1zIMEVCS02gsenU3AQ/48ba320672eb660458c28ffcc6600578/java_02.png" alt="Auth0"/></p><p>Enter the application name and choose <strong>Regular Web Applications</strong>, then click <strong>CREATE</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/36tWZTXSdPv0B4aDfeXqnv/3de24e44791a7abd6a3499f284679786/Uploaded_from_How_to_Add_Auth0_Authentication_to_Java_Application_in_5_Mins" alt="Web Applications"/></p><p>Select the <strong>Settings</strong> tab and fill out the form. Follow the steps below:</p><ul><li><strong>Allowed Callback URLs</strong>: e.g., <a href="http://localhost:9772/authorization-code/callback" target="_blank" rel="noreferrer noopener">http://localhost:9772/authorization-code/callback</a></li><li><strong>Allowed Logout URLs</strong>: e.g., <a href="http://localhost:9772" target="_blank" rel="noreferrer noopener">http://localhost:9772</a></li><li>Use the default settings for the remaining fields</li></ul><p>Then click <strong>SAVE CHANGES.</strong></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7BslNzTcUIOHNTBjtcscMd/c5f92a9e9e2f246a07eb2fbe2d4bae6e/java_03.png" alt="Settings"/></p><p>On the same page, be sure to save a copy of <strong>Domain</strong>, <strong>Client ID,</strong> and <strong>Client Secret</strong>. You will need these values later when establishing the connection.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/12JKUSCw0J4xGMFZHEFWM4/d3b70060bdb20ce32290cf0a8088281a/java_04.png" alt="Domain"/></p><p>Choose Users under the <strong>Users &amp; Roles</strong> Tab and create a test user.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2L6ryltJG4griEOuFLlzUJ/65aad91e89a23cc2309381b7ec5a0702/java_05.png" alt="Users &amp; Roles"/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/57E0DP3e3qZEhzTYkO8Prj/5b1093bd7494bebae007ff643c946f9a/Uploaded_from_How_to_Add_Auth0_Authentication_to_Java_Application_in_5_Mins" alt="Users &amp; Roles"/></p><p>You have now registered a web application on Auth0. Next, you will create a simple configuration in the DCMC.</p><h2 id="Step-2--Configurations-in-Datawiza-Cloud-Management-Console">Step 2: Configurations in Datawiza Cloud Management Console</h2><p>Then, log in to the <a href="https://console.datawiza.com/" target="_blank" rel="noreferrer noopener">Datawiza Cloud Management Console (DCMC)</a>. If you do not have a DCMC account, you can create one by email from the DCMC login page. Also, we provide social login and SSO functionality with Microsoft, GitHub, and Google to simplify logins for you.</p><p>The <strong>Get started</strong> function will guide you through the configuration. After logging in to the DCMC, click on the yellow ‚ÄúGet started‚Äù button and follow the steps.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1qnlBAo4ObfXE6kOPNEExN/3ac984608b96227445f338b5fbf90cfd/Uploaded_from_How_to_Add_Auth0_Authentication_to_Java_Application_in_5_Mins" alt="Get started"/></p><p>Enter some basic information, such as the deployment name and provisioning key name:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3QrulTuioxuOFocdMZz0HN/abc2a1ee268182235313546f04127c1c/java_06.png" alt="Information"/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3MZTaEuTTgp90bZ7rnugK5/87494ca141c7507833b8bbcdd367d6a5/java_07.png" alt="Information"/></p><p>Now <strong>Add an Application</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2FHLJeyXB9W9MDLaKEK1YC/fe5ca0c3fcb584b4a211ccb358f4e3f7/java_08.png" alt="Add an Application"/></p><p>Configure your application with the following values:</p><ul><li><strong>Platform</strong>: <em>Web</em></li><li><strong>App Name</strong>: <em>Demo App</em></li><li><strong>Public Domain</strong>: <em><a href="http://localhost:9772" target="_blank" rel="noreferrer noopener">http://localhost:9772</a></em></li><li><strong>Listen Port</strong>: <em>9772</em></li><li><strong>Upstream Servers</strong>: <em><a href="http://host.docker.internal:8080" target="_blank" rel="noreferrer noopener">http://host.docker.internal:8080</a></em></li><li><strong>Default Action</strong>: <em>Allow</em></li></ul><p>Note that <strong>Upstream Servers</strong> is the address of the Java application.</p><ul><li>If you use Mac or Windows, then set the Upstream Servers to <em><a href="http://host.docker.internal:8080" target="_blank" rel="noreferrer noopener">http://host.docker.internal:8080</a></em> (requires Docker 18.03+).</li><li>If you use Linux, use <em>ip addr show docker0</em> to get the docker host IP (e.g., 172.17.0.1) and then set Upstream Servers to <a href="http://172.17.0.1:8080" target="_blank" rel="noreferrer noopener">http://172.17.0.1:8080</a> (see <a href="https://stackoverflow.com/questions/24319662/from-inside-of-a-docker-container-how-do-i-connect-to-the-localhost-of-the-mach" target="_blank" rel="noreferrer noopener">this</a> for more details).</li></ul><p>Next <strong>Configure the IdP</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3NJsB2nqQyhVWaFcRwDv1h/04db1d78ff8749138eb4d3d7b21dda3d/java_09.png" alt="Configure the IdP"/></p><p>Select <strong>OIDC</strong> as the Protocol and <strong>Auth0</strong> as the Identity Provider. Input the <strong>Domain</strong>, <strong>Client ID,</strong> and the <strong>Client Secret</strong> you saved when creating the app in Auth0. Then click <strong>Create</strong>.</p><p>In the last step, we will provide the command lines to pull the DAB image and the docker-compose file to run the DAB.</p><p>Execute the command lines in steps 1 &amp; 2 and note down the docker-compose file in step 3.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6VDmHW6PtR3WzOyNcdysD5/292d99c072ab54d0927a4b07b829a764/java_10.jpg" alt="Add Auth0 Authentication"/></p><h2 id="Step-3--Run-DAB-as-a-Sidecar--Agent--to-Your-Application">Step 3: Run DAB as a Sidecar (Agent) to Your Application</h2><p>After finishing the configuration in DCMC, you can run the DAB with the YAML file noted in the previous step. The docker-compose YAML file, named <em>datawiza-access-broker.yaml</em> should then appear like this:</p><pre><code>version<span>:</span> <span>&#39;3&#39;</span>  
services<span>:</span>  
datawiza<span>-</span>access<span>-</span>broker<span>:</span>  
image<span>:</span> registry<span>.</span>gitlab<span>.</span>com<span>/</span>datawiza<span>/</span>access<span>-</span>broker  
container\_name<span>:</span> datawiza<span>-</span>access<span>-</span>broker  
restart<span>:</span> always  
ports<span>:</span>  
<span>-</span> <span>&#34;9772:9772&#34;</span>  
environment<span>:</span>  
<span>PROVISIONING</span>\_KEY<span>:</span> #############################  
<span>PROVISIONING</span>\_SECRET<span>:</span> #############################</code></pre><p>Now, we can use docker-compose to create and start the DAB:</p><pre><code>docker<span>-</span>compose <span>-</span>f datawiza<span>-</span>access<span>-</span>broker<span>.</span>yaml up <span>-</span>d</code></pre><p>That&#39;s it. After executing the command above, the Node.js application should have SSO enabled with Auth0.</p><p>Now, let&#39;s give it a try.</p><p>Open a browser and type in <strong><a href="http://localhost:9772" target="_blank" rel="noreferrer noopener">http://localhost:9772</a></strong>. You should see the Auth0 login page as follows:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7vZUQEx0L1ahWKl3DSB5le/42b46194e44dec3c510900bce5f8a0ba/Uploaded_from_How_to_Add_Auth0_Authentication_to_Java_Application_in_5_Mins" alt="Auth0 login"/></p><p>After logging in to Auth0, the Java web application will be shown.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1xKW0FnBZnh3QMK5d3MiLB/443be2a918e0f2d08f9b3f7d9c7c8884/java_11.png" alt="Auth0"/></p><h2 id="Summary">Summary</h2><p>Congratulations! You secured a Java web application by adding Auth0 authentication using Datawiza -- in minutes instead of weeks or months. This is only a small sampling of what Datawiza can do. See <a href="https://docs.datawiza.com" target="_blank" rel="noreferrer noopener">Datawiza‚Äôs online docs</a> or <a href="https://datawiza.com" target="_blank" rel="noreferrer noopener">official website</a> for much more information.</p></div></div>]]></content:encoded>
      <author>Weiyu Fang</author>
      <pubDate>Thu, 09 Dec 2021 15:24:00 +0000</pubDate>
    </item>
    <item>
      <title>Secure a Clojure Web API with Auth0</title>
      <link>https://auth0.com/blog/secure-a-clojure-web-api-with-auth0/</link>
      <description>Learn how to secure a Clojure Web API with Auth0</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In my <a href="https://auth0.com/blog/create-an-api-server-with-clojure-and-pedestal/" target="_blank" rel="noreferrer noopener">previous article</a>, we built a simple Web API in Clojure with the Pedastal framework. We covered some core concepts essential to know for writing Clojure and serving data on the web.</p><p>It was a great start! But the very next thing we should consider when building a Web API is making sure that it&#39;s secured. </p><h2 id="Requirements">Requirements</h2><p>Of course, you&#39;ll want the source code that we ended up with at the close of the previous article. You&#39;ll also need to sign up for a free Auth0 account. You won&#39;t need a credit card, and this will be the simplest way for us to add basic Authentication.</p><h3 id="Interceptors-explained">Interceptors explained</h3><p>We have already used Interceptors while building our application. From our previous article:</p><blockquote><p>Simply put, they let you layer functions to create a &#34;pipeline&#34; to handle web requests.</p></blockquote><p>They can also be used for responses, as we&#39;ve seen with our JSON serialization example above.</p><h3 id="Building-a-base-interceptor">Building a base interceptor</h3><p>In Pedestal, an interceptor is nothing more than a map with a <code><span>:</span>name</code> along with <code><span>:</span>enter</code>,  <code><span>:</span>leave</code>, and <code><span>:</span>error</code> keys. The name is (you guessed it) the name, while the last three items represent optional keys that receive a <a href="http://pedestal.io/reference/context-map" target="_blank" rel="noreferrer noopener">context map</a> as an argument. Each of these keys is executed when the request is coming in when the response is being sent, and if an error happens along the way. You&#39;ll need to include at least one of these functions for this to count as an interceptor!</p><p>For instance, let&#39;s say we want to create an interceptor that inserts a specific response header for every response we send. To accomplish this, all we need to do is create a map with a function on the <code><span>:</span>leave</code> keyword and associate the header:</p><pre><code><span>(</span><span>def</span> header-interceptor <span>{</span>
 <span>:name</span> <span>&#34;header-interceptor&#34;</span>
 <span>:leave</span> <span>(</span><span>fn</span> <span>[</span>ctx<span>]</span> <span>(</span>assoc-in ctx <span>[</span><span>:response</span> <span>:headers</span> <span>&#34;AppName&#34;</span><span>]</span> <span>&#34;Pedestal-Auth0-App&#34;</span><span>)</span><span>)</span><span>}</span><span>)</span></code></pre><p>Pedestal also offers helpers to write a specific type of interceptor without having to specify the entire map. Here&#39;s that same function using these helpers:</p><pre><code><span>(</span>require <span>&#39;io</span>.pedestal.interceptors.helpers <span>:as</span> helpers<span>)</span>
 
<span>(</span><span>def</span> header-interceptor <span>(</span>helpers/on-response <span>(</span><span>fn</span> <span>[</span>response<span>]</span> <span>(</span>assoc-in response <span>[</span><span>:headers</span> <span>&#34;AppName&#34;</span><span>]</span> <span>&#34;Pedestal-Auth0-App&#34;</span><span>)</span><span>)</span><span>)</span><span>)</span></code></pre><p>Armed with a basic understanding of interceptors in Pedastal, we can now set up an Auth0 account and then write our interceptor to validate any tokens provided in a request.</p><h2 id="Validating-a-Token">Validating a Token</h2><p>In an OAuth-compliant application, Identity providers must provide information to validate JWT tokens that they issue. Many frameworks and languages create black boxes where you provide some configuration parameters, and they do the rest. We&#39;re going to go into a bit more detail in this application. Here are some basic concepts to understand:</p><h3 id="JSON-Web-Tokens">JSON Web Tokens</h3><p>Most documentation sources and developers shorten JSON Web Tokens to just JWT. JWTs are essentially long strings that encode JSON, and are frequently used for Authentication and Authorization. Identity providers issue JWTs and include information relevant to the apps that use them, such as your name, email address, or permissions for that app. If you&#39;re unfamiliar with JWTs I highly suggest <a href="https://auth0.com/docs/security/tokens/json-web-tokens" target="_blank" rel="noreferrer noopener">Auth0&#39;s documentation</a> on the matter. When issued by an Identity provider, they&#39;re often signed so that you can know they&#39;re authentic, which leads us to...</p><h3 id="JSON-Web-Key-Set">JSON Web Key Set</h3><p>JSON Web Key Set&#39;s acronym is JWKS. We&#39;ll use the acronym for the remainder of this article. This key set contains the <em>public</em> keys that say, &#34;Yeah, I made that token.&#34; The Identity provider has used a separate and private cryptographic key to construct the token. This process that allows for a public verification key and a private construction key is called asymmetric encryption. </p><p>We&#39;ll need to retrieve the location of the JSON Web Key set for our Identity provider when we create a new Application in the Auth0 portal so we can verify JWTs. You can read a bit more about the concept in the <a href="https://auth0.com/docs/security/tokens/json-web-tokens/json-web-key-sets" target="_blank" rel="noreferrer noopener">Auth0 documentation</a>. </p><h3 id="Create-a-new-Auth0-application">Create a new Auth0 application</h3><p>Before writing the code to validate a token issued by an identity provider effectively, let&#39;s quickly review a couple of steps necessary to set up Auth0.</p><p>Once we&#39;ve logged in, select Applications -&gt; APIs from the left menu and create a new API. For demo purposes, we can just put a random name and an identifier. In my case, I am going to be using <code>clojure<span>-</span>pedestal</code> for both.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3IGLaJE64V2cWe3X4tahSX/70f98430ee2beab09b258e52f6ad5006/clojure_04.png" alt="Creating a new API in Auth0"/></p><p>When confirming the operation, Auth0 will also create a default Test application for the new API. Click on Applications -&gt; Applications on the left menu to review the application&#39;s details. From the <strong>Settings</strong> tab, we will need to grab the domain. This is the base URL we&#39;ll need to determine a JWKS location.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7qAlQDPvlD9qLqx4k2cznV/bb18a3cbaaef5e58d31524cd5d8eadf0/clojure_05.png" alt="The Application settings we&#39;ll need to configure in Clojure"/></p><p>In this example, since my domain is <a href="https://dev-q6rh8--8.us.auth0.com/" target="_blank" rel="noreferrer noopener">https://dev-q6rh8--8.us.auth0.com/</a>, my JWKS URL will be <a href="https://dev-q6rh8--8.us.auth0.com/.well-known/jwks.json" target="_blank" rel="noreferrer noopener">https://dev-q6rh8--8.us.auth0.com/.well-known/jwks.json</a></p><p>Auth0 offers several Java libraries to work with JWT and JWK. Since Clojure has a good interoperability story with Java, we can use these libraries to write our interceptor.</p><p>If you&#39;ve been writing Clojure for a little bit this should be simple. We will take it easy for this article and use a third-party Clojure library that will do most of the work. If you&#39;re curious/eager to see what using the Auth0 Java libraries would look like, you can take a look at the reference implementation that accomplishes the same thing at the end of this article.</p><p>The first thing we&#39;re going to do is to add a library providing the helpers we need to decode and verify the JWT in <code>deps<span>.</span>edn</code>:</p><pre><code>{:paths [&#34;src&#34;]
:deps {io.pedestal/pedestal.service {:mvn/version &#34;0.5.9&#34;}
<span><span> </span><span>      io.pedestal/pedestal.route {:mvn/version &#34;0.5.9&#34;}
</span><span> </span><span>      io.pedestal/pedestal.immutant {:mvn/version &#34;0.5.9&#34;}
</span><span> </span><span>      org.slf4j/slf4j-simple {:mvn/version &#34;1.7.32&#34;}
</span></span><span><span>-</span><span>        environ/environ {:mvn/version &#34;1.2.0&#34;}}}
</span></span><span><span>+</span><span>        environ/environ {:mvn/version &#34;1.2.0&#34;}
</span><span>+</span><span>        no.nsd/clj-jwt {:git/url &#34;https://gitlab.nsd.no/clojure/clj-jwt.git&#34; :git/sha &#34;bc23acb3c7cbf0d2def2d395c3e3d9c405be28d5&#34;}}}</span></span></code></pre><p>We can see that the <code>clj<span>-</span>jwt</code> has been imported from the repository directly instead of the Maven Central registry. This is a legitimate use case, and it works out of the box with <code>tools<span>.</span>deps</code>.</p><p>Let&#39;s now create a new file <code>src<span>/</span>app<span>/</span>jwt<span>.</span>clj</code>, and use the following code:</p><pre><code><span>(</span><span>ns</span> app.jwt <span>(</span><span>:require</span> <span>[</span>no.nsd.clj-jwt <span>:as</span> clj-jwt<span>]</span>
                      <span>[</span>io.pedestal.interceptor.helpers <span>:as</span> interceptor<span>]</span><span>)</span><span>)</span>
 
<span>(</span><span>defn-</span> unauthorized <span>[</span>text<span>]</span>
 <span>{</span><span>:status</span>  <span>401</span>
  <span>:headers</span> <span>{</span><span>}</span>
  <span>:body</span>    text<span>}</span><span>)</span> <span>; Helper to return a 401 status code</span>
 
<span>(</span><span>defn</span> decode-jwt <span>[</span><span>{</span><span>:keys</span> <span>[</span>required? jwk-endpoint<span>]</span><span>}</span><span>]</span>
 <span>(</span>interceptor/before
  <span>::decode-jwt</span>
  <span>(</span><span>fn</span> <span>[</span>ctx<span>]</span> <span>(</span><span>if-let</span> <span>[</span>auth-header <span>(</span>get-in ctx <span>[</span><span>:request</span> <span>:headers</span> <span>&#34;authorization&#34;</span><span>]</span><span>)</span><span>]</span>
              <span>(</span><span>try</span> <span>(</span><span>-&gt;&gt;</span> auth-header
                        <span>(</span>clj-jwt/unsign jwk-endpoint<span>)</span>
                        <span>(</span>assoc-in ctx <span>[</span><span>:request</span> <span>:claims</span><span>]</span><span>)</span><span>)</span>
 
                   <span>(</span>catch Exception _
                     <span>(</span><span>assoc</span> ctx <span>:response</span> <span>(</span>unauthorized <span>&#34;The token provided is not valid&#34;</span><span>)</span><span>)</span><span>)</span><span>)</span>
 
              <span>(</span><span>if</span> required? <span>(</span><span>assoc</span> ctx <span>:response</span> <span>(</span>unauthorized <span>&#34;Token not provided&#34;</span><span>)</span><span>)</span>
                  <span>(</span>assoc-in ctx <span>[</span><span>:request</span> <span>:claims</span><span>]</span> <span>{</span><span>}</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span></code></pre><p>We can now import and apply our interceptor in our web application by updating core.clj:</p><pre><code><span>(</span><span>ns</span> app.core <span>(</span><span>:require</span> <span>[</span>io.pedestal.http <span>:as</span> http<span>]</span>
                       <span>[</span>io.pedestal.interceptor.helpers <span>:as</span> helpers<span>]</span>
                       <span>[</span>app.jwt <span>:refer</span> <span>[</span>decode-jwt<span>]</span><span>]</span> <span>;Add the reference to the new class</span>
                       <span>[</span>environ.core <span>:refer</span> <span>[</span>env<span>]</span><span>]</span><span>)</span><span>)</span>
                       
<span>..</span>.

<span>(</span><span>def</span> jwk-endpoint <span>&#34;https://application-name.us.auth0.com/.well-known/jwks.json&#34;</span><span>)</span>
 
<span>(</span><span>def</span> service-map <span>(</span><span>-&gt;</span> <span>{</span><span>::http</span>/routes routes
                     <span>::http</span>/type   <span>:immutant</span>
                     <span>::http</span>/host   <span>&#34;0.0.0.0&#34;</span>
                     <span>::http</span>/join?  <span>false</span>
                     <span>::http</span>/port   <span>(</span>Integer. <span>(</span><span>or</span> <span>(</span>env <span>:port</span><span>)</span> <span>5000</span><span>)</span><span>)</span><span>}</span>
                http/default-interceptors
                <span>(</span>update <span>::http</span>/interceptors <span>into</span> <span>[</span>http/json-body
                                                  <span>(</span>decode-jwt <span>{</span><span>:required</span>? <span>true</span>
                                                               <span>:jwk-endpoint</span> jwk-endpoint<span>}</span><span>)</span><span>]</span><span>)</span><span>)</span><span>)</span></code></pre><p>And now we can try to send some requests. To obtain a valid JWT token, we would theoretically have to complete an oAuth2 flow. For testing purposes, Auth0&#39;s UI offers a token for your current username that you can grab directly from the &#34;Test&#34; tab of the API:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5JO6ewpLrkkRItejcsrevD/af2f21dd6118f8d561f9f1255943ae31/clojure_06.png" alt="Getting test information from the Auth0 Portal"/></p><p>Now, let&#39;s send three requests to our API:</p><ol start="1"><li>One with that JWT added correctly to the headers</li><li>One with an invalid JWT added to the headers</li><li>One with no JWT or additional headers at all</li></ol><p>The first should be successful, with the remainder being rebuffed with a 401 HTTP status code by our new interceptor.</p><pre><code><span>curl</span> http://localhost:5000/ --header <span>&#39;authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ikhsb2NuQ1ZiRFRzdjVMTEs5d2RpeiJ9.eyJpc3MiOiJodHRwczovL3ZuY3oudXMuYXV0aDAuY29tLyIsInN1YiI6IldJeVUybTdZY3BWMHlCeU52dVNHSGpWUEEzYXFRbnA5QGNsaWVudHMiLCJhdWQiOiIvZGV2L251bGwiLCJpYXQiOjE2MzE4Mjk3NTQsImV4cCI6MTYzMTkxNjE1NCwiYXpwIjoiV0l5VTJtN1ljcFYweUJ5TnZ1U0dIalZQQTNhcVFucDkiLCJndHkiOiJjbGllbnQtY3JlZGVudGlhbHMifQ.tvzoDnqE5GWfqUKl0XbFtJBv_E3704qDoMOb9YheRj-409ntIcLs02UKVbR1g28-fDEPcQ-IxGRTBcOPEYy7X0HB-IByPCDink_Kj-hJ5O_2ft9I_lYZFOmeRL7TqD3TF9S17hta5UAFEj9zxQ_c_gcI7VY0F3t7iMfe3pNu9ut1l9-iYqjJ_BNCf-pxfQpWqnfQCnjU1qStGHPRmaK1dzXFIdXnH8S0rixcsuaxt5sbFivCIuQTNZ8QxvsW-vJekW1T2IkFOlGRWWWUoKTW2j4PnFlMWnCm7O91xR0zEaAHdQkmAob323qJf9IgucGxD3emX1k_ugLHdfnpvELaEQ&#39;</span>
<span>&lt;</span> HTTP/1.1 <span>200</span> OK
 
<span>curl</span> http://localhost:5000/ --header <span>&#39;authorization: Bearer thisIsInvalid&#39;</span>
<span>&lt;</span> HTTP/1.1 <span>401</span> Unauthorized
 
<span>curl</span> http://localhost:5000/
<span>&lt;</span> HTTP/1.1 <span>401</span> Unauthorized</code></pre><p>Our interceptor is now checking out all the requests and ensuring a valid token is included before moving on.</p><p>To give more detail about how JWTs work, we can also create a new route to return the claims encoded in the token to the sender. Update core.clj again:</p><pre><code>‚Ä¶
‚Ä¶
<span>(</span><span>defn</span> get-claims <span>[</span>req<span>]</span> <span>{</span><span>:status</span> <span>200</span> <span>:body</span> <span>(</span><span>:claims</span> req<span>)</span><span>}</span><span>)</span> <span>; Add a new route returning the claims on the request object</span>
 
<span>(</span><span>def</span> routes #<span>{</span><span>[</span><span>&#34;/heroes/:hero&#34;</span> <span>:get</span> get-hero <span>:route-name</span> <span>:get-hero</span><span>]</span>
             <span>[</span><span>&#34;/heroes&#34;</span> <span>:get</span> get-heroes <span>:route-name</span> <span>:get-heroes</span><span>]</span>
             <span>[</span><span>&#34;/claims&#34;</span> <span>:get</span> get-claims <span>:route-name</span> <span>:get-claims</span><span>]</span>
             <span>[</span><span>&#34;/&#34;</span> <span>:get</span> hello-world <span>:route-name</span> <span>:hello-world</span><span>]</span><span>}</span><span>)</span></code></pre><pre><code><span>curl</span> http://localhost:5000/claims --header <span>&#39;authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ikhsb2NuQ1ZiRFRzdjVMTEs5d2RpeiJ9.eyJpc3MiOiJodHRwczovL3ZuY3oudXMuYXV0aDAuY29tLyIsInN1YiI6IldJeVUybTdZY3BWMHlCeU52dVNHSGpWUEEzYXFRbnA5QGNsaWVudHMiLCJhdWQiOiIvZGV2L251bGwiLCJpYXQiOjE2MzE4Mjk3NTQsImV4cCI6MTYzMTkxNjE1NCwiYXpwIjoiV0l5VTJtN1ljcFYweUJ5TnZ1U0dIalZQQTNhcVFucDkiLCJndHkiOiJjbGllbnQtY3JlZGVudGlhbHMifQ.tvzoDnqE5GWfqUKl0XbFtJBv_E3704qDoMOb9YheRj-409ntIcLs02UKVbR1g28-fDEPcQ-IxGRTBcOPEYy7X0HB-IByPCDink_Kj-hJ5O_2ft9I_lYZFOmeRL7TqD3TF9S17hta5UAFEj9zxQ_c_gcI7VY0F3t7iMfe3pNu9ut1l9-iYqjJ_BNCf-pxfQpWqnfQCnjU1qStGHPRmaK1dzXFIdXnH8S0rixcsuaxt5sbFivCIuQTNZ8QxvsW-vJekW1T2IkFOlGRWWWUoKTW2j4PnFlMWnCm7O91xR0zEaAHdQkmAob323qJf9IgucGxD3emX1k_ugLHdfnpvELaEQ&#39;</span> -v
<span>&lt;</span> HTTP/1.1 <span>200</span> OK
<span>&lt;</span> Content-Type: application/json<span>;</span><span>charset</span><span>=</span>UTF-8
 
<span>{</span><span>&#34;iss&#34;</span><span>:</span><span>&#34;https://dev-q6rh8--8.us.auth0.com/&#34;</span>,<span>&#34;sub&#34;</span><span>:</span><span>&#34;WIyU2m7YcpV0yByNvuSGHjVPA3aqQnp9@clients&#34;</span>,<span>&#34;aud&#34;</span><span>:</span><span>&#34;clojure-pedestal&#34;</span>,<span>&#34;iat&#34;</span>:1631829754,<span>&#34;exp&#34;</span>:1631916154,<span>&#34;azp&#34;</span><span>:</span><span>&#34;WIyU2m7YcpV0yByNvuSGHjVPA3aqQnp9&#34;</span>,<span>&#34;gty&#34;</span><span>:</span><span>&#34;client-credentials&#34;</span><span>}</span></code></pre><h2 id="Conclusions">Conclusions</h2><p>Building your own Authentication handler isn&#39;t an everyday activity in modern web development. Many devs will go their entire career without having to configure JWKS URLs or decoding claims in a token - instead, they&#39;ll plug in a library with nice documentation and hope that it works. </p><p>Clojure and Pedastal let you take a much better look under the hood at this essential process. Even better, the language and framework make this process incredibly easy to show in a tiny Web API project.</p><p>To get more information about Pedestal, its roadmap, and documentation, you can refer to the <a href="http://pedestal.io" target="_blank" rel="noreferrer noopener">official website</a>.</p><p>We&#39;ll try to see something more complicated in the next installment, such as database interactions with <a href="https://datomic.com" target="_blank" rel="noreferrer noopener">Datomic</a></p><h3 id="Using-Auth0-Java-Libraries">Using Auth0 Java Libraries</h3><p>For reference, this is what implementing the same JWT decoder/verifier would look like using the official Auth0 SDK.</p><pre><code><span>(</span><span>ns</span> app.auth
 <span>(</span><span>:require</span> <span>[</span>cheshire.core <span>:as</span> json<span>]</span>
           <span>[</span>io.pedestal.interceptor.helpers <span>:as</span> interceptor<span>]</span><span>)</span>
 <span>(</span><span>:import</span> <span>(</span>java.net URL<span>)</span>
          <span>(</span>com.auth0.jwt JWT<span>)</span>
          <span>(</span>com.auth0.jwt.exceptions SignatureVerificationException AlgorithmMismatchException TokenExpiredException JWTVerificationException JWTDecodeException<span>)</span>
          <span>(</span>com.auth0.jwt.algorithms Algorithm<span>)</span>
          <span>(</span>com.auth0.jwk UrlJwkProvider<span>)</span>
          <span>(</span>com.auth0.jwt.interfaces RSAKeyProvider<span>)</span>
          <span>(</span>org.apache.commons.codec Charsets<span>)</span>
          <span>(</span>org.apache.commons.codec.binary Base64<span>)</span><span>)</span><span>)</span>
 
<span>(</span><span>defn-</span> new-jwk-provider
 <span>[</span>url<span>]</span>
 <span>(</span><span>-&gt;</span> <span>(</span>URL. url<span>)</span>
     UrlJwkProvider.<span>)</span><span>)</span>
 
<span>(</span><span>def</span> ^<span>{</span><span>:private</span> <span>true</span><span>}</span> rsa-key-provider
 <span>(</span>memoize
  <span>(</span><span>fn</span> <span>[</span>url<span>]</span>
    <span>(</span><span>let</span> <span>[</span>jwk-provider <span>(</span>new-jwk-provider url<span>)</span><span>]</span>
      <span>(</span>reify RSAKeyProvider
        <span>(</span>getPublicKeyById <span>[</span>_ key-id<span>]</span>
          <span>(</span><span>-&gt;</span> <span>(</span>.<span>get</span> jwk-provider key-id<span>)</span>
              <span>(</span>.getPublicKey<span>)</span><span>)</span><span>)</span>
        <span>(</span>getPrivateKey <span>[</span>_<span>]</span> <span>nil</span><span>)</span>
        <span>(</span>getPrivateKeyId <span>[</span>_<span>]</span> <span>nil</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span>
 
<span>(</span><span>defn-</span> base64-&gt;<span>map</span>
 <span>[</span>base64-str<span>]</span>
 <span>(</span><span>-&gt;</span> base64-str
     Base64/decodeBase64
     <span>(</span>String. Charsets/UTF_8<span>)</span>
     json/parse-string<span>)</span><span>)</span>
 
<span>(</span><span>defn-</span> decode-token
 <span>[</span>algorithm token <span>{</span><span>:keys</span> <span>[</span>issuer leeway-seconds<span>]</span><span>}</span><span>]</span>
 <span>(</span><span>let</span> <span>[</span><span>add</span>-issuer #<span>(</span><span>if</span> issuer
                     <span>(</span>.withIssuer % <span>(</span><span>into-array</span> String <span>[</span>issuer<span>]</span><span>)</span><span>)</span>
                     %<span>)</span><span>]</span>
   <span>(</span><span>-&gt;</span> algorithm
       <span>(</span>JWT/require<span>)</span>
       <span>(</span>.acceptLeeway <span>(</span><span>or</span> leeway-seconds <span>0</span><span>)</span><span>)</span>
       <span>add</span>-issuer
       .build
       <span>(</span>.verify token<span>)</span>
       .getPayload
       base64-&gt;<span>map</span><span>)</span><span>)</span><span>)</span>
 
<span>(</span><span>defn-</span> decode <span>[</span>token <span>{</span><span>:keys</span> <span>[</span>jwk-endpoint<span>]</span> <span>:as</span> opts<span>}</span><span>]</span>
 <span>(</span><span>-&gt;</span> <span>(</span>Algorithm/RSA256 <span>(</span>rsa-key-provider jwk-endpoint<span>)</span><span>)</span>
     <span>(</span>decode-token token opts<span>)</span><span>)</span><span>)</span>
 
<span>(</span><span>defn-</span> find-token <span>[</span><span>{</span><span>:keys</span> <span>[</span>headers<span>]</span><span>}</span><span>]</span>
 <span>(</span>some-&gt;<span>&gt;</span> headers
          <span>(</span><span>filter</span> #<span>(</span>.equalsIgnoreCase <span>&#34;authorization&#34;</span> <span>(</span><span>key</span> %<span>)</span><span>)</span><span>)</span>
          <span>first</span>
          <span>val</span>
          <span>(</span><span>re-find</span> #<span>&#34;(?i)^Bearer (.+)$&#34;</span><span>)</span>
          <span>last</span><span>)</span><span>)</span>
 
<span>(</span><span>defn-</span> unauthorized <span>[</span>text<span>]</span>
 <span>{</span><span>:status</span>  <span>401</span>
  <span>:headers</span> <span>{</span><span>}</span>
  <span>:body</span>    text<span>}</span><span>)</span>
 
<span>(</span><span>defn</span> decode-jwt <span>[</span><span>{</span><span>:keys</span> <span>[</span>required?<span>]</span> <span>:as</span> opts<span>}</span><span>]</span>
 <span>(</span>interceptor/before
  <span>::decode-jwt</span>
  <span>(</span><span>fn</span> <span>[</span>ctx<span>]</span>
    <span>(</span><span>try</span>
      <span>(</span><span>if-let</span> <span>[</span>token <span>(</span>find-token <span>(</span><span>:request</span> ctx<span>)</span><span>)</span><span>]</span>
        <span>(</span><span>-&gt;&gt;</span> <span>(</span>decode token opts<span>)</span>
             <span>(</span>assoc-in ctx <span>[</span><span>:request</span> <span>:claims</span><span>]</span><span>)</span><span>)</span>
        <span>(</span><span>if</span> required? <span>(</span><span>assoc</span> ctx <span>:response</span> <span>(</span>unauthorized <span>&#34;Token not provided&#34;</span><span>)</span><span>)</span>
            <span>(</span>assoc-in ctx <span>[</span><span>:request</span> <span>:claims</span><span>]</span> <span>{</span><span>}</span><span>)</span><span>)</span><span>)</span>
 
      <span>(</span>catch JWTDecodeException _
        <span>(</span><span>assoc</span> ctx <span>:response</span> <span>(</span>unauthorized <span>&#34;The token provided is not valid&#34;</span><span>)</span><span>)</span><span>)</span>
 
      <span>(</span>catch SignatureVerificationException _
        <span>(</span><span>assoc</span> ctx <span>:response</span> <span>(</span>unauthorized <span>&#34;Signature could not be verified&#34;</span><span>)</span><span>)</span><span>)</span>
 
      <span>(</span>catch AlgorithmMismatchException _
        <span>(</span><span>assoc</span> ctx <span>:response</span> <span>(</span>unauthorized <span>&#34;Algorithm verification problem&#34;</span><span>)</span><span>)</span><span>)</span>
 
      <span>(</span>catch TokenExpiredException _
        <span>(</span><span>assoc</span> ctx <span>:response</span> <span>(</span>unauthorized <span>&#34;Token has expired&#34;</span><span>)</span><span>)</span><span>)</span>
 
      <span>(</span>catch JWTVerificationException _
        <span>(</span><span>assoc</span> ctx <span>:response</span> <span>(</span>unauthorized <span>&#34;Invalid claims&#34;</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span><span>)</span></code></pre></div></div>]]></content:encoded>
      <author>Set up the authorization interceptor in Pedestal</author>
      <pubDate>Wed, 08 Dec 2021 15:03:00 +0000</pubDate>
    </item>
    <item>
      <title>Create an API server with Clojure and Pedestal</title>
      <link>https://auth0.com/blog/create-an-api-server-with-clojure-and-pedestal/</link>
      <description>Build your first web API in the functional programming world of Clojure with this step-by-step guide</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><h2 id="Introduction">Introduction</h2><p>This article will walk you through building a web API using Pedastal, a Clojure web framework. <a href="http://pedestal.io/" target="_blank" rel="noreferrer noopener">Pedastal</a> is focused on APIs first and exemplifies the very best possibilities of Clojure&#39;s functional paradigm.</p><p>You&#39;ll put together a basic project with the necessary dependencies and serve up some basic information about superheroes. In a later article, we&#39;ll also secure the API using a collection of best practices and Auth0!</p><h2 id="Requirements">Requirements</h2><p>For this tutorial, you won&#39;t need much out of the box. Be sure you&#39;ve:</p><ol start="1"><li>Installed the <a href="https://www.oracle.com/java/technologies/downloads/" target="_blank" rel="noreferrer noopener">JDK</a>. This tutorial was written with the latest and greatest version of Java.</li><li>If you&#39;re on windows, set JAVA_HOME as an environment variable.</li><li>Wondered why JAVA_HOME isn&#39;t set by the JDK installation in 2021</li><li>Installed <a href="https://clojure.org/guides/getting_started" target="_blank" rel="noreferrer noopener">Clojure</a></li></ol><p>Open up your command-line interface and check that you&#39;re good to go:</p><pre><code>clj --version
 
Clojure CLI version <span>1.10</span>.3.967</code></pre><h2 id="Setup-a-New-Clojure-Project">Setup a New Clojure Project</h2><blockquote><p>If you&#39;re brand new to Clojure, check out <a href="https://auth0.com/blog/why-developers-should-look-into-clojure/" target="_blank" rel="noreferrer noopener">&#34;Why Developers Should Look into Clojure&#34;</a> first.</p></blockquote><p>Clojure&#39;s ecosystem provides several build and dependency management tools. While <a href="https://leiningen.org" target="_blank" rel="noreferrer noopener">Leiningen</a> and <a href="https://github.com/boot-clj/boot/" target="_blank" rel="noreferrer noopener">Boot</a> provide this functionality and have been around a while, the Clojure team has provided the solution we&#39;ll be using for this article  <a href="https://clojure.org/guides/deps_and_cli" target="_blank" rel="noreferrer noopener">tools.deps</a>.</p><p>Skipping Leiningen reduces the number of things we need to install. <strong>tools.deps</strong> is included with the Clojure CLI and satisfies all of the requirements for this article, so you should be set.</p><p>Like <code><span>package</span><span>.</span>json</code> for Node, <code>pom<span>.</span>xml</code> for Maven projects, and <code>requirements<span>.</span>txt</code> in Python, Clojure&#39;s CLI uses a single file to manage its dependencies. Create a root folder (<code>clojure<span>-</span>pedastal</code>) for your project on your system and, in it, create a file called <code>deps<span>.</span>edn</code>.</p><p><code>deps<span>.</span>edn</code> contains dependencies (for different environments, like development or production), additional commands/scripts, and much more. We&#39;ll keep it simple for now - but do know that EDN stands for <a href="https://github.com/edn-format/edn" target="_blank" rel="noreferrer noopener">&#34;Extensible Data Notation&#34;</a> and is used across the Clojure universe.</p><h3 id="Add-dependencies">Add dependencies</h3><p>For your Web API, you&#39;ll need to install a couple of Pedastal packages. In addition, we&#39;ll include some defacto-standard libraries for <a href="http://www.slf4j.org/" target="_blank" rel="noreferrer noopener">logging</a> and accessing <a href="https://github.com/weavejester/environ" target="_blank" rel="noreferrer noopener">environment variables</a>. </p><p>There&#39;s no &#34;install dependency&#34; command available in the Clojure CLI. Instead, we&#39;ll itemize what we need within <code>deps<span>.</span>edn</code>. When we invoke the Clojure CLI, it&#39;ll look into the file and download artifacts from our maven registry. You declare dependencies in the main hash-map, under the <code><span>:</span>deps</code> keyword. Here&#39;s what your <code>deps<span>.</span>edn</code> should look like:</p><pre><code><span>{</span><span>:paths</span> <span>[</span><span>&#34;src&#34;</span><span>]</span>
<span>:deps</span> <span>{</span>io.pedestal/pedestal.service <span>{</span><span>:mvn</span>/version <span>&#34;0.5.9&#34;</span><span>}</span>
       io.pedestal/pedestal.route <span>{</span><span>:mvn</span>/version <span>&#34;0.5.9&#34;</span><span>}</span>
       io.pedestal/pedestal.immutant <span>{</span><span>:mvn</span>/version <span>&#34;0.5.9&#34;</span><span>}</span>
       org.slf4j/slf4j-simple <span>{</span><span>:mvn</span>/version <span>&#34;1.7.32&#34;</span><span>}</span>
       environ/environ <span>{</span><span>:mvn</span>/version <span>&#34;1.2.0&#34;</span><span>}</span><span>}</span><span>}</span></code></pre><h3 id="Add-core-clj">Add core.clj</h3><p>Within your project folder, create two folders in sequence: <code>src</code> and <code>app</code>. Within <code>app</code>, add <code>core<span>.</span>clj</code>. your directory should look like this:</p><pre><code>clojure<span>-</span>pedastal
<span>|</span>   deps<span>.</span>edn
<span>|</span>___src
    <span>|</span>
    <span>|</span>___app
        core<span>.</span>clj</code></pre><blockquote><p>Because of how the JVM constructs the classpath, it is important that the namespace and the path of the file match. For instance, if we have a namespace called <code>app<span>.</span>core<span>.</span>models<span>.</span>user</code>, the file will have to be <code>src<span>/</span>app<span>/</span>core<span>/</span>models<span>/</span>users<span>.</span>clj</code>.</p></blockquote><h2 id="Pedestal-Fundamentals">Pedestal Fundamentals</h2><h3 id="Hello-world">Hello world</h3><p>Let&#39;s walk through the fundamental steps to have an HTTP Web API listening for requests and returning data.</p><p>In <code>core<span>.</span>clj</code>, declare a namespace called <code>app<span>.</span>core</code> and require some of the dependencies we&#39;re using. Avoid spending time understanding what we&#39;re using each dependency for; it will be more apparent once we write some code.</p><pre><code><span>(</span><span>ns</span> app.core <span>(</span><span>:require</span> <span>[</span>io.pedestal.http <span>:as</span> http<span>]</span>
                       <span>[</span>environ.core <span>:refer</span> <span>[</span>env<span>]</span><span>]</span><span>)</span><span>)</span></code></pre><p>To create a functioning server, you&#39;ll need to:</p><ul><li>Define the <strong>handler</strong> for a specific route</li><li>Define the <strong>routes</strong> and attach them to handlers</li><li>Create a <strong>service map</strong> containing some configuration options</li><li>Create a <strong>server instance</strong> and then run it</li></ul><p>This is what some basic code to accomplish those goals should look like:</p><pre><code><span>(</span><span>defn</span> hello-world <span>[</span>_<span>]</span> <span>{</span><span>:status</span> <span>200</span> <span>:body</span> <span>&#34;Hello&#34;</span><span>}</span><span>)</span> <span>; Route handler</span>
 
<span>(</span><span>def</span> service-map <span>{</span><span>::http</span>/routes #<span>{</span><span>[</span><span>&#34;/&#34;</span> <span>:get</span> hello-world <span>:route-name</span> <span>:hello-world</span><span>]</span><span>}</span> <span>; Routes</span>
             <span>::http</span>/type   <span>:immutant</span>
             <span>::http</span>/host   <span>&#34;0.0.0.0&#34;</span>
             <span>::http</span>/join?  <span>false</span>
             <span>::http</span>/port   <span>(</span>Integer. <span>(</span><span>or</span> <span>(</span>env <span>:port</span><span>)</span> <span>5000</span><span>)</span><span>)</span><span>}</span><span>)</span> <span>; Service map</span>
 
<span>(</span><span>defn</span> -main <span>[</span>_<span>]</span> <span>(</span><span>-&gt;</span> service-map http/create-server http/start<span>)</span><span>)</span> <span>; Server Instance</span></code></pre><p>That&#39;s it! With just this code and our packages, we can now run the server and try it out. From your root directory, run:</p><pre><code>clj -X app.core/-main</code></pre><p>...and then you can use <code>curl</code> to test the Web API ...</p><pre><code><span>curl</span> http://localhost:5000
Hello</code></pre><h3 id="Routing-fundamentals">Routing fundamentals</h3><p>Next up is using Pedestal&#39;s intuitive routing features to return some data. We&#39;ll also filter and expand that data at different endpoints when necessary.</p><p>As you work through these instructions, start just under your namespace declaration.</p><p>Once again, in <code>core<span>.</span>clj</code>, define some static superhero data to play with:</p><pre><code><span>(</span><span>def</span> heroes <span>[</span><span>{</span><span>:name</span> <span>&#34;Clark&#34;</span> <span>:surname</span> <span>&#34;Kent&#34;</span>  <span>:hero</span> <span>&#34;Superman&#34;</span><span>}</span>
             <span>{</span><span>:name</span> <span>&#34;Bruce&#34;</span> <span>:surname</span> <span>&#34;Wayne&#34;</span>  <span>:hero</span> <span>&#34;Batman&#34;</span><span>}</span>
             <span>{</span><span>:name</span> <span>&#34;James&#34;</span> <span>:surname</span> <span>&#34;Logan&#34;</span>  <span>:hero</span> <span>&#34;Wolverine&#34;</span><span>}</span>
             <span>{</span><span>:name</span> <span>&#34;Steve&#34;</span> <span>:surname</span> <span>&#34;Rogers&#34;</span> <span>:hero</span> <span>&#34;Captain America&#34;</span><span>}</span>
             <span>{</span><span>:name</span> <span>&#34;Bruce&#34;</span> <span>:surname</span> <span>&#34;Banner&#34;</span> <span>:hero</span> <span>&#34;Hulk&#34;</span><span>}</span><span>]</span><span>)</span></code></pre><p>Then define two additional route functions besides your root &#34;Hello World&#34;. They should:</p><ol start="1"><li>Return all the superheroes we have defined</li><li>Return the hero matching the name provided as a route parameter
<br/></li></ol><pre><code><span>(</span><span>defn</span> get-heroes <span>[</span>_<span>]</span> <span>{</span><span>:status</span> <span>200</span> <span>:body</span> heroes<span>}</span><span>)</span>

<span>(</span><span>defn</span> get-hero <span>[</span><span>{</span><span>{</span><span>:keys</span> <span>[</span>hero<span>]</span><span>}</span> <span>:path-params</span>
                <span>{</span><span>:keys</span> <span>[</span>extended<span>]</span><span>}</span> <span>:query-params</span><span>}</span><span>]</span>
 <span>(</span><span>if-let</span> <span>[</span>hero <span>(</span><span>-&gt;&gt;</span> heroes
                    <span>(</span><span>filter</span> #<span>(</span><span>=</span> hero <span>(</span><span>:hero</span> %<span>)</span><span>)</span><span>)</span>
                    <span>first</span><span>)</span><span>]</span>
   <span>{</span><span>:status</span> <span>200</span> <span>:body</span> <span>(</span><span>if</span> extended hero <span>(</span><span>dissoc</span> hero <span>:hero</span><span>)</span><span>)</span><span>}</span>
   <span>{</span><span>:status</span> <span>404</span><span>}</span><span>)</span><span>)</span></code></pre><p>Be sure to update your route map accordingly. While we&#39;re here, extract your routes to live outside of the API specification. That will keep our functions and definitions short:</p><pre><code><span>(</span><span>def</span> routes #<span>{</span><span>[</span><span>&#34;/&#34;</span> <span>:get</span> hello-world <span>:route-name</span> <span>:hello-world</span><span>]</span> <span>;Routes</span>
              <span>[</span><span>&#34;/heroes/:hero&#34;</span> <span>:get</span> get-hero <span>:route-name</span> <span>:get-hero</span><span>]</span>
              <span>[</span><span>&#34;/heroes&#34;</span> <span>:get</span> get-heroes <span>:route-name</span> <span>:get-heroes</span><span>]</span><span>}</span><span>)</span>

<span>(</span><span>def</span> service-map
  <span>{</span><span>::http</span>/routes routes
   <span>::http</span>/type <span>:immutant</span>
   <span>::http</span>/host <span>&#34;0.0.0.0&#34;</span>
   <span>::http</span>/join? <span>false</span>
   <span>::http</span>/port <span>(</span>Integer. <span>(</span><span>or</span> <span>(</span>env <span>:port</span><span>)</span> <span>5000</span><span>)</span><span>)</span><span>}</span><span>)</span> <span>; Service map</span></code></pre><p>While Pedastal does a lot for us and the code above is simple, it&#39;s worth dissecting it to explain some of the Clojure features that keep code concise.</p><p>Each route in Pedastal is technically a specialized <a href="http://pedestal.io/guides/what-is-an-interceptor" target="_blank" rel="noreferrer noopener">Interceptor</a>. Interceptors are a common web framework concept used in things like Angular as well as Pedastal. Simply put, they let you layer functions to create a &#34;pipeline&#34; to handle web requests. We will return to the concept of interceptors later.</p><p>Pedastal routes take a <a href="http://pedestal.io/reference/request-map" target="_blank" rel="noreferrer noopener">request map</a> and return a <a href="http://pedestal.io/reference/response-map" target="_blank" rel="noreferrer noopener">response map</a> with the response details. </p><pre><code><span>(</span><span>defn</span> hello-world <span>[</span>request<span>]</span> <span>{</span><span>:status</span> <span>200</span> <span>:body</span> <span>&#34;Hello&#34;</span><span>}</span><span>)</span></code></pre><p>The request map contains query parameters under the <code><span>:</span>query<span>-</span>params</code> key and path parameters under the <code>path<span>-</span>params</code> key. Typically, to get the data we need from a map, we need to access them by keys. Here&#39;s what that would look like in our hello-world method, attached to our root route:</p><pre><code><span>(</span><span>defn</span> hello-world <span>[</span>request<span>]</span>
 <span>(</span><span>let</span> <span>[</span>query-params <span>(</span><span>:query-params</span> request<span>)</span>
       path-params <span>(</span><span>:path-params</span> request<span>)</span><span>]</span><span>)</span> <span>{</span><span>:status</span> <span>200</span> <span>:body</span> <span>&#34;Hello&#34;</span><span>}</span><span>)</span></code></pre><p>From there, you could access the specified parameter with either a threading macro or using <code>get<span>-</span><span>in</span></code>...</p><pre><code><span>(</span><span>defn</span> hello-world <span>[</span>request<span>]</span>
 <span>(</span><span>let</span> <span>[</span>extend <span>(</span>get-in request <span>[</span><span>:query-params</span> <span>:extended</span><span>]</span> <span>)</span>
       path-params <span>(</span>get-in request <span>[</span><span>:path-params</span> <span>:hero</span><span>]</span><span>)</span><span>]</span><span>)</span> <span>{</span><span>:status</span> <span>200</span> <span>:body</span> <span>&#34;Hello&#34;</span><span>}</span><span>)</span></code></pre><p>This method is legit ‚Äî but it&#39;s a little wordy. To fix that, Clojure supports destructuring in binding statements. Destructuring is syntactic sugar that saves lines of code when accessing maps or sequential data structures.</p><p>Consider a nested map like this one:</p><pre><code><span>(</span><span>def</span> locations <span>{</span><span>:type</span> <span>&#34;Office&#34;</span> <span>:address</span> <span>{</span><span>:street</span> <span>&#34;Ocean Drive&#34;</span> <span>:zip</span> <span>90210</span> <span>:city</span> <span>&#34;Beverly Hills&#34;</span> <span>}</span><span>}</span><span>)</span></code></pre><p>It is possible to destructure the map and access particular keys in several ways:</p><pre><code><span>; Destructuring in a let statement</span>
<span>(</span><span>let</span> <span>[</span><span>{</span><span>:keys</span> office<span>}</span> locations<span>]</span> <span>(</span><span>println</span> office<span>)</span><span>)</span>
 
<span>; Destructuring in a function</span>
<span>(</span><span>defn</span> print-office <span>[</span><span>{</span><span>:keys</span> office<span>}</span><span>]</span> <span>(</span><span>println</span> office<span>)</span><span>)</span>
 
<span>; It also works in nested maps</span>
<span>(</span><span>let</span> <span>[</span><span>{</span><span>{</span><span>:keys</span> <span>[</span>city<span>]</span><span>}</span> <span>:address</span><span>}</span> locations<span>]</span> <span>(</span><span>println</span> city<span>)</span><span>)</span>
 
<span>; Destructuring Sequential structures, like our superhero data</span>
<span>(</span><span>defn</span> simple-heroes  <span>[</span><span>&#34;Clark&#34;</span> <span>&#34;Kent&#34;</span> <span>&#34;Superman&#34;</span><span>]</span><span>)</span>
<span>(</span><span>let</span> <span>[</span><span>[</span><span>name</span> surname hero<span>]</span><span>]</span> <span>(</span><span>println</span> <span>name</span> <span>&#34; - &#34;</span> surname <span>&#34; - &#34;</span> hero<span>)</span><span>)</span></code></pre><p>Destructuring has a lot of facets we cannot explore here, but the <a href="https://clojure.org/guides/destructuring" target="_blank" rel="noreferrer noopener">official documentation</a> contains a detailed guide on how best to use this feature. However, with this crash course, we should now understand what&#39;s happening at the beginning of our function <code>get<span>-</span>hero</code>:</p><pre><code><span>(</span><span>defn</span> get-hero <span>[</span><span>{</span><span>{</span><span>:keys</span> <span>[</span>hero<span>]</span><span>}</span> <span>:path-params</span>
                <span>{</span><span>:keys</span> <span>[</span>extended<span>]</span><span>}</span> <span>:query-params</span><span>}</span><span>]</span> <span>{</span><span>}</span><span>)</span>

<span>(</span><span>defn</span> get-hero <span>[</span><span>{</span><span>{</span><span>:keys</span> <span>[</span>hero<span>]</span><span>}</span> <span>:path-params</span>
                <span>{</span><span>:keys</span> <span>[</span>extended<span>]</span><span>}</span> <span>:query-params</span><span>}</span><span>]</span>
                <span>;...</span></code></pre><p>...which can be interpreted as saying: &#34;From path params extract the hero key; from query, params extract the extended key.&#34;</p><p>In case you&#39;re thinking: &#34;hey, that looks a bit like SQL query expressed as data structure&#34; (I&#39;m psychic) ‚Äî you&#39;re onto something. Indeed, <a href="https://www.learndatalogtoday.org" target="_blank" rel="noreferrer noopener">Datalog</a> is a query language that expresses queries as data. It&#39;s used by <a href="https://www.datomic.com" target="_blank" rel="noreferrer noopener">Datomic</a>, which we will explore in a future article.</p><p>As a counter-example where destructuring <em>might</em> not make sense, take a look at the filter statement we are using to find the hero by name in <code>get<span>-</span>hero</code>:</p><pre><code><span>(</span><span>filter</span> #<span>(</span><span>=</span> h <span>(</span><span>:hero</span> %<span>)</span><span>)</span><span>)</span></code></pre><p>With destructuring, you need to &#34;fall back&#34; to a regular fn definition instead of a &#34;lambda&#34;. That means the code would look like this:</p><pre><code><span>(</span><span>filter</span> <span>(</span><span>fn</span> <span>[</span><span>{</span><span>:keys</span> hero<span>}</span><span>]</span> <span>(</span><span>=</span> h hero<span>)</span><span>)</span><span>)</span></code></pre><p>To destructure, we need to &#34;fall back&#34; to a regular fn definition instead of a &#34;lambda&#34;. There&#39;s not a dramatic improvement in readability, so I suggest accessing the key explicitly.</p><h3 id="Serving-Data">Serving Data</h3><p>After applying the modifications above, our code should look like this:</p><pre><code><span>(</span><span>ns</span> app.core <span>(</span><span>:require</span> <span>[</span>io.pedestal.http <span>:as</span> http<span>]</span>
                       <span>[</span>environ.core <span>:refer</span> <span>[</span>env<span>]</span><span>]</span><span>)</span><span>)</span>

<span>(</span><span>def</span> heroes <span>[</span><span>{</span><span>:name</span> <span>&#34;Clark&#34;</span> <span>:surname</span> <span>&#34;Kent&#34;</span> <span>:hero</span> <span>&#34;Superman&#34;</span><span>}</span>
             <span>{</span><span>:name</span> <span>&#34;Bruce&#34;</span> <span>:surname</span> <span>&#34;Wayne&#34;</span> <span>:hero</span> <span>&#34;Batman&#34;</span><span>}</span>
             <span>{</span><span>:name</span> <span>&#34;James&#34;</span> <span>:surname</span> <span>&#34;Logan&#34;</span> <span>:hero</span> <span>&#34;Wolverine&#34;</span><span>}</span>
             <span>{</span><span>:name</span> <span>&#34;Steve&#34;</span> <span>:surname</span> <span>&#34;Rogers&#34;</span> <span>:hero</span> <span>&#34;Captain America&#34;</span><span>}</span>
             <span>{</span><span>:name</span> <span>&#34;Bruce&#34;</span> <span>:surname</span> <span>&#34;Banner&#34;</span> <span>:hero</span> <span>&#34;Hulk&#34;</span><span>}</span><span>]</span><span>)</span>

<span>(</span><span>defn</span> hello-world <span>[</span>request<span>]</span>
  <span>(</span><span>let</span> <span>[</span>extend <span>(</span>get-in request <span>[</span><span>:query-params</span> <span>:extended</span><span>]</span><span>)</span>
        path-params <span>(</span>get-in request <span>[</span><span>:path-params</span> <span>:hero</span><span>]</span><span>)</span><span>]</span><span>)</span> <span>{</span><span>}</span><span>)</span>

<span>(</span><span>defn</span> get-hero <span>[</span><span>{</span><span>{</span><span>:keys</span> <span>[</span>hero<span>]</span><span>}</span> <span>:path-params</span>
                 <span>{</span><span>:keys</span> <span>[</span>extended<span>]</span><span>}</span> <span>:query-params</span><span>}</span><span>]</span>
  <span>(</span><span>if-let</span> <span>[</span>hero <span>(</span><span>-&gt;&gt;</span> heroes
                     <span>(</span><span>filter</span> #<span>(</span><span>=</span> hero <span>(</span><span>:hero</span> %<span>)</span><span>)</span><span>)</span>
                     <span>first</span><span>)</span><span>]</span>
    <span>{</span><span>:status</span> <span>200</span> <span>:body</span> <span>(</span><span>if</span> extended hero <span>(</span><span>dissoc</span> hero <span>:hero</span><span>)</span><span>)</span><span>}</span>
    <span>{</span><span>:status</span> <span>404</span><span>}</span><span>)</span><span>)</span>

<span>(</span><span>defn</span> get-heroes <span>[</span>_<span>]</span> <span>{</span><span>:status</span> <span>200</span> <span>:body</span> heroes<span>}</span><span>)</span>

<span>(</span><span>def</span> routes #<span>{</span><span>[</span><span>&#34;/&#34;</span> <span>:get</span> hello-world <span>:route-name</span> <span>:hello-world</span><span>]</span>
              <span>[</span><span>&#34;/heroes/:hero&#34;</span> <span>:get</span> get-hero <span>:route-name</span> <span>:get-hero</span><span>]</span>
              <span>[</span><span>&#34;/heroes&#34;</span> <span>:get</span> get-heroes <span>:route-name</span> <span>:get-heroes</span><span>]</span><span>}</span><span>)</span>

<span>(</span><span>def</span> service-map
  <span>{</span><span>::http</span>/routes routes
   <span>::http</span>/type <span>:immutant</span>
   <span>::http</span>/host <span>&#34;0.0.0.0&#34;</span>
   <span>::http</span>/join? <span>false</span>
   <span>::http</span>/port <span>(</span>Integer. <span>(</span><span>or</span> <span>(</span>env <span>:port</span><span>)</span> <span>5000</span><span>)</span><span>)</span><span>}</span><span>)</span> <span>; Service map</span>

<span>(</span><span>defn</span> -main <span>[</span>_<span>]</span> <span>(</span><span>-&gt;</span> service-map http/create-server http/start<span>)</span><span>)</span> <span>; Server Instance</span></code></pre><p>If we start the server again now and try to get some data, we should now be able to get results and test out our new endpoints:</p><pre><code><span>curl</span> http://localhost:5000/heroes
<span>[</span><span>{</span>:name <span>&#34;Clark&#34;</span>, :surname <span>&#34;Kent&#34;</span>, :hero <span>&#34;Superman&#34;</span><span>}</span> <span>{</span>:name <span>&#34;Bruce&#34;</span>, :surname <span>&#34;Wayne&#34;</span>, :hero <span>&#34;Batman&#34;</span><span>}</span> <span>{</span>:name <span>&#34;James&#34;</span>, :surname <span>&#34;Logan&#34;</span>, :hero <span>&#34;Wolverine&#34;</span><span>}</span> <span>{</span>:name <span>&#34;Steve&#34;</span>, :surname <span>&#34;Rogers&#34;</span>, :hero <span>&#34;Captain America&#34;</span><span>}</span> <span>{</span>:name <span>&#34;Bruce&#34;</span>, :surname <span>&#34;Banner&#34;</span>, :hero <span>&#34;Hulk&#34;</span><span>}</span><span>]</span>
 
<span>curl</span> http://localhost:5000/heroes/Superman
<span>{</span>:name <span>&#34;Clark&#34;</span>, :surname <span>&#34;Kent&#34;</span><span>}</span>
 
<span>curl</span> <span>&#34;http://localhost:5000/heroes/Superman?extended=1&#34;</span>
<span>{</span>:name <span>&#34;Clark&#34;</span>, :surname <span>&#34;Kent&#34;</span>, :hero <span>&#34;Superman&#34;</span><span>}</span></code></pre><p>You can indeed see the API is behaving as you&#39;d expect. However, this response isn&#39;t JSON - which you can see from the syntax or by looking at the response details via <code>curl <span>-</span>v</code>:</p><pre><code>$ <span>curl</span> localhost:5000/heroes/Superman -v
<span>..</span>.
<span>&gt;</span> Content-Type: application/edn</code></pre><p><a href="https://github.com/edn-format/edn" target="_blank" rel="noreferrer noopener">EDN</a> is arguably a better format than JSON for several reasons, especially if you&#39;re using  <a href="https://clojurescript.org" target="_blank" rel="noreferrer noopener">ClojureScript</a>.  However, the lingua franca of publicly exposed APIs and JavaScript applications is JSON. For this reason, you&#39;re going to modify our application to return data in JSON by default. </p><p>To do so, you need to modify our Service Map (where we specify our options) and add a new interceptor that will serialize the body to be JSON whenever it makes sense. The good news is that Pedastal provides an interceptor out of the box we can use.</p><p>Our code&#39;s <code>http<span>/</span>create<span>-</span>server</code> function will look for the <code><span>:</span><span>:</span>http<span>/</span>interceptors</code> key in the service map. If it does not exist there, it will automatically use some <a href="http://pedestal.io/reference/default-interceptors" target="_blank" rel="noreferrer noopener">default interceptors</a> that perform a series of common tasks. Since we need to add a new interceptor, we&#39;re going to need to update the interceptor chain by hand:</p><pre><code><span>(</span><span>def</span> service-map <span>(</span><span>-&gt;</span> <span>{</span><span>::http</span>/routes routes
                     <span>::http</span>/type   <span>:immutant</span>
                     <span>::http</span>/host   <span>&#34;0.0.0.0&#34;</span>
                     <span>::http</span>/join?  <span>false</span>
                     <span>::http</span>/port   <span>(</span>Integer. <span>(</span><span>or</span> <span>(</span>env <span>:port</span><span>)</span> <span>5000</span><span>)</span><span>)</span><span>}</span>
                http/default-interceptors
                <span>(</span>update <span>::http</span>/interceptors <span>into</span> <span>[</span>http/json-body<span>]</span><span>)</span><span>)</span><span>)</span></code></pre><p>Here we:</p><ul><li>Define the <code>service</code> with the routes and other keys</li><li>Pass the map to the <code>http<span>/</span><span>default</span><span>-</span>interceptors</code> function that will return a new service map with the <code><span>:</span><span>:</span>http<span>/</span>interceptors</code> key</li><li>Add the <code>json<span>-</span>body</code> interceptor to the chain to serialize the data as JSON when appropriate.</li></ul><p>If we try to request the same data again using <code>curl</code> we can see now that the response is JSON encoded:</p><pre><code><span>curl</span> http://localhost:5000/heroes/Superman
<span>{</span><span>&#34;name&#34;</span><span>:</span><span>&#34;Clark&#34;</span>,<span>&#34;surname&#34;</span><span>:</span><span>&#34;Kent&#34;</span><span>}</span></code></pre><p>You could apply the exact same approach to incoming body parameters if you had a route that used them. I won&#39;t dive deeply here, but the installation method for the <a href="https://github.com/pedestal/pedestal/blob/master/service/src/io/pedestal/http/body_params.clj#L178" target="_blank" rel="noreferrer noopener">body-params</a> interceptor is the same as other interceptors.</p><p>We&#39;ve completed a significant milestone with us returning data in the format most people expect when interacting with a Web API! But we&#39;re not done. Any Web API worth its salt should be well protected. You&#39;ll use Auth0 and some custom interceptors to accomplish that in my next article.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 02 Dec 2021 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Permissions, Privileges, and Scopes</title>
      <link>https://auth0.com/blog/permissions-privileges-and-scopes/</link>
      <description>What is the difference between permissions, privileges, and scopes in the authorization context? Let&#39;s find out together.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Access control is a complex thing. It involves users, resources, and applications, and you have to set it up properly to prevent bad surprises. However, setting up access control is not just a matter of writing code or configuring a system. It includes (or better, it relies on) understanding a few basic concepts. Things can get even more complicated when delegated authorization comes into the picture, such as when using OAuth.</p><p>In this context, three core concepts are usually misunderstood and confused: <strong>permissions</strong>, <strong>privileges</strong>, and <strong>scopes</strong>. Let&#39;s try to go to the basics to better understand these concepts and their relationship.</p><p>By the way, here is a video version of this article:</p><p><iframe src="https://www.youtube.com/embed/z2Ma0ZsEF7Y" frameborder="0" allowfullscreen=""></iframe></p><h2 id="Actors-of-Access-Control">Actors of Access Control</h2><p>Consider a scenario with the following actors:</p><ul><li>The <strong>user</strong>, the entity that wants to perform an action on an object.</li><li>The <strong>resource</strong>, the object that a user wants to use.</li><li>The <strong>application</strong>, the software that mediates the interaction between the user and the resource.</li></ul><p>In this scenario, <strong>access control is the selective restriction of access to a resource</strong>. It determines who can do what on a resource. The relationship between the three actors described above contributes to the complexity of access control, as we will see in a moment.</p><h2 id="What-Are-Permissions-">What Are Permissions?</h2><p>Usually, you have a clear understanding of what a permission is. Commonly, you say that you have the permission to drive your car, load stuff in its trunk compartment, inspect its hood, clean it, sell it, and so on.</p><p>These common activities make you think that a permission is something related to you, the user. Actually, in the computer security context, a permission is something related to an object, to a resource, not to the user of that resource.</p><p><strong>A permission is a declaration of an action that can be executed on a resource</strong>. It describes intrinsic properties of resources, which exist independently of the user. In the scenarios depicted above, driving and filling the trunk are actions you can do with your car: they are permissions attached to your car. The same happens with the action of accessing your computer, reading your emails, and so on. They all are permissions on those resources.</p><p>I know, that looks weird and a bit pedantic, even philosophical in some ways. But it is fundamental to accurately define this concept to understand the rest.</p><h2 id="What-Are-Privileges-">What Are Privileges?</h2><p>If permissions are bound to the resource, how can you express the ability to perform an action on that resource? How can you express the fact that someone is authorized to drive their car? What you need are privileges.</p><p>Simply put, <strong>privileges are assigned permissions</strong>. When you assign a permission to a user, you are granting them a privilege. If you assign a user the permission to read a document, you are granting them the privilege to read that document. Do you see the subtle difference?</p><p>I know. Usually, permissions and privileges are used interchangeably, but technically they have precise and different meanings in the context of computer security.</p><p>So, resources expose permissions. Users have privileges.</p><blockquote><p>For simplicity, we&#39;ll talk about privileges assigned to users, but keep in mind that privileges can also be assigned to applications. Consider, for example, an application running without user involvement that needs to access a resource.</p></blockquote><p>Once you understand the exact definition of permissions and privileges, we can easily talk about authorization scenarios. I mean, you can easily imagine a scenario where an entity protects a resource, and a user wants to exercise their privilege to use that resource. <strong>The entity that protects the resource is responsible for restricting access to it, i.e., it is doing access control</strong>.</p><p>Consider the following example. The concierge of a hotel is the entity that supervises the hotel&#39;s rooms (the resources) from unauthorized access. Each room has the ability to accommodate one guest (permission). A customer is assigned one room, so they have the privilege of being accommodated in that room. When the customer goes for a walk and then comes back to the hotel, the concierge checks if actually the customer has been assigned the permission to be accommodated in that room by consulting the booking list. If everything fits, the customer can come in, and we&#39;re all happy.</p><p>Imagine that one day, while the customer is out, a person shows up at the concierge desk. That person says they were requested by the customer to come into the room to get their briefcase. The concierge doesn&#39;t allow them to come in, of course. They need to do their own verifications to confirms what that person is asserting, such as calling the customer on the phone, for example.</p><p>However, even after everything is clear, the concierge needs to make sure that person will only do what they came to the hotel to do: take the customer&#39;s briefcase. Nothing else. The concierge will likely walk the person to the customer&#39;s room and make sure nothing else is done other than what was agreed upon.</p><p>The first scenario looks quite straightforward: it reduces the access control to comparing the customer booking data with the hotel&#39;s booking list. The second scenario is a bit more complex: it requires an additional check on what the person declares and control on what they are allowed to do.</p><p>These two scenarios may seem fictitious, but they have equivalent scenarios in authorization systems. The first scenario corresponds to the situation where a user attempts to access a protected resource for which they have privileges. This is the typical and most known authorization scenario.</p><p>The second scenario represents the case in which a third-party application wants to access a protected resource on behalf of a user. This case is known as a delegated authorization scenario.</p><p>The delegated authorization scenario is the typical scenario introduced by the <a href="https://auth0.com/docs/protocols/protocol-oauth2" target="_blank" rel="noreferrer noopener">OAuth 2 Authorization Framework</a>. This framework allows a third-party application to operate on a resource on behalf of a user. In other words, the application exercises the user&#39;s privilege to use a resource. But how does it happen? How can the application be delegated to access the user‚Äôs resource? Here, scopes come into the scene.</p><h2 id="What-Are-Scopes-">What Are Scopes?</h2><p><strong>Scopes enable a mechanism to define what an application can do on behalf of the user</strong>. Recalling the hotel example, taking the customer&#39;s briefcase is the scope of the person who introduced themselves to the concierge.</p><p>The application requests these scopes to the authorization server, i.e., the server responsible for authorizing the third-party application in the delegated scenario. <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-3.3" target="_blank" rel="noreferrer noopener">Scopes were introduced in OAuth 2.0</a> and are specific to that authorization framework.</p><p>In practical terms, <strong>scopes are strings that represent what the application wants to do on behalf of the user</strong>, as shown in the following authorization request example:</p><pre><code>https://YOUR_DOMAIN/authorize?
  <span>response_type</span><span>=</span>code<span>&amp;</span>
  <span>client_id</span><span>=</span>YOUR_CLIENT_ID<span>&amp;</span>
  <span>redirect_uri</span><span>=</span>https://YOUR_APP/callback<span>&amp;</span> 
  <span>scope</span><span>=</span>read:email<span>&amp;</span>   <span>#üëà here is the requested scope</span>
  <span>audience</span><span>=</span>YOUR_API_AUDIENCE<span>&amp;</span>
  <span>state</span><span>=</span>YOUR_STATE_VALUE</code></pre><p>Typically, scopes are permissions of a resource that the application wants to exercise on behalf of the user. In other words, the application wants to exercise user&#39;s privileges on a resource such as reading their emails.</p><p>Actually, it is not the authorization server that allows the application to exercise the user&#39;s privileges. The final word on granting delegated access to the application is the user&#39;s own. The user can approve or reject delegated access to their resource with specific scopes by using a consent screen similar to the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1TrkMwEcKSR149zd878WEJ/8ae011dc08b89698c0dce24e8ce01e43/consent-screen.png" alt="Consent screen"/></p><p>You can experience it firsthand by <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">signing up for Auth0</a> and securing an application built with <a href="https://auth0.com/docs/libraries" target="_blank" rel="noreferrer noopener">several supported technologies</a>.</p><p>The granted scopes allow the application to access only the user&#39;s resources, say the user&#39;s emails. Just as the user cannot access other users&#39; emails, the application cannot access other users&#39; emails either. Usually, <strong>the scopes granted to a third-party application are a subset of the permissions granted to the user</strong>.</p><p>Keep in mind, however, that an application can request scopes corresponding to privileges that the user doesn&#39;t have. And the user can grant them. This may look tricky, but it covers situations where the user doesn&#39;t have a given privilege in the moment they grant the scopes to the application, but they will have that privilege when the application exercises that scope. The vice versa can happen too: a user has a given privilege and grants a delegated access for the corresponding scope, but the user loses the privilege when the application tries to exercise its scope. At the end of the day, what is relevant when the application exercises its scopes is the possession of the corresponding privileges by the user at that time. This means that <strong>the application can&#39;t do more than the user can do</strong>.</p><p>Once the user approves the application&#39;s request, the authorization server communicates the granted scopes to the application so that it can access the resource with the limited granted privileges.</p><h2 id="A-Complicated-Relationship">A Complicated Relationship</h2><p>Now you have a clearer picture of what permissions, privileges, and scopes are. Unfortunately, this may not be enough. In fact, these items are strictly related, and often this relationship gets confusing. Let&#39;s try to clarify the most common misunderstandings.</p><h3 id="Scopes-and-privileges">Scopes and privileges</h3><p>Often, developers think that scopes are application&#39;s privileges. After all, the user granted their consent to use them. However, they usually miss a little detail: applications are authorized to exercise those privileges <strong>on behalf of the user</strong>. If the user doesn&#39;t have a privilege, the application cannot exercise it.</p><p>This means that, on the resource side, <strong>users&#39; privileges must be checked even in the presence of granted scopes</strong>. Remember that, in a delegated authorization scenario, the application may act on behalf of the user even when the user is not logged in. If the user no longer has those privileges between their consent and the exercise by the application, the application must be prevented from exercising its delegated access. This should clarify why <strong>scopes should not be considered application&#39;s privileges</strong>.</p><p>These may look like philosophical issues, but they have practical implications. Check out <a href="https://auth0.com/blog/on-the-nature-of-oauth2-scopes/" target="_blank" rel="noreferrer noopener">this article on the nature of scopes</a> to learn more about this.</p><h3 id="Scopes-and-permissions">Scopes and permissions</h3><p>Once you know what permissions, privileges, and scopes are, you might assume that there is a natural mapping between permissions and scopes. In other words, if a resource has permissions A and B, the scopes X and Y respectively will exist to allow an application to exercise those permissions on the resource and vice versa. While in most cases permissions are exposed as scopes, this mapping is not strictly correct for a few reasons.</p><p>In a delegated scenario, not all the permissions on a resource should necessarily be made available to be requested as scopes. You could reserve some permissions for the user and decide that they are not delegable. For example, you could decide that the permission to delete a document is never delegated to a third-party application.</p><p>So you might think that this supposed mapping is not between scopes and permissions but between scopes and privileges. This way, you can&#39;t map a scope to a permission not assigned to the user. Actually, this is not accurate either. There are scopes that don&#39;t have a match among the resource&#39;s permissions or the user&#39;s privileges. Consider the <code>openid</code> scope defined by <a href="https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest" target="_blank" rel="noreferrer noopener">OpenID Connect specifications</a>. This scope does not correspond to any permission on a specific user&#39;s resource. It is a request for the authorization server to return an ID token as the result of the user&#39;s authentication. The same applies to the other <a href="https://openid.net/specs/openid-connect-core-1_0.html#ScopeClaims" target="_blank" rel="noreferrer noopener">scopes defined by OpenID Connect</a>: <code>profile</code>, <code>email</code>, <code>address</code>, and <code>phone</code>.</p><p>So, you should avoid this unconscious mapping between scopes and permissions.</p><h2 id="Summary">Summary</h2><p>At the end of this journey, you learned the subtle differences between permissions, privileges, and scopes and their mutual relationship. Understanding these concepts and their thin borders will help you build more secure applications. The following picture tries to summarize what you learned in this article:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2wSDOXUzAKuCAA0rw79Fx8/8f66ad24881e3da2a73249a2a7b05e27/permissions-privileges-scopes.jpg" alt="Permissions, privileges and scopes"/></p></div></div>]]></content:encoded>
      <author>Authorization Scenarios</author>
      <pubDate>Wed, 01 Dec 2021 17:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Announcing Auth0.org‚Äôs Latest Cohort of Strategic Grant Partners</title>
      <link>https://auth0.com/blog/announcing-auth0-org-s-fall-cohort-grant-partners/</link>
      <description>Auth0.org Welcomes 4 New Cohort Grant Partners</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Since committing to the <a href="https://pledge1percent.org/" target="_blank" rel="noreferrer noopener">Pledge 1% movement</a> and launching Auth0‚Äôs social impact arm, Auth0.org, in fall 2020, we‚Äôve been proud to make over $650,000 in grants to support over <strong><a href="https://www.auth0.com/social-impact/portfolio" target="_blank" rel="noreferrer noopener">25 community organizations</a></strong> through charitable sponsorships and grants from the <a href="https://auth0.com/social-impact/fund" target="_blank" rel="noreferrer noopener">SAFE Fund</a> (Secure Access For Everyone) ‚Äì a charitable fund which supports charities and nonprofits from around the globe that help provide access to education and technology for everyone, in an inclusive way.</p><p>Building on the Pledge 1% model, Auth0 is leveraging our financial resources, employee volunteer time, and identity and authentication product to support the important work of our nonprofit community partners. We focus our grantmaking and employee engagement efforts primarily on three key social outcomes: </p><ol start="1"><li><em>Closing the Digital Divide to enable underserved communities to get connected and thrive.</em></li><li><em>Diversifying access and participation in secondary and university STEM education, especially by those most challenged, such as women/girls and students of color. </em></li><li><em>Diversifying the technology &amp; cybersecurity workforce, especially for women and people of color.</em></li></ol><p>And our employees also choose causes and organizations to support with time and money that are addressing pressing social issues in the communities where we live and work. We leverage  workday volunteer hours, employee personal donations, and corporate financial support for many causes including: addressing homlessness, making our parks and family playspaces cleaner, supporting at-risk LGBTQ+ youth, and supporting COVID and disaster relief efforts in the US and internationally ‚Äì just to name a few.</p><p>We are proud to announce our recent cohort of strategic grant partners, who receive substantial unrestricted grant support and volunteer hours from our employees. These amazing changemakers are:</p><ul><li><a href="https://girlswhocode.com/" target="_blank" rel="noreferrer noopener">Girls Who Code</a></li><li><a href="https://www.npower.org/" target="_blank" rel="noreferrer noopener">NPower</a></li><li><a href="https://www.communityintegratedcare.co.uk/" target="_blank" rel="noreferrer noopener">CIC UK</a></li><li><a href="https://www.rebootrepresentation.org/" target="_blank" rel="noreferrer noopener">Reboot Representation</a></li></ul><p>We look forward to investing our passion, time, money, and product in more nonprofit partners in the US and the countries where we live and work. Stay tuned for their announcements.  </p><p>Thank you to all of our fellow Auzurios and to Auth0‚Äôs leadership team whose philanthropic beliefs and commitment to positive social change are the foundation of Auth0.org. We are leaning into extending inclusive access to education and technology and addressing pressing needs in the communities where we live and work. And that‚Äôs something we can all be truly proud of.</p><p>Please join me in congratulating our new cohort and if you have a moment, I highly encourage you to check out these incredible organizations and consider engaging with them through a donation, volunteer time, or through one of the avenues listed below each highlighted charity. Every little bit helps. </p><h2 id="-Reboot-Representation--https---www-rebootrepresentation-org----"><a href="https://www.rebootrepresentation.org/" target="_blank" rel="noreferrer noopener">Reboot Representation</a><em></em></h2><p>Auth0 believes in building the community of diverse talent available for us and other tech companies to hire in the years and decades to come. But developing that talent takes time and patience. These promising future tech professionals need to be engaged as early as middle school and supported through high school, college and post secondary training; throughout their careers in our industry. It‚Äôs not just about hiring, it‚Äôs about developing talent.  </p><p>We are big fans of our new grant partner <a href="https://www.rebootrepresentation.org/" target="_blank" rel="noreferrer noopener">Reboot Representation</a> which seeks to double the number of Black, Latina, and Native Women in the technology sector earning computer science degrees by 2025. </p><p>The lack of representation carries a major cost for women, companies, and the entire tech sector. Reboot Representation‚Äôs mission is to change that by closing the gap for Black, Latina, and Native Women in the technology sector. </p><p>Companies with diverse teams, including those with more women, are shown to be more creative, innovative, and ultimately more profitable. We all have the power to change the current landscape. In fact, Reboot Representation provides <a href="https://www.rebootrepresentation.org/tools-resources/" target="_blank" rel="noreferrer noopener">free tools and resources</a> that can be put into action across organizations that are looking to drive solutions to close the gender gap which are definitely worth checking out.</p><p><strong>How You Can Support Reboot Representation</strong></p><ul><li>Consider <a href="https://www.rebootrepresentation.org/support-reboot-grantees/" target="_blank" rel="noreferrer noopener">supporting</a> Reboot Representation High School and College Grantees</li><li>Work for <a href="https://www.rebootrepresentation.org/work-for-equity-in-tech/" target="_blank" rel="noreferrer noopener">equity in tech</a>. There are a number of ways here to make your voice heard and impact felt based on your role</li><li>Speak to your organization about joining their <a href="https://www.rebootrepresentation.org/get-in-touch/" target="_blank" rel="noreferrer noopener">Tech Coalition</a></li><li><a href="https://www.rebootrepresentation.org/get-in-touch/" target="_blank" rel="noreferrer noopener">Follow them</a> on social media &amp; help spread the word</li></ul><h2 id="-NPower--https---www-npower-org--"><a href="https://www.npower.org/" target="_blank" rel="noreferrer noopener">NPower</a></h2><p>It is estimated that in today‚Äôs economy around 50% of all jobs require some degree of technology and digital skills. However, not all people have the access nor the means to develop these skills. </p><p>Access to resources such as internet connectivity expansion, STEM education programs, and tech career pathways can help those who traditionally lack access to such means can change that narrative. They are also factors that as catalysts for driving change, Auth0 cares deeply about and precisely why we are thrilled to back our strategic partner <a href="https://www.npower.org/" target="_blank" rel="noreferrer noopener">NPower</a>, who is connecting underserved youth and military veterans to the skills needed to succeed in a tech career. </p><p>NPower envisions a future where the US technology workforce is diverse, and clear pathways exist for all people regardless of ethnicity, gender, or socio-economic background to succeed in the digital economy. </p><p>Their programs create pathways to economic prosperity by launching digital careers for military veterans and young adults from underserved communities. NPower‚Äôs work is rewriting the story everyday for hundreds of individuals across the United States.</p><p><strong>How You Can Support NPower</strong></p><ul><li><a href="https://www.npower.org/get-involved/volunteer/" target="_blank" rel="noreferrer noopener">Volunteer</a> your time</li><li>Become a Pathways Builder through a single one-time donation, or, an ongoing gift</li><li>Show your support via a monthly donation</li><li>See if <a href="https://www.npower.org/support/ways-to-give/matching-gifts/" target="_blank" rel="noreferrer noopener">your company will match a gift</a> you make</li><li>Join as a <a href="https://www.npower.org/get-involved/partner/" target="_blank" rel="noreferrer noopener">Corporate Partner</a></li><li>Make a <a href="https://www.npower.org/support/ways-to-give/" target="_blank" rel="noreferrer noopener">stock gift</a></li><li>Include NPower in an estate or planned gift</li><li>Donate to their wish list</li><li>Shop on Amazon and <a href="https://smile.amazon.com/gp/chpf/homepage?orig=%2F" target="_blank" rel="noreferrer noopener">support their cause with Amazon Smile</a></li><li><a href="https://www.npower.org/contact-us/" target="_blank" rel="noreferrer noopener">Follow them</a> on social media &amp; help spread the word</li></ul><p>For more information on supporting NPower not linked above, please <a href="https://www.npower.org/support/ways-to-give/" target="_blank" rel="noreferrer noopener">check out their website</a>.</p><p>If we want our teams in tech that look like our society and bring diverse perspectives to our work, our products, and our customers, we need to support those future tech professionals early on. Our new strategic grant partner Girls Who Code does just that.</p><p>GWC offers coding clubs for girls and young women in grades 3 - 12, summer immersion programs for 10th &amp; 12th graders, college programs, and coding at home activities. These are just a few of the many ways that Girls Who Code are teaching girls and young women how to program, but more importantly, how to thrive and lead in the tech workforce.</p><p>To date, <a href="https://girlswhocode.com/" target="_blank" rel="noreferrer noopener">Girls Who Code</a> has reached 500M people in the U.S. and around the world through diverse and inclusive programs which aim to close the gender gap in tech. They‚Äôre making a big impact, but the hard work and mission is never ending, like so many other nonprofit and social impact organizations. </p><p><strong>How You Can Support Girls Who Code</strong></p><ul><li><a href="https://girlswhocode.com/get-involved/start-a-club" target="_blank" rel="noreferrer noopener">Start or join a club</a> in your local community</li><li><a href="https://girlswhocode.com/get-involved/fundraise" target="_blank" rel="noreferrer noopener">Do a fundraiser</a> at work, in your community, when you celebrate an event, or even as a corporate partner</li><li>Consider joining as a<a href="https://girlswhocode.com/get-involved/fundraise" target="_blank" rel="noreferrer noopener"> corporate or philanthropic partner</a></li><li>Make a one-time or monthly <a href="https://www.classy.org/give/77372/#!/donation/checkout" target="_blank" rel="noreferrer noopener">donation</a></li><li>Get involved in one of their upcoming <a href="https://girlswhocode.com/get-involved/campaign" target="_blank" rel="noreferrer noopener">campaigns</a></li><li><a href="https://girlswhocode.com/contact-us" target="_blank" rel="noreferrer noopener">Follow them</a> on social media &amp; help spread the word</li></ul><p>At Auth0, fostering inclusivity and diversity is at the heart of all we do our business and our philanthropic endeavors where coupled with education and technology, is our de facto recipe for making a difference that lasts for generations to come.</p><p>When we first learned of <a href="https://www.communityintegratedcare.co.uk/" target="_blank" rel="noreferrer noopener">Community Integrated Care</a>, which provides direct support to people of different physical and mental abilities, age groups, health histories, and personal lifestyles across the UK we knew we had to support the amazing work that they‚Äôre doing.</p><p>Since 1988, Community Integrated Care has offered often underserved members of our communities social and health care services including: supported employment to supported living, registered or extra care homes, technology-enabled care, and various kinds of local community support. Community Integrated Care‚Äôs passion is helping people fulfill their full potential with dignity and respect. We are pleased to provide financial and employee volunteer support to CIC and its wonderful clients across the UK.</p><p><strong>How You Can Support Community Integrated Care</strong></p><ul><li>Join one of their <a href="https://www.communityintegratedcare.co.uk/our-approach/campaigning/" target="_blank" rel="noreferrer noopener">campaigning initiatives</a></li><li>Get involved in one of their <a href="https://www.communityintegratedcare.co.uk/get-involved/fundraising/" target="_blank" rel="noreferrer noopener">fundraising</a> efforts</li><li>Make an <a href="https://uk.virginmoneygiving.com/fundraiser-display/showROFundraiserPage?userUrl=ComIntCare&amp;pageUrl=1" target="_blank" rel="noreferrer noopener">individual donation</a></li><li><a href="https://www.ziffit.com/en-gb/basket?resourceId=a182a76f-560b-41fe-bd48-6a71b2abe65d&amp;pageId=1&amp;fundraiserActivityId=1182883" target="_blank" rel="noreferrer noopener">Turn your unwanted stuff into donations</a> through Ziffit</li><li>Encourage your <a href="https://auth0.com/blog/announcing-auth0-org-s-fall-cohort-grant-partners/fundraising@c-i-c.co.uk." target="_blank" rel="noreferrer noopener">organization to make a donation</a></li><li><a href="https://www.communityintegratedcare.co.uk/get-in-touch/" target="_blank" rel="noreferrer noopener">Follow them</a> on social media &amp; help spread the word</li></ul></div></div>]]></content:encoded>
      <pubDate>Tue, 30 Nov 2021 14:56:00 +0000</pubDate>
    </item>
    <item>
      <title>Get Started with iOS Authentication using Swift and UIKit</title>
      <link>https://auth0.com/blog/get-started-ios-authentication-swift-uikit/</link>
      <description>A step-by-step tutorial on using Auth0 and Swift to implement login/logout and use user metadata in iOS apps.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>If you‚Äôre planning to build a native iOS app that requires users to log in, you <em>could</em> implement authentication yourself ‚Äî or you can use Auth0 and focus your time and effort on your app‚Äôs <em>actual</em> functionality.</p><p>Building a user login/logout system looks simple. It often turns into its own project. Just handling the many ways users want to log in can easily take a lot of time. You‚Äôd also have to deal with issues such as user management, scaling, and security, each of which has dozens of considerations, risks, issues, and edge cases.</p><p>Auth0 solves this problem. With Auth0 and a few lines of code, your app can have a full-featured system that supports logging in with a username/password combination, single sign-on and social accounts, passwordless login, biometrics, and more. You won‚Äôt have to handle the ‚Äúbehind the scenes‚Äù issues, either! Instead, you can focus on what your app does.</p><p><strong>This tutorial covers the basics of using Auth0 to implement login/logout in an iOS app written using Swift and the UIKit framework.</strong> It also provides an introduction to reading and writing information into a user account‚Äôs metadata so that your app can ‚Äúremember‚Äù each user‚Äôs status, configurations, and preferences. Along the way, you‚Äôll become familiar with the Auth0 dashboard and learn how to use it to register applications and manage users and their metadata.</p><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong> </p></blockquote><h2 id="What-You-ll-Build">What You‚Äôll Build</h2><p>You‚Äôll build a simple, single-screen iOS app that will allow the user to log in and log out using Auth0. While logged in, the user will be able to see the following information from their user profile, namely:</p><ul><li>The following basic information from the user account:
<ul><li>The user‚Äôs name</li><li>The user‚Äôs email address</li></ul></li><li>User metadata, specifically the user‚Äôs favorite color, which they will be able to edit in the app</li><li>An announcement if a flag in the user‚Äôs app metadata has been set</li></ul><h3 id="A-quick-tour-of-the-app">A quick tour of the app</h3><p>When you launch the completed app, you‚Äôll see a greeting, a <strong>Log In</strong> button, and a disabled <strong>Log Out</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1yFKSaXbb0jLpvSP37ZSD1/e5dd0b31e231450d81f1f7d1b22e06d3/finished_app_-_welcome_screen.png" alt="The app‚Äôs ‚ÄúWelcome‚Äù screen. The ‚ÄúLog In‚Äù button is enabled, and the ‚ÄúLog In‚Äù button is disabled."/></p><p>Tapping the <strong>Log In</strong> button takes the user to the <a href="https://auth0.com/docs/login/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login screen</a>, which appears in a custom browser window:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/29unD3DL7wIRlacIbgXw8J/4f730e99dae87de64273ea0f3219695a/universal_login.png" alt="The default Auth0 Universal Login web page, with Auth0 logo and ‚Äúemail address‚Äù and ‚Äúpassword‚Äù fields."/></p><p>When you use Auth0 to add login/logout capability to your apps, you delegate authentication to a centralized login page in the same way that Google properties such as Gmail and YouTube redirect you to <strong>accounts.google.com</strong> when you log in. In this exercise, you‚Äôll use the default ‚Äúlook and feel‚Äù for the login page, but <a href="https://auth0.com/docs/universal-login/new-experience/universal-login-page-templates" target="_blank" rel="noreferrer noopener">you can customize it to match your app or organization‚Äôs branding</a>.</p><p>If the user logs in successfully, the Universal Login screen and its browser window disappear, and the user returns to the app. </p><p>Immediately after login, the app checks the app metadata associated with the user‚Äôs account for a ‚Äúmake an announcement‚Äù flag. If this flag is set, the app shows this alert box:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/47pe3bEupD0XBA6KLtw9id/2e5ad517195ff269238373bf35258bee/finished_app_-_logged_in_-_announcement.png" alt="The app displays an alert that tells the user if the alert is visible, then the ‚Äúmake_announcement‚Äù flag in ‚Äúapp_metadata‚Äù is set to ‚Äútrue‚Äù."/></p><p>This alert box doesn‚Äôt appear if the flag <em>isn‚Äôt</em> set.</p><p>Here‚Äôs what the app looks like once the user is logged in and has dismissed the alert box (if it appeared):</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/yNc58XQjBvMrt18aYk0FY/b9efe02e3e738e3b7e9c283c9f2ee0c8/finished_app_-_logged_in.png" alt="The app in its ‚Äúlogged in‚Äù state. The ‚ÄúLog In‚Äù button is disabled, ‚ÄúLog Out‚Äù button is enabled, and the app‚Äôs other controls are visible."/></p><p>Here‚Äôs what changed after login:</p><ul><li>The greeting will have changed to a notification telling you that you‚Äôre now logged into the app.</li><li>The <strong>Log In</strong> button will now be disabled, and the <strong>Log Out</strong> button will now be enabled.</li><li>The name and email address for the user account that you used to log in will be displayed.</li><li>There will now be a section for metadata, complete with an editable text field and <strong>Get</strong> and <strong>Set</strong> buttons that will allow you to read and write to the <code>favorite_color</code> field of the metadata for the user account.</li></ul><p>As you might expect, logging out is done by tapping the <strong>Log Out</strong> button. Once logged out, the user will see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/61JF1QFqXo4Spfl2OEadPi/0a0f5e1bdd7a6ef1a70461aed1a17160/logged_out.png" alt="The app in its ‚Äúlogged out‚Äù state. The ‚ÄúLog In‚Äù button is enabled, ‚ÄúLog Out‚Äù button is disabled, and the app‚Äôs other controls are hidden."/></p><p>Note that:</p><ul><li>The notification at the top of the screen will now inform you that you‚Äôre logged out of the app.</li><li>Logging out enables the <strong>Log in</strong> button and disables the <strong>Log out</strong> button.</li><li>The other controls that were visible when you were logged in will no longer be visible.</li></ul><h3 id="This-is-a--UIKit--based-app">This is a <em>UIKit</em>-based app</h3><p>We‚Äôre at an interesting time for iOS developers. There are currently two very different UI frameworks for iOS development:</p><ol start="1"><li><a href="https://developer.apple.com/xcode/swiftui/" target="_blank" rel="noreferrer noopener"><strong>SwiftUI,</strong></a> which is also known as ‚Äúthe new one‚Äù. With SwiftUI, you build user interfaces using Swift code with a <em>declarative</em> approach, which means that you specify how the UI should look and what it should do in different states. You don‚Äôt have to specify how the UI moves between those states ‚Äî it takes care of that for you. If you know React programming, you‚Äôll find SwiftUI familiar.</li><li><a href="https://developer.apple.com/documentation/uikit/" target="_blank" rel="noreferrer noopener"><strong>UIKit,</strong></a> also known as ‚Äúthe old one‚Äù or ‚Äúthe original one‚Äù. With UIKit, you build user interfaces using Interface Builder, a drag-and-drop layout tool to build the app‚Äôs views graphically. You then connect UI elements to variables and methods in the app‚Äôs view controllers using outlets and actions. You program UIKit apps <em>imperatively,</em> which means that you define how the program moves between states as well as how the UI should look and what it should do in different states.</li></ol><p>Most iOS apps are written using UIKit. Since it‚Äôs been around since the beginning of iOS, it‚Äôs the one that most iOS developers know, and it‚Äôs the better-documented framework. For this reason, this tutorial will focus on UIKit and feature a UIKit-based app. We‚Äôll publish a similar article focused on SwiftUI soon.</p><h2 id="Prerequisites">Prerequisites</h2><h3 id="An-Auth0-account">An Auth0 account</h3><p>The app uses Auth0 to provide login, logout, and user metadata functionality, which means that as the developer, you need an Auth0 account. You can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free account</a>, which lets you add authentication for enough apps and users for prototyping,  development, and testing.</p><h3 id="An-iOS-development-setup">An iOS development setup</h3><p>To develop applications for any Apple hardware, you need a Mac computer running Xcode, Apple‚Äôs integrated development environment:</p><ul><li>The computer can be any Mac ‚Äî MacBook, MacBook Air, MacBook Pro, iMac, iMac Pro, Mac Mini, or Mac Pro ‚Äî from mid-2012 or later with at least 8 GB RAM.</li><li><a href="https://developer.apple.com/xcode/" target="_blank" rel="noreferrer noopener">Xcode</a> version 11.0 (September 2019) or later. I used the current version when writing this article: version 13.1 (build 13A1030d), which was released on October 25, 2021.</li></ul><h3 id="An-iOS-device--virtual-or-real">An iOS device, virtual or real</h3><p>Xcode 13.1 comes with the Simulator, an application that creates virtual devices that simulate recent models of the iPhone, iPad, and iPod Touch, all of which run iOS 15.</p><blockquote><p>To install earlier versions of iOS for the Simulator, select <strong>Preferences‚Ä¶</strong> from the <strong>Xcode</strong> menu, followed by the <strong>Components</strong> tab. You‚Äôll see a list of older versions of not just iOS, but watchOS and tvOS as well.</p></blockquote><p>One of the benefits of using the Simulator is that you <em>don‚Äôt</em> need an Apple Developer account ‚Äî free or paid ‚Äî to use it.</p><p>While the Simulator is convenient, there‚Äôs no substitute for an actual physical device. It provides a more realistic testing experience, and there are certain things that can‚Äôt be done on the Simulator (such as motion/tilt sensing and augmented reality). </p><p>You need a free Apple Developer account to deploy an app directly to a device for testing (you need the paid one to deploy an app to the App Store), and you need to register the device in your developer account to deploy apps to it. For more details, see Apple‚Äôs article, <a href="https://developer.apple.com/documentation/xcode/distributing-your-app-to-registered-devices" target="_blank" rel="noreferrer noopener"><em>Distributing Your App to Registered Devices.</em></a></p><p>To find out more about running apps on virtual and real iOS devices, start with Apple‚Äôs <a href="https://developer.apple.com/documentation/xcode/running-your-app-in-the-simulator-or-on-a-device" target="_blank" rel="noreferrer noopener">Running Your App in the Simulator or on a Device.</a></p><h3 id="What-might-be-useful">What might be useful</h3><p>While not completely necessary, it would help if you were familiar with the Swift programming language and iOS development. If these are new to you, the Swift programming language, or the UIKit framework, try this Apple tutorial: <a href="https://developer.apple.com/tutorials/app-dev-training/getting-started-with-today" target="_blank" rel="noreferrer noopener"><em>Getting Started with Today,</em></a>.</p><h2 id="Download-and-Run-the-Starter-Project">Download and Run the Starter Project</h2><p>To keep this tutorial focused on implementing Auth0 authentication in an iOS app, I created a starter project that you can download. It contains a view with controls already laid out and connected to corresponding methods in the view controller. By starting with this project, you‚Äôll be able to focus on logging in, logging out, and reading and writing user information without the distraction of building a user interface.</p><p>üõ† <a href="https://assets.ctfassets.net/23aumh6u8s0i/6BGjYQpWYevjdABinJXDJ1/3fa4a7b68fa76e91e5ee1f6ffe347aa0/iOS_Auth__starter_.zip" target="_blank" rel="noreferrer noopener">Download the .zip file containing the starter project (225 KB)</a> and uncompress it. This will create a folder named <code>iOS <span>Auth</span> <span>(</span>starter<span>)</span></code> on your local drive. Open this folder, then launch Xcode by opening the project file, <code>iOS Auth<span>.</span>xcodeproj</code>.</p><p>üõ† Confirm that the starter project works. Select a simulator from the device menu at the top of the Xcode window (see the picture below), then click the ‚ñ∂Ô∏è button to run the app:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2nWTA4ZliqGHymEdE1Y9tb/80a9df8399ca3152af80e5f080d8a88e/how_to_run_the_starter_project.png" alt="Screenshot of Xcode with instructions to choose a simulator and run the app."/></p><p>The Simulator will launch, and after a moment, the app will run within the Simulator. It should look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4rqssg506NFyaePpZOZK7D/a1a20880a8218c9550ad3ceb16429658/starter_app_screen.png" alt="The starter app‚Äôs initial screen, with all the UI, controls in their default states."/></p><p>Right now, the app simply draws a user interface on the screen. You can tap on the buttons, but they‚Äôll do nothing. As you go through the steps in this tutorial, you‚Äôll add the following functionality to the app:</p><ol start="1"><li>Login</li><li>Logout</li><li>Retrieving and displaying the current user‚Äôs name and email address</li><li>Getting and setting the current user‚Äôs favorite color</li><li>Displaying a message if the <code>make_announcement</code> flag in the app metadata is set</li></ol><p>There‚Äôs one more task to perform before we set things up on the Auth0 side: you need to make a note of the app‚Äôs <a href="https://cocoacasts.com/what-are-app-ids-and-bundle-identifiers" target="_blank" rel="noreferrer noopener">bundle identifier</a>, which is a string that uniquely identifies the app.</p><p>üõ† Find the bundle identifier by opening the Project Explorer (click on the folder icon at the top of Xcode‚Äôs left column), then select the <strong>iOS Auth</strong> project. Then under <strong>Targets</strong>, select <strong>iOS Auth</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4HBsIew3R35NZ275le2chO/b1b600e3b7230b697b3ef55e67e3d148/get_bundle_identifier_1.png" alt="Xcode screenshot showing the selection of the project target."/></p><p>üõ† Select the <strong>General</strong> tab in Xcode‚Äôs center pane and look for the <strong>Bundle Identifier</strong> field value:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6TghN99Z56iPMMe5Ju7tfR/dbedbb762d581c1b5a80845fe2eda786/get_bundle_identifier_2.png" alt="Xcode screenshot showing the display of the Bundle Identifier."/></p><p>You can keep the bundle identifier currently defined in the starter project ‚Äî <code>com<span>.</span>example<span>.</span>iOS<span>-</span>Auth</code> ‚Äî or you can define your own.</p><blockquote><p>Apple encourages developers to use <a href="https://en.wikipedia.org/wiki/Reverse_domain_name_notation" target="_blank" rel="noreferrer noopener">reverse domain name notation</a> for application bundle identifiers. For example, if you own the domain <code>examplesoftwarecompany<span>.</span>com</code> and the name of the app is ‚ÄúExample App‚Äù, the recommended bundle identifier is <code>com<span>.</span>examplesoftwarecompany<span>.</span>exampleapp</code>.</p></blockquote><p>Remember the bundle identifier ‚Äî you‚Äôll use it in the next step!</p><h2 id="Register-the-App-in-the-Auth0-Dashboard">Register the App in the Auth0 Dashboard</h2><p>The next step is to register the app in your Auth0 dashboard. In this process, you will:</p><ol start="1"><li>Add the app to your Auth0 dashboard‚Äôs list of registered applications.</li><li>Gather two pieces of information that the app will need to delegate login/logout to Auth0: your tenant‚Äôs domain and the client ID that Auth0 will assign to the app.</li><li>Provide Auth0 with the necessary callback URLs to contact the app: one to call at the end of the login process and the other to call at the end of the logout process.</li></ol><p><strong>To perform this step, you‚Äôll need an Auth0 account.</strong> </p><p>üõ† If you already have an Auth0 account, log in, skip the next section, and proceed to the part titled <a href="#add-the-app-to-the-applications-list"><strong><em>Add the app to the Applications list</em></strong></a>.</p><h3 id="If-you-don-t-have-an-Auth0-account-yet---">If you don‚Äôt have an Auth0 account yet...</h3><p>üõ† <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener"><strong>...go ahead and sign up for one!</strong></a> It‚Äôs free, and we‚Äôve taken great care to make the process as painless as possible.</p><h3 id="-a-id--add-the-app-to-the-applications-list----a--Add-the-app-to-the-Applications-list"><a href="" id="add-the-app-to-the-applications-list" target="_blank" rel="noreferrer noopener"></a> Add the app to the Applications list</h3><p>üõ† In the left side menu of the <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a>, click on <strong>Applications</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2PsBUajhnnXWJR7QS8PUfg/e9c6bd92175335286aa03224e1646e91/expand_applications_menu.png" alt="The main page of the Auth0 dashboard. The reader is directed to expand the ‚ÄúApplications‚Äù menu."/></p><p>üõ† This will expand the <strong>Applications</strong> menu. Select the first item in that menu, which also has the name <strong>Applications</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2UNcUhGNq16RFBJkokz7KS/854f3e92fbe58943bf05f0f4a761d177/select_applications_menu_item.png" alt="The main page of the Auth0 dashboard, with the ‚ÄúApplications‚Äù menu expanded. The reader is directed to select the ‚ÄúApplications‚Äù menu item."/></p><p>You will now be on the <strong>Applications</strong> page. It lists all the applications that you have registered so that Auth0 can handle their login/logout processes.</p><p>üõ† Let‚Äôs create a new registration for the app. Do this by clicking the <strong>Create application</strong> button near the top right of the page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4aOFH6mt7xs9CspYNkuU7Q/1cff580b803c09236ad959b18614119a/create_application.png" alt="The ‚ÄúApplications‚Äù page. The reader is directed to click the ‚ÄúCreate Application‚Äù button."/></p><p>You‚Äôll see this dialog appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4DUTayxTzIU73jbqEMDt8O/ca0b10774523d196c9962e1dbeaf97c3/create_application.png" alt="The ‚ÄúCreate application‚Äù dialog. The application‚Äôs name is set to ‚ÄúiOS Auth‚Äù, and the selected application type is ‚ÄúNative‚Äù."/></p><p>üõ† You‚Äôll need to provide two pieces of information to continue:</p><ul><li>Enter a name for the app in the name field. It might be simplest to use the same name as your Xcode project (if you‚Äôve been following my example, use the name <strong>iOS Auth</strong>).</li><li>Specify the application type, which in this case is <strong>Native</strong>.</li></ul><p>Click <strong>Create</strong>. The <strong>Quick Start</strong> page for the app will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7uPmMEoQ3nK6NisdotfcGr/c438d72547a3c4f07a02e67abf6dd88b/quick_start_tab.png" alt="The ‚ÄúQuick Start‚Äù page. It contains several icons, each one representing an operating system or platform."/></p><p>This page provides you with ready-made projects for several different platforms that you can use as the basis for an application that delegates login/logout to Auth0. You won‚Äôt be using any of them in this exercise; instead, you‚Äôll make use of a couple of Auth0 libraries and write the code yourself. It‚Äôs more educational ‚Äî and more importantly, <em>fun</em> ‚Äî that way.</p><p>üõ† Click the <strong>Settings</strong> tab, which will take you to this page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/74VBH8wCBmY0mrgPv9raNT/d83139643eb324aae15c4335094e43b5/settings_page.png" alt="The ‚ÄúApplication‚Äù page‚Äôs ‚ÄúSettings‚Äù tab."/></p><p>You‚Äôre going to do two critical things on this page:</p><ol start="1"><li>Get information that the app needs to know about Auth0, and</li><li>Provide information that Auth0 needs to know about the app.</li></ol><p>Let‚Äôs take care of the first one: Getting the information that the app needs, namely:</p><ul><li>The <strong>domain</strong>, which you need to build the URL that the app will use to contact Auth0. It uniquely identifies your Auth0 <em>tenant</em>, which is a collection of applications, users, and other information that you have registered with your Auth0 account.</li><li>The <strong>client ID</strong>, which is the identifier that Auth0 assigned to the app. It‚Äôs how Auth0 knows which app of yours it‚Äôs working with.</li></ul><p>üõ† Get this information by copying the contents of the <strong>Domain</strong> and <strong>Client ID</strong> fields for later reference:  </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7jrEy6gvLtoG7ROVyLKij9/d3f14f7e3e9416ce5e52892764d53ddc/settings_-_get_info.png" alt="The ‚ÄúApplication‚Äù page‚Äôs ‚ÄúSettings‚Äù tab. The reader is directed to copy the values of the ‚ÄúDomain‚Äù and ‚ÄúClient ID‚Äù text fields, then to scroll down the page."/></p><p>You‚Äôll enter them into your Xcode project as strings in a property list soon.</p><p>üõ† Scroll down to the <strong>Applications URIs</strong> section. This is where you provide two pieces of information that Auth0 needs to know about the app, which are:</p><ol start="1"><li>A <strong>callback URL:</strong> the URL that Auth0 will redirect to after the user successfully logs in. There can be more than one of these.</li><li>A <strong>logout URL:</strong> the URL that Auth0 will redirect to after the user logs out. There can be more than one of these.</li></ol><p>At this point, you‚Äôre probably thinking: ‚ÄúWait a minute ‚Äî I‚Äôm writing an <em>iOS app</em>. It doesn‚Äôt have <em>web pages</em> that you navigate to using URLs, but <em>Views</em> with underlying code in <em>View Controllers</em>!‚Äù</p><p>You‚Äôre absolutely right. In the case of native applications, the callback and logout URLs are the same string, and Auth0 sends that string to the app to inform it that a user has logged in or logged out.</p><p>The string that native iOS apps use for both the callback URL and the logout URL follow this format:</p><pre><code><span>{</span><span>BUNDLE_IDENTIFIER</span><span>}</span><span>:</span><span>/</span><span>/</span><span>{</span><span>YOUR_DOMAIN</span><span>}</span><span>/</span>ios<span>/</span><span>{</span><span>BUNDLE_IDENTIFIER</span><span>}</span><span>/</span>callback</code></pre><p>üõ† To construct the string, do the following:</p><ul><li>Replace <code><span>{</span><span>BUNDLE_IDENTIFIER</span><span>}</span></code> with the app‚Äôs bundle identifier. If you didn‚Äôt change the bundle identifier in the starter project, this value is <code>com<span>.</span>example<span>.</span>login</code>. Note that <code><span>{</span><span>BUNDLE_IDENTIFIER</span><span>}</span></code> appears twice in the URL; you‚Äôll need to replace it twice.</li><li>Replace <code><span>{</span><span>YOUR_DOMAIN</span><span>}</span></code> with the value from the <strong>Domain</strong> field that you saw earlier on this page.</li></ul><p>üõ† Enter the URL you just constructed into both the <strong>Allowed Callback URLs</strong> and <strong>Allowed Login URLs</strong> fields. Remember, the same URL goes into both fields.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2OXT7ElyikvL8JNCO3RzFk/658591a0c5a67dc7e8499bb0ea02b7e5/settings_-_put_info.png" alt="The ‚ÄúApplication URIs‚Äù section of the page. The reader is directed to enter the callback URL into ‚ÄúAllowed Callback URLs‚Äù and ‚ÄúAllowed Logout URLs‚Äù."/></p><p>üõ† You‚Äôve done everything you need to do on this page. Scroll down to the bottom of the page and click the <strong>Save Changes</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3w6HT6fNOjiJPOjA5uduzt/bb290473a3ae601b70d7ce6456ac7fc4/settings_-_save_changes.png" alt="The bottom of the page, which features the ‚ÄúSave Changes‚Äù button. An arrow directs the reader to click the button."/></p><h3 id="Create-a-user-if-your-tenant-doesn-t-have-any">Create a user if your tenant doesn‚Äôt have any</h3><p>If you just created an Auth0 account, your tenant is brand new, so it won‚Äôt have any user accounts. This means that there won‚Äôt be any way to log in to the app. If this is the case, follow these steps to create a user.</p><p>üõ† In the menu on the left side of the Auth0 dashboard, click on <strong>User Management</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/13qs824Uauwv78ewd682EO/6898da1b68642b10cb9c31413f358a95/user_management_menu.png" alt="The bottom of the page. An arrow directs the reader to expand the ‚ÄúUser Management‚Äù menu."/></p><p>üõ† This will expand the <strong>User Management</strong> menu. Select the <strong>Users</strong> item in that menu:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1tivj870qehY6oIaeDolj1/31b0544fab715b7fbded29fb63802a45/select_users_menu_item.png" alt="The bottom of the page now featuring an expanded ‚ÄúUser Management‚Äù menu. An arrow directs the reader to expand the ‚ÄúUsers‚Äù menu item."/></p><p>The <strong>Users</strong> page will appear. It lists all the users registered to your tenant. If there are no users, you‚Äôll see the ‚ÄúYou don‚Äôt have any users yet‚Äù message.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1wCORw3pqSOLt65n48Qr56/7421164d02cfb112350882a4cccb4cca/click_create_user.png" alt="The ‚ÄúUsers‚Äù page. The page says, ‚ÄúYou don‚Äôt have any users yet‚Äù. An arrow directs the reader to click the ‚ÄúCreate User‚Äù button."/></p><p>üõ† Click the <strong>Create User</strong> button to create a new user, which will make this dialog box appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2s3GfTHNKRgts8lcXQJ0SH/6d6d0ca397684be75030d40bb6b94fb5/create_user_dialog.png" alt="The ‚ÄúCreate User‚Äù dialog. It has fields for email and password, as well as a drop-down menu displaying ‚ÄúUsername-Password-Authentication‚Äù."/></p><p>üõ† Enter an email address and password for the user. The only option for the <strong>Connection</strong> will be <strong>Username-Password-Authentication</strong>, so leave it as it is. Make a note of that email address and password ‚Äî you‚Äôll be using them to log in to the app.</p><p>üõ† Click the <strong>Create</strong> button to create the user. The user‚Äôs <strong>Details</strong> page will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3TbGcAFo4e4N1coNCtHYdV/fa830264079fc661cbc683590729e4b1/user_details_page.png" alt="The user‚Äôs ‚ÄúDetails‚Äù page."/></p><p>That takes care of all the setup you need to do within the Auth0 dashboard. It‚Äôs time to go back to Xcode and the app.</p><h2 id="Set-Up-the-App-to-Connect-to-Auth0">Set Up the App to Connect to Auth0</h2><p>There are a few steps that you‚Äôll need to perform before you can start coding:</p><ol start="1"><li>Store the domain and client ID values from the Auth0 dashboard in the app</li><li>Configure the app‚Äôs callback URLs</li><li>Install the <em>Auth0.swift</em> package</li></ol><h3 id="Store-the-app-s-domain-and-client-ID-in-the-app">Store the app‚Äôs domain and client ID in the app</h3><p>Just as Auth0 needs to know information about the app ‚Äî namely, its bundle identifier and callback URL ‚Äî the app needs information about Auth0. It needs to know the domain and client ID, both of which you noted previously.</p><p>The domain identifies the Auth0 tenant, and the client ID identifies the app. Neither of these values is secret, but we still recommend that you store them in a separate file that you can explicitly exclude from version control. For iOS projects, we recommend using a property list (plist) file to store the domain and client ID.</p><p>üõ† Create a new plist file. Right-click (or control-click) on the <strong>Login</strong> folder in Project Explorer and select <strong>New File‚Ä¶</strong> from the menu that appears:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3gYddZdYSUooweYdssdgH3/ac2afebc018e9ae48d4f4eb8662221e6/create_new_plist_1.png" alt="Xcode screenshot, showing the user selecting ‚ÄúFile -&gt; New File...‚Äù"/></p><p>üõ† In the window that appears, make sure that the <strong>iOS</strong> tab is selected. Scroll down the list of icons until you see the <strong>Property List</strong> icon. Select it, then click <strong>Next</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6Lo7p5Uy6Z8pDCebSpN5Xa/f7f3d413ba964e88e02cd737724d1ce3/create_new_plist_2.png" alt="Xcode screenshot, showing the selection of the ‚ÄúProperty List‚Äù file template."/></p><p>üõ† Name the file <code>Auth0<span>.</span>plist</code> and click <strong>Create</strong> to create the file:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1QMIhxogd6PUeRlEUvV5XC/c3f16e78011d0e9d9bffe3434aa551f2/create_new_plist_3.png" alt="Xcode screenshot, showing the ‚ÄúSave‚Äù dialog box for the property list."/></p><p>Xcode will display the new <code>Auth0<span>.</span>plist</code> file in a table format. Let‚Äôs add two rows to the table, which will hold the domain and client ID values.</p><p>üõ† Move the cursor over the <strong>Root</strong> row to reveal the <strong>+</strong> button. Click on the <strong>+</strong> button twice to add two rows:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/72CFkTz09NL6HRIkjtjed9/f808b0e75331e9a995fdbdeeffc993b5/create_new_plist_4.png" alt="Xcode screenshot, showing the creation of two new rows in the property list."/></p><p>üõ† Enter the following values into the two rows:</p><ul><li>Row 1:
<ul><li><strong>Key:</strong> <code>Domain</code></li><li><strong>Type:</strong> <code>String</code></li><li><strong>Value:</strong> The app‚Äôs domain from the Auth0 dashboard</li></ul></li><li>Row 2:
<ul><li><strong>Key:</strong> <code>ClientId</code></li><li><strong>Type:</strong> <code>String</code></li><li><strong>Value:</strong> The app‚Äôs client ID from the Auth0 dashboard</li></ul></li></ul><p>Your <strong>Auth0</strong> plist file should look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5kYgHzVztjEbdx1DFxBnCT/9005fc962c3c8143df794a6230880db1/create_new_plist_5.png" alt="Xcode screenshot, showing the completed property list."/></p><h3 id="Configure-the-app-s-callback-URLs">Configure the app‚Äôs callback URLs</h3><p>When an application delegates login and logout to Auth0, it navigates to an URL for an authentication server through a dedicated browser window. Once the login or logout process finishes, the authentication server needs a way to return control to the application.</p><p>In a web application, you would create a route and provide the URL for this route to Auth0. When Auth0 finishes logging in or logging out, it calls this URL, returning control to the web application.</p><p>iOS native apps aren‚Äôt web applications, and they don‚Äôt use URLs. For Auth0 to return control to an iOS app, you need to provide the app with some configuration information to allow Auth0 to use the callback URL to return control to the app.</p><p>You‚Äôll provide this configuration information by adding it to <code>Info<span>.</span>plist</code>, a file included in every default iOS project that stores configuration information. Since the configuration information isn‚Äôt sensitive, you can store it in <code>Info<span>.</span>plist</code> without compromising security.</p><p>Unlike the information you entered into <code>Auth0<span>.</span>plist</code>, the configuration information that you need to add to <code>Info<span>.</span>plist</code> is more complex. It will be easier to enter as XML.</p><p>üõ† Open <code>Info<span>.</span>plist</code> as an XML file. Right-click (or control-click) on the <strong>Info</strong> in Project Explorer, select <strong>Open As</strong> from the menu that appears, then select <strong>Source Code</strong> from the sub-menu that appears:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4h9IZfB3pKKVSTUCulR4KA/decd3e5b616dc9582fcd1e76562182f8/edit_info_plist_1.png" alt="Xcode screenshot, showing the opening of Info.plist as XML (source code)."/></p><p>Xcode will display the contents of <code>Info<span>.</span>plist</code> in XML form. It will look like this:</p><pre><code><span>&lt;</span><span>?</span>xml version<span>=</span><span>&#34;1.0&#34;</span> encoding<span>=</span><span>&#34;UTF-8&#34;</span><span>?</span><span>&gt;</span>
<span>&lt;</span><span>!</span><span>DOCTYPE</span> plist <span>PUBLIC</span> <span>&#34;-//Apple//DTD PLIST 1.0//EN&#34;</span> <span>&#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;</span><span>&gt;</span>
<span>&lt;</span>plist version<span>=</span><span>&#34;1.0&#34;</span><span>&gt;</span>
<span>&lt;</span>dict<span>&gt;</span>

<span>...</span> <span>(</span>about <span>80</span> lines <span>of</span> configuration<span>)</span>

<span>&lt;</span><span>/</span>dict<span>&gt;</span>
<span>&lt;</span><span>/</span>plist<span>&gt;</span></code></pre><p>üõ† Add the following XML to <code>Info<span>.</span>plist</code> immediately after the first <code><span>&lt;</span>dict<span>&gt;</span></code> tag in the file:</p><pre><code><span>&lt;</span>key<span>&gt;</span>CFBundleURLTypes<span>&lt;</span><span>/</span>key<span>&gt;</span>
<span>&lt;</span>array<span>&gt;</span>
  <span>&lt;</span>dict<span>&gt;</span>
    <span>&lt;</span>key<span>&gt;</span>CFBundleTypeRole<span>&lt;</span><span>/</span>key<span>&gt;</span>
    <span>&lt;</span>string<span>&gt;</span>None<span>&lt;</span><span>/</span>string<span>&gt;</span>
    <span>&lt;</span>key<span>&gt;</span>CFBundleURLName<span>&lt;</span><span>/</span>key<span>&gt;</span>
    <span>&lt;</span>string<span>&gt;</span>auth0<span>&lt;</span><span>/</span>string<span>&gt;</span>
    <span>&lt;</span>key<span>&gt;</span>CFBundleURLSchemes<span>&lt;</span><span>/</span>key<span>&gt;</span>
    <span>&lt;</span>array<span>&gt;</span>
      <span>&lt;</span>string<span>&gt;</span><span>$</span><span>(</span><span>PRODUCT_BUNDLE_IDENTIFIER</span><span>)</span><span>&lt;</span><span>/</span>string<span>&gt;</span>
    <span>&lt;</span><span>/</span>array<span>&gt;</span>
  <span>&lt;</span><span>/</span>dict<span>&gt;</span>
<span>&lt;</span><span>/</span>array<span>&gt;</span></code></pre><p>The XML above defines a type of URL named <code>auth0</code> and whose scheme is the app‚Äôs bundle identifier. In other words, the part of the URL that comes before <code><span>:</span><span>/</span><span>/</span></code> isn‚Äôt <code>http</code> or <code>https</code>, but <code>com<span>.</span>example<span>.</span>login</code> (or whatever value you entered for the app‚Äôs bundle identifier). This matches the values that you entered as the callback and logout URLs in the Auth0 dashboard.</p><p>Once you‚Äôve added the additional XML, <code>Info<span>.</span>plist</code> should look like this:</p><pre><code><span>&lt;</span><span>?</span>xml version<span>=</span><span>&#34;1.0&#34;</span> encoding<span>=</span><span>&#34;UTF-8&#34;</span><span>?</span><span>&gt;</span>
<span>&lt;</span><span>!</span><span>DOCTYPE</span> plist <span>PUBLIC</span> <span>&#34;-//Apple//DTD PLIST 1.0//EN&#34;</span> <span>&#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;</span><span>&gt;</span>
<span>&lt;</span>plist version<span>=</span><span>&#34;1.0&#34;</span><span>&gt;</span>
<span>&lt;</span>dict<span>&gt;</span>
  <span>&lt;</span>key<span>&gt;</span>CFBundleURLTypes<span>&lt;</span><span>/</span>key<span>&gt;</span>
  <span>&lt;</span>array<span>&gt;</span>
    <span>&lt;</span>dict<span>&gt;</span>
      <span>&lt;</span>key<span>&gt;</span>CFBundleTypeRole<span>&lt;</span><span>/</span>key<span>&gt;</span>
      <span>&lt;</span>string<span>&gt;</span>None<span>&lt;</span><span>/</span>string<span>&gt;</span>
      <span>&lt;</span>key<span>&gt;</span>CFBundleURLName<span>&lt;</span><span>/</span>key<span>&gt;</span>
      <span>&lt;</span>string<span>&gt;</span>auth0<span>&lt;</span><span>/</span>string<span>&gt;</span>
      <span>&lt;</span>key<span>&gt;</span>CFBundleURLSchemes<span>&lt;</span><span>/</span>key<span>&gt;</span>
      <span>&lt;</span>array<span>&gt;</span>
        <span>&lt;</span>string<span>&gt;</span><span>$</span><span>(</span><span>PRODUCT_BUNDLE_IDENTIFIER</span><span>)</span><span>&lt;</span><span>/</span>string<span>&gt;</span>
      <span>&lt;</span><span>/</span>array<span>&gt;</span>
    <span>&lt;</span><span>/</span>dict<span>&gt;</span>
  <span>&lt;</span><span>/</span>array<span>&gt;</span>
  
<span>...</span> <span>(</span>all the other configuration info<span>)</span>

<span>&lt;</span><span>/</span>dict<span>&gt;</span>
<span>&lt;</span><span>/</span>plist<span>&gt;</span></code></pre><h3 id="Install-the--Auth0-swift--package">Install the <em>Auth0.swift</em> package</h3><p>The <em>Auth0.swift</em> package is a collection of libraries that allow applications written in Swift to make use of Auth0‚Äùs authorization and authentication functionality. It contains these Swift libraries:</p><ul><li><code>Auth0</code>: A toolkit for using <a href="https://auth0.com/docs/api" target="_blank" rel="noreferrer noopener">Auth0‚Äôs APIs</a>, including the <a href="https://auth0.com/docs/api/authentication" target="_blank" rel="noreferrer noopener">Authentication API</a>, which you‚Äôll use to implement login and logout in the app.</li><li><code>JWTDecode</code>: A library for decoding <a href="https://jwt.io/introduction" target="_blank" rel="noreferrer noopener">JWTs (JSON web tokens)</a>.</li><li><code>SimpleKeychain</code>: A wrapper for the <a href="https://developer.apple.com/documentation/security/keychain_services" target="_blank" rel="noreferrer noopener">iOS Keychain</a> useful for securely storing small chunks of data, such as user credentials.</li></ul><p>There are three ways to install <em>Auth0.swift</em>:</p><ol start="1"><li><a href="https://swift.org/package-manager/" target="_blank" rel="noreferrer noopener">Swift Package Manager</a>, Apple‚Äôs dependency manager</li><li><a href="https://cocoapods.org/" target="_blank" rel="noreferrer noopener">Cocoapods</a>, a long-standing third-party package manager first released in 2011 used in many projects</li><li><a href="https://github.com/Carthage/Carthage" target="_blank" rel="noreferrer noopener">Carthage</a>, another third-party package manager</li></ol><p>You‚Äôll use Swift Package Manager in this tutorial since it‚Äôs built into Xcode and doesn‚Äôt require additional software.</p><blockquote><p><a href="https://auth0.com/docs/quickstart/native/ios-swift/00-login" target="_blank" rel="noreferrer noopener">This page contains instructions for installing <em>Auth0.swift</em> using Cocoapods and Carthage.</a></p></blockquote><p>üõ† Open the <strong>File</strong> menu, and select <strong>Add Packages...</strong>. This window will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5eWAWyzRrDJ4MiHxZU27vB/fc258e453e5fb78c180639f0af069419/install_auth0_package_1.png" alt="Xcode screenshot: The ‚ÄúAdd Packages‚Äù window."/></p><p>üõ† Enter this URL into the window‚Äôs search field:</p><pre><code>This URL points to the *Auth0.swift* package repository.
Xcode will search online and display any packages it finds at the URL.

üõ† Select the **Auth0.swift** package when it appears in the list and click **Add Package**:

![Xcode screenshot: Select ‚ÄúAuth0.swift‚Äù, then click ‚ÄúAdd Package‚Äù.](https://images.ctfassets.net/23aumh6u8s0i/5LaFAbYZsPaPHxVJf8SW6J/61b5a70b5316f5e72ca8f8c0306bc177/install_auth0_package_2.png)

üõ† You‚Äôll be asked to confirm that you want to add the *Auth0.swift* package. Click **Add Package** to reassure Xcode that yes, you want *Auth0.swift*:

![Xcode screenshot: Confirming the installation of the Auth0 package.](https://images.ctfassets.net/23aumh6u8s0i/15ix1wqGd0rOcSPlRqaURz/9dfd040fe82c97a15650bfb4a06cdf9c/install_auth0_package_3.png)

When *Auth0.swift* finishes installing, its package will appear in the list under the **Package Dependencies** tab of the **iOS Auth** project screen. You‚Äôll see *Auth0.swift‚Äôs* libraries listed in the Project Explorer pane: 

![Xcode screenshot: The ‚ÄúPackage Dependencies‚Äù tab of the ‚ÄúiOS Auth‚Äù project screen.](https://images.ctfassets.net/23aumh6u8s0i/6SU2YRslnRnIBnwGOVxoAq/aa044e9219a2e9c829523f86a59f62e3/install_auth0_package_4.png)

You‚Äôve done all the setup for connecting Auth0 to the app and the app to Auth0. It‚Äôs time to start coding!


## Implement Login

The first feature you‚Äôll implement is login. Once implemented, the user will be able to perform the following steps in the order given:

1. The user launches the app. The app displays a greeting message as its title, an enabled **Log In** button, and a disabled **Log Out** button.
2. The user taps the **Log In** button, taking them to Auth0‚Äôs web-based Universal Login screen, which appears in a dedicated browser window.
3. If the user enters a valid username/password combination, they are logged in, which means:
4. The app receives a `Credentials` object from Auth0‚Äôs authorization server. This object‚Äôs properties include the user‚Äôs [ID token](https://auth0.com/docs/security/tokens/id-tokens) and [access token](https://auth0.com/docs/security/tokens/access-tokens). This app will use the access token to retrieve more data about the user.
5. The user will be returned to the app, which displays ‚ÄúYou‚Äôre logged in‚Äù as its title, a disabled **Log In** button, an enabled **Log Out** button, and the previously-hidden **User Info** and **User Metadata** areas of the screen.


This is a simple single-screen app, so you‚Äôll do all your coding in the `ViewController` class, located in the file named `ViewController.swift`.

üõ† Open the view controller class by clicking on **ViewController** in the Project Explorer:

![Xcode screenshot: Opening the VieController file.](https://images.ctfassets.net/23aumh6u8s0i/66VfmkMOJUhW8vdDw0JOS1/1d3e28c446cf1971305560da7ab5409d/open_viewcontroller.png)


### Import the Auth0 library

üõ† You‚Äôll be writing code that uses functionality provided by the `Auth0` library. Import it by adding the following after the `import UIKit` statement near the start of the file:</code></pre><p>// ViewController.swift</p><p>import Auth0
```</p><h3 id="Add-properties-to--ViewController-">Add properties to <code>ViewController</code></h3><p>The <code>Properties</code> section of the <code>ViewController</code> class is indicated by this set of comments:</p><pre><code><span>// MARK: Properties</span>
<span>// ================</span></code></pre><p>It contains these subsections:</p><ol start="1"><li><code>On<span>-</span>screen controls</code>: These variables are references to the user elements on the app‚Äôs single screen. To save time, I‚Äôve already declared these variables and connected them to their matching UI elements in the view.</li><li><code>App and user status</code>: This empty subsection will contain variables to keep track of the app‚Äôs and user‚Äôs state.</li><li><code>Auth0 data</code>: This empty subsection will contain variables to store data received from Auth0‚Äôs authentication server ‚Äî credentials, user information, and user metadata.</li></ol><p>üõ† Update the <code>App status</code> and <code>Auth0 data</code> subsections with the following code:</p><pre><code><span>// App and user status</span>
<span>private</span> <span>var</span> appJustLaunched <span>=</span> <span>true</span>
<span>private</span> <span>var</span> userIsAuthenticated <span>=</span> <span>false</span>
<span>private</span> <span>var</span> userIsNewlyAuthenticated <span>=</span> <span>false</span>

<span>// Auth0 data</span>
<span>private</span> <span>var</span> cachedCredentials<span>:</span> <span>Credentials</span><span>?</span> <span>=</span> <span>nil</span>
<span>private</span> <span>var</span> cachedUserInfo<span>:</span> <span>UserInfo</span><span>?</span> <span>=</span> <span>nil</span>
<span>private</span> <span>var</span> cachedUserMetadata<span>:</span> <span>[</span><span>String</span> <span>:</span> <span>Any</span><span>]</span><span>?</span> <span>=</span> <span>nil</span>
<span>private</span> <span>var</span> cachedAppMetadata<span>:</span> <span>[</span><span>String</span> <span>:</span> <span>Any</span><span>]</span><span>?</span> <span>=</span> <span>nil</span></code></pre><p>Here‚Äôs an overview of the properties you just added to <code>ViewController</code>:</p><ul><li>The <code>App status</code> properties:
<ul><li><code>appJustLaunched</code>: This property will be <code><span>true</span></code> only immediately after the app is launched. We‚Äôll use its value to determine the contents of <code>titleLabel</code>, which should display a greeting at the start, but the user‚Äôs logged in/logged out status afterward.</li><li><code>userIsAuthenticated</code>: This property will be <code><span>true</span></code> if the user is logged in and <code><span>false</span></code> otherwise.</li><li><code>userIsNewlyAuthenticated</code>: This property will be <code><span>true</span></code> only immediately after the user has logged in and will be set to <code><span>false</span></code> shortly afterward. When the user is newly authenticated, the app checks the user‚Äôs app metadata to see if its <code>make_announcement</code> property is <code><span>true</span></code>. If this is the case, the app will display an alert.</li></ul></li><li><p>The <code>Auth0 data</code> properties:
</p><ul><li><code>cachedCredentials</code>: Stores the <code>Credentials</code> object that the app gets from Auth0, which contains authentication and authorization information such as the user‚Äôs ID token and access token.</li><li><code>cachedUserInfo</code>: Stores the <code>UserInfo</code> object that the app gets from Auth0, which contains basic identity information about the user, including their name and email address.</li><li><code>cachedUserMetadata</code>: Stores the <code>user_metadata</code> information that the app gets from Auth0. This is a <code><span>[</span>String<span>:</span> Any<span>]</span></code> dictionary containing values about the user‚Äôs preferences that the user <em>can</em> edit because they <em>do not</em> affect the core functionality available to the user. The app can both read <em>and</em> update user metadata. We‚Äôll take a closer look at user metadata when we add the functionality to edit and retrieve the user‚Äôs favorite color.</li><li><code>cachedAppMetadata</code>: Stores the <code>app_metadata</code> information that the app gets from Auth0. This is a <code><span>[</span>String<span>:</span> Any<span>]</span></code> dictionary containing values about the user‚Äôs status or privileges that the user <em>cannot</em> edit because they <em>do</em> affect the core functionality available to the user. The app can read app metadata but <em>cannot</em> update it. We‚Äôll take a closer look at app metadata when we add the functionality to display an announcement when the user logs in and a specific condition is met.</li></ul><h3 id="Add-the--login----method">Add the <code><span>login</span><span>(</span><span>)</span></code> method</h3></li></ul><p>Let‚Äôs write the first method for the login process: <code><span>login</span><span>(</span><span>)</span></code>. It will be calling the Auth0 authentication server and take the appropriate actions for both a successful login and a failed one. We‚Äôll implement it a little bit at a time.</p><h4 id="Skip-the-login-process-if--Auth0-plist--is-missing">Skip the login process if <em>Auth0.plist</em> is missing</h4><p>Let‚Äôs start the function with a test to see if the app contains <code>Auth0<span>.</span>plist</code>, the property list with the domain and client ID, and skips the login process if it isn‚Äôt there:</p><p>üõ† Add a new method, <code><span>login</span><span>(</span><span>)</span></code>, to the <code>Login<span>,</span> logout<span>,</span> and user information</code> section. It should look like this:</p><pre><code><span>// MARK: Login, logout, and user information</span>
<span>// =========================================</span>

<span>func</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
  <span>guard</span>
    <span>let</span> clientInfo <span>=</span> <span>plistValues</span><span>(</span>bundle<span>:</span> <span>Bundle</span><span>.</span>main<span>)</span>
  <span>else</span> <span>{</span>
    <span>return</span>
  <span>}</span>
<span>}</span></code></pre><p>The <code>guard</code> statement ensures that the app has property lists before starting the login process. Property lists are the preferred place to store configuration data in iOS apps, and the method that starts the authentication process requires the tenant‚Äôs domain and the app‚Äôs client ID to be stored in a property list.</p><h4 id="Authenticate-the-user">Authenticate the user</h4><p>Now that you have the tenant‚Äôs domain authenticate the user using Universal Login.</p><p>üõ† Update <code><span>login</span><span>(</span><span>)</span></code> to the following:</p><pre><code><span>// This first part is the code you‚Äôve already added:</span>

<span>func</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
  <span>guard</span>
    <span>let</span> clientInfo <span>=</span> <span>plistValues</span><span>(</span>bundle<span>:</span> <span>Bundle</span><span>.</span>main<span>)</span>
  <span>else</span> <span>{</span>
    <span>return</span>
  <span>}</span>


  <span>// This second part is new code:</span>
  
  <span>Auth0</span>
    <span>.</span><span>webAuth</span><span>(</span><span>)</span>
    <span>.</span><span>scope</span><span>(</span><span>&#34;openid profile email read:current_user update:current_user_metadata&#34;</span><span>)</span>
    <span>.</span><span>audience</span><span>(</span><span>&#34;https://<span><span>\(</span>clientInfo<span>.</span>domain<span>)</span></span>/api/v2/&#34;</span><span>)</span>
    <span>.</span>start <span>{</span> result <span>in</span>
        
      <span>switch</span> result <span>{</span>
              
        <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
          <span>print</span><span>(</span><span>&#34;Error: Couldn‚Äôt retrieve user credentials.\n<span><span>\(</span>error<span>.</span>localizedDescription<span>)</span></span>&#34;</span><span>)</span>
          
        <span>case</span> <span>.</span><span>success</span><span>(</span><span>let</span> credentials<span>)</span><span>:</span>
          <span>self</span><span>.</span>cachedCredentials <span>=</span> credentials
          <span>self</span><span>.</span>userIsAuthenticated <span>=</span> <span>true</span>
          <span>self</span><span>.</span>userIsNewlyAuthenticated <span>=</span> <span>true</span>
          <span>self</span><span>.</span><span>printTokens</span><span>(</span><span>)</span>
          
          <span>// TODO: Get the user‚Äôs profile information</span>
        
          <span>DispatchQueue</span><span>.</span>main<span>.</span>async <span>{</span>
            <span>self</span><span>.</span><span>updateTitle</span><span>(</span><span>)</span>
            <span>self</span><span>.</span><span>updateButtonsAndStack</span><span>(</span><span>)</span>
          <span>}</span>
          
      <span>}</span> <span>// switch</span>
      
    <span>}</span> <span>// start()</span>
    
<span>}</span></code></pre><blockquote><p>After you enter the code above, Xcode will very quickly show error messages informing you that <code>ViewCredentials</code> doesn‚Äôt have methods named <code><span>printTokens</span><span>(</span><span>)</span></code>, <code><span>updateTitle</span><span>(</span><span>)</span></code>, or <code><span>updateButtonsAndStack</span><span>(</span><span>)</span></code>. Don‚Äôt worry; you‚Äôll implement them soon.</p></blockquote><p>Although this method is formatted to span several lines, it‚Äôs just a single line of code. This line calls a chain of the <code>Auth0</code> class‚Äô methods starting with <code><span>webAuth</span><span>(</span><span>)</span></code>. If you ignore all the comments and parameters, the chain of methods looks like this:</p><pre><code><span>Auth0</span>
  <span>.</span><span>webAuth</span><span>(</span><span>)</span>
  <span>.</span><span>scope</span><span>(</span><span>)</span>
  <span>.</span><span>audience</span><span>(</span><span>)</span>
  <span>.</span><span>start</span><span>(</span><span>)</span></code></pre><p>This is the <a href="https://www.swiftbysundell.com/articles/using-the-builder-pattern-in-swift/" target="_blank" rel="noreferrer noopener">Builder design pattern</a> in action. From <code><span>webAuth</span><span>(</span><span>)</span></code> to <code><span>audience</span><span>(</span><span>)</span></code>, each method in the chain takes an argument that provides additional information about the login, using that information to create a <code>WebAuth</code> object that it passes to the next method in the chain. </p><p>The final method in the chain, <code><span>start</span><span>(</span><span>)</span></code>, takes the resulting <code>WebAuth</code> object as its argument and uses it to display the login page and define what should happen when the login succeeds and when it fails.</p><p>Let‚Äôs take a look at what each of the methods in the chain does.</p><p><code><span>webAuth</span><span>(</span><span>)</span></code> starts the web-based authentication process. It expects to find key-value pairs named <code>domain</code> and <code>clientid</code> in a property list.</p><p><code><span>scope</span><span>(</span><span>)</span></code> lists the names of <em>scopes</em> which the app will request. Scopes define the specific actions that an application can be allowed to do on a user&#39;s behalf. In response to these requests for scopes, Auth0 will return <em>claims</em>, which are assertions that an entity has some attribute. We request these scopes in order to get claims for attributes that provide information about the user, such as their various names, email address, and additional metadata.</p><p>In the code you just added to <code><span>login</span><span>(</span><span>)</span></code>, the <code><span>scope</span><span>(</span><span>)</span></code> method requests the following scopes from Auth0:</p><ul><li><code>openid</code>: Required for the app to use OpenID Connect (OIDC) to authenticate the user. This is the only scope required in <code><span>scope</span><span>(</span><span>)</span></code>‚Äôs argument; all other scopes are optional.</li><li><code>profile</code>: Information stored in the user‚Äôs profile. The profile stores a limited set of information ‚Äî the user‚Äôs various names (full name, family name, given name, middle name, nickname), the URL for the user‚Äôs picture, and when the user profile was last updated.</li><li><code>email</code>: Information about the user‚Äôs email, namely their email address and whether the email address was verified.</li><li><code>read<span>:</span>current_user</code>: Read-only access to the user‚Äôs profile.</li><li><code>update<span>:</span>current_user_metadata</code>: Read and write access to the user‚Äôs metadata. This allows the app to get and set the favorite color value in the user‚Äôs metadata.</li></ul><p><code><span>audience</span><span>(</span><span>)</span></code> specifies the API that the app will use: the Auth0 Management API, which we‚Äôll use to get information about the user.</p><p>Finally, <code><span>start</span><span>(</span><span>)</span></code> takes the <code>WebAuth</code> object constructed by all the previous methods in the chain and opens the browser window to display the login page. It has a single parameter, a closure that takes an argument containing one of two possible values: <code><span>.</span>failure</code> and <code><span>.</span>success</code>.</p><h4 id="Handle-the-login-outcomes">Handle the login outcomes</h4><p>Let‚Äôs take a closer look at the <code><span>switch</span></code> statement in <code><span>login</span><span>(</span><span>)</span></code>, which handles the two possible outcomes of the login process:</p><pre><code><span>switch</span> result <span>{</span>
      
  <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
    <span>print</span><span>(</span><span>&#34;Error: Couldn‚Äôt retrieve user credentials.\n<span><span>\(</span>error<span>.</span>localizedDescription<span>)</span></span>&#34;</span><span>)</span>
      
  <span>case</span> <span>.</span><span>success</span><span>(</span><span>let</span> credentials<span>)</span><span>:</span>
    <span>self</span><span>.</span>cachedCredentials <span>=</span> credentials
    <span>self</span><span>.</span>userIsAuthenticated <span>=</span> <span>true</span>
    <span>self</span><span>.</span>userIsNewlyAuthenticated <span>=</span> <span>true</span>
    <span>self</span><span>.</span><span>printTokens</span><span>(</span><span>)</span>

    <span>self</span><span>.</span><span>getUserInfo</span><span>(</span><span>)</span>

    <span>DispatchQueue</span><span>.</span>main<span>.</span>async <span>{</span>
      <span>self</span><span>.</span><span>updateTitle</span><span>(</span><span>)</span>
      <span>self</span><span>.</span><span>updateButtonsAndStack</span><span>(</span><span>)</span>
    <span>}</span>

<span>}</span> <span>// switch</span></code></pre><p>The <code><span>switch</span></code> statement does the following:</p><ul><li>If the login fails, the app prints an error message to the console.</li><li>If the login succeeds, the app stores the credentials that it received from the server, sets the <code>self<span>.</span>userIsAuthenticated</code> and <code>self<span>.</span>userIsNewlyAuthenticated</code> properties to <code><span>true</span></code>, and updates the user interface.</li></ul><p>Since this code is inside a closure, I put the calls to the UI methods ‚Äî <code><span>updateTitle</span><span>(</span><span>)</span></code> and <code><span>updateButtonsAndStack</span><span>(</span><span>)</span></code> ‚Äî inside a <code>Dispatch<span>.</span>main<span>.</span>async</code> block. This ensures that they ensure they execute in the main thread instead of the closure‚Äôs thread.</p><p>With a successful login, the app receives a <code>Credentials</code> object. This object‚Äôs properties hold information about the user‚Äôs authentication, including the access token, which you‚Äôll need to retrieve the user‚Äôs profile information and metadata.</p><h3 id="Add-a-token-debugger">Add a token debugger</h3><p>The <code><span>.</span>success</code> case of <code><span>login</span><span>(</span><span>)</span></code>‚Äôs <code><span>switch</span></code> statement makes a call to a method named <code><span>printTokens</span><span>(</span><span>)</span></code>. It‚Äôs a debugging tool that prints the values of the ID token and access token to the Xcode console.</p><p>üõ† Add the <code><span>printTokens</span><span>(</span><span>)</span></code> function, shown below, just after the <code><span>login</span><span>(</span><span>)</span></code> method:</p><pre><code><span>func</span> <span>printTokens</span><span>(</span><span>)</span> <span>{</span>
  <span>if</span> <span>let</span> credentials <span>=</span> cachedCredentials <span>{</span>
    <span>print</span><span>(</span><span>&#34;\nTOKENS\n======&#34;</span><span>)</span>
    <span>print</span><span>(</span><span>&#34;ID token: <span><span>\(</span>credentials<span>.</span>idToken <span>?</span><span>?</span> <span>&#34;[No ID token found.]&#34;</span><span>)</span></span>&#34;</span><span>)</span>
    <span>print</span><span>(</span><span>&#34;Access token: <span><span>\(</span>credentials<span>.</span>accessToken <span>?</span><span>?</span> <span>&#34;[No access token found.]&#34;</span><span>)</span></span>&#34;</span><span>)</span>
  <span>}</span>
<span>}</span></code></pre><p>üö®<strong>Important notice:</strong>üö® <code><span>printTokens</span><span>(</span><span>)</span></code> is a useful function for debugging while you‚Äôre developing the app. You should remove it ‚Äî along with any <code><span>print</span><span>(</span><span>)</span></code> statements, which might give away sensitive information ‚Äî when you move the app to production!</p><h3 id="Update-the-user-interface">Update the user interface</h3><p>Now that you‚Äôve implemented the underlying login code, it‚Äôs time to take care of the user interface. The first step is to initialize the user interface when the app launches. The <code><span>viewDidLoad</span><span>(</span><span>)</span></code> method is the place to do this.</p><p>üõ† Update the <code><span>viewDidLoad</span><span>(</span><span>)</span></code> method, located in the <code>View events</code> section so that it looks like this:</p><pre><code><span>// MARK: View events</span>
<span>// =================</span>

<span>override</span> <span>func</span> <span>viewDidLoad</span><span>(</span><span>)</span> <span>{</span>
  <span>super</span><span>.</span><span>viewDidLoad</span><span>(</span><span>)</span>

  <span>updateTitle</span><span>(</span><span>)</span>
  userInfoMetadataStack<span>.</span>isHidden <span>=</span> <span>true</span>
  loginButton<span>.</span>isEnabled <span>=</span> <span>true</span>
  logoutButton<span>.</span>isEnabled <span>=</span> <span>false</span>
<span>}</span></code></pre><p>The next step is to make the <strong>Log In</strong> button call the <code><span>login</span><span>(</span><span>)</span></code> method ‚Äî but only if the user isn‚Äôt already logged in.</p><p>üõ† Update <code><span>loginButtonPressed</span><span>(</span><span>)</span></code>, located in the <code>Actions</code> section, to the following:</p><pre><code><span>// MARK: Actions</span>
<span>// =============</span>

<span>@IBAction</span> <span>func</span> <span>loginButtonPressed</span><span>(</span><span>_</span> sender<span>:</span> <span>UIButton</span><span>)</span> <span>{</span>
  <span>if</span> <span>!</span>userIsAuthenticated <span>{</span>
    <span>login</span><span>(</span><span>)</span>
  <span>}</span>
<span>}</span></code></pre><p>Finally, the app needs methods to update the user interface based on the login status. These are the unimplemented <code><span>updateTitle</span><span>(</span><span>)</span></code> and <code><span>updateButtonsAndStack</span><span>(</span><span>)</span></code> methods referred to in the <code><span>login</span><span>(</span><span>)</span></code> method.</p><p>üõ† Add <code><span>updateTitle</span><span>(</span><span>)</span></code> and <code><span>updateButtonsAndStack</span><span>(</span><span>)</span></code> to the <code><span>UI</span> updaters</code> section so that it looks like this:</p><pre><code><span>// MARK: UI updaters</span>
<span>// =================</span>

<span>func</span> <span>updateTitle</span><span>(</span><span>)</span> <span>{</span>
  <span>if</span> appJustLaunched <span>{</span>
    titleLabel<span>.</span>text <span>=</span> <span>&#34;Welcome to the app!&#34;</span>
    appJustLaunched <span>=</span> <span>false</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>if</span> userIsAuthenticated <span>{</span>
      titleLabel<span>.</span>text <span>=</span> <span>&#34;You‚Äôre logged in.&#34;</span>
    <span>}</span> <span>else</span> <span>{</span>
      titleLabel<span>.</span>text <span>=</span> <span>&#34;You‚Äôre logged out.&#34;</span>
    <span>}</span>
  <span>}</span>
<span>}</span>

<span>func</span> <span>updateButtonsAndStack</span><span>(</span><span>)</span> <span>{</span>
  loginButton<span>.</span>isEnabled <span>=</span> <span>!</span>userIsAuthenticated
  logoutButton<span>.</span>isEnabled <span>=</span> userIsAuthenticated
  userInfoMetadataStack<span>.</span>isHidden <span>=</span> <span>!</span>userIsAuthenticated
<span>}</span></code></pre><p>üõ† Run the app and log in. The first time you log in, the browser window that displayed the login page will display this ‚ÄúAuthorize App‚Äù page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/717Io9c578yxjNm28P1zw9/a0ae626a58498603ed87735a04471849/authorize_app.png" alt="The ‚ÄúAuthorize App‚Äù page."/></p><p>The page makes it clear to the user that the app is asking for permission to access the user‚Äôs profile information and metadata. </p><p>üõ† Tap the <strong>Accept</strong> button to allow this access. Once you‚Äôve accepted, this page will not appear again.</p><p>You‚Äôll now be logged in, with the <strong>User Profile Info</strong> and <strong>User Metadata</strong> parts of the screen now visible.</p><h2 id="Display-the-User-s-Name-and-Email-Address">Display the User‚Äôs Name and Email Address</h2><p>When the user logs in successfully, the app receives a <code>Credentials</code> object containing authentication and authorization credentials, including an <a href="https://auth0.com/docs/security/tokens/access-tokens" target="_blank" rel="noreferrer noopener">access token</a>. This token provides the app with the authorization for the scopes requested during the login process.</p><p>One of these scopes is <code>profile</code>, which refers to the user information profile, a collection of basic information about the user. The application‚Äôs access token authorizes it to use this scope. This means that it can request the user&#39;s profile from Auth0, which will provide it as a <code>UserInfo</code> object. The app can then get the user‚Äôs name and email address from this object and display it onscreen. </p><h3 id="Retrieve-the-user-information-profile">Retrieve the user information profile</h3><p>We‚Äôll do this in a method called <code><span>getUserInfo</span><span>(</span><span>)</span></code>.</p><p>üõ† Add the following after the <code><span>login</span><span>(</span><span>)</span></code> method: </p><pre><code><span>func</span> <span>getUserInfo</span><span>(</span><span>)</span> <span>{</span>
  <span>// 1</span>
  <span>guard</span>
    <span>let</span> accessToken <span>=</span> cachedCredentials<span>?</span><span>.</span>accessToken
  <span>else</span> <span>{</span>
    <span>return</span>
  <span>}</span>

  <span>// 2</span>
  <span>Auth0</span>
    <span>.</span><span>authentication</span><span>(</span><span>)</span>
    <span>.</span><span>userInfo</span><span>(</span>withAccessToken<span>:</span> accessToken<span>)</span>
    <span>// 3</span>
    <span>.</span>start <span>{</span> result <span>in</span>
     
      <span>switch</span> result <span>{</span>
          
        <span>// 4</span>
        <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
          <span>print</span><span>(</span><span>&#34;Error: Couldn‚Äôt retrieve user info.\n<span><span>\(</span>error<span>.</span>localizedDescription<span>)</span></span>&#34;</span><span>)</span>
        
        <span>// 5</span>
        <span>case</span> <span>.</span><span>success</span><span>(</span><span>let</span> userInfo<span>)</span><span>:</span>
          <span>self</span><span>.</span>cachedUserInfo <span>=</span> userInfo
          
          <span>self</span><span>.</span><span>getMetadata</span><span>(</span><span>)</span>
          
          <span>DispatchQueue</span><span>.</span>main<span>.</span>async <span>{</span>
            <span>self</span><span>.</span><span>updateNameAndEmailUI</span><span>(</span><span>)</span>
          <span>}</span>
          
      <span>}</span> <span>// switch</span>
          
    <span>}</span> <span>// start()</span>
<span>}</span></code></pre><p>Here‚Äôs what‚Äôs happening at each of the numbered comments in the code above:</p><ol start="1"><li>This <code>guard</code> statement allows the function to continue executing only if the app has retrieved a credentials object from Auth0 and that credentials object contains an access token.</li><li>This is the Builder design pattern again, this time building an <code>Authentication</code> object which is then used to request the user‚Äôs profile information. Once again, we pass the resulting object to a method named <code><span>start</span><span>(</span><span>)</span></code>.</li><li><code><span>start</span><span>(</span><span>)</span></code> takes the <code>Authentication</code> object constructed by all the previous methods in the chain and makes the request for the user profile information. This method has a single parameter ‚Äî a closure that takes an argument containing one of two possible values: <code><span>.</span>failure</code> and <code><span>.</span>success</code>.</li><li>If the attempt to retrieve the user profile information fails, the app prints an error message to the console.</li><li>If the attempt succeeds, the app stores the user profile information that it received and uses it to update the user interface with the user‚Äôs name and email address. Since this code is inside a closure, I put the calls to the UI method inside a <code>Dispatch<span>.</span>main<span>.</span>async</code> block to ensure they execute in the main thread.</li></ol><h3 id="Update-the-user-interface">Update the user interface</h3><p>Now that we have the user information profile let‚Äôs use it to update the user interface.</p><p>üõ† Add this method into the <code><span>UI</span> updaters</code> section of <code>View Controller</code>, just after the <code><span>updateButtonsAndStack</span><span>(</span><span>)</span></code> method:</p><pre><code><span>func</span> <span>updateNameAndEmailUI</span><span>(</span><span>)</span> <span>{</span>
  userNameLabel<span>.</span>text <span>=</span> cachedUserInfo<span>?</span><span>.</span>name <span>?</span><span>?</span> <span>&#34;[Name unknown]&#34;</span>
  userEmailLabel<span>.</span>text <span>=</span> cachedUserInfo<span>?</span><span>.</span>email <span>?</span><span>?</span> <span>&#34;[Email unknown]&#34;</span>
<span>}</span></code></pre><h3 id="Update--login---">Update <code><span>login</span><span>(</span><span>)</span></code></h3><p>Now that the app has methods to retrieve the user profile information and update the display based on its contents, we need to update <code><span>login</span><span>(</span><span>)</span></code> to call on them.</p><p>üõ† Find the <code><span>// TODO: Get the user‚Äôs profile information</span></code> comment inside the <code><span>login</span><span>(</span><span>)</span></code> method and replace it with this line:</p><pre><code><span>self</span><span>.</span><span>getUserInfo</span><span>(</span><span>)</span></code></pre><p>üõ† Run the app. It will now display the user‚Äôs name and email address.</p><p>The user profile information contained within the <code>UserProfile</code> object contains only information that applies to generic user accounts. It‚Äôs centered around who the user is and how to contact them, with fields for names, photo, profile URL, real-world and email addresses, phone number, and so on.</p><p>You‚Äôll probably want to store more than just this basic information about each user. Your application may need to store the user‚Äôs preferred application settings, record their role or rank, or track if they have performed certain required actions. Users might want to add or edit information about themselves that gets shared with other app users or customize their experiences.  </p><p>You could put this additional information in a storage system such as a database, but you also have the option of using the two key-value data structures that come with every Auth0 user account:</p><ol start="1"><li><strong>User metadata:</strong> This is for storing user-related attributes that don‚Äôt affect the app‚Äôs core functionality for the user. It‚Äôs typically the sort of data that the user would be able to edit. Examples of user metadata include things such as their preferences, a bio, their social networking handles, or their favorite color.</li><li><strong>App metadata:</strong> This is for storing user-related attributes that do affect the app‚Äôs core functionality for the user. It‚Äôs typically the sort of data that the user would not edit; the user might not even be aware that this information exists. The app can only read this information. Examples of app metadata include things such as the last screen the user was viewing during the previous session, the user‚Äôs high score, or a flag or value indicating that the user has or hasn‚Äôt performed a required action.</li></ol><p>Let‚Äôs write a method that retrieves both kinds of metadata from the user‚Äôs account and stores them in local variables.</p><p>üõ† Add the following after the <code><span>getUserInfo</span><span>(</span><span>)</span></code> method:</p><pre><code><span>func</span> <span>getMetadata</span><span>(</span><span>)</span> <span>{</span>
  <span>// 1</span>
  <span>guard</span>
    <span>let</span> accessToken <span>=</span> cachedCredentials<span>?</span><span>.</span>accessToken<span>,</span>
    <span>let</span> userInfo <span>=</span> cachedUserInfo
  <span>else</span> <span>{</span>
    <span>return</span>
  <span>}</span>
  
  <span>// 2</span>
  <span>Auth0</span>
    <span>.</span><span>users</span><span>(</span>token<span>:</span> accessToken<span>)</span>
    <span>.</span><span>get</span><span>(</span>userInfo<span>.</span>sub<span>,</span> fields<span>:</span> <span>[</span><span>&#34;user_metadata&#34;</span><span>,</span> <span>&#34;app_metadata&#34;</span><span>]</span><span>,</span> include<span>:</span> <span>true</span><span>)</span>
    <span>// 3</span>
    <span>.</span>start <span>{</span> result <span>in</span>
      
      <span>switch</span> result <span>{</span>
      
        <span>// 4</span>
        <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
          <span>print</span><span>(</span><span>&#34;Error: Couldn‚Äôt retrieve metadata.\n<span><span>\(</span>error<span>.</span>localizedDescription<span>)</span></span>&#34;</span><span>)</span>
        
        <span>// 5</span>
        <span>case</span> <span>.</span><span>success</span><span>(</span><span>let</span> user<span>)</span><span>:</span>
          <span>let</span> userMetadata <span>=</span> user<span>[</span><span>&#34;user_metadata&#34;</span><span>]</span> <span>as</span><span>?</span> <span>[</span><span>String</span><span>:</span> <span>Any</span><span>]</span>
          <span>self</span><span>.</span>cachedUserMetadata <span>=</span> userMetadata
        
          <span>let</span> appMetadata <span>=</span> user<span>[</span><span>&#34;app_metadata&#34;</span><span>]</span> <span>as</span><span>?</span> <span>[</span><span>String</span><span>:</span> <span>Any</span><span>]</span>
          <span>self</span><span>.</span>cachedAppMetadata <span>=</span> appMetadata
          
          <span>DispatchQueue</span><span>.</span>main<span>.</span>async <span>{</span>

            <span>// TODO: Update the UI based on ***USER*** metadata</span>
            
            <span>// TODO: Update the UI based on ***APP*** metadata</span>

          <span>}</span>
          
      <span>}</span> <span>// switch</span>
      
    <span>}</span> <span>// start()</span>
<span>}</span></code></pre><p>Here‚Äôs what‚Äôs happening at each of the numbered comments in the code above. By this point in the exercise, you‚Äôre probably seeing a pattern in the way that the app sends a user-related request to Auth0 and handles the response:</p><ol start="1"><li>This <code>guard</code> statement allows the function to continue executing only if two conditions are met:
<ul><li>The app has retrieved a credentials object from Auth0, and that credentials object contains an access token.</li><li>The app has also retrieved a user profile information object from Auth0.</li></ul></li><li>This chain of methods does the following:
<ul><li>The <code><span>users</span><span>(</span><span>)</span></code> method takes an access token ‚Äî which comes from <code>cachedCredentials</code> ‚Äî and returns an object representing the current user.</li><li>The <code><span>get</span><span>(</span><span>)</span></code> method specifies which information about the user should be retrieved. It takes the identifier for the user (the <code>sub</code> property of the user‚Äôs profile information object), an array containing the names of the user metadata and app metadata fields of the user object, and a boolean that specifies if the names of the fields should be included or excluded from the data that this method returns. It returns an object representing a request for information from Auth0.</li></ul></li><li><code><span>start</span><span>(</span><span>)</span></code> takes the request object constructed by the previous methods in the chain and makes the request for the user‚Äôs user metadata and app metadata. This method has a single parameter ‚Äî a closure that takes an argument containing one of two possible values: <code><span>.</span>failure</code> and <code><span>.</span>success</code>.</li><li>If the attempt to retrieve the metadata fails, the app prints an error message to the console.</li><li>If the attempt succeeds, the app stores a local copy of the user metadata in the <code>cachedUserMetadata</code> property and a local copy of the app metadata in the <code>cachedAppMetadata</code> property. The app will use the data in these properties to update the user interface, as indicated by the comment <code><span>// TODO: Update the UI based on the metadata</span></code>.</li></ol><p>Now that the app has both the user and app metadata, it can do something with them. Let‚Äôs start with the user metadata.</p><p>I described the <em>user metadata</em> as a place that stores user-related information that the user can edit. We‚Äôll use it to store the name of the user‚Äôs favorite color.</p><p>Immediately after launching or when the user presses the <strong>Get favorite color</strong> button, the app should try to retrieve the user metadata value for the key named <code>favorite_color</code>. If such a value exists, the app fills the <code>favoriteColorTextField</code> control with that value.</p><p>The user should be able to update their existing favorite color (or add their favorite color, if it hasn‚Äôt yet been defined) by entering its name into the <code>favoriteColorTextField</code> control and pressing the <strong>Set favorite color</strong> button. When this happens, the app updates the user metadata by setting the value for the key <code>favorite_color</code> to the value contained in <code>favoriteColorTextField</code>.</p><h3 id="Update-the-user-s-favorite-color-in-their-user-metadata">Update the user‚Äôs favorite color in their user metadata</h3><p>Let‚Äôs first create the method that takes the contents of <code>favoriteColorTextField</code> and writes it to the user‚Äôs user metadata.</p><p>üõ† Add the following immediately after the <code><span>getMetadata</span><span>(</span><span>)</span></code> method:</p><pre><code><span>func</span> <span>updateFavoriteColor</span><span>(</span><span>)</span> <span>{</span>
  <span>// 1</span>
  <span>guard</span>
    <span>let</span> accessToken <span>=</span> cachedCredentials<span>?</span><span>.</span>accessToken<span>,</span>
    <span>let</span> userInfo <span>=</span> cachedUserInfo
  <span>else</span> <span>{</span>
    <span>return</span>
  <span>}</span>
  
  <span>// 2</span>
  <span>let</span> updatedFavoriteColor <span>=</span> favoriteColorTextField<span>.</span>text<span>?</span><span>.</span><span>trimmingCharacters</span><span>(</span><span>in</span><span>:</span> <span>.</span>whitespacesAndNewlines<span>)</span>
  
  <span>Auth0</span>
    <span>// 3</span>
    <span>.</span><span>users</span><span>(</span>token<span>:</span> accessToken<span>)</span>
    <span>.</span><span>patch</span><span>(</span>userInfo<span>.</span>sub<span>,</span> userMetadata<span>:</span> <span>[</span><span>&#34;favorite_color&#34;</span><span>:</span> updatedFavoriteColor <span>?</span><span>?</span> <span>&#34;&#34;</span><span>]</span><span>)</span>
    <span>// 4</span>
    <span>.</span>start <span>{</span> result <span>in</span>
      
      <span>switch</span> result <span>{</span>
        
        <span>// 5</span>
        <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
          <span>print</span><span>(</span><span>&#34;Error: Couldn‚Äôt update &#39;favorite_color&#39; in the user metadata.\n<span><span>\(</span>error<span>.</span>localizedDescription<span>)</span></span>&#34;</span><span>)</span>
        
        <span>// 6</span>
        <span>case</span> <span>.</span><span>success</span><span>(</span><span>let</span> updatedUserMetadata<span>)</span><span>:</span>
          <span>self</span><span>.</span>cachedUserMetadata <span>=</span> updatedUserMetadata
        
        <span>}</span> <span>// switch</span>
        
      <span>}</span> <span>// start()</span>
<span>}</span></code></pre><p>This new method, <code><span>updateFavoriteColor</span><span>(</span><span>)</span></code> is different from the other methods in the app that call Auth0. Instead of <em>reading</em> current information about the user <em>from</em> Auth0, it <em>writes</em> updated information about the user ‚Äî the user‚Äôs favorite color ‚Äî <em>to</em> Auth0.</p><p>Here‚Äôs an explanation of each of the numbered comments in the code above.</p><ol start="1"><li>This <code>guard</code> statement allows the function to continue executing only if two conditions are met:
<ul><li>The app has retrieved a credentials object from Auth0, and that credentials object contains an access token.</li><li>The app has also retrieved a user profile information object from Auth0.</li></ul></li><li>Before storing the contents of <code>favoriteColorTextField</code>, this line strips it of any leading or trailing whitespace characters.</li><li>This chain of methods does the following:
<ul><li>The <code><span>users</span><span>(</span><span>)</span></code> method takes an access token ‚Äî which comes from <code>cachedCredentials</code> ‚Äî and returns an object representing the current user.</li><li>The <code><span>patch</span><span>(</span><span>)</span></code> method specifies which user metadata should be updated. It takes the identifier for the user (the <code>sub</code> property of the user‚Äôs profile information object) and a dictionary of key-value pairs representing the updated metadata. It returns an object representing a request to Auth0 to update user metadata.</li></ul></li><li><code><span>start</span><span>(</span><span>)</span></code> takes the request object constructed by the previous methods in the chain and makes the request to update the user metadata. This method has a single parameter ‚Äî a closure that takes an argument containing one of two possible values: <code><span>.</span>failure</code> and <code><span>.</span>success</code>.</li><li>If the attempt to update the metadata fails, the app prints an error message to the console.</li><li>If the attempt succeeds, the app stores a local copy of the newly-updated user metadata.</li></ol><h3 id="Enable-the-UI-elements-that-update-and-display-the-user-s-favorite-color">Enable the UI elements that update and display the user‚Äôs favorite color</h3><p>Let‚Äôs connect the <strong>Get favorite color</strong> and <strong>Set favorite color</strong> buttons to the methods they call, then update <code>favoriteColorTextField</code>.</p><p>üõ† Update <code><span>getFavoriteColorButtonPressed</span><span>(</span><span>)</span></code> and <code>setFavoriteColorButtonPressed</code>, located in the <code>Actions</code> section, to the following:</p><pre><code><span>@IBAction</span> <span>func</span> <span>getFavoriteColorButtonPressed</span><span>(</span><span>_</span> sender<span>:</span> <span>UIButton</span><span>)</span> <span>{</span>
  <span>getMetadata</span><span>(</span><span>)</span>
<span>}</span>

<span>@IBAction</span> <span>func</span> <span>setFavoriteColorButtonPressed</span><span>(</span><span>_</span> sender<span>:</span> <span>UIButton</span><span>)</span> <span>{</span>
  <span>updateFavoriteColor</span><span>(</span><span>)</span>
<span>}</span></code></pre><p>üõ† Add the following to the end of the <code><span>UI</span> Updaters</code> section, immediately after the <code><span>updateNameAndEmailUI</span><span>(</span><span>)</span></code> method:</p><pre><code><span>func</span> <span>updateFavoriteColorUI</span><span>(</span><span>)</span> <span>{</span>
  favoriteColorTextField<span>.</span>text <span>=</span> cachedUserMetadata<span>?</span><span>[</span><span>&#34;favorite_color&#34;</span><span>]</span> <span>as</span><span>?</span> <span>String</span> <span>?</span><span>?</span> <span>&#34;&#34;</span>
<span>}</span></code></pre><p>üõ† Replace the <code><span>// TODO: Update the UI based on ***USER*** metadata</span></code> comment inside <code><span>getMetadata</span><span>(</span><span>)</span></code> so that the <code>DispatchQueue<span>.</span>main<span>.</span>async</code> block looks like this:</p><pre><code><span>DispatchQueue</span><span>.</span>main<span>.</span>async <span>{</span>
  <span>self</span><span>.</span><span>updateFavoriteColorUI</span><span>(</span><span>)</span>
              
  <span>// TODO: Update the UI based on ***APP*** metadata</span>
<span>}</span></code></pre><p>üõ† Run the app, enter a color into the text field, and tap the <strong>Set favorite color</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2z2EbmFH7uELgb74TQvySO/08405ebf53b9b5c29e8309d82f2147d2/set_favorite_color.png" alt="Setting a favorite color in the app."/></p><p>Let‚Äôs confirm that the user‚Äôs favorite color was stored in the user‚Äôs user metadata. You can do this by clearing the text field and then tapping the <strong>Get favorite color</strong> button, but there‚Äôs a more convincing way.</p><p>üõ† Go to the Auth0 dashboard and look at the user by selecting <strong>User Management</strong> in the left column menu, followed by <strong>Users</strong>, and then selecting the user currently logged into the app. You will be on that user‚Äôs page. Scroll down to the <strong>Metadata</strong> section of the page and look at the <strong>user_metadata</strong> field. You‚Äôll see that it contains a JSON dictionary with a single entry with the key <code>favorite_color</code> and whatever value you entered for the favorite color:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6rgt59fGJmB614LLMm6hKp/773dd72abe887d7e444ab58d326d388a/user_metadata_1.png" alt="The ‚Äúuser_metadata‚Äù section of the ‚ÄúUser‚Äù page in the Auth0 dashboard."/></p><p>üõ† While still on the user‚Äôs page, change the value for <code>favorite_color</code>, then click the <strong>Save</strong> button to save the change. Make sure that the ‚ÄúMetadata saved successfully!‚Äù notification appears:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/76Ft4ciLUykKYY7lbbHQEU/d970d0f130c57d5ec420da5410a3e923/user_metadata_2.png" alt="Editing the ‚Äúfavorite_color‚Äù value in the user‚Äôs ‚Äúuser_metadata‚Äù section."/></p><p>üõ† Keep the ‚ÄúUser‚Äù page of the Auth0 dashboard open ‚Äî you‚Äôll need it for the next step.</p><p>üõ† Go back to the app and tap the <strong>Get favorite color</strong> button. The text field will show the new ‚Äúfavorite color‚Äù value:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/0HYVYfzKGPPeGjuWWt1QH/9d75979fe8ff7d00a3542ab44a51110e/get_favorite_color.png" alt="Getting the favorite color in the app."/> </p><p>I described the <em>app metadata</em> as a place that stores user-related information that the user cannot edit; in fact, they might not even know it exists. The app can only read the user‚Äôs app metadata; they can‚Äôt write to it. Typically, a back-end application updates users‚Äô app metadata.</p><p>This app will display an alert box with a short message at launch if the user‚Äôs app metadata contains a key named <code>make_announcement</code> and if that key‚Äôs value is set to <code><span>true</span></code>.</p><p>First, let‚Äôs build a method to check the user‚Äôs app metadata and display the alert box if the conditions are met.</p><p>üõ† Add the following to the end of the <code><span>UI</span> Updaters</code> section, immediately after the <code><span>updateFavoriteColorUI</span><span>(</span><span>)</span></code> method:</p><pre><code><span>func</span> <span>showOptionalAnnouncement</span><span>(</span><span>)</span> <span>{</span>
  <span>if</span> <span>let</span> makeAnnouncement <span>=</span> cachedAppMetadata<span>?</span><span>[</span><span>&#34;make_announcement&#34;</span><span>]</span> <span>as</span><span>?</span> <span>Int</span> <span>{</span>
    <span>if</span> makeAnnouncement <span>!=</span> <span>0</span> <span>{</span>
      <span>let</span> title <span>=</span> <span>&#34;Announcement&#34;</span>
      <span>let</span> message <span>=</span> <span>&#34;If you‚Äôre seeing this, it means that the ‚Äômake_announcement‚Äô &#34;</span> <span>+</span>
                    <span>&#34;flag in ‚Äôapp_data‚Äô is set to ‚Äôtrue‚Äô.&#34;</span>
      <span>let</span> alert <span>=</span> <span>UIAlertController</span><span>(</span>
        title<span>:</span> title<span>,</span> message<span>:</span> message<span>,</span> preferredStyle<span>:</span> <span>.</span>alert<span>)</span>
      alert<span>.</span><span>addAction</span><span>(</span><span>UIAlertAction</span><span>(</span>title<span>:</span> <span>&#34;OK&#34;</span><span>,</span> style<span>:</span> <span>.</span><span>default</span><span>,</span> handler<span>:</span> <span>nil</span><span>)</span><span>)</span>
      <span>present</span><span>(</span>alert<span>,</span> animated<span>:</span> <span>true</span><span>,</span> completion<span>:</span> <span>nil</span><span>)</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre><p>üõ† Replace the <code><span>// TODO: Update the UI based on ***APP*** metadata</span></code> comment inside <code><span>getMetadata</span><span>(</span><span>)</span></code> so that the <code>DispatchQueue<span>.</span>main<span>.</span>async</code> block looks like this:</p><pre><code><span>DispatchQueue</span><span>.</span>main<span>.</span>async <span>{</span>
  <span>self</span><span>.</span><span>updateFavoriteColorUI</span><span>(</span><span>)</span>
              
  <span>if</span> <span>self</span><span>.</span>userIsNewlyAuthenticated <span>{</span>
    <span>self</span><span>.</span><span>showOptionalAnnouncement</span><span>(</span><span>)</span>
    <span>self</span><span>.</span>userIsNewlyAuthenticated <span>=</span> <span>false</span>
  <span>}</span>
<span>}</span></code></pre><p>The app can now check the user‚Äôs app metadata for the presence of the <code>make_announcement</code> key and its value.</p><p>üõ† Go back to the user‚Äôs ‚ÄúUser‚Äù page in the Auth0 dashboard. Change the contents of the <strong>app_metadata</strong> field in the  <strong>Metadata</strong> section to the following:</p><pre><code><span>{</span>
  <span>&#34;make_announcement&#34;</span><span>:</span> <span>true</span>
<span>}</span></code></pre><p>üõ† When you have updated the app metadata, click the <strong>Save</strong> button. Make sure that the ‚ÄúMetadata saved successfully!‚Äù notification appears:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5PDheiczfjTp4aKTyFbaiO/c5397e88c9bfcd20fb74d94a96461487/user_metadata_3.png" alt="The ‚Äúapp_metadata‚Äù field of the ‚ÄúUser‚Äù page, with the updated metadata."/></p><p>üõ† Restart the app and log in. It will display the announcement:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/526FKdoM6Wc1ZRuDlHHNVW/3519a585c2f969d7ca44b4f026d521b9/announcement.png" alt="The app, displaying the alert."/></p><h2 id="Implement-Logout">Implement Logout</h2><p>There‚Äôs only one thing left to do: implement logout!</p><p>üõ† Add this method to the end of the <code>Login<span>,</span> logout<span>,</span> and user information</code> section, just after the <code><span>updateFavoriteColor</span><span>(</span><span>)</span></code> method:</p><pre><code><span>func</span> <span>logout</span><span>(</span><span>)</span> <span>{</span>
  <span>Auth0</span>
    <span>.</span><span>webAuth</span><span>(</span><span>)</span>
    <span>.</span><span>clearSession</span><span>(</span>federated<span>:</span> <span>false</span><span>)</span> <span>{</span> result <span>in</span>
      
      <span>if</span> result <span>{</span>
        <span>print</span><span>(</span><span>&#34;Session cleared!&#34;</span><span>)</span>
        <span>self</span><span>.</span>userIsAuthenticated <span>=</span> <span>false</span>
        <span>self</span><span>.</span>cachedCredentials <span>=</span> <span>nil</span>
        <span>self</span><span>.</span>cachedUserInfo <span>=</span> <span>nil</span>
        <span>self</span><span>.</span>cachedUserMetadata <span>=</span> <span>nil</span>
        <span>self</span><span>.</span>cachedAppMetadata <span>=</span> <span>nil</span>
          
        <span>DispatchQueue</span><span>.</span>main<span>.</span>async <span>{</span>
          <span>self</span><span>.</span><span>updateTitle</span><span>(</span><span>)</span>
          <span>self</span><span>.</span><span>updateButtonsAndStack</span><span>(</span><span>)</span>
        <span>}</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>print</span><span>(</span><span>&#34;Session NOT cleared -- time to start debugging.&#34;</span><span>)</span>
      <span>}</span>
      
    <span>}</span> <span>// clearSession()</span>
<span>}</span></code></pre><p>The call to <code><span>webAuth</span><span>(</span><span>)</span></code> should seem familiar. That‚Äôs because it‚Äôs the same method you used for the login process. </p><p>As with the <code><span>login</span><span>(</span><span>)</span></code> method, <code><span>webAuth</span><span>(</span><span>)</span></code> returns a <code>WebAuth</code> object. Unlike <code><span>login</span><span>(</span><span>)</span></code>, <code><span>logout</span><span>(</span><span>)</span></code> uses WebAuth‚Äôs <code><span>clearSession</span><span>(</span><span>)</span></code> method, which logs the user out. </p><p><code><span>clearSession</span><span>(</span><span>)</span></code>‚Äôs final parameter is a closure that takes a boolean argument. This argument is <code><span>true</span></code> if the user has successfully logged out. When this happens, we set the <code>userIsAuthenticated</code> property to <code><span>false</span></code>, clear all the cached values received from Auth0, and update the user interface.</p><p>üõ† The final step is to connect the <strong>Log Out</strong> button to the <code><span>logout</span><span>(</span><span>)</span></code> method. Update the <code><span>logoutButtonPressed</span><span>(</span><span>)</span></code> method so that it looks like this:</p><pre><code><span>@IBAction</span> <span>func</span> <span>logoutButtonPressed</span><span>(</span><span>_</span> sender<span>:</span> <span>UIButton</span><span>)</span> <span>{</span>
  <span>if</span> userIsAuthenticated <span>{</span>
    <span>logout</span><span>(</span><span>)</span>
  <span>}</span>
<span>}</span></code></pre><p>üõ† Run the app. The <strong>Log Out</strong> button should work now.</p><h2 id="Conclusion">Conclusion</h2><p>You‚Äôve just built a simple iOS app that features basic username/password authentication ‚Äî the ability to identify a known user. In addition to logging a user in and out, you can also:</p><ul><li>Retrieve basic user information from their user profile,</li><li>read and update additional information from their user metadata, and</li><li>read application-specific information from the user‚Äôs app metadata.</li></ul><p>In addition to the <a href="https://assets.ctfassets.net/23aumh6u8s0i/6BGjYQpWYevjdABinJXDJ1/3fa4a7b68fa76e91e5ee1f6ffe347aa0/iOS_Auth__starter_.zip" target="_blank" rel="noreferrer noopener">.zip file of the starter project (225 KB),</a> you can also download a <a href="https://assets.ctfassets.net/23aumh6u8s0i/7LHFlrFkEpD1oGsYws3J1c/1d76aad17deeb00eb4670024c98095ee/iOS_Auth__complete_.zip" target="_blank" rel="noreferrer noopener">.zip file of the completed project (234 KB)</a>. Just remember that the best way to understand how the app integrates with Auth0 is to start with the starter project and build it following the steps above!</p><p>You can also find the starter and completed projects in the <a href="https://github.com/auth0-blog/get-started-ios-authentication-swift-uikit" target="_blank" rel="noreferrer noopener"><em>get-started-ios-authentication-swift-uikit</em> repository</a> on the <a href="https://github.com/auth0-blog" target="_blank" rel="noreferrer noopener">Auth0 Blog Samples GitHub account.</a></p><p>This is the first in a new series of articles on iOS development with Auth0. Future articles will cover an implementation of this app using SwiftUI, as well as deeper dives into authentication and authorization with iOS and Auth0 and alternatives to the standard username-and-password approach. Watch this space!</p></div></div>]]></content:encoded>
      <pubDate>Mon, 29 Nov 2021 17:14:00 +0000</pubDate>
    </item>
    <item>
      <title>Securing ASP.NET Minimal Web APIs with Auth0</title>
      <link>https://auth0.com/blog/securing-aspnet-minimal-webapis-with-auth0/</link>
      <description>Learn about the new ASP.NET minimal Web APIs introduced in .NET 6.0 and how to secure them with Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> In this article, you will learn how to build minimal Web APIs with .NET 6 and add authorization with JWT access tokens coming from Auth0. The code for this article is available from <a href="https://github.com/auth0-blog/minimalwebapi" target="_blank" rel="noreferrer noopener">this GitHub repository</a>.</p><h2 id="The-Journey-to-Minimal-Web-APIs">The Journey to Minimal Web APIs</h2><p>It has been a long journey since Microsoft released <a href="https://docs.microsoft.com/en-us/dotnet/framework/wcf/feature-details/wcf-web-http-programming-model" target="_blank" rel="noreferrer noopener">WCF REST Services</a> around 2006 for developing REST services in the .NET framework. This framework did not last long because of the complexities inherited from the WCF programming model and the limited support for using many of the features available in HTTP.  It was fine for developing chatty RPC services on top of HTTP, but not more than that.</p><p>WCF REST Services was around for a few years until the ASP.NET team introduced ASP.NET Web APIs. This brand new framework resulted from a long collaboration between Microsoft and many experts in the industry.</p><p>They also moved away from the term REST, which implied the API implementation should stick to any of the levels in the <a href="https://en.wikipedia.org/wiki/Richardson_Maturity_Model" target="_blank" rel="noreferrer noopener">Richarson&#39;s Maturity Model</a> and all the constraints described on it.</p><p>The ASP.NET Web APIs framework is still around and has gone through minor refactors over the years and a recent port to .NET Core. However, the ASP.NET team recently announced the availability of minimal Web APIs, a new way to develop and host Web APIs in .NET 6.</p><p>This article will discuss many of the improvements and simplifications introduced with minimal Web APIs and a practical example that shows how to implement a TODO list Web API integrated with Auth0 for authentication.</p><h2 id="A-First-Glance-at-Minimal-Web-APIs">A First Glance at Minimal Web APIs</h2><p>The best way to show you how a minimal Web API looks like is with code.</p><pre><code><span><span>var</span></span> app <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

app<span>.</span><span>MapGet</span><span>(</span><span>&#34;/&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>&#34;Hello World!&#34;</span><span>)</span><span>;</span>

app<span>.</span><span>Run</span><span>(</span><span>)</span><span>;</span></code></pre><p>That code is a good definition of what the term &#34;minimal&#34; implies. We only required three lines of code to get an API up and running.</p><p>The ASP.NET Team removed the friction around configuring APIs and only left the bare bones for running them. It is a top-down approach. They come configured with a basic set of features required to run and let you add more code and features on top as you need. </p><h3 id="Where-is-the--Main--entry-point-">Where is the <code>Main</code> entry point?</h3><p>If you noticed, the <code>Program</code> class and <code>Main</code> entry point have gone. That change is part of the new language features introduced with C# 9: <a href="https://docs.microsoft.com/en-us/dotnet/csharp/fundamentals/program-structure/top-level-statements" target="_blank" rel="noreferrer noopener">Top Level Statements</a>.
Before C# 9, every console program required a namespace and a <code>Program</code> class with a static <code>Main</code> method used as the entry point.
Top Level Statements in C# 9 let you write shorter programs by skipping all those requirements.  You can start writing code for your <code>Main</code> method, and the compiler will inject the rest of the code behind the scenes for you.
For the minimal Web API showed before, the resulting code would be equivalent to the following,</p><pre><code><span>namespace</span> <span>APIs</span> 
<span>{</span>
  <span>public</span> <span>class</span> <span>MyProgram</span> 
  <span>{</span>
    <span>public</span> <span>static</span> <span><span>void</span></span> <span>Main</span><span>(</span><span>params</span> <span><span>string</span><span>[</span><span>]</span></span> args<span>)</span> 
    <span>{</span>
      <span><span>var</span></span> app <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>
      app<span>.</span><span>MapGet</span><span>(</span><span>&#34;/&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>&#34;Hello World!&#34;</span><span>)</span><span>;</span>
      app<span>.</span><span>Run</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre><h3 id="What-else-from-C--9-and-10-">What else from C# 9 and 10?</h3><p>The good news is that Top Level Statements is not the only feature we could leverage in our minimal Web APIs. We also have &#34;Records&#34;, and &#34;File- scoped namespaces&#34;. Since we will use them later on, let&#39;s discuss those a little more in detail.</p><h4 id="Records">Records</h4><p>A Record is a new reference type, similar to a class or struct but implements value-based equality. That means two different variables of the same record type are equal if the values on every field are the same. 
You could accomplish the same thing in the past with a class by overriding the <code>Equals</code> method, but that is no longer necessary with Records. In addition, Records don&#39;t need property getters or setters or a constructor to be declared. </p><p>The following sample shows a record for a TODO item.</p><pre><code><span>public</span> <span>record</span> <span>TodoItem</span><span>(</span><span><span>string</span></span> id<span>,</span> <span><span>string</span></span> description<span>,</span> <span><span>bool</span></span> completed<span>)</span><span>;</span>

<span><span>var</span></span> myTodo <span>=</span> <span>new</span> <span>TodoItem</span><span>(</span><span>&#34;1&#34;</span><span>,</span> <span>&#34;buy milk&#34;</span><span>,</span> <span>false</span><span>)</span><span>;</span></code></pre><p>Records are immutable by definition. That means you have to create a copy of a record&#39;s instance when any of its properties needs to be changed. C# also offers a language expression for cloning a record and change properties on the way. </p><pre><code><span><span>var</span></span>  myTodo <span>=</span> <span>myTodo</span> with <span>{</span> completed <span>=</span> <span>true</span> <span>}</span><span>;</span></code></pre><p>The code above creates a copy of our existing <code>TodoItem</code> but sets the value for the <code>completed</code> property to <code><span>true</span></code>.</p><h4 id="File--scoped-namespaces">File- scoped namespaces</h4><p>Previous versions of C# require you to enclose all your classes and types between &#34;{}&#34; if you wanted to make them part of a namespace.  From C# 10 and on, that is no longer a requirement. 
You define a top namespace in a file, and all the types in that file will be part of it.</p><pre><code><span>namespace</span> <span>MyNamespace</span><span>;</span>

<span>public</span> <span>record</span> <span>TodoItem</span><span>(</span><span><span>string</span></span> name<span>,</span> <span><span>string</span></span> description<span>)</span><span>;</span></code></pre><p>In the example above, the record <code>TodoItem</code> will be part of the namespace <code>MyNamespace</code>. We did not have to use any curly brace at all.</p><h2 id="Prerequisites">Prerequisites</h2><p>The ASP.NET minimal Web APIs require at least the .NET 6 SDK, which you can install from the <a href="https://dotnet.microsoft.com/download/dotnet/6.0" target="_blank" rel="noreferrer noopener">.NET download section</a> of the Microsoft website.</p><p>You can also install <a href="https://visualstudio.microsoft.com/vs" target="_blank" rel="noreferrer noopener">Visual Studio 2022</a>, which supports minimal Web APIs and all the new .NET 6 features.</p><h2 id="Creating-the-TODO-API-Project">Creating the TODO API Project</h2><p>You can create the project from Visual Studio 2022 by using the &#34;ASP.NET Core Web API&#34; project template. Alternatively, you can use the .NET CLI by running the command <code>dotnet <span>new</span>  <span>web</span></code> in a terminal window.</p><p>This article will focus on Visual Studio only. From the &#34;File&#34; menu, select the option &#34;New Project&#34; and use the &#34;ASP.NET Core Web API&#34; template afterward. Pick any name for your Web API project, such as <code>MyTodoWebApi</code>. Once Visual Studio finishes the project creation, we can start playing with it.</p><h3 id="Implementing-the-repository">Implementing the repository</h3><p>The first thing we will want to do in our API is abstract how we persist the items in the TODO list.  We will use the <a href="https://martinfowler.com/eaaCatalog/repository.html" target="_blank" rel="noreferrer noopener">Repository pattern</a> for that purpose. 
This pattern consists of an interface with all the available methods for persisting changes in the TODO list and one or more concrete implementations. For simplicity, the implementation for our sample will use a hash table in memory.</p><p>Add a new file <code>TodoItem<span>.</span>cs</code> to the project and paste the following code:</p><pre><code><span>// TodoItem.cs</span>

<span>namespace</span> <span>MyTodoWebApi</span><span>;</span>

<span>public</span> <span>record</span> <span>TodoItem</span><span>(</span><span><span>string</span></span> id<span>,</span> <span><span>string</span></span> description<span>,</span> <span><span>bool</span><span>?</span></span> completed<span>)</span><span>;</span></code></pre><p>That&#39;s one of the beauties of the new Record types. We were able to define the representation of a TODO item with a single line of code.</p><p>Let&#39;s now focus on the repository implementation.</p><p>Add a new file <code>TodoRepository<span>.</span>cs</code> to the project and paste the following code:</p><pre><code><span>namespace</span> <span>MyTodoWebApi</span><span>;</span>

<span>public</span> <span>interface</span> <span>ITodoRepository</span>
<span>{</span>
    <span>Task<span>&lt;</span><span>string</span><span>&gt;</span></span> <span>CreateAsync</span><span>(</span><span><span>string</span></span> name<span>)</span><span>;</span>
    <span>Task<span>&lt;</span>IEnumerable<span>&lt;</span>TodoItem<span>&gt;</span><span>&gt;</span></span> <span>GetAllAsync</span><span>(</span><span>)</span><span>;</span>
    <span>Task<span>&lt;</span>TodoItem<span>&gt;</span></span> <span>Get</span><span>(</span><span><span>string</span></span> id<span>)</span><span>;</span>
    <span>Task</span> <span>Delete</span><span>(</span><span><span>string</span></span> id<span>)</span><span>;</span>
    <span>Task</span> <span>Update</span><span>(</span><span><span>string</span></span> id<span>,</span> <span><span>bool</span></span> completed<span>)</span><span>;</span>
<span>}</span>

<span>public</span> <span>class</span> <span>TodoRepository</span> <span>:</span> <span><span>ITodoRepository</span></span>
<span>{</span>
    <span>private</span> <span>readonly</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> TodoItem<span>&gt;</span></span> items <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> TodoItem<span>&gt;</span></span><span>(</span><span>)</span><span>;</span>

    <span>public</span> <span>Task<span>&lt;</span><span>string</span><span>&gt;</span></span> <span>CreateAsync</span><span>(</span><span><span>string</span></span> description<span>)</span>
    <span>{</span>
        <span><span>var</span></span> id <span>=</span> Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>.</span><span>ToString</span><span>(</span><span>&#34;N&#34;</span><span>)</span><span>;</span>

        items<span>.</span><span>Add</span><span>(</span>id<span>,</span> <span>new</span> <span>TodoItem</span><span>(</span>id<span>,</span> description<span>,</span> <span>false</span><span>)</span><span>)</span><span>;</span>

        <span>return</span> Task<span>.</span><span>FromResult</span><span>(</span>id<span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>Task</span> <span>Delete</span><span>(</span><span><span>string</span></span> id<span>)</span>
    <span>{</span>
        items<span>.</span><span>Remove</span><span>(</span>id<span>)</span><span>;</span>

        <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
    <span>}</span>

    <span>public</span> <span>Task<span>&lt;</span>TodoItem<span>&gt;</span></span> <span>Get</span><span>(</span><span><span>string</span></span> id<span>)</span>
    <span>{</span>
        <span>if</span> <span>(</span>items<span>.</span><span>ContainsKey</span><span>(</span>id<span>)</span><span>)</span> 
            <span>return</span> Task<span>.</span><span>FromResult</span><span>(</span>items<span>[</span>id<span>]</span><span>)</span><span>;</span>

        <span>return</span> Task<span>.</span><span><span>FromResult</span><span><span>&lt;</span>TodoItem<span>&gt;</span></span></span><span>(</span><span>null</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>Task<span>&lt;</span>IEnumerable<span>&lt;</span>TodoItem<span>&gt;</span><span>&gt;</span></span> <span>GetAllAsync</span><span>(</span><span>)</span>
    <span>{</span>
        <span><span>var</span></span> values <span>=</span> items<span>.</span><span>Select</span><span>(</span>i <span>=&gt;</span> i<span>.</span>Value<span>)</span><span>;</span>
        <span>return</span> Task<span>.</span><span>FromResult</span><span>(</span>values<span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>Task</span> <span>Update</span><span>(</span><span><span>string</span></span> id<span>,</span> <span><span>bool</span></span> completed<span>)</span>
    <span>{</span>
        <span>if</span> <span>(</span>items<span>.</span><span>ContainsKey</span><span>(</span>id<span>)</span><span>)</span>
        <span>{</span>
            items<span>[</span>id<span>]</span> <span>=</span> items<span>[</span>id<span>]</span> with <span>{</span> completed <span>=</span> completed <span>}</span><span>;</span>
        <span>}</span>

        <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
    <span>}</span>

<span>}</span></code></pre><p>We defined the abstraction <code>ITodoRepository</code> and implementation <code>TodoRepository</code> in the same file. This repository contains all the basic methods to support CRUD in our Web API. </p><h3 id="Implementing-the-minimal-Web-API">Implementing the minimal Web API</h3><p>The code for the host configuration and implementation of the API is in the <code>Program<span>.</span>cs</code> file that Visual Studio created with the project.</p><p>We will start by injecting the repository implementation in the dependency injection container used by the API. Replace the content of that file with the code below:</p><pre><code><span>// Program.cs</span>
<span>using</span> <span>MyTodoWebApi</span><span>;</span>
<span>using</span> <span>System<span>.</span>Net</span><span>;</span>

<span><span>var</span></span> builder <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>;</span>

builder<span>.</span>Services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>ITodoRepository<span>,</span> TodoRepository<span>&gt;</span></span></span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> app <span>=</span> builder<span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

<span>if</span> <span>(</span>app<span>.</span>Environment<span>.</span><span>IsDevelopment</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
    app<span>.</span><span>UseDeveloperExceptionPage</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

app<span>.</span><span>Run</span><span>(</span><span>)</span><span>;</span></code></pre><p>The repository will be a singleton that persists all the items in memory.</p><p>We can now start implementing the different methods for our API. The first one will be for creating new items in a TODO list, and we can map it to the HTTP POST verb for the route <code><span>/</span>todo</code>. Add the code below to the existing one in the <code>Program<span>.</span>cs</code> file as it is described here:</p><pre><code><span>// Program.cs</span>

<span>//...existing code</span>

<span>if</span> <span>(</span>app<span>.</span>Environment<span>.</span><span>IsDevelopment</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
    app<span>.</span><span>UseDeveloperExceptionPage</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>// üëá this is the new code</span>
app<span>.</span><span>MapPost</span><span>(</span><span>&#34;/todo&#34;</span><span>,</span> <span>async</span> <span>(</span>
    <span>HttpRequest</span> req<span>,</span>
    <span>HttpResponse</span> res<span>,</span>
    <span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span>if</span> <span>(</span><span>!</span>req<span>.</span><span>HasJsonContentType</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        <span>throw</span> <span>new</span> <span>BadHttpRequestException</span><span>(</span><span>&#34;only application/json supported&#34;</span><span>,</span>
            <span>(</span><span>int</span><span>)</span>HttpStatusCode<span>.</span>NotAcceptable<span>)</span><span>;</span>
    <span>}</span>

    <span><span>var</span></span> todo <span>=</span> <span>await</span> req<span>.</span><span><span>ReadFromJsonAsync</span><span><span>&lt;</span>TodoItem<span>&gt;</span></span></span><span>(</span><span>)</span><span>;</span>

    <span>if</span> <span>(</span>todo <span>!=</span> <span>null</span> <span>||</span> <span>string</span><span>.</span><span>IsNullOrWhiteSpace</span><span>(</span>todo<span>.</span>description<span>)</span><span>)</span>
    <span>{</span>
        <span>throw</span> <span>new</span> <span>BadHttpRequestException</span><span>(</span><span>&#34;description is required&#34;</span><span>,</span>
            <span>(</span><span>int</span><span>)</span>HttpStatusCode<span>.</span>BadRequest<span>)</span><span>;</span>
    <span>}</span>

    <span><span>var</span></span> id <span>=</span> <span>await</span> repo<span>.</span><span>CreateAsync</span><span>(</span>todo<span>.</span>description<span>)</span><span>;</span>
    res<span>.</span>StatusCode <span>=</span> <span>(</span><span>int</span><span>)</span>HttpStatusCode<span>.</span>Created<span>;</span>
    res<span>.</span>Headers<span>.</span>Location <span>=</span> <span><span>$&#34;/todo/</span><span><span>{</span><span>id</span><span>}</span></span><span>&#34;</span></span><span>;</span>
<span>}</span><span>)</span><span>;</span>
<span>// üëÜ this is the new code</span>

app<span>.</span><span>Run</span><span>(</span><span>)</span><span>;</span></code></pre><p>The implementation checks that the content type is <code>application<span>/</span>json</code> and deserializes the request body payload into a new instance of the <code>TodoItem</code> record. We only use the <code>description</code> property and ignore the rest. It later calls the repository with the new <code>TodoItem</code> instance and returns the <code><span>Created</span>  <span>(</span><span>201</span><span>)</span></code> status code and location header. </p><p>For retrieving a single item or all the items in the TODO list, we will add two new methods mapped to the HTTP GET method and URLs <code><span>/</span>todo<span>/</span><span>{</span>id<span>}</span></code> and <code><span>/</span>todo</code>, respectively.</p><blockquote><p>You could potentially use the same method and declare the <code>id</code> parameter as optional, but two different methods better demonstrate the purpose.</p></blockquote><pre><code><span>// Program.cs</span>

<span>// ...existing code</span>

<span>if</span> <span>(</span>app<span>.</span>Environment<span>.</span><span>IsDevelopment</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
    app<span>.</span><span>UseDeveloperExceptionPage</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>// üëá this is the new code</span>
app<span>.</span><span>MapGet</span><span>(</span><span>&#34;/todo&#34;</span><span>,</span> <span>async</span> <span>(</span><span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span><span>var</span></span> todos <span>=</span> <span>await</span> repo<span>.</span><span>GetAllAsync</span><span>(</span><span>)</span><span>;</span>
    <span>return</span> todos<span>;</span>
<span>}</span><span>)</span><span>;</span>

app<span>.</span><span>MapGet</span><span>(</span><span>&#34;/todo/{id}&#34;</span><span>,</span> <span>async</span> <span>(</span><span><span>string</span></span> id<span>,</span> <span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span>if</span> <span>(</span><span>string</span><span>.</span><span>IsNullOrWhiteSpace</span><span>(</span>id<span>)</span><span>)</span>
    <span>{</span>
        <span>throw</span> <span>new</span> <span>BadHttpRequestException</span><span>(</span><span>&#34;id is required&#34;</span><span>,</span>
          <span>(</span><span>int</span><span>)</span>HttpStatusCode<span>.</span>BadRequest<span>)</span><span>;</span>
    <span>}</span>

    <span><span>var</span></span> todo <span>=</span> <span>await</span> repo<span>.</span><span>Get</span><span>(</span>id<span>)</span><span>;</span>
    <span>if</span> <span>(</span>todo <span>==</span> <span>null</span><span>)</span>
    <span>{</span>
        <span>throw</span> <span>new</span> <span>BadHttpRequestException</span><span>(</span><span>&#34;item not found&#34;</span><span>,</span>
                    <span>(</span><span>int</span><span>)</span>HttpStatusCode<span>.</span>NotFound<span>)</span><span>;</span>
    <span>}</span>

    <span>return</span> todo<span>;</span>
<span>}</span><span>)</span><span>;</span>
<span>// üëÜ this is the new code</span>

<span>// ...existing code</span></code></pre><p>For changing the status of an item in the list, we will use the HTTP PUT method. Copy the following code right after the other methods for getting an item:</p><pre><code>app<span>.</span><span>MapPut</span><span>(</span><span>&#34;/todo/{id}&#34;</span><span>,</span> <span>async</span> <span>(</span><span><span>string</span></span> id<span>,</span> <span>HttpRequest</span> req<span>,</span> <span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span>if</span> <span>(</span><span>!</span>req<span>.</span><span>HasJsonContentType</span><span>(</span><span>)</span><span>)</span>
    <span>{</span>
        <span>throw</span> <span>new</span> <span>BadHttpRequestException</span><span>(</span><span>&#34;only application/json supported&#34;</span><span>,</span>
            <span>(</span><span>int</span><span>)</span>HttpStatusCode<span>.</span>NotAcceptable<span>)</span><span>;</span>
    <span>}</span>

    <span><span>var</span></span> todo <span>=</span> <span>await</span> req<span>.</span><span><span>ReadFromJsonAsync</span><span><span>&lt;</span>TodoItem<span>&gt;</span></span></span><span>(</span><span>)</span><span>;</span>

    <span>if</span><span>(</span>todo <span>!=</span> <span>null</span> <span>||</span> <span>!</span>todo<span>.</span>completed<span>.</span>HasValue<span>)</span>
    <span>{</span>
        <span>throw</span> <span>new</span> <span>BadHttpRequestException</span><span>(</span><span>&#34;completed is required&#34;</span><span>,</span>
            <span>(</span><span>int</span><span>)</span>HttpStatusCode<span>.</span>BadRequest<span>)</span><span>;</span>
    <span>}</span>
    <span>await</span> repo<span>.</span><span>Update</span><span>(</span>id<span>,</span> todo<span>.</span>completed<span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>The implementation is very similar to the POST method. It checks for the content type and deserializes the request body content into a <code>TodoItem</code> record instance. This time, we only use the <code>completed</code> property. </p><p>Finally, we will add the last method for removing items from the TODO list. Copy the following code right after the method for doing the update:</p><pre><code>app<span>.</span><span>MapDelete</span><span>(</span><span>&#34;/todo/{id}&#34;</span><span>,</span> <span>async</span> <span>(</span><span><span>string</span></span> id<span>,</span> <span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span>if</span> <span>(</span><span>string</span><span>.</span><span>IsNullOrWhiteSpace</span><span>(</span>id<span>)</span><span>)</span>
    <span>{</span>
        <span>throw</span> <span>new</span> <span>BadHttpRequestException</span><span>(</span><span>&#34;id is required&#34;</span><span>,</span>
          <span>(</span><span>int</span><span>)</span>HttpStatusCode<span>.</span>BadRequest<span>)</span><span>;</span>
    <span>}</span>
    <span>await</span> repo<span>.</span><span>Delete</span><span>(</span>id<span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>If something is wrong with the received parameters, all the validations in our methods return a <code>BadHttpRequestException</code>. Unfortunately, ASP.NET Web API will not map the status code in the exception to the status code of the HTTP response. 
We can do that mapping with custom middleware that runs right after the method call. Add the following to the existing code:</p><pre><code><span>// Program.cs</span>

<span>// ...existing code</span>

<span>if</span> <span>(</span>app<span>.</span>Environment<span>.</span><span>IsDevelopment</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
    app<span>.</span><span>UseDeveloperExceptionPage</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>// üëá this is the new code</span>
app<span>.</span><span>Use</span><span>(</span><span>async</span> <span>(</span>ctx<span>,</span> next<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span>try</span>
    <span>{</span>
        <span>await</span> <span>next</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
    <span>catch</span><span>(</span><span>BadHttpRequestException</span> ex<span>)</span>
    <span>{</span>
        ctx<span>.</span>Response<span>.</span>StatusCode <span>=</span> ex<span>.</span>StatusCode<span>;</span>
        <span>await</span> ctx<span>.</span>Response<span>.</span><span>WriteAsync</span><span>(</span>ex<span>.</span>Message<span>)</span><span>;</span>
    <span>}</span>
<span>}</span><span>)</span><span>;</span>
<span>// üëÜ this is the new code</span>

app<span>.</span><span>MapGet</span><span>(</span><span>&#34;/todo&#34;</span><span>,</span> <span>async</span> <span>(</span><span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>// ...existing code</span></code></pre><p>The order of middleware in the execution pipeline is essential. This one should run before any of the API methods, so we configure it before them.</p><h2 id="Documenting-the-Web-API">Documenting the Web API</h2><p>Many languages have emerged in the development community over the years for documenting Web APIs. <a href="https://swagger.io/specification/" target="_blank" rel="noreferrer noopener">Swagger</a> and <a href="https://raml.org/" target="_blank" rel="noreferrer noopener">RAML</a> have been two of the most strong contenders in the space, but the former seems to be the winner as it has recently become a standard called OpenAPI. These languages offer a way to document your Web API in terms of specifications and a foundation for code generation tools developers can leverage in their development environments.
Microsoft has also entered this space with <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.apiexplorer" target="_blank" rel="noreferrer noopener">ApiExplorer</a>, a framework for annotating ASP.NET Web APIs with metadata. The idea is that developers can leverage the exposed metadata for generating documentation or as a tool for generating API specifications in OpenAPI or RAML, for example.
As part of this article, we will focus on <a href="https://github.com/domaindrivendev/Swashbuckle.AspNetCore" target="_blank" rel="noreferrer noopener">Swashbuckle</a>, a .NET Core implementation for generating OpenAPI specifications (or Swagger documentation) in your ASP.NET minimal Web APIs.</p><blockquote><p>While you can still use ApiExplorer with minimal Web APIs, you are responsible for generating the documentation pages for your APIs. The support for leveraging ApiExplorer in Swashbuckle is minimal.</p></blockquote><p>Open the Package Manager Console for NuGet in Visual Studio and run the following command:</p><pre><code>Install-Package Swashbuckle.AspNetCore</code></pre><p>Once the Package Manager installs the Nuget packages in our project, you can configure the Swashbuckle middleware in the <code>Program<span>.</span>cs</code> file under the project&#39;s root folder.</p><p>Copy the following code right after the registration of the TODO repository.</p><pre><code><span>// Program.cs</span>

<span>// ...existing code</span>

builder<span>.</span>Services<span>.</span><span><span>AddSingleton</span><span><span>&lt;</span>ITodoRepository<span>,</span> TodoRepository<span>&gt;</span></span></span><span>(</span><span>)</span><span>;</span>

<span>// üëá this is the new code</span>
builder<span>.</span>Services<span>.</span><span>AddEndpointsApiExplorer</span><span>(</span><span>)</span><span>;</span>
builder<span>.</span>Services<span>.</span><span>AddSwaggerGen</span><span>(</span><span>)</span><span>;</span>
<span>// üëÜ this is the new code</span>

<span>// ...existing code</span></code></pre><p>Those lines will register all the services required by Swashbuckle to generate the documentation. </p><p>Next, we need to add the code highlighted below to configure the middleware:</p><pre><code><span>// Program.cs</span>

<span>// ...existing code</span>

<span>if</span> <span>(</span>app<span>.</span>Environment<span>.</span><span>IsDevelopment</span><span>(</span><span>)</span><span>)</span>
<span>{</span>
    app<span>.</span><span>UseDeveloperExceptionPage</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>// üëá this is the new code</span>
app<span>.</span><span>MapSwagger</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseSwaggerUI</span><span>(</span><span>)</span><span>;</span>
<span>// üëÜ this is the new code</span>

<span>// ...existing code</span></code></pre><p>The configuration of the middleware uses all the default settings. Swagger exposes the UI pages under <code><span>/</span>swagger</code> and the Swagger API specification under <code><span>/</span>swagger<span>/</span>v1<span>/</span>swagger<span>.</span>json</code>.</p><p>We can modify some of those settings to include additional information about the APIs, as shown in the following example:</p><pre><code>builder<span>.</span>Services<span>.</span><span>AddSwaggerGen</span><span>(</span>c <span>=&gt;</span>
<span>{</span>
    c<span>.</span><span>SwaggerDoc</span><span>(</span><span>&#34;v1&#34;</span><span>,</span> <span>new</span> <span>Microsoft<span>.</span>OpenApi<span>.</span>Models<span>.</span>OpenApiInfo</span> <span>{</span> 
        Title <span>=</span> <span>&#34;TODO API&#34;</span><span>,</span>
        Description <span>=</span> <span>&#34;Web APIs for managing a TODO list&#34;</span><span>,</span>
        Version <span>=</span> <span>&#34;v1&#34;</span> 
    <span>}</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>Unfortunately, a good part of the integration between Swashbuckle and ASP.NET Core Web API relies heavily on XML comments on methods and properties, which do not work well with the minimal API programming model based on delegates. For the time being, we can generate basic documentation about the APIs, which is still helpful but it does not get into specific details.</p><h2 id="Securing-the-Web-API-with-Auth0">Securing the Web API with Auth0</h2><p>Now you have a working API allowing you to perform the typical CRUD actions on a TODO list. Let&#39;s see how to secure it by integrating it with Auth0.</p><h3 id="Create-an-API-in-the-Auth0-Dashboard">Create an API in the Auth0 Dashboard</h3><p>Before adding anything to the code, we need to create an Auth0 API in the <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a>. If you haven&#39;t an Auth0 account, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one</a>. Then, go to the <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">APIs section</a> and click on <em>Create API</em>.</p><p>This will open a new window for configuring the API. Set the following fields in that window:</p><ul><li><strong>Name</strong>, a friendly name or description for the API. Enter <strong>TODO API</strong> for this sample.</li><li><strong>Identifier</strong>, which is an identifier that the client application uses to request access tokens for the API. Enter the string <code>https<span>:</span><span>/</span><span>/</span>www<span>.</span>todo<span>.</span>com</code>. This identifier is also known as <strong>audience</strong>.</li><li><strong>Signing Algorithm</strong>, leave the default setting, RS256.</li></ul><p>After entering those values, click the <em>Create</em> button.</p><p>In the configuration page of the newly created API, click the <em>Permissions</em> tab and add a new permission <code>todo<span>:</span>read<span>-</span>write</code> with a description <em>It allows reading and managing items in the TODO list</em>. This is the <a href="https://auth0.com/docs/configure/apis/scopes" target="_blank" rel="noreferrer noopener">scope</a> that Auth0 will inject in the access token if the user approves it in the <a href="https://auth0.com/docs/configure/applications/confidential-public-apps/user-consent-and-third-party-applications" target="_blank" rel="noreferrer noopener">consent screen</a>.</p><p>Now, move to the <em>Settings</em> tab and scroll down to the <em>RBAC Settings</em> section. Here, click both the <em>Enable RBAC</em> and the <em>Add Permissions in the Access Token</em> toggle buttons.</p><p>Finally, click on the <em>Save</em> button to save the changes. At this point, our API is ready to be used from your ASP.NET minimal Web API.</p><h3 id="Configuring-the--NET-Core-Middleware">Configuring the .NET Core Middleware</h3><p>To prove that they are authorized to call your Web API, clients will need to provide a JWT access token issued by Auth0.</p><p>That requires configuring the ASP.NET Core middleware for JWT authentication.</p><p>Open the Package Manager Console for NuGet in Visual Studio and run the following command:</p><pre><code>Install-Package Microsoft.AspNetCore.Authentication.JwtBearer</code></pre><p>Once the NuGet packages are installed in your project, you can go ahead and configure them in the <code>Program<span>.</span>cs</code> file.</p><p>Add the following code right after the <code>builder<span>.</span>Services<span>.</span><span>AddSwaggerGen</span><span>(</span><span>)</span><span>;</span></code> line,</p><pre><code><span>// Program.cs</span>

<span>// ...existing code</span>

builder<span>.</span>Services<span>.</span><span>AddSwaggerGen</span><span>(</span><span>)</span><span>;</span>

<span>// üëá this is the new code</span>
builder<span>.</span>Services<span>.</span><span>AddAuthentication</span><span>(</span>JwtBearerDefaults<span>.</span>AuthenticationScheme<span>)</span>
     <span>.</span><span>AddJwtBearer</span><span>(</span>JwtBearerDefaults<span>.</span>AuthenticationScheme<span>,</span> c <span>=&gt;</span>
     <span>{</span>
         c<span>.</span>Authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>
         c<span>.</span>TokenValidationParameters <span>=</span> <span>new</span> <span>Microsoft<span>.</span>IdentityModel<span>.</span>Tokens<span>.</span>TokenValidationParameters</span>
         <span>{</span>
             ValidAudience <span>=</span> builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>,</span>
             ValidIssuer <span>=</span> <span><span>$&#34;</span><span><span>{</span><span>builder<span>.</span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span>
         <span>}</span><span>;</span>
     <span>}</span><span>)</span><span>;</span>
<span>// üëÜ this is the new code</span>

<span>// ...existing code</span></code></pre><p>This middleware will intercept any call to your Web API and authenticate any received request by validating its JWT bearer token. If the validation is successful, it will initialize the security principal associated with the current execution context in the <code>HttpContext</code> class.</p><p>You will also want to perform authorization checks to ensure the JWT includes the scope required to execute your API.  You can configure authorization for our API with the following middleware injected right after the authentication one:</p><pre><code>builder<span>.</span>Services<span>.</span><span>AddAuthorization</span><span>(</span>o <span>=&gt;</span>
    <span>{</span>
        o<span>.</span><span>AddPolicy</span><span>(</span><span>&#34;todo:read-write&#34;</span><span>,</span> p <span>=&gt;</span> p<span>.</span>
            <span>RequireAuthenticatedUser</span><span>(</span><span>)</span><span>.</span>
            <span>RequireClaim</span><span>(</span><span>&#34;scope&#34;</span><span>,</span> <span>&#34;todo:read-write&#34;</span><span>)</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span></code></pre><p>The policy checks for a claim or attribute called <em>scope</em> with a value <code>todo<span>:</span>read<span>-</span>write</code>, which is the scope you previously configured in the Auth0 Dashboard for your API. </p><p>You also need to instruct the Web API to use the configured middleware for authentication and authorization. That&#39;s done with the following lines:</p><pre><code><span>// Program.cs</span>

<span>// ...existing code</span>

app<span>.</span><span>UseSwaggerUI</span><span>(</span><span>)</span><span>;</span>

<span>// üëá this is the new code</span>
app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>
<span>// üëÜ this is the new code</span>

app<span>.</span><span>Use</span><span>(</span><span>async</span> <span>(</span>ctx<span>,</span> next<span>)</span> <span>=&gt;</span>

<span>// ...existing code</span></code></pre><p>To provide your API with the setting registered in the Auth0 Dashboard, update the existing <code>appSettings<span>.</span>json</code> file by adding an <code>Auth0</code> section with the <code>Domain</code> and  <code>Audience</code> properties, as shown below:</p><pre><code><span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
      <span>&#34;LogLevel&#34;</span><span>:</span> <span>{</span>
      <span>&#34;Default&#34;</span><span>:</span> <span>&#34;Information&#34;</span><span>,</span>
      <span>&#34;Microsoft&#34;</span><span>:</span> <span>&#34;Warning&#34;</span><span>,</span>
      <span>&#34;Microsoft.Hosting.Lifetime&#34;</span><span>:</span> <span>&#34;Information&#34;</span>
      <span>}</span>
    <span>}</span><span>,</span>
  <span>&#34;AllowedHosts&#34;</span><span>:</span> <span>&#34;*&#34;</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;&lt;YOUR_DOMAIN&gt;&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;https://www.todo.com&#34;</span>
  <span>}</span>
<span>}</span></code></pre><p>Replace the <code><span>&lt;</span><span>YOUR_DOMAIN</span><span>&gt;</span></code> placeholder with the value of your Auth0 domain.</p><blockquote><p>Your Auth0 domain is a string in the form <code><span>YOUR</span><span>-</span><span>TENANT</span><span>-</span><span>NAME</span><span>.</span>auth0<span>.</span>com</code> where <code><span>YOUR</span><span>-</span><span>TENANT</span><span>-</span><span>NAME</span></code> is the name you provided when you created your account with Auth0. For more information, <a href="https://auth0.com/docs/getting-started/the-basics#domains" target="_blank" rel="noreferrer noopener">check out the documentation</a>.</p></blockquote><p>All the methods for our minimal Web API controller will allow anonymous access by default. We will convert them to require authenticated calls using the <code>RequireAuthorization</code> method during the configuration. That method will also reference the policy we previously defined in the <code>AddAuthorization</code> call. Modify each method as outlined below:</p><pre><code><span>// Program.cs</span>

<span>// ...existing code</span>

app<span>.</span><span>MapGet</span><span>(</span><span>&#34;/todo&#34;</span><span>,</span> <span>async</span> <span>(</span><span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
<span>..</span><span>..</span> <span>// Code hidden for a sake of simplicity</span>
<span>}</span><span>)</span><span>.</span><span>RequireAuthorization</span><span>(</span><span>&#34;todo:read-write&#34;</span><span>)</span><span>;</span>

app<span>.</span><span>MapGet</span><span>(</span><span>&#34;/todo/{id}&#34;</span><span>,</span> <span>async</span> <span>(</span><span><span>string</span></span> id<span>,</span> <span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span>..</span><span>..</span> <span>// Code hidden for a sake of simplicity</span>
<span>}</span><span>)</span><span>.</span><span>RequireAuthorization</span><span>(</span><span>&#34;todo:read-write&#34;</span><span>)</span><span>;</span>

app<span>.</span><span>MapPost</span><span>(</span><span>&#34;/todo&#34;</span><span>,</span> <span>async</span> <span>(</span>
    <span>HttpRequest</span> req<span>,</span>
    <span>HttpResponse</span> res<span>,</span>
    <span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span>..</span><span>..</span> <span>// Code hidden for a sake of simplicity</span>
<span>}</span><span>)</span><span>.</span><span>RequireAuthorization</span><span>(</span><span>&#34;todo:read-write&#34;</span><span>)</span><span>;</span>

app<span>.</span><span>MapDelete</span><span>(</span><span>&#34;/todo/{id}&#34;</span><span>,</span> <span>async</span> <span>(</span><span><span>string</span></span> id<span>,</span> <span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span>..</span><span>..</span> <span>// Code hidden for a sake of simplicity</span>
<span>}</span><span>)</span><span>.</span><span>RequireAuthorization</span><span>(</span><span>&#34;todo:read-write&#34;</span><span>)</span><span>;</span>

app<span>.</span><span>MapPut</span><span>(</span><span>&#34;/todo/{id}&#34;</span><span>,</span> <span>async</span> <span>(</span><span><span>string</span></span> id<span>,</span> <span>HttpRequest</span> req<span>,</span> <span>ITodoRepository</span> repo<span>)</span> <span>=&gt;</span>
<span>{</span>
    <span>..</span><span>..</span> <span>// Code hidden for a sake of simplicity</span>
<span>}</span><span>)</span><span>.</span><span>RequireAuthorization</span><span>(</span><span>&#34;todo:read-write&#34;</span><span>)</span><span>;</span>

<span>// ...existing code</span></code></pre><p>This method will do two things,</p><ul><li>It will activate the authorization middleware to validate the request and initialize the security principal for the current execution context.</li><li>It will run the <code>todo<span>:</span>read<span>-</span>write</code> policy to ensure the security principal is authorized to call that endpoint. In our case, it will check the access token includes a scope called <code>todo<span>:</span>read<span>-</span>write</code>.</li></ul><p>Once we run this project in Visual Studio, the API will only accept authenticated requests with access tokens coming from Auth0.</p><h2 id="Testing-the-API">Testing the API</h2><p>Just for testing purposes, you will use the <a href="https://auth0.com/docs/authorization/flows/client-credentials-flow" target="_blank" rel="noreferrer noopener">OAuth Client Credentials flow</a>. That will give us the flexibility of using tools well-known tools like Curl, Fiddler, or Postman. 
When you register a new API in the Auth0 Dashboard, a client application for testing the API is automatically created by Auth0 for you. That client application is generated using the following name convention  &#34;&lt;Your API name&gt; (Test Application)&#34;.</p><p>You will leverage that application to use Curl and get an access token for your API.
Go to the TODO API definition in the <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a>, and click on the <em>Machine to Machine Applications</em> tab. Under the list of applications in that tab, look for <code><span>TODO</span> <span>API</span> <span>(</span>Test Application<span>)</span></code> and make sure that the <code>Authorized</code> checkbox is enabled. If not, click on the <code>Authorized</code> checkbox to enable it.</p><p>Now click on the <em>Test</em> tab. Here you can get a token to test your Web API by clicking the <em>Copy Token</em> icon as shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3TbMDPS6kt51dqhR3BZlBQ/89d0ea4fd127205bbfc25575e749806b/copy-token.png" alt="Copy token from the Auth0 dashboard"/></p><p>After copying the test access token, you can use it to call your minimal Web API. Run the project in Visual Studio, and use Curl or any other HTTP client tool of your preference to pass the access token in the Authorization header using the Bearer scheme. For example:</p><pre><code><span>curl</span> --request GET <span>\</span>
  --url https://localhost:5001 <span>\</span>
  --header &#39;Authorization: Bearer <span>&lt;</span>YOUR_ACCESS_TOKEN<span>&gt;</span></code></pre><p>The simplification of the code required for running a new Web API represents a great addition in .NET 6 and a step forward from Microsoft to break the entry barrier for developers jumping from other platforms.</p><p>As you learned throughout the article, despite the simplification, you can still leverage the power of classical ASP.NET Web APIs to secure your endpoints with Auth0.</p><p>You can download the complete code of the sample project from <a href="https://github.com/auth0-blog/minimalwebapi" target="_blank" rel="noreferrer noopener">this GitHub repository</a>.</p></div></div>]]></content:encoded>
      <author>Require authorization in the API controller</author>
      <pubDate>Wed, 24 Nov 2021 15:24:00 +0000</pubDate>
    </item>
    <item>
      <title>State Management in Angular Using NgRx: Pt. 1</title>
      <link>https://auth0.com/blog/state-management-in-angular-with-ngrx-1/</link>
      <description>See how it&#39;s easy to manage your Angular application&#39;s state using NgRx and learn how you can use NgRx with Auth0&#39;s SDK to handle user-related functionalities.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><h2 id="Intro">Intro</h2><p>State management is a key component when building applications. There are various approaches by which we can manage the state in an Angular application, each with its pros and cons.
This blog post will focus on using NgRx as our state management solution. We will look at how you can use NgRx to manage your application&#39;s state by building a Recipe Admin Dashboard application. We will also learn how to secure the application using Auth0 and how it works with NgRx.</p><h2 id="What-Is-Ngrx">What Is Ngrx</h2><p><a href="https://ngrx.io/" target="_blank" rel="noreferrer noopener">NgRx</a> is a framework for building reactive applications in Angular. NgRx is inspired by the Redux pattern - unifying the events in your application and deriving state using RxJS. At a high level, NgRx stores a single state and uses actions to express state changes. NgRx excels in managing complex states, making it ideal for applications with a lot of user interactions and multiple data sources.</p><h2 id="How-Does-Ngrx-Work">How Does Ngrx Work</h2><p>NgRx is made up of 5 main components - Store, Actions, Reducers, Selectors, and Effects.</p><p>NgRx uses the Redux concept of unidirectional data flow, where all application data goes through the same lifecycle. This unidirectional data flow makes the application&#39;s state more predictable and thus easier to understand. This flow only applies to the state management layer and is not to be confused with the unidirectional data flow of the presentation layer. The following diagram shows the state management lifecycle in NgRx.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2DcycUsy6WR9VwxEDeiEg9/6ab8d4a7cd023248d80d2289d4e063eb/01_ngrx-how-it-works.png" alt="NgRx State Management Lifecycle Diagram"/></p><h3 id="Store">Store</h3><p>You can think of this as a client-side database. The Store in NgRx acts as the application&#39;s single source of truth. It reflects the current state of the app.</p><h3 id="Actions">Actions</h3><p>Actions express unique events that happen in our application. These events range from application lifecycle events, user interactions, to network requests. Actions are how the application communicates with NgRx to tell it what to do.</p><h3 id="Reducers">Reducers</h3><p>Reducers are responsible for handling transitions between states. Reducers react to the Actions dispatched and executes a pure function to update the Store. Pure functions are functions that are predictable and have no side effects. Given the same set of inputs, a pure function will always return the same set of outputs.</p><h3 id="Selectors">Selectors</h3><p>Selectors are pure functions for getting slices of the state from the Store. Selectors are how our application can listen to state changes.</p><h3 id="Effects">Effects</h3><p>Effects handle the side effects of each Action. These side effects range from communicating with an external API via HTTP when a certain Action is dispatched to dispatching another Action to update another part of the State.</p><h2 id="Prerequisites">Prerequisites</h2><p>Angular requires an <a href="https://nodejs.org/about/releases" target="_blank" rel="noreferrer noopener">active LTS or maintenance LTS</a> version of Node.js. Angular applications also depend on <a href="https://docs.npmjs.com/getting-started/what-is-npm" target="_blank" rel="noreferrer noopener">npm packages</a> for many features and functions. To download and install npm packages, you need an npm package manager such as <a href="https://docs.npmjs.com/cli/install" target="_blank" rel="noreferrer noopener">npm</a> or <a href="https://yarnpkg.com/" target="_blank" rel="noreferrer noopener">yarn</a>.</p><p>This project has a server-side component to it that has to run in parallel when running the Frontend. Follow the instructions in the <a href="https://github.com/auth0-cookbook/api_express_typescript_menu" target="_blank" rel="noreferrer noopener">Api Express Typescript Menu repo</a>. You can read more about setting up the server-side with Auth0 in this <a href="https://auth0.com/blog/node-js-and-typescript-tutorial-secure-an-express-api/" target="_blank" rel="noreferrer noopener">blog post</a>.</p><p>This tutorial focuses on how to use Auth0 with NgRx. For more information on setting up Auth0 for Angular applications, follow the instructions on the <a href="https://github.com/auth0-developer-hub/spa_angular_typescript_dashboard/blob/master/README.md#register-a-client-application-with-auth0" target="_blank" rel="noreferrer noopener">README</a> or refer to this <a href="https://auth0.com/blog/complete-guide-to-angular-user-authentication/#Connect-Angular-with-Auth0" target="_blank" rel="noreferrer noopener">blog post</a>.</p><h2 id="Getting-Started-Quickly">Getting Started Quickly</h2><p>I created a demo application with the basic structure and components to help you implement the NgRx related part.</p><p>Clone the demo app and check out its starter branch:</p><pre><code><span>git</span> clone -b starter git@github.com:auth0-developer-hub/spa_angular_typescript_dashboard.git</code></pre><p>Once you clone the repo, make <code>spa_angular_typescript_dashboard</code> your current directory:</p><pre><code><span>cd</span> spa_angular_typescript_dashboard</code></pre><p>Install the project&#39;s dependencies:</p><pre><code><span>npm</span> i</code></pre><p>Run the project locally:</p><pre><code><span>npm</span> run start</code></pre><p>You can use the <a href="https://github.com/zalmoxisus/redux-devtools-extension/" target="_blank" rel="noreferrer noopener">redux devtools</a> extension for Chrome or Firefox for debugging store-related operations.</p><p>To use this extension with NgRx, you&#39;ll need to add NgRx&#39;s devtools dependency to our project. You can do this using either <code>npm</code> or Angular&#39;s CLI.</p><p>Using <code>npm</code></p><pre><code><span>npm</span> <span>install</span> @ngrx/store-devtools --save</code></pre><p>Using Angular&#39;s CLI</p><blockquote><p>To use the Angular CLI, you will need to have the CLI installed globally. Refer to instructions on the <a href="https://angular.io/cli" target="_blank" rel="noreferrer noopener">Angular docs</a> for how to set this up.</p></blockquote><pre><code>ng <span>add</span> @ngrx/store-devtools@latest</code></pre><p>Import the <code>StoreDevToolsModule</code> in our <code>AppModule</code> and configure it based on your project&#39;s requirements. For this tutorial, you&#39;ll be using their default configuration. Open <code>app<span>.</span>module<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/app.module.ts</span>

<span>import</span> <span>{</span> BrowserModule <span>}</span> <span>from</span> <span>&#34;@angular/platform-browser&#34;</span><span>;</span>
<span>import</span> <span>{</span> NgModule <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> HttpClientModule<span>,</span> <span>HTTP_INTERCEPTORS</span> <span>}</span> <span>from</span> <span>&#34;@angular/common/http&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthHttpInterceptor<span>,</span> AuthModule <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> StoreDevtoolsModule <span>}</span> <span>from</span> <span>&#34;@ngrx/store-devtools&#34;</span><span>;</span>

<span>import</span> <span>{</span> AppRoutingModule <span>}</span> <span>from</span> <span>&#34;./app-routing.module&#34;</span><span>;</span>
<span>import</span> <span>{</span> AppComponent <span>}</span> <span>from</span> <span>&#34;./app.component&#34;</span><span>;</span>
<span>import</span> <span>{</span> NavBarModule <span>}</span> <span>from</span> <span>&#34;./shared&#34;</span><span>;</span>
<span>import</span> <span>{</span> environment <span>}</span> <span>from</span> <span>&#34;src/environments/environment&#34;</span><span>;</span>
<span>import</span> <span>{</span> reducers<span>,</span> metaReducers <span>}</span> <span>from</span> <span>&#34;./core/state&#34;</span><span>;</span>
<span>import</span> <span>{</span> UserEffects <span>}</span> <span>from</span> <span>&#34;./core/state/user&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusEffects <span>}</span> <span>from</span> <span>&#34;./core/state/menus&#34;</span><span>;</span>

@<span>NgModule</span><span>(</span><span>{</span>
  imports<span>:</span> <span>[</span>
    BrowserModule<span>,</span>
    HttpClientModule<span>,</span>
    AuthModule<span>.</span><span>forRoot</span><span>(</span><span>{</span>
      <span>...</span>environment<span>.</span>auth<span>,</span>
      httpInterceptor<span>:</span> <span>{</span>
        allowedList<span>:</span> <span>[</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items</span><span>`</span></span><span>,</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items/*</span><span>`</span></span><span>,</span>
        <span>]</span><span>,</span>
      <span>}</span><span>,</span>
    <span>}</span><span>)</span><span>,</span>
    AppRoutingModule<span>,</span>
    NavBarModule<span>,</span>

    <span>// ‚ú® New üëá</span>
    StoreDevtoolsModule<span>.</span><span>instrument</span><span>(</span><span>{</span>
      maxAge<span>:</span> <span>25</span><span>,</span>
      logOnly<span>:</span> environment<span>.</span>production<span>,</span>
    <span>}</span><span>)</span><span>,</span>
  <span>]</span><span>,</span>
  declarations<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  bootstrap<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  providers<span>:</span> <span>[</span>
    <span>{</span>
      provide<span>:</span> <span>HTTP_INTERCEPTORS</span><span>,</span>
      useClass<span>:</span> AuthHttpInterceptor<span>,</span>
      multi<span>:</span> <span>true</span><span>,</span>
    <span>}</span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppModule</span> <span>{</span><span>}</span></code></pre><blockquote><p>If you used Angular&#39;s CLI to add NgRx devtools, this part might have been updated automatically.</p></blockquote><h3 id="Running-the-App-and-turning-on-Devtools">Running the App and turning on Devtools</h3><p>After following the steps in this section, you should see an option to activate Redux Devtools in your toolbar when you run the app. Once activated, you should see a window with an interface similar to the image below.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/72gMjqETihKrGgQwH4a02k/229599d15c7afb9f6258b28f4aec17a2/02_ngrx-redux-devtools.png" alt="Redux Devtools with NgRx"/></p><blockquote><p>You can learn more about these features from their <a href="https://github.com/zalmoxisus/redux-devtools-extension" target="_blank" rel="noreferrer noopener">official documentation</a>.</p></blockquote><h2 id="Install-NgRx">Install NgRx</h2><p>You can either use <code>npm</code> or Angular&#39;s CLI to install NgRx dependencies.</p><p>Using <code>npm</code></p><pre><code><span>npm</span> <span>install</span> @ngrx/store --save</code></pre><p>Using Angular&#39;s CLI</p><pre><code>ng <span>add</span> @ngrx/store@latest</code></pre><p>You will also be using NgRx&#39;s Effects to handle your store&#39;s side effects. Let&#39;s add that dependency.</p><p>Using <code>npm</code></p><pre><code><span>npm</span> <span>install</span> @ngrx/effects --save</code></pre><p>Using Angular&#39;s CLI</p><pre><code>ng <span>add</span> @ngrx/effects@latest</code></pre><blockquote><p>At the time this post was written, the latest NgRx store and effects version was <code><span>12.2</span><span>.0</span></code>, which will be the version we will be using throughout the tutorial.</p></blockquote><h2 id="Architecture">Architecture</h2><p>At its core, the app is an admin dashboard where the logged-in user can add, edit, and delete a menu item. The logged-in user will perform all the operations or a subset of it depending on their permissions. You will use NgRx to manage the state updates and user/server related events.</p><p>You will create two Stores for our application:</p><ul><li><em>menus</em>: to manage menu related functionalities (CRUD operations)</li><li><em>user</em>: to manage user-related functionalities such as authentication using Auth0</li></ul><p>You will also split each part of the Store into individual files to make it easier to follow throughout the tutorial.</p><p>Let&#39;s first start by creating the following folder structure in our <code>core</code> directory (you will be updating each file as we discuss each section):</p><pre><code><span>|</span><span>-</span> src<span>/</span>app<span>/</span>core
    <span>|</span><span>-</span> state
        <span>|</span><span>-</span> menus
            <span>|</span><span>-</span> menus<span>.</span>actions<span>.</span>ts
            <span>|</span><span>-</span> menus<span>.</span>effects<span>.</span>ts
            <span>|</span><span>-</span> menus<span>.</span>reducer<span>.</span>ts
            <span>|</span><span>-</span> menus<span>.</span>selector<span>.</span>ts
            <span>|</span><span>-</span> menus<span>.</span>state<span>.</span>ts
            <span>|</span><span>-</span> index<span>.</span>ts
        <span>|</span><span>-</span> user
            <span>|</span><span>-</span> user<span>.</span>actions<span>.</span>ts
            <span>|</span><span>-</span> user<span>.</span>effects<span>.</span>ts
            <span>|</span><span>-</span> user<span>.</span>reducer<span>.</span>ts
            <span>|</span><span>-</span> user<span>.</span>selector<span>.</span>ts
            <span>|</span><span>-</span> user<span>.</span>state<span>.</span>ts
            <span>|</span><span>-</span> index<span>.</span>ts
        <span>|</span><span>-</span> core<span>.</span>state<span>.</span>ts
        <span>|</span><span>-</span> core<span>.</span>reducer<span>.</span>ts
        <span>|</span><span>-</span> index<span>.</span>ts</code></pre><blockquote><p>The starter app is using a <code>BehaviorSubject</code> in <code>menu<span>-</span>state<span>.</span>service<span>.</span>ts</code> to manage it&#39;s state. This tutorial will walk you through migrating that to NgRx.</p></blockquote><p>Let&#39;s start with creating the state object for menus. Open <code>menus<span>.</span>state<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.state.ts</span>

<span>import</span> <span>{</span> MenuItem <span>}</span> <span>from</span> <span>&#34;../../models&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>MenusState</span> <span>{</span>
  menuItems<span>:</span> MenuItem<span>[</span><span>]</span><span>;</span>
<span>}</span>

<span>export</span> <span>const</span> initialState<span>:</span> MenusState <span>=</span> <span>{</span>
  menuItems<span>:</span> <span>[</span><span>]</span><span>,</span>
<span>}</span><span>;</span></code></pre><p>Let&#39;s also create a barrel export in our <code>menus</code> folder. Create <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.state&#34;</span><span>;</span></code></pre><p>The interface <code>MenusState</code> defines the type of object Menu&#39;s state will have. The <code>initialState</code>, on the other hand, represents the initial state of the state object when the store is first initialized.</p><h4 id="Create-Core-State">Create Core State</h4><p>To be able to access <code>MenusState</code> from our Store, you will need to add it to your <code>CoreState</code>&#39;s state object. Open <code>core<span>.</span>state<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/core.state.ts</span>

<span>import</span> <span>{</span> MenusState <span>}</span> <span>from</span> <span>&#34;./menus&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>State</span> <span>{</span>
  menus<span>:</span> MenusState<span>;</span>
<span>}</span></code></pre><p>Next, you will need to define what Actions you need to handle. We will be following the Good Action Hygiene principle when writing our Actions.</p><p>On a high level, Good Action Hygiene recommends thinking of Actions as events instead of commands. Instead of <code>addMenuItem</code> as the Action, use <code>addMenuItemFormSubmitted</code>. This pattern also encourages dispatching specific Action instead of reusing the same Action and including the source as part of the Action type. The image below shows the anatomy of an Action&#39;s type.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2EOftbMAcDK1OKqVxiHSO8/13acf843a2d8422f35eb4e0736e7abc2/03_ngrx-good-action-hygiene.png" alt="Anatomy of an Action name"/></p><p>Following this pattern makes it easier to debug as you have distinct Actions from each source. This lets you immediately know what event has just taken place and where it came from with a quick look at the devtools.</p><p>You can learn more about Good Action hygiene in this <a href="https://indepth.dev/posts/1407/force-good-action-hygiene-and-write-less-actions-in-ngrx-with-the-prepared-events-pattern" target="_blank" rel="noreferrer noopener">blog post</a> by Sameera Perera and Mike Ryan&#39;s <a href="https://youtu.be/JmnsEvoy-gY" target="_blank" rel="noreferrer noopener">talk</a> at ng-conf 2018.</p><p>Let&#39;s start with user-initiated Actions. This would include adding a new menu item, updating an existing menu item, and deleting a current menu item. Open <code>menus<span>.</span>actions<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.actions.ts</span>
<span>import</span> <span>{</span> createAction<span>,</span> props <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem<span>,</span> MenuItem <span>}</span> <span>from</span> <span>&#34;../../models&#34;</span><span>;</span>

<span>export</span> <span>const</span> addMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Add Menu Page] Add Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> BaseMenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> editMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Edit Menu Page] Edit Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> MenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> deleteMenuItemInitiated <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Delete Menu Page] Delete Menu Item Initiated&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuId<span>:</span> <span>string</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>You will need to fetch the menus from our API as the app load. Let&#39;s add an <code>appLoaded</code> Action that will be dispatched when the app loads. Open <code>menus<span>.</span>actions<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.actions.ts</span>
<span>import</span> <span>{</span> createAction<span>,</span> props <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem<span>,</span> MenuItem <span>}</span> <span>from</span> <span>&#34;../../models&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> appLoaded <span>=</span> <span>createAction</span><span>(</span><span>&#34;[App] App Loaded&#34;</span><span>)</span><span>;</span>

<span>export</span> <span>const</span> addMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Add Menu Page] Add Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> BaseMenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> editMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Edit Menu Page] Edit Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> MenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> deleteMenuItemInitiated <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Delete Menu Page] Delete Menu Item Initiated&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuId<span>:</span> <span>string</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>Let&#39;s continue to other API-related Actions. Since calling an API could either succeed or fail, let&#39;s add success and fail handlers for each API-related Action.</p><blockquote><p>You could do success and error handling in several different ways. What I&#39;m showing you is just one way you could do this.</p></blockquote><p>Open <code>menus<span>.</span>actions<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.actions.ts</span>

<span>import</span> <span>{</span> createAction<span>,</span> props <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem<span>,</span> MenuItem <span>}</span> <span>from</span> <span>&#34;../../models&#34;</span><span>;</span>

<span>export</span> <span>const</span> appLoaded <span>=</span> <span>createAction</span><span>(</span><span>&#34;[App] App Loaded&#34;</span><span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> fetchMenuSuccess <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Fetch Menu Success&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItems<span>:</span> MenuItem<span>[</span><span>]</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> fetchMenuFailed <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Fetch Menu Failed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> error<span>:</span> <span>any</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> addMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Add Menu Page] Add Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> BaseMenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> addMenuItemSuccess <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Add Menu Item Success&#34;</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> addMenuItemFailed <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Add Menu Item Failed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> error<span>:</span> <span>any</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> editMenuItemFormSubmitted <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Edit Menu Page] Edit Menu Item Form Submitted&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> MenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> editMenuItemSuccess <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Edit Menu Item Success&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuItem<span>:</span> MenuItem <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> editMenuItemFailed <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Edit Menu Item Failed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> error<span>:</span> <span>any</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>const</span> deleteMenuItemInitiated <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Delete Menu Page] Delete Menu Item Initiated&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuId<span>:</span> <span>string</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> deleteMenuItemSuccess <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Delete Menu Item Success&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> menuId<span>:</span> <span>string</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> deleteMenuItemFailed <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Menu API] Delete Menu Item Failed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> error<span>:</span> <span>any</span> <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>Let&#39;s also add this to the barrel export. Open <code>index<span>.</span>ts</code> and add the following code:</p><pre><code><span>// src/app/core/state/menus/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.state&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span></code></pre><p>You will now update the current implementation in our application with these Actions for any state-related operations. You do this by injecting NgRx&#39;s <code>Store</code> in the component and calling its <code>dispatch</code> function with the Action you want to execute.</p><p>Starting with <code>appLoaded</code>, as this is called when the application first loads, let&#39;s add this to your <code>AppComponent</code>&#39;s <code>ngOnInit</code>. Open <code>app<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/app.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> appLoaded <span>}</span> <span>from</span> <span>&#34;./core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-root&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./app.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./app.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppComponent</span> <span>{</span>
  title <span>=</span> <span>&#34;spa-angular-typescript-dashboard&#34;</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  <span>constructor</span><span>(</span><span>private</span> store<span>:</span> Store<span>)</span> <span>{</span><span>}</span>

  <span>ngOnInit</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span><span>appLoaded</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Moving on to adding a menu item. Open <code>add<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/add-item/add-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> addMenuItemFormSubmitted <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

<span>const</span> MenuItemPlaceholder<span>:</span> BaseMenuItem <span>=</span> <span>{</span>
  name<span>:</span> <span>&#34;French Fries&#34;</span><span>,</span>
  price<span>:</span> <span>&#34;299.00&#34;</span><span>,</span>
  tagline<span>:</span> <span>&#34;Crispy goodness&#34;</span><span>,</span>
  description<span>:</span>
    <span>&#34;A plate of light and crispy French fries using Idaho potatoes and peanut oil&#34;</span><span>,</span>
  image<span>:</span>
    <span>&#34;https://as2.ftcdn.net/jpg/02/13/18/09/500_F_213180964_DfqvRIHj0D3t9duYUROXuQ011AgVJIaM.jpg&#34;</span><span>,</span>
  calories<span>:</span> <span>410</span><span>,</span>
  category<span>:</span> <span>&#34;sides&#34;</span><span>,</span>
<span>}</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-add-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./add-item.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AddItemComponent</span> <span>{</span>
  menuItem <span>=</span> MenuItemPlaceholder<span>;</span>
  <span>constructor</span><span>(</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>submit</span><span>(</span>menu<span>:</span> BaseMenuItem<span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span>
      <span>addMenuItemFormSubmitted</span><span>(</span><span>{</span>
        menuItem<span>:</span> menu<span>,</span>
      <span>}</span><span>)</span>
    <span>)</span><span>;</span>
  <span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Deleting a menu item. Open <code><span>delete</span><span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/delete-item/delete-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusStateService <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> deleteMenuItemInitiated <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-delete-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./delete-item.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./delete-item.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>DeleteItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>menusStateService<span>.</span><span>selectMenuItem$</span><span>(</span>id<span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> menusStateService<span>:</span> MenusStateService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>deleteMenuItem</span><span>(</span>id<span>:</span> <span>string</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span><span>deleteMenuItemInitiated</span><span>(</span><span>{</span> menuId<span>:</span> id <span>}</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>back</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>navigateHome</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/menu&#34;</span><span>]</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Editing an existing menu item. Open <code>edit<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/edit-item/edit-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap<span>,</span> tap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem<span>,</span> MenusStateService <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> editMenuItemFormSubmitted <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-edit-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./edit-item.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>EditItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>tap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>(</span><span>this</span><span>.</span>_id <span>=</span> id<span>)</span><span>)</span><span>,</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>menusStateService<span>.</span><span>selectMenuItem$</span><span>(</span>id<span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>private</span> _id<span>:</span> <span>number</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> menusStateService<span>:</span> MenusStateService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>submit</span><span>(</span>menu<span>:</span> BaseMenuItem<span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span>
      <span>editMenuItemFormSubmitted</span><span>(</span><span>{</span>
        menuItem<span>:</span> <span>{</span>
          <span>...</span>menu<span>,</span>
          id<span>:</span> <span>this</span><span>.</span>_id<span>.</span><span>toString</span><span>(</span><span>)</span><span>,</span>
        <span>}</span><span>,</span>
      <span>}</span><span>)</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Before creating selectors for slices of the menu state, you must create a feature selector for menus to access the state object we defined in the States section. Open <code>menus<span>.</span>selector<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.selector.ts</span>

<span>import</span> <span>{</span> createFeatureSelector<span>,</span> createSelector <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusState <span>}</span> <span>from</span> <span>&#34;./menus.state&#34;</span><span>;</span>

<span>export</span> <span>const</span> selectMenus <span>=</span> <span><span>createFeatureSelector</span><span><span>&lt;</span>MenusState<span>&gt;</span></span></span><span>(</span><span>&#34;menus&#34;</span><span>)</span><span>;</span></code></pre><p>You can use the <code>createSelector</code> method to select slices of the feature state using the feature selector. For menus, you only have one entry in our object which is <code>menuItems</code>. Let&#39;s create a selector to access that by returning <code>state<span>.</span>menuItems</code>. Open <code>menus<span>.</span>selector<span>.</span>ts</code> and update it with the following code üëá</p><pre><code><span>// src/app/core/state-ngrx/menus/menus.selector.ts</span>

<span>import</span> <span>{</span> createFeatureSelector<span>,</span> createSelector <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusState <span>}</span> <span>from</span> <span>&#34;./menus.state&#34;</span><span>;</span>

<span>export</span> <span>const</span> selectMenus <span>=</span> <span><span>createFeatureSelector</span><span><span>&lt;</span>MenusState<span>&gt;</span></span></span><span>(</span><span>&#34;menus&#34;</span><span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> selectMenuItems <span>=</span> <span>createSelector</span><span>(</span>
  selectMenus<span>,</span>
  <span>(</span>state<span>:</span> MenusState<span>)</span> <span>=&gt;</span> state<span>.</span>menuItems
<span>)</span><span>;</span></code></pre><p>For pages like Menu Details, Edit Menu and Delete Menu, you&#39;ll need to access a specific menu item from the Store. You can do this by passing the menu&#39;s id as a prop to our selector and searching through our array of menu items. Open <code>menus<span>.</span>selector<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state-ngrx/menus/menus.selector.ts</span>

<span>import</span> <span>{</span> createFeatureSelector<span>,</span> createSelector <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusState <span>}</span> <span>from</span> <span>&#34;./menus.state&#34;</span><span>;</span>

<span>export</span> <span>const</span> selectMenus <span>=</span> <span><span>createFeatureSelector</span><span><span>&lt;</span>MenusState<span>&gt;</span></span></span><span>(</span><span>&#34;menus&#34;</span><span>)</span><span>;</span>

<span>export</span> <span>const</span> selectMenuItems <span>=</span> <span>createSelector</span><span>(</span>
  selectMenus<span>,</span>
  <span>(</span>state<span>:</span> MenusState<span>)</span> <span>=&gt;</span> state<span>.</span>menuItems
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> <span>selectMenuItem</span> <span>=</span> <span>(</span>props<span>:</span> <span>{</span> id<span>:</span> <span>string</span> <span>}</span><span>)</span> <span>=&gt;</span>
  <span>createSelector</span><span>(</span>selectMenuItems<span>,</span> <span>(</span>menuItems<span>)</span> <span>=&gt;</span>
    menuItems<span>.</span><span>find</span><span>(</span><span>(</span>menuItem<span>)</span> <span>=&gt;</span> menuItem<span>.</span>id <span>===</span> props<span>.</span>id<span>)</span>
  <span>)</span><span>;</span></code></pre><p>Let&#39;s also add the selector to the barrel export. Open <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.state&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.selector&#34;</span><span>;</span></code></pre><p>Similar to what you did with Actions, let&#39;s update the application to get data required by the components using NgRx Selectors. You can use Selectors by injecting NgRx&#39;s <code>Store</code> and calling it&#39;s <code>select</code> function passing in the selector&#39;s name, which returns the slice of the state that we need.</p><p>Starting with the main dashboard, open <code>menu<span>-</span>items<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/menu-items/menu-items.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> RolesService <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> selectMenuItems <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-menu-items&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./menu-items.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenuItemsComponent</span> <span>{</span>
  <span>// ‚ú® New üëá</span>
  menuItems$ <span>=</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span>selectMenuItems<span>)</span><span>;</span>
  isAdmin$ <span>=</span> <span>this</span><span>.</span>rolesService<span>.</span>isAdmin$<span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> rolesService<span>:</span> RolesService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>addMenuItem</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;add&#34;</span><span>]</span><span>,</span> <span>{</span> relativeTo<span>:</span> <span>this</span><span>.</span>activatedRoute <span>}</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Moving on to the Menu Details page. Here, we only need a specific menu&#39;s data. Instead of using the <code>selectMenuItems</code>, you will use <code>selectMenuItem</code> and pass in the menu id from the route parameters. Open <code>menu<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/menu-item/menu-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> RolesService <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> selectMenuItem <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-menu-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./menu-item.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./menu-item.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenuItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span><span>selectMenuItem</span><span>(</span><span>{</span> id<span>:</span> id <span>}</span><span>)</span><span>)</span><span>)</span>
  <span>)</span><span>;</span>
  isAdmin$ <span>=</span> <span>this</span><span>.</span>rolesService<span>.</span>isAdmin$<span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> rolesService<span>:</span> RolesService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>back</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>navigateTo</span><span>(</span>url<span>:</span> <span>string</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigateByUrl</span><span>(</span><span><span>`</span><span><span>${</span><span>this</span><span>.</span>router<span>.</span>url<span>}</span></span><span>/</span><span><span>${</span>url<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Delete Menu Item Component, open <code><span>delete</span><span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/delete-item/delete-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span>
  deleteMenuItemInitiated<span>,</span>
  <span>// ‚ú® New üëá</span>
  selectMenuItem<span>,</span>
<span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-delete-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./delete-item.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./delete-item.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>DeleteItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span><span>selectMenuItem</span><span>(</span><span>{</span> id<span>:</span> id <span>}</span><span>)</span><span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>deleteMenuItem</span><span>(</span>id<span>:</span> <span>string</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span><span>deleteMenuItemInitiated</span><span>(</span><span>{</span> menuId<span>:</span> id <span>}</span><span>)</span><span>)</span><span>;</span>
    <span>this</span><span>.</span><span>navigateHome</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>back</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>navigateHome</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/menu&#34;</span><span>]</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>And finally, Edit Menu Item. Open <code>edit<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/edit-item/edit-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap<span>,</span> tap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> BaseMenuItem <span>}</span> <span>from</span> <span>&#34;src/app/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span>
  editMenuItemFormSubmitted<span>,</span>
  <span>// ‚ú® New üëá</span>
  selectMenuItem<span>,</span>
<span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-edit-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./edit-item.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>EditItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>tap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>(</span><span>this</span><span>.</span>_id <span>=</span> id<span>)</span><span>)</span><span>,</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span><span>selectMenuItem</span><span>(</span><span>{</span> id<span>:</span> id <span>}</span><span>)</span><span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>private</span> _id<span>:</span> <span>number</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>cancel</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>submit</span><span>(</span>menu<span>:</span> BaseMenuItem<span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span>
      <span>editMenuItemFormSubmitted</span><span>(</span><span>{</span>
        menuItem<span>:</span> <span>{</span>
          <span>...</span>menu<span>,</span>
          id<span>:</span> <span>this</span><span>.</span>_id<span>.</span><span>toString</span><span>(</span><span>)</span><span>,</span>
        <span>}</span><span>,</span>
      <span>}</span><span>)</span>
    <span>)</span><span>;</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>The reducer is where the state will be transformed based on the actions. For example, deleting a menu item will remove that item from the state, resulting in the UI getting updated to reflect that change.</p><p>We will modify the Store when we receive a successful response when fetching the menu items data, editing a menu item successfully, and deleting a menu item successfully. Open <code>menus<span>.</span>reducer<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.reducer.ts</span>

<span>import</span> <span>{</span> Action<span>,</span> createReducer<span>,</span> on <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> MenusActions <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span>
<span>import</span> <span>{</span> initialState<span>,</span> MenusState <span>}</span> <span>from</span> <span>&#34;./menus.state&#34;</span><span>;</span>

<span>const</span> menusReducer <span>=</span> <span>createReducer</span><span>(</span>
  initialState<span>,</span>
  <span>on</span><span>(</span>MenusActions<span>.</span>fetchMenuSuccess<span>,</span> <span>(</span>state<span>,</span> <span>{</span> menuItems <span>}</span><span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
    <span>...</span>state<span>,</span>
    menuItems<span>:</span> menuItems<span>,</span>
  <span>}</span><span>)</span><span>)</span><span>,</span>
  <span>on</span><span>(</span>MenusActions<span>.</span>editMenuItemSuccess<span>,</span> <span>(</span>state<span>,</span> <span>{</span> menuItem <span>}</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> menuItemIndex <span>=</span> state<span>.</span>menuItems<span>.</span><span>findIndex</span><span>(</span>
      <span>(</span>item<span>)</span> <span>=&gt;</span> item<span>.</span>id <span>===</span> menuItem<span>.</span>id
    <span>)</span><span>;</span>
    <span>const</span> updatedMenuItems <span>=</span> <span>[</span><span>...</span>state<span>.</span>menuItems<span>]</span><span>;</span>
    updatedMenuItems<span>[</span>menuItemIndex<span>]</span> <span>=</span> menuItem<span>;</span>
    <span>return</span> <span>{</span>
      <span>...</span>state<span>,</span>
      menuItems<span>:</span> updatedMenuItems<span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>)</span><span>,</span>
  <span>on</span><span>(</span>MenusActions<span>.</span>deleteMenuItemSuccess<span>,</span> <span>(</span>state<span>,</span> <span>{</span> menuId <span>}</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> menuItemIndex <span>=</span> state<span>.</span>menuItems<span>.</span><span>findIndex</span><span>(</span>
      <span>(</span>item<span>)</span> <span>=&gt;</span> item<span>.</span>id <span>===</span> menuId
    <span>)</span><span>;</span>
    <span>const</span> updatedMenuItems <span>=</span> <span>[</span><span>...</span>state<span>.</span>menuItems<span>]</span><span>;</span>
    updatedMenuItems<span>.</span><span>splice</span><span>(</span>menuItemIndex<span>,</span> <span>1</span><span>)</span><span>;</span>
    <span>return</span> <span>{</span>
      <span>...</span>state<span>,</span>
      menuItems<span>:</span> updatedMenuItems<span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>function</span> <span>reducer</span><span>(</span>state<span>:</span> MenusState <span>|</span> <span>undefined</span><span>,</span> action<span>:</span> Action<span>)</span> <span>{</span>
  <span>return</span> <span>menusReducer</span><span>(</span>state<span>,</span> action<span>)</span><span>;</span>
<span>}</span></code></pre><p>Let&#39;s break this down. <code>on</code> refers to the listener, and the passed-in parameters are the action that it listens to and what function to execute when that action is executed.</p><p>Take the first one, for example, <code>MenusActions<span>.</span>fetchMenuSuccess</code> refers to the action that, when dispatched, will execute the function that is passed in as the second parameter. The function in the second parameter contains the logic to update the current state based on said Action and returns the modified state.</p><h4 id="Create-Core-Reducer">Create Core Reducer</h4><p>To use Menu&#39;s Reducer, you will need to add the reducer to the <code>ActionReducerMap</code> that will be used to initialize the <code>StoreModule</code>. Open <code>core<span>.</span>reducer<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/core.reducers.ts</span>

<span>import</span> <span>{</span> ActionReducerMap<span>,</span> MetaReducer <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> State <span>}</span> <span>from</span> <span>&#34;./core.state&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> MenusReducer <span>from</span> <span>&#34;./menus/menus.reducer&#34;</span><span>;</span>

<span>export</span> <span>const</span> reducers<span>:</span> ActionReducerMap<span>&lt;</span>State<span>&gt;</span> <span>=</span> <span>{</span>
  menus<span>:</span> MenusReducer<span>.</span>reducer<span>,</span>
<span>}</span><span>;</span>

<span>export</span> <span>const</span> metaReducers<span>:</span> MetaReducer<span>&lt;</span>State<span>&gt;</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span><span>;</span></code></pre><p>Create a barrel export for our <code>state</code> directory with the following contents üëá</p><pre><code><span>// src/app/core/state/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./core.state&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./core.reducer&#34;</span><span>;</span></code></pre><h3 id="Configure-Store-Module">Configure Store Module</h3><p>Initialize the <code>StoreModule</code> passing the <code>reducers</code> and <code>metaReducers</code> in our <code>core<span>.</span>reducers<span>.</span>ts</code> defined in the previous section. Open <code>app<span>.</span>module<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/app.module.ts</span>

<span>import</span> <span>{</span> BrowserModule <span>}</span> <span>from</span> <span>&#34;@angular/platform-browser&#34;</span><span>;</span>
<span>import</span> <span>{</span> NgModule <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> HttpClientModule<span>,</span> <span>HTTP_INTERCEPTORS</span> <span>}</span> <span>from</span> <span>&#34;@angular/common/http&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthHttpInterceptor<span>,</span> AuthModule <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>
<span>import</span> <span>{</span> StoreDevtoolsModule <span>}</span> <span>from</span> <span>&#34;@ngrx/store-devtools&#34;</span><span>;</span>

<span>import</span> <span>{</span> AppRoutingModule <span>}</span> <span>from</span> <span>&#34;./app-routing.module&#34;</span><span>;</span>
<span>import</span> <span>{</span> AppComponent <span>}</span> <span>from</span> <span>&#34;./app.component&#34;</span><span>;</span>
<span>import</span> <span>{</span> NavBarModule <span>}</span> <span>from</span> <span>&#34;./shared&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> StoreModule <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> reducers<span>,</span> metaReducers <span>}</span> <span>from</span> <span>&#34;./core/state&#34;</span><span>;</span>

@<span>NgModule</span><span>(</span><span>{</span>
  imports<span>:</span> <span>[</span>
    BrowserModule<span>,</span>
    HttpClientModule<span>,</span>
    AuthModule<span>.</span><span>forRoot</span><span>(</span><span>{</span>
      <span>...</span>environment<span>.</span>auth<span>,</span>
      httpInterceptor<span>:</span> <span>{</span>
        allowedList<span>:</span> <span>[</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items</span><span>`</span></span><span>,</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items/*</span><span>`</span></span><span>,</span>
        <span>]</span><span>,</span>
      <span>}</span><span>,</span>
    <span>}</span><span>)</span><span>,</span>
    AppRoutingModule<span>,</span>
    NavBarModule<span>,</span>
    StoreDevtoolsModule<span>.</span><span>instrument</span><span>(</span><span>{</span>
      maxAge<span>:</span> <span>25</span><span>,</span>
      logOnly<span>:</span> environment<span>.</span>production<span>,</span>
    <span>}</span><span>)</span><span>,</span>

    <span>// ‚ú® New üëá</span>
    StoreModule<span>.</span><span>forRoot</span><span>(</span>reducers<span>,</span> <span>{</span>
      metaReducers<span>,</span>
    <span>}</span><span>)</span><span>,</span>
  <span>]</span><span>,</span>
  declarations<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  bootstrap<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  providers<span>:</span> <span>[</span>
    <span>{</span>
      provide<span>:</span> <span>HTTP_INTERCEPTORS</span><span>,</span>
      useClass<span>:</span> AuthHttpInterceptor<span>,</span>
      multi<span>:</span> <span>true</span><span>,</span>
    <span>}</span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppModule</span> <span>{</span><span>}</span></code></pre><blockquote><p><strong>Checkpoint:</strong> You should see a list of menu items on your dashboard and navigating to the menu details page/edit/delete should display more information about each menu item. Only authenticated users with a <code>menu<span>-</span>admin</code> role can navigate to the create, update, and delete menu items part of the application. The <code>menu<span>-</span>admin</code> role bundles the necessary permissions to execute these write operations. Read more on how to configure role-based access control (RBAC) and how to create an admin user for this application in this <a href="https://auth0.com/blog/node-js-and-typescript-tutorial-secure-an-express-api/#Configure-Role-Based-Access-Control--RBAC-" target="_blank" rel="noreferrer noopener">blogpost</a></p></blockquote><p>As explained at the beginning of the post, Effects are where side effects of the Action are handled. For Menus, this will mostly be making an HTTP request to get data from the server or perform other CRUD operations.</p><p>Let&#39;s start with a simple effect that handles fetching the menu items from the API and updating the store with new data. Since this logic needs to be executed when the app loads and a new menu item is added successfully, you will pass in 2 actions - <code>MenusActions<span>.</span>appLoaded<span>.</span>type</code> and <code>MenusActions<span>.</span>addMenuItemSuccess</code>. You will then <code>switchMap</code> to the <code>apiService</code> to get the menu items. If it&#39;s successful, dispatch the <code>fecthMenuSuccess</code> action with the menu items returned from the API which will update the store with this new data. If unsuccessful, it will jump to the <code>catchError</code> block, which dispatches the <code>fetchMenuFailed</code> action with the error thrown.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1Su3I5GfVvBSFwjltn1SO9/3ce9abb4b1e44940391ac9a9f11410e4/04_ngrx-fetch-menu-effects.png" alt="Diagram of how the fetch menu effect works"/></p><blockquote><p>Tip: add your <code>catchError</code> to the inner observable in your <code>switchMap</code> instead of on the main observable to prevent the action stream from being closed when an error is thrown</p></blockquote><p>Open <code>menus<span>.</span>effects<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Actions<span>,</span> createEffect<span>,</span> ofType <span>}</span> <span>from</span> <span>&#34;@ngrx/effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> <span>of</span> <span>}</span> <span>from</span> <span>&#34;rxjs&#34;</span><span>;</span>
<span>import</span> <span>{</span> switchMap<span>,</span> map<span>,</span> catchError <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> ApiService <span>}</span> <span>from</span> <span>&#34;../../services&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> MenusActions <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>MenusEffects</span> <span>{</span>
  <span>constructor</span><span>(</span><span>private</span> actions$<span>:</span> Actions<span>&lt;</span><span>any</span><span>&gt;</span><span>,</span> <span>private</span> apiService<span>:</span> ApiService<span>)</span> <span>{</span><span>}</span>

  fetchMenus$ <span>=</span> <span>createEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
    <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
      <span>// you can pass in multiple actions here that will trigger the same effect</span>
      <span>ofType</span><span>(</span>MenusActions<span>.</span>appLoaded<span>.</span><span>type</span><span>,</span> MenusActions<span>.</span>addMenuItemSuccess<span>)</span><span>,</span>
      <span>switchMap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
        <span>this</span><span>.</span>apiService<span>.</span><span>getItems</span><span>(</span><span>)</span><span>.</span><span>pipe</span><span>(</span>
          <span>map</span><span>(</span><span>(</span>menuItems<span>)</span> <span>=&gt;</span>
            MenusActions<span>.</span><span>fetchMenuSuccess</span><span>(</span><span>{</span> menuItems<span>:</span> menuItems <span>}</span><span>)</span>
          <span>)</span><span>,</span>
          <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
            <span>of</span><span>(</span>MenusActions<span>.</span><span>fetchMenuFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span>
    <span>)</span>
  <span>)</span><span>;</span>
<span>}</span></code></pre><p>Following the same logic, let&#39;s create effects for <code>addMenu</code>, <code>editMenu</code>, and <code>deleteMenu</code>. Open <code>menus<span>.</span>effects<span>.</span>ts</code> and update it with the following code üëá</p><pre><code><span>// src/app/core/state/menus/menus.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> Actions<span>,</span> createEffect<span>,</span> ofType <span>}</span> <span>from</span> <span>&#34;@ngrx/effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> <span>of</span> <span>}</span> <span>from</span> <span>&#34;rxjs&#34;</span><span>;</span>
<span>import</span> <span>{</span> switchMap<span>,</span> map<span>,</span> tap<span>,</span> catchError <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> ApiService <span>}</span> <span>from</span> <span>&#34;../../services&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> MenusActions <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>MenusEffects</span> <span>{</span>
  <span>constructor</span><span>(</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> actions$<span>:</span> Actions<span>&lt;</span><span>any</span><span>&gt;</span><span>,</span>
    <span>private</span> apiService<span>:</span> ApiService
  <span>)</span> <span>{</span><span>}</span>

  fetchMenus$ <span>=</span> <span>createEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
    <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
      <span>ofType</span><span>(</span>MenusActions<span>.</span>appLoaded<span>.</span><span>type</span><span>,</span> MenusActions<span>.</span>addMenuItemSuccess<span>)</span><span>,</span>
      <span>switchMap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
        <span>this</span><span>.</span>apiService<span>.</span><span>getItems</span><span>(</span><span>)</span><span>.</span><span>pipe</span><span>(</span>
          <span>map</span><span>(</span><span>(</span>menuItems<span>)</span> <span>=&gt;</span>
            MenusActions<span>.</span><span>fetchMenuSuccess</span><span>(</span><span>{</span> menuItems<span>:</span> menuItems <span>}</span><span>)</span>
          <span>)</span><span>,</span>
          <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
            <span>of</span><span>(</span>MenusActions<span>.</span><span>fetchMenuFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span>
    <span>)</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  addMenu$ <span>=</span> <span>createEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
    <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
      <span>ofType</span><span>(</span>MenusActions<span>.</span>addMenuItemFormSubmitted<span>.</span><span>type</span><span>)</span><span>,</span>
      <span>switchMap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span>
        <span>this</span><span>.</span>apiService<span>.</span><span>addItem</span><span>(</span>action<span>.</span>menuItem<span>)</span><span>.</span><span>pipe</span><span>(</span>
          <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/menu&#34;</span><span>]</span><span>)</span><span>)</span><span>,</span>
          <span>map</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> MenusActions<span>.</span><span>addMenuItemSuccess</span><span>(</span><span>)</span><span>)</span><span>,</span>
          <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
            <span>of</span><span>(</span>MenusActions<span>.</span><span>addMenuItemFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span>
    <span>)</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  editMenu$ <span>=</span> <span>createEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
    <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
      <span>ofType</span><span>(</span>MenusActions<span>.</span>editMenuItemFormSubmitted<span>.</span><span>type</span><span>)</span><span>,</span>
      <span>switchMap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span>
        <span>this</span><span>.</span>apiService<span>.</span><span>updateItem</span><span>(</span>action<span>.</span>menuItem<span>)</span><span>.</span><span>pipe</span><span>(</span>
          <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>)</span><span>,</span>
          <span>map</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
            MenusActions<span>.</span><span>editMenuItemSuccess</span><span>(</span><span>{</span> menuItem<span>:</span> action<span>.</span>menuItem <span>}</span><span>)</span>
          <span>)</span><span>,</span>
          <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
            <span>of</span><span>(</span>MenusActions<span>.</span><span>editMenuItemFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span>
    <span>)</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  deleteMenu$ <span>=</span> <span>createEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
    <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
      <span>ofType</span><span>(</span>MenusActions<span>.</span>deleteMenuItemInitiated<span>.</span><span>type</span><span>)</span><span>,</span>
      <span>switchMap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span>
        <span>this</span><span>.</span>apiService<span>.</span><span>deleteItem</span><span>(</span>action<span>.</span>menuId<span>)</span><span>.</span><span>pipe</span><span>(</span>
          <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/menu&#34;</span><span>]</span><span>)</span><span>)</span><span>,</span>
          <span>map</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
            MenusActions<span>.</span><span>deleteMenuItemSuccess</span><span>(</span><span>{</span> menuId<span>:</span> action<span>.</span>menuId <span>}</span><span>)</span>
          <span>)</span><span>,</span>
          <span>catchError</span><span>(</span><span>(</span>error<span>)</span> <span>=&gt;</span>
            <span>of</span><span>(</span>MenusActions<span>.</span><span>deleteMenuItemFailed</span><span>(</span><span>{</span> error<span>:</span> error <span>}</span><span>)</span><span>)</span>
          <span>)</span>
        <span>)</span>
      <span>)</span>
    <span>)</span>
  <span>)</span><span>;</span>
<span>}</span></code></pre><blockquote><p>Tip: You can add the following effect if you want to listen to every action that gets dispatched for debugging purposes (more on debugging in the devtools section) üëá</p></blockquote><pre><code>init$ <span>=</span> <span>createEffect</span><span>(</span>
  <span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span><span>tap</span><span>(</span><span>(</span>action<span>)</span> <span>=&gt;</span> <span>console</span><span>.</span><span>log</span><span>(</span>action<span>)</span><span>)</span><span>)</span><span>,</span>
  <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
<span>)</span><span>;</span></code></pre><p>Add <code>menus<span>-</span>effects</code> to menu directory&#39;s barrel export. Open <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/menus/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.state&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.actions&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.selector&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./menus.effects&#34;</span><span>;</span></code></pre><h4 id="Configure-Effects-Module">Configure Effects Module</h4><p>You will then need to initialize NgRx&#39;s <code>EffectsModule</code> passing in all your feature Effects (in our case, just the <code>MenusEffects</code> for now). Open <code>app<span>.</span>module<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/app.module.ts</span>

<span>import</span> <span>{</span> BrowserModule <span>}</span> <span>from</span> <span>&#34;@angular/platform-browser&#34;</span><span>;</span>
<span>import</span> <span>{</span> NgModule <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> HttpClientModule <span>}</span> <span>from</span> <span>&#34;@angular/common/http&#34;</span><span>;</span>
<span>import</span> <span>{</span> StoreDevtoolsModule <span>}</span> <span>from</span> <span>&#34;@ngrx/store-devtools&#34;</span><span>;</span>
<span>import</span> <span>{</span> StoreModule <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> EffectsModule <span>}</span> <span>from</span> <span>&#34;@ngrx/effects&#34;</span><span>;</span>

<span>import</span> <span>{</span> AppRoutingModule <span>}</span> <span>from</span> <span>&#34;./app-routing.module&#34;</span><span>;</span>
<span>import</span> <span>{</span> AppComponent <span>}</span> <span>from</span> <span>&#34;./app.component&#34;</span><span>;</span>
<span>import</span> <span>{</span> NavBarModule <span>}</span> <span>from</span> <span>&#34;./shared&#34;</span><span>;</span>
<span>import</span> <span>{</span> reducers<span>,</span> metaReducers <span>}</span> <span>from</span> <span>&#34;./core/state&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> MenusEffects <span>}</span> <span>from</span> <span>&#34;./core/state/menus&#34;</span><span>;</span>

@<span>NgModule</span><span>(</span><span>{</span>
  imports<span>:</span> <span>[</span>
    BrowserModule<span>,</span>
    HttpClientModule<span>,</span>
    AppRoutingModule<span>,</span>
    NavBarModule<span>,</span>
    StoreDevtoolsModule<span>.</span><span>instrument</span><span>(</span><span>{</span>
      maxAge<span>:</span> <span>25</span><span>,</span>
      logOnly<span>:</span> environment<span>.</span>production<span>,</span>
    <span>}</span><span>)</span><span>,</span>
    StoreModule<span>.</span><span>forRoot</span><span>(</span>reducers<span>,</span> <span>{</span>
      metaReducers<span>,</span>
    <span>}</span><span>)</span><span>,</span>
    <span>// ‚ú® New üëá</span>
    EffectsModule<span>.</span><span>forRoot</span><span>(</span><span>[</span>MenusEffects<span>]</span><span>)</span><span>,</span>
  <span>]</span><span>,</span>
  declarations<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  bootstrap<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  providers<span>:</span> <span>[</span>
    <span>{</span>
      provide<span>:</span> <span>HTTP_INTERCEPTORS</span><span>,</span>
      useClass<span>:</span> AuthHttpInterceptor<span>,</span>
      multi<span>:</span> <span>true</span><span>,</span>
    <span>}</span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppModule</span> <span>{</span><span>}</span></code></pre><blockquote><p><strong>Checkpoint:</strong> Executing any CRUD operations such as adding a new menu item and editting or deleting an existing menu item should make an API call to update the server&#39;s database and also update the app&#39;s state. Only authenticated users with a <code>menu<span>-</span>admin</code> role can create, update, and delete menu items. The <code>menu<span>-</span>admin</code> role bundles the necessary permissions to execute these write operations. Read more on how to configure role-based access control (RBAC) and how to create an admin user for this application in this <a href="https://auth0.com/blog/node-js-and-typescript-tutorial-secure-an-express-api/#Configure-Role-Based-Access-Control--RBAC-" target="_blank" rel="noreferrer noopener">blogpost</a></p></blockquote></div></div>]]></content:encoded>
      <pubDate>Tue, 23 Nov 2021 19:57:00 +0000</pubDate>
    </item>
    <item>
      <title>State Management in Angular Using NgRx: Pt. 2</title>
      <link>https://auth0.com/blog/state-management-in-angular-with-ngrx-2/</link>
      <description>See how it&#39;s easy to manage your Angular application&#39;s state using NgRx and learn how you can use NgRx with Auth0&#39;s SDK to handle user-related functionalities.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><h2 id="User-State-Management">User State Management</h2><p>The user store will work similarly to how the menus state management works. I won&#39;t detail how each part of the state works and focus more on the Auth0 and NgRx integration.</p><p>The starter app is using the Auth0 SDK directly and managing the roles through the <code>RolesService</code>, this section of the tutorial will walk you through migrating to using Auth0&#39;s SDK through NgRx and managing the roles by using selectors.</p><h3 id="Create-User-State">Create User State</h3><p>Let&#39;s start with defining the interface for the user state object and its initial state. Open <code>user<span>.</span>state<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.state.ts</span>

<span>import</span> <span>{</span> User <span>as</span> Auth0User <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-spa-js&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>UserState</span> <span>{</span>
  userDetails<span>:</span> Auth0User<span>;</span>
<span>}</span>

<span>export</span> <span>const</span> initialState<span>:</span> UserState <span>=</span> <span>{</span>
  userDetails<span>:</span> <span>undefined</span><span>,</span>
<span>}</span><span>;</span></code></pre><p>Create a barrel export for the <code>user</code> directory with the following code üëá</p><pre><code><span>// src/app/core/state/user/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.state&#34;</span><span>;</span></code></pre><h4 id="Update-Core-State">Update Core State</h4><p>To access <code>UserState</code> from your Store, you will need to add it to your <code>CoreState</code>&#39;s state object. Open <code>core<span>.</span>state<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/core.state.ts</span>

<span>import</span> <span>{</span> MenusState <span>}</span> <span>from</span> <span>&#34;./menus&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> UserState <span>}</span> <span>from</span> <span>&#34;./user&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>State</span> <span>{</span>
  menus<span>:</span> MenusState<span>;</span>
  <span>// ‚ú® New üëá</span>
  user<span>:</span> UserState<span>;</span>
<span>}</span></code></pre><h3 id="Create-User-Actions">Create User Actions</h3><p>We have three user-related Actions that we need for our user Store. Login, logout, and user changed Action to keep the user details in our Store in sync with Auth0&#39;s SDK.</p><p>Since we have several user Actions that will originate from the Navbar component, you can group them under <code>allNavbarAction</code> to ensure you aren&#39;t reusing these Actions in a different part of the application (following the Good Action Hygiene pattern).</p><p>Because the <code>userChangedFromAuth0SDK</code> Action originates from Auth0&#39;s SDK, let&#39;s name the source part of the Action type as <code>Auth0 <span>SDK</span></code>.</p><p>Open <code>user<span>.</span>actions<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.actions.ts</span>

<span>import</span> <span>{</span> createAction<span>,</span> props <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> User <span>as</span> Auth0User <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-spa-js&#34;</span><span>;</span>

<span>export</span> <span>const</span> allNavbarActions <span>=</span> <span>{</span>
  loginFlowInitiated<span>:</span> <span>createAction</span><span>(</span><span>&#34;[Navbar] Login Flow Initiated&#34;</span><span>)</span><span>,</span>
  logoutFlowInitiated<span>:</span> <span>createAction</span><span>(</span><span>&#34;[Navbar] Logout Flow Initiated&#34;</span><span>)</span><span>,</span>
<span>}</span><span>;</span>

<span>export</span> <span>const</span> userChangedFromAuth0SDK <span>=</span> <span>createAction</span><span>(</span>
  <span>&#34;[Auth0 SDK] User Changed&#34;</span><span>,</span>
  <span><span>props</span><span><span>&lt;</span><span>{</span> userDetails<span>:</span> Auth0User <span>}</span><span>&gt;</span></span></span><span>(</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>Add <code>user<span>.</span>actions</code> to the barrel export. Open <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.state&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span></code></pre><h4 id="Update-Application-to-Use-User-Actions">Update Application to Use User Actions</h4><p>Open <code>nav<span>-</span>bar<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/shared/components/nav-bar/nav-bar.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> IconDefinition <span>}</span> <span>from</span> <span>&#34;@fortawesome/fontawesome-svg-core&#34;</span><span>;</span>
<span>import</span> <span>{</span> faHome<span>,</span> faUser<span>,</span> faUtensils <span>}</span> <span>from</span> <span>&#34;@fortawesome/free-solid-svg-icons&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthService <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> allNavbarActions <span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>INavBarMenuLinkProps</span> <span>{</span>
  to<span>:</span> <span>string</span><span>;</span>
  icon<span>:</span> IconDefinition<span>;</span>
  label<span>:</span> <span>string</span><span>;</span>
<span>}</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-nav-bar&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./nav-bar.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./nav-bar.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>NavBarComponent</span> <span>{</span>
  faUser <span>=</span> faUser<span>;</span>
  isAuthenticated$ <span>=</span> <span>this</span><span>.</span>authService<span>.</span>isAuthenticated$<span>;</span>
  user$ <span>=</span> <span>this</span><span>.</span>authService<span>.</span>user$<span>;</span>

  navOptions<span>:</span> INavBarMenuLinkProps<span>[</span><span>]</span> <span>=</span> <span>[</span>
    <span>{</span> to<span>:</span> <span>&#34;/home&#34;</span><span>,</span> label<span>:</span> <span>&#34;Home&#34;</span><span>,</span> icon<span>:</span> faHome <span>}</span><span>,</span>
    <span>{</span> to<span>:</span> <span>&#34;/menu&#34;</span><span>,</span> label<span>:</span> <span>&#34;Menu&#34;</span><span>,</span> icon<span>:</span> faUtensils <span>}</span><span>,</span>
  <span>]</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> authService<span>:</span> AuthService<span>,</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>loginWithRedirect</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span>allNavbarActions<span>.</span><span>loginFlowInitiated</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>logout</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span>allNavbarActions<span>.</span><span>logoutFlowInitiated</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><h3 id="Create-User-Selectors">Create User Selectors</h3><p>Create two selectors, a feature selector and a selector that returns the <code>userDetails</code>. Open <code>user<span>.</span>selector<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.selector.ts</span>

<span>import</span> <span>{</span> createFeatureSelector<span>,</span> createSelector <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> UserState <span>}</span> <span>from</span> <span>&#34;./user.state&#34;</span><span>;</span>

<span>export</span> <span>const</span> selectUser <span>=</span> <span><span>createFeatureSelector</span><span><span>&lt;</span>UserState<span>&gt;</span></span></span><span>(</span><span>&#34;user&#34;</span><span>)</span><span>;</span>

<span>export</span> <span>const</span> selectUserDetails <span>=</span> <span>createSelector</span><span>(</span>
  selectUser<span>,</span>
  <span>(</span>state<span>:</span> UserState<span>)</span> <span>=&gt;</span> state<span>.</span>userDetails
<span>)</span><span>;</span></code></pre><p>Let&#39;s also add some utility Selectors for <code>isLoggedIn</code>, <code>userRoles</code>, and <code>isAdmin</code> to easily let your components access these properties. Open <code>user<span>.</span>selector<span>.</span>ts</code> and update it with the following code üëá</p><pre><code><span>// src/app/core/state/user/user.selector.ts</span>

<span>import</span> <span>{</span> createFeatureSelector<span>,</span> createSelector <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> environment <span>}</span> <span>from</span> <span>&#34;src/environments/environment&#34;</span><span>;</span>
<span>import</span> <span>{</span> UserState <span>}</span> <span>from</span> <span>&#34;./user.state&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> <span>USER_ROLES</span> <span>=</span> <span>{</span>
  <span>MENU_ADMIN</span><span>:</span> <span>&#34;menu-admin&#34;</span><span>,</span>
<span>}</span><span>;</span>

<span>export</span> <span>const</span> selectUser <span>=</span> <span><span>createFeatureSelector</span><span><span>&lt;</span>UserState<span>&gt;</span></span></span><span>(</span><span>&#34;user&#34;</span><span>)</span><span>;</span>

<span>export</span> <span>const</span> selectUserDetails <span>=</span> <span>createSelector</span><span>(</span>
  selectUser<span>,</span>
  <span>(</span>state<span>:</span> UserState<span>)</span> <span>=&gt;</span> state<span>.</span>userDetails
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> selectIsLoggedIn <span>=</span> <span>createSelector</span><span>(</span>
  selectUserDetails<span>,</span>
  <span>(</span>userDetails<span>)</span> <span>=&gt;</span> <span>!</span><span>!</span>userDetails
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> selectUserRoles <span>=</span> <span>createSelector</span><span>(</span>
  selectUserDetails<span>,</span>
  <span>(</span>userDetails<span>)</span> <span>=&gt;</span> userDetails<span>[</span><span><span>`</span><span><span>${</span>environment<span>.</span>auth<span>.</span>audience<span>}</span></span><span>/roles</span><span>`</span></span><span>]</span>
<span>)</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>const</span> selectIsAdmin <span>=</span> <span>createSelector</span><span>(</span>selectUserRoles<span>,</span> <span>(</span>userRoles<span>)</span> <span>=&gt;</span>
  userRoles<span>?.</span><span>includes</span><span>(</span><span>USER_ROLES</span><span>.</span><span>MENU_ADMIN</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>Add <code>user<span>.</span>selector</code> to the list of exports in <code>index<span>.</span>ts</code> üëá</p><pre><code><span>// src/app/core/state/user/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.state&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.selector&#34;</span><span>;</span></code></pre><h4 id="Update-Application-to-Use-User-Selectors">Update Application to Use User Selectors</h4><p>The user role route guard was previously using the value of the roles from <code>RolesService</code>. Since you now have a user roles Selector, you can replace the current implementation with an NgRx Selector. Open <code>user<span>-</span>role<span>.</span>guard<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/guards/user-role.guard.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span>
  CanActivate<span>,</span>
  Router<span>,</span>
  ActivatedRouteSnapshot<span>,</span>
  RouterStateSnapshot<span>,</span>
<span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>

<span>import</span> <span>{</span> Observable<span>,</span> <span>of</span> <span>}</span> <span>from</span> <span>&#34;rxjs&#34;</span><span>;</span>
<span>import</span> <span>{</span> catchError<span>,</span> map <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> selectUserRoles <span>}</span> <span>from</span> <span>&#34;../state/user&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>{</span> providedIn<span>:</span> <span>&#34;root&#34;</span> <span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>UserRoleGuard</span> <span>implements</span> <span>CanActivate</span> <span>{</span>
  <span>constructor</span><span>(</span>
    <span>// ‚ú® New üëá</span>
    <span>private</span> store<span>:</span> Store<span>,</span>
    <span>private</span> router<span>:</span> Router
  <span>)</span> <span>{</span><span>}</span>

  <span>canActivate</span><span>(</span>
    route<span>:</span> ActivatedRouteSnapshot<span>,</span>
    state<span>:</span> RouterStateSnapshot
  <span>)</span><span>:</span> Observable<span>&lt;</span><span>boolean</span><span>&gt;</span> <span>{</span>
    <span>// ‚ú® New üëá</span>
    <span>return</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span>selectUserRoles<span>)</span><span>.</span><span>pipe</span><span>(</span>
      <span>map</span><span>(</span><span>(</span>roles<span>)</span> <span>=&gt;</span> <span>{</span>
        <span>if</span> <span>(</span>roles <span>&amp;&amp;</span> roles<span>.</span><span>includes</span><span>(</span>route<span>?.</span>data<span>?.</span>role<span>)</span><span>)</span> <span>{</span>
          <span>return</span> <span>true</span><span>;</span>
        <span>}</span>

        <span>// redirect the user to home</span>
        <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/home&#34;</span><span>]</span><span>)</span><span>;</span>
        <span>return</span> <span>false</span><span>;</span>
      <span>}</span><span>)</span><span>,</span>
      <span>catchError</span><span>(</span><span>(</span>err<span>)</span> <span>=&gt;</span> <span>{</span>
        <span>// redirect the user to home</span>
        <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;/home&#34;</span><span>]</span><span>)</span><span>;</span>
        <span>return</span> <span>of</span><span>(</span><span>false</span><span>)</span><span>;</span>
      <span>}</span><span>)</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Another place we use user-related information is the Navbar. We display user information and conditionally display the login and logout button depending on the user&#39;s <code>isAuthenticated</code> state. Open <code>nav<span>-</span>bar<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/shared/components/nav-bar/nav-bar.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> IconDefinition <span>}</span> <span>from</span> <span>&#34;@fortawesome/fontawesome-svg-core&#34;</span><span>;</span>
<span>import</span> <span>{</span> faHome<span>,</span> faUser<span>,</span> faUtensils <span>}</span> <span>from</span> <span>&#34;@fortawesome/free-solid-svg-icons&#34;</span><span>;</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span>
  allNavbarActions<span>,</span>
  selectIsLoggedIn<span>,</span>
  selectUserDetails<span>,</span>
<span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>INavBarMenuLinkProps</span> <span>{</span>
  to<span>:</span> <span>string</span><span>;</span>
  icon<span>:</span> IconDefinition<span>;</span>
  label<span>:</span> <span>string</span><span>;</span>
<span>}</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-nav-bar&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./nav-bar.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./nav-bar.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>NavBarComponent</span> <span>{</span>
  faUser <span>=</span> faUser<span>;</span>

  <span>// ‚ú® New üëá</span>
  isAuthenticated$ <span>=</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span>selectIsLoggedIn<span>)</span><span>;</span>
  user$ <span>=</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span>selectUserDetails<span>)</span><span>;</span>

  navOptions<span>:</span> INavBarMenuLinkProps<span>[</span><span>]</span> <span>=</span> <span>[</span>
    <span>{</span> to<span>:</span> <span>&#34;/home&#34;</span><span>,</span> label<span>:</span> <span>&#34;Home&#34;</span><span>,</span> icon<span>:</span> faHome <span>}</span><span>,</span>
    <span>{</span> to<span>:</span> <span>&#34;/menu&#34;</span><span>,</span> label<span>:</span> <span>&#34;Menu&#34;</span><span>,</span> icon<span>:</span> faUtensils <span>}</span><span>,</span>
  <span>]</span><span>;</span>

  <span>constructor</span><span>(</span><span>private</span> store<span>:</span> Store<span>)</span> <span>{</span><span>}</span>

  <span>loginWithRedirect</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span>allNavbarActions<span>.</span><span>loginFlowInitiated</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>logout</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>store<span>.</span><span>dispatch</span><span>(</span>allNavbarActions<span>.</span><span>logoutFlowInitiated</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>The profile page displays some information about the user, such as name and photo. Since this is stored as part of the user Store, let&#39;s also update this to use the <code>selectUserDetails</code> Selector. Open <code>profile<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/profile/profile.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> selectUserDetails <span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-profile&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./profile.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./profile.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>ProfileComponent</span> <span>{</span>
  <span>// ‚ú® New üëá</span>
  user$ <span>=</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span>selectUserDetails<span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  <span>constructor</span><span>(</span><span>private</span> store<span>:</span> Store<span>)</span> <span>{</span><span>}</span>
<span>}</span></code></pre><p>We display an <code>Add</code> button when the logged-in user is an admin user on the Menu Items page. You can read more about setting up admin users on Auth0 in this <a href="https://auth0.com/blog/developing-a-secure-api-with-nestjs-adding-role-based-access-control/#Get-User-Roles" target="_blank" rel="noreferrer noopener">blog post</a>. Open <code>menu<span>-</span>items<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/menu-items/menu-items.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> selectMenuItems <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> selectIsAdmin <span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-menu-items&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./menu-items.component.html&#34;</span><span>,</span>
  styles<span>:</span> <span>[</span>
    <span><span>`</span><span>
      :host {
        width: 100%;
        height: 100%;
      }
    </span><span>`</span></span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenuItemsComponent</span> <span>{</span>
  menuItems$ <span>=</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span>selectMenuItems<span>)</span><span>;</span>
  <span>// ‚ú® New üëá</span>
  isAdmin$ <span>=</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span>selectIsAdmin<span>)</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>addMenuItem</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigate</span><span>(</span><span>[</span><span>&#34;add&#34;</span><span>]</span><span>,</span> <span>{</span> relativeTo<span>:</span> <span>this</span><span>.</span>activatedRoute <span>}</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Lastly, we display a <code>Edit</code> and <code>Delete</code> buttons when the logged-in user is an admin user on the Menu Item page. Open <code>menu<span>-</span>item<span>.</span>component<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/features/menu/menu-item/menu-item.component.ts</span>

<span>import</span> <span>{</span> Component <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> Location <span>}</span> <span>from</span> <span>&#34;@angular/common&#34;</span><span>;</span>
<span>import</span> <span>{</span> ActivatedRoute<span>,</span> Router <span>}</span> <span>from</span> <span>&#34;@angular/router&#34;</span><span>;</span>
<span>import</span> <span>{</span> map<span>,</span> switchMap <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>{</span> Store <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> selectMenuItem <span>}</span> <span>from</span> <span>&#34;src/app/core/state/menus&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> selectIsAdmin <span>}</span> <span>from</span> <span>&#34;src/app/core/state/user&#34;</span><span>;</span>

@<span>Component</span><span>(</span><span>{</span>
  selector<span>:</span> <span>&#34;app-menu-item&#34;</span><span>,</span>
  templateUrl<span>:</span> <span>&#34;./menu-item.component.html&#34;</span><span>,</span>
  styleUrls<span>:</span> <span>[</span><span>&#34;./menu-item.component.scss&#34;</span><span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>MenuItemComponent</span> <span>{</span>
  menuItemId$ <span>=</span> <span>this</span><span>.</span>activatedRoute<span>.</span>params<span>.</span><span>pipe</span><span>(</span><span>map</span><span>(</span><span>(</span>params<span>)</span> <span>=&gt;</span> params<span>.</span>id<span>)</span><span>)</span><span>;</span>
  menuItem$ <span>=</span> <span>this</span><span>.</span>menuItemId$<span>.</span><span>pipe</span><span>(</span>
    <span>switchMap</span><span>(</span><span>(</span>id<span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span><span>selectMenuItem</span><span>(</span><span>{</span> id<span>:</span> id <span>}</span><span>)</span><span>)</span><span>)</span>
  <span>)</span><span>;</span>

  <span>// ‚ú® New üëá</span>
  isAdmin$ <span>=</span> <span>this</span><span>.</span>store<span>.</span><span>select</span><span>(</span>selectIsAdmin<span>)</span><span>;</span>

  <span>constructor</span><span>(</span>
    <span>private</span> activatedRoute<span>:</span> ActivatedRoute<span>,</span>
    <span>private</span> router<span>:</span> Router<span>,</span>
    <span>private</span> location<span>:</span> Location<span>,</span>
    <span>private</span> store<span>:</span> Store
  <span>)</span> <span>{</span><span>}</span>

  <span>back</span><span>(</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>location<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>navigateTo</span><span>(</span>url<span>:</span> <span>string</span><span>)</span><span>:</span> <span>void</span> <span>{</span>
    <span>this</span><span>.</span>router<span>.</span><span>navigateByUrl</span><span>(</span><span><span>`</span><span><span>${</span><span>this</span><span>.</span>router<span>.</span>url<span>}</span></span><span>/</span><span><span>${</span>url<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><h3 id="Create-User-Reducer">Create User Reducer</h3><p>The <code>userDetails</code> in the user Store will only be modified based on the <code>userChanged</code> event from Auth0&#39;s SDK to always keep them in sync. Open <code>user<span>.</span>reducer<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.reducer.ts</span>

<span>import</span> <span>{</span> Action<span>,</span> createReducer<span>,</span> on <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> UserActions <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span>
<span>import</span> <span>{</span> initialState<span>,</span> UserState <span>}</span> <span>from</span> <span>&#34;./user.state&#34;</span><span>;</span>

<span>const</span> userReducer <span>=</span> <span>createReducer</span><span>(</span>
  initialState<span>,</span>
  <span>on</span><span>(</span>UserActions<span>.</span>userChangedFromAuth0SDK<span>,</span> <span>(</span>state<span>,</span> <span>{</span> userDetails <span>}</span><span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
    <span>...</span>state<span>,</span>
    userDetails<span>:</span> userDetails<span>,</span>
  <span>}</span><span>)</span><span>)</span>
<span>)</span><span>;</span>

<span>export</span> <span>function</span> <span>reducer</span><span>(</span>state<span>:</span> UserState <span>|</span> <span>undefined</span><span>,</span> action<span>:</span> Action<span>)</span> <span>{</span>
  <span>return</span> <span>userReducer</span><span>(</span>state<span>,</span> action<span>)</span><span>;</span>
<span>}</span></code></pre><h4 id="Update-Core-Reducer">Update Core Reducer</h4><p>Similar to what you did for the menus Reducer, you will need to add the reducer to the <code>ActionReducerMap</code> to use the user reducer. Open <code>core<span>.</span>reducer<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/core.reducers.ts</span>

<span>import</span> <span>{</span> ActionReducerMap<span>,</span> MetaReducer <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> State <span>}</span> <span>from</span> <span>&#34;./core.state&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> MenusReducer <span>from</span> <span>&#34;./menus/menus.reducer&#34;</span><span>;</span>
<span>// ‚ú® New üëá</span>
<span>import</span> <span>*</span> <span>as</span> UserReducer <span>from</span> <span>&#34;./user/user.reducer&#34;</span><span>;</span>

<span>export</span> <span>const</span> reducers<span>:</span> ActionReducerMap<span>&lt;</span>State<span>&gt;</span> <span>=</span> <span>{</span>
  menus<span>:</span> MenusReducer<span>.</span>reducer<span>,</span>
  <span>// ‚ú® New üëá</span>
  user<span>:</span> UserReducer<span>.</span>reducer<span>,</span>
<span>}</span><span>;</span>

<span>export</span> <span>const</span> metaReducers<span>:</span> MetaReducer<span>&lt;</span>State<span>&gt;</span><span>[</span><span>]</span> <span>=</span> <span>[</span><span>]</span><span>;</span></code></pre><h3 id="Create-User-Effects">Create User Effects</h3><p>You will be interacting with Auth0&#39;s SDK through the user Effects, to log in and log out the user and listen to changes in the user&#39;s state. Open <code>user<span>.</span>effects<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthService <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>
<span>import</span> <span>{</span> Actions<span>,</span> createEffect<span>,</span> ofType <span>}</span> <span>from</span> <span>&#34;@ngrx/effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> tap<span>,</span> map <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> UserActions <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>UserEffects</span> <span>{</span>
  <span>constructor</span><span>(</span>
    <span>private</span> actions$<span>:</span> Actions<span>&lt;</span><span>any</span><span>&gt;</span><span>,</span>
    <span>private</span> authService<span>:</span> AuthService
  <span>)</span> <span>{</span><span>}</span>

  login$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>UserActions<span>.</span>allNavbarActions<span>.</span>loginFlowInitiated<span>.</span><span>type</span><span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>authService<span>.</span><span>loginWithRedirect</span><span>(</span><span>)</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>

  logout$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>UserActions<span>.</span>allNavbarActions<span>.</span>logoutFlowInitiated<span>.</span><span>type</span><span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>authService<span>.</span><span>logout</span><span>(</span><span>)</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>
<span>}</span></code></pre><p>To keep the user observable from the Auth0&#39;s SDK and our user Store in sync, you can use an actionless effect that listens to an external observable (in our case <code>authService<span>.</span>user$</code>) and dispatches another action whenever that observable emits a new value. Open <code>user<span>.</span>effects<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/user.effects.ts</span>

<span>import</span> <span>{</span> Injectable <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthService <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>
<span>import</span> <span>{</span> Actions<span>,</span> createEffect<span>,</span> ofType <span>}</span> <span>from</span> <span>&#34;@ngrx/effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> tap<span>,</span> map <span>}</span> <span>from</span> <span>&#34;rxjs/operators&#34;</span><span>;</span>
<span>import</span> <span>*</span> <span>as</span> UserActions <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span>

@<span>Injectable</span><span>(</span><span>)</span>
<span>export</span> <span>class</span> <span>UserEffects</span> <span>{</span>
  <span>constructor</span><span>(</span>
    <span>private</span> actions$<span>:</span> Actions<span>&lt;</span><span>any</span><span>&gt;</span><span>,</span>
    <span>private</span> authService<span>:</span> AuthService
  <span>)</span> <span>{</span><span>}</span>

  <span>// ‚ú® New üëá</span>
  userChanged$ <span>=</span> <span>createEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span>
    <span>this</span><span>.</span>authService<span>.</span>user$<span>.</span><span>pipe</span><span>(</span>
      <span>map</span><span>(</span><span>(</span>userDetails<span>)</span> <span>=&gt;</span>
        UserActions<span>.</span><span>userChangedFromAuth0SDK</span><span>(</span><span>{</span> userDetails<span>:</span> userDetails <span>}</span><span>)</span>
      <span>)</span>
    <span>)</span>
  <span>)</span><span>;</span>

  login$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>UserActions<span>.</span>allNavbarActions<span>.</span>loginFlowInitiated<span>.</span><span>type</span><span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>authService<span>.</span><span>loginWithRedirect</span><span>(</span><span>)</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>

  logout$ <span>=</span> <span>createEffect</span><span>(</span>
    <span>(</span><span>)</span> <span>=&gt;</span>
      <span>this</span><span>.</span>actions$<span>.</span><span>pipe</span><span>(</span>
        <span>ofType</span><span>(</span>UserActions<span>.</span>allNavbarActions<span>.</span>logoutFlowInitiated<span>.</span><span>type</span><span>)</span><span>,</span>
        <span>tap</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span>authService<span>.</span><span>logout</span><span>(</span><span>)</span><span>)</span>
      <span>)</span><span>,</span>
    <span>{</span> dispatch<span>:</span> <span>false</span> <span>}</span>
  <span>)</span><span>;</span>
<span>}</span></code></pre><p>Add <code>user<span>.</span>effects</code> to the barrel export. Open <code>index<span>.</span>ts</code> and add the following code üëá</p><pre><code><span>// src/app/core/state/user/index.ts</span>

<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.state&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.actions&#34;</span><span>;</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.selector&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>export</span> <span>*</span> <span>from</span> <span>&#34;./user.effects&#34;</span><span>;</span></code></pre><h4 id="Update-Effects-Module">Update Effects Module</h4><p>You will then need to add <code>UserEffects</code> to the <code>EffectsModule</code> initialization. Open <code>app<span>.</span>module<span>.</span>ts</code> and add the following code</p><pre><code><span>// src/app/app.module.ts</span>

<span>import</span> <span>{</span> BrowserModule <span>}</span> <span>from</span> <span>&#34;@angular/platform-browser&#34;</span><span>;</span>
<span>import</span> <span>{</span> NgModule <span>}</span> <span>from</span> <span>&#34;@angular/core&#34;</span><span>;</span>
<span>import</span> <span>{</span> HttpClientModule<span>,</span> <span>HTTP_INTERCEPTORS</span> <span>}</span> <span>from</span> <span>&#34;@angular/common/http&#34;</span><span>;</span>
<span>import</span> <span>{</span> StoreModule <span>}</span> <span>from</span> <span>&#34;@ngrx/store&#34;</span><span>;</span>
<span>import</span> <span>{</span> EffectsModule <span>}</span> <span>from</span> <span>&#34;@ngrx/effects&#34;</span><span>;</span>
<span>import</span> <span>{</span> AuthHttpInterceptor<span>,</span> AuthModule <span>}</span> <span>from</span> <span>&#34;@auth0/auth0-angular&#34;</span><span>;</span>

<span>import</span> <span>{</span> AppRoutingModule <span>}</span> <span>from</span> <span>&#34;./app-routing.module&#34;</span><span>;</span>
<span>import</span> <span>{</span> AppComponent <span>}</span> <span>from</span> <span>&#34;./app.component&#34;</span><span>;</span>
<span>import</span> <span>{</span> NavBarModule <span>}</span> <span>from</span> <span>&#34;./shared&#34;</span><span>;</span>
<span>import</span> <span>{</span> environment <span>}</span> <span>from</span> <span>&#34;src/environments/environment&#34;</span><span>;</span>
<span>import</span> <span>{</span> reducers<span>,</span> metaReducers <span>}</span> <span>from</span> <span>&#34;./core/state&#34;</span><span>;</span>
<span>import</span> <span>{</span> MenusEffects <span>}</span> <span>from</span> <span>&#34;./core/state/menus&#34;</span><span>;</span>

<span>// ‚ú® New üëá</span>
<span>import</span> <span>{</span> UserEffects <span>}</span> <span>from</span> <span>&#34;./core/state/user&#34;</span><span>;</span>

@<span>NgModule</span><span>(</span><span>{</span>
  imports<span>:</span> <span>[</span>
    BrowserModule<span>,</span>
    HttpClientModule<span>,</span>
    AuthModule<span>.</span><span>forRoot</span><span>(</span><span>{</span>
      <span>...</span>environment<span>.</span>auth<span>,</span>
      httpInterceptor<span>:</span> <span>{</span>
        allowedList<span>:</span> <span>[</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items</span><span>`</span></span><span>,</span>
          <span><span>`</span><span><span>${</span>environment<span>.</span>serverUrl<span>}</span></span><span>/api/menu/items/*</span><span>`</span></span><span>,</span>
        <span>]</span><span>,</span>
      <span>}</span><span>,</span>
    <span>}</span><span>)</span><span>,</span>
    AppRoutingModule<span>,</span>
    NavBarModule<span>,</span>

    <span>// NgRx</span>
    StoreModule<span>.</span><span>forRoot</span><span>(</span>reducers<span>,</span> <span>{</span>
      metaReducers<span>,</span>
    <span>}</span><span>)</span><span>,</span>

    <span>// ‚ú® New üëá</span>
    EffectsModule<span>.</span><span>forRoot</span><span>(</span><span>[</span>MenusEffects<span>,</span> UserEffects<span>]</span><span>)</span><span>,</span>
  <span>]</span><span>,</span>
  declarations<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  bootstrap<span>:</span> <span>[</span>AppComponent<span>]</span><span>,</span>
  providers<span>:</span> <span>[</span>
    <span>{</span>
      provide<span>:</span> <span>HTTP_INTERCEPTORS</span><span>,</span>
      useClass<span>:</span> AuthHttpInterceptor<span>,</span>
      multi<span>:</span> <span>true</span><span>,</span>
    <span>}</span><span>,</span>
  <span>]</span><span>,</span>
<span>}</span><span>)</span>
<span>export</span> <span>class</span> <span>AppModule</span> <span>{</span><span>}</span></code></pre><blockquote><p><strong>Checkpoint:</strong> There aren&#39;t any visible functional changes added in this section. The difference between the current state of the app compared to the previous checkpoint is its underlying implementation. The app now uses NgRx versus a <code>BehaviorSubject</code> to manage user-related states. The app should display the login button with an empty dashboard when the user is not authenticated, and display the logout button with the logged-in user&#39;s name along with the menu items on the dashboard when a user is authenticated. Clicking on the &#34;Log in&#34; and &#34;Log out&#34; buttons should trigger their respective flows using Auth0&#39;s SDK and update your application&#39;s state. If you open Redux Devtools in your browser, you should see the user state and actions every time you perform any user-related actions.</p></blockquote><h2 id="Conclusion">Conclusion</h2><p>State management is a key component when building applications. You added two Stores to our demo application to manage two distinct states - menus and user. This is a relatively small demo application with a few Stores, Actions, and Reducers to show how you can use NgRx to manage your Application&#39;s state, and use NgRx with Auth0&#39;s SDK to handle user-related functionalities.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 23 Nov 2021 19:57:00 +0000</pubDate>
    </item>
    <item>
      <title>.NET 6 Highlights</title>
      <link>https://auth0.com/blog/dotnet6-whats-new/</link>
      <description>What&#39;s new in .NET 6? What are the main relevant features brought by the new version of the .NET platform? Let&#39;s take a quick look.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>With the release of .NET 6, Microsoft consolidates its plan to create a unified platform to develop applications for any device and operating system. Together with this vision, .NET 6 brings many new features aiming to simplify development and gain performance. Let&#39;s take a quick look at the main points.</p><h2 id="Unified-Platform-Support">Unified Platform Support</h2><p>The vision of a <a href="https://auth0.com/blog/dotnet-5-whats-new/" target="_blank" rel="noreferrer noopener">unified platform for the .NET world started with .NET 5</a>. That release was meant to be the unified successor of <a href="https://auth0.com/blog/navigating-dotnet-maze/" target="_blank" rel="noreferrer noopener">the various .NET flavors: .NET Framework, .NET Standard, .NET Core, Mono</a>, etc. Beyond this goal, .NET 5 wanted to be a development platform to create any kind of application for any platform. However, at that time, an important piece was missing to complete the puzzle: a unified framework to create cross-platform UIs. Now, with <a href="https://devblogs.microsoft.com/dotnet/announcing-net-maui-preview-10/" target="_blank" rel="noreferrer noopener">.NET MAUI</a>, i.e., the <strong>.NET Multi-platform App UI</strong> framework, the puzzle is complete. Although at the time of writing <a href="https://devblogs.microsoft.com/dotnet/announcing-net-maui-preview-10/" target="_blank" rel="noreferrer noopener">.NET MAUI is in preview</a>, it is mature enough to be considered part of the .NET 6 release.</p><p>Now with .NET 6, you can really create the application you want and run it practically everywhere: from desktop to mobile, from the web to the cloud.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/GOa5gfL6LckpRRhqaBRJe/69341464075cbd46cf88fcbe36af4aa5/dotnet-unified-platform.png" alt=".NET 6 unified platform"/></p><p>[<a href="https://devblogs.microsoft.com/dotnet/announcing-net-6/" target="_blank" rel="noreferrer noopener"><em>Source: Microsoft</em></a>]
</p><p>In particular, the new <a href="https://github.com/dotnet/maui" target="_blank" rel="noreferrer noopener">.NET MAUI</a> framework allows you to build desktop and mobile native user interfaces with a single codebase.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4WkvXpMRwu7j5T82HiW04A/069649d85ea4e1def0831672b5fc8698/dotnet-maui-overview.png" alt=".NET MAUI overview"/></p><p>[<a href="https://devblogs.microsoft.com/dotnet/introducing-net-multi-platform-app-ui/" target="_blank" rel="noreferrer noopener"><em>Source: Microsoft</em></a>]
</p><h2 id="Simplified-Development">Simplified Development</h2><p>One of the main goals of the .NET 6 release is to provide developers with features that simplify their work. You can find support for simplified development throughout the platform, but three contexts are really exciting: new C# features, Hot Reload support, and minimal web APIs.</p><h3 id="C--10-features">C# 10 features</h3><p>.NET 6 brings you <a href="https://devblogs.microsoft.com/dotnet/welcome-to-csharp-10/" target="_blank" rel="noreferrer noopener">C# 10 with plenty of new features</a> that help you write code more easily. Let&#39;s take a quick look at a few of them.</p><h4 id="Global-and-implicit-usings">Global and implicit usings</h4><p>As a C# developer, you know how annoying it is to declare the same namespace in every file of your project. Consider, for example, the <code>System</code> namespace. Its use is very common, and I&#39;m pretty sure you forget it all the time and let Visual Studio suggest it.</p><p>Now you can declare namespaces using a global <code>using</code>, as shown in the following example:</p><pre><code><span>global</span> <span>using</span> <span>System</span><span>;</span></code></pre><p>With this declaration, you don&#39;t need to insert the <code>using System<span>;</span></code> declaration in all files anymore. You can declare a namespace through <code>global using</code> in any file, and it will be available in the entire project.</p><p>If you prefer (and I think it&#39;s a good practice), you can declare your namespaces in a file named <code>GlobalUsings<span>.</span>cs</code>.</p><p>You can also take advantage of implicit <code>using</code>s by configuring the <code><span>&lt;</span>ImplicitUsings<span>&gt;</span></code> element in your <code><span>.</span>csproj</code> file, as shown below:</p><pre><code><span><span><span>&lt;</span>PropertyGroup</span><span>&gt;</span></span>
    <span>&lt;!-- ...existing properties... --&gt;</span>
    <span><span><span>&lt;</span>ImplicitUsings</span><span>&gt;</span></span>enable<span><span><span>&lt;/</span>ImplicitUsings</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>PropertyGroup</span><span>&gt;</span></span></code></pre><p>This way, the compiler will automatically add the required <code>global using</code> directives based on the type of your project.</p><h4 id="New-namespace-syntax">New namespace syntax</h4><p>You know that the usual way to declare a namespace is as follows:</p><pre><code><span>namespace</span> <span>Geometry</span>
<span>{</span>
  <span>class</span> <span>Triangle</span> 
  <span>{</span>
    <span>// ...class members...</span>
  <span>}</span>
<span>}</span></code></pre><p>Now you can use the file-scoped namespace syntax to get the same result:</p><pre><code><span>namespace</span> Geometry

<span>class</span> <span>Triangle</span> 
<span>{</span>
  <span>// ...class members...</span>
<span>}</span></code></pre><p>With this approach, everything you define in the current file belongs to the declared namespace. By removing a nesting level, you make the code a bit cleaner. However, you can&#39;t create nested namespaces with this new syntax.</p><h4 id="Natural-types-for-lambda-expressions">Natural types for lambda expressions</h4><p>Consider the following assignment of a lambda expression to a variable:</p><pre><code><span>Func<span>&lt;</span><span>string</span><span>,</span> <span>int</span><span>&gt;</span></span> parse <span>=</span> <span>(</span><span><span>string</span></span> s<span>)</span> <span>=&gt;</span> <span>int</span><span>.</span><span>Parse</span><span>(</span>s<span>)</span><span>;</span></code></pre><p>You need to declare the target type of the lambda expression, <code>Func<span>&lt;</span>string<span>,</span> int<span>&gt;</span></code> in the example. Starting with C# 10, you can write the above code as follows:</p><pre><code><span><span>var</span></span> parse <span>=</span> <span>(</span><span><span>string</span></span> s<span>)</span> <span>=&gt;</span> <span>int</span><span>.</span><span>Parse</span><span>(</span>s<span>)</span><span>;</span></code></pre><p>The compiler will try to infer the &#34;natural&#34; type of the lambda expression.</p><h3 id="Hot-Reload">Hot Reload</h3><p>To improve the developer&#39;s productivity, .NET 6 extends <a href="https://devblogs.microsoft.com/dotnet/announcing-net-6/#hot-reload" target="_blank" rel="noreferrer noopener">the Hot Reload feature</a> to Visual Studio and almost any type of project. It allows you to run an application in your development environment, make changes, and get the changes applied without stopping, rebuilding, and rerunning the application.</p><p>In previous .NET releases, this feature was available just for the .NET CLI via the <code>dotnet watch</code> command. Not without <a href="https://www.theverge.com/2021/10/22/22740701/microsoft-dotnet-hot-reload-removal-decision-open-source" target="_blank" rel="noreferrer noopener">some minor hiccups with the community</a>, you can now benefit from it in <a href="https://devblogs.microsoft.com/dotnet/update-on-net-hot-reload-progress-and-visual-studio-2022-highlights/#improved-user-experience-in-visual-studio-2022" target="_blank" rel="noreferrer noopener">Visual Studio 2022</a> as well by simply clicking a button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3wu09sA8C4IQ5uKfmGoITK/e13d618f3f497e72281665de780b472d/vs2022-hot-reload-button.png" alt="Visual Studio 2022 Hot Reload button"/></p><p>[<a href="https://devblogs.microsoft.com/dotnet/update-on-net-hot-reload-progress-and-visual-studio-2022-highlights/" target="_blank" rel="noreferrer noopener"><em>Source: Microsoft</em></a>]
</p><h3 id="Minimal-web-APIs">Minimal web APIs</h3><p>One astonishing feature introduced by .NET 6 to simplify your code is <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis" target="_blank" rel="noreferrer noopener">minimal web APIs</a>. Along the lines of top-level statements, now you can build a fully working web API application with a few lines of code. Consider the following sample:</p><pre><code><span>//Program.cs</span>
<span><span>var</span></span> app <span>=</span> WebApplication<span>.</span><span>CreateBuilder</span><span>(</span>args<span>)</span><span>.</span><span>Build</span><span>(</span><span>)</span><span>;</span>

app<span>.</span><span>MapGet</span><span>(</span><span>&#34;/&#34;</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>&#34;Hello World!&#34;</span><span>)</span><span>;</span>
app<span>.</span><span>Run</span><span>(</span><span>)</span><span>;</span></code></pre><p>This is all the code you need to run a simple <em>Hello World!</em> web API.</p><p>If you have some experience building web APIs with ASP.NET Core, you know that you usually need a more articulate project. You need at least a <code>Program<span>.</span>cs</code> file with the setup code for the application, a <code>Startup<span>.</span>cs</code> file where you configure your API, and a controller class defining the API routes and implementing the endpoints.</p><p>That&#39;s a lot of simplification!</p><h2 id="Performance-Improvements">Performance Improvements</h2><p>In the last years, the .NET team put a lot of effort into improving the platform performance in compiling and execution time and reducing memory consumption. With .NET 6, you can appreciate these improvements in many parts of the framework. For example, the effort to <a href="https://github.com/dotnet/core/issues/5510" target="_blank" rel="noreferrer noopener">improve inner-loop performance</a> in building .NET projects has given awesome results, as you can see from the following diagram:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2ZVS4o4DKc6OroBO0Lb76b/187a5cbf18d934d9a1cefae71f1535f5/dotnet6-build-improvements.png" alt="dotnet6-build-improvements"/></p><p>[<a href="https://devblogs.microsoft.com/dotnet/announcing-net-6-preview-2/" target="_blank" rel="noreferrer noopener"><em>Source: Microsoft</em></a>]
</p><p>Other performance improvements include the IO subsystem. For example, the <code>FileStream</code> class <a href="https://devblogs.microsoft.com/dotnet/file-io-improvements-in-dotnet-6/" target="_blank" rel="noreferrer noopener">was almost completely rewritten</a> with amazing results even with respect to .NET 5, as the following table summarizes for the writing operation:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6RgFjbKytdIQk6pHtEaHxT/1d524bb8a02e4688979d71f3151aef3f/filestream-performance-improvement.png" alt="FileStream performance improvement"/></p><p>[<a href="https://devblogs.microsoft.com/dotnet/announcing-net-6/" target="_blank" rel="noreferrer noopener"><em>Source: Microsoft</em></a>]
</p><p>You can check out <a href="https://devblogs.microsoft.com/dotnet/performance-improvements-in-net-6/" target="_blank" rel="noreferrer noopener">a detailed report on performance improvements in .NET 6</a> with related benchmarks for more information.</p><h2 id="Summary">Summary</h2><p>This quick overview of .NET 6 shows that this is a consolidation release of the .NET platform. It aims to complete the unified platform vision started with .NET 5, improves the internals of the platform to provide the best performance, and starts a process of development simplification that probably will go further in future releases.</p><div><h2 id="Aside--Securing-ASP-NET-Core-with-Auth0">Aside: Securing ASP.NET Core with Auth0</h2><p>Securing ASP.NET Core applications with Auth0 is easy and brings a lot of great features to the table. With <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>, you only have to write a few lines of code to get a solid <a href="https://auth0.com/user-management" target="_blank" rel="noreferrer noopener">identity management solution</a>, <a href="https://auth0.com/docs/sso/single-sign-on" target="_blank" rel="noreferrer noopener">single sign-on</a>, support for <a href="https://auth0.com/docs/identityproviders" target="_blank" rel="noreferrer noopener">social identity providers (like Facebook, GitHub, Twitter, etc.)</a>, and support for <a href="https://auth0.com/enterprise" target="_blank" rel="noreferrer noopener">enterprise identity providers (like Active Directory, LDAP, SAML, custom, etc.)</a>.</p><p>On ASP.NET Core, you need <a href="https://auth0.com/docs/apis" target="_blank" rel="noreferrer noopener">to create an API in your Auth0 Management Dashboard</a> and change a few things on your code. To create an API, you need to <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free Auth0 account</a>. After that, you need to go to <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">the API section of the dashboard</a> and click on &#34;Create API&#34;. On the dialog shown, you can set the <em>Name</em> of your API as &#34;Books&#34;, the <em>Identifier</em> as &#34;<a href="http://books.mycompany.com" target="_blank" rel="noreferrer noopener">http://books.mycompany.com</a>&#34;, and leave the <em>Signing Algorithm</em> as &#34;RS256&#34;.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6HrObJ2eGY7YehLzbBM0sH/066be814a124d98f03224d9b177caa22/net-core-2_creating-api-on-auth0.png" alt="Creating API on Auth0"/></p><p>After that, you have to add the call to <code>services<span>.</span><span>AddAuthentication</span><span>(</span><span>)</span></code> in the <code><span>ConfigureServices</span><span>(</span><span>)</span></code> method of the <code>Startup</code> class as follows:</p><pre><code><span><span>string</span></span> authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>/&#34;</span></span><span>;</span>
<span><span>string</span></span> audience <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>;</span>

services<span>.</span><span>AddAuthentication</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  options<span>.</span>DefaultAuthenticateScheme <span>=</span> JwtBearerDefaults<span>.</span>AuthenticationScheme<span>;</span>
  options<span>.</span>DefaultChallengeScheme <span>=</span> JwtBearerDefaults<span>.</span>AuthenticationScheme<span>;</span>
<span>}</span><span>)</span><span>.</span><span>AddJwtBearer</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  options<span>.</span>Authority <span>=</span> authority<span>;</span>
  options<span>.</span>Audience <span>=</span> audience<span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>In the body of the <code><span>Configure</span><span>(</span><span>)</span></code> method of the <code>Startup</code> class, you also need to add an invocation to <code>app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span></code> and <code>app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span></code> as shown below:</p><pre><code>app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=&gt;</span>
<span>{</span>
    endpoints<span>.</span><span>MapControllers</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><blockquote><p>Make sure you invoke these methods in the order shown above. It is essential so that everything works properly.</p></blockquote><p>Finally, add the following element to the <code>appsettings<span>.</span>json</code> configuration file:</p><pre><code><span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
    <span>// ...</span>
  <span>}</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;YOUR_DOMAIN&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;YOUR_AUDIENCE&#34;</span>
  <span>}</span>
<span>}</span></code></pre><blockquote><p><strong>Note</strong>: Replace the placeholders <code><span>YOUR_DOMAIN</span></code> and <code><span>YOUR_AUDIENCE</span></code> with the actual values for the domain that you specified when creating your Auth0 account and the <em>Identifier</em> you assigned to your API.</p></blockquote></div></div></div>]]></content:encoded>
      <pubDate>Fri, 19 Nov 2021 15:51:00 +0000</pubDate>
    </item>
    <item>
      <title>Using Next.js and Auth0 with Supabase</title>
      <link>https://auth0.com/blog/using-nextjs-and-auth0-with-supabase/</link>
      <description>Learn how to integrate Auth0 authentication with database storage and row-level security authorization in Supabase.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><h2 id="Overview">Overview</h2><p>In this article, we are going to explore using <a href="https://nextjs.org/" target="_blank" rel="noreferrer noopener">Next.js</a>, <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>, and <a href="https://supabase.io/" target="_blank" rel="noreferrer noopener">Supabase</a> to build a classic Todo app. Each user will only be able to see their own todos, so we will need to implement authentication, authorization, and a database.</p><p>This article will cover:</p><ul><li>configuring Auth0, Next.js, and Supabase to work together seamlessly</li><li>using the <code>nextjs<span>-</span>auth0</code> library for authentication</li><li>implementing Row Level Security (RLS) and policies for authorization</li><li>what a JWT is and how to sign our own</li><li>using PostgreSQL Functions to extract values from a JWT</li></ul><p>The final version of the Todo app code can be found <a href="https://github.com/auth0-blog/auth0-supabase" target="_blank" rel="noreferrer noopener">here</a>.</p><h2 id="Prerequisites">Prerequisites</h2><p>This article does not assume prior experience with any of these technologies. However, you will need <a href="https://nodejs.org/en/download/" target="_blank" rel="noreferrer noopener">Node.js</a> installed to follow along. In addition, plan to have accounts for the managed services in the section below (Auth0 and Supabase). Both are free as of this writing and don&#39;t require a credit card.</p><h2 id="Stack">Stack</h2><p><strong>Next.js</strong> is a React framework that makes building efficient web apps super easy. It also gives us the ability to write server-side logic ‚Äî which we will need to ensure our application is secure ‚Äî without needing to maintain our own server.</p><p><strong>Auth0</strong> is an authentication and authorization solution that makes managing users and securing applications a breeze. It is an extremely battle-tested and mature solution for auth.</p><p><strong>Supabase</strong> is an open-source backend-as-a-service, which makes it possible to build an application in a weekend and scale to millions. It is a convenient wrapper around a collection of open source tools that enable database storage, file storage, authentication, authorization, and real-time subscriptions. While these are all great features, this article will only use database storage and authorization.</p><p>&#34;Wait, if Supabase handles auth, why are we using Auth0?&#34;</p><p>One of the real strengths of Supabase is the lack of vendor lockin. Maybe you already have users in Auth0, your company has a lot of experience with it, or you&#39;re interacting with other applications that use it. Any of the Supabase components can be swapped out for a similar service and hosted anywhere.</p><p>So let&#39;s do just that!</p><h2 id="Auth0">Auth0</h2><p>The first thing we need to do is sign up for a free account with <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>. Once at the dashboard, we need to create a new <code>Tenant</code> for our project.</p><blockquote><p>A tenant is a way of isolating our users and settings from other applications we have with Auth0.</p></blockquote><p>Click the name of your account in the top left, and then select <code>Create tenant</code> from the dropdown.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6q8TslJ4RHXYLN9gLHBBrD/e0391ad0f255cd966c85c3383e116ebe/01_supabase.png" alt="Create tenant from Auth0 dashboard"/></p><p>Give your tenant a unique <code>Domain</code>, set the <code>Region</code> closest to you, and leave the <code>Environment Tag</code> set to <code>Development</code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2wyQwGyJfbHMBJmnooUCvW/0e58c38c3ffd35c3e2b20ef6707dbd96/02_supabase.png" alt="Auth0 tenant settings"/></p><blockquote><p>In a production application, you want your region to be as close as possible to the majority of your users.</p></blockquote><p>Next, we want to create an Application. Select <code>Applications</code> &gt; <code>Applications</code> from the sidebar menu, and click <code><span>+</span> Create Application</code>. We want to give it a name (this can be the same as the Tenant) and select <code>Regular Web Applications</code>. Click <code>Create</code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/64sx7MYchwYOIh9C5CP74o/cbb0647dfb5b3100e61b88ee175c30d0/03_supabase.png" alt="Auth0 application settings"/></p><p>From the application&#39;s page, you are redirected to select the <code>Settings</code> tab and scroll down to the <code>Application URIs</code> section.</p><p>Add the following:</p><ul><li><code>Allowed Callback URLs</code>: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>3000</span><span>/</span>api<span>/</span>auth<span>/</span>callback</code></li><li><code>Allowed Logout URLs</code>: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>3000</span></code></li></ul><p>Go to <code>Advanced Settings</code> &gt; <code>OAuth</code> and confirm the <code><span>JSON</span> Web <span>Token</span> <span>(</span><span>JWT</span><span>)</span> Signature Algorithm</code> is set to <code><span>RS256</span></code> and that <code><span>OIDC</span> Conformant</code> is <code>enabled</code>. Be sure to save your changes.</p><p>Awesome. We now have an Auth0 instance configured to handle authentication for our application. So let&#39;s build an app!</p><p>While we could use any web application framework for this example, I am going to use Next.js. It gives us a super-efficient React application and includes file-based routing out of the box. In addition, it allows us to run server-side logic while building our app with <code>getStaticProps</code> and (when the user requests a page) with the <code>getServerSideProps</code> function. We will need to do things like authentication server-side, but we don&#39;t want the hassle of setting up, maintaining, and paying for another server.</p><h2 id="Next-js">Next.js</h2><p>The fastest way to create a Next.js application is using the <code>create<span>-</span>next<span>-</span>app</code> package:</p><pre><code>npx create-next-app supabase-auth0</code></pre><p>Replace the contents of <code>pages<span>/</span>index<span>.</span>js</code> with:</p><pre><code><span>// pages/index.js</span>

<span>import</span> styles <span>from</span> <span>&#34;../styles/Home.module.css&#34;</span><span>;</span>

<span>const</span> <span>Index</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>Working!</span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>default</span> Index<span>;</span></code></pre><p>Run the project in Development mode:</p><pre><code><span>npm</span> run dev</code></pre><p>And confirm it is working at <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>3000</span></code>.</p><h2 id="Authentication">Authentication</h2><p>Let&#39;s integrate the <code>nextjs<span>-</span>auth0</code> package. This is a convenient wrapper around the Auth0 JS SDK but specifically built for Next.js:</p><pre><code><span>npm</span> i @auth0/nextjs-auth0</code></pre><p>Create a new folder at <code>pages<span>/</span>api<span>/</span>auth<span>/</span></code> and add a file called <code><span>[</span><span>...</span>auth0<span>]</span><span>.</span>js</code> with the following content:</p><pre><code><span>// pages/api/auth/[...auth0].js</span>

<span>import</span> <span>{</span> handleAuth <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>

<span>export</span> <span>default</span> <span>handleAuth</span><span>(</span><span>)</span><span>;</span></code></pre><blockquote><p>The <code><span>[</span><span>...</span>auth0<span>]</span><span>.</span>js</code> is a catch all route. This means that any url that starts with <code><span>/</span>api<span>/</span>auth0</code> will load this component ‚Äî <code><span>/</span>api<span>/</span>auth0</code>, <code><span>/</span>api<span>/</span>auth0<span>/</span>login</code>, <code><span>/</span>api<span>/</span>auth0<span>/</span>some<span>/</span>deeply<span>/</span>nested<span>/</span>url</code> etc.</p></blockquote><p>This is one of those awesome things <code>nextjs<span>-</span>auth0</code> gives us for free! Calling <code><span>handleAuth</span><span>(</span><span>)</span></code> automatically creates a collection of convenient routes ‚Äî such as <code><span>/</span>login</code> and <code><span>/</span>logout</code> ‚Äî and all the necessary logic for handling tokens and sessions. There&#39;re no extra steps required besides calling this method.</p><p>Replace the contents of <code>pages<span>/</span>_app<span>.</span>js</code> with:</p><pre><code><span>// pages/_app.js</span>

<span>import</span> React <span>from</span> <span>&#34;react&#34;</span><span>;</span>
<span>import</span> <span>{</span> UserProvider <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>

<span>const</span> <span>App</span> <span>=</span> <span>(</span><span><span>{</span> Component<span>,</span> pageProps <span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span><span>UserProvider</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span><span>Component</span></span> <span><span>{</span><span>...</span><span>pageProps</span><span>}</span></span> <span>/&gt;</span></span><span>
    </span><span><span><span>&lt;/</span><span>UserProvider</span></span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>default</span> App<span>;</span></code></pre><p>Create a <code><span>.</span>env<span>.</span>local</code> file in your root project folder and add:</p><pre><code><span>AUTH0_SECRET</span><span>=</span>generate<span>-</span><span>this</span><span>-</span>below
<span>AUTH0_BASE_URL</span><span>=</span>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>3000</span>
<span>AUTH0_ISSUER_BASE_URL</span><span>=</span>https<span>:</span><span>/</span><span>/</span><span>&lt;</span>name<span>-</span><span>of</span><span>-</span>your<span>-</span>tenant<span>&gt;</span><span>.</span><span>&lt;</span>region<span>-</span>you<span>-</span>selected<span>&gt;</span><span>.</span>auth0<span>.</span>com
<span>AUTH0_CLIENT_ID</span><span>=</span>get<span>-</span><span>from</span><span>-</span>auth0<span>-</span>dashboard
<span>AUTH0_CLIENT_SECRET</span><span>=</span>get<span>-</span><span>from</span><span>-</span>auth0<span>-</span>dashboard</code></pre><blockquote><p>See <a href="https://nextjs.org/docs/basic-features/environment-variables" target="_blank" rel="noreferrer noopener">the Next.js documentation for Environment variables</a> to learn more.</p></blockquote><p>Generate a secure <code><span>AUTH0_SECRET</span></code> by running:</p><pre><code>node -e <span>&#34;console.log(crypto.randomBytes(32).toString(&#39;hex&#39;))&#34;</span></code></pre><blockquote><p><code><span>AUTH0_CLIENT_ID</span></code> and <code><span>AUTH0_CLIENT_SECRET</span></code> can be found at <code>Applications <span>&gt;</span> Settings <span>&gt;</span> Basic Information</code> in the Auth0 Dashboard.</p><p>You will need to quit the Next.js server and re-run the <code>npm run dev</code> command anytime new environment variables are added to the <code><span>.</span>env<span>.</span>local</code> file</p></blockquote><p>Let&#39;s update our <code>pages<span>/</span>index<span>.</span>js</code> file to add the ability to sign in and out:</p><pre><code><span>// pages/index.js</span>

<span>import</span> styles <span>from</span> <span>&#34;../styles/Home.module.css&#34;</span><span>;</span>
<span>import</span> <span>{</span> useUser <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>
<span>import</span> Link <span>from</span> <span>&#34;next/link&#34;</span><span>;</span>

<span>const</span> <span>Index</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>{</span> user <span>}</span> <span>=</span> <span>useUser</span><span>(</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>
      </span><span>{</span>user <span>?</span> <span>(</span>
        <span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>
          Welcome </span><span>{</span>user<span>.</span>name<span>}</span><span>!</span><span>{</span><span>&#34; &#34;</span><span>}</span><span>
          </span><span><span><span>&lt;</span><span>Link</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/api/auth/logout<span>&#34;</span></span><span>&gt;</span></span><span>
            </span><span><span><span>&lt;</span>a</span><span>&gt;</span></span><span>Logout</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;/</span><span>Link</span></span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
      <span>)</span> <span>:</span> <span>(</span>
        <span><span><span>&lt;</span><span>Link</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/api/auth/login<span>&#34;</span></span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;</span>a</span><span>&gt;</span></span><span>Login</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;/</span><span>Link</span></span><span>&gt;</span></span>
      <span>)</span><span>}</span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>default</span> Index<span>;</span></code></pre><p>We are using the <code><span>useUser</span><span>(</span><span>)</span></code> hook to get the <code>user</code> object if they have signed in. If not, we are rendering a link to the Login page.</p><blockquote><p>Next.js&#39; <code>Link</code> component is being used to enable client-side routing rather than needing to reload the entire page from the server.</p></blockquote><p>We can also add the ability to handle the <code>loading</code> and <code>error</code> states:</p><pre><code><span>// pages/index.js</span>

<span>import</span> styles <span>from</span> <span>&#34;../styles/Home.module.css&#34;</span><span>;</span>
<span>import</span> <span>{</span> useUser <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>
<span>import</span> Link <span>from</span> <span>&#34;next/link&#34;</span><span>;</span>

<span>const</span> <span>Index</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>{</span> user<span>,</span> error<span>,</span> isLoading <span>}</span> <span>=</span> <span>useUser</span><span>(</span><span>)</span><span>;</span>

  <span>if</span> <span>(</span>isLoading<span>)</span> <span>return</span> <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>Loading...</span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>;</span>
  <span>if</span> <span>(</span>error<span>)</span> <span>return</span> <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>{</span>error<span>.</span>message<span>}</span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span><span>;</span>

  <span>// rest of component</span>
<span>}</span><span>;</span>

<span>export</span> <span>default</span> Index<span>;</span></code></pre><p>We need our users to be signed in to see their <code>todos</code> or add a new <code>todo</code>. To accomplish this, we&#39;ll protect this route ‚Äî requiring the user to be signed in. We&#39;ll also automatically redirect them to the <code><span>/</span>login</code> route if they are not.</p><p>Thankfully, the <code>nextjs<span>-</span>auth0</code> library makes this super simple with the <code>withPageAuthRequired</code> function. We can tell Next.js to call this function on the server before rendering our page by setting it to the <code>getServerSideProps</code> function.</p><p>Add the following to the <code>pages<span>/</span>index<span>.</span>js</code> file:</p><pre><code><span>// other imports</span>
<span>import</span> <span>{</span> withPageAuthRequired <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>

<span>// rest of component</span>

<span>export</span> <span>const</span> getServerSideProps <span>=</span> <span>withPageAuthRequired</span><span>(</span><span>)</span><span>;</span>

<span>// other export</span></code></pre><p>This function checks if we have a user signed in and handles redirecting them to the Login page if not. If we have a user, it automatically passes the <code>user</code> object to our <code>Index</code> component as a prop. Since this is happening on the server before our component is rendered, we no longer need to handle loading, error states, or whether or not the user is logged in. This means we can significantly clean up our rendering logic.</p><p>This is what our entire file should look like:</p><pre><code><span>// pages/index.js</span>

<span>import</span> styles <span>from</span> <span>&#34;../styles/Home.module.css&#34;</span><span>;</span>
<span>import</span> <span>{</span> withPageAuthRequired <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>
<span>import</span> Link <span>from</span> <span>&#34;next/link&#34;</span><span>;</span>

<span>const</span> <span>Index</span> <span>=</span> <span>(</span><span><span>{</span> user <span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>
        Welcome </span><span>{</span>user<span>.</span>name<span>}</span><span>!</span><span>{</span><span>&#34; &#34;</span><span>}</span><span>
        </span><span><span><span>&lt;</span><span>Link</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/api/auth/logout<span>&#34;</span></span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;</span>a</span><span>&gt;</span></span><span>Logout</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;/</span><span>Link</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>const</span> getServerSideProps <span>=</span> <span>withPageAuthRequired</span><span>(</span><span>)</span><span>;</span>

<span>export</span> <span>default</span> Index<span>;</span></code></pre><p>Very clean!</p><p>We want to display a list of todos as the landing page, but first, we need somewhere to store them.</p><h2 id="Supabase">Supabase</h2><p>Head over to <a href="http://app.supabase.io" target="_blank" rel="noreferrer noopener">app.supabase.io</a> and click <code>Sign In</code> to authenticate with GitHub. This will create a free Supabase account. From the dashboard, click <code>New project</code> and choose your <code>Organization</code>.</p><p>Enter a name, password and select a region geographically close to what you chose for your Auth0 region.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/23CToNqw6BxzPn4FZrIIuX/ab135e1e29289b0571819b8e39076fe1/04_supabase.png" alt="New Supabase project settings"/></p><blockquote><p>Make sure you choose a secure password, as this will also apply to your PostgreSQL Database.</p></blockquote><p>It will take a few minutes for Supabase to provision all the bits in the background, but this page conveniently displays all the values we need to get our Next.js app configured.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3ZcykZgerUbAcESpqzNPeV/1c21f08ef7cf4ce658be3f1e98fdb06a/05_supabase.png" alt="Supabase app URL and secrets"/></p><p>Add these values to the <code><span>.</span>env<span>.</span>local</code> file:</p><pre><code><span>NEXT_PUBLIC_SUPABASE_URL</span><span>=</span>your<span>-</span>url
<span>NEXT_PUBLIC_SUPABASE_KEY</span><span>=</span>your<span>-</span>anon<span>-</span><span>public</span><span>-</span>key
<span>SUPABASE_SIGNING_SECRET</span><span>=</span>your<span>-</span>jwt<span>-</span>secret</code></pre><blockquote><p>Prepending an environment variable with <code><span>NEXT_PUBLIC_</span></code> makes it available in the Next.js client. All other values will only be available in <code>getStaticProps</code>, <code>getServerSideProps</code> and serverless functions in the <code>pages<span>/</span>api<span>/</span></code> directory.</p><p>Adding new values to the <code><span>.</span>env<span>.</span>local</code> file requires a restart of the Next.js dev server.</p></blockquote><p>Hopefully, that stalled you long enough and provisioning to complete, and your Supabase project is ready to go.</p><p>Click the <code>Table editor</code> icon in the sidebar menu and select <code><span>+</span> Create a <span>new</span> <span>table</span></code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5ejdPvTVZVhff4Po63TDDw/3a34b12025890bb8fec9a33f2391b567/06_supabase.png" alt="Create new table button"/></p><p>Create a <code>todo</code> table and add columns for <code>content</code>, <code>user_id</code> and <code>is_complete</code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/72MqBhF1zbucc7sWQUniHO/8baee467f254a3825846d676b78f519d/07_supabase.png" alt="New table settings"/></p><ul><li><code>content</code> will be the text displayed for our todo.</li><li><code>user_id</code> will be the user that owns the todo.</li><li><code>is_complete</code> will signify whether the todo is done yet. We are setting the default value to <code><span>false</span></code>, as we would assume for a new todo.</li></ul><blockquote><p>Leave <code>Row Level Security</code> disabled for now. We will worry about this later.</p></blockquote><p>Click <code>Insert row</code> to create some example <code>todos</code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3JVxCHIhAZfQSyPAMMkRsQ/77db8be1d980cee17c45a3dc14543c9a/08_supabase.png" alt="New row settings"/></p><blockquote><p>We can leave <code>user_id</code> blank and the default value of <code><span>false</span></code> for <code>is_complete</code>.</p></blockquote><p>Let&#39;s head back to our Next.js application and install the <code>supabase<span>-</span>js</code> library:</p><pre><code><span>npm</span> i @supabase/supabase-js</code></pre><p>Create a new folder called <code>utils</code> and add a file called <code>supabase<span>.</span>js</code>:</p><pre><code><span>// utils/supabase.js</span>

<span>import</span> <span>{</span> createClient <span>}</span> <span>from</span> <span>&#34;@supabase/supabase-js&#34;</span><span>;</span>

<span>const</span> <span>getSupabase</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> supabase <span>=</span> <span>createClient</span><span>(</span>
    process<span>.</span>env<span>.</span><span>NEXT_PUBLIC_SUPABASE_URL</span><span>,</span>
    process<span>.</span>env<span>.</span><span>NEXT_PUBLIC_SUPABASE_KEY</span>
  <span>)</span><span>;</span>

  <span>return</span> supabase<span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>{</span> getSupabase <span>}</span><span>;</span></code></pre><blockquote><p>We are making this a function as we will need to extend it later.</p></blockquote><p>This function uses the environment variables we declared earlier to create a new Supabase client. Let&#39;s use our new client to fetch <code>todos</code> in <code>pages<span>/</span>index<span>.</span>js</code>.</p><blockquote><p>We can pass a configuration object to the <code>withPageAuthRequired</code> function and declare our own <code>getServerSideProps</code> function, which will only run if the user is signed in.</p></blockquote><pre><code><span>// pages/index.js</span>

<span>export</span> <span>const</span> getServerSideProps <span>=</span> <span>withPageAuthRequired</span><span>(</span><span>{</span>
  <span>async</span> <span>getServerSideProps</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> supabase <span>=</span> <span>getSupabase</span><span>(</span><span>)</span><span>;</span>

    <span>const</span> <span>{</span> data<span>:</span> todos <span>}</span> <span>=</span> <span>await</span> supabase<span>.</span><span>from</span><span>(</span><span>&#34;todo&#34;</span><span>)</span><span>.</span><span>select</span><span>(</span><span>&#34;*&#34;</span><span>)</span><span>;</span>

    <span>return</span> <span>{</span>
      props<span>:</span> <span>{</span> todos <span>}</span><span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>We need to remember to import the <code>getSupabase</code> function:</p><pre><code><span>import</span> <span>{</span> getSupabase <span>}</span> <span>from</span> <span>&#34;../utils/supabase&#34;</span><span>;</span></code></pre><p>And now we can iterate over our <code>todos</code> and display them in our component:</p><pre><code><span>const</span> <span>Index</span> <span>=</span> <span>(</span><span><span>{</span> user<span>,</span> todos <span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>
        Welcome </span><span>{</span>user<span>.</span>name<span>}</span><span>!</span><span>{</span><span>&#34; &#34;</span><span>}</span><span>
        </span><span><span><span>&lt;</span><span>Link</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/api/auth/logout<span>&#34;</span></span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;</span>a</span><span>&gt;</span></span><span>Logout</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;/</span><span>Link</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>
      </span><span>{</span>todos<span>.</span><span>map</span><span>(</span><span>(</span><span>todo</span><span>)</span> <span>=&gt;</span> <span>(</span>
        <span><span><span>&lt;</span>p</span> <span>key</span><span><span>=</span><span>{</span>todo<span>.</span>id<span>}</span></span><span>&gt;</span></span><span>{</span>todo<span>.</span>content<span>}</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
      <span>)</span><span>)</span><span>}</span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>We can also handle the case where there are no <code>todos</code> to display:</p><pre><code><span>const</span> <span>Index</span> <span>=</span> <span>(</span><span><span>{</span> user<span>,</span> todos <span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>
        Welcome </span><span>{</span>user<span>.</span>name<span>}</span><span>!</span><span>{</span><span>&#34; &#34;</span><span>}</span><span>
        </span><span><span><span>&lt;</span><span>Link</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/api/auth/logout<span>&#34;</span></span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;</span>a</span><span>&gt;</span></span><span>Logout</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;/</span><span>Link</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>
      </span><span>{</span>todos<span>?.</span>length <span>&gt;</span> <span>0</span> <span>?</span> <span>(</span>
        todos<span>.</span><span>map</span><span>(</span><span>(</span><span>todo</span><span>)</span> <span>=&gt;</span> <span><span><span>&lt;</span>p</span> <span>key</span><span><span>=</span><span>{</span>todo<span>.</span>id<span>}</span></span><span>&gt;</span></span><span>{</span>todo<span>.</span>content<span>}</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>)</span>
      <span>)</span> <span>:</span> <span>(</span>
        <span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>You have completed all todos!</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
      <span>)</span><span>}</span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><blockquote><p>The <code>todos<span>?.</span>length</code> statement is using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining" target="_blank" rel="noreferrer noopener">Optional Chaining</a>. This is a fallback in case the <code>todos</code> prop is <code><span>undefined</span></code> or <code><span>null</span></code>.</p></blockquote><p>Our whole component should look something like this:</p><pre><code><span>// pages/index.js</span>

<span>import</span> styles <span>from</span> <span>&#34;../styles/Home.module.css&#34;</span><span>;</span>
<span>import</span> <span>{</span> withPageAuthRequired <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>
<span>import</span> <span>{</span> getSupabase <span>}</span> <span>from</span> <span>&#34;../utils/supabase&#34;</span><span>;</span>
<span>import</span> Link <span>from</span> <span>&#34;next/link&#34;</span><span>;</span>

<span>const</span> <span>Index</span> <span>=</span> <span>(</span><span><span>{</span> user<span>,</span> todos <span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>
        Welcome </span><span>{</span>user<span>.</span>name<span>}</span><span>!</span><span>{</span><span>&#34; &#34;</span><span>}</span><span>
        </span><span><span><span>&lt;</span><span>Link</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/api/auth/logout<span>&#34;</span></span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;</span>a</span><span>&gt;</span></span><span>Logout</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;/</span><span>Link</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>
      </span><span>{</span>todos<span>?.</span>length <span>&gt;</span> <span>0</span> <span>?</span> <span>(</span>
        todos<span>.</span><span>map</span><span>(</span><span>(</span><span>todo</span><span>)</span> <span>=&gt;</span> <span><span><span>&lt;</span>p</span> <span>key</span><span><span>=</span><span>{</span>todo<span>.</span>id<span>}</span></span><span>&gt;</span></span><span>{</span>todo<span>.</span>content<span>}</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>)</span>
      <span>)</span> <span>:</span> <span>(</span>
        <span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>You have completed all todos!</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
      <span>)</span><span>}</span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>const</span> getServerSideProps <span>=</span> <span>withPageAuthRequired</span><span>(</span><span>{</span>
  <span>async</span> <span>getServerSideProps</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> supabase <span>=</span> <span>getSupabase</span><span>(</span><span>)</span><span>;</span>

    <span>const</span> <span>{</span> data<span>:</span> todos <span>}</span> <span>=</span> <span>await</span> supabase<span>.</span><span>from</span><span>(</span><span>&#34;todo&#34;</span><span>)</span><span>.</span><span>select</span><span>(</span><span>&#34;*&#34;</span><span>)</span><span>;</span>

    <span>return</span> <span>{</span>
      props<span>:</span> <span>{</span> todos <span>}</span><span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span>

<span>export</span> <span>default</span> Index<span>;</span></code></pre><p>Awesome! We should now be seeing our todos in our Next.js app.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5yph3i8Ui8j99mmrDss4ml/5bbac527eb959eff4cf9fae9a19b80a1/09_supabase.png" alt="List of todo items"/></p><p>But wait, we see <em>all</em> the todos.</p><p>We only want users to see <em>their</em> todos. For this, we need to implement authorization. Let&#39;s create a helper function in Postgres to extract the currently logged-in user from the request&#39;s JWT.</p><h2 id="PostgreSQL-Functions">PostgreSQL Functions</h2><p>Head back to the Supabase dashboard, click <code><span>SQL</span></code> in the side panel and select <code>New query</code>. This will create a snippet entitled <code><span>new</span> <span>sql</span> snippet</code>. Add the following SQL blob and click <code><span>RUN</span></code>.</p><pre><code><span>create</span> <span>or</span> <span>replace</span> <span>function</span> auth<span>.</span>user_id<span>(</span><span>)</span> <span>returns</span> <span>text</span> <span>as</span> $$
  <span>select</span> <span>nullif</span><span>(</span>current_setting<span>(</span><span>&#39;request.jwt.claim.userId&#39;</span><span>,</span> <span>true</span><span>)</span><span>,</span> <span>&#39;&#39;</span><span>)</span>::<span>text</span><span>;</span>
$$ <span>language</span> <span>sql</span> stable<span>;</span></code></pre><p>Okay, this one may look a little intimidating. Let&#39;s break down the bits we need to understand:</p><ol start="1"><li>We are creating a new function called <code>user_id</code>.</li><li>The <code>auth<span>.</span></code> part is just a way to namespace it as it is related to auth ‚Äî also called a schema and is a convention in Postgres.</li><li>This function will return a <code>text</code> value.</li><li>The body of the function is fetching the value from the <code>userId</code> field of the <code>jwt</code> that came along with the <code>request</code>. We will talk about JWTs later in the article.</li><li>If there is no <code>request<span>.</span>jwt<span>.</span>claim<span>.</span>userId</code>, we are just returning an empty string ‚Äî <code><span>&#39;&#39;</span></code>.</li></ol><p>Not that scary!</p><blockquote><p>Check out <a href="https://www.youtube.com/watch?v=MJZCCpCYEqk" target="_blank" rel="noreferrer noopener">this video on Postgres functions</a> to learn more.</p></blockquote><p>Let&#39;s enable <code>Row Level Security</code> and use our new function to ensure only users who own the <code>todo</code> can see it.</p><h2 id="Row-Level-Security">Row Level Security</h2><p>Because Supabase is just a PostgreSQL Database under the hood, we can take advantage of a killer feature ‚Äî Row Level Security (RLS). RLS allows us to write authorization rules in the database itself, which can be much more efficient, and much more secure!</p><p>Head back to the Supabase dashboard, and from the side panel, select <code>Authentication</code> &gt; <code>Policies</code> and click <code>Enable <span>RLS</span></code> for the <code>todo</code> table.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3VSbRaEkQUdQcOuxilxpux/6a8a71cde38a10b35b423a10f7e659cf/09b_supabase.png" alt="Supabase dashboard showing RLS enabled for todo table"/></p><p>Now, if we refresh our application, we will see the empty state message.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2u6N6bHgfG6sm1sbpgr51l/c70b28db417814e6f8934b3f49b50f22/10_supabase.png" alt="Empty todo list"/></p><p>Where did our <code>todos</code> go?</p><p>By default, RLS will deny access to all rows. If we want a user to see their <code>todos</code>, we need to write a policy.</p><p>Back in the Supabase dashboard, click <code>New Policy</code>, then <code>Create a policy <span>from</span> scratch</code> and fill in the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3wR5iw6ZEyrdn7ZdNdNsrW/a382ee739b0597dbbfa5428a71b2df1e/11_supabase.png" alt="Policy settings for SELECT"/></p><p>This might look a little unfamiliar, so let&#39;s break it down.</p><ol start="1"><li>We are giving our policy a <code>name</code>. This can be anything.</li><li>We declare which actions we would like to enable. Since we want users to be able to read their own <code>todos</code>, we are choosing <code><span>SELECT</span></code>.</li><li>We need to specify a condition that can be <code><span>true</span></code> or <code><span>false</span></code>. If it evaluates to <code><span>true</span></code>, the action will be allowed. Otherwise, it will continue to be denied.</li><li>We call our <code>auth<span>.</span><span>user_id</span><span>(</span><span>)</span></code> function to get the currently logged-in user&#39;s <code>id</code> and compare it to the <code>user_id</code> column for this <code>todo</code>.</li></ol><blockquote><p>I recommend checking out <a href="https://www.youtube.com/watch?v=Ow_Uzedfohk" target="_blank" rel="noreferrer noopener">this video</a> to learn more about how awesome and powerful Row Level Security is in Supabase.</p></blockquote><p>Click <code>Review</code> to see the SQL that is being generated for us.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3n5LovurNMA2Hz5R8nCphH/3ec72d6c5be7dfca3efb522ea46d47e2/12_supabase.png" alt="Generated SQL for SELECT policy"/></p><p>Not even scary. It has just formatted the fields we entered into the correct SQL syntax.</p><p>While we&#39;re here, let&#39;s add a policy for creating new <code>todos</code>. This will be an <code><span>INSERT</span></code> action:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3aAUpryEo8sTGn0Dt2IrbF/c4fe30d560ed50f4a30105469f127254/13_supabase.png" alt="Policy settings for INSERT"/></p><blockquote><p>While we probably want to permit users to perform all CRUD actions, it is good practice to specify separate policies rather than selecting <code><span>ALL</span></code>. This makes them easier to extend and remove in the future.</p></blockquote><p>Our application does not yet need to be able to update or delete <code>todos</code>; therefore, we will not create policies for these actions.</p><blockquote><p>It is good security practice to enable the minimum amount of permissions for the application to function. We can easily write policies for these actions in the future if we want to enable them.</p></blockquote><p>Let&#39;s see if we can view our todos yet by refreshing our Next.js app.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7rZX7pmjdogsOe1KAW8P0Z/f04bca604bc76bfa796c6bd8b720d252/14_supabase.png" alt="Empty todo list"/></p><p>Still no todos üôÅ Did we mess something up?</p><p>No! We just need to add a little bit more glue to transform the JWT that Auth0 is giving our Next.js application to the format that Supabase is expecting.</p><h2 id="What-is-a-JWT-">What is a JWT?</h2><p>To understand this problem, we must first understand what a JWT is. A JWT encodes a JSON object into a big string that we can use to send data between different services.</p><p>By default, the data in a JWT is not encrypted or private, just encoded.</p><blockquote><p>Aditya Shukla wrote <a href="https://medium.com/swlh/the-difference-between-encoding-encryption-and-hashing-878c606a7aff" target="_blank" rel="noreferrer noopener">a great article</a> about the differences between encoding, encryption, and hashing. Give it a read to learn more.</p></blockquote><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2dyNvJiSFD9h999ZdC6jsN/be5270413ae2402f4faf9533d4eff7dc/15_supabase.png" alt="Screenshot from JWT.io showing the encoded and decoded values of a JWT"/></p><p>This is an example taken from <a href="http://jwt.io" target="_blank" rel="noreferrer noopener">jwt.io</a> ‚Äî a great tool for working with JWTs. On the left, we can see the JWT value. On the right, we can see what each part represents when decoded. We have some header information about how the JWT was encoded, the payload of user data, and a signature that can be used to <code>verify</code> the token.</p><p>Don&#39;t put secret things in a JWT!!</p><p>The reason we can trust JWTs for authentication is that we can <code>sign</code> it using a secret value. This value is run through an algorithm with the payload data, and a JWT string comes out the other side. We can use the signing secret to <code>verify</code> the JWT on our server. This ensures that an attacker hasn&#39;t tinkered with our token in transit. If they have, the value of the JWT will be different, and it will fail verification.</p><p>The only way it could be modified and pass the <code>verify</code> step is if someone has your signing secret. This would be bad. And this is why we can only sign JWTs with our server ‚Äî or in the case of Next.js, the <code>getStaticProps</code>, <code>getServerSideProps</code>, or API routes in the <code>pages<span>/</span>api</code> directory.</p><p>Never expose the signing secret to the client!!</p><p>Okay, so now that we understand JWTs, what is the problem?</p><p>The signing secret used by Auth0 does not match Supabase&#39;s signing secret. While we&#39;re not using Supabase for authentication, it still uses the secret to verify the JWT each time we request data. Neither of these services makes the signing secret&#39;s value configurable.</p><p>To solve this problem, we can just grab the <code>sub</code> property ‚Äî the user&#39;s ID ‚Äî from Auth0 and <code>sign</code> a new token using the signing secret that Supabase is expecting.</p><h2 id="Signing-a-JWT">Signing a JWT</h2><p>When working with JWTs, we want to use a well-trusted library from a reputable source. Auth0 has a very widely used and trusted one called <code>jsonwebtoken</code>.</p><p>Let&#39;s install it:</p><pre><code><span>npm</span> i jsonwebtoken</code></pre><p>We can use another hook that the <code>@auth0<span>/</span>nextjs<span>-</span>auth0</code> library gives us to run some logic after the user signs in. This is called <code>afterCallback</code> and can be passed as a configuration to our <code>handleAuth</code> function. Let&#39;s replace the contents of the <code>pages<span>/</span>api<span>/</span>auth<span>/</span><span>[</span><span>...</span>auth0<span>]</span><span>.</span>js</code> file with:</p><pre><code><span>// pages/api/auth/[...auth0].js</span>

<span>import</span> <span>{</span> handleAuth<span>,</span> handleCallback <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>

<span>const</span> <span>afterCallback</span> <span>=</span> <span>async</span> <span>(</span><span>req<span>,</span> res<span>,</span> session</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>// do some stuff</span>
  <span>// modify the session</span>

  <span>return</span> session<span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>default</span> <span>handleAuth</span><span>(</span><span>{</span>
  <span>async</span> <span>callback</span><span>(</span><span>req<span>,</span> res</span><span>)</span> <span>{</span>
    <span>try</span> <span>{</span>
      <span>await</span> <span>handleCallback</span><span>(</span>req<span>,</span> res<span>,</span> <span>{</span> afterCallback <span>}</span><span>)</span><span>;</span>
    <span>}</span> <span>catch</span> <span>(</span>error<span>)</span> <span>{</span>
      res<span>.</span><span>status</span><span>(</span>error<span>.</span>status <span>||</span> <span>500</span><span>)</span><span>.</span><span>end</span><span>(</span>error<span>.</span>message<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>In this function, we want to:</p><ol start="1"><li>get the user object from Auth0&#39;s session</li><li>create a new payload</li><li>sign a new token using Supabase&#39;s signing secret</li></ol><p>Let&#39;s extend our <code>afterCallback</code> function to perform this logic:</p><pre><code><span>// pages/api/auth/[...auth0].js</span>

<span>// other imports</span>
<span>import</span> jwt <span>from</span> <span>&#34;jsonwebtoken&#34;</span><span>;</span>

<span>const</span> <span>afterCallback</span> <span>=</span> <span>async</span> <span>(</span><span>req<span>,</span> res<span>,</span> session</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> payload <span>=</span> <span>{</span>
    userId<span>:</span> session<span>.</span>user<span>.</span>sub<span>,</span>
    exp<span>:</span> Math<span>.</span><span>floor</span><span>(</span>Date<span>.</span><span>now</span><span>(</span><span>)</span> <span>/</span> <span>1000</span><span>)</span> <span>+</span> <span>60</span> <span>*</span> <span>60</span><span>,</span>
  <span>}</span><span>;</span>

  session<span>.</span>user<span>.</span>accessToken <span>=</span> jwt<span>.</span><span>sign</span><span>(</span>
    payload<span>,</span>
    process<span>.</span>env<span>.</span><span>SUPABASE_SIGNING_SECRET</span>
  <span>)</span><span>;</span>

  <span>return</span> session<span>;</span>
<span>}</span><span>;</span></code></pre><p>The <code>sub</code> field represents Auth0&#39;s unique ID for this user. Since this is the only value we actually need to tell Supabase who our user is, we can create a new payload that contains only this value.</p><blockquote><p>It is good security practice to only give things the minimum amount of data and permissions they need to handle the task.</p></blockquote><p>Additionally, we are setting an expiry for our token ‚Äî 1 hour. This means that if someone does get a hold of our token, they do not have access to our database indefinitely.</p><p>Lastly, we are signing a new token with that payload, using the <code><span>SUPABASE_SIGNING_SECRET</span></code>.</p><p>Awesome! Our whole file should look something like this:</p><pre><code><span>// pages/api/auth/[...auth0].js</span>

<span>import</span> <span>{</span> handleAuth<span>,</span> handleCallback <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>
<span>import</span> jwt <span>from</span> <span>&#34;jsonwebtoken&#34;</span><span>;</span>

<span>const</span> <span>afterCallback</span> <span>=</span> <span>async</span> <span>(</span><span>req<span>,</span> res<span>,</span> session</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> payload <span>=</span> <span>{</span>
    userId<span>:</span> session<span>.</span>user<span>.</span>sub<span>,</span>
    exp<span>:</span> Math<span>.</span><span>floor</span><span>(</span>Date<span>.</span><span>now</span><span>(</span><span>)</span> <span>/</span> <span>1000</span><span>)</span> <span>+</span> <span>60</span> <span>*</span> <span>60</span><span>,</span>
  <span>}</span><span>;</span>

  session<span>.</span>user<span>.</span>accessToken <span>=</span> jwt<span>.</span><span>sign</span><span>(</span>
    payload<span>,</span>
    process<span>.</span>env<span>.</span><span>SUPABASE_SIGNING_SECRET</span>
  <span>)</span><span>;</span>

  <span>return</span> session<span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>default</span> <span>handleAuth</span><span>(</span><span>{</span>
  <span>async</span> <span>callback</span><span>(</span><span>req<span>,</span> res</span><span>)</span> <span>{</span>
    <span>try</span> <span>{</span>
      <span>await</span> <span>handleCallback</span><span>(</span>req<span>,</span> res<span>,</span> <span>{</span> afterCallback <span>}</span><span>)</span><span>;</span>
    <span>}</span> <span>catch</span> <span>(</span>error<span>)</span> <span>{</span>
      res<span>.</span><span>status</span><span>(</span>error<span>.</span>status <span>||</span> <span>500</span><span>)</span><span>.</span><span>end</span><span>(</span>error<span>.</span>message<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>Let&#39;s extend our <code>getSupabase</code> function in <code>utils<span>/</span>supabase<span>.</span>js</code> to accept an optional <code>access_token</code> parameter.</p><pre><code><span>// utils/supabase.js</span>

<span>import</span> <span>{</span> createClient <span>}</span> <span>from</span> <span>&#34;@supabase/supabase-js&#34;</span><span>;</span>

<span>const</span> <span>getSupabase</span> <span>=</span> <span>(</span><span>access_token</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> supabase <span>=</span> <span>createClient</span><span>(</span>
    process<span>.</span>env<span>.</span><span>NEXT_PUBLIC_SUPABASE_URL</span><span>,</span>
    process<span>.</span>env<span>.</span><span>NEXT_PUBLIC_SUPABASE_KEY</span>
  <span>)</span><span>;</span>

  <span>if</span> <span>(</span>access_token<span>)</span> <span>{</span>
    supabase<span>.</span>auth<span>.</span><span>session</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
      access_token<span>,</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> supabase<span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>{</span> getSupabase <span>}</span><span>;</span></code></pre><p>If we pass this function an <code>access_token</code>, it will attach it to the Supabase session, which will go along for the ride when we request data from Supabase.</p><p>Let&#39;s extend our <code>getServerSideProps</code> function in <code>pages<span>/</span>index<span>.</span>js</code> to get the <code>accessToken</code> from the session&#39;s user, and pass it to the <code>getSupabase</code> function:</p><pre><code><span>// pages/index.js</span>

<span>export</span> <span>const</span> getServerSideProps <span>=</span> <span>withPageAuthRequired</span><span>(</span><span>{</span>
  <span>async</span> <span>getServerSideProps</span><span>(</span><span><span>{</span> req<span>,</span> res <span>}</span></span><span>)</span> <span>{</span>
    <span>const</span> <span>{</span>
      user<span>:</span> <span>{</span> accessToken <span>}</span><span>,</span>
    <span>}</span> <span>=</span> <span>await</span> <span>getSession</span><span>(</span>req<span>,</span> res<span>)</span><span>;</span>

    <span>const</span> supabase <span>=</span> <span>getSupabase</span><span>(</span>accessToken<span>)</span><span>;</span>

    <span>const</span> <span>{</span> data<span>:</span> todos <span>}</span> <span>=</span> <span>await</span> supabase<span>.</span><span>from</span><span>(</span><span>&#34;todo&#34;</span><span>)</span><span>.</span><span>select</span><span>(</span><span>&#34;*&#34;</span><span>)</span><span>;</span>

    <span>return</span> <span>{</span>
      props<span>:</span> <span>{</span> todos <span>}</span><span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>We also need to remember to add <code>getSession</code> to the import from <code>@auth0<span>/</span>nextjs<span>-</span>auth0</code>:</p><pre><code><span>import</span> <span>{</span> withPageAuthRequired<span>,</span> getSession <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span></code></pre><p>Our whole component should look something like this:</p><pre><code><span>// pages/index.js</span>

<span>import</span> styles <span>from</span> <span>&#34;../styles/Home.module.css&#34;</span><span>;</span>
<span>import</span> <span>{</span> withPageAuthRequired<span>,</span> getSession <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>
<span>import</span> <span>{</span> getSupabase <span>}</span> <span>from</span> <span>&#34;../utils/supabase&#34;</span><span>;</span>
<span>import</span> Link <span>from</span> <span>&#34;next/link&#34;</span><span>;</span>

<span>const</span> <span>Index</span> <span>=</span> <span>(</span><span><span>{</span> user<span>,</span> todos <span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>
        Welcome </span><span>{</span>user<span>.</span>name<span>}</span><span>!</span><span>{</span><span>&#34; &#34;</span><span>}</span><span>
        </span><span><span><span>&lt;</span><span>Link</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/api/auth/logout<span>&#34;</span></span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;</span>a</span><span>&gt;</span></span><span>Logout</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;/</span><span>Link</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>
      </span><span>{</span>todos<span>?.</span>length <span>&gt;</span> <span>0</span> <span>?</span> <span>(</span>
        todos<span>.</span><span>map</span><span>(</span><span>(</span><span>todo</span><span>)</span> <span>=&gt;</span> <span><span><span>&lt;</span>p</span> <span>key</span><span><span>=</span><span>{</span>todo<span>.</span>id<span>}</span></span><span>&gt;</span></span><span>{</span>todo<span>.</span>content<span>}</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>)</span>
      <span>)</span> <span>:</span> <span>(</span>
        <span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>You have completed all todos!</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
      <span>)</span><span>}</span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>const</span> getServerSideProps <span>=</span> <span>withPageAuthRequired</span><span>(</span><span>{</span>
  <span>async</span> <span>getServerSideProps</span><span>(</span><span><span>{</span> req<span>,</span> res <span>}</span></span><span>)</span> <span>{</span>
    <span>const</span> <span>{</span>
      user<span>:</span> <span>{</span> accessToken <span>}</span><span>,</span>
    <span>}</span> <span>=</span> <span>await</span> <span>getSession</span><span>(</span>req<span>,</span> res<span>)</span><span>;</span>

    <span>const</span> supabase <span>=</span> <span>getSupabase</span><span>(</span>accessToken<span>)</span><span>;</span>

    <span>const</span> <span>{</span> data<span>:</span> todos <span>}</span> <span>=</span> <span>await</span> supabase<span>.</span><span>from</span><span>(</span><span>&#34;todo&#34;</span><span>)</span><span>.</span><span>select</span><span>(</span><span>&#34;*&#34;</span><span>)</span><span>;</span>

    <span>return</span> <span>{</span>
      props<span>:</span> <span>{</span> todos <span>}</span><span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span>

<span>export</span> <span>default</span> Index<span>;</span></code></pre><p>Since Auth0&#39;s <code>afterCallback</code> function runs after the user signs in, we need to log out of our application by clicking the <code>Logout</code> link on the landing page or manually navigating to <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>3000</span><span>/</span>api<span>/</span>auth<span>/</span>logout</code>.</p><p>This will sign us out and automatically redirect us to Auth0&#39;s sign-in page.</p><p>Sign back in, and we should have our new JWT attached to our Auth0 session&#39;s user.</p><p>Now when we refresh our application, we should finally see todos.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5driL3cnbUYrnzTMPBnBOK/902610989e531f3c7ea3b80a4310697f/17_supabase.png" alt="Empty todo list"/></p><p>Nope!</p><p>But we are very close. If we look at the <code>Table editor</code> in the Supabase dashboard. Who is the user that owns the todos?</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/53Hn3LhbL6Vw9vMj1eSk6R/071d261e22d1155b535f111fad46684c/18_supabase.png" alt="User ID null in Supabase Table Editor"/></p><p>NULL!!</p><p>So we just need to find out what our current <code>user_id</code> is and add it to those rows.</p><p>Head back to the Auth0 dashboard, click <code>User Management</code> &gt; <code>Users</code> in the sidebar, and select your user.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/23UgAZaPfCyZIcGts2s7ew/4b4a05649d91d7dbc702e1d0b0a8d7ce/19_supabase.png" alt="List of users in Auth0 dashboard"/></p><p>The <code>user_id</code> is displayed at the top of your user&#39;s details page.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/44sstE7gRjeXxTe6J5ELzy/0106a84fdd7377a01262521b4d76612e/20_supabase.png" alt="User ID in Auth0 dashboard"/></p><p>Let&#39;s copy this value and paste it as the <code>user_id</code> for the <code>todos</code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/RxINXvWlSt8VyJOX4BZX3/43d70087dcc4777e572f0a119c88c8b6/21_supabase.png" alt="User ID set to Auth0 user"/></p><p>Refresh our Next.js application.</p><p>Voil√†! Todos!!!</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/HMMRW0BEkFuDqneJDhGT0/969993d5311123cb7c8b15930f83f0ca/22_supabase.png" alt="List of todo items"/></p><p>The last thing we need to implement is the functionality to add a <code>todo</code>.</p><p>Let&#39;s add the form logic to our <code>pages<span>/</span>index<span>.</span>js</code> component.</p><pre><code><span>// pages/index.js</span>

<span>// other imports</span>
<span>import</span> <span>{</span> useState <span>}</span> <span>from</span> <span>&#34;react&#34;</span><span>;</span>

<span>const</span> <span>Index</span> <span>=</span> <span>(</span><span><span>{</span> user<span>,</span> todos <span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>[</span>content<span>,</span> setContent<span>]</span> <span>=</span> <span>useState</span><span>(</span><span>&#34;&#34;</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span>allTodos<span>,</span> setAllTodos<span>]</span> <span>=</span> <span>useState</span><span>(</span><span>[</span><span>...</span>todos<span>]</span><span>)</span><span>;</span>

  <span>const</span> <span>handleSubmit</span> <span>=</span> <span>async</span> <span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>{</span>
    e<span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span>
    <span>const</span> supabase <span>=</span> <span>getSupabase</span><span>(</span>user<span>.</span>accessToken<span>)</span><span>;</span>
    <span>const</span> resp <span>=</span> <span>await</span> supabase
      <span>.</span><span>from</span><span>(</span><span>&#34;todo&#34;</span><span>)</span>
      <span>.</span><span>insert</span><span>(</span><span>{</span> content<span>,</span> user_id<span>:</span> user<span>.</span>sub <span>}</span><span>)</span><span>;</span>

    <span>setAllTodos</span><span>(</span><span>[</span><span>...</span>todos<span>,</span> resp<span>.</span>data<span>[</span><span>0</span><span>]</span><span>]</span><span>)</span><span>;</span>
    <span>setContent</span><span>(</span><span>&#34;&#34;</span><span>)</span><span>;</span>
  <span>}</span><span>;</span>

  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>
        Welcome </span><span>{</span>user<span>.</span>name<span>}</span><span>!</span><span>{</span><span>&#34; &#34;</span><span>}</span><span>
        </span><span><span><span>&lt;</span><span>Link</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/api/auth/logout<span>&#34;</span></span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;</span>a</span><span>&gt;</span></span><span>Logout</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;/</span><span>Link</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span>form</span> <span>onSubmit</span><span><span>=</span><span>{</span>handleSubmit<span>}</span></span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;</span>input</span> <span>onChange</span><span><span>=</span><span>{</span><span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>setContent</span><span>(</span>e<span>.</span>target<span>.</span>value<span>)</span><span>}</span></span> <span>value</span><span><span>=</span><span>{</span>content<span>}</span></span> <span>/&gt;</span></span><span>
        </span><span><span><span>&lt;</span>button</span><span>&gt;</span></span><span>Add</span><span><span><span>&lt;/</span>button</span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;/</span>form</span><span>&gt;</span></span><span>
      </span><span>{</span>allTodos<span>?.</span>length <span>&gt;</span> <span>0</span> <span>?</span> <span>(</span>
        allTodos<span>.</span><span>map</span><span>(</span><span>(</span><span>todo</span><span>)</span> <span>=&gt;</span> <span><span><span>&lt;</span>p</span> <span>key</span><span><span>=</span><span>{</span>todo<span>.</span>id<span>}</span></span><span>&gt;</span></span><span>{</span>todo<span>.</span>content<span>}</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>)</span>
      <span>)</span> <span>:</span> <span>(</span>
        <span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>You have completed all todos!</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
      <span>)</span><span>}</span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>// exports</span></code></pre><p>Our final component should look something like:</p><pre><code><span>// pages/index.js</span>

<span>import</span> styles <span>from</span> <span>&#34;../styles/Home.module.css&#34;</span><span>;</span>
<span>import</span> <span>{</span> withPageAuthRequired<span>,</span> getSession <span>}</span> <span>from</span> <span>&#34;@auth0/nextjs-auth0&#34;</span><span>;</span>
<span>import</span> <span>{</span> getSupabase <span>}</span> <span>from</span> <span>&#34;../utils/supabase&#34;</span><span>;</span>
<span>import</span> Link <span>from</span> <span>&#34;next/link&#34;</span><span>;</span>
<span>import</span> <span>{</span> useState <span>}</span> <span>from</span> <span>&#34;react&#34;</span><span>;</span>

<span>const</span> <span>Index</span> <span>=</span> <span>(</span><span><span>{</span> user<span>,</span> todos <span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>[</span>content<span>,</span> setContent<span>]</span> <span>=</span> <span>useState</span><span>(</span><span>&#34;&#34;</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span>allTodos<span>,</span> setAllTodos<span>]</span> <span>=</span> <span>useState</span><span>(</span><span>[</span><span>...</span>todos<span>]</span><span>)</span><span>;</span>

  <span>const</span> <span>handleSubmit</span> <span>=</span> <span>async</span> <span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>{</span>
    e<span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span>
    <span>const</span> supabase <span>=</span> <span>getSupabase</span><span>(</span>user<span>.</span>accessToken<span>)</span><span>;</span>
    <span>const</span> resp <span>=</span> <span>await</span> supabase
      <span>.</span><span>from</span><span>(</span><span>&#34;todo&#34;</span><span>)</span>
      <span>.</span><span>insert</span><span>(</span><span>{</span> content<span>,</span> user_id<span>:</span> user<span>.</span>sub <span>}</span><span>)</span><span>;</span>

    <span>setAllTodos</span><span>(</span><span>[</span><span>...</span>todos<span>,</span> resp<span>.</span>data<span>[</span><span>0</span><span>]</span><span>]</span><span>)</span><span>;</span>
    <span>setContent</span><span>(</span><span>&#34;&#34;</span><span>)</span><span>;</span>
  <span>}</span><span>;</span>

  <span>return</span> <span>(</span>
    <span><span><span>&lt;</span>div</span> <span>className</span><span><span>=</span><span>{</span>styles<span>.</span>container<span>}</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>
        Welcome </span><span>{</span>user<span>.</span>name<span>}</span><span>!</span><span>{</span><span>&#34; &#34;</span><span>}</span><span>
        </span><span><span><span>&lt;</span><span>Link</span></span> <span>href</span><span><span>=</span><span>&#34;</span>/api/auth/logout<span>&#34;</span></span><span>&gt;</span></span><span>
          </span><span><span><span>&lt;</span>a</span><span>&gt;</span></span><span>Logout</span><span><span><span>&lt;/</span>a</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;/</span><span>Link</span></span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;</span>form</span> <span>onSubmit</span><span><span>=</span><span>{</span>handleSubmit<span>}</span></span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;</span>input</span> <span>onChange</span><span><span>=</span><span>{</span><span>(</span><span>e</span><span>)</span> <span>=&gt;</span> <span>setContent</span><span>(</span>e<span>.</span>target<span>.</span>value<span>)</span><span>}</span></span> <span>value</span><span><span>=</span><span>{</span>content<span>}</span></span> <span>/&gt;</span></span><span>
        </span><span><span><span>&lt;</span>button</span><span>&gt;</span></span><span>Add</span><span><span><span>&lt;/</span>button</span><span>&gt;</span></span><span>
      </span><span><span><span>&lt;/</span>form</span><span>&gt;</span></span><span>
      </span><span>{</span>allTodos<span>?.</span>length <span>&gt;</span> <span>0</span> <span>?</span> <span>(</span>
        allTodos<span>.</span><span>map</span><span>(</span><span>(</span><span>todo</span><span>)</span> <span>=&gt;</span> <span><span><span>&lt;</span>p</span> <span>key</span><span><span>=</span><span>{</span>todo<span>.</span>id<span>}</span></span><span>&gt;</span></span><span>{</span>todo<span>.</span>content<span>}</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>)</span>
      <span>)</span> <span>:</span> <span>(</span>
        <span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>You have completed all todos!</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
      <span>)</span><span>}</span><span>
    </span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>const</span> getServerSideProps <span>=</span> <span>withPageAuthRequired</span><span>(</span><span>{</span>
  <span>async</span> <span>getServerSideProps</span><span>(</span><span><span>{</span> req<span>,</span> res <span>}</span></span><span>)</span> <span>{</span>
    <span>const</span> <span>{</span>
      user<span>:</span> <span>{</span> accessToken <span>}</span><span>,</span>
    <span>}</span> <span>=</span> <span>await</span> <span>getSession</span><span>(</span>req<span>,</span> res<span>)</span><span>;</span>

    <span>const</span> supabase <span>=</span> <span>getSupabase</span><span>(</span>accessToken<span>)</span><span>;</span>

    <span>const</span> <span>{</span> data<span>:</span> todos <span>}</span> <span>=</span> <span>await</span> supabase<span>.</span><span>from</span><span>(</span><span>&#34;todo&#34;</span><span>)</span><span>.</span><span>select</span><span>(</span><span>&#34;*&#34;</span><span>)</span><span>;</span>

    <span>return</span> <span>{</span>
      props<span>:</span> <span>{</span> todos <span>}</span><span>,</span>
    <span>}</span><span>;</span>
  <span>}</span><span>,</span>
<span>}</span><span>)</span><span>;</span>

<span>export</span> <span>default</span> Index<span>;</span></code></pre><p>We now have an input field above our list of <code>todos</code>. When we enter the <code>content</code> for our todo and click <code>add</code>, a new <code>todo</code> will be inserted into our DB. We are also setting the <code>user_id</code> column to the value of our <code>user<span>.</span>sub</code>, so we know who the <code>todo</code> belongs to.</p><blockquote><p>We&#39;re introducing <code>allTodos</code> so that we can call <code>setAllTodos</code> after insertion of a new <code>todo</code>. It will trigger a partial re-render, displaying the newly inserted <code>todo</code> without a full page refresh.</p></blockquote><p>Awesome! We now have a Next.js application using Auth0 for all things authentication and Supabase with row-level policies for authorization. We learned about JWTs and how to sign our own, as well as writing a Postgres function to lookup values in a JWT in our database.</p><p>If you liked this article, <a href="https://twitter.com/_dijonmusters" target="_blank" rel="noreferrer noopener">follow me on Twitter</a>, <a href="https://www.youtube.com/c/jonmeyers" target="_blank" rel="noreferrer noopener">subscribe to my YouTube channel</a> and <a href="https://jonmeyers.io/" target="_blank" rel="noreferrer noopener">check out my blog</a>.</p><p>For all things Supabase <a href="https://twitter.com/supabase/" target="_blank" rel="noreferrer noopener">follow our Twitter</a>, <a href="https://www.youtube.com/c/supabase" target="_blank" rel="noreferrer noopener">subscribe to our YouTube channel</a> and <a href="https://supabase.io/blog" target="_blank" rel="noreferrer noopener">check out our blog</a>.</p><p>Thanks for reading!</p></div></div>]]></content:encoded>
      <pubDate>Wed, 17 Nov 2021 16:03:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Expands Reach to Mexico with TEC360 Partnership</title>
      <link>https://auth0.com/blog/auth0-expands-reach-to-mexico-with-tec360-partnership/</link>
      <description>Leading LATAM identity providers support Mexico‚Äôs top companies with identity management and security needs</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>BUENOS AIRES, Argentina ‚Äì Nov. 17, 2021</strong> ‚Äì The <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Identity Platform</a>, a product unit within Okta (NASDAQ: OKTA), announced today a new partnership with <a href="http://www.tec360cloud.com/" target="_blank" rel="noreferrer noopener">TEC360</a>, a leading provider of cloud solutions for enterprises in Mexico and Latin America (LATAM). TEC360 is Auth0‚Äôs first partner in Mexico, and together, the two companies are helping enterprises across the region meet their evolving identity management and security goals.</p><p>TEC360 operates in Mexico and LATAM and provides cloud solutions for enterprises‚Äô technological and security needs including customer experience (CX) and employee experience (EX), change management, edge infrastructure, identity management, and internet of things (IoT). The addition of TEC360 to Auth0‚Äôs <a href="https://auth0.com/partners" target="_blank" rel="noreferrer noopener">Partner Program</a> and Auth0‚Äôs growth in the region indicates the growing demand and importance of identity management in securing the new and complex digital world as businesses have to meet the ever-growing expectations for security, privacy, and convenience.</p><p>Globally, the pandemic has <a href="https://auth0.com/blog/how-brick-and-mortar-approaches-improve-digital-experiences/" target="_blank" rel="noreferrer noopener">accelerated digital road maps across industries</a>, and businesses now have to quickly respond to changes in digital expectations and buying patterns ‚Äî and in LATAM the technology penetration has been rapidly growing at an average rate of 65% year-over-year since 2003 (<a href="https://www.atlantico.vc/latin-america-digital-transformation-report" target="_blank" rel="noreferrer noopener">2020 Latin America Digital Transformation Report)</a>, with Mexico as the second-highest country in LATAM, following Brazil. As the number of online identities continue to increase, so do the number of online threats ‚Äî a modern identity platform offers the right balance of convenience, privacy, and security to protect and retain customers.</p><p>‚ÄúAt TEC360, our commitment is to provide enterprise customers with the best cloud solutions that give their organization and customers more choice and flexibility to accelerate growth and innovation,‚Äù said Peter Wiegandt, CEO of TEC360. ‚ÄúIdentity management is a critical part of these projects, and by joining forces with Auth0 we will give our customers in Mexico and throughout LATAM the extensible building blocks to solve for an identity use case without having to compromise between convenience, privacy, or security.‚Äù</p><p>‚ÄúMore than ever, a modern identity solution can help accelerate digital transformation, remove security risks, and positively impact the business through improved user experiences,‚Äù said Ghazi Masood, SVP and General Manager, Americas at Auth0. ‚ÄúWe are proud to join forces with TEC360 to help customers in the region customize identity for their exact use case, enabling them to free up time and resources previously spent on the complexities of identity management to focus more on their core value proposition.‚Äù</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h3 id="Media-Contacts">Media Contacts</h3><p>Global Communications <br/>Auth0 <br/><a href="mailto:press@auth0.com" target="_blank" rel="noreferrer noopener">press@auth0.com</a><br/></p><p>Grupo Muchnik PR for Auth0 <br/><a href="mailto:auth0@muchnik.co" target="_blank" rel="noreferrer noopener">auth0@muchnik.co</a><br/></p><h3 id="Investor-Contact">Investor Contact</h3><p>Investor Relations <br/><a href="mailto:investor@okta.com" target="_blank" rel="noreferrer noopener">investor@okta.com</a><br/></p></div></div>]]></content:encoded>
      <pubDate>Wed, 17 Nov 2021 02:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Build and Secure a simple Symfony API server using Auth0</title>
      <link>https://auth0.com/blog/build-and-secure-a-simple-symfony-api-server-using-auth0/</link>
      <description>Learn how to build a secured Symfony API server using Auth0</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> In this post, you will learn how to build a Symfony API server from scratch. You will also take it a step further to secure some of the endpoints. You&#39;ll use Auth0 to handle authentication and authorization. The complete source code for this tutorial can be found <a href="https://github.com/yemiwebby/symfony-api-server" target="_blank" rel="noreferrer noopener">here on GitHub</a>.</p><h2 id="Prerequisites">Prerequisites</h2><p>To follow along with this tutorial, you should have reasonable knowledge of Object-Oriented Programming in PHP and basic knowledge of building applications with Symfony. You will also need the following:</p><ul><li><a href="https://getcomposer.org/" target="_blank" rel="noreferrer noopener">Composer</a> globally installed on your computer to manage dependencies</li><li><a href="https://symfony.com/download" target="_blank" rel="noreferrer noopener">Symfony CLI</a> installed on your computer. Follow the <a href="https://symfony.com/download" target="_blank" rel="noreferrer noopener">instructions here</a> to set it up for your operating system.</li><li>An Auth0 account. You can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free Auth0 account here</a>.</li><li><a href="https://angular.io/cli" target="_blank" rel="noreferrer noopener">Angular CLI</a> globally installed on your computer. Please note that you don&#39;t have to be proficient in building applications with Angular. It is only required here to test the API that we will build.</li></ul><h2 id="What-You-ll-Build">What You&#39;ll Build</h2><p>You will build a simple Symfony API server with three different endpoints. Each endpoint will return different types of messages depending on the access the user has.</p><h3 id="Public-endpoint">Public endpoint</h3><ul><li><code><span>GET</span> <span>/</span>api<span>/</span>messages<span>/</span><span>public</span></code></li></ul><p>This endpoint should be exposed to anyone unauthorized. It is expected to return the following message:</p><pre><code><span>{</span>
  <span>&#34;message&#34;</span><span>:</span> <span>&#34;The API doesn&#39;t require an access token to share this message.&#34;</span>
<span>}</span></code></pre><h3 id="Protected-endpoint">Protected endpoint</h3><ul><li><code><span>GET</span> <span>/</span>api<span>/</span>messages<span>/</span><span>protected</span></code></li></ul><p>This endpoint will be protected against unauthorized access. Only <strong>authorized users</strong> with a valid access token in their HTTP request header will be able to see the following message:</p><pre><code><span>{</span>
  <span>&#34;message&#34;</span><span>:</span> <span>&#34;The API successfully validated your access token.&#34;</span>
<span>}</span></code></pre><h3 id="Admin-endpoint">Admin endpoint</h3><ul><li><code><span>GET</span> <span>/</span>api<span>/</span>messages<span>/</span>admin</code></li></ul><p>Similar to the protected endpoint, this requires the access token to contain a <code>read<span>:</span>admin<span>-</span>messages</code> permission to access the admin data. This is often referred to as <a href="https://auth0.com/docs/authorization/rbac/" target="_blank" rel="noreferrer noopener">Role-Based Access Control (RBAC)</a>.</p><h2 id="Getting-Started">Getting Started</h2><p>Here you will start building the Symfony API by setting up and installing a new Symfony application and its required dependencies.</p><h3 id="Scaffolding-the-Symfony-application">Scaffolding the Symfony application</h3><p>To begin, open your terminal, navigate to your preferred development directory, and issue the following command to scaffold a new project using <a href="https://getcomposer.org/" target="_blank" rel="noreferrer noopener">Composer</a>:</p><pre><code><span>composer</span> create-project symfony/website-skeleton api-symfony-server</code></pre><p>Once the installation process is completed, switch to the new directory you just created:</p><pre><code><span>cd</span> api-symfony-server

```bash
<span>cp</span> .env .env.local</code></pre><p>This file is ignored by Git as it matches an existing pattern in <code><span>.</span>gitignore</code> (which Symfony generated). One of the benefits of this file is that it helps to store your credentials outside of code to keep them safe.</p><p>Next, update the <code><span>DATABASE_URL</span></code> parameter in <code><span>.</span>env<span>.</span>local</code> so that the app uses an SQLite database instead of the PostgreSQL default. To do that, comment out the existing <code><span>DATABASE_URL</span></code> entry and uncomment the SQLite option so that it matches the example below.</p><pre><code><span>DATABASE_URL</span><span>=</span><span>&#34;sqlite:///%kernel.project_dir%/var/data.db&#34;</span></code></pre><blockquote><p>NOTE: The database will be created in the var directory in the project&#39;s root directory and be named <code>data<span>.</span>db</code>.</p></blockquote><h3 id="Running-the-application">Running the application</h3><p>Make sure you&#39;re in the main project directory and using the <a href="https://symfony.com/download" target="_blank" rel="noreferrer noopener">Symfony CLI</a>, start the application with the following command:</p><pre><code>symfony serve</code></pre><p>Navigate to <a href="http://localhost:8000" target="_blank" rel="noreferrer noopener">http://localhost:8000</a> to view the default homepage of the new Symfony application:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3ZJuxRs46wKcsyxHFWvk1a/1fdc14d3c974eb9d7b1402572cbc595e/01_symfony.jpg" alt="Symfony Homepage"/></p><h2 id="Building-the-API">Building the API</h2><p>In this section, we will focus on creating controllers that will handle the logic for each endpoint mentioned earlier. We will start with the public endpoint and gradually proceed to handle other endpoints.</p><p>Stop the application from running using <code><span>CTRL</span> <span>+</span> <span>C</span></code> and then hit <code>Enter</code></p><h3 id="Create-controllers-and-configure-each-endpoint">Create controllers and configure each endpoint</h3><p>Start by issuing the following command from the terminal within the root directory of your project to create a Controller:</p><pre><code>php bin/console make:controller APIController</code></pre><p>You will see the following output:</p><pre><code> created<span>:</span> src<span>/</span>Controller<span>/</span>APIController<span>.</span>php
 created<span>:</span> templates<span>/</span>api<span>/</span>index<span>.</span>html<span>.</span>twig

  Success<span>!</span>

 Next<span>:</span> Open your <span>new</span> <span>controller</span> <span>class</span> <span>and</span> add some pages<span>!</span></code></pre><p>Locate the newly created controller in <code>src<span>/</span>Controller<span>/</span>APIController<span>.</span>php</code> and update its content with the following:</p><pre><code>// src/Controller/APIController.php
<span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>Controller</span><span>;</span>

<span>use</span> <span>Symfony<span>\</span>Bundle<span>\</span>FrameworkBundle<span>\</span>Controller<span>\</span>AbstractController</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>HttpFoundation<span>\</span>JsonResponse</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>HttpFoundation<span>\</span>Response</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>Routing<span>\</span>Annotation<span>\</span>Route</span><span>;</span>

<span>/**
 * @Route(&#34;/api/messages&#34;)
 */</span>
<span>class</span> <span>APIController</span> <span>extends</span> <span>AbstractController</span>
<span>{</span>
    <span>/**
     * @Route(&#34;/public&#34;, name=&#34;public&#34;)
     */</span>
    <span>public</span> <span>function</span> <span>publicAction</span><span>(</span><span>)</span>
    <span>:</span> <span>JsonResponse</span>
    <span>{</span>
        <span>return</span> <span>$this</span><span>-&gt;</span><span>json</span><span>(</span><span>[</span><span>&#34;message&#34;</span> <span>=&gt;</span> <span>&#34;The API doesn&#39;t require an access token to share this message.&#34;</span><span>]</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_OK</span><span>)</span><span>;</span>
    <span>}</span>

    <span>/**
     * @Route(&#34;/protected&#34;, name=&#34;protected&#34;)
     */</span>
    <span>public</span> <span>function</span> <span>protectedAction</span><span>(</span><span>)</span>
    <span>:</span> <span>JsonResponse</span>
    <span>{</span>
        <span>return</span> <span>$this</span><span>-&gt;</span><span>json</span><span>(</span><span>[</span><span>&#34;message&#34;</span> <span>=&gt;</span> <span>&#34;The API successfully validated your access token.&#34;</span><span>]</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_OK</span><span>)</span><span>;</span>
    <span>}</span>

    <span>/**
     * @Route(&#34;/admin&#34;, name=&#34;admin&#34;)
     */</span>
    <span>public</span> <span>function</span> <span>adminAction</span><span>(</span><span>)</span><span>:</span> <span>JsonResponse</span>
    <span>{</span>
        <span>return</span> <span>$this</span><span>-&gt;</span><span>json</span><span>(</span><span>[</span><span>&#34;message&#34;</span> <span>=&gt;</span> <span>&#34;The API successfully recognized you as an admin.&#34;</span><span>]</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_OK</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>From the snippet above, this controller contains three different methods:</p><ul><li><code><span>publicAction</span><span>(</span><span>)</span></code></li><li><code><span>protectedAction</span><span>(</span><span>)</span></code></li><li><code><span>adminAction</span><span>(</span><span>)</span></code></li></ul><p>Each is designed to handle <code><span>/</span><span>public</span></code>, <code><span>/</span><span>protected</span></code>, and <code><span>/</span>admin</code> endpoints and returns the appropriate messages, respectively.</p><p>Back in the terminal, start the application again with <code>symfony serve</code> and open up an API testing tool such as <a href="https://www.getpostman.com/" target="_blank" rel="noreferrer noopener">Postman</a> to test each endpoint.</p><p>Start with the public endpoint. Create a new GET request to this endpoint <a href="http://localhost:8000/api/messages/public" target="_blank" rel="noreferrer noopener">http://localhost:8000/api/messages/public</a>. You will get the message <code>The <span>API</span> doesn&#39;t require an access token to share <span>this</span> message</code>, as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1EVW07UZTck5Ed6VuLwnCP/d8c9ef7f1e726cbe990eee619ff21b6a/02_symfony.png" alt="Public Endpoint Using Postman"/></p><p>Next, try out the protected endpoint on <a href="http://localhost:8000/api/messages/protected" target="_blank" rel="noreferrer noopener">http://localhost:8000/api/messages/protected</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4rNwtFqz9vDFG208KDCEYL/9d0f71f61e1689397240487559531303/03_symfony.png" alt="Protected Endpoint using Postman"/></p><p>And lastly, the admin endpoint on [<a href="http://localhost:8000/api/messages/admin" target="_blank" rel="noreferrer noopener">http://localhost:8000/api/messages/admin</a>] (<a href="http://localhost:8000/api/messages/admin" target="_blank" rel="noreferrer noopener">http://localhost:8000/api/messages/admin</a>) will give you the message <code>The <span>API</span> successfully recognized you <span>as</span> an admin<span>.</span></code>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7ApYe4u0vxvxjAafSJB4XO/4d5a1fe9f1ed3187c7f076ff06b4638d/04_symfony.png" alt="Admin Endpoint using Postman"/></p><p>At the moment, all the created endpoints can be accessed by anyone. Of course, this is not what we want. You need to ensure that <code><span>/</span><span>protected</span></code> and <code><span>/</span>admin</code> endpoints are exposed to authorized users only. You will start the configuration in the next section.</p><p>If you haven&#39;t yet, make sure you <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">create a free Auth0 account now</a>.</p><h3 id="Securing-protected-and-admin-endpoints">Securing protected and admin endpoints</h3><p>You will use Auth0 to secure the endpoints (protected and admin). To do that, you will need to head back to your <a href="https://manage.auth0.com/dashboard" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a> and configure an API.</p><p>To begin, navigate to <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">the API section of your Auth0 management dashboard</a> by clicking &#34;Applications&#34;&gt; &#34;APIs&#34;. If you have created any APIs before, this will show you the list of all APIs for your account, but for this tutorial, go ahead and click on the <strong>&#34;CREATE API&#34;</strong> button and set up a new one.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3U1zGzKsMkPCD0BzsmsPwq/9ba551bcb9448c3dc5ea6e9118bd7bb7/05_symfony.png" alt="Create New API"/></p><p>Provide a friendly name such as <code>Symfony <span>API</span> Server</code> for the API and set its identifier to <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8000</span></code>. You are free to use any name and identifier, but if you want to follow this tutorial exactly, you should maintain the values above. Leave the signing algorithm as <code><span>RS256</span></code> and click on the <strong>&#34;Create&#34;</strong> button to proceed. You will need the values from here later in the tutorial.</p><h3 id="Install-dependencies-and-configure-authentication">Install dependencies and configure authentication</h3><p>To secure the <code><span>GET</span> <span>/</span>api<span>/</span>messages<span>/</span><span>protected</span></code> and <code><span>GET</span> <span>/</span>api<span>/</span>messages<span>/</span>admin</code> endpoints you will use the JWT authentication bundle for Symfony named <a href="https://github.com/auth0/jwt-auth-bundle" target="_blank" rel="noreferrer noopener">auth0/jwt-auth-bundle</a>.</p><p>Stop the application from running using <code><span>CTRL</span> <span>+</span> <span>C</span></code> and run the following command to install the bundle using composer:</p><pre><code><span>composer</span> require auth0/jwt-auth-bundle:<span>&#34;~4.0&#34;</span></code></pre><p>After installing the bundle in your project, you should find a new file located at <code>config<span>/</span>packages<span>/</span>jwt_auth<span>.</span>yaml</code>. If not, create the file and paste the following content in it:</p><pre><code><span>jwt_auth</span><span>:</span>
  <span>domain</span><span>:</span> <span>&#34;%env(AUTH0_DOMAIN)%&#34;</span>
  <span>client_id</span><span>:</span> <span>&#34;%env(AUTH0_CLIENT_ID)%&#34;</span>
  <span>audience</span><span>:</span> <span>&#34;%env(AUTH0_AUDIENCE)%&#34;</span></code></pre><p>Earlier, when you created an API, Auth0 also automatically created a test application for your API. This will be the Auth0 application that will hold your users. You can find this by clicking <code>Applications</code> &gt; <code>Applications</code>, then selecting the Test Application from the list that matches what you named your API. If you named it the same as in this tutorial, it will be &#34;Symfony API Server (Test Application)&#34;. You can also select and use any other applications for your account. But for this tutorial, click on the test application, and you will see a page as shown here:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3futjuuyRCj6GKwAcZDsCb/6f75f56df649b0c7798afc5444b944fc/06_symfony.jpg" alt="Test Application"/></p><p>Open <code><span>.</span>env<span>.</span>local</code> file and update the values of the environment variables below:</p><pre><code><span>CLIENT_ORIGIN_URL</span><span>=</span>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>4040</span>
<span>AUTH0_AUDIENCE</span><span>=</span>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8000</span>
<span>AUTH0_DOMAIN</span><span>=</span><span>YOUR_AUTH0_DOMAIN</span>
<span>AUTH0_CLIENT_ID</span><span>=</span><span>YOUR_AUTH0_ID</span>
<span>AUTH0_CLIENT_SECRET</span><span>=</span><span>YOUR_AUTH0_CLIENT_SECRET</span></code></pre><p>Ensure to replace <code><span>YOUR_AUTH0_DOMAIN</span></code>, <code><span>YOUR_AUTH0_CLIENT_ID</span></code>, and <code><span>YOUR_AUTH0_CLIENT_SECRET</span></code> placeholders with the appropriate values as obtained from your Auth0 Dashboard.</p><h3 id="Setting-up-User-and-User-provider">Setting up User and User provider</h3><p>Handling authentication and authorization requires Auth0 to be aware of the currently authenticated user. This is the job of a <a href="https://symfony.com/doc/current/security/user_provider.html" target="_blank" rel="noreferrer noopener">User provider</a> in Symfony, as it helps to reload a user from the session and load the user for other specific features like using username or email for authentication.</p><p>If users of our API were stored in the database, creating a custom user provider might not be necessary, but here, we will load users from a custom location (Auth0), hence the need to create one.</p><p>To begin with, navigate to the <code>src</code> folder and create a new folder named <code>Security</code> and within the newly created folder, create another one and call it <code>User</code>. Next, create the user class within the <code>User</code> folder and name it <code>WebServiceUser<span>.</span>php</code>. Open the newly created file and paste the following code into it:</p><pre><code><span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>Security<span>\</span>User</span><span>;</span>

<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>Security<span>\</span>Core<span>\</span>User<span>\</span>EquatableInterface</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>Security<span>\</span>Core<span>\</span>User<span>\</span>UserInterface</span><span>;</span>

<span>class</span> <span>WebServiceUser</span> <span>implements</span>
    <span>UserInterface</span><span>,</span> EquatableInterface <span>{</span>

    <span>private</span> <span>$roles</span><span>;</span>
    <span>private</span> <span>$jwt</span><span>;</span>

    <span>public</span> <span>function</span> <span>__construct</span><span>(</span><span>$jwt</span><span>,</span> <span>$roles</span><span>)</span> <span>{</span>

        <span>$this</span><span>-&gt;</span><span>roles</span> <span>=</span> <span>$roles</span><span>;</span>
        <span>$this</span><span>-&gt;</span><span>jwt</span> <span>=</span> <span>$jwt</span><span>;</span>
    <span>}</span>

    <span>/**
     * @inheritDoc
     */</span>
    <span>public</span> <span>function</span> <span>getRoles</span><span>(</span><span>)</span>
    <span>:</span> <span>array</span> <span>{</span>

        <span>return</span> <span>$this</span><span>-&gt;</span><span>roles</span><span>;</span>
    <span>}</span>

    <span>/**
     * @inheritDoc
     */</span>
    <span>public</span> <span>function</span> <span>getPassword</span><span>(</span><span>)</span>
    <span>:</span> <span>?</span><span>string</span> <span>{</span>

        <span>return</span> <span>null</span><span>;</span>
    <span>}</span>

    <span>/**
     * @inheritDoc
     */</span>
    <span>public</span> <span>function</span> <span>getSalt</span><span>(</span><span>)</span>
    <span>:</span> <span>?</span><span>string</span> <span>{</span>

        <span>return</span> <span>null</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>isEqualTo</span><span>(</span><span>UserInterface</span> <span>$user</span><span>)</span>
    <span>:</span> <span>bool</span> <span>{</span>

        <span>if</span> <span>(</span><span>!</span><span>$user</span> <span>instanceof</span> <span>WebServiceUser</span><span>)</span> <span>{</span>
            <span>return</span> <span>false</span><span>;</span>
        <span>}</span>

        <span>return</span> <span>$this</span><span>-&gt;</span><span>getUsername</span><span>(</span><span>)</span> <span>===</span> <span>$user</span><span>-&gt;</span><span>getUsername</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>/**
     * @inheritDoc
     */</span>
    <span>public</span> <span>function</span> <span>getUsername</span><span>(</span><span>)</span> <span>{</span>

        <span>return</span> <span>$this</span><span>-&gt;</span><span>jwt</span><span>[</span><span>&#34;email&#34;</span><span>]</span> <span>??</span> <span>$this</span><span>-&gt;</span><span>jwt</span><span>[</span><span>&#34;sub&#34;</span><span>]</span><span>;</span>
    <span>}</span>

    <span>/**
     * @inheritDoc
     */</span>
    <span>public</span> <span>function</span> <span>eraseCredentials</span><span>(</span><span>)</span> <span>{</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>getUserIdentifier</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> <span>$this</span><span>-&gt;</span><span>jwt</span><span>[</span><span>&#34;email&#34;</span><span>]</span> <span>??</span> <span>$this</span><span>-&gt;</span><span>jwt</span><span>[</span><span>&#34;sub&#34;</span><span>]</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>Here, the <code>WebServiceUser</code> class implements two different interfaces:</p><ul><li><a href="https://api.symfony.com/4.1/Symfony/Component/Security/Core/User/UserInterface.html" target="_blank" rel="noreferrer noopener">UserInterface</a> ‚Äî represents the interface that all User classes must implement</li><li><a href="https://api.symfony.com/4.1/Symfony/Component/Security/Core/User/EquatableInterface.html" target="_blank" rel="noreferrer noopener">EquatableInterface</a> ‚Äî used to test if two objects are equal in security and re-authentication context</li></ul><p>Next, create a file in the <code>User</code> folder and name it <code>WebServiceAnonymousUser<span>.</span>php</code>. This will return the anonymous user. Use the following content for it:</p><pre><code><span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>Security<span>\</span>User</span><span>;</span>

<span>class</span> <span>WebServiceAnonymousUser</span> <span>extends</span> <span>WebServiceUser</span> <span>{</span>

    <span>public</span> <span>function</span> <span>__construct</span><span>(</span><span>)</span> <span>{</span>

        <span>parent</span><span>::</span><span>__construct</span><span>(</span><span>null</span><span>,</span> <span>[</span><span>&#39;IS_AUTHENTICATED_ANONYMOUSLY&#39;</span><span>]</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>getUsername</span><span>(</span><span>)</span> <span>{</span>

        <span>return</span> <span>null</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>To wrap thing up, create another file within the <code>User</code> folder and name it <code>WebServiceUserProvider<span>.</span>php</code>. Once you are done, paste the following code in it:</p><pre><code><span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>Security<span>\</span>User</span><span>;</span>

<span>use</span> <span>Auth0<span>\</span>JWTAuthBundle<span>\</span>Security<span>\</span>Core<span>\</span>JWTUserProviderInterface</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>Security<span>\</span>Core<span>\</span>Exception<span>\</span>UnsupportedUserException</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>Security<span>\</span>Core<span>\</span>User<span>\</span>UserInterface</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Polyfill<span>\</span>Intl<span>\</span>Icu<span>\</span>Exception<span>\</span>NotImplementedException</span><span>;</span>


<span>class</span> <span>WebServiceUserProvider</span> <span>implements</span> <span>JWTUserProviderInterface</span> <span>{</span>

    <span>public</span> <span>function</span> <span>loadUserByJWT</span><span>(</span><span>$jwt</span><span>)</span>
    <span>:</span> <span>WebServiceUser</span> <span>{</span>
        <span>$data</span> <span>=</span> <span>[</span><span>&#39;sub&#39;</span> <span>=&gt;</span> <span>$jwt</span><span>-&gt;</span><span>sub</span><span>]</span><span>;</span>
        <span>$roles</span> <span>=</span> <span>[</span><span>]</span><span>;</span>
        <span>$roles</span><span>[</span><span>]</span> <span>=</span> <span>&#39;ROLE_OAUTH_AUTHENTICATED&#39;</span><span>;</span>

        <span>return</span> <span>new</span> <span>WebServiceUser</span><span>(</span><span>$data</span><span>,</span> <span>$roles</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>getAnonymousUser</span><span>(</span><span>)</span>
    <span>:</span> <span>WebServiceAnonymousUser</span> <span>{</span>

        <span>return</span> <span>new</span> <span>WebServiceAnonymousUser</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>loadUserByUsername</span><span>(</span><span>$username</span><span>)</span> <span>{</span>

        <span>throw</span> <span>new</span> <span>NotImplementedException</span><span>(</span><span>&#39;method not implemented&#39;</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>refreshUser</span><span>(</span><span>UserInterface</span> <span>$user</span><span>)</span> <span>{</span>

        <span>if</span> <span>(</span><span>!</span><span>$user</span> <span>instanceof</span> <span>WebServiceUser</span><span>)</span> <span>{</span>
            <span>throw</span> <span>new</span> <span>UnsupportedUserException</span><span>(</span>
                <span>sprintf</span><span>(</span><span>&#39;Instances of &#34;%s&#34; are not supported.&#39;</span><span>,</span> <span>get_class</span><span>(</span><span>$user</span><span>)</span><span>)</span>
            <span>)</span><span>;</span>
        <span>}</span>

        <span>return</span> <span>$this</span><span>-&gt;</span><span>loadUserByUsername</span><span>(</span><span>$user</span><span>-&gt;</span><span>getUsername</span><span>(</span><span>)</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>supportsClass</span><span>(</span><span>$class</span><span>)</span>
    <span>:</span> <span>bool</span> <span>{</span>

        <span>return</span> <span>$class</span> <span>===</span> <span>&#39;App\Security\User\WebServiceUser&#39;</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>loadUserByIdentifier</span><span>(</span><span>string</span> <span>$identifier</span><span>)</span>
    <span>{</span>
        <span>throw</span> <span>new</span> <span>NotImplementedException</span><span>(</span><span>&#39;method not implemented&#39;</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>This class implements the <code>JWTUserProviderInterface</code> from the <a href="https://github.com/auth0/jwt-auth-bundle" target="_blank" rel="noreferrer noopener">Auth0 bundle</a> installed earlier, which specifies the important methods that the <code>WebServiceUserProvider</code> class must implement. These methods are:</p><ul><li><code>loadUserByJWT</code>: it receives the decoded JWT Access Token and returns a User.</li><li><code>getAnonymousUser</code>: returns an anonymous user that represents an unauthenticated one (usually represented by the role <code><span>IS_AUTHENTICATED_ANONYMOUSLY</span></code>)</li></ul><h3 id="Creating-a-Guard-Authenticator">Creating a Guard Authenticator</h3><p>Next, we need to create a guard authenticator in Symfony. To do that, create a new file within the <code>src<span>/</span>Security<span>/</span>User</code> folder and name it <code>GuardAuthenticator<span>.</span>php</code>. Open the new file and use the following content for it:</p><pre><code><span><span>&lt;?php</span>


<span>namespace</span> <span>App<span>\</span>Security<span>\</span>User</span><span>;</span>


<span>use</span> <span>Auth0<span>\</span>JWTAuthBundle<span>\</span>Security<span>\</span>Guard<span>\</span>JwtGuardAuthenticator</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>HttpFoundation<span>\</span>JsonResponse</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>HttpFoundation<span>\</span>Request</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>Security<span>\</span>Core<span>\</span>Exception<span>\</span>AuthenticationException</span><span>;</span>

<span>class</span> <span>GuardAuthenticator</span> <span>extends</span> <span>JwtGuardAuthenticator</span>
<span>{</span>
    <span>public</span> <span>function</span> <span>start</span><span>(</span><span>Request</span> <span>$request</span><span>,</span> <span>AuthenticationException</span> <span>$authException</span> <span>=</span> <span>null</span><span>)</span>
    <span>{</span>
        <span>$responseBody</span> <span>=</span> <span>[</span>
            <span>&#39;message&#39;</span> <span>=&gt;</span> <span>&#39;No authorization token was found&#39;</span><span>,</span>
        <span>]</span><span>;</span>

        <span>return</span> <span>new</span> <span>JsonResponse</span><span>(</span><span>$responseBody</span><span>,</span> <span>JsonResponse</span><span>::</span><span>HTTP_UNAUTHORIZED</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>This <code>GuardAuthenticator</code> extends the <code>JwtGuardAuthenticator</code> class from the <code>jwt</code> bundle and checks if an access token is present in an HTTP request header. If not, it returns an appropriate message.</p><h3 id="Configure-the-Security-Provider">Configure the Security Provider</h3><p>Before configuring the security provider, create a service for <code>WebServiceUserProvider</code>. Services are a great way to make your applications easier to maintain and adapt to new requirements. You can create one by adding this code to the bottom of <code>config<span>/</span>services<span>.</span>yaml</code> file:</p><pre><code><span>parameters</span><span>:</span>

<span>services</span><span>:</span>
    <span>...</span>
    <span># üëá  new code starts here</span>
    <span>web_service_user_provider</span><span>:</span>
        <span>class</span><span>:</span> App\Security\User\WebServiceUserProvider
        <span>arguments</span><span>:</span> <span>[</span><span>&#34;@jwt_auth.auth0_service&#34;</span><span>]</span></code></pre><p>Lastly, modify the <code>security<span>.</span>yaml</code> file located in <code>config<span>/</span>packages<span>/</span>security<span>.</span>yaml</code> file such that it contains the following:</p><ul><li>The <code>web_service_user_provider</code> service</li><li>The secured area that you want to authenticate using an access token</li><li>The <code>access_control</code> section with the roles needed for each route
You can replace it completely with the following:</li></ul><pre><code><span>security</span><span>:</span>
  <span>enable_authenticator_manager</span><span>:</span> <span>true</span>

  <span># https://symfony.com/doc/current/security.html#where-do-users-come-from-user-providers</span>
  <span>providers</span><span>:</span>
    <span>#        users_in_memory: { memory: null }</span>
    <span>web_service_user_provider</span><span>:</span>
      <span>id</span><span>:</span> App\Security\User\WebServiceUserProvider
  <span>firewalls</span><span>:</span>
    <span>dev</span><span>:</span>
      <span>pattern</span><span>:</span> ^/(_(profiler<span>|</span>wdt)<span>|</span>css<span>|</span>images<span>|</span>js)/
      <span>security</span><span>:</span> <span>false</span>
    <span>secured_area</span><span>:</span>
      <span>pattern</span><span>:</span> ^/api
      <span>stateless</span><span>:</span> <span>true</span>
      <span>guard</span><span>:</span>
        <span>authenticators</span><span>:</span>
          <span>id</span><span>:</span> App\Security\User\GuardAuthenticator
      <span>provider</span><span>:</span> web_service_user_provider
  <span># Easy way to control access for large sections of your site</span>
  <span># Note: Only the *first* access control that matches will be used</span>
  <span>access_control</span><span>:</span>
    <span>-</span> <span>{</span> <span>path</span><span>:</span> ^/api/messages/public<span>,</span> <span>roles</span><span>:</span> PUBLIC_ACCESS <span>}</span>
    <span>-</span> <span>{</span> <span>path</span><span>:</span> ^/api/messages/protected<span>,</span> <span>roles</span><span>:</span> ROLE_OAUTH_AUTHENTICATED <span>}</span>
    <span>-</span> <span>{</span> <span>path</span><span>:</span> ^/api/messages/admin<span>,</span> <span>roles</span><span>:</span> ROLE_OAUTH_AUTHENTICATED <span>}</span></code></pre><p>Now, you can test this again with Postman by accessing the protected route. Start the application by running <code>symfony serve</code> and access <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8000</span><span>/</span>api<span>/</span>messages<span>/</span><span>protected</span></code>. You will receive a message indicating that &#34;No authorization token was found&#34; as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/W8OEoQQABuZQWnZpoGeCs/d66c3fa6067de9bef86f882cd86d2156/07_symfony.png" alt="No token found"/></p><p>This is because you need an access token to successfully retrieve contents from the <code><span>/</span><span>protected</span></code> endpoint.</p><p>Generating an access token on the fly will require your client application to get authorized by Auth0, but as a proof of concept, for now, you will obtain and use a test token for your API from the Auth0 Dashboard. To do this, navigate to the <a href="https://manage.auth0.com/dashboard/#/apis" target="_blank" rel="noreferrer noopener">API section in your Auth0 Dashboard</a> and click on the API that you created earlier. Next, click on the <code>Test</code> tab and scroll down to copy the <code>access_token</code> shown under the <strong>Response</strong> subtitle.</p><p>Open up Postman again and select <code>Bearer Token</code> from the <strong>Authorization</strong> tab and then paste the Access Token:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Qa1yYH7IZNXpzKAAdWOKZ/be0b70f9356f9772599c7abe515dde03/08_symfony.png" alt="Bearer Token"/></p><p>Now you can try out the protected <code>api<span>/</span>messages<span>/</span><span>protected</span></code> endpoint, and you&#39;ll get the message <code>The <span>API</span> successfully validated your access token<span>.</span></code>, as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7ia6ftq19laFNCTQxPsuEm/9abc397335a2005c37170afb5670cb1d/09_symfony.png" alt="Protected Endpoint Response"/></p><h2 id="Implementing-Role-Based-Access-Control-for-the-API">Implementing Role-Based Access Control for the API</h2><p>As mentioned earlier, the <code><span>GET</span> <span>/</span>api<span>/</span>messages<span>/</span>admin</code> endpoint requires the access token to contain a <code>read<span>:</span>admin<span>-</span>messages</code> permission to access the admin data. This is often referred to as <a href="https://auth0.com/docs/authorization/rbac/" target="_blank" rel="noreferrer noopener">Role-Based Access Control (RBAC)</a>, where permissions have to be assigned to users based on their role within an organization.</p><p>In this section, to implement and configure this access control, you will do the following:</p><ul><li>Enable RBAC (Role-Based Access Control) Settings within your Auth0 Dashboard</li><li>Create an <code>admin</code> role within the Dashboard</li><li>Create specific permission. <code>read<span>:</span>admin<span>-</span>messages</code> to be precise.</li><li>Add the newly created permission to the <code>admin</code> role.</li><li>Assign the new role to a particular user</li></ul><h3 id="Enable-RBAC-Settings">Enable RBAC Settings</h3><p>For role-based access control (RBAC) to work properly, you must enable it for your API using either the Dashboard or the <a href="https://auth0.com/docs/api/management/v2" target="_blank" rel="noreferrer noopener">Management API</a>.</p><p>Navigate to your Auth0 Dashboard and click on APIs, then select the API created earlier <code>Symfony <span>API</span> Server</code>, and scroll down to the <strong>RBAC Settings</strong> section:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/50vg4Z7jVryiHpYPAejaNq/6bd3f21c3a44cfa4b8eaed123df54760/10_symfony.png" alt="RBAC Settings"/></p><p>Enable RBAC by toggling both buttons here: &#34;Enable RBAC&#34; and &#34;Add Permissions in the Access Token&#34;. This will enforce role-based access control authorization policies for any endpoint of choice and ensure that the <code>permissions</code> claim is added to the access token. Click on the <strong>Save</strong> button to update the changes.</p><h3 id="Create-an-Admin-Role">Create an Admin Role</h3><p>You can create <a href="https://auth0.com/docs/authorization/rbac" target="_blank" rel="noreferrer noopener">roles</a> using Auth0&#39;s Dashboard or the Management API. The roles can be used with the <a href="https://auth0.com/docs/authorization/rbac/auth-core-features" target="_blank" rel="noreferrer noopener">API Authorization Core feature set</a>.</p><p>Go to the following:</p><ul><li><a href="https://manage.auth0.com/dashboard" target="_blank" rel="noreferrer noopener">Dashboard</a></li><li>Click on <strong>User Management</strong> from the side menu bar</li><li>Click on <a href="https://manage.auth0.com/#/roles" target="_blank" rel="noreferrer noopener">Roles</a></li><li>Next, click on the <strong>Create role</strong> button</li></ul><p>Give the role a name, such as &#34;Admin&#34; and add a description, such as &#34;Read all admin messages&#34;:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6flmQaBc2CZhz6Qv0rfFlL/55641a0338d351a75ba27001e9002122/11_symfony.png" alt="Create New Role"/></p><h3 id="Create-permissions">Create permissions</h3><p>Go back to the <code>Symfony <span>API</span> Server</code> page from the API menu in the dashboard, and click on the &#34;Permissions&#34; tab from the same page to define permission and its scope.</p><p>Under &#34;Permission (Scope), paste <code>read<span>:</span>admin<span>-</span>messages</code>. For &#34;Description&#34;, put &#34;Read admin messages&#34;. Make sure you click &#34;Add&#34; to save the permission.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6aqPdSpcjKwpgw8JsXmKUm/8edbf0ada35c1f0c93e2453fd6d3d592/12_symfony.png" alt="Create Permission"/></p><h3 id="Add-permissions-to-roles">Add permissions to roles</h3><p>Now that you have created the <code>Admin</code> role and its corresponding permission, the next thing to do is to add the permission to the newly created role.</p><p>Go back to the &#34;Roles&#34; page in &#34;User Management&#34;&gt; &#34;Roles&#34;.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/63t7lSYYZ9brPwZ4AwnUIi/c3c65755cc2be2b7c1002af967f2b64d/13_symfony.png" alt="List of Roles"/></p><p>Click on the Admin role that you created earlier, and then click on the Permissions tab. Now click on the <strong>Add Permissions</strong> button. You will see a page like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6UWjqagHeVrmhZzPsgWNrg/02528dd102b21ca9d77b005f319f76be/14_symfony.png" alt="Add Permission"/></p><p>Select the API from the list; in our case, that would be <code>Symfony <span>API</span> Server</code>. Check the box next <code>read<span>:</span>admin<span>-</span>messages</code> to indicate the permission for the Admin role. Finally, click on the <strong>Add Permissions</strong> to save the changes.</p><h3 id="Assign-roles-to-users">Assign roles to users</h3><p>There are two ways to assign a role to a user. You can choose a user from the <strong>Users</strong> list and then assign a role, or you can go to the <strong>User Details</strong> (user profile) page for an individual user and choose a role to assign in the <strong>Roles</strong> tab. You will stick with the Users list in this tutorial.</p><p>To do that:</p><ol start="1"><li>Go to <a href="https://manage.auth0.com/#/users" target="_blank" rel="noreferrer noopener">Dashboard &gt; User Management &gt; Users</a>.</li><li>Click &#34;<strong>...</strong>&#34; next to the user you want to modify, and select <strong>Assign Roles</strong>.</li><li>Choose the role (s) you wish to assign, then click <strong>Assign</strong></li></ol><p><img src="https://images.ctfassets.net/23aumh6u8s0i/26wQrwLBmhjIRzggtIEHIb/ccf3b5ab7dd160e97c75b25b8bee0cb7/15_symfony.png" alt="Assign Role to User"/></p><h2 id="Updating-Web-Service-User-Provider">Updating Web Service User Provider</h2><p>At this point, once a user is authenticated via the API, the <code>access token</code> that will be returned will either contain a <code>read<span>:</span>admin<span>-</span>messages</code> permission or not. To check for this permission before allowing the user to access admin data, you will update the <code>src<span>/</span>Security<span>/</span>User<span>/</span>WebServiceUserProvider<span>.</span>php</code> file as shown below:</p><pre><code><span>...</span>
<span>class</span> <span>WebServiceUserProvider</span> <span>implements</span> <span>JWTUserProviderInterface</span> <span>{</span>

    <span>public</span> <span>function</span> <span>loadUserByJWT</span><span>(</span><span>$jwt</span><span>)</span>
    <span>:</span> <span>WebServiceUser</span> <span>{</span>
        <span>$data</span> <span>=</span> <span>[</span><span>&#39;sub&#39;</span> <span>=&gt;</span> <span>$jwt</span><span>-&gt;</span><span>sub</span><span>]</span><span>;</span>
        <span>$roles</span> <span>=</span> <span>[</span><span>]</span><span>;</span>
        <span>$roles</span><span>[</span><span>]</span> <span>=</span> <span>in_array</span><span>(</span><span>&#39;read:admin-messages&#39;</span><span>,</span> <span>$jwt</span><span>-&gt;</span><span>permissions</span><span>)</span> <span>?</span> <span>&#39;ROLE_ADMIN&#39;</span> <span>:</span> <span>&#39;ROLE_OAUTH_AUTHENTICATED&#39;</span><span>;</span>

        <span>return</span> <span>new</span> <span>WebServiceUser</span><span>(</span><span>$data</span><span>,</span> <span>$roles</span><span>)</span><span>;</span>
    <span>}</span>
    <span>...</span>
<span>}</span></code></pre><p>Here, you checked if the <code>read<span>:</span>admin<span>-</span>messages</code> is present in the permissions array or not. If present, then a role of a <code><span>ROLE_ADMIN</span></code> will be assigned to the authenticated user. Otherwise, a role of <code><span>ROLE_OAUTH_AUTHENTICATED</span></code> would be assigned.</p><p>Also, open <code>config<span>/</span>packages<span>/</span>security<span>.</span>yaml</code> and update its content as shown here:</p><pre><code><span>security</span><span>:</span>
  <span>enable_authenticator_manager</span><span>:</span> <span>true</span>

  <span># https://symfony.com/doc/current/security.html#where-do-users-come-from-user-providers</span>
  <span>providers</span><span>:</span>
    <span>#        users_in_memory: { memory: null }</span>
    <span>web_service_user_provider</span><span>:</span>
      <span>id</span><span>:</span> App\Security\User\WebServiceUserProvider
  <span>firewalls</span><span>:</span>
    <span>dev</span><span>:</span>
      <span>pattern</span><span>:</span> ^/(_(profiler<span>|</span>wdt)<span>|</span>css<span>|</span>images<span>|</span>js)/
      <span>security</span><span>:</span> <span>false</span>
    <span>secured_area</span><span>:</span>
      <span>pattern</span><span>:</span> ^/api
      <span>stateless</span><span>:</span> <span>true</span>
      <span>guard</span><span>:</span>
        <span>authenticators</span><span>:</span>
          <span>id</span><span>:</span> App\Security\User\GuardAuthenticator
      <span>provider</span><span>:</span> web_service_user_provider
  <span>role_hierarchy</span><span>:</span>
    <span>ROLE_ADMIN</span><span>:</span> <span>[</span>ROLE_OAUTH_AUTHENTICATED<span>,</span> ROLE_ALLOWED_TO_SWITCH<span>]</span>
  <span># Easy way to control access for large sections of your site</span>
  <span># Note: Only the *first* access control that matches will be used</span>
  <span>access_control</span><span>:</span>
    <span>-</span> <span>{</span> <span>path</span><span>:</span> ^/api/messages/public<span>,</span> <span>roles</span><span>:</span> PUBLIC_ACCESS <span>}</span>
    <span>-</span> <span>{</span> <span>path</span><span>:</span> ^/api/messages/protected<span>,</span> <span>roles</span><span>:</span> ROLE_OAUTH_AUTHENTICATED <span>}</span>
    <span>-</span> <span>{</span> <span>path</span><span>:</span> ^/api/messages/admin<span>,</span> <span>roles</span><span>:</span> ROLE_ADMIN <span>}</span></code></pre><p>From the snippet above, you updated the role for the <code>api<span>/</span>messages<span>/</span>admin</code> endpoint.</p><h2 id="Creating-an-event-subscriber">Creating an event subscriber</h2><p>Once an unauthorized user tries to access any of the <code><span>/</span>api<span>/</span>messages<span>/</span>admin</code> endpoints without the appropriate permission, an exception will be thrown, indicating that such access is forbidden.</p><p>In this section, you will create an event subscriber that will listen to the forbidden event and return an appropriate message. To do that, create a folder named <code>EventSubscriber</code> within the <code>src</code> directory, and then create a new file named <code>ExceptionSubscriber<span>.</span>php</code> within it. Open the newly created file and use the following content for it:</p><pre><code><span><span>&lt;?php</span>

<span>namespace</span> <span>App<span>\</span>EventSubscriber</span><span>;</span>

<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>EventDispatcher<span>\</span>EventSubscriberInterface</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>HttpKernel<span>\</span>Event<span>\</span>ExceptionEvent</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>HttpKernel<span>\</span>Exception<span>\</span>AccessDeniedHttpException</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>HttpKernel<span>\</span>KernelEvents</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>HttpFoundation<span>\</span>JsonResponse</span><span>;</span>
<span>use</span> <span>Symfony<span>\</span>Component<span>\</span>HttpFoundation<span>\</span>Response</span><span>;</span>

<span>class</span> <span>ExceptionSubscriber</span> <span>implements</span> <span>EventSubscriberInterface</span>
<span>{</span>
    <span>public</span> <span>static</span> <span>function</span> <span>getSubscribedEvents</span><span>(</span><span>)</span>
    <span>{</span>
        <span>return</span> <span>[</span>
            <span>KernelEvents</span><span>::</span><span>EXCEPTION</span> <span>=&gt;</span> <span>[</span><span>&#39;onKernelException&#39;</span><span>]</span>
        <span>]</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>function</span> <span>onKernelException</span><span>(</span><span>ExceptionEvent</span> <span>$event</span><span>)</span>
    <span>{</span>
        <span>$exception</span> <span>=</span> <span>$event</span><span>-&gt;</span><span>getThrowable</span><span>(</span><span>)</span><span>;</span>
        <span>if</span> <span>(</span><span>$exception</span> <span>instanceof</span> <span>AccessDeniedHttpException</span><span>)</span> <span>{</span>
            <span>$event</span><span>-&gt;</span><span>setResponse</span><span>(</span><span>new</span> <span>JsonResponse</span><span>(</span><span>[</span>
                <span>&#39;message&#39;</span> <span>=&gt;</span> <span>&#34;Insufficient scopes.&#34;</span><span>,</span>
            <span>]</span><span>,</span> <span>Response</span><span>::</span><span>HTTP_UNAUTHORIZED</span><span>)</span><span>)</span><span>;</span>
            <span>$event</span><span>-&gt;</span><span>stopPropagation</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
        <span>return</span> <span>$exception</span><span>;</span>
    <span>}</span>
<span>}</span></span></code></pre><p>With all the required changes made, run the API server by issuing the following command:</p><pre><code>symfony serve</code></pre><h2 id="Testing-the-Admin-Endpoint">Testing the Admin Endpoint</h2><p>As mentioned, unlike other endpoints created so far, the <code><span>GET</span> <span>/</span>api<span>/</span>messages<span>/</span>admin</code> endpoint requires that the access token contains the <code>read<span>:</span>admin<span>-</span>messages</code> permission. Since it&#39;s a bit difficult and not advisable to manipulate the access token from the Machine-to-Machine application on the Auth0 Dashboard, we will take a different approach and use a client application to simulate and test the client-server interaction.</p><p>This is the best way, for now, to ensure that we have an interface for users to:</p><ul><li>Log in and Logout</li><li>Retrieve user profile information</li><li>Protect application routes</li><li>Make secure calls to an API</li></ul><blockquote><p>Note: Feel free to use your client app, if any, for this process.</p></blockquote><p>To use a pre-built client app, issue the following command from the terminal to clone the app from GitHub:</p><pre><code><span>git</span> clone https://github.com/auth0-sample-gallery/spa_angular_typescript_hello-world.git hello-world-demo</code></pre><p>This will clone the demo application within a new folder named <code>hello<span>-</span>world<span>-</span>demo</code> in your development directory.</p><p>Before installing the project&#39;s dependencies, ensure that you have <a href="https://angular.io/cli" target="_blank" rel="noreferrer noopener">Angular CLI</a> installed. You can verify by issuing this command from the terminal on your system.</p><pre><code>ng --version</code></pre><p>The output will be the details of the current version of Angular CLI that you have installed on your system. If not installed, follow the instructions <a href="https://github.com/angular/angular-cli" target="_blank" rel="noreferrer noopener">here to configure Angular CLI globally</a>.</p><p>Move into the new project&#39;s folder and issue the following command to install the required dependencies:</p><pre><code>// Change directory
<span>cd</span> hello-world-demo

// Install dependencies
<span>npm</span> <span>install</span></code></pre><p>The starter project uses a custom stylesheet to style and layout the application, so you don&#39;t have to make any changes.</p><h3 id="Connect-client-application-to-Auth0">Connect client application to Auth0</h3><p>Next, you need to connect this application to Auth0. Back in your Auth0 dashboard, click on &#34;Applications&#34; &gt; &#34;Applications&#34; &gt; &#34;Create Application&#34;.</p><p>Give it a name like &#34;Angular Symfony App&#34; and select &#34;Single Page Web Applications&#34; for the application name. Finally, click &#34;Create&#34;.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3oAEPM8mTPAzkwMbXsiMNT/68c9e03567ccabda8065f38804bf0bf4/16_symfony.png" alt="Auth0"/></p><p>The Angular demo application will redirect users to the Auth0 Login page whenever an authentication request is made. Auth0 will then redirect back with the necessary credentials.</p><p>For that redirection to happen securely, you must specify the URL to which Auth0 can redirect once it validates a user&#39;s credentials. Back in the <a href="https://manage.auth0.com/#/applications" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a>, select the application created for your API, click on the <strong>Settings</strong> tab on that page, and scroll down to locate the following fields:</p><ul><li><strong>Allowed Callback URLs</strong></li><li><strong>Allowed Web Origins</strong></li><li><strong>Allowed Logout URLs</strong></li></ul><p>Use <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>4040</span></code> as the value for each of the fields because the Client application will be accessible on that URL during development. Click on the <strong>Save Changes</strong> to proceed.</p><p>With the URLs properly specified, connect the client application with Auth0 by creating a new file named <code>env<span>.</span>json</code> in the root directory of the client application and populating it as shown here:</p><pre><code><span>{</span>
  <span>&#34;domain&#34;</span><span>:</span> <span>&#34;YOUR_AUTH0_DOMAIN&#34;</span><span>,</span>
  <span>&#34;clientId&#34;</span><span>:</span> <span>&#34;YOUR_AUTH0_CLIENT_ID&#34;</span><span>,</span>
  <span>&#34;audience&#34;</span><span>:</span> <span>&#34;http://localhost:8000&#34;</span><span>,</span>
  <span>&#34;apiServerUrl&#34;</span><span>:</span> <span>&#34;http://localhost:8000&#34;</span>
<span>}</span></code></pre><p>Make sure you fill in &#34;Domain&#34; and &#34;Client ID&#34; with your values from the Application page in the <a href="https://manage.auth0.com/dashboard/#/applications" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a>.
Now, go ahead and run the application using the following command:</p><pre><code>ng serve</code></pre><p>Navigate to <a href="http://localhost:4040" target="_blank" rel="noreferrer noopener">http://localhost:4040</a> to access the application.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2cBS41pGxIJyUGUQcMXMgU/4eca3d53388a6a963d43daf5af8b6a61/17_symfony.jpg" alt="Angular Demo App Page"/></p><h3 id="Enable-communication-between-the-client-application-and-Symfony-API-Server">Enable communication between the client application and Symfony API Server</h3><p>By default, browsers have security measures that disable interaction and sharing of resources between applications of different domains unless it is explicitly allowed by any of the applications. This means that sending HTTP requests from the client application to the Symfony API will be disabled at the moment. To enable communication between both apps, you will need to enable <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noreferrer noopener">CORS (Cross-Origin Resource Sharing)</a>.</p><p>To enable the Symfony API, you will need to use <a href="https://github.com/nelmio/NelmioCorsBundle" target="_blank" rel="noreferrer noopener">the Nelmo Bundle</a>. Run the following command to install it:</p><pre><code><span>composer</span> require nelmio/cors-bundle</code></pre><p>Once the installation process is completed, a default configuration file named <code>nelmio_cors<span>.</span>yaml</code> will be generated in the <code>config<span>/</span>packages</code> folder as shown here:</p><pre><code><span>nelmio_cors</span><span>:</span>
  <span>defaults</span><span>:</span>
    <span>origin_regex</span><span>:</span> <span>true</span>
    <span>allow_origin</span><span>:</span> <span>[</span><span>&#34;%env(CORS_ALLOW_ORIGIN)%&#34;</span><span>]</span>
    <span>allow_methods</span><span>:</span> <span>[</span><span>&#34;GET&#34;</span><span>,</span> <span>&#34;OPTIONS&#34;</span><span>,</span> <span>&#34;POST&#34;</span><span>,</span> <span>&#34;PUT&#34;</span><span>,</span> <span>&#34;PATCH&#34;</span><span>,</span> <span>&#34;DELETE&#34;</span><span>]</span>
    <span>allow_headers</span><span>:</span> <span>[</span><span>&#34;Content-Type&#34;</span><span>,</span> <span>&#34;Authorization&#34;</span><span>]</span>
    <span>expose_headers</span><span>:</span> <span>[</span><span>&#34;Link&#34;</span><span>]</span>
    <span>max_age</span><span>:</span> <span>3600</span>
  <span>paths</span><span>:</span>
    <span>&#34;^/&#34;</span><span>:</span> <span>null</span></code></pre><p>The default configuration specified here would suffice as it stated all the appropriate HTTP verbs. Next, navigate to the <code><span>.</span>env<span>.</span>local</code> file and update its content as shown below:</p><pre><code><span>####&gt; nelmio/cors-bundle ###</span>
<span>CORS_ALLOW_ORIGIN</span><span>=</span><span>&#39;^https?://(localhost|127\.0\.0\.1)(:[0-9]+)?$&#39;</span>
<span>####&lt; nelmio/cors-bundle ###</span></code></pre><p>Here, we specified that the localhost URL should be allowed.</p><p>Finally, start the Symfony server with:</p><pre><code>    symfony serve</code></pre><p>In <a href="http://localhost:4040/" target="_blank" rel="noreferrer noopener">the client application</a>, click on the <strong>External API</strong> button and provide your credentials.</p><p>Ensure that you log in with the details of the user with the Admin role as specified on the Auth0 Dashboard.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/nNt6mUe39bjuTfEDiwuAo/bb8fa2ef904d49e6125d4828fb207b1f/18_symfony.jpg" alt="View Admin Endpoint Response"/></p><p>You can also check the other endpoints by clicking on the <strong>PUBLIC</strong> button for <code>api<span>/</span>messages<span>/</span><span>public</span></code> endpoint or the <strong>PROTECTED</strong> button for <code>api<span>/</span>messages<span>/</span><span>protected</span></code> endpoints as shown, respectively, below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/76DV9IFOvfN4ooG4LBN9jA/87b9f808382f8123d0f7df62be9937ca/19_symfony.jpg" alt="View Public Endpoint Response"/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5wnSvLgIC97PwmPTALoqtj/cf71f3c4299cecdc3b888b6e82812370/20_symfony.jpg" alt="View Protected Endpoint Response"/></p><h2 id="Conclusion">Conclusion</h2><p>As shown here in this tutorial, you learned how to easily build a Symfony API server with an endpoint that can be accessed by anyone on the internet without authentication and other endpoints that require the appropriate authorization and role.</p><p>You created these endpoints successionally by starting with the public endpoint and going further to create two protected endpoints, namely private and admin. To completely set up and configure authentication and authorization for the protected endpoints, you leveraged Auth0&#39;s API to ensure that only HTTP requests that contain the valid access token in their authorization header can retrieve data.</p><p>I hope that you found this tutorial helpful. The complete source code for the API server built in this post can be found <a href="https://github.com/yemiwebby/symfony-api-server" target="_blank" rel="noreferrer noopener">here on GitHub</a>.</p><p>Happy coding, and please feel free to share your thoughts and questions in the comment section below.</p></div></div>]]></content:encoded>
      <author>Obtain a token and authorize the test application</author>
      <pubDate>Tue, 16 Nov 2021 15:36:00 +0000</pubDate>
    </item>
    <item>
      <title>Why Auth0 ‚ÄúShifted Left‚Äù with Azure</title>
      <link>https://auth0.com/blog/why-auth0-shifted-left-with-azure/</link>
      <description>How we expanded customer choice while building a security-first architecture.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Choice is good. We like it when our supermarket shelves are stocked with hundreds of varieties of breakfast cereal. We pick the smartphones we use and the cars we drive. The same should be true for businesses and the technologies they use.</p><p>Today, we brought the Auth0 Identity Platform to Microsoft Azure, giving our private cloud customers the ability to pick the right infrastructure provider for their needs.</p><p>This means a greater selection of regions. Microsoft currently operates in over 60 regions around the world, making it easier to comply with data residency and sovereignty requirements.</p><p>And if you‚Äôre already running your app on Azure‚Äôs cloud servers, you‚Äôll benefit from a converged infrastructure, with every component running on the same underlying cloud platform.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3LjSNS6Motv1nFGNKkIQn/3f9353b41dd9653536e2e9b9f664689a/72798-Auth0_AzureMap-D2-02-01.jpg" alt="Azure"/></p><h2 id="Shifting-Security-Left-on-Microsoft-Azure">Shifting Security Left on Microsoft Azure</h2><p>We‚Äôre equally excited to tell you about the development process. Auth0 has always prioritized security. Last year, we took this a step further with the adoption of ‚ÄúShift-Left‚Äù principles. This puts security-related tasks at the start of the Software Development Life Cycle (SDLC), making it easier to build a stronger, more resilient product.</p><p>We remained true to these principles when building the Auth0 Identity Platform for Microsoft Azure, and are thrilled with the end result. The final product is one that reflects our <strong>Secure by Design</strong> philosophy and faithfully adheres to industry best practices.</p><p>Let‚Äôs talk about what ‚ÄúShift-Left‚Äù means. This is an established term in the software development sphere, and refers to a variety of domains, both security-related and otherwise. In short, you take something that would typically happen at the end of the development lifecycle and tackle it at the beginning. Test-driven development (TDD) is a notable example.</p><p>As Auth0‚Äôs CISO Jameeka Aaron said: ‚ÄúNobody wants their CISO to show up at the last minute with 800 vulnerabilities to be fixed before release.‚Äù Our security engineering team looks for vulnerabilities during the design and development phases, and remediates issues early on to prevent a last-minute crunch, or worse, having to rework the design.</p><p>At Auth0, our Shift-Left process tackles both the human and technical elements of secure software development. All code must meet strict security requirements and is constantly tested against sophisticated static analysis benchmarks.</p><p>We also provide all developers with secure coding training, with some designated as ‚Äúsecurity champions.‚Äù These employees act as liaisons between the engineering and our dedicated platform security teams. They also receive additional training to act as security advocates within their teams.</p><h2 id="Security-First-Architecture">Security First Architecture</h2><p>As we developed the Auth0 Identity Platform for Microsoft Azure, we emphasized ‚Äúshift-left‚Äù principles and focused on building a strong security architecture at the start of the development cycle.</p><p>We established a dedicated Azure AD tenant and automated governance controls to support resource and identity isolation, required MFA and Azure PIM for privileged access, and enforced security standards with Azure Policy. Prioritizing security in the early stages of the development process is part of our Secure by Design strategy to mitigate risk and keep customers safe from cyberthreats.</p><p>The Security Engineering team is also responsible for Azure customer account provisioning and management. In Azure, these are called subscriptions. These are used to isolate private cloud environments and all the associated provisioned resources, like VMs, data storage, and more.</p><p>We built a new service for managing Azure subscriptions, and it is integrated directly into our platform infrastructure workflows. This helped to automate how we manage our Azure Private Cloud environments and dramatically improved environment creation time. This was another part of our Azure governance to keep customer environments isolated and secure.</p><h2 id="Cloudflare-on-the-Edge">Cloudflare on the Edge</h2><p>To help protect against network-based attacks, the Auth0 Identity Platform uses Cloudflare ‚Äî a popular reverse proxy and content delivery network (CDN) product.</p><p>Cloudflare acts as a gateway between the application and the outside world. The service proactively analyzes all inbound traffic, and blocks things that could harm the smooth functioning of the Azure instance, including malicious bots and DDoS attacks. Further protection comes from its customizable rate limiting and firewall rules.</p><p>This means a better, more reliable service for your users. It also comes with some significant performance advantages, too. With Cloudflare&#39;s CDN, static assets (like images and scripts) are hosted close to the user, thereby reducing load times. Traffic is routed through Cloudflare&#39;s Anycast network, which consists of over 250 locations in 100 countries, and provides greater resiliency and latencies below 50ms.</p><h2 id="Detection---Response">Detection &amp; Response</h2><p>In the hands of an IT engineer, security professional, or developer, logs are a powerful tool. They&#39;re the first place you look when remediating a fiendishly tricky problem, or trying to identify an attempted intrusion.</p><p>When building the Auth0 Identity Platform for Microsoft Azure, we wanted to make it easy to audit and monitor. Logging is enabled by default on all Azure instances, as well as with the back-end databases. By default, we retain logs for 13 months.</p><p>Each Azure environment is covered by Auth0&#39;s host monitoring agents. This monitors the security, performance, configuration and state of each host. We also enabled Azure Security Center &amp; Defender by default, further bolstering our security monitoring capabilities.</p><h2 id="Disaster-Recovery">Disaster Recovery</h2><p>Identity is fundamental to business. Your CIAM system is the gateway between your application and its users. You can‚Äôt afford significant downtime. With this in mind, we spent a lot of time thinking about resilience when designing the Auth0 Identity Platform for Microsoft Azure.</p><p>All services are provisioned across three Availability Zones (AZ). In the case of an AZ failure, service are designed to automatically resume in one of the other healthy AZs. Backups are captured every six hours and securely retained in the same region as the deployment, and we can restore an instance from the last snapshot in four hours.</p><h2 id="Azure-s-Solid-Foundations">Azure‚Äôs Solid Foundations</h2><p>Let‚Äôs wrap up by talking about Microsoft Azure itself. After all, what‚Äôs the point in building a secure platform if the underlying infrastructure isn‚Äôt up to standard?</p><p>Fortunately, there‚Äôs no such concerns here. We have come to appreciate the security features and tools within the underlying Azure platform and ecosystem. Microsoft also has the right mindset. The Azure access control best practices urge users to regard identity as the primary security perimeter. This reflects the changes in enterprise IT, particularly the rise of BYOD and cloud computing, which make it harder to build watertight network defenses.</p><p>Identity is the best way to protect your most important data. Well-defined permissions can limit the impact of a security breach, while using MFA and SSO can help prevent an account being compromised in the first place. To find out how the Auth0 Identity Platform on Microsoft Azure can benefit your organization, <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">click here</a>.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 15 Nov 2021 16:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Spring Cloud Streams with Apache Kafka</title>
      <link>https://auth0.com/blog/spring-cloud-streams-with-apache-kafka/</link>
      <description>Learn how to process streams of data from Apache Kafka topics using Spring Cloud Streams</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> Have you ever wondered how features like Google Maps&#39; live traffic work? These systems have to gather and process data in real-time. The architecture of these systems generally involves a data pipeline that processes and transfers data to be processed further until it reaches the clients. In this article, we will see something similar with a simple example using Kafka Streams. The sample app can be found <a href="https://github.com/auth0-blog/spring-cloud-stream-sample" target="_blank" rel="noreferrer noopener">here</a>.</p><h2 id="Introduction-to-Spring-Cloud-Stream">Introduction to Spring Cloud Stream</h2><p>Spring Cloud Stream is a framework designed to support stream processing provided by various messaging systems like Apache Kafka, RabbitMQ, etc. The framework allows you to create processing logic without having to deal with any specific platform. It helps you build highly scalable event-driven microservices connected using these messaging systems.</p><p>The framework provides a flexible programming model built on already established and familiar Spring idioms and best practices. The way it works is simple; you have to provide implementations (called Binder implementations)for the messaging system that you are using. Spring cloud stream supports:</p><ul><li><a href="https://github.com/spring-cloud/spring-cloud-stream-binder-rabbit" target="_blank" rel="noreferrer noopener">RabbitMQ</a></li><li><a href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka" target="_blank" rel="noreferrer noopener">Apache Kafka</a></li><li><a href="https://github.com/spring-cloud/spring-cloud-stream-binder-kafka/tree/main/spring-cloud-stream-binder-kafka-streams" target="_blank" rel="noreferrer noopener">Kafka Streams</a></li><li><a href="https://github.com/spring-cloud/spring-cloud-stream-binder-aws-kinesis" target="_blank" rel="noreferrer noopener">Amazon Kinesis</a></li></ul><p>And a few others. The links above will take you to the binder implementations. In this article, we will look into a simple application that uses Kafka Streams as a stream processor listening to events on a topic, processing the data, and publishing it to the outgoing topic.</p><h2 id="Introduction-to-Apache-Kafka">Introduction to Apache Kafka</h2><p>Apache Kafka is a distributed publish-subscribe messaging system. It is a system that publishes and subscribes to a stream of records, similar to a message queue. Kafka is suitable for both offline and online message consumption. It is fault-tolerant, robust, and has a high throughput. Kafka is run as a cluster on one or more servers that can span multiple data centers. The Kafka cluster stores stream of records in categories called topics. Each record consists of a key, a value, and a timestamp. For more information on topics, Producer API, Consumer API, and event streaming, please visit this <a href="https://kafka.apache.org/intro" target="_blank" rel="noreferrer noopener">link</a>.</p><h2 id="Introduction-to-Kafka-Streams">Introduction to Kafka Streams</h2><p>Kafka Streams is a library that can be used to consume data, process it, and produce new data, all in real-time. It works on a continuous, never-ending stream of data. Consider an example of the stock market. The stock prices fluctuate every second, and to be able to provide real-time value to the customer, you would use something like Kafka streams.</p><h2 id="Pre-requisites-">Pre-requisites:</h2><ol start="1"><li>Basic knowledge of <a href="https://jdk.java.net/archive/" target="_blank" rel="noreferrer noopener">Java 11</a>.</li><li>Basic knowledge of <a href="https://spring.io/projects/spring-boot" target="_blank" rel="noreferrer noopener">Spring Boot</a>.</li><li>A basic understanding of <a href="https://kafka.apache.org/intro" target="_blank" rel="noreferrer noopener">Apache Kafka</a>.</li><li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noreferrer noopener">Docker</a> and <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noreferrer noopener">Docker Compose</a> for running Kafka locally.</li></ol><h2 id="Setting-up-Spring-Boot-App">Setting up Spring Boot App</h2><p>Let us first create a Spring Boot project with the help of the <a href="https://start.spring.io/#!type=mavenproject&amp;language=java&amp;platformVersion=2.4.5.RELEASE&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=io.pratik&amp;artifactId=springcloudsqs&amp;name=springcloudsqs&amp;description=Demo%20project%20for%20Spring%20cloud%20sqs&amp;packageName=io.pratik.springcloudsqs&amp;dependencies=web,lombok" target="_blank" rel="noreferrer noopener">Spring boot Initializr</a>, and then open the project in our favorite IDE. Select Gradle project and Java language. Last but not least, select Spring boot version <code><span>2.5</span><span>.4</span></code>. Fill in the project metadata and click generate.</p><p>For Spring Cloud, We need to configure Spring Kafka and Kafka Streams in our <code>gradle<span>.</span>build</code>:</p><pre><code>dependencies <span>{</span>
    implementation <span>&#39;org.springframework.boot:spring-boot-starter&#39;</span>
    implementation <span>&#39;org.apache.kafka:kafka-streams&#39;</span>
    implementation <span>&#39;org.springframework.kafka:spring-kafka&#39;</span>
<span>}</span></code></pre><p>Let&#39;s setup the config for Kafka. We need to define a few parameters on how we want to serialize and deserialize the data. The config is easy to set up and understand. Since our application will be listening to a topic and producing the output to a different topic, our application is a producer and a consumer both. So, we need to define config for both producer and consumer.</p><p>In the application.yml file, we need to add these entries.</p><pre><code><span>kafka</span><span>:</span>
  <span>bootstrap-servers</span><span>:</span> localhost<span>:</span><span>9092</span>
  <span>properties</span><span>:</span>
    <span>schema.registry.url</span><span>:</span> http<span>:</span>//localhost<span>:</span><span>8081</span>

  <span>producer</span><span>:</span>
    <span>client-id</span><span>:</span> $<span>{</span>spring.application.name<span>}</span>
    <span>key-serializer</span><span>:</span> org.apache.kafka.common.serialization.StringSerializer
    <span>value-serializer</span><span>:</span> org.apache.kafka.common.serialization.StringSerializer

  <span>consumer</span><span>:</span>
    <span>client-id</span><span>:</span> $<span>{</span>spring.application.name<span>}</span>
    <span>group-id</span><span>:</span> $<span>{</span>spring.application.name<span>}</span><span>-</span>group
    <span>key-deserializer</span><span>:</span> org.apache.kafka.common.serialization.StringDeserializer
    <span>value-deserializer</span><span>:</span> org.apache.kafka.common.serialization.StringDeserializer
    <span>auto-offset-reset</span><span>:</span> earliest

  <span>streams</span><span>:</span>
    <span>client-id</span><span>:</span> $<span>{</span>spring.application.name<span>}</span><span>-</span>stream
    <span>application-id</span><span>:</span> $<span>{</span>spring.application.name<span>}</span>
    <span>properties</span><span>:</span>
      <span>default.key.serde</span><span>:</span> org.apache.kafka.common.serialization.Serdes$StringSerde
      <span>default.value.serde</span><span>:</span> org.apache.kafka.common.serialization.Serdes$StringSerde</code></pre><p>If you look at the config carefully, we are setting up serializers and de-serializers for the producer, the consumer, and the streams (serde is just short for serializer-deserializer). This is the only setup we need for the Spring boot project.</p><p>Let&#39;s jump into creating the producer, the consumer, and the stream processor. I have taken a simple example here. We are producing random numbers every 2 seconds using a scheduler.</p><pre><code><span>@Component</span>
<span>@AllArgsConstructor</span>
<span>public</span> <span>class</span> <span>NumberProducer</span> <span>{</span>

    <span>NumberPublisher</span> numberPublisher<span>;</span>

    <span>@Scheduled</span><span>(</span>fixedRate <span>=</span> <span>2000</span><span>)</span>
    <span>public</span> <span>void</span> <span>produceIntStream</span><span>(</span><span>)</span> <span>{</span>
        <span>Random</span> random <span>=</span> <span>new</span> <span>Random</span><span>(</span><span>)</span><span>;</span>
        numberPublisher<span>.</span><span>produce</span><span>(</span>random<span>.</span><span>nextInt</span><span>(</span><span>1000</span><span>)</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>The number publisher is the actual publisher that puts the data on a topic. We set a key for the message and the data (which is a random number in our case).</p><pre><code><span>@Slf4j</span>
<span>@Component</span>
<span>@AllArgsConstructor</span>
<span>public</span> <span>class</span> <span>NumberPublisher</span> <span>{</span>

    <span>private</span> <span>final</span> <span>KafkaTemplate</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>&gt;</span></span> kafkaTemplate<span>;</span>

    <span>public</span> <span>void</span> <span>produce</span><span>(</span><span>Integer</span> randomNumber<span>)</span> <span>{</span>
        <span>String</span> s <span>=</span> <span>&#34;Odd&#34;</span><span>;</span>
        <span>if</span> <span>(</span>randomNumber <span>%</span> <span>2</span> <span>==</span> <span>0</span><span>)</span> s <span>=</span> <span>&#34;Even&#34;</span><span>;</span>
        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>&#34;Produced number: &#34;</span> <span>+</span> randomNumber<span>)</span><span>;</span>
        kafkaTemplate<span>.</span><span>send</span><span>(</span>INPUT_TOPIC_NAME<span>,</span> s<span>,</span> <span>String</span><span>.</span><span>valueOf</span><span>(</span>randomNumber<span>)</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>The key is defined as a String, which is either even or odd based on the number. We use the Kafka template to send the message; this comes from the spring-kafka library. It abstracts out the logic for publishing and consuming the messages.</p><p>Next up, we set up our stream processor that listens to the topic on which the publisher is putting the messages. This is where it gets interesting. We listen to the <code><span>INPUT_TOPIC</span></code> and then process the data. In this case, the job of the stream processor is to filter out the odd numbers and only send the even numbers on the <code><span>OUTPUT_TOPIC</span></code>.</p><pre><code><span>@Configuration</span>
<span>@EnableKafkaStreams</span>
<span>public</span> <span>class</span> <span>KafkaStream</span> <span>{</span>

    <span>public</span> <span>static</span> <span>final</span> <span>String</span> OUTPUT_TOPIC_NAME <span>=</span> <span>&#34;even-number-topic&#34;</span><span>;</span>
    <span>public</span> <span>static</span> <span>final</span> <span>String</span> INPUT_TOPIC_NAME <span>=</span> <span>&#34;number-topic&#34;</span><span>;</span>

    <span>@Bean</span>
    <span>public</span> <span>KStream</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>&gt;</span></span> <span>evenNumbersStream</span><span>(</span><span>StreamsBuilder</span> kStreamBuilder<span>)</span> <span>{</span>
        <span>KStream</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>&gt;</span></span> input <span>=</span> kStreamBuilder<span>.</span><span>stream</span><span>(</span>INPUT_TOPIC_NAME<span>)</span><span>;</span>

        <span>KStream</span><span><span>&lt;</span><span>String</span><span>,</span> <span>String</span><span>&gt;</span></span> output <span>=</span> input<span>.</span><span>filter</span><span>(</span><span>(</span>key<span>,</span> value<span>)</span> <span>-&gt;</span> key<span>.</span><span>equals</span><span>(</span><span>&#34;Even&#34;</span><span>)</span><span>)</span><span>;</span>

        output<span>.</span><span>to</span><span>(</span>OUTPUT_TOPIC_NAME<span>)</span><span>;</span>
        <span>return</span> output<span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>You might be wondering about that KStream in the return type of our method. I will give a brief overview here as it is outside the scope of this article.</p><p>KStream -&gt; A Kafka stream that is append-only. When you provide data with the same key, it will not update the previous record. It provides several operations that are very useful for data processing, like a filter, map, partition, flatMap, etc. You can read more about KStreams <a href="https://www.confluent.co.uk/blog/introducing-kafka-streams-stream-processing-made-simple/" target="_blank" rel="noreferrer noopener">here</a>.</p><p>Finally, when we have processed the data, we put it on an <code><span>OUTGOING_TOPIC</span></code>. For the sake of simplicity and completion, I am listening to that topic in our application. This generally will not be the case, as there would be another application that would be consuming from that topic and hence the name <code><span>OUTGOING_TOPIC</span></code>.</p><pre><code><span>@Component</span>
<span>@EnableKafka</span>
<span>public</span> <span>class</span> <span>EvenNumberConsumer</span> <span>{</span>

    <span>@KafkaListener</span><span>(</span>topics <span>=</span> OUTPUT_TOPIC_NAME<span>)</span>
    <span>public</span> <span>void</span> <span>receive</span><span>(</span><span>String</span> value<span>)</span> <span>{</span>
        <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>&#34;Received number: &#34;</span> <span>+</span> value<span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>The application code is complete. Let&#39;s set up Kafka locally.</p><h2 id="Setting-up-Kafka-Locally">Setting up Kafka Locally</h2><p>Setting up Kafka is easy, but it requires some dependency to run, you just need to use the docker-compose file below, and it will start the Kafka server locally. Add the <code>docker compose<span>.</span>yml</code> to the repository&#39;s root directory. Start the required dependency using: <code>docker<span>-</span>compose up</code>.</p><pre><code><span>version</span><span>:</span> <span>&#39;3.7&#39;</span>

<span>services</span><span>:</span>
  <span>kafka</span><span>:</span>
    <span>image</span><span>:</span> confluentinc/cp<span>-</span>kafka<span>:</span>5.5.0
    <span>container_name</span><span>:</span> kafka
    <span>hostname</span><span>:</span> kafka
    <span>restart</span><span>:</span> always
    <span>environment</span><span>:</span>
      <span>KAFKA_LISTENERS</span><span>:</span> LISTENER_DOCKER_INTERNAL<span>:</span>//<span>:</span><span>29092</span><span>,</span>LISTENER_DOCKER_EXTERNAL<span>:</span>//<span>:</span><span>9092</span>
      <span>KAFKA_ADVERTISED_LISTENERS</span><span>:</span> LISTENER_DOCKER_INTERNAL<span>:</span>//kafka<span>:</span><span>29092</span><span>,</span>LISTENER_DOCKER_EXTERNAL<span>:</span>//localhost<span>:</span><span>9092</span>
      <span>KAFKA_LISTENER_SECURITY_PROTOCOL_MAP</span><span>:</span> LISTENER_DOCKER_INTERNAL<span>:</span>PLAINTEXT<span>,</span>LISTENER_DOCKER_EXTERNAL<span>:</span>PLAINTEXT
      <span>KAFKA_ZOOKEEPER_CONNECT</span><span>:</span> zookeeper<span>:</span><span>2181</span>
      <span>KAFKA_INTER_BROKER_LISTENER_NAME</span><span>:</span> LISTENER_DOCKER_INTERNAL
      <span>KAFKA_AUTO_CREATE_TOPICS_ENABLE</span><span>:</span> <span>&#34;true&#34;</span>
      <span>KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR</span><span>:</span> <span>1</span>
    <span>ports</span><span>:</span>
      <span>-</span> 9092<span>:</span><span>9092</span>
      <span>-</span> 9999<span>:</span><span>9999</span>
    <span>depends_on</span><span>:</span>
      <span>-</span> zookeeper

  <span>zookeeper</span><span>:</span>
    <span>container_name</span><span>:</span> zookeeper
    <span>hostname</span><span>:</span> zookeeper
    <span>image</span><span>:</span> confluentinc/cp<span>-</span>zookeeper<span>:</span>5.5.0
    <span>environment</span><span>:</span>
      <span>ZOOKEEPER_CLIENT_PORT</span><span>:</span> <span>2181</span>
    <span>ports</span><span>:</span>
      <span>-</span> 2181<span>:</span><span>2181</span>

  <span>schema-registry</span><span>:</span>
    <span>image</span><span>:</span> confluentinc/cp<span>-</span>schema<span>-</span>registry<span>:</span>5.5.0
    <span>hostname</span><span>:</span> schema<span>-</span>registry
    <span>container_name</span><span>:</span> schema<span>-</span>registry
    <span>restart</span><span>:</span> always
    <span>environment</span><span>:</span>
      <span>SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS</span><span>:</span> <span>&#34;kafka:29092&#34;</span>
      <span>SCHEMA_REGISTRY_HOST_NAME</span><span>:</span> schema<span>-</span>registry
      <span>SCHEMA_REGISTRY_LISTENERS</span><span>:</span> <span>&#34;http://0.0.0.0:8081&#34;</span>
    <span>ports</span><span>:</span>
      <span>-</span> 8081<span>:</span><span>8081</span>
    <span>depends_on</span><span>:</span>
      <span>-</span> zookeeper</code></pre><p>That&#39;s it!</p><h2 id="Verify-Sending--Processing--and-Receiving-of-Events">Verify Sending, Processing, and Receiving of Events</h2><p>Run the Spring Boot app:</p><ol start="1"><li>Clone the sample code from the repo. Go to the root directory.</li><li>Use the Gradle plugin to run your Spring Boot app using the command in the project directory.</li></ol><pre><code>./gradlew bootRun</code></pre><p>Just run the application. You should see logs like this.</p><pre><code>Received number: <span>910</span>
Received number: <span>320</span>
Received number: <span>16</span>
Received number: <span>526</span>
Received number: <span>76</span>
Received number: <span>936</span>
Received number: <span>642</span>
Produced number: <span>510</span>
Received number: <span>510</span>
Produced number: <span>996</span>
Received number: <span>996</span>
Produced number: <span>897</span></code></pre><h2 id="Conclusion">Conclusion</h2><p>Spring Cloud Stream provides a simple and convenient way to create apps that can process streams and publish data to different topics. You can build micro-services that talk to each other using Kafka messages and process data like you would process in a single application.</p><p>In this article, we have learned how to build a Spring Cloud Stream app that uses Kafka Streams. We saw how Spring Cloud Stream provides an easy way to set up and run an application that can consumer, process, and publish messages to Kafka topics without the hassle of configuring each. With such little code, we could do so much.</p><p>You can refer to the repository used in the article on <a href="https://github.com/auth0-blog/spring-cloud-stream-sample" target="_blank" rel="noreferrer noopener">Github</a>.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 10 Nov 2021 16:43:00 +0000</pubDate>
    </item>
    <item>
      <title>Introducing Cost Savings for Nonprofits on All Auth0 Plans</title>
      <link>https://auth0.com/blog/introducing-cost-savings-for-nonprofits-on-all-auth0-plans/</link>
      <description>Continuing our Pledge to create SAFEr Social Impact Organizations</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>As a former business owner, nonprofit board member, developer, and volunteer; I know of one consistent, daunting, universal expenditure all modern organizations face - their tech stack. While some items, such as hardware, have a front-loaded cost that can be justified and managed through a lifetime; taking an uncertain ‚Äúdigital leap‚Äù for philanthropic entities can be challenging. Even when it&#39;s known and agreed that improvements to legacy systems and tools are needed, or that building something completely custom from the ground up to meet the demands of a digital-first economy is in order, there is always trepidation when it comes to modernization and understandably so.</p><p>All these issues are even more challenging for charitable, nonprofit organizations and social enterprises, collectively ‚ÄúSIOs,‚Äù or Social Impact Organizations. These organizations are critical to our society but sufficient unrestricted funds, tech expertise and time to upgrade their systems and processes are especially precious commodities.</p><h2 id="Digital-Is-Primal">Digital Is Primal</h2><p>As evidenced by the existence of social sector industry associations like <a href="http://nten.org" target="_blank" rel="noreferrer noopener">nten</a> and <a href="http://tagtech.org" target="_blank" rel="noreferrer noopener">tagtech</a> that seek to enhance technology capacity building, Social Impact Organizations (SIOs) have recognized the need to modernize their operations. A message we frequently hear from many sources is that younger generations are contributing to a better world as part of their core lifestyle, and SIOs need to ‚Äúmeet their audience where they are at.‚Äù What we have learned from these groups and analysts is that 80% of SIOs are smaller organizations that need sustainable, scalable growth - but that growth is dependent on utilizing and creating affordable digital solutions. Knowing this, we feel expanding our product offer to SIOs for all of our products, not just Enterprise plans but now including Self Service plans for small to medium-sized organizations we can support SIOs regardless of organizational size, internal tech expertise or IT budget levels.</p><p>Stakeholders expect a secure, quality digital experience from SIOs just as they would from commercial enterprises. We‚Äôre committed to creating an offer which helps SIOs satisfy that expectation with minimal cost, installation effort, and ongoing maintenance. We help SIOs secure their stakeholder identities and access so they can focus on what matters: delivering innovative, high-impact services to people most in need in our communities. There is no higher calling for them or for us.</p><h2 id="Understanding-Your-Need-as-an-SIO">Understanding Your Need as an SIO</h2><p>Nonprofits and for-profit social enterprises looking to upgrade the experience of their donors, staff, volunteers, and mission-beneficiaries without compromising on security and compliance, should look at the modern, platform-agnostic Customer Identity &amp; Access Management solutions that Auth0 has to offer.</p><p>In fact, our products and services were built with the unique needs of nonprofit and social enterprise organizations in mind. Much like our Healthcare and Public Sector clients, we know yours is an industry with stringent trust requirements, and like these other verticals, we know that the ability to rapidly iterate, respond, and evolve has been a constant challenge plaguing everyone in a digital-first economy.</p><p>By reducing the hours and specialty skills required to create ‚Äúa great login experience‚Äù (which we better know as identity, access, authentication, and security), application development becomes attainable and affordable for any size organization.</p><h2 id="We-Want-Everyone-to-Be-SAFEr">We Want Everyone to Be SAFEr</h2><p>SAFEr, where do we derive that from? Secure Access For Everyone, <em>but not just anyone</em>.</p><p>Auth0 has always offered a free plan to help everyone easily deploy modern identity and security in their websites and applications.</p><p>You do not need to have a sophisticated developer on staff to rapidly and simply begin utilizing Auth0.</p><p>We provide resources, documentation, SDKs, and plugins that support developers and non-developers alike deploy better security no matter if it‚Äôs a small website or an enterprise application. <strong>Everyone</strong>. <strong>SAFEr</strong>. This applies to SIOs, too.</p><h2 id="Enterprise-Cost-Savings">Enterprise Cost Savings</h2><p>In addition to our free plan, unique cost savings are available on all Enterprise and Self Service plans for Social Impact customers. We established a resilient organization and funding structure, <a href="http://auth0.org" target="_blank" rel="noreferrer noopener">Auth0.org</a>, to make sure this discount is sustainable and attainable for the long-term.</p><p>For <a href="https://auth0.com/pricing" target="_blank" rel="noreferrer noopener">Auth0 Enterprise Plans</a> eligible<a href="#1"><sup>1</sup></a> nonprofits receive a:</p><ul><li>25% <a href="https://auth0.com/social-impact/pricing" target="_blank" rel="noreferrer noopener">discount</a> on 1 year contract plans</li><li>30% <a href="https://auth0.com/social-impact/pricing" target="_blank" rel="noreferrer noopener">discount</a> on 2 year contract plans</li><li>35% <a href="https://auth0.com/social-impact/pricing" target="_blank" rel="noreferrer noopener">discount</a> on 3 year contract plans</li></ul><p>Complimentary Design &amp; Discovery sessions for Enterprise Plans are available.</p><h2 id="The-Big-Announcement---Our-Newest-Offer---Self-Service-">The Big Announcement - Our Newest Offer - Self Service!</h2><p>Social Impact Organizations can rapidly become SAFEr Social Impact Organizations with a whopping 50% <a href="https://auth0.com/social-impact/pricing" target="_blank" rel="noreferrer noopener">cost-savings</a> on our new <a href="http://auth0.com/pricing" target="_blank" rel="noreferrer noopener">Essentials and Professional Self-Service Plans</a>.</p><p>And with our free trial, no payment is required to start building today.</p><p>Not sure which plan may be right for you? Check out our compare plans feature on our <a href="https://auth0.com/pricing" target="_blank" rel="noreferrer noopener">pricing page</a> or, <a href="https://auth0.com/contact-us?place=subscription%20column&amp;type=button&amp;text=contact%20us&amp;target=contact-us" target="_blank" rel="noreferrer noopener">contact us</a>.</p>
</div></div>]]></content:encoded>
      <pubDate>Wed, 10 Nov 2021 16:14:00 +0000</pubDate>
    </item>
    <item>
      <title>How to Add Authorization to a Rails API Following TDD</title>
      <link>https://auth0.com/blog/authorization-for-rails-api-with-tdd/</link>
      <description>Learn how to secure a Rails API with Auth0 by letting you drive by tests.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>When you&#39;re adding authorization to an application, there are two crucial questions:</p><ul><li>Are users that shouldn&#39;t have access <em>actually</em> out?</li><li>Are users that should have access <em>actually</em> in?</li></ul><p>If you can&#39;t answer with certainty both questions, how can you claim to have a secure application? This is something that you can test manually, but a better alternative is test automation. Concretely, I think the best methodology to get there is using Test-Driven Development (<a href="https://en.wikipedia.org/wiki/Test-driven_development" target="_blank" rel="noreferrer noopener">TDD</a>).</p><p>This piece is about adding authorization to a <a href="https://rubyonrails.org/" target="_blank" rel="noreferrer noopener">Ruby on Rails</a> API by following TDD. You can check out <a href="https://auth0.com/blog/secure-rails-api" target="_blank" rel="noreferrer noopener">this article to learn in detail how to secure a Rails API with Auth0</a>. Also, you can follow this article along with this <a href="https://github.com/auth0-blog/securing-api-rails" target="_blank" rel="noreferrer noopener">repository</a>.</p><h2 id="The-TDD-Cycle">The TDD Cycle</h2><p>In its essence, TDD is about a loop with the three steps shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3FjI42yPKNne2NmL01bPbf/08cd0fca38b916370207e3a16f1c174e/tdd.png" alt="TDD loop"/></p><p>[<a href="https://www.thoughtworks.com/insights/blog/test-driven-development-best-thing-has-happened-software-design" target="_blank" rel="noreferrer noopener"><em>Source: Thoughtworks</em></a>]</p><ul><li>First, you make a test for a new feature. Initially, the <strong>test will fail</strong>.</li><li>Then, you write the minimum amount of code that <strong>makes the test pass</strong>.</li><li>Lastly, you <strong>refactor</strong> the code to make the implementation more solid.</li></ul><p>Simple, isn&#39;t it? It creates a feedback loop where you write code incrementally to fulfill the task at hand. Moreover, it ensures that you build testability, i.e., you write your code so that it can be tested.</p><p>To show how to use TDD, let&#39;s add authorization to our application step by step, starting with tests. I will use <a href="https://auth0.com/docs/protocols/protocol-oauth2" target="_blank" rel="noreferrer noopener">OAuth</a> to authorize requests to the API via Auth0. As I explained in <a href="https://auth0.com/blog/secure-rails-api" target="_blank" rel="noreferrer noopener">my previous article</a>, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free Auth0 account</a>. Check it out to get <a href="https://auth0.com/blog/secure-rails-api/#Creating-an-API-on-Auth0" target="_blank" rel="noreferrer noopener">all the details about setting up Auth0</a>.</p><h2 id="The-Starting-Application">The Starting Application</h2><p>Our journey starts with an API bootstrapped with Rails 6. It has three routes that need different levels of protection:</p><ul><li><code><span>/</span>api<span>/</span>messages<span>/</span><span>public</span></code>: Public route.</li><li><code><span>/</span>api<span>/</span>messages<span>/</span><span>protected</span></code>: Requires a valid access token.</li><li><code><span>/</span>api<span>/</span>messages<span>/</span>admin</code>: Requires a valid access token. Since Auth0 uses JWT as its access token format, we can inspect it and make sure it has a <code>permissions</code> claim that contains the scope <code>read<span>:</span>admin<span>-</span>messages</code>.</li></ul><p>This <a href="https://github.com/auth0-blog/securing-api-rails/tree/starter" target="_blank" rel="noreferrer noopener">branch</a> is the correct starting point. These are the baseline tests for the three routes:</p><pre><code><span># spec/api/messages_controller_spec.rb</span>
<span>require</span> <span>&#39;rails_helper&#39;</span>

describe <span>Api</span><span>:</span><span>:</span><span>MessagesController</span><span>,</span> type<span>:</span> <span>:controller</span> <span>do</span>
  describe <span>&#39;#public&#39;</span> <span>do</span>
    subject <span>{</span> get <span>:public</span><span>,</span> params<span>:</span> <span>{</span> format<span>:</span> <span>:json</span> <span>}</span> <span>}</span>

    it <span>&#39;returns an accepted answer for the public endpoint&#39;</span> <span>do</span>
      subject

      expect<span>(</span>response<span>)</span><span>.</span>to be_ok

      message <span>=</span> <span>&#39;The API doesn\&#39;t require an access token to share this message.&#39;</span>
      expect<span>(</span>json_response<span>!</span><span>)</span><span>.</span>to <span>include</span><span>(</span><span>&#39;message&#39;</span> <span>=</span><span>&gt;</span> message<span>)</span>
    <span>end</span>
  <span>end</span>

  describe <span>&#39;#protected&#39;</span> <span>do</span>
    subject <span>{</span> get <span>:protected</span><span>,</span> params<span>:</span> <span>{</span> format<span>:</span> <span>:json</span> <span>}</span> <span>}</span>

    it <span>&#39;returns an accepted answer for the protected endpoint&#39;</span> <span>do</span>
      subject

      expect<span>(</span>response<span>)</span><span>.</span>to be_ok

      message <span>=</span> <span>&#39;The API successfully validated your access token.&#39;</span>
      expect<span>(</span>json_response<span>!</span><span>)</span><span>.</span>to <span>include</span><span>(</span><span>&#39;message&#39;</span> <span>=</span><span>&gt;</span> message<span>)</span>
    <span>end</span>
  <span>end</span>

  describe <span>&#39;#admin&#39;</span> <span>do</span>
    subject <span>{</span> get <span>:admin</span><span>,</span> params<span>:</span> <span>{</span> format<span>:</span> <span>:json</span> <span>}</span> <span>}</span>

    it <span>&#39;returns an accepted answer for the admin endpoint&#39;</span> <span>do</span>
      subject

      expect<span>(</span>response<span>)</span><span>.</span>to be_ok

      message <span>=</span> <span>&#39;The API successfully recognized you as an admin.&#39;</span>
      expect<span>(</span>json_response<span>!</span><span>)</span><span>.</span>to <span>include</span><span>(</span><span>&#39;message&#39;</span> <span>=</span><span>&gt;</span> message<span>)</span>
    <span>end</span>
  <span>end</span>
<span>end</span></code></pre><p>We&#39;re not enforcing authorization yet. The requests work, but that&#39;ll change soon enough.</p><p>To launch the tests, move in the project&#39;s root folder and run the following command:</p><pre><code>./go <span>test</span></code></pre><p>The <code>go</code> script allows you to execute different tasks, but we will use it here to run our tests.</p><p>For now, we have a pleasant list of green tests, as you can see in the following screenshot:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5MNgIu9a2dQIHpWXCf2Lro/58ec0f5a6a59a3a05dd7d8248351b2df/green-tests-unprotected-endpoints.png" alt="Green tests with unprotected endpoints"/></p><h2 id="The-Initial-Tests">The Initial Tests</h2><p>Let&#39;s start by decoding the access token in the <a href="https://jwt.io/introduction" target="_blank" rel="noreferrer noopener">JWT</a> format that we get from Auth0. We&#39;re leveraging the excellent <a href="https://github.com/jwt/ruby-jwt" target="_blank" rel="noreferrer noopener">jwt</a> gem. We don&#39;t want to test that the library works, so we&#39;re going to be relatively sparse with the testing. We want to make sure that incorrect requests fail. So, create a <code>lib</code> folder under the <code>spec</code> folder and add a file named <code>json_web_token_spec<span>.</span>rb</code> with the following content:</p><pre><code><span># spec/lib/json_web_token_spec.rb</span>
<span>require</span> <span>&#39;rails_helper&#39;</span>

<span>require</span> <span>&#39;json_web_token&#39;</span>

describe <span>JsonWebToken</span> <span>do</span>
  subject <span>{</span> described_class <span>}</span>

  describe <span>&#39;.verify&#39;</span> <span>do</span>
    before <span>do</span>
      allow<span>(</span><span>Net</span><span>:</span><span>:</span><span>HTTP</span><span>)</span><span>.</span>to receive<span>(</span><span>:get</span><span>)</span><span>.</span>and_return<span>(</span>jwks_raw<span>)</span>
    <span>end</span>

    it <span>&#39;raises exception if the token is incorrect&#39;</span> <span>do</span>
      expect <span>{</span> subject<span>.</span>verify<span>(</span><span>&#39;&#39;</span><span>)</span> <span>}</span><span>.</span>to raise_exception<span>(</span><span>JWT</span><span>:</span><span>:</span><span>DecodeError</span><span>)</span>
    <span>end</span>

    it <span>&#39;raises exception if the token is expired&#39;</span> <span>do</span>
      expect <span>{</span> subject<span>.</span>verify<span>(</span>token<span>)</span> <span>}</span><span>.</span>to raise_exception<span>(</span><span>JWT</span><span>:</span><span>:</span><span>DecodeError</span><span>)</span>
    <span>end</span>
  <span>end</span>
<span>end</span></code></pre><p>To integrate it in our application, we have to wrap the <a href="https://github.com/jwt/ruby-jwt" target="_blank" rel="noreferrer noopener">jwt</a> library with a little bit of code. For this purpose, add a file named <code>json_web_token<span>.</span>rb</code> to the <code>lib</code> folder in the root of the project. Put the following code in that file:</p><pre><code><span># lib/json_web_token.rb</span>
<span>require</span> <span>&#39;jwt&#39;</span>
<span>require</span> <span>&#39;net/http&#39;</span>

<span>class</span> <span>JsonWebToken</span>
  <span>class</span> <span>&lt;</span><span>&lt;</span> <span>self</span>
    <span>def</span> <span><span>verify</span></span><span>(</span>token<span>)</span>
      <span>JWT</span><span>.</span>decode<span>(</span>token<span>,</span> <span>nil</span><span>,</span>
                 <span>true</span><span>,</span> <span># Verify the signature of this token</span>
                 algorithm<span>:</span> algorithm<span>,</span>
                 iss<span>:</span> issuer<span>,</span>
                 verify_iss<span>:</span> <span>true</span><span>)</span> <span>do</span> <span>|</span>header<span>|</span>
        key<span>(</span>header<span>)</span>
      <span>end</span>
    <span>end</span>

    <span>def</span> <span><span>algorithm</span></span>
      <span>&#39;RS256&#39;</span>
    <span>end</span>

    <span>def</span> <span><span>key</span></span><span>(</span>header<span>)</span>
      jwks_hash<span>[</span>header<span>[</span><span>&#39;kid&#39;</span><span>]</span><span>]</span>
    <span>end</span>

    <span>def</span> <span><span>jwks_hash</span></span>
      jwks_raw <span>=</span> <span>Net</span><span>:</span><span>:</span><span>HTTP</span><span>.</span>get <span>URI</span><span>(</span><span>&#34;<span><span>#{</span>issuer<span>}</span></span>.well-known/jwks.json&#34;</span><span>)</span>
      jwks_keys <span>=</span> <span>Array</span><span>(</span><span>JSON</span><span>.</span>parse<span>(</span>jwks_raw<span>)</span><span>[</span><span>&#39;keys&#39;</span><span>]</span><span>)</span>
      jwks_keys<span>.</span>map <span>do</span> <span>|</span>k<span>|</span>
        <span>[</span>
          k<span>[</span><span>&#39;kid&#39;</span><span>]</span><span>,</span>
          <span>OpenSSL</span><span>:</span><span>:</span><span>X509</span><span>:</span><span>:</span><span>Certificate</span><span>.</span><span>new</span><span>(</span><span>Base64</span><span>.</span>decode64<span>(</span>k<span>[</span><span>&#39;x5c&#39;</span><span>]</span><span>.</span>first<span>)</span><span>)</span><span>.</span>public_key
        <span>]</span>
      <span>end</span><span>.</span>to_h
    <span>end</span>

    <span>def</span> <span><span>issuer</span></span>
      <span>&#34;https://<span><span>#{</span><span>Rails</span><span>.</span>application<span>.</span>config<span>.</span>x<span>.</span>auth0<span>.</span>issuerUri<span>}</span></span>/&#34;</span>
    <span>end</span>
  <span>end</span>
<span>end</span></code></pre><p>We&#39;re calling the library with the token that we want to decode. The <code>decode</code> method expects to receive the right key as the argument of the block. The <code>key</code> method calls the <code>jwks_hash</code> helper, which in turn fetches the list of keys from the <code><span>.</span>well<span>-</span>known</code> URL. To find the right key easier, we convert the list to a hash using the id (<code>kid</code>) as an identifier.</p><p>The tricky part here is that we need to pass actual tokens, otherwise the library will reject them outright.</p><p>Let&#39;s start by building our tests to verify that the protected endpoint works as expected.</p><h3 id="Using-test-tokens">Using test tokens</h3><p>I have set up a bunch of tokens to use in our tests. They live in the <a href="https://github.com/auth0-blog/securing-api-rails/tree/add-authorization/spec/fixtures" target="_blank" rel="noreferrer noopener">fixtures folder</a>. They specify different conditions like being expired or using the wrong audience. This makes the tests a bit more resilient than using straight mocks.</p><p>I&#39;m defining a helper to include one of these tokens in the request. So, add a <code>token_helper<span>.</span>rb</code> file to the <code>spec<span>/</span>support</code> folder with the following content:</p><pre><code><span># spec/support/token_helper.rb</span>
<span>module</span> <span>TokenHelper</span>
  <span>def</span> <span><span>read_token</span></span><span>(</span>name<span>)</span>
    path <span>=</span> <span>File</span><span>.</span>expand_path<span>(</span><span>File</span><span>.</span>join<span>(</span><span>File</span><span>.</span>dirname<span>(</span>__FILE__<span>)</span><span>,</span> <span>&#39;..&#39;</span><span>,</span> <span>&#39;fixtures&#39;</span><span>,</span> name<span>)</span><span>)</span>
    <span>@token</span> <span>||</span><span>=</span> <span>File</span><span>.</span>read<span>(</span>path<span>)</span>
  <span>end</span>

  <span>def</span> <span><span>authorize</span></span><span>!</span><span>(</span>name<span>)</span>
    request<span>.</span>headers<span>[</span><span>&#39;Authorization&#39;</span><span>]</span> <span>=</span> <span>&#34;Bearer <span><span>#{</span>read_token<span>(</span>name<span>)</span><span>}</span></span>&#34;</span>
  <span>end</span>
<span>end</span>

<span>RSpec</span><span>.</span>configure <span>do</span> <span>|</span>c<span>|</span>
  c<span>.</span><span>include</span> <span>TokenHelper</span>
<span>end</span></code></pre><p>Now, I attach the right token to the protected requests:</p><pre><code><span># spec/api/messages_controller_spec.rb</span>
<span>require</span> <span>&#39;rails_helper&#39;</span>

describe <span>Api</span><span>:</span><span>:</span><span>MessagesController</span><span>,</span> type<span>:</span> <span>:controller</span> <span>do</span>
     <span># ...existing code...</span>
  
     subject <span>{</span> get <span>:protected</span><span>,</span> params<span>:</span> <span>{</span> format<span>:</span> <span>:json</span> <span>}</span> <span>}</span>

     it <span>&#39;returns an accepted answer for the protected endpoint&#39;</span> <span>do</span>
       <span># üëá new code</span>
       authorize<span>!</span> <span>&#39;validToken&#39;</span>
       <span># üëÜ new code</span>

       subject

       expect<span>(</span>response<span>)</span><span>.</span>to be_ok
     <span>end</span>

     <span># ...existing code...</span>

     subject <span>{</span> get <span>:admin</span><span>,</span> params<span>:</span> <span>{</span> format<span>:</span> <span>:json</span> <span>}</span> <span>}</span>

     it <span>&#39;returns an accepted answer for the admin endpoint&#39;</span> <span>do</span>
       <span># üëá new code</span>
       authorize<span>!</span> <span>&#39;validWithPermissionsToken&#39;</span>
       <span># üëÜ new code</span>

       subject

       expect<span>(</span>response<span>)</span><span>.</span>to be_ok
     <span>end</span>
  
     <span># ...existing code...</span>
<span>end</span></code></pre><p>These tests will prevent regressions when we enforce authorization. Let&#39;s add some tests to define the expectations that we want to enforce in the protected route:</p><pre><code><span># spec/api/messages_controller_spec.rb</span>
<span>require</span> <span>&#39;rails_helper&#39;</span>

describe <span>Api</span><span>:</span><span>:</span><span>MessagesController</span><span>,</span> type<span>:</span> <span>:controller</span> <span>do</span>
  <span># ...existing code...</span>
  
  describe <span>&#39;#protected&#39;</span> <span>do</span>
    it <span>&#39;returns error for the protected endpoint if there is no token&#39;</span> <span>do</span>
      can_authenticate

      subject

      expect<span>(</span>response<span>)</span><span>.</span>to be_unauthorized
    <span>end</span>

    it <span>&#39;returns error for the protected endpoint if the token is expired&#39;</span> <span>do</span>
      authorize<span>!</span> <span>&#39;expiredToken&#39;</span>

      subject

      expect<span>(</span>response<span>)</span><span>.</span>to be_unauthorized
    <span>end</span>

    it <span>&#39;returns error for the protected endpoint if the token has the wrong issuer&#39;</span> <span>do</span>
      authorize<span>!</span> <span>&#39;wrongIssuerToken&#39;</span>

      subject

      expect<span>(</span>response<span>)</span><span>.</span>to be_unauthorized
    <span>end</span>
  <span>end</span>
  
  <span># ...existing code...</span>
<span>end</span></code></pre><p>For reasons of space, I&#39;m grouping them, but to remain closer to the spirit of TDD, you should add them one by one. See how they fail:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3k1ZLpZhkETEoCIngYSawa/7aab01b4ceae70fe267f4c9027d33875/failing-tests.png" alt="Failing Tests"/></p><h3 id="Implementing-authorization">Implementing authorization</h3><p>To implement the authorization, we&#39;re using a <a href="https://api.rubyonrails.org/v6.1.3.2/classes/AbstractController/Callbacks/ClassMethods.html#method-i-before_action" target="_blank" rel="noreferrer noopener">before_action</a> callback. We pick the token out of the header and verify it with our library. Traditionally, this type of helper method goes in the <code>ApplicationController</code>, which is the base class for all of our controllers. Here is the code:</p><pre><code><span># app/controllers/application_controller.rb</span>
<span>require</span> <span>&#39;json_web_token&#39;</span>

<span>class</span> <span>ApplicationController</span> <span>&lt;</span> <span>ActionController</span><span>:</span><span>:</span><span>API</span>
  <span>def</span> <span><span>authorize</span></span><span>!</span>
    valid<span>,</span> result <span>=</span> verify<span>(</span>raw_token<span>(</span>request<span>.</span>headers<span>)</span><span>)</span>

    head <span>:unauthorized</span> <span>unless</span> valid
    <span>@token</span> <span>||</span><span>=</span> result
  <span>end</span>

  <span>private</span>

  <span>def</span> <span><span>verify</span></span><span>(</span>token<span>)</span>
    payload<span>,</span> <span>=</span> <span>JsonWebToken</span><span>.</span>verify<span>(</span>token<span>)</span>
    <span>[</span><span>true</span><span>,</span> payload<span>]</span>
  <span>rescue</span> <span>JWT</span><span>:</span><span>:</span><span>DecodeError</span> <span>=</span><span>&gt;</span> e
    <span>[</span><span>false</span><span>,</span> e<span>]</span>
  <span>end</span>

  <span>def</span> <span><span>raw_token</span></span><span>(</span>headers<span>)</span>
    <span>return</span> headers<span>[</span><span>&#39;Authorization&#39;</span><span>]</span><span>.</span>split<span>.</span>last <span>if</span> headers<span>[</span><span>&#39;Authorization&#39;</span><span>]</span><span>.</span>present<span>?</span>

    <span>nil</span>
  <span>end</span>
<span>end</span></code></pre><p>And we ensure it&#39;s used only for the routes we want:</p><pre><code><span># app/controllers/api/messages_controller.rb</span>
<span>module</span> <span>Api</span>
  <span>class</span> <span>MessagesController</span> <span>&lt;</span> <span>ApplicationController</span>
    before_action <span>:authorize!</span><span>,</span> except<span>:</span> <span>%i[public]</span>
  <span>end</span>
<span>end</span></code></pre><p>Now we see the tests passing:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3n98MGbakFURNupujEG8CZ/6de791a632850a1bdb9cfd8dc6a6ef07/passing-tests.png" alt="Passing Tests"/></p><h3 id="Custom-messages">Custom messages</h3><p>Next, we want to get a more detailed error message in the payload of the response. We need some extra assertions in the tests we wrote:</p><pre><code><span># spec/api/messages_controller_spec.rb</span>
describe <span>Api</span><span>:</span><span>:</span><span>MessagesController</span><span>,</span> type<span>:</span> <span>:controller</span> <span>do</span>
       subject

       expect<span>(</span>response<span>)</span><span>.</span>to be_unauthorized

       <span># üëá new code</span>
       message <span>=</span> <span>&#39;Nil JSON web token&#39;</span>
       expect<span>(</span>json_response<span>!</span><span>)</span><span>.</span>to <span>include</span><span>(</span><span>&#39;message&#39;</span> <span>=</span><span>&gt;</span> message<span>)</span>
       <span># üëÜ new code</span>
     <span>end</span>

     it <span>&#39;returns error for the protected endpoint if the token is expired&#39;</span> <span>do</span>
       subject

       expect<span>(</span>response<span>)</span><span>.</span>to be_unauthorized
       <span># üëá new code</span>
       expect<span>(</span>json_response<span>!</span><span>[</span><span>&#39;message&#39;</span><span>]</span><span>)</span><span>.</span>to <span>include</span><span>(</span><span>&#39;Signature has expired&#39;</span><span>)</span>
       <span># üëÜ new code</span>
     <span>end</span>

     it <span>&#39;returns error for the protected endpoint if the token has the wrong issuer&#39;</span> <span>do</span>
       subject

       expect<span>(</span>response<span>)</span><span>.</span>to be_unauthorized
       <span># üëá new code</span>
       expect<span>(</span>json_response<span>!</span><span>[</span><span>&#39;message&#39;</span><span>]</span><span>)</span><span>.</span>to <span>include</span><span>(</span><span>&#39;Invalid issuer&#39;</span><span>)</span>
       <span># üëÜ new code</span>
     <span>end</span>

     it <span>&#39;returns error for the protected endpoint if the token has the wrong audience&#39;</span> <span>do</span></code></pre><p>To implement this capability, we need to pass the message in the response whenever an error happens.</p><pre><code><span># app/controllers/application_controller.rb</span>
<span>class</span> <span>ApplicationController</span> <span>&lt;</span> <span>ActionController</span><span>:</span><span>:</span><span>API</span>
   <span>def</span> <span><span>authorize</span></span><span>!</span>
     valid<span>,</span> result <span>=</span> verify<span>(</span>raw_token<span>(</span>request<span>.</span>headers<span>)</span><span>)</span>

     <span># üëá old code</span>
     <span># head :unauthorized unless valid</span>
     <span># üëá new code</span>
     render json<span>:</span> <span>{</span> message<span>:</span> result <span>}</span><span>.</span>to_json<span>,</span> status<span>:</span> <span>:unauthorized</span> <span>unless</span> valid

     <span>@token</span> <span>||</span><span>=</span> result
   <span>end</span></code></pre><h3 id="Validating-the-audience">Validating the audience</h3><p>Our code has a serious flaw: it doesn&#39;t validate the <em>audience</em> contained in the JWT. Let&#39;s fix that to make sure that the application is the intended user of the token. A new test codes the behavior:</p><pre><code><span># spec/api/messages_controller_spec.rb</span>
<span>require</span> <span>&#39;rails_helper&#39;</span>

describe <span>Api</span><span>:</span><span>:</span><span>MessagesController</span><span>,</span> type<span>:</span> <span>:controller</span> <span>do</span>
  <span># ...existing code...</span>
  
  describe <span>&#39;#protected&#39;</span> <span>do</span>
    subject <span>{</span> get <span>:protected</span><span>,</span> params<span>:</span> <span>{</span> format<span>:</span> <span>:json</span> <span>}</span> <span>}</span>

    it <span>&#39;returns error for the protected endpoint if the token has the wrong audience&#39;</span> <span>do</span>
      authorize<span>!</span> <span>&#39;wrongAudienceToken&#39;</span>

      subject

      expect<span>(</span>response<span>)</span><span>.</span>to be_unauthorized
      expect<span>(</span>json_response<span>!</span><span>[</span><span>&#39;message&#39;</span><span>]</span><span>)</span><span>.</span>to <span>include</span><span>(</span><span>&#39;Invalid audience&#39;</span><span>)</span>
    <span>end</span>
  <span>end</span>
  
  <span># ...existing code...</span>
<span>end</span></code></pre><p>Conveniently, the change happens in the <code><span>JWT</span><span>.</span>decode</code> method that we rely on:</p><pre><code><span># lib/json_web_token.rb</span>
<span>require</span> <span>&#39;jwt&#39;</span>
<span>require</span> <span>&#39;net/http&#39;</span>

<span>class</span> <span>JsonWebToken</span>
  <span>class</span> <span>&lt;</span><span>&lt;</span> <span>self</span>
    <span>def</span> <span><span>verify</span></span><span>(</span>token<span>)</span>
      <span>JWT</span><span>.</span>decode<span>(</span>token<span>,</span> <span>nil</span><span>,</span>
                 <span>true</span><span>,</span> <span># Verify the signature of this token</span>
                 algorithm<span>:</span> algorithm<span>,</span>
                 iss<span>:</span> <span>Rails</span><span>.</span>application<span>.</span>config<span>.</span>x<span>.</span>auth0<span>.</span>issuerUri<span>,</span>
                  <span># üëá new code</span>
                  verify_iss<span>:</span> <span>true</span><span>,</span>
                  aud<span>:</span> <span>Rails</span><span>.</span>application<span>.</span>config<span>.</span>x<span>.</span>auth0<span>.</span>audience<span>,</span>
                  verify_aud<span>:</span> <span>true</span><span>)</span> <span>do</span> <span>|</span>header<span>|</span>
                  <span># üëÜ new code</span>
        key<span>(</span>header<span>)</span>
      <span>end</span>
    <span>end</span>

    <span># ...existing code...</span>
<span>end</span></code></pre><h2 id="Testing-Permissions">Testing Permissions</h2><p>At this point, we&#39;ve got the protected route covered. Now, we shall focus on the admin route. The next step is checking for the correct <code>permission</code> claim in the token. Our regular token doesn&#39;t have the claim, so it should fail the test:</p><pre><code><span># spec/api/messages_controller_spec.rb</span>
<span>require</span> <span>&#39;rails_helper&#39;</span>

describe <span>Api</span><span>:</span><span>:</span><span>MessagesController</span><span>,</span> type<span>:</span> <span>:controller</span> <span>do</span>
  <span># ...existing code...</span>
  
  describe <span>&#39;#admin&#39;</span> <span>do</span>
    subject <span>{</span> get <span>:admin</span><span>,</span> params<span>:</span> <span>{</span> format<span>:</span> <span>:json</span> <span>}</span> <span>}</span>

    it <span>&#39;returns error for the admin endpoint if the token does not have permissions&#39;</span> <span>do</span>
      authorize<span>!</span> <span>&#39;validToken&#39;</span>

      subject

      expect<span>(</span>response<span>)</span><span>.</span>to be_unauthorized
      expect<span>(</span>json_response<span>!</span><span>[</span><span>&#39;message&#39;</span><span>]</span><span>)</span><span>.</span>to <span>include</span><span>(</span><span>&#39;Access is denied&#39;</span><span>)</span>
    <span>end</span>
  <span>end</span>
  
  <span># ...existing code...</span>
<span>end</span></code></pre><p>Now, let&#39;s implement the permission check in the controller:</p><pre><code><span># app/controllers/application_controller.rb</span>
<span>require</span> <span>&#39;json_web_token&#39;</span>

<span>class</span> <span>ApplicationController</span> <span>&lt;</span> <span>ActionController</span><span>:</span><span>:</span><span>API</span>
  <span># ...existing code...</span>
  
  <span>def</span> <span><span>can_read_admin_messages</span></span><span>!</span>
    check_permissions<span>(</span><span>@token</span><span>,</span> <span>&#39;read:admin-messages&#39;</span><span>)</span>
  <span>end</span>

  <span>def</span> <span><span>check_permissions</span></span><span>(</span>token<span>,</span> permission<span>)</span>
    permissions <span>=</span> token<span>[</span><span>&#39;permissions&#39;</span><span>]</span> <span>||</span> <span>[</span><span>]</span>
    permissions <span>=</span> permissions<span>.</span>split <span>if</span> permissions<span>.</span>is_a<span>?</span> <span>String</span>

    <span>unless</span> permissions<span>.</span><span>include</span><span>?</span><span>(</span>permission<span>)</span>
      render json<span>:</span> <span>{</span> message<span>:</span> <span>&#39;Access is denied&#39;</span> <span>}</span><span>.</span>to_json<span>,</span>
             status<span>:</span> <span>:unauthorized</span>
    <span>end</span>
  <span>end</span>
  
  <span># ...existing code...</span>
<span>end</span></code></pre><p>To make sure the check is applied to the correct route, we follow a similar approach to before, based on a <code>before_action</code>:</p><pre><code><span># app/controllers/api/messages_controller.rb</span>
<span>module</span> <span>Api</span>
  <span>class</span> <span>MessagesController</span> <span>&lt;</span> <span>ApplicationController</span>
    <span># ...existing code...</span>
    
    before_action <span>:can_read_admin_messages!</span><span>,</span> only<span>:</span> <span>%i[admin]</span>
<span>end</span></code></pre><p>Now you can run the tests to make sure everything works as expected.</p><h2 id="We-Got-There-">We Got There!</h2><p>Writing code following TDD is all about having a tight feedback loop. This isn&#39;t easy to show in writing due to a large number of small changes, but I hope I have given you a good glimpse.</p><p>Using TDD brings several benefits:</p><ul><li>We&#39;ve confirmed that our implementation, you know, works</li><li>Our test suite describes the application&#39;s behavior in an executable way instead of potentially misleading documentation</li><li>We&#39;re incorporating testability into our code from the beginning</li><li>Often, we tend to build things that we might need for a future that never comes. If you encode your expectations as tests, that becomes more visible, and it helps prevent it from happening.</li></ul><p>Perhaps not every line of code that you write needs to be covered by tests. Nevertheless, a focus on testability helps to deliver better products <a href="https://itrevolution.com/book/accelerate/" target="_blank" rel="noreferrer noopener">more reliably</a>.</p><p>You can download the sample project shown in this article from <a href="https://github.com/auth0-blog/securing-api-rails" target="_blank" rel="noreferrer noopener">this GitHub repository</a>.</p></div></div>]]></content:encoded>
      <author>Testing Authorization</author>
      <pubDate>Tue, 09 Nov 2021 16:07:00 +0000</pubDate>
    </item>
    <item>
      <title>Lush Transforms its Login Experience with Auth0</title>
      <link>https://auth0.com/blog/lush-transforms-its-login-experience-with-auth0/</link>
      <description>Cosmetics firm replaces home-built authentication with Auth0 to optimise developers‚Äô time and simplify security for customers and staff throughout the business</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>LONDON. ‚Äì 9th November, 2021</strong> ‚Äì¬†The <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Identity Platform</a>, a product unit within Okta, has been selected by <a href="https://www.lush.com/uk/en" target="_blank" rel="noreferrer noopener">Lush</a>, the global cosmetics retailer, to provide a superior login experience for customers and staff interacting with the online brand. Auth0 will initially power the login experience for Lush‚Äôs new chat function and add website authentication, along with centralising its point-of-sale (PoS) system to simplify access to information throughout the organisation, while helping to ensure privacy.</p><p>When it comes to pursuing more <a href="https://weare.lush.com/lush-life/our-ethics/digital-ethics/" target="_blank" rel="noreferrer noopener">ethical ways of doing business</a>, Lush is no stranger to pushing the limits. Founded in the 1990s, its commitment to sustainable, cruelty-free production was initially an outlier in cosmetics, but the brand has influenced the direction of the industry as a whole. In the process, it has grown into a successful multinational business and operates in 47 countries with 937 global Lush shops. The latest business numbers can be found on <a href="https://weare.lush.com/numbers" target="_blank" rel="noreferrer noopener">Lush‚Äôs company information website</a>.</p><p>Traditionally, Lush preferred to build its digital services in-house following its digital ethics code. However, when it restructured its digital business using a microservices architecture, the company found that its approach to authentication complicated its ability to protect customer data, which raised security concerns within the company. What‚Äôs more, the time taken for developers to maintain its internally-built authentication system strained innovation across other parts of the business.</p><p>‚ÄúWhile we didn&#39;t experience any major data leaks, our home-baked solution raised red flags for our internal data privacy team, and that posed a huge risk for us since we are a business built on ethics,‚Äù said Simon Ince, Lush‚Äôs creative technology and innovation lead. ‚ÄúDuring the development of a new customer chat function, we hit a roadblock with our existing authentication system. Time was not on our side, so we evaluated open standards as an alternative to building in-house. That‚Äôs when we discovered Auth0, and the problem was solved in thirty minutes.‚Äù</p><p>Following the success of the chat system, Lush evaluated Auth0‚Äôs solution for use across other parts of the business ‚Äî including its website redesign and centralizing its global POS system ‚Äî to create a more seamless, secure, and personalized end-user experience. With Auth0, just two developers were able to add authentication to Lush&#39;s website without impacting Lush&#39;s existing timeline or roadmap.</p><p>‚ÄúWhen business and consumer needs rapidly evolve, and the security landscape becomes even more complex, maintaining in-house systems can be a difficult and time-consuming process ‚Äî one that takes developers away from other, more pressing tasks,‚Äù said Steven Rees-Pullman, SVP International at Auth0. ‚ÄúAuth0‚Äôs identity platform enables Lush to refocus its development teams where they can bring the most value, while meeting the company‚Äôs ethical standards for data privacy and customer security.‚Äù</p><p>Learn more about <a href="https://auth0.com/case-studies/lush-cs/" target="_blank" rel="noreferrer noopener">Lush‚Äôs implementation</a> on Auth0.com.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h3 id="Media-Contacts">Media Contacts</h3><p>Auth0 Global Communications<br/><a href="mailto:press@auth0.com" target="_blank" rel="noreferrer noopener">press@auth0.com</a><br/></p></div></div>]]></content:encoded>
      <pubDate>Tue, 09 Nov 2021 13:34:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Integration with Singpass</title>
      <link>https://auth0.com/blog/auth0-integration-with-singpass/</link>
      <description>Learn how to enable Singpass login with QR code in Auth0 Universal Login</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>When it comes to national digital identity, Singapore has a lot to say. 
Singapore launched <a href="https://www.singpass.gov.sg/" target="_blank" rel="noreferrer noopener">Singpass</a> in 2003 and has been enhancing it over the years. 
Singpass‚Äôs initial goal was to authenticate citizens to government agencies and has since expanded to use in the private sector quite successfully.
Today, Singapore residents use Singpass to securely access over 1,700 services from more than 460 government agencies and private sector organisations. </p><p>With Auth0&#39;s customer base quickly growing in Southeast Asia, Singapore and Japan, it was about time to officially offer Singpass services on the Auth0 platform.</p><p>This is the first of a two-post series. In this post, we‚Äôll learn how to integrate Singpass QR Login with Auth0 Universal Login. 
In the next post, we‚Äôll look into integrating Myinfo to share selective personal data such as name and email address.</p><h2 id="How-Singpass-QR-Login-Works">How Singpass QR Login Works</h2><p><a href="https://api.singpass.gov.sg/library/login/developers/overview-at-a-glance" target="_blank" rel="noreferrer noopener">Singpass QR login</a> uses OIDC authorization code flow. 
Singpass offers an embedded SDK that renders a QR code returned from the authorization endpoint.</p><pre><code><span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span>‚Äùhttps://id.singpass.gov.sg/static/ndi_embedded_auth.js‚Äù</span><span>&gt;</span></span><span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span></code></pre><p>Websites integrate with Singpass by hosting NDI embedded Javascript SDK. On page load, the Singpass SDK starts an authorization flow, with the <code>state</code> and <code>nonce</code> loaded to the page from the backend.</p><pre><code><span>const</span> <span>authParamsSupplier</span> <span>=</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>return</span> <span>{</span> state<span>:</span> <span>&#34;my-state&#34;</span><span>,</span> nonce<span>:</span> <span>&#34;my-nonce&#34;</span><span>}</span><span>;</span>
  <span>}</span><span>;</span>

<span>const</span> <span>onError</span> <span>=</span> <span>(</span><span>errorId<span>,</span> message</span><span>)</span> <span>=&gt;</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span><span>`</span><span>Error. errorId:</span><span><span>${</span>errorId<span>}</span></span><span> message:</span><span><span>${</span>message<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
<span>}</span><span>;</span>

<span>const</span> initAuthSessionResponse <span>=</span> window<span>.</span><span>NDI</span><span>.</span><span>initAuthSession</span><span>(</span>
    <span>&#39;ndi-qr&#39;</span><span>,</span>
    <span>{</span>
        clientId<span>:</span> <span>SINGPASS_CLIENT_ID</span><span>,</span> 
        redirectUri<span>:</span> <span>SINGPASS_REDIRECT_URL</span><span>,</span>
        scope<span>:</span> <span>&#39;openid&#39;</span><span>,</span>
        responseType<span>:</span> <span>&#39;code&#39;</span>
    <span>}</span><span>,</span>
    authParamsSupplier<span>,</span>
    onError
<span>)</span><span>;</span></code></pre><p>NDI clients call authorization endpoint to return an embedded QR code. The Singpass app then scans the generated QR code, and the user then confirms the login. 
Next, the Embedded SDK receives a confirmation over Websocket and redirects to the client‚Äôs callback URL with an authorization code and state. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/vfNDWisx8csQ7Ifg777EQ/7037d43c9924c70239e6d49fd365c988/01_private-qr.png" alt="Singpass sequence diagram"/></p><p>After the exchange, <code>id_token</code>‚Äôs <code>sub</code> claim contains either an opaque digital identifier known as UUID or a combination of UUID and NRIC. </p><pre><code><span>{</span> 
   <span>&#34;sub&#34;</span> <span>:</span> <span>&#34;s=S8829314B,u=1c0cee38-3a8f-4f8a-83bc-7a0e4c59d6a9&#34;</span><span>,</span>
   <span>&#34;aud&#34;</span> <span>:</span> <span>&#34;xxNsTfleQMHoW6tbUgSVNwnLWQ0xTeV0&#34;</span><span>,</span>
   <span>&#34;iss&#34;</span> <span>:</span> <span>&#34;https://stg-id.singpass.gov.sg&#34;</span><span>,</span>
   <span>&#34;exp&#34;</span> <span>:</span> <span>1609907975</span><span>,</span>
   <span>&#34;iat&#34;</span> <span>:</span> <span>1609907375</span><span>,</span>
   <span>&#34;nonce&#34;</span> <span>:</span> <span>&#34;alh5DS2Gfndv9i0jXYViqGIhiQdP4+4BrUvBhDXBYKk=&#34;</span><span>,</span>
   <span>&#34;amr&#34;</span> <span>:</span> <span>[</span> <span>&#34;pwd&#34;</span><span>,</span> <span>&#34;swk&#34;</span> <span>]</span>
<span>}</span></code></pre><p>Depending on the information requested, <code>id_token</code> is either signed or encrypted.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1IrIEcWP6iAmJQ4pS7iNrp/e0cb15a685523ab581f7567c543411b8/Screen_Shot_2021-10-13_at_13.12.10.png" alt="id_token"/></p><h2 id="Integrate-Singpass-with-Auth0">Integrate Singpass with Auth0</h2><p>During the discovery phase, we noticed some gaps between what Auth0 offers for integration with external OIDC providers and what Singpass required.</p><p>First challenge was that the <code>nonce</code> parameter that applications send to Auth0 is not available within UL where we wanted to initiate the NDI SDK.</p><p>Second, Auth0 currently does not support the <a href="https://datatracker.ietf.org/doc/html/rfc7523#section-2.2" target="_blank" rel="noreferrer noopener">client-assertion</a> for token endpoints of OIDC connections. 
Singpass expects clients to use asymmetric <a href="https://stg-id.singpass.gov.sg/docs/authorization/api#_client_jwk_requirements" target="_blank" rel="noreferrer noopener">client_assertion JWT</a> and customers should follow NDI‚Äôs process to generate an Elliptic-curve keypair and host public key in a public-facing <code>jwks<span>.</span>json</code> file. 
Customer‚Äôs public-key URL is shared with Singpass during lodging the application.</p><p>Lastly, Singpass‚Äôs <code>id_token</code> signing signature (<code>id_token_signing_alg_values_supported</code>), is <code><span>ES256</span></code> as pointed in their <a href="https://id.singpass.gov.sg/.well-known/openid-configuration" target="_blank" rel="noreferrer noopener">openid-configuration</a>. 
Auth0 only supports <code><span>RS256</span></code> signed <code>id_tokens</code> from upstream connections.</p><p>While integrating Singpass with Auth0 is not a native feature, we hope to build a simpler and easier solution in the future.</p><h3 id="Technical-Details">Technical Details</h3><p>Our field team decided to challenge themselves by taking available tools within the Auth0 extensibility platform and develop an integration path for Singpass on Auth0.</p><p>We decided to proxy both authorization and token endpoints. The proxied version adds missing features of appending nonce, performing exchange with client_assertion, and validating the <code><span>ES256</span></code> signature in return.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4IpSoCXSxRbyByzRnXk8jl/2d9c90bba361a99b9426ffbed16c1e20/singpass-seq.png" alt="Singpass component diagram"/></p><ol start="1"><li>User visits an application that requires authentication against Auth0</li><li>Auth0 detects no session and redirects to Universal Login page for interactive authentication</li><li>User selects login with Singpass from available logon options</li><li>NDI library inside UL page initiates connection with Singpass, fetches QR code, and displays it</li><li>User opens up Singpass app and scans the QR code</li><li>Singpass app communicates to Singpass authorization server in back-channel and accepts logon</li><li>Singpass redirects a callback to Auth0‚Äôs/login/callback endpoint using the front channel from the NDI SDK on the UL page</li><li>Auth0 connects to the proxy /token endpoint to exchange authorization code. Token endpoint validates client credentials</li><li>Proxy endpoint creates private_jwt client assertion and exchanges authorization code, validates response and returns results to Auth0</li><li>Auth0 decodes returning <code>id_token</code> from Singpass and issues its own <code>id_token</code> to the application, completing the sign-in flow</li></ol><p>We developed four open-source versions of proxy endpoint; 
<a href="https://github.com/auth0-extensions/auth0-singpass-extension" target="_blank" rel="noreferrer noopener">hosted on Auth0</a>, <a href="https://github.com/auth0-blog/auth0-singpass/tree/main/aws" target="_blank" rel="noreferrer noopener">AWS Lambda</a>, <a href="https://github.com/auth0-blog/auth0-singpass/tree/main/cloudflare" target="_blank" rel="noreferrer noopener">Cloudflare Workers</a>, and vanilla <a href="https://github.com/auth0-blog/auth0-singpass/tree/main/express" target="_blank" rel="noreferrer noopener">Express.js</a>. 
In the rest of this article, we will focus on the configuration of the Singpass integration proxy inside Auth0. For production use, we suggest hosting proxy endpoints in your environment.</p><h3 id="Deploying-Singpass-Integration-Proxy">Deploying Singpass Integration Proxy</h3><p>First, create a SPA companion app with Allowed Callback URLs set to &#34;<a href="https://your-custom-domain/login/callback" target="_blank" rel="noreferrer noopener">https://your-custom-domain/login/callback</a>&#34;. </p><p>Then head to Extensions, click on &#34;Create Extension&#34; and enter GitHub URL <a href="https://github.com/auth0-extensions/auth0-singpass-extension" target="_blank" rel="noreferrer noopener">https://github.com/auth0-extensions/auth0-singpass-extension</a>. During installation populate with the correct values as follows:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1YGwCulxPHWHiH9OPImMvC/f361a7bb82c2a1baaf0110160272a4da/03_singpass-extension-settings.jpg" alt="Extension settings"/></p><p>Values are:</p><ul><li><strong>Auth0 custom domain</strong><br/>This is your Auth0 custom domain name. You need to have a custom domain name enabled in Auth0</li><li><strong>Auth0 client id</strong><br/><code>client_id</code> of companion app in Auth0</li><li><strong>Auth0 client secret</strong><br/><code>client_secret</code> of companion app in Auth0</li><li><strong>Singpass environment</strong><br/>Is set to Staging only.</li><li><strong>Singpass client id</strong><br/><code>client_id</code> assigned to you from Singpass</li><li><strong>Singpass signing alg</strong><br/>Always <code><span>ES256</span></code></li><li><strong>Relying on party jwks endpoint</strong><br/>This is your JWKS endpoint used during Singpass onboarding registration</li><li><strong>Relying on party private key</strong><br/>Your Elliptic-curve private key used during Singpass onboarding registration. This is not required if the proxy endpoint is running in your own infrastructure, which is the preferred deployment method for production</li><li><strong>Relying on party kid</strong><br/>This is your JWKS key ID used during Singpass onboarding registration</li></ul><p>Once installed, you‚Äôll need to Singpass connection under Authentication &gt; Social &gt; Create Connection &gt; Create Custom. Use client_id and secret from companion app and populate URLs depending on your tenant region and node version as documented <a href="https://github.com/auth0-extensions/auth0-singpass-extension#usage" target="_blank" rel="noreferrer noopener">here</a>. Fetch User Profile script template is also available in <a href="https://github.com/auth0-blog/auth0-singpass/blob/main/oauth2-connection-config/fetchUserProfile.js" target="_blank" rel="noreferrer noopener">Github repo</a>. Ultimately <a href="https://github.com/auth0-blog/auth0-singpass/blob/main/enable-pkce.sh" target="_blank" rel="noreferrer noopener">enable PKCE</a> on this connection.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2h8ucNIa0Pns4bzRZMnJSe/9bb19078adc8e67a43f224d3ca6a3ffe/04_singpass-connection.jpg" alt="singpass social connection"/></p><p>Then enable this connection to applications that require sign-in with Singpass:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Drur5RknH2jD9KEWQVSsJ/5eee8e828e78fa107c495e1ff3017a27/singpass-demo-app.png" alt="singpass application connection"/></p><h3 id="Universal-Login">Universal Login</h3><p>Next, configure Universal Login to host NDI SDK and render QR login code when requested. 
Head to Branding &gt; Universal Login &gt; Login. Enable ‚ÄúCustomize Login Page‚Äù and configure page HTML.  </p><pre><code>    <span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>&#34;</span>https://cdn.auth0.com/js/lock/11.30/lock.min.js<span>&#34;</span></span><span>&gt;</span></span><span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span>
    <span>&lt;!-- ADDED for Singpass --&gt;</span>
    <span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>&#34;</span>//code.jquery.com/jquery-3.1.0.min.js<span>&#34;</span></span><span>&gt;</span></span><span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>script</span> <span>src</span><span><span>=</span><span>&#34;</span>https://stg-id.singpass.gov.sg/static/ndi_embedded_auth.js<span>&#34;</span></span><span>&gt;</span></span><span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span>
    <span>&lt;!-- /ADDED --&gt;</span></code></pre><p>Add <code>authButtons</code> under <code>theme</code> object of Lock configuration:</p><pre><code><span>var</span> lock <span>=</span> <span>new</span> <span>Auth0Lock</span><span>(</span>config<span>.</span>clientID<span>,</span> config<span>.</span>auth0Domain<span>,</span> <span>{</span>
    <span>// ...</span>
    theme<span>:</span> <span>{</span>
      authButtons<span>:</span> <span>{</span>
        <span>&#34;singpass&#34;</span><span>:</span> <span>{</span>
          displayName<span>:</span> <span>&#34;Singpass&#34;</span><span>,</span>
          primaryColor<span>:</span> <span>&#34;#cf0b15&#34;</span><span>,</span>
          foregroundColor<span>:</span> <span>&#34;#FFFFFF&#34;</span><span>,</span>
          icon<span>:</span> <span>&#34;https://app.singpass.gov.sg/apple-touch-icon.png&#34;</span>
        <span>}</span>
      <span>}</span>
    <span>}</span>
  <span>}</span><span>)</span><span>;</span></code></pre><p>And logic to render QR code as following:</p><pre><code>lock<span>.</span><span>once</span><span>(</span><span>&#39;signin ready&#39;</span><span>,</span> <span>function</span> <span>(</span><span>)</span> <span>{</span>
  console<span>.</span><span>log</span><span>(</span><span>&#39;siginin ready&#39;</span><span>)</span><span>;</span>
  <span>if</span> <span>(</span>config<span>.</span>extraParams<span>.</span>singpass<span>)</span> <span>{</span>
    <span>$</span><span>(</span><span>&#34;.auth0-lock.auth0-lock&#34;</span><span>)</span><span>.</span><span>removeProp</span><span>(</span><span>&#34;box-sizing&#34;</span><span>)</span><span>;</span>
    <span>var</span> connectionConfig <span>=</span> <span>initConnnectionConfig</span><span>(</span><span>)</span><span>;</span>
    <span>addEnterpriseConnections</span><span>(</span>connectionConfig<span>)</span><span>;</span>
    <span>init</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>)</span><span>;</span>

lock<span>.</span><span>show</span><span>(</span><span>)</span><span>;</span>

<span>function</span> <span>initConnectionConfig</span><span>(</span><span>)</span> <span>{</span>
  <span>return</span> <span>{</span>
    general<span>:</span> <span>{</span>
      backButton<span>:</span> <span>&#39;&lt;span class=&#34;auth0-lock-back-button&#34;&gt;&lt;svg focusable=&#34;false&#34; enable-background=&#34;new 0 0 24 24&#34; version=&#34;1.0&#34; viewBox=&#34;0 0 24 24&#34; xml:space=&#34;preserve&#34; xmlns=&#34;http://www.w3.org/2000/svg&#34; xmlns:xlink=&#34;http://www.w3.org/1999/xlink&#34;&gt; &lt;polyline fill=&#34;none&#34; points=&#34;12.5,21 3.5,12 12.5,3 &#34; stroke=&#34;#000000&#34; stroke-miterlimit=&#34;10&#34; stroke-width=&#34;2&#34;&gt;&lt;/polyline&gt; &lt;line fill=&#34;none&#34; stroke=&#34;#000000&#34; stroke-miterlimit=&#34;10&#34; stroke-width=&#34;2&#34; x1=&#34;22&#34; x2=&#34;3.5&#34; y1=&#34;12&#34; y2=&#34;12&#34;&gt;&lt;/line&gt; &lt;/svg&gt;&lt;/span&gt;&#39;</span><span>,</span>
      enterprise_panel<span>:</span> <span>&#39;&lt;div id=&#34;ndi-qr&#34; class=&#34;auth0-enterprise-button-content&#34;&gt;&lt;/div&gt;&#39;</span>
    <span>}</span>
  <span>}</span><span>;</span>
<span>}</span>

<span>function</span> <span>addEnterpriseConnections</span><span>(</span><span>connectionConfig</span><span>)</span> <span>{</span>
  <span>var</span> backButton <span>=</span> <span>$</span><span>(</span>connectionConfig<span>.</span>general<span>.</span>backButton<span>)</span><span>;</span>
  <span>$</span><span>(</span><span>&#39;.auth0-lock-submit&#39;</span><span>)</span><span>.</span><span>hide</span><span>(</span><span>)</span><span>;</span>
  backButton<span>.</span><span>appendTo</span><span>(</span><span>&#39;.auth0-lock-header&#39;</span><span>)</span><span>;</span>
  backButton<span>.</span><span>on</span><span>(</span><span>&#39;click&#39;</span><span>,</span> <span>function</span> <span>(</span><span>e</span><span>)</span> <span>{</span>
    e<span>.</span><span>preventDefault</span><span>(</span><span>)</span><span>;</span>
    window<span>.</span>history<span>.</span><span>back</span><span>(</span><span>)</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
  <span>var</span> enterprisePanel <span>=</span> <span>$</span><span>(</span>connectionConfig<span>.</span>general<span>.</span>enterprise_panel<span>)</span><span>;</span>
  enterprisePanel<span>.</span><span>appendTo</span><span>(</span><span>&#39;.auth0-lock-body-content&#39;</span><span>)</span><span>;</span>
  <span>$</span><span>(</span><span>&#39;.auth0-lock-content&#39;</span><span>)</span><span>.</span><span>hide</span><span>(</span><span>)</span><span>;</span>
  enterprisePanel<span>.</span><span>show</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>init</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>authParamsSupplier</span> <span>=</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>// Replace the below with an `await`ed call to initiate an auth session on your backend</span>
    <span>// which will generate state+nonce values, e.g</span>
    <span>return</span> <span>{</span> state<span>:</span> <span>decodeURIComponent</span><span>(</span>config<span>.</span>extraParams<span>.</span>ndi_state<span>)</span><span>,</span> nonce<span>:</span> <span>decodeURIComponent</span><span>(</span>config<span>.</span>extraParams<span>.</span>ndi_nonce<span>)</span> <span>}</span><span>;</span>
  <span>}</span><span>;</span>

  <span>const</span> <span>onError</span> <span>=</span> <span>(</span><span>errorId<span>,</span> message</span><span>)</span> <span>=&gt;</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span><span><span>`</span><span>onError. errorId:</span><span><span>${</span>errorId<span>}</span></span><span> message:</span><span><span>${</span>message<span>}</span></span><span>`</span></span><span>)</span><span>;</span>
  <span>}</span><span>;</span>

  <span>const</span> initAuthSessionResponse <span>=</span> window<span>.</span><span>NDI</span><span>.</span><span>initAuthSession</span><span>(</span>
          <span>&#39;ndi-qr&#39;</span><span>,</span>
          <span>{</span>
            clientId<span>:</span> <span>SINGPASS_CLIENT_ID</span><span>,</span> <span>// Replace with your Singpass client ID</span>
            redirectUri<span>:</span> <span>SINGPASS_AUTH0_CALLBACK</span><span>,</span>        <span>// Replace with your Auth0 custom domain</span>
            scope<span>:</span> <span>&#39;openid&#39;</span><span>,</span>
            responseType<span>:</span> <span>&#39;code&#39;</span>
          <span>}</span><span>,</span>
          authParamsSupplier<span>,</span>
          onError<span>,</span>
          <span>{</span>
            renderDownloadLink<span>:</span> <span>false</span><span>,</span>
            appLaunchUrl<span>:</span> <span>&#39;&#39;</span> <span>// Replace with your iOS/Android App Link</span>
          <span>}</span><span>,</span>
  <span>)</span><span>;</span>

  console<span>.</span><span>log</span><span>(</span><span>&#39;initAuthSession: &#39;</span><span>,</span> initAuthSessionResponse<span>)</span><span>;</span>
<span>}</span></code></pre><p>You can find the full version of the custom Universal Login page <a href="https://github.com/auth0-blog/auth0-singpass/tree/main/universal-login" target="_blank" rel="noreferrer noopener">here</a>.</p><h3 id="How-it-Looks-in-Action">How it Looks in Action</h3><p>You should be able to see Log in with Singpass as connections options on the login page.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1qhC2Zg65ZshMGMEgXVmzs/a3c692bb512777eca5ee93dde07c3285/lock-singpass-p1v3.png" alt="singpass login selection"/></p><p>Click on &#34;Log in with Singpass. QR code renders.
<img src="https://images.ctfassets.net/23aumh6u8s0i/5cIFPyXvsCJ0u4iwrOWaIh/dc1aec1d8421154d375222f0e3cc1c4d/lock-singpass-qrv2.png" alt="singpass QR in lock"/></p><p>Scan the QR code with the Singpass mobile app.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6pGbrMObvL33JzKFWnkJ1Y/4de633516efb24f40220ab0a2a513b0b/singpass-app-combined.png" alt="app combined"/></p><h3 id="User-Profile">User Profile</h3><p>We‚Äôre taking Singpass UUID to form Auth0 <code>user_id</code>. That logic is sitting in the Fetch User Profile script of the Singpass connection.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/glYisSzA8BDvvAmOJfAyV/3bcc4833cce7954c922efe336ca6ddad/14_singpass-user-profile.png" alt="singpass user profile"/></p><p>In the next article, we will enable Myinfo, where you will fetch email and name information and use it to link Singpass users with existing customers with matching details. Stay tuned!</p><h2 id="Login-experience-in-Action">Login experience in Action</h2><blockquote><p>Note: This video is captured with staging app (v13.0.0-stg) in the staging environment. The actual app interface might be different.</p></blockquote><div><p><img src="https://fast.wistia.com/embed/medias/dybrofix9e/swatch" alt=""/></p></div><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Fri, 05 Nov 2021 17:59:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Announces the Winners of the Actions Hackathon</title>
      <link>https://auth0.com/blog/auth0-announces-the-winners-of-the-actions-hackathon/</link>
      <description>Developers from around the world created awesome new Actions</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Auth0 was excited to host our first Actions Hackathon on Oct 28, 2021. Teams from around the globe participated in a day-long event that saw hackers take their best shot at creating their versions of the newest Auth0 extensibility feature - Actions.</p><h2 id="But--What-Even-Is-Actions-Anyway-">But, What Even Is Actions Anyway?</h2><p>We are always looking for new tools and solutions that allow you to customize your identity solution. Our first extensibility tool was Auth0 Rules, serverless code blocks that can be customized to extend Auth0&#39;s core capabilities. Next up was Auth0 Hooks, similar to Rules but can be executed against several extensibility points.</p><p>Auth0 Actions is the next evolution in our extensibility toolset. An Action is a functional service that fires after specific triggers across an identity flow; these could be events such as a post-login or client credential exchange.</p><h2 id="Okay--so-Let-s-Get-down-to-the-Winning-Teams-and-What-They-Built">Okay, so Let‚Äôs Get down to the Winning Teams and What They Built</h2><p>The Hack kicked off Thursday morning with six developer teams.</p><p>After a roughly four-hour coding session, the teams came back to make their presentations to the judges. And the judges picked the top two winners.</p><h2 id="Facial-Recognition-and-Vaccination-Status">Facial Recognition and Vaccination Status</h2><p>Second place was awarded to the <strong>A-Team</strong>, a team consisting of just one person! Augustine Correa from Mumbai utilized two Auth0 Actions: Yoonik, the Face Authentication Action found in the <a href="https://marketplace.auth0.com/integrations/yoonik-face-authentication" target="_blank" rel="noreferrer noopener">Auth0 marketplace</a>, and a custom one built by the team during the Hackathon named ‚ÄúVaccination Status.‚Äù This action was designed to interface with India‚Äôs COVID19 vaccination portal and verify the vaccination status of the person logging in.</p><p>India is enforcing vaccine mandates for entry to enclosed physical spaces. The A-Team‚Äôs Login Flow solution ascertains a registrant‚Äôs vaccination status and ensures the integrity of the process with a non-contact biometric authentication.</p><p>‚ÄúFor app developers, Auth0 Actions has a comforting familiarity with our current software practices,‚Äù reflected Augustin. ‚ÄúWhile we channel our efforts to code the unique functionality of our app, we incorporate packages for everything else. This assembly of components enables rapid development of high-quality software.‚Äù</p><h2 id="Authenticate-Your-VPN-at-Login">Authenticate Your VPN at Login</h2><p>The winners of the Auth0 Hackathon were <strong>Knights of the Pass</strong>, composed of Inna Shablygin, Kirill Kotyagin, Rostislav Kondratenko, and Igor Vladimirskiy. The Knights of the Pass designed an Auth0 Login flow that streamlines access to corporate resources by recognizing authorization at login for access to VPN.</p><p>VPN is a widely-used security tool for remote workers but often creates significant inconvenience for users and systems administrators alike, contributing to productivity and compromised security.</p><p>The Knights of the Pass team created an Auth0 application for their test demo and set up a reverse proxy that restricts access to the application from the Internet (e.g., only the login page of the app is exposed). Next, they created an Auth0 action that generates one-time tickets for VPN authentication when the user is being logged in. These tickets are later verified by the RADIUS server. Lastly, their Action displays a webpage in the middle of the login process. The webpage verifies if the user is currently in the corporate network and, if not, starts the VPN client software on the user machine to connect to VPN.</p><p>‚ÄúCompanies which utilize Auth0 identity management with WWPass passwordless authentication can use Auth0 Actions to streamline access to corporate resources,‚Äù said Inna Shablygin, VP of Operations at WWPass. ‚ÄúProtected by corporate VPN, with extremely transparent and simple user experience, Auth0 Actions is a fantastic tool to glue different pieces of technology together.‚Äù</p><h2 id="Want-to-Know-More-">Want to Know More?</h2><p>To learn more about <a href="https://auth0.com/actions" target="_blank" rel="noreferrer noopener">how to use Actions</a> in an Auth0 login flow, check out our <a href="https://auth0.com/docs/actions" target="_blank" rel="noreferrer noopener">docs</a> section to see how to use Actions in your customer flow.</p><p>If you‚Äôve built an Action and think you‚Äôre ready to share it as an integration, find out more in the <a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a>.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 04 Nov 2021 16:01:00 +0000</pubDate>
    </item>
    <item>
      <title>From Idea to Standard: How the JWT Profile for OAuth 2.0 Access Tokens Became RFC9068</title>
      <link>https://auth0.com/blog/how-the-jwt-profile-for-oauth-20-access-tokens-became-rfc9068/</link>
      <description>A first-person account of how modern open identity standards are made</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><img src="https://images.ctfassets.net/23aumh6u8s0i/ZEd0TLgFgvxqdJYcSiwvg/2fd1748691bc5e16c631735e7c6ae62c/Uploaded_from_From_Idea_to_Standard__How_the_JWT_Profile_for_OAuth_2" alt="OAuth"/></p><p>OAuth 2 Core does not say what an access token (AT) should look like, only what it should be used for. Left to their own devices, the most important OAuth-based services and products chose to encode access tokens as JWTs. Without guidance from standards, however, they ended up producing as many incompatible variants.<br/>This article is the story of how this issue bugged me so much that I took it on myself to work with the IETF standards community to try fixing it, culminating in the publication of a new standard document describing how to encode and validate an OAuth 2.0 AT in JWT format.<br/>I am taking this opportunity to give you a glimpse of how the standardization process works, but most importantly: I hope this will show you that today anyone has the power to contribute to the community.</p><h2 id="Preamble--Why-Are-Issuers-Encoding-Access-Tokens-as-JWTs-">Preamble: Why Are Issuers Encoding Access Tokens as JWTs?</h2><p>In the first version of OAuth, the access token issuer and the resource-consuming it (service provider and the protected resource, respectively, in OAuth 1 parlance) were co-located: the consumer (old name for client) would request an access token from <code>https<span>:</span><span>/</span><span>/</span>photos<span>.</span>example<span>.</span>net<span>/</span>access\_token<span>?.</span><span>.</span></code> and use it to access the resource at <code>http<span>:</span><span>/</span><span>/</span>photos<span>.</span>example<span>.</span>net<span>/</span>photo<span>?.</span><span>.</span></code>.</p><p>OAuth 2 introduced better role separation, making it possible for the authorization server (AS) and resource server (RS) to live on different domains and be run by different owners. However, the scenario where AS and RS live together was still the quintessential use case, think Google issuing tokens to protect Google APIs.</p><p>When the token issuer and token consumer are essentially the same entity, validating tokens is an easy problem (see Figure 1). Say that a client asks and obtains delegated authorization to read your Google Calendar. At authorization request time, Google can write somewhere in its backend that you granted consent for that client, and return as AT the ID of the row where it recorded your preference. When the client wants to access the calendar, it just presents the AT to the API: the API turns around, looks up the ID in the DB it shares with the AS, and consults the record to decide whether to grant access. This is definitely oversimplified (and I have no insight on how google really does things, I just picked a relatable example) but should give a rough idea.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/IJRZvuawYe651McJaKsjP/92c105976b851db0c78c93ebc0cad3a7/Uploaded_from_From_Idea_to_Standard__How_the_JWT_Profile_for_OAuth_2" alt="Authorization"/>
<em>Figure 1: if authorization server and resource server are co-located, access tokens are easy to validate</em></p><p>This trick clearly doesn‚Äôt work if the AS and RS are separate and don‚Äôt share any common state (figure 2). Just like it‚Äôs common for web apps to outsource authentication to a separate entity, it‚Äôs common for API to integrate with 3rd party services (such as IDaaS, local IdP software, etc) running elsewhere. And of course, APIs can be deployed anywhere (Lambda, Azure Functions, etc). The case in which AS and RS are separate is completely mainstream nowadays.</p><p>Imagine you are such an API. A caller sends you a request, including an AT allegedly indicating that they should be authorized to perform that request. Strictly adhering to the core spec, the AT is just an opaque blob. How are you going to determine whether you should serve the request?</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5B0yuKwp0LC2pCHIic9gJa/325c4684cffbda80ce45df58d41064de/Uploaded_from_From_Idea_to_Standard__How_the_JWT_Profile_for_OAuth_2" alt="API"/>
<em>Figure 2: if the authorization server and resource server are separate and distinct entities, the API needs an explicit strategy for validating access tokens.</em></p><p>Absent the luxury of shared state with the AS, you mostly have two alternatives: calling back the AS asking for help, or trying to make that determination by looking at the AT content. Neither approach were included in the core OAuth 2 specification.</p><ul><li>The ‚Äúcalling back the AS asking for help‚Äù route is known as <em>introspection</em>. The idea is that your API can open a direct SSL channel with the AS, present the AT and find out whether the token is valid, what relevant information it contains/refers to, and so on.<br/>That‚Äôs a perfectly valid method, which has the advantage of immediately reflecting the revocation state of a token. It does however come with some tradeoffs: doing network IO from the API every time it gets a token is expensive, and puts network latency/failures/throttling risks on the API critical path. It‚Äôs expensive for the AS, too.</li><li>The ‚Äúlooking at the AT content‚Äù route is just an extension of what other boundary-crossing protocols have been doing for decades. If AS and the RS/API can agree on a format for encoding ATs, and associated validation methods, the API can now independently validate the incoming AT, without depending on network performance, AS availability, throttling, and so on. This approach is extraordinarily popular, adopted by hyperscale IDaaS and nimble SDKs alike.</li></ul><p>That hopefully clarifies why it‚Äôs handy to use a format for ATs. Why JWT in particular? I believe that‚Äôs because most AS also implement OpenID Connect, hence already needed to use the JWT format to issue ID tokens. Same deal on the consumer side: lots of OpenID Connect SDKs relying on lower-level components implementing JWT, at the ready to be used in APIs.<br/>Whatever the reason, everywhere I looked I saw products and companies issuing ATs as JWTs: and that‚Äôs where our story begins.</p><h2 id="Framing-the-Problem--JWT--JWT-ATs-Everywhere">Framing the Problem: JWT, JWT ATs Everywhere</h2><p>Throughout my years of tenure at Microsoft, I have consistently seen API calls secured using tokens in a known format, JWT in particular. I helped many product teams build features predicated on that, and hundreds of customers to achieve their goals via architectures that included encoding access tokens as JWTs. Doing so wasn‚Äôt against any standards, it just didn‚Äôt benefit from standard guidance. All the practices and implementation decisions had to be derived from the concrete experience of running solutions predicated on that approach.</p><p>When I moved to Auth0, I found the approach used to secure the customer‚Äôs API to be very similar to the one I was already used to. Two hyperscale services, handling API authorization in the same way‚Ä¶ make you think, doesn‚Äôt it?<br/>And yet, there were small differences- details that made reusing exactly the same SDKs to handle the two different JWT ATs impossible. For example, Azure AD placed the scopes granted to the client in a claim called scp, whereas Auth0 used a claim called scope. Exact same functionality, but incompatible formats for a pure matter of formatting. Makes you think some more! If other well-adopted vendors are using JWT to encode ATs, and are all mostly sending the same info with some minor syntactic differences, perhaps devising a common profile might be a good thing! It was a hypothesis worth investigating.</p><p>In March 2019 I reached out to friends and contacts working at key providers I knew were using JWT as AT format. I explained my hypothesis and asked if they‚Äôd share with me sample ATs.</p><p>I got answers and samples from Dominick Baier (IdentityServer), Brian Campbell (PingIdentity), Daniel Dobalian (Microsoft), Karl McGuinness (Okta- this was years before the merger news) and I of course sourced Auth0 ATs myself. For good measure, I threw in JWT ATs from AWS as extracted from their public documentation.</p><p>Putting all the AT claims in a table, I found more similarities than differences.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/KtfrSGPakBBawFDXtV4p8/123efc182d522ca0783c0e0432308a7c/Uploaded_from_From_Idea_to_Standard__How_the_JWT_Profile_for_OAuth_2" alt="Table"/></p><p>I found that the claims could be roughly classified into 4 categories:</p><ul><li>Validation. Structural claims used to validate the token, largely echoing the ones defined by OpenID Connect for IDTokens</li><li>Identity. Contrary to popular belief, which insists on ATs being exclusively (delegated) authorization constructs, nearly everyone included identity attributes (and the one instance who didn‚Äôt, allowed them as optional)</li><li>Authorization. Besides the scope claim, present in all samples albeit in varying formats, various providers allowed the inclusion of other classic authorization artifacts (groups, roles)</li><li>Context/misc. A loose category carrying miscellaneous information, with some common elements like client identifiers and authentication methods info.</li></ul><p>This further confirmed my hypothesis that everyone was roughly pursuing the same goals and using the same attributes, but just happened to use a different syntax for pure happenstance.</p><p>To me that was interesting evidence that deserved being shared with the OAuth community. Luckily, there was just the right forum coming up: the OAuth Security Workshop.</p><h2 id="Probing-Interest--the-Stuttgart-Pitch">Probing Interest: the Stuttgart Pitch</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5abeLJalBQD6VdWUsuwmfZ/e3fcb24b09fb6c097604dec414986afd/Uploaded_from_From_Idea_to_Standard__How_the_JWT_Profile_for_OAuth_2" alt="Stuttgart Pitch"/></p><p>In late March 2019, I flew to Stuttgart, Germany, to attend the OAuth Security Workshop. It is a fantastic conference, a watering hole toward which the most brilliant (and generous) experts in the OAuth community converge once a year. That made it the absolute ideal place and time to explore whether others saw the problem and the opportunity.</p><p>I grabbed a one-hour slot and presented my research. You can still find the deck I used <a href="https://osw2019.sec.uni-stuttgart.de/documents/slides/bertocci_-_a_jwt_profile_for_ats.pptx" target="_blank" rel="noreferrer noopener">here</a>.<br/>I got a lot of nodding, the room definitely already knew what I was talking about: the data I presented was consistent with their experience. I did one more session on the topic, this time focusing on what an interop profile could look like, and got tons of enthusiastic contributions to it. <a href="https://twitter.com/tlodderstedt/status/1109118437006196737?s=20" target="_blank" rel="noreferrer noopener">The interest was there</a>: it was time to get serious about starting formal work on the problem.<br/>The IETF was going to meet just a few days later for IETF104: the OAuth chairs were open to let me put this in front of the working group via remote presentation, but in order to do that I had to jot down my proposal as an &#34;individual draft&#34; (see below). That‚Äôs where I started to realize just how much process I was going to have to deal with!</p><h2 id="From-Individual-Draft-to-Working-Group-Adoption--IETF-104">From Individual Draft to Working Group Adoption: IETF 104</h2><p>Have you ever seen an RFC? They live at addresses like <a href="https://datatracker.ietf.org/doc/html/rfc9068" target="_blank" rel="noreferrer noopener">https://datatracker.ietf.org/doc/html/rfc9068</a> and have a characteristic look (tho they can be visualized in many formats).</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2oWuv172MyYRrXqkrGlDMK/da9b0705fd051e6485bba5934692fd5c/Uploaded_from_From_Idea_to_Standard__How_the_JWT_Profile_for_OAuth_2" alt="RFC"/></p><p>As it turns out, documents that eventually become RFCs usually start their life as an <em>individual draft</em>, containing an initial proposal of an author on how to tackle something that, in the author‚Äôs opinion, deserves to become formal guidance. That is a document that must be authored in a very specific format and must be submitted using the tooling and processes that the IETF provides (and enforces). The result is something that looks very similar to an RFC, as it looks the same and lives on the IETF pages, but that at this stage has <em>no formal weight whatsoever</em>. For a funny example, <a href="https://datatracker.ietf.org/doc/html/draft-abr-twitter-reply-00" target="_blank" rel="noreferrer noopener">check this out</a> (and <a href="https://datatracker.ietf.org/doc/html/draft-wkumari-not-a-draft-14" target="_blank" rel="noreferrer noopener">this one</a>, too).</p><p>Nonetheless, an individual draft was what I had to produce in order to even suggest the idea to the IETF meeting. I had to do it FAST, likely while on the plane back from Germany. And I had to do it right, given that anything incorrectly formatted would have been rejected by the uploading tools.</p><p>I took a look at the official guidance <a href="https://www.ietf.org/standards/ids/guidelines/" target="_blank" rel="noreferrer noopener">here</a>, and it was just overwhelming. Luckily, the identity community is full of good people who are generous with their time. My good friend Brian Campbell was incredibly helpful, leading me through the labyrinth of tools, options, and templates, helping me to troubleshoot when things broke down, and in general, making it possible for me to produce a draft on time for the presentation.</p><p>As is the case for all things IETF, where the story of everything is pretty much always available, you can still find that first individual draft at <a href="https://datatracker.ietf.org/doc/html/draft-bertocci-oauth-access-token-jwt" target="_blank" rel="noreferrer noopener">https://datatracker.ietf.org/doc/html/draft-bertocci-oauth-access-token-jwt</a>. At that point that was just my own thoughts, not reflecting any working group discussion. A true individual draft. The secret to recognizing those is to look at the name of the file. If it‚Äôs of the form draft-&lt; lastname &gt;-*, it‚Äôs just the opinion of the author- nothing more.</p><p>Once I uploaded the draft, an automated mail informed the OAuth WG mailing list of its existence and location. Shortly after, I gave my presentation at the IETF104 conference: you can find the rather terse minutes <a href="https://datatracker.ietf.org/doc/minutes-104-oauth/" target="_blank" rel="noreferrer noopener">here</a>. It was well-received there, too, but the real test came a few days after the conference. The working group chairs sent a message to the mailing list, issuing what is known as a call for adoption: the group members are asked to share whether they accept or object to the adoption of the draft document as a starting point for work in the OAuth working group. To my delight, the support for the adoption was strong- no one objected, and <a href="https://twitter.com/vibronet/status/1120382180029423616?s=20" target="_blank" rel="noreferrer noopener">the motion passed</a>. I re-submitted the draft, which changed into <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-access-token-jwt-00" target="_blank" rel="noreferrer noopener">https://datatracker.ietf.org/doc/html/draft-<strong>ietf</strong>-oauth-access-token-jwt-00</a>. That‚Äôs another stage of our pokemon here: from the individual draft, the document turned into an <strong><em>internet</em> draft</strong>. When you see a document whose name is in the form draft-ietf-*[-&lt; digits &gt;], you know it‚Äôs a document that is being worked on by a working group. That is NOT yet a standard, it is still very likely to change, but already received some degree of scrutiny (at the very least, it successfully went through a call for adoption as a work item).</p><p>That was when the REAL fun began.</p><h2 id="The-Working-Group-Discussion">The Working Group Discussion</h2><p>The raison d‚Äôetre of this work was that one important area of OAuth was left underspecified, so I was strongly motivated to swing the pendulum in the other direction and generate truly actionable guidance that would help developers achieve an end to end interop in no uncertain terms. That meant going beyond just defining the layout of an AT encoded as a JWT, but also defining how the authorization server should take request parameters into account when populating ATs, and providing clear guidance about how resource servers should validate JWT ATs. On top of that, there were years of lessons learned in terms of security and privacy practices that had to be codified in the spec recommendations. All noble goals! As I was about to discover, however, the cost of consensus doesn‚Äôt grow linearly with the amount of stuff a group needs to agree on: if it‚Äôs not exponential, it‚Äôs pretty darn close.</p><p>I contributed to the discussion on the working group many times before, but this was the first time I felt responsible to ensure things moved forward and in the right way. No more <a href="https://en.wikipedia.org/wiki/Bystander_effect" target="_blank" rel="noreferrer noopener">bystander effect</a>!</p><p>I don‚Äôt want to bore you with a detailed chronicle of how the discussion went, but just give you a feel of what the process looks like. In broad strokes, it was something along the lines of</p><ol start="1"><li>Send to the mailing list a writeup about some detail of the document, proposing something or seeking opinions: whether a certain claim should be optional or mandatory, whether a certain recommendation should be included in the security considerations, and so on. At times, someone else will do this- asking a question about the document, sharing an opinion.</li><li>Actively engage in the discussion, soliciting points of view, asking for clarifications, summarizing to steer toward consensus or uncover remaining disagreements, spawn separate threads when necessary, facilitate closure when things don‚Äôt seem to converge on their own</li><li>Reflect the outcome of the conversations in the draft and upload new versions</li><li>At key milestones (IETF F2F events, conferences, etc) present to the group in high bandwidth settings, bringing up issues that are hard to close in email form</li><li>Repeat as many times as it is necessary to reach a form that enjoys widespread consensus, no longer generates disagreements</li></ol><p>I found all of the above a challenging, humbling, and profoundly formative experience.</p><p>One of the most important lessons I got was that I didn&#39;t know nearly as much as I thought on the topic. After years of hands-on experience using JWT ATs with many customers in the most diverse circumstances, I thought the bulk of the work was going to be putting down that experience in spec form. Goodness was I wrong. I think I did supply a solid starting point, but I was absolutely blown away by the diversity of viewpoints, goals, scenarios, and ways to look at the problem that were just as valid and backed by concrete experience as mine. The working group sports some really, really smart members. Luckily I was fully committed to identifying the right guidance and channel consensus rather than ‚Äúbeing right‚Äù, so I genuinely enjoyed learning those things - even when they required some reframing.</p><p>Extracting the insight was not always easy. Not everyone follows the discussion closely (we all have day jobs) so it wasn‚Äôt uncommon for someone to comment on something that has been already discussed, often presenting the same arguments - to which I had to either summarize the outcome of the discussion and/or provide pointers to the relevant threads in the mail archive, hoping they would read it before diving further. Of course that occasionally caused people unsatisfied with the outcome of the former discussion to give it another shot, relitigating issues large and small in what at times felt like a Sisyphean task. I remember the chill in my spine when during the QA of my presentation at an in-person IETF meeting, someone walked up to the microphone and opened with ‚ÄúI didn‚Äôt read the specification or follow the discussion, but here there‚Äôs my take on this‚Ä¶‚Äù :D that caused an avalanche of comments along those lines, largely repeating a discussion that already occurred on the mailing list, and ate all the precious face time I had. ARGH :D</p><p>For a while, it looked like most of the work was on tracking down, digesting, and curating context and content to ensure that the opinions being shared were well informed rather than the result of incomplete understanding. Throw in the mix the occasional individual pursuing their own agenda regardless of what spec is being discussed, and you get the picture. Ultimately, things always worked out in a way or another- but it was HARD. I admit that for a while seeing new messages appear in the OAUTH WG folder in my inbox caused me little anxiety spikes :‚Äô)</p><p>But, as I said- formative experience. I developed a stoic stance toward the endeavor, resolving to do my best without expecting fast progress. There was incredible insight being shared in the discussion, and even if the process felt at times painful, I had faith in its ability to eventually distill the collective wisdom.</p><h2 id="The-Last-Stretch--Last-Calls--IESG--RFC-Editor">The Last Stretch: Last Calls, IESG, RFC Editor</h2><h3 id="Working-Group-Last-Call-s-">Working Group Last Call(s)</h3><p>At a certain point in the process, the working group chairs establish that the draft is close enough to completion, and issue what it‚Äôs known as a working group last call (WGLC): it basically says that if by a certain date no one had anything of substance to discuss, the draft will move to the next stage. My spec went through not one, but THREE WGLCs.</p><p>The first one, issued on March 23, 2020, and ending on April 6, 2020, generated LOTS of comments from many people, on fundamental matters.</p><p>The second, from 4/15 to 4/29, got less substantive traffic but still useful observations. It also got WAY more drama than I would have ever expected to witness in the process of developing a standard, but there‚Äôs no point rehashing any of that here. The mailing list records are public, and you can always catch me at some conference to get a TL;DR- especially if I have an adult beverage in my hands.</p><p>The third one, from 5/5 to 5/12, was meant to be the last, last‚Ä¶ but in fact, the next stage didn‚Äôt really start in earnest until <a href="https://twitter.com/dzhuvi/status/1354101508187578368?s=21" target="_blank" rel="noreferrer noopener">January 2021</a>.</p><h3 id="The-IESG">The IESG</h3><p>The next stage is a review from the IESG, a group of experts (area directors) with scope beyond OAuth that will give very detailed commentary and formally vote whether to move the doc forward or if they need to get further clarifications.</p><p>In order to pass the buck to IESG, the working group chair has to produce a ‚Äúshepherd writeup‚Äù- basically a backgrounder preempting a fixed series of questions about the specification, from the standard track the document is in, to whether all the intellectual properties considerations have been cleared. Mine was authored and submitted in October 2020 by the always excellent Hannes Tschofenig, you can find it <a href="https://datatracker.ietf.org/doc/draft-ietf-oauth-access-token-jwt/shepherdwriteup/" target="_blank" rel="noreferrer noopener">here</a>.</p><p>One particularly interesting aspect the shepherd writeup needs to cover is whether there are already implementations of the draft in actual products- I was delighted to discover that there were already FOUR products offering support for the profile! There was <a href="https://leastprivilege.com/2020/06/15/the-jwt-profile-for-oauth-2-0-access-tokens-and-identityserver/" target="_blank" rel="noreferrer noopener">IdentityServer</a>, Filip Skokan‚Äôs Node <a href="https://github.com/panva/node-oidc-provider" target="_blank" rel="noreferrer noopener">OIDC library</a>, <a href="https://connect2id.com/products/server/docs/datasheet#access-token-encoding-jwt" target="_blank" rel="noreferrer noopener">ConnectID</a>, <a href="https://github.com/babelouest/glewlwyd/blob/master/docs/OIDC.md#access-token-format" target="_blank" rel="noreferrer noopener">Glewlwyd OIDC plugin</a>... That placed a huge smile on my face.</p><p>The <a href="https://twitter.com/oauth_2/status/1432731166440759301?s=20" target="_blank" rel="noreferrer noopener">IESG review went very smoothly</a>. As expected, some of the questions were repeats of things already discussed; others were brand new, and very insightful. And there were LOTS of them, it was a thorough combing. What made it go smoothly was that every reviewer was familiar with the process, paid very close attention to the replies, and relentlessly drove toward resolution. I was pretty worried about that phase, but it turned out to be one of the best parts of this experience.</p><h3 id="RFC-Editor-and-Publication">RFC Editor and Publication</h3><p>After their approval, the last stage (I am skipping some stuff here, notably the IANA parts pertaining to the registration of new media and claim types the spec defines) was the RFC editor- an extraordinarily thorough editorial review, for some reason (and confusingly, for identity people) called AUTH48, where the author is asked to review every proposed edit (all good edits that enhance clarity). Once that‚Äôs done, the document receives a number and becomes an official IETF standard, assuming the characteristic <a href="https://datatracker.ietf.org/doc/html/rfc9068" target="_blank" rel="noreferrer noopener">https://datatracker.ietf.org/doc/html/rfc9068</a> form.</p><p>The publication happened during the AuthenticateCon/FIDO plenary conference - that made me miss the magical window for tweeting about it (<a href="https://twitter.com/selfissued/status/1451352723853504514?s=21" target="_blank" rel="noreferrer noopener">Mike did the honors</a>) but it also created the awesome opportunity to <a href="https://twitter.com/vibronet/status/1451406207206375424?s=20" target="_blank" rel="noreferrer noopener">celebrate on that very evening</a> with many of my identity friends, also in town for the conference.</p><h2 id="Where-to-Go-from-Here">Where to Go from Here</h2><p>Our brief tour de force showed us how it really is possible to go from an idea, a pet peeve to an official standard. Even better, if you exclude the time I and the other WG members offered when working on this, and the occasional trip to in-person IETF events, this was substantially free - no hefty corporate membership required. The rational question you should ask, dear reader, is: was it worth it?</p><p>After all this brouhaha to make the JWT profile a standard, everyone‚Äôs going to drop what they‚Äôre doing and change their existing JWT encoding logic for ATs to comply with the profile, right? ...right?</p><p>Not likely. What companies have today, my starting point, already works for their scenarios. Moreover, their customers are taking at least some degree of dependency on it. The incentive for a wholesale swap isn‚Äôt strong. But frankly, it was never the main point of standardizing this. Describing what a JWT AT would look like in the platonic ideal scenario gave the working group a chance to provide guidance on the security and privacy implications of using a JWT (and, more generally, a parseable format) for encoding ATs. That‚Äôs guidance that can be successfully applied to existing solutions, without having to fully commit to the profile in its entirety. Furthermore, the profile provides an authoritative reference for important functionality ATs are expected to perform: if all existing implementations pick up from rfc9068 is what claim type and format to use to transmit scopes, opening the way for SDKs to offer scope based policies reliably applicable to multiple vendors, that alone would be worth the effort of pushing this heavy boulder to completion.<br/>And of course, new SDK work will hopefully build on the guidance. There are already products supporting the profile: besides the four products I listed earlier in this post, Auth0‚Äôs very own Node JS API middleware offers a strict option that will enforce the profile.</p><p>To me, that makes all the effort absolutely worth it. The process might be at times frustrating, maddeningly slow‚Ä¶ but it is open, thorough, and effective. It‚Äôs not perfect and it doesn‚Äôt yield perfect results, but it‚Äôs pretty much the best we have today. I feel grateful to have had (and have) the chance to contribute. I am constantly amazed at the generosity of so many world-class identity experts freely offering their insights: besides the chance of steering the community in the right direction, all they can hope for is an entry in the spec‚Äôs acknowledgment section, with a non zero chance to have their names misspelled.</p><p>I hope this was more inspiring than discouraging. If you are interested in contributing to the IETF standards work, please always feel free to reach out at <a href="https://twitter.com/vibronet" target="_blank" rel="noreferrer noopener">twitter.com/vibronet</a>: I received so much help that I don‚Äôt think I‚Äôll ever be able to pay it back. Your experience and scenarios are important, and I assure you many people are eager to hear about them!</p><p><em>Thanks to Aaron Parecki for his thorough review and feedback on this article!</em></p></div></div>]]></content:encoded>
      <pubDate>Thu, 04 Nov 2021 15:25:00 +0000</pubDate>
    </item>
    <item>
      <title>Full Stack Java with React, Spring Boot, and JHipster</title>
      <link>https://auth0.com/blog/full-stack-java-with-react-spring-boot-and-jhipster/</link>
      <description>This tutorial shows you how to create a slick-looking, full-stack, secure application using React, Spring Boot, and JHipster.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>If you search for &#34;Full Stack Java&#34; on the internet, you&#39;ll likely find a lot of recruiting, courses, and jobs. Being a full-stack developer can be exciting because you can create the backend and frontend of an app all by yourself. There is business logic and algorithms as well as like styling, making things look good, and securing everything. It also pays pretty well. Today, I&#39;m going to show you how you can be a full-stack Java developer with Spring Boot, React, and JHipster.</p><p><strong>Prerequisites:</strong></p><ul><li><a href="https://nodejs.org/" target="_blank" rel="noreferrer noopener">Node.js 14+</a></li><li><a href="https://sdkman.io" target="_blank" rel="noreferrer noopener">Java 11+</a></li><li><a href="https://docs.docker.com/compose/install/" target="_blank" rel="noreferrer noopener">Docker Compose</a></li></ul><p>If you&#39;re on Windows, you may need to install the <a href="https://docs.microsoft.com/en-us/windows/wsl/about" target="_blank" rel="noreferrer noopener">Windows Subsystem for Linux</a> for some commands to work.</p><p>I recommend using SDKMAN to manage your OpenJDK installations. Just run <code>sdk install java <span>11.0</span><span>.2</span><span>-</span>open</code> to install Java 11 and <code>sdk install java <span>17</span><span>-</span>open</code> for Java 17.</p><p>This tutorial won&#39;t provide the nitty-gritty details on how to write code in Java, React, or Spring Boot. That&#39;s because JHipster will write most of the code for you! However, if you&#39;re brand new to programming with these technologies, I recommend the following resources:</p><ul><li><a href="https://dev.java/learn/" target="_blank" rel="noreferrer noopener">Oracle&#39;s Learn Java Tutorials</a></li><li><a href="https://spring.io/guides" target="_blank" rel="noreferrer noopener">Spring Guides</a></li><li><a href="https://reactjs.org/tutorial/tutorial.html" target="_blank" rel="noreferrer noopener">Tutorial: Intro to React</a></li></ul><p>You can skip around between sections of this tutorial using the table of contents below. </p><p>You can also clone <a href="https://github.com/oktadev/auth0-full-stack-java-example" target="_blank" rel="noreferrer noopener">the completed example</a> and follow along that way.</p><pre><code>git clone https<span>:</span><span>/</span><span>/</span>github<span>.</span>com<span>/</span>oktadev<span>/</span>auth0<span>-</span>full<span>-</span>stack<span>-</span>java<span>-</span>example</code></pre><h2 id="Full-Stack-Development-with-React-and-Spring-Boot">Full Stack Development with React and Spring Boot</h2><p>One of the easiest ways to get started with React is by using <a href="https://create-react-app.dev/" target="_blank" rel="noreferrer noopener">Create React App</a> (CRA). You install it locally, then run <code>create<span>-</span>react<span>-</span>app <span>&lt;</span>project<span>&gt;</span></code> to generate a React application with minimal dependencies. It uses webpack under-the-covers to build the project, launch a web server, and run its tests.</p><p>Spring Boot has a similar tool called <a href="https://start.spring.io/" target="_blank" rel="noreferrer noopener">Spring Initializr</a>. Spring Initializer is a bit different than CRA because it&#39;s a website (and API) that you can create applications with.</p><p>Today, I&#39;ll show you how to build a Flickr clone with React and Spring Boot. However, I&#39;m going to cheat. Rather than building everything using the aforementioned tools, I&#39;m going to use JHipster. JHipster is an application generator that initially only supported Angular and Spring Boot. Now it supports Angular, React, and Vue for the frontend. JHipster also has support for <a href="https://www.jhipster.tech/modules/official-blueprints/" target="_blank" rel="noreferrer noopener">Kotlin, Micronaut, Quarkus, .NET, and Node.js</a> on the backend.</p><p>In this tutorial, we&#39;ll use React since it seems to be <a href="https://trends.google.com/trends/explore?q=angular,react,vuejs" target="_blank" rel="noreferrer noopener">the most popular</a> frontend framework nowadays. </p><h2 id="Get-Started-with-JHipster-7">Get Started with JHipster 7</h2><p>If you haven&#39;t heard of <a href="https://www.jhipster.tech" target="_blank" rel="noreferrer noopener">JHipster</a>, boy do I have a treat for you! JHipster started as a Yeoman application generator back in 2013 and has grown to become a development platform. It allows you to quickly generate, develop, and deploy modern web apps and microservice architectures. Today, I&#39;ll show you how to build a Flickr clone with JHipster and lock it down with OAuth and OpenID Connect (OIDC).</p><p>To get started with JHipster, you&#39;ll need a fast internet connection and Node.js installed. The project recommends you use the latest LTS (Long Term Support) version, which is 14.7.6 at the time of this writing. To run the app, you&#39;ll need to have Java 11 installed. If you have Git installed, JHipster will auto-commit your project after creating it. This will allow you to upgrade between versions.</p><p>Run the following command to install JHipster:</p><pre><code><span>npm</span> i -g generator-jhipster@7</code></pre><p>To create a full-stack app with JHipster, create a directory, and run <code>jhipster</code> in it:</p><pre><code><span>mkdir</span> full-stack-java
<span>cd</span> full-stack-java
jhipster</code></pre><p>JHipster will prompt you for the type of application to create and what technologies you&#39;d like to include. For this tutorial, make the following choices:</p><table><thead><tr><th>Question</th><th>Answer</th></tr></thead><tbody><tr><td>Type of application?</td><td><code>Monolithic application</code></td></tr><tr><td>Name?</td><td><code>flickr2</code></td></tr><tr><td>Spring WebFlux?</td><td><code>No</code></td></tr><tr><td>Java package name?</td><td><code>com<span>.</span>auth0<span>.</span>flickr2</code></td></tr><tr><td>Type of authentication?</td><td><code>OAuth <span>2.0</span> <span>/</span> <span>OIDC</span></code></td></tr><tr><td>Type of database?</td><td><code><span>SQL</span></code></td></tr><tr><td>Production database?</td><td><code>PostgreSQL</code></td></tr><tr><td>Development database?</td><td><code><span>H2</span> <span>with</span> disk<span>-</span>based persistence</code></td></tr><tr><td>Which cache?</td><td><code>Ehcache</code></td></tr><tr><td>Use Hibernate 2nd level cache?</td><td><code>Yes</code></td></tr><tr><td>Maven or Gradle?</td><td><code>Maven</code></td></tr><tr><td>Use the JHipster Registry?</td><td><code>No</code></td></tr><tr><td>Other technologies?</td><td><code><span>&lt;</span>blank<span>&gt;</span></code></td></tr><tr><td>Client framework?</td><td><code>React</code></td></tr><tr><td>Admin UI?</td><td><code>Yes</code></td></tr><tr><td>Bootswatch theme?</td><td><code>United</code> &gt; <code>Dark</code></td></tr><tr><td>Enable i18n?</td><td><code>Yes</code></td></tr><tr><td>Native language of application?</td><td><code>English</code></td></tr><tr><td>Additional languages?</td><td>Your choice!</td></tr><tr><td>Additional testing frameworks?</td><td><code>Cypress</code></td></tr><tr><td>Install other generators?</td><td><code>No</code></td></tr></tbody></table><p>Press <strong>Enter</strong>, and JHipster will create your app in the current directory and run <code>npm install</code> to install all the dependencies specified in <code><span>package</span><span>.</span>json</code>.</p><h3 id="Verify-Everything-Works-with-Cypress-and-Keycloak">Verify Everything Works with Cypress and Keycloak</h3><p>When you choose OAuth 2.0 and OIDC for authentication, the users are stored outside of the application rather than in it. You need to configure an identity provider (IdP) to store your users and allow your app to retrieve information about them. By default, JHipster ships with a Keycloak file for Docker Compose. A default set of users and groups is imported at startup, and it has a client registered for your JHipster app.</p><p>Here&#39;s what the <code>keycloak<span>.</span>yml</code> looks like in your app&#39;s <code>src<span>/</span>main<span>/</span>docker</code> directory:</p><pre><code><span># This configuration is intended for development purpose; it&#39;s **your** responsibility</span>
<span># to harden it for production</span>
<span>version</span><span>:</span> <span>&#39;3.8&#39;</span>
<span>services</span><span>:</span>
  <span>keycloak</span><span>:</span>
    <span>image</span><span>:</span> jboss/keycloak<span>:</span>15.0.2
    <span>command</span><span>:</span>
      <span>[</span>
          <span>&#39;-b&#39;</span><span>,</span>
          <span>&#39;0.0.0.0&#39;</span><span>,</span>
          <span>&#39;-Dkeycloak.migration.action=import&#39;</span><span>,</span>
          <span>&#39;-Dkeycloak.migration.provider=dir&#39;</span><span>,</span>
          <span>&#39;-Dkeycloak.migration.dir=/opt/jboss/keycloak/realm-config&#39;</span><span>,</span>
          <span>&#39;-Dkeycloak.migration.strategy=OVERWRITE_EXISTING&#39;</span><span>,</span>
          <span>&#39;-Djboss.socket.binding.port-offset=1000&#39;</span><span>,</span>
          <span>&#39;-Dkeycloak.profile.feature.upload_scripts=enabled&#39;</span><span>,</span>
      <span>]</span>
    <span>volumes</span><span>:</span>
      <span>-</span> ./realm<span>-</span>config<span>:</span>/opt/jboss/keycloak/realm<span>-</span>config
    <span>environment</span><span>:</span>
      <span>-</span> KEYCLOAK_USER=admin
      <span>-</span> KEYCLOAK_PASSWORD=admin
      <span>-</span> DB_VENDOR=h2
    <span># If you want to expose these ports outside your dev PC,</span>
    <span># remove the &#34;127.0.0.1:&#34; prefix</span>
    <span>ports</span><span>:</span>
      <span>-</span> 127.0.0.1<span>:</span>9080<span>:</span><span>9080</span>
      <span>-</span> 127.0.0.1<span>:</span>9443<span>:</span><span>9443</span>
      <span>-</span> 127.0.0.1<span>:</span>10990<span>:</span><span>10990</span></code></pre><p>Start Keycloak with the following command in your project&#39;s root directory.</p><pre><code>docker-compose -f src/main/docker/keycloak.yml up -d</code></pre><p>You can verify everything works by starting your app with Maven:</p><pre><code>./mvnw</code></pre><p>Open another terminal to run your new app&#39;s Cypress tests:</p><pre><code><span>npm</span> run e2e</code></pre><p>You should see output like the following:</p><pre><code>  <span>(</span>Run Finished<span>)</span>

       Spec                                              Tests  Passing  Failing  Pending  Skipped
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ ‚úî  administration/administration.spec.      00:12        <span>5</span>        <span>5</span>        -        -        - ‚îÇ
  ‚îÇ    ts                                                                                          ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚úî  All specs passed<span>!</span>                        00:12        <span>5</span>        <span>5</span>        -        -        -</code></pre><h2 id="Change-Your-Identity-Provider-to-Auth0">Change Your Identity Provider to Auth0</h2><p>JHipster uses Spring Security&#39;s OAuth 2.0 and OIDC support to configure which IdP it uses. When using Spring Security with Spring Boot, you can configure most settings in a properties file. You can even override properties with environment variables.</p><p>To switch from Keycloak to Auth0, you only need to override the default properties (for Spring Security OAuth). You don&#39;t even need to write any code!</p><p>To see how it works, create a <code><span>.</span>auth0<span>.</span>env</code> file in the root of your project, and fill it with the code below to override the default OIDC settings:</p><pre><code><span>export</span> <span>SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_OIDC_ISSUER_URI</span><span>=</span>https://<span>&lt;</span>your-auth0-domain<span>&gt;</span>/
<span>export</span> <span>SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_ID</span><span>=</span><span>&lt;</span>your-client-id<span>&gt;</span>
<span>export</span> <span>SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_SECRET</span><span>=</span><span>&lt;</span>your-client-secret<span>&gt;</span>
<span>export</span> <span>JHIPSTER_SECURITY_OAUTH2_AUDIENCE</span><span>=</span>https://<span>&lt;</span>your-auth0-domain<span>&gt;</span>/api/v2/</code></pre><p>‚ö†Ô∏è <strong>WARNING:</strong> Modify your existing <code><span>.</span>gitignore</code> file to have <code><span>*</span><span>.</span>env</code> so you don&#39;t accidentally check in your secrets!</p><p>You&#39;ll need to create a new web application in Auth0 and fill in the <code><span>&lt;</span><span>...</span><span>&gt;</span></code> placeholders before this works. </p><h3 id="Create-an-OpenID-Connect-App-on-Auth0">Create an OpenID Connect App on Auth0</h3><p>Log in to your Auth0 account (or <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">sign up</a> if you don&#39;t have an account). You should have a unique domain like <code>dev<span>-</span>xxx<span>.</span>eu<span>.</span>auth0<span>.</span>com</code>. </p><p>Press the <strong>Create Application</strong> button in <a href="https://manage.auth0.com/#/applications" target="_blank" rel="noreferrer noopener">Applications section</a>. Use a name like <code>JHipster Baby<span>!</span></code>, select <code>Regular Web Applications</code>, and click <strong>Create</strong>.</p><p>Switch to the <strong>Settings</strong> tab and configure your application settings:</p><ul><li>Allowed Callback URLs: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>login<span>/</span>oauth2<span>/</span>code<span>/</span>oidc</code></li><li>Allowed Logout URLs: <code>http<span>:</span><span>/</span><span><span>/</span><span>localhost:8080</span><span>/</span></span></code></li></ul><p>Scroll to the bottom and click <strong>Save Changes</strong>.</p><p>In the <a href="https://manage.auth0.com/#/roles" target="_blank" rel="noreferrer noopener">roles</a> section, create new roles named <code><span>ROLE_ADMIN</span></code> and <code><span>ROLE_USER</span></code>.</p><p>Create a new user account in the <a href="https://manage.auth0.com/#/users" target="_blank" rel="noreferrer noopener">users</a> section. Click on the <strong>Role</strong> tab to assign the roles you just created to the new account. </p><p><em>Make sure your new user&#39;s email is verified before attempting to log in!</em></p><p>Next, head to <strong>Auth Pipeline</strong> &gt; <strong>Rules</strong> &gt; <strong>Create</strong>. Select the <code>Empty rule</code> template. Provide a meaningful name like <code>Group claims</code> and replace the Script content with the following.</p><pre><code><span>function</span><span>(</span><span>user<span>,</span> context<span>,</span> callback</span><span>)</span> <span>{</span>
  user<span>.</span>preferred_username <span>=</span> user<span>.</span>email<span>;</span>
  <span>const</span> roles <span>=</span> <span>(</span>context<span>.</span>authorization <span>||</span> <span>{</span><span>}</span><span>)</span><span>.</span>roles<span>;</span>

  <span>function</span> <span>prepareCustomClaimKey</span><span>(</span><span>claim</span><span>)</span> <span>{</span>
    <span>return</span> <span><span>`</span><span>https://www.jhipster.tech/</span><span><span>${</span>claim<span>}</span></span><span>`</span></span><span>;</span>
  <span>}</span>

  <span>const</span> rolesClaim <span>=</span> <span>prepareCustomClaimKey</span><span>(</span><span>&#39;roles&#39;</span><span>)</span><span>;</span>

  <span>if</span> <span>(</span>context<span>.</span>idToken<span>)</span> <span>{</span>
    context<span>.</span>idToken<span>[</span>rolesClaim<span>]</span> <span>=</span> roles<span>;</span>
  <span>}</span>

  <span>if</span> <span>(</span>context<span>.</span>accessToken<span>)</span> <span>{</span>
    context<span>.</span>accessToken<span>[</span>rolesClaim<span>]</span> <span>=</span> roles<span>;</span>
  <span>}</span>

  <span>callback</span><span>(</span><span>null</span><span>,</span> user<span>,</span> context<span>)</span><span>;</span>
<span>}</span></code></pre><p>This code is adding the user&#39;s roles to a custom claim (prefixed with <code>https<span>:</span><span>/</span><span>/</span>www<span>.</span>jhipster<span>.</span>tech<span>/</span>roles</code>). This claim is mapped to Spring Security authorities in <code>SecurityUtils<span>.</span>java</code>.</p><pre><code><span>public</span> <span>static</span> <span>List</span><span><span>&lt;</span><span>GrantedAuthority</span><span>&gt;</span></span> <span>extractAuthorityFromClaims</span><span>(</span><span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>&gt;</span></span> claims<span>)</span> <span>{</span>
    <span>return</span> <span>mapRolesToGrantedAuthorities</span><span>(</span><span>getRolesFromClaims</span><span>(</span>claims<span>)</span><span>)</span><span>;</span>
<span>}</span>

<span>@SuppressWarnings</span><span>(</span><span>&#34;unchecked&#34;</span><span>)</span>
<span>private</span> <span>static</span> <span>Collection</span><span><span>&lt;</span><span>String</span><span>&gt;</span></span> <span>getRolesFromClaims</span><span>(</span><span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>&gt;</span></span> claims<span>)</span> <span>{</span>
    <span>return</span> <span>(</span><span>Collection</span><span><span>&lt;</span><span>String</span><span>&gt;</span></span><span>)</span> claims<span>.</span><span>getOrDefault</span><span>(</span>
        <span>&#34;groups&#34;</span><span>,</span>
        claims<span>.</span><span>getOrDefault</span><span>(</span><span>&#34;roles&#34;</span><span>,</span> claims<span>.</span><span>getOrDefault</span><span>(</span>CLAIMS_NAMESPACE <span>+</span> <span>&#34;roles&#34;</span><span>,</span> <span>new</span> <span>ArrayList</span><span><span>&lt;</span><span>&gt;</span></span><span>(</span><span>)</span><span>)</span><span>)</span>
    <span>)</span><span>;</span>
<span>}</span>

<span>private</span> <span>static</span> <span>List</span><span><span>&lt;</span><span>GrantedAuthority</span><span>&gt;</span></span> <span>mapRolesToGrantedAuthorities</span><span>(</span><span>Collection</span><span><span>&lt;</span><span>String</span><span>&gt;</span></span> roles<span>)</span> <span>{</span>
    <span>return</span> roles<span>.</span><span>stream</span><span>(</span><span>)</span><span>.</span><span>filter</span><span>(</span>role <span>-&gt;</span> role<span>.</span><span>startsWith</span><span>(</span><span>&#34;ROLE_&#34;</span><span>)</span><span>)</span><span>.</span><span>map</span><span>(</span><span>SimpleGrantedAuthority</span><span>::</span><span>new</span><span>)</span><span>.</span><span>collect</span><span>(</span><span>Collectors</span><span>.</span><span>toList</span><span>(</span><span>)</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>The <code>SecurityConfiguration<span>.</span>java</code> class has a bean that calls this method to configure a user&#39;s roles from their OIDC data.</p><pre><code><span>@Bean</span>
<span>public</span> <span>GrantedAuthoritiesMapper</span> <span>userAuthoritiesMapper</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> authorities <span>-&gt;</span> <span>{</span>
        <span>Set</span><span><span>&lt;</span><span>GrantedAuthority</span><span>&gt;</span></span> mappedAuthorities <span>=</span> <span>new</span> <span>HashSet</span><span><span>&lt;</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>

        authorities<span>.</span><span>forEach</span><span>(</span>authority <span>-&gt;</span> <span>{</span>
            <span>// Check for OidcUserAuthority because Spring Security 5.2 returns</span>
            <span>// each scope as a GrantedAuthority, which we don&#39;t care about.</span>
            <span>if</span> <span>(</span>authority <span>instanceof</span> <span>OidcUserAuthority</span><span>)</span> <span>{</span>
                <span>OidcUserAuthority</span> oidcUserAuthority <span>=</span> <span>(</span><span>OidcUserAuthority</span><span>)</span> authority<span>;</span>
                mappedAuthorities<span>.</span><span>addAll</span><span>(</span><span>SecurityUtils</span><span>.</span><span>extractAuthorityFromClaims</span><span>(</span>oidcUserAuthority<span>.</span><span>getUserInfo</span><span>(</span><span>)</span><span>.</span><span>getClaims</span><span>(</span><span>)</span><span>)</span><span>)</span><span>;</span>
            <span>}</span>
        <span>}</span><span>)</span><span>;</span>
        <span>return</span> mappedAuthorities<span>;</span>
    <span>}</span><span>;</span>
<span>}</span></code></pre><p>Click <strong>Save changes</strong> to continue.</p><p>‚ÑπÔ∏è <strong>NOTE</strong>: Want to have all these steps automated for you? Vote for <a href="https://github.com/auth0/auth0-cli/issues/351" target="_blank" rel="noreferrer noopener">this issue</a> in the Auth0 CLI project.</p><h3 id="Run-Your-JHipster-App-with-Auth0">Run Your JHipster App with Auth0</h3><p>Stop your JHipster app using <strong>Ctrl+C</strong>, set your Auth0 properties in <code><span>.</span>auth0<span>.</span>env</code>, and start your app again.</p><pre><code><span>source</span> .auth0.env
./mvnw</code></pre><p><em>Voil√†</em> - your full-stack app is now using Auth0! Open your favorite browser to <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span></code>. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1Zma6iIU9n6P4CguG8CcQh/e7faa31be47593107329d0128d947b0a/04_jhipster-homepage.png" alt="JHipster default homepage"/></p><p>You should see your app&#39;s homepage with a link to sign in. Click <strong>sign in</strong>, and you&#39;ll be redirected to Auth0 to log in.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/M4rpafdRgJwaqkvm7gaZl/578bd56bd6c85bbdc180aeb7537d3a63/02_auth0-login.png" alt="Auth0 Login"/></p><p>After entering your credentials, you&#39;ll be redirected back to your app. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7CBL7VFB4PSkcazRLSIyEG/6da5d9f23d170ba3c9b1e5c492220af7/05_jhipster-logged-in.png" alt="Authenticated"/></p><h2 id="Test-Your-Full-Stack-Java-App-with-Cypress">Test Your Full Stack Java App with Cypress</h2><p>JHipster has Auth0 support built-in, so you can specify your credentials for Cypress tests and automate your UI testing!</p><p>To do this, open a new terminal window, specify the credentials for the Auth0 user you just created, and run <code>npm run e2e</code>.</p><pre><code><span>export</span> <span>CYPRESS_E2E_USERNAME</span><span>=</span><span>&lt;</span>new-username<span>&gt;</span>
<span>export</span> <span>CYPRESS_E2E_PASSWORD</span><span>=</span><span>&lt;</span>new-password<span>&gt;</span>
<span>npm</span> run e2e</code></pre><p><strong>TIP:</strong> If you want to use a <code><span>.</span>env</code> file for your environment variables, you can use <a href="https://www.npmjs.com/package/cypress-dotenv" target="_blank" rel="noreferrer noopener">cypress-dotenv</a>. You can also put these values in <code>cypress<span>.</span>json</code>, but since this file will be in source control, it&#39;s a bad practice to put your secrets in it.</p><p>Everything should pass in around a minute.</p><pre><code>       Spec                                              Tests  Passing  Failing  Pending  Skipped
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚îÇ ‚úî  administration/administration.spec.      00:31        <span>5</span>        <span>5</span>        -        -        - ‚îÇ
  ‚îÇ    ts                                                                                          ‚îÇ
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚úî  All specs passed<span>!</span>                        00:31        <span>5</span>        <span>5</span>        -        -        -

Execution time: <span>44</span> s.</code></pre><p>Shut down the process running your JHipster app - it&#39;s time to create some data handling for your Flickr clone!</p><h2 id="Create-Entities-to-allow-CRUD-on-Photos">Create Entities to allow CRUD on Photos</h2><p>I&#39;ve talked a lot about how to secure your application, but we haven&#39;t done anything with photos! JHipster has a JDL (JHipster Domain Language) feature that allows you to model the data in your app and generate entities from it. You can use the <a href="https://start.jhipster.tech/jdl-studio/" target="_blank" rel="noreferrer noopener">JDL Studio</a> to do this online and save it locally once you&#39;ve finished.</p><p>My data model for this app has <code>Album</code>, <code>Photo</code>, and <code>Tag</code> entities and sets up relationships between them. Below is a screenshot of what it looks like in JDL Studio.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/73z2OABdygvcVuMzVCzjIP/7d9a84eb719ecac66290b367ecaa3682/03_jdl-studio.png" alt="JDL Studio"/></p><p>Copy the JDL below and save it in a <code>flickr2<span>.</span>jdl</code> file in the root directory of your project.</p><pre><code>entity Album <span>{</span>
  title String required
  description TextBlob
  created Instant
<span>}</span>

entity Photo <span>{</span>
  title String required
  description TextBlob
  image ImageBlob required
  height Integer
  width Integer
  taken Instant
  uploaded Instant
<span>}</span>

entity Tag <span>{</span>
  name String required <span>minlength</span><span>(</span><span>2</span><span>)</span>
<span>}</span>

relationship ManyToOne <span>{</span>
  Album<span>{</span><span>user</span><span>(</span>login<span>)</span><span>}</span> to User
  Photo<span>{</span><span>album</span><span>(</span>title<span>)</span><span>}</span> to Album
<span>}</span>

relationship ManyToMany <span>{</span>
  Photo<span>{</span><span>tag</span><span>(</span>name<span>)</span><span>}</span> to Tag<span>{</span>photo<span>}</span>
<span>}</span>

paginate Album <span>with</span> pagination
paginate Photo<span>,</span> Tag <span>with</span> infinite<span>-</span>scroll</code></pre><p>You can generate entities and <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete" target="_blank" rel="noreferrer noopener">CRUD</a> code (Java for Spring Boot; TypeScript and JSX for React) by using the following command:</p><pre><code>jhipster jdl flickr2.jdl</code></pre><p>When prompted, type <code>a</code> to allow overwriting of existing files.</p><p>This process will create Liquibase changelog files (to create your database tables), entities, repositories, Spring MVC controllers, and all the React code necessary to create, read, update, and delete your entities. It&#39;ll even generate JUnit unit tests, Jest unit tests, and Cypress end-to-end tests!</p><p>After the process completes, you can restart your app, log in, and browse through the <strong>Entities</strong> menu. Try adding some data to confirm everything works.</p><p>By now, you can see that JHipster is pretty powerful. It recognized that you had an image property of <code>ImageBlob</code> type and created the logic necessary to upload and store images in your database! <em>Booyah!</em></p><h2 id="Add-Image-EXIF-Processing-in-Your-Spring-Boot-API">Add Image EXIF Processing in Your Spring Boot API</h2><p>The <code>Photo</code> entity has a few properties that can be calculated by reading the uploaded photo&#39;s <a href="https://yourphotoadvisor.com/understanding-exif-data-what-it-is-and-what-to-do-with-it/" target="_blank" rel="noreferrer noopener">EXIF</a> (Exchangeable Image File Format) data. You might ask, how do you do that in Java?</p><p>Thankfully, Drew Noakes created a <a href="https://github.com/drewnoakes/metadata-extractor" target="_blank" rel="noreferrer noopener">metadata-extractor</a> library to do just that. Add a dependency on Drew&#39;s library to your <code>pom<span>.</span>xml</code>:</p><pre><code><span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>com.drewnoakes<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>metadata-extractor<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>version</span><span>&gt;</span></span>2.16.0<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span></code></pre><p>Then modify the <code>PhotoResource<span>#createPhoto</span><span>(</span><span>)</span></code> method to set the metadata when an image is uploaded.</p><pre><code><span>import</span> <span>com<span>.</span>drew<span>.</span>imaging<span>.</span></span><span>ImageMetadataReader</span><span>;</span>
<span>import</span> <span>com<span>.</span>drew<span>.</span>imaging<span>.</span></span><span>ImageProcessingException</span><span>;</span>
<span>import</span> <span>com<span>.</span>drew<span>.</span>metadata<span>.</span></span><span>Metadata</span><span>;</span>
<span>import</span> <span>com<span>.</span>drew<span>.</span>metadata<span>.</span></span><span>MetadataException</span><span>;</span>
<span>import</span> <span>com<span>.</span>drew<span>.</span>metadata<span>.</span>exif<span>.</span></span><span>ExifSubIFDDirectory</span><span>;</span>
<span>import</span> <span>com<span>.</span>drew<span>.</span>metadata<span>.</span>jpeg<span>.</span></span><span>JpegDirectory</span><span>;</span>

<span>import</span> <span>javax<span>.</span>xml<span>.</span>bind<span>.</span></span><span>DatatypeConverter</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>BufferedInputStream</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>ByteArrayInputStream</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>IOException</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>InputStream</span><span>;</span>

<span>import</span> <span>java<span>.</span>time<span>.</span></span><span>Instant</span><span>;</span>
<span>import</span> <span>java<span>.</span>util<span>.</span></span><span>Date</span><span>;</span>

<span>public</span> <span>class</span> <span>PhotoResource</span> <span>{</span>
    <span>.</span><span>.</span><span>.</span>

    <span>public</span> <span>ResponseEntity</span><span><span>&lt;</span><span>Photo</span><span>&gt;</span></span> <span>createPhoto</span><span>(</span><span>@Valid</span> <span>@RequestBody</span> <span>Photo</span> photo<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>
        log<span>.</span><span>debug</span><span>(</span><span>&#34;REST request to save Photo : {}&#34;</span><span>,</span> photo<span>)</span><span>;</span>
        <span>if</span> <span>(</span>photo<span>.</span><span>getId</span><span>(</span><span>)</span> <span>!=</span> <span>null</span><span>)</span> <span>{</span>
            <span>throw</span> <span>new</span> <span>BadRequestAlertException</span><span>(</span><span>&#34;A new photo cannot already have an ID&#34;</span><span>,</span> ENTITY_NAME<span>,</span> <span>&#34;idexists&#34;</span><span>)</span><span>;</span>
        <span>}</span>

        <span>try</span> <span>{</span>
            photo <span>=</span> <span>setMetadata</span><span>(</span>photo<span>)</span><span>;</span>
        <span>}</span> <span>catch</span> <span>(</span><span>ImageProcessingException</span> ipe<span>)</span> <span>{</span>
            log<span>.</span><span>error</span><span>(</span>ipe<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>}</span>

        <span>Photo</span> result <span>=</span> photoRepository<span>.</span><span>save</span><span>(</span>photo<span>)</span><span>;</span>
        <span>return</span> <span>ResponseEntity</span>
            <span>.</span><span>created</span><span>(</span><span>new</span> <span>URI</span><span>(</span><span>&#34;/api/photos/&#34;</span> <span>+</span> result<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>.</span><span>headers</span><span>(</span><span>HeaderUtil</span><span>.</span><span>createEntityCreationAlert</span><span>(</span>applicationName<span>,</span> <span>true</span><span>,</span> ENTITY_NAME<span>,</span> result<span>.</span><span>getId</span><span>(</span><span>)</span><span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>.</span><span>body</span><span>(</span>result<span>)</span><span>;</span>
    <span>}</span>

    <span>private</span> <span>Photo</span> <span>setMetadata</span><span>(</span><span>Photo</span> photo<span>)</span> <span>throws</span> <span>ImageProcessingException</span><span>,</span> <span>IOException</span><span>,</span> <span>MetadataException</span> <span>{</span>
        <span>String</span> str <span>=</span> <span>DatatypeConverter</span><span>.</span><span>printBase64Binary</span><span>(</span>photo<span>.</span><span>getImage</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>byte</span><span>[</span><span>]</span> data2 <span>=</span> <span>DatatypeConverter</span><span>.</span><span>parseBase64Binary</span><span>(</span>str<span>)</span><span>;</span>
        <span>InputStream</span> inputStream <span>=</span> <span>new</span> <span>ByteArrayInputStream</span><span>(</span>data2<span>)</span><span>;</span>
        <span>BufferedInputStream</span> bis <span>=</span> <span>new</span> <span>BufferedInputStream</span><span>(</span>inputStream<span>)</span><span>;</span>
        <span>Metadata</span> metadata <span>=</span> <span>ImageMetadataReader</span><span>.</span><span>readMetadata</span><span>(</span>bis<span>)</span><span>;</span>
        <span>ExifSubIFDDirectory</span> directory <span>=</span> metadata<span>.</span><span>getFirstDirectoryOfType</span><span>(</span><span>ExifSubIFDDirectory</span><span>.</span><span>class</span><span>)</span><span>;</span>

        <span>if</span> <span>(</span>directory <span>!=</span> <span>null</span><span>)</span> <span>{</span>
            <span>Date</span> date <span>=</span> directory<span>.</span><span>getDateDigitized</span><span>(</span><span>)</span><span>;</span>
            <span>if</span> <span>(</span>date <span>!=</span> <span>null</span><span>)</span> <span>{</span>
                photo<span>.</span><span>setTaken</span><span>(</span>date<span>.</span><span>toInstant</span><span>(</span><span>)</span><span>)</span><span>;</span>
            <span>}</span>
        <span>}</span>

        <span>if</span> <span>(</span>photo<span>.</span><span>getTaken</span><span>(</span><span>)</span> <span>==</span> <span>null</span><span>)</span> <span>{</span>
            log<span>.</span><span>debug</span><span>(</span><span>&#34;Photo EXIF date digitized not available, setting taken on date to now...&#34;</span><span>)</span><span>;</span>
            photo<span>.</span><span>setTaken</span><span>(</span><span>Instant</span><span>.</span><span>now</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>}</span>

        photo<span>.</span><span>setUploaded</span><span>(</span><span>Instant</span><span>.</span><span>now</span><span>(</span><span>)</span><span>)</span><span>;</span>

        <span>JpegDirectory</span> jpgDirectory <span>=</span> metadata<span>.</span><span>getFirstDirectoryOfType</span><span>(</span><span>JpegDirectory</span><span>.</span><span>class</span><span>)</span><span>;</span>
        <span>if</span> <span>(</span>jpgDirectory <span>!=</span> <span>null</span><span>)</span> <span>{</span>
            photo<span>.</span><span>setHeight</span><span>(</span>jpgDirectory<span>.</span><span>getImageHeight</span><span>(</span><span>)</span><span>)</span><span>;</span>
            photo<span>.</span><span>setWidth</span><span>(</span>jpgDirectory<span>.</span><span>getImageWidth</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>}</span>

        <span>return</span> photo<span>;</span>
    <span>}</span>
    <span>.</span><span>.</span><span>.</span>
<span>}</span></code></pre><p>Since you&#39;re extracting the information, you can remove the fields from the UI and tests so the user cannot set these values.</p><p>In <code>src<span>/</span>main<span>/</span>webapp<span>/</span>app<span>/</span>entities<span>/</span>photo<span>/</span>photo<span>-</span>update<span>.</span>tsx</code>, hide the metadata so users can&#39;t edit it. Rather than displaying the <code>height</code>, <code>width</code>, <code>taken</code>, and <code>uploaded</code> values, hide them. You can do this by searching for <code>photo<span>-</span>height</code>, grabbing the elements (and its following three elements), and adding them to a <code>metadata</code> constant just after <code><span>defaultValues</span><span>(</span><span>)</span></code> lambda function.</p><pre><code>const defaultValues = () =&gt;
  ...

const metadata = (
  &lt;div&gt;
    &lt;ValidatedField label={translate(&#39;flickr2App.photo.height&#39;)} id=&#34;photo-height&#34; name=&#34;height&#34; data-cy=&#34;height&#34; type=&#34;text&#34; /&gt;
    &lt;ValidatedField label={translate(&#39;flickr2App.photo.width&#39;)} id=&#34;photo-width&#34; name=&#34;width&#34; data-cy=&#34;width&#34; type=&#34;text&#34; /&gt;
    &lt;ValidatedField
      label={translate(&#39;flickr2App.photo.taken&#39;)}
      id=&#34;photo-taken&#34;
      name=&#34;taken&#34;
      data-cy=&#34;taken&#34;
      type=&#34;datetime-local&#34;
      placeholder=&#34;YYYY-MM-DD HH:mm&#34;
    /&gt;
    &lt;ValidatedField
      label={translate(&#39;flickr2App.photo.uploaded&#39;)}
      id=&#34;photo-uploaded&#34;
      name=&#34;uploaded&#34;
      data-cy=&#34;uploaded&#34;
      type=&#34;datetime-local&#34;
      placeholder=&#34;YYYY-MM-DD HH:mm&#34;
    /&gt;
  &lt;/div&gt;
);
const metadataRows = isNew ? &#39;&#39; : metadata;

return ( ... );</code></pre><p>Then, in the <code><span>return</span></code> block, remove the JSX between the <code>image</code> property and <code>album</code> property and replace it with <code><span>{</span>metadataRows<span>}</span></code>.</p><pre><code>&lt;ValidatedBlobField
  label={translate(&#39;flickr2App.photo.image&#39;)}
  id=&#34;photo-image&#34;
  name=&#34;image&#34;
  data-cy=&#34;image&#34;
  isImage
  accept=&#34;image/*&#34;
  validate={{
    required: { value: true, message: translate(&#39;entity.validation.required&#39;) },
  }}
/&gt;
{metadataRows}
&lt;ValidatedField id=&#34;photo-album&#34; name=&#34;albumId&#34; data-cy=&#34;album&#34; label={translate(&#39;flickr2App.photo.album&#39;)} type=&#34;select&#34;&gt;
  &lt;option value=&#34;&#34; key=&#34;0&#34; /&gt;
  {albums
    ? albums.map(otherEntity =&gt; (
      &lt;option value={otherEntity.id} key={otherEntity.id}&gt;
        {otherEntity.title}
      &lt;/option&gt;
    ))
    : null}
&lt;/ValidatedField&gt;</code></pre><p>In <code>src<span>/</span>test<span>/</span>javascript<span>/</span>cypress<span>/</span>integration<span>/</span>entity<span>/</span>photo<span>.</span>spec<span>.</span>ts</code>, remove the code that sets the data in these fields:</p><pre><code>cy<span>.</span><span>get</span><span>(</span><span><span>`</span><span>[data-cy=&#34;height&#34;]</span><span>`</span></span><span>)</span><span>.</span><span>type</span><span>(</span><span>&#39;99459&#39;</span><span>)</span><span>.</span><span>should</span><span>(</span><span>&#39;have.value&#39;</span><span>,</span> <span>&#39;99459&#39;</span><span>)</span><span>;</span>
cy<span>.</span><span>get</span><span>(</span><span><span>`</span><span>[data-cy=&#34;width&#34;]</span><span>`</span></span><span>)</span><span>.</span><span>type</span><span>(</span><span>&#39;61514&#39;</span><span>)</span><span>.</span><span>should</span><span>(</span><span>&#39;have.value&#39;</span><span>,</span> <span>&#39;61514&#39;</span><span>)</span><span>;</span>
cy<span>.</span><span>get</span><span>(</span><span><span>`</span><span>[data-cy=&#34;taken&#34;]</span><span>`</span></span><span>)</span><span>.</span><span>type</span><span>(</span><span>&#39;2021-10-11T16:46&#39;</span><span>)</span><span>.</span><span>should</span><span>(</span><span>&#39;have.value&#39;</span><span>,</span> <span>&#39;2021-10-11T16:46&#39;</span><span>)</span><span>;</span>
cy<span>.</span><span>get</span><span>(</span><span><span>`</span><span>[data-cy=&#34;uploaded&#34;]</span><span>`</span></span><span>)</span><span>.</span><span>type</span><span>(</span><span>&#39;2021-10-11T15:23&#39;</span><span>)</span><span>.</span><span>should</span><span>(</span><span>&#39;have.value&#39;</span><span>,</span> <span>&#39;2021-10-11T15:23&#39;</span><span>)</span><span>;</span><span>)</span><span>;</span></code></pre><p>Stop your Maven process, run <code>source <span>.</span>auth0<span>.</span>env</code>, then <code><span>.</span><span>/</span>mvwn</code> again. Open a new terminal window, set your Auth0 credentials, and run <code>npm run e2e</code> to make sure everything still works. </p><pre><code><span>export</span> <span>CYPRESS_E2E_USERNAME</span><span>=</span><span>&lt;</span>auth0-username<span>&gt;</span>
<span>export</span> <span>CYPRESS_E2E_PASSWORD</span><span>=</span><span>&lt;</span>auth0-password<span>&gt;</span>
<span>npm</span> run e2e</code></pre><p>‚ÑπÔ∏è <strong>NOTE</strong>: If you experience authentication errors in your Cypress tests, it&#39;s likely because you&#39;ve violated Auth0&#39;s <a href="https://auth0.com/docs/support/policies/rate-limit-policy" target="_blank" rel="noreferrer noopener">Rate Limit Policy</a>. As a workaround, I recommend you use Keycloak for Cypress tests. You can do this by opening a new terminal window and starting your app there using <code><span>.</span><span>/</span>mvnw</code>. Then, open a second terminal window and run <code>npm run e2e</code>.  </p><p>If you upload an image you took with your smartphone, the height, width, and taken values should all be populated. If they&#39;re not, chances are your image doesn&#39;t have the data in it.</p><blockquote><p>Need some sample photos with EXIF data? You can download pictures of my 1966 VW Bus from <a href="https://www.flickr.com/photos/mraible/albums/72157689027458320" target="_blank" rel="noreferrer noopener">an album on Flickr</a>.</p></blockquote><h2 id="Add-a-React-Photo-Gallery">Add a React Photo Gallery</h2><p>You&#39;ve added metadata extraction to your backend, but your photos still display in a list rather than in a grid (like Flickr). To fix that, you can use the <a href="https://github.com/neptunian/react-photo-gallery" target="_blank" rel="noreferrer noopener">React Photo Gallery</a> component. Install it using npm:</p><pre><code><span>npm</span> i react-photo-gallery@8</code></pre><p>In <code>src<span>/</span>main<span>/</span>webapp<span>/</span>app<span>/</span>entities<span>/</span>photo<span>/</span>photo<span>.</span>tsx</code>, add an import for <code>Gallery</code>:</p><pre><code><span>import</span> Gallery <span>from</span> <span>&#39;react-photo-gallery&#39;</span><span>;</span></code></pre><p>Then add the following just after <code><span>const</span> <span>{</span> match <span>}</span> <span>=</span> props<span>;</span></code>. This adds the photos to a set with source, height, and width information.</p><pre><code><span>const</span> photoSet <span>=</span> photoList<span>.</span><span>map</span><span>(</span>photo <span>=&gt;</span> <span>(</span><span>{</span>
  src<span>:</span> <span><span>`</span><span>data:</span><span><span>${</span>photo<span>.</span>imageContentType<span>}</span></span><span>;base64,</span><span><span>${</span>photo<span>.</span>image<span>}</span></span><span>`</span></span><span>,</span>
  width<span>:</span> photo<span>.</span>height <span>&gt;</span> photo<span>.</span>width <span>?</span> <span>3</span> <span>:</span> photo<span>.</span>height <span>===</span> photo<span>.</span>width <span>?</span> <span>1</span> <span>:</span> <span>4</span><span>,</span>
  height<span>:</span> photo<span>.</span>height <span>&gt;</span> photo<span>.</span>width <span>?</span> <span>4</span> <span>:</span> photo<span>.</span>height <span>===</span> photo<span>.</span>width <span>?</span> <span>1</span> <span>:</span> <span>3</span>
<span>}</span><span>)</span><span>)</span><span>;</span></code></pre><p>Next, add a <code><span>&lt;</span>Gallery<span>&gt;</span></code> component right after the closing <code><span>&lt;</span><span>/</span>h2<span>&gt;</span></code>.</p><pre><code>return (
  &lt;div&gt;
    &lt;h2 id=&#34;photo-heading&#34; data-cy=&#34;PhotoHeading&#34;&gt;
      ...
    &lt;/h2&gt;
    &lt;Gallery photos={photoSet} /&gt;
    ...
);</code></pre><p>Save all your changes and restart your app.</p><pre><code><span>source</span> .auth0.env
./mvnw</code></pre><p>Log in and navigate to <strong>Entities</strong> &gt; <strong>Photo</strong> in the top nav bar. You will see a plethora of photos loaded by <a href="https://www.liquibase.org/" target="_blank" rel="noreferrer noopener">Liquibase</a> and <a href="https://marak.github.io/faker.js/" target="_blank" rel="noreferrer noopener">faker.js</a>. To make a clean screenshot without this data, I modified <code>src<span>/</span>main<span>/</span>resources<span>/</span>config<span>/</span>application<span>-</span>dev<span>.</span>yml</code> to remove the &#34;faker&#34; context for Liquibase.</p><pre><code><span>liquibase</span><span>:</span>
  <span># Append &#39;, faker&#39; to the line below if you want sample data to be loaded automatically</span>
  <span>contexts</span><span>:</span> dev</code></pre><p>Stop your Spring Boot backend and run <code>rm <span>-</span>r target<span>/</span>h2db</code> to clear out your database (or just delete the <code>target<span>/</span>h2db</code> directory). Restart your backend.</p><p>Now you should be able to upload photos and see the results in a nice grid at the top of the list.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6RIASq72N4JN9b3ya5UVra/c0530addbbf28020d1a42f6b18ea0bae/08_photo-gallery.jpg" alt="Gallery with Photos"/></p><p>You can also add a &#34;lightbox&#34; feature to the grid so you can click on photos and zoom in. The <a href="https://neptunian.github.io/react-photo-gallery/" target="_blank" rel="noreferrer noopener">React Photo Gallery docs</a> shows how to do this. I&#39;ve integrated it into the example for this post, but I won&#39;t show the code here for the sake of brevity. You can see the <a href="https://github.com/oktadev/auth0-full-stack-java-example/blob/main/src/main/webapp/app/entities/photo/photo.tsx" target="_blank" rel="noreferrer noopener">final <code>photo<span>.</span>tsx</code> with Lightbox added on GitHub</a> or a <a href="https://github.com/oktadev/auth0-full-stack-java-example/commit/76dcf711816cb2f3455ba4b46264bf48002487f7" target="_blank" rel="noreferrer noopener">diff of the necessary changes</a>.</p><h2 id="Make-Your-Full-Stack-Java-App-Into-a-PWA">Make Your Full Stack Java App Into a PWA</h2><p>Progressive Web Apps, aka PWAs, are the best way for developers to make their webapps load faster and more performant. In a nutshell, PWAs are websites that use recent web standards to allow for installation on a user&#39;s computer or device and deliver an app-like experience to those users. To make a web app into a PWA:</p><ol start="1"><li>Your app must be served over HTTPS</li><li>Your app must register a service worker so it can cache requests and work offline</li><li>Your app must have a webapp manifest with installation information and icons</li></ol><p>For HTTPS, you can <a href="https://letsencrypt.org/docs/certificates-for-localhost/" target="_blank" rel="noreferrer noopener">set up a certificate for localhost</a> or (even better), deploy it to production! Cloud providers like Heroku will provide you with HTTPS out-of-the-box, but they won&#39;t <em>force</em> HTTPS. To force HTTPS, open <code>src<span>/</span>main<span>/</span>java<span>/</span>com<span>/</span>auth0<span>/</span>flickr2<span>/</span>config<span>/</span>SecurityConfiguration<span>.</span>java</code> and add a rule to force a secure channel when an <code><span>X</span><span>-</span>Forwarded<span>-</span>Proto</code> header is sent.</p><pre><code><span>@Override</span>
<span>protected</span> <span>void</span> <span>configure</span><span>(</span><span>HttpSecurity</span> http<span>)</span> <span>throws</span> <span>Exception</span> <span>{</span>
    http
        <span>.</span><span>.</span><span>.</span>
    <span>.</span><span>and</span><span>(</span><span>)</span>
        <span>.</span><span>frameOptions</span><span>(</span><span>)</span>
        <span>.</span><span>deny</span><span>(</span><span>)</span>
    <span>.</span><span>and</span><span>(</span><span>)</span>
        <span>.</span><span>requiresChannel</span><span>(</span><span>)</span>
        <span>.</span><span>requestMatchers</span><span>(</span>r <span>-&gt;</span> r<span>.</span><span>getHeader</span><span>(</span><span>&#34;X-Forwarded-Proto&#34;</span><span>)</span> <span>!=</span> <span>null</span><span>)</span>
        <span>.</span><span>requiresSecure</span><span>(</span><span>)</span>
    <span>.</span><span>and</span><span>(</span><span>)</span>
        <span>.</span><span>authorizeRequests</span><span>(</span><span>)</span>
        <span>.</span><span>.</span><span>.</span>
<span>}</span></code></pre><p>The <a href="https://developers.google.com/web/tools/workbox/modules/workbox-webpack-plugin" target="_blank" rel="noreferrer noopener">workbox-webpack-plugin</a> is configured already for generating a service worker, but it only works when running your app with a production profile. This is nice because it means your data isn&#39;t cached in the browser when you&#39;re developing.</p><p>To register a service worker, open <code>src<span>/</span>main<span>/</span>webapp<span>/</span>index<span>.</span>html</code> and uncomment the following block of code.</p><pre><code><span><span><span>&lt;</span>script</span><span>&gt;</span></span><span><span>
  <span>if</span> <span>(</span><span>&#39;serviceWorker&#39;</span> <span>in</span> navigator<span>)</span> <span>{</span>
    window<span>.</span><span>addEventListener</span><span>(</span><span>&#39;load&#39;</span><span>,</span> <span>function</span> <span>(</span><span>)</span> <span>{</span>
      navigator<span>.</span>serviceWorker<span>.</span><span>register</span><span>(</span><span>&#39;/service-worker.js&#39;</span><span>)</span><span>.</span><span>then</span><span>(</span><span>function</span> <span>(</span><span>)</span> <span>{</span>
        console<span>.</span><span>log</span><span>(</span><span>&#39;Service Worker Registered&#39;</span><span>)</span><span>;</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>
</span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span></code></pre><p>The final feature ‚Äî a webapp manifest ‚Äî is included at <code>src<span>/</span>main<span>/</span>webapp<span>/</span>manifest<span>.</span>webapp</code>. It defines an app name, colors, and icons. You might want to adjust these to fit your app.</p><h2 id="Deploy-Your-React---Spring-Boot-App-to-Heroku">Deploy Your React + Spring Boot App to Heroku</h2><p>To deploy your app to Heroku, you&#39;ll first need to install the <a href="https://devcenter.heroku.com/articles/heroku-cli" target="_blank" rel="noreferrer noopener">Heroku CLI</a>. You can confirm it&#39;s installed by running <code>heroku <span>--</span>version</code>.</p><blockquote><p>If you don&#39;t have a Heroku account, go to <a href="https://www.heroku.com/" target="_blank" rel="noreferrer noopener">heroku.com</a> and sign up. Don&#39;t worry, it&#39;s free, and chances are you&#39;ll love the experience.</p></blockquote><p>Run <code>heroku login</code> to log in to your account, then start the deployment process with JHipster:</p><pre><code>jhipster heroku</code></pre><p>This will start the <a href="https://www.jhipster.tech/heroku/" target="_blank" rel="noreferrer noopener">Heroku sub-generator</a> that asks you a couple of questions about your app: what you want to name it and whether you want to deploy it to a US region or EU. Then it&#39;ll prompt you to choose between building locally or with Git on Heroku&#39;s servers. Choose Git, so you don&#39;t have to upload a fat JAR. When prompted to use Okta for OIDC, select <code>No</code>. Then, the deployment process will begin.</p><p>You&#39;ll be prompted to overwrite <code>pom<span>.</span>xml</code>‚Äîtype <code>a</code> to allow overwriting all files.</p><p>If you have a stable and fast internet connection, your app should be live on the internet in around six minutes!</p><pre><code>remote<span>:</span> <span>--</span><span>--</span><span>-</span><span>&gt;</span> Compressing<span>...</span>
remote<span>:</span>        Done<span>:</span> <span>120.9</span>M
remote<span>:</span> <span>--</span><span>--</span><span>-</span><span>&gt;</span> Launching<span>...</span>
remote<span>:</span>        Released v7
remote<span>:</span>        https<span>:</span><span>/</span><span>/</span>flickr<span>-</span><span>2.</span>herokuapp<span>.</span>com<span>/</span> deployed to Heroku
remote<span>:</span>
remote<span>:</span> Verifying deploy<span>...</span> done<span>.</span>

To https<span>:</span><span>/</span><span>/</span>git<span>.</span>heroku<span>.</span>com<span>/</span>flickr<span>-</span><span>2.</span>git
 <span>*</span> <span>[</span><span>new</span> <span>branch</span><span>]</span>      <span>HEAD</span> <span>-</span><span>&gt;</span> main

Your app should now be live<span>.</span> To view it<span>,</span> run
    heroku open
And you can view the logs <span>with</span> <span>this</span> command
    heroku logs <span>--</span>tail
After application modification<span>,</span> redeploy it <span>with</span>
    jhipster heroku
Congratulations<span>,</span> JHipster execution<span>,</span> is complete<span>!</span>
Sponsored <span>with</span> ‚ù§Ô∏è by @oktadev<span>.</span>
Execution time<span>:</span> <span>6</span> min<span>.</span> <span>19</span> s<span>.</span></code></pre><h3 id="Configure-for-Auth0-and-Analyze-Your-PWA-Score-with-Lighthouse">Configure for Auth0 and Analyze Your PWA Score with Lighthouse</h3><p>To configure your app to work with Auth0 on Heroku, run the following command to set your Auth0 variables on Heroku.</p><pre><code>heroku config:set <span>\</span>
  <span>SPRING_SECURITY_OAUTH2_CLIENT_PROVIDER_OIDC_ISSUER_URI</span><span>=</span><span>&#34;https://&lt;your-auth0-domain&gt;/&#34;</span> <span>\</span>
  <span>SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_ID</span><span>=</span><span>&#34;&lt;your-client-id&gt;&#34;</span> <span>\</span>
  <span>SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_OIDC_CLIENT_SECRET</span><span>=</span><span>&#34;&lt;your-client-secret&gt;&#34;</span> <span>\</span>
  <span>JHIPSTER_SECURITY_OAUTH2_AUDIENCE</span><span>=</span><span>&#34;https://&lt;your-auth0-domain&gt;/api/v2/&#34;</span></code></pre><p>Then, log in to your Auth0 account, navigate to your app, and add your Heroku URLs as valid redirect URIs:</p><ul><li>Allowed Callback URLs: <code>https<span>:</span><span>/</span><span>/</span>flickr<span>-</span><span>2.</span>herokuapp<span>.</span>com<span>/</span>login<span>/</span>oauth2<span>/</span>code<span>/</span>oidc</code></li><li>Allowed Logout URLs: <code>https<span>:</span><span>/</span><span>/</span>flickr<span>-</span><span>2.</span>herokuapp<span>.</span>com</code></li></ul><p>After Heroku restarts your app, open it with <code>heroku open</code> and log in.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3MDBfwDhZiuKW8uzrlm291/2c574c89ca11c7b853bf01d850f06ee9/09_app-on-heroku.png" alt="Running on Heroku!"/></p><p>Then, test it with <a href="https://developers.google.com/web/tools/lighthouse/" target="_blank" rel="noreferrer noopener">Lighthouse</a> (using the Lighthouse tab in Chrome developer tools). Looks pretty good, eh?! üíØ</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2udHZaYwD4vfVtTf9SrpzB/c6888183a1364142f5edca732a0ad02c/06_lighthouse-score.png" alt="Lighthouse Score üíØ"/></p><p>It&#39;s pretty darn secure too, at least according to <a href="https://securityheaders.com" target="_blank" rel="noreferrer noopener">securityheaders.com</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/Y1O0MLjbMSojaSH1UOnuN/48d36a1abdb9007c0dfa2a45bd61057e/09_security-headers.png" alt="Security Headers on Heroku"/></p><h2 id="Learn-More-About-Full-Stack-Java-Development">Learn More About Full Stack Java Development</h2><p>This tutorial shows you how to streamline full-stack Java development with JHipster. You developed a working application with a React frontend and a Spring Boot backend. You can find the app created in this tutorial on GitHub, in the <a href="https://github.com/oktadev/auth0-full-stack-java-example" target="_blank" rel="noreferrer noopener">auth0-full-stack-java-example</a> repository.</p><p>You might also enjoy these related blog posts:</p><ul><li><a href="https://auth0.com/blog/2018/12/11/learning-java-first-language" target="_blank" rel="noreferrer noopener">Learning Java as a First Language</a></li><li><a href="https://auth0.com/blog/2021/01/20/reactive-java-microservices" target="_blank" rel="noreferrer noopener">Reactive Java Microservices with Spring Boot and JHipster</a></li><li><a href="https://auth0.com/blog/build-and-secure-an-api-with-spring-boot/" target="_blank" rel="noreferrer noopener">Build and Secure an API with Spring Boot and Kotlin</a></li><li><a href="https://auth0.com/blog/complete-guide-to-react-user-authentication/" target="_blank" rel="noreferrer noopener">The Complete Guide to React User Authentication with Auth0</a></li></ul><p>To see when we publish more developer topics on Auth0 and the Okta developer blog, follow <a href="https://twitter.com/auth0" target="_blank" rel="noreferrer noopener">Auth0</a> and <a href="https://twitter.com/oktadev" target="_blank" rel="noreferrer noopener">OktaDev</a> on Twitter.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 03 Nov 2021 17:18:00 +0000</pubDate>
    </item>
    <item>
      <title>Okta and Okta (Auth0) Both Named as Leaders in 2021 Gartner¬Æ Magic Quadrant‚Ñ¢ for Access Management</title>
      <link>https://auth0.com/blog/okta-and-auth0-named-leaders-in-2021-gartner-magic-quadrant-for-access-management/</link>
      <description>Okta positioned highest in Ability to Execute</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>SAN FRANCISCO ‚Äì Nov. 3, 2021 ‚Äì</strong> <a href="https://www.okta.com/" target="_blank" rel="noreferrer noopener">Okta, Inc.</a> (NASDAQ:OKTA) the leading independent identity provider, today announced that it has been recognized as a Leader in the 2021 Gartner Magic Quadrant for Access Management, for both Okta and Auth0 (which Okta acquired in <a href="https://www.okta.com/press-room/press-releases/okta-completes-acquisition-of-auth0/" target="_blank" rel="noreferrer noopener">May 2021</a>). This marks the fifth consecutive year in which Okta has been named Leader, and the first for Okta (Auth0). A complimentary version of the full report can be found <a href="https://auth0.com/resources/whitepapers/gartner-magic-quadrant-access-management" target="_blank" rel="noreferrer noopener">here</a>.</p><p>Gartner&#39;s view of the market is focused on transformational technologies or approaches delivering on the future needs of end users. The access management (AM) market is defined by customers‚Äô needs to establish, enforce, and manage run-time access controls for internal and external types of identities, interacting with cloud, modern standards-based web, and legacy web applications. The report evaluated 12 vendors on 15 criteria and placed both Okta and Okta (Auth0) in the Leaders Quadrant.</p><p>Okta and Auth0 together provide the breadth of modern Workforce and Customer Identity and Access Management (CIAM) solutions needed to seamlessly manage the digital complexities of security, agility, and user experience. The Okta Identity Cloud and the Auth0 Identity Platform deliver the identity solutions that are built for customer choice, connecting best-of-breed technology for seamless integration into any ecosystem; addressing compliance and regulatory requirements; and empowering users with secure and frictionless experiences. Any development style (no-code, low-code, to pro-code) and deployment choice (multi-tenant cloud or a dedicated tenant) is satisfied with the extensibility and breadth that Okta and Auth0 offer.</p><p>‚ÄúThis dual recognition from Gartner is an honor, and one that I believe is a testament to the individual leadership of our complementary platforms and the incredible value that we offer together,‚Äù said Todd McKinnon, CEO and co-founder, Okta. ‚ÄúCompanies that proactively build an identity-first architecture and prioritize identity as the foundation to all digital experiences will have the competitive edge. The breadth of technology across both Okta‚Äôs and Auth0‚Äôs platforms provide industry-leading execution and innovation for driving secure and seamless digital experiences.‚Äù</p><p>‚ÄúBecoming part of Okta was a transformational milestone for both companies, as well as the identity industry as a whole,‚Äù said Eugenio Pace, CEO and co-founder, Auth0. ‚ÄúWe are just scratching the surface of the breadth of use cases we can solve together. We are grateful for the recognition of Okta (Auth0) as a Leader from Gartner. We will continue to innovate our modern identity platform to satisfy the many complex identity needs of our customers.‚Äù</p><p>Okta recently featured Auth0 and the future plans as a combined company at its annual Showcase event, which was held virtually on October 13. The rich content from the event, including commentary from both CEOs, customer interviews, and product demos can be seen <a href="https://www.okta.com/resources/showcase21-content/" target="_blank" rel="noreferrer noopener">here</a>.</p><p>Additional detail on the overall Gartner Magic Quadrant evaluation can be found respectively on the <a href="https://auth0.com/blog/okta-and-auth0-recognized-as-a-leader-in-the-2021-gartner-magic-quadrant-for-access-management" target="_blank" rel="noreferrer noopener">Auth0 blog</a> and the <a href="https://www.okta.com/blog/2021/11/tracking-upward-and-innovating-for-our-customers-together/" target="_blank" rel="noreferrer noopener">Okta blog</a>.</p><p><em>*Gartner, Inc., Magic Quadrant for Access Management, Henrique Teixeira, Michael Kelley, Abhyuday Data, November 1, 2021.</em></p><p>Gartner Disclaimer:<br/><em>Gartner does not endorse any vendor, product or service depicted in our research publications, and does not advise technology users to select only those vendors with the highest ratings or other designation. Gartner research publications consist of the opinions of Gartner&#39;s research organization and should not be construed as statements of fact. Gartner disclaims all warranties, expressed or implied, with respect to this research, including any warranties of merchantability or fitness for a particular purpose.</em></p><p><em>Gartner and Magic Quadrant are registered trademarks of Gartner, Inc. and/or its affiliates in the U.S. and internationally and is used herein with permission. All rights reserved</em></p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h2 id="About-Okta">About Okta</h2><p>Okta is the leading independent identity provider. The Okta Identity Cloud enables organizations to securely connect the right people to the right technologies at the right time. With more than 7,000 pre-built integrations to applications and infrastructure providers, Okta provides simple and secure access to people and organizations everywhere, giving them the confidence to reach their full potential. More than 13,050 organizations, including JetBlue, Nordstrom, Siemens, Slack, Takeda, Teach for America, and Twilio, trust Okta to help protect the identities of their workforces and customers.</p><h3 id="Media-Contacts">Media Contacts</h3><p>Communications Team<br/>Okta<br/><a href="mailto:press@okta.com" target="_blank" rel="noreferrer noopener">press@okta.com</a><br/></p><p>Global Communications<br/>Auth0<br/><a href="mailto:press@auth0.com" target="_blank" rel="noreferrer noopener">press@auth0.com</a><br/></p><h3 id="Investor-Contact-">Investor Contact:</h3><p>Investor Relations<br/><a href="mailto:investor@okta.com" target="_blank" rel="noreferrer noopener">investor@okta.com</a><br/></p></div></div>]]></content:encoded>
      <pubDate>Wed, 03 Nov 2021 16:37:00 +0000</pubDate>
    </item>
    <item>
      <title>Okta (Auth0) recognized as a Leader in the 2021 Gartner¬Æ Magic Quadrant‚Ñ¢ Gartner Magic Quadrant for Access Management, Worldwide</title>
      <link>https://auth0.com/blog/okta-and-auth0-recognized-as-a-leader-in-the-2021-gartner-magic-quadrant-for-access-management/</link>
      <description>Okta (Auth0) was placed into the Leader Quadrant for 2021, parent company Okta also named a Leader</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>We are proud to announce that Auth0, a product unit within Okta, has been recognized as a Leader in the 2021 Gartner Magic Quadrant for Access Management, Worldwide. Gartner defines the Access Management market as: &#34;<em>The access management (AM) market is defined by customers‚Äô needs to establish, enforce, and manage run-time access controls for internal and external types of identities, as well as machine identities, interacting with cloud, modern standards-based web and legacy web applications</em>&#34; Auth0 focuses on SaaS-delivered developer-centric and Customer Identity and Access Management (CIAM) use cases.</p><p>For more information, please download the full 2021 Gartner Magic Quadrant for Access Management <a href="https://auth0.com/resources/whitepapers/gartner-magic-quadrant-access-management" target="_blank" rel="noreferrer noopener">report</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2R3F2vxbxOSS9HtrO3Odcf/f8351826feee0286580150623d6d53b4/Figure1_2.jpg" alt="Access Management"/></p><p>The Magic Quadrant recognized Okta (Auth0) as a Leader based on our Ability to Execute and Completeness of Vision.  </p><p>Auth0 believes that CIAM should do more to balance the three forces of security, privacy and convenience ‚Äî not just keeping the bad actors out, but also driving customer loyalty and conversion and revenue to create a great experience for our customers, partners, and their end-users.</p><p>We believe vendors&#39; experience in the space is a key consideration for Gartner in their Magic Quadrant Evaluations. As stated by one of our customers in their <a href="https://www.gartner.com/reviews/market/access-management/vendor/auth0/product/auth0-platform/review/view/1363099" target="_blank" rel="noreferrer noopener">review</a> of Auth0, included in the <a href="https://auth0.com/resources/ebooks/gartner-peer-insights-ciam" target="_blank" rel="noreferrer noopener">2021 Gartner Peer Insights Voice of the Customer Access Management Report</a>, Auth0 comes with great features out-of-the-box. We went live easily with Auth0 as our Identity Provider. The platform/vendor does not just support us in a technical angle, but also understanding our user journey and sharing their experience (with other clients) and what approaches to take to minimize risk and even enhance user experience during the migration. ‚Äî VP, Core Product Development, Retail industry</p><h2 id="Auth0---Okta-Both-Recognized-as-Leaders">Auth0 / Okta Both Recognized as Leaders</h2><p>Because <a href="https://auth0.com/blog/okta-acquisition-announcement/" target="_blank" rel="noreferrer noopener">Okta closed the acquisition of Auth0 in May 2021</a>, we believe we are both represented as vendors in the 2021 Magic Quadrant for Access Management. Our capabilities and visions were evaluated separately, but to great success ‚Äî both Okta and Auth0 were recognized as Leaders.  </p><p>As we move forward we will combine Okta‚Äôs proven ability to execute and leadership in Workforce and CIAM with Auth0‚Äôs role as the innovator of a modern CIAM and developer experience. Together, Okta and Auth0 are the future of identity, working to solve every identity use case for customers.</p><h2 id="Next-Steps-with-Okta">Next Steps with Okta</h2><p>Bringing together two strong market leaders is a challenge ‚Äî but we both see the positive impact this will bring for our customers and for the identity market. We know we have a lot of work ahead of us and will rely on customer feedback. We‚Äôre grateful for your trust as we continue to innovate with Okta.</p><p><em>*Gartner, Inc., Magic Quadrant for Access Management, Henrique Teixeira, Michael Kelley, Abhyuday Data, November 1, 2021.</em></p><p><em>This graphic was published by Gartner, Inc. as part of a larger research document and should be evaluated in the context of the entire document. The Gartner document is available upon request from Okta.</em></p><p><em>Gartner does not endorse any vendor, product or service depicted in its research publications, and does not advise technology users to select only those vendors with the highest ratings or other designation. Gartner research publications consist of the opinions of Gartner‚Äôs research organization and should not be construed as statements of fact. Gartner disclaims all warranties, express or implied, with respect to this research, including any warranties of merchantability or fitness for a particular purpose.</em></p><p><em>Gartner and Magic Quadrant are registered trademarks of Gartner, Inc. and/or its affiliates in the U.S. and internationally and is used herein with permission. All rights reserved</em></p><p><em>Gartner Peer Insights reviews constitute the subjective opinions of individual end users based on their own experiences and do not represent the views of Gartner or its affiliates.</em></p></div></div>]]></content:encoded>
      <pubDate>Wed, 03 Nov 2021 16:03:00 +0000</pubDate>
    </item>
    <item>
      <title>Role-Based Authorization for ASP.NET Web APIs</title>
      <link>https://auth0.com/blog/role-based-authorization-for-aspnet-webapi/</link>
      <description>What is the best way to apply Role-Based Access Control (RBAC) to your ASP.NET Web API? Let&#39;s find out together.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Role-Based Access Control, also known as RBAC, is one of the most common strategies to restrict access to protected resources within an organization. It simplifies permission assignment by categorizing users in roles. However, many people making their first foray into RBAC have questions:</p><ul><li>How can you reflect this user categorization on your application to check users&#39; privileges?</li><li>How can you deal with roles in your code?</li><li>Is role control appropriate for Web APIs?</li></ul><p>In this article, you will learn the best way to implement RBAC in your ASP.NET Core Web API by using Auth0&#39;s capabilities.</p><h2 id="What-is-RBAC-">What is RBAC?</h2><p>Consider a payroll system in a company. Different people accessing this system have different rights to view and change data. Each employee can view their own data, while HR people can view all employees&#39; data. Also, while an employee can just view their own data, HR people can change them. Roles may also not be assigned just by department. For example, the HR department may have just a few people who should have the ability to add new employees to the payroll system, with the remainder only having permission to update employees.</p><p>Assigning specific permissions individually to each employee can be challenging and lead to mistakes. To expand on the payroll system example, consider that we have at least 4 types of permissions. Each of these must be assigned with perfect accuracy to each employee in your company.  With just a handful of employees and a few HR events a month, this would quickly spiral into a time-consuming and error-prone activity. This doesn&#39;t even consider needing to reassign permissions for a large group of people due to a security policy change.</p><p>Role-Based Access Control helps with the permission assignment by introducing the concept of role. A role is a collection of permissions. Basically, you build a predefined set of permissions, give it a name, such as <em>Employee</em>, <em>HR Assistant</em>, <em>HR Manager</em>, and assign that role to a user. If you need to add or remove a permission from all the users who have a specific role, you just need to add or remove that permission from the role they are assigned. That&#39;s a great improvement!</p><h2 id="Setting-up-the-Sample-Application">Setting up the Sample Application</h2><p>In order to best show how to use roles in an ASP.NET Web API application integrated with Auth0, you will build on a sample application. I&#39;ve provided a starting point that you can download by running the following command in a terminal window:</p><pre><code><span>git</span> clone --branch starter --single-branch https://github.com/auth0-blog/glossary-rbac-web-api-aspnet.git</code></pre><blockquote><p>Make sure you have <a href="https://dotnet.microsoft.com/download/dotnet/current" target="_blank" rel="noreferrer noopener">the latest .NET SDK</a> already installed on your machine to run the sample ASP.NET application.</p></blockquote><p>The Web API implements a CRUD interface for a glossary of terms. It has some basic endpoints that allow you to create a definition, read a list of term definitions or a single one, and update or delete them. To learn more about the details of <a href="https://auth0.com/blog/aspnet-web-api-authorization/" target="_blank" rel="noreferrer noopener">building and securing this application, check out this blog post</a>.</p><p>Once you download the application on your machine, register it with Auth0 in order to enable support for authorization. If you don&#39;t yet have an Auth0 account, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one</a>. Follow the <a href="https://auth0.com/blog/aspnet-web-api-authorization/#Registering-the-Web-API-with-Auth0" target="_blank" rel="noreferrer noopener">instructions in this article to register the application with Auth0</a>.</p><p>After you have completed the registration, move to the <code>glossary<span>-</span>rbac<span>-</span>web<span>-</span>api<span>-</span>aspnet</code> folder and open the <code>appsettings<span>.</span>json</code> configuration file. Its content should look like this:</p><pre><code><span>// appsettings.json</span>
<span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
    <span>&#34;LogLevel&#34;</span><span>:</span> <span>{</span>
      <span>&#34;Default&#34;</span><span>:</span> <span>&#34;Information&#34;</span><span>,</span>
      <span>&#34;Microsoft&#34;</span><span>:</span> <span>&#34;Warning&#34;</span><span>,</span>
      <span>&#34;Microsoft.Hosting.Lifetime&#34;</span><span>:</span> <span>&#34;Information&#34;</span>
    <span>}</span>
  <span>}</span><span>,</span>
  <span>&#34;AllowedHosts&#34;</span><span>:</span> <span>&#34;*&#34;</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;YOUR_AUTH0_DOMAIN&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;YOUR_UNIQUE_IDENTIFIER&#34;</span>
  <span>}</span>
<span>}</span></code></pre><p>Replace the <code><span>YOUR_AUTH0_DOMAIN</span></code> placeholder with your Auth0 domain and the <code><span>YOUR_UNIQUE_IDENTIFIER</span></code> placeholder with the value you provided as a unique identifier of your API (<code>https<span>:</span><span>/</span><span>/</span>glossary<span>.</span>com</code>, if you kept the value suggested in <a href="https://auth0.com/blog/aspnet-web-api-authorization/#Registering-the-Web-API-with-Auth0" target="_blank" rel="noreferrer noopener">the mentioned article</a>).</p><blockquote><p>Note: Your Auth0 domain is a string in the form <code><span>YOUR</span><span>-</span><span>TENANT</span><span>-</span><span>NAME</span><span>.</span>auth0<span>.</span>com</code> where <code><span>YOUR</span><span>-</span><span>TENANT</span><span>-</span><span>NAME</span></code> is the name you provided when you created your account with Auth0. For more information, <a href="https://auth0.com/docs/getting-started/the-basics#domains" target="_blank" rel="noreferrer noopener">check the documentation</a>.</p></blockquote><p>To test that everything works as expected, launch the ASP.NET Web API application by typing <code>dotnet run</code> in a terminal window. Now point your browser to <code>https<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>5001</span><span>/</span>swagger</code>, and you should see the <a href="https://swagger.io/tools/swagger-ui/" target="_blank" rel="noreferrer noopener">Swagger UI</a> shown below to test the API interactively:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/uhfec4Zt8OyMK6svN3SK3/63c5e9f43f19e70d5720ca92c8a8fd3d/protected-swagger-ui-webapi.png" alt="Swagger UI for the Glossary API"/></p><p>To call the POST, PUT, and DELETE actions, <a href="https://auth0.com/blog/aspnet-web-api-authorization/#Testing-the-Secure-Web-API" target="_blank" rel="noreferrer noopener">you need an access token, as explained in this section</a>. The related endpoints already require an access token, but they don&#39;t perform any check on the permissions granted to the users. This means that any user authorized to access the protected endpoints can do anything: create a new term, modify an existing term, and delete them.</p><p>In the following sections, you will implement RBAC to allow just specific users to perform specific actions.</p><h2 id="Defining-Permissions-for-Your-API">Defining Permissions for Your API</h2><p>As a first step to enable a more granular control on the access to your Web API, you have to define the permissions needed for your application. In the case of the glossary Web API application, define the permissions using the following strings:</p><ul><li><code>create<span>:</span>term</code>. This permission allows you to add a new term to the glossary.</li><li><code>update<span>:</span>term</code>. With this permission, you can update an existing term.</li><li><code><span>delete</span><span>:</span>term</code>. This permission allows you to delete a term from the glossary.</li></ul><p>To associate these permissions with the API, go to the <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">API section</a> of your Auth0 Dashboard and select the API you defined for the glossary application. Then select the <em>Permissions</em> tab. Here you can add the permissions with their descriptions as defined above. At the end of this process, that page will look like the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6eX5PaBGmIVpwgbQnhuc24/0730de2e62b8f0080edb8b54857c4aca/defining-permissions-auth0-dashboard.png.png" alt="Defining permissions in the Auth0 Dashboard"/></p><p>This configuration informs Auth0 that the glossary Web API supports these permissions.</p><p>Next, move to the <em>Settings</em> tab and scroll down to the <em>RBAC Settings</em> section. Here, click the <em>Enable RBAC</em> and the <em>Add Permissions in the Access Token</em> toggle buttons, as in the following picture, and then click the <em>Save</em> button at the bottom:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/743TgQU6zPGJmPZSC5fLqp/b8e982ab6255144ba111044d34251f6d/enabling-rbac-and-permissions.png" alt="Enabling RBAC"/></p><p>These settings will enforce the evaluation of roles and permissions assignments during the user login.</p><h2 id="Auth0-and-RBAC">Auth0 and RBAC</h2><p>Auth0 lets you organize your RBAC easily through its <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Dashboard</a>. If you have more complex or specific needs, you can also manage users and roles by using the <a href="https://auth0.com/docs/api/management/v2" target="_blank" rel="noreferrer noopener">Auth0 Management API</a>. In this article, you will use the Dashboard to manage users and roles.</p><p>Your goal is to create roles so that only specific users can perform specific actions. In practice, you have to create:</p><ul><li>an <em>Editor</em> role, which includes the permission to create (<code>create<span>:</span>term</code>) and update (<code>update<span>:</span>term</code>) a glossary term,</li><li>an <em>Admin</em> role, which includes the permission to delete (<code><span>delete</span><span>:</span>term</code>) a glossary term in addition to being able to create and modify it.</li></ul><h3 id="Creating-roles">Creating roles</h3><p>With this goal in mind, head to the Auth0 Dashboard and select <a href="https://manage.auth0.com/#/roles" target="_blank" rel="noreferrer noopener">Roles</a> under the User Management section of the side menu. Click the <em>Create Role</em> button in the upper right corner and fill the form with the following data:</p><ul><li><code>glossary<span>-</span>admin</code> as the name.</li><li><em>Glossary administrator</em> as the description.</li></ul><p>Now click the <em>Create</em> button. In the screen you get, select the <em>Permissions</em> tab and associate the required permissions to define this role by clicking the <em>Add Permissions</em> button. You need to select the API you registered with Auth0 (<em>Glossary</em>, if you kept the suggested name) and select all its permissions, as shown in the following image:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1tzvcX3VlK5DoB79yXXjSh/e39f4c885685eff93fa709a2826c3435/assign-permissions-to-admin-role.png" alt="Assign permissions to the admin role"/></p><p>Finally, click the <em>Add Permissions</em> button. You have just created the <code>glossary<span>-</span>admin</code> role as a collection of <code>create<span>:</span>term</code>, <code>update<span>:</span>term</code>, and <code><span>delete</span><span>:</span>term</code> permissions</p><p>Now, repeat the same process to create the <em>Editor</em> role with the following data:</p><ul><li><code>glossary<span>-</span>editor</code> as the name.</li><li><em>Glossary editor</em> as the description.</li></ul><p>This time, you will add only the <code>create<span>:</span>term</code> and <code>update<span>:</span>term</code> permissions to this role, as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/SNU8KS0SCf6EOEbx9eKPs/912fdb65b668cc90d36a9064b896c51e/assigning-permissions-to-editor-role.png" alt="Assigning permissions to the editor role"/></p><p>Remember to click the <em>Add Permissions</em> button to finalize the creation of the <code>glossary<span>-</span>editor</code> role.</p><h3 id="Creating-users-with-roles">Creating users with roles</h3><p>Ultimately, roles are meaningless without users. Now, you&#39;ll create two users and assign them the roles you&#39;ve made to test the application.</p><p>The first user will have <code>john@example<span>.</span>com</code> as their email and username and will be assigned the <code>glossary<span>-</span>editor</code> role.</p><p>The second user will have <code>jane@example<span>.</span>com</code> as their email and username and will be assigned the <code>glossary<span>-</span>admin</code> role.</p><p>Open the <a href="https://manage.auth0.com/#/users" target="_blank" rel="noreferrer noopener">Users</a> section in your Auth0 Dashboard and click the <em>Create User</em> button. Then, fill the form with the required data for the first user:<code>john@example<span>.</span>com</code> as the email, a password of your choice, and <code>Username<span>-</span>Password<span>-</span>Authentication</code> as the connection. The following is an example of a filled form:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/MUw60srrqjaN82e9N2eKo/818ff48164cd4d4b47aea198dd3a992c/creating-user-auth0-dashboard.png" alt="creating-user-auth0-dashboard"/></p><p>Click the <em>Create</em> button to create the user.</p><p>Now, on the user&#39;s page, select the <em>Roles</em> tab and click the <em>Assign Roles</em> button. In the popup window, select the <code>glossary<span>-</span>editor</code> role from the drop-down list and click the <em>Assign</em> button. The window should look as follows:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/60KIekM6LsTkdps1bn9cmH/9f11e710bd29983c50eb4eb816a029ad/assign-role-to-user.png" alt="Assign editor role to the user"/></p><p>Repeat the same steps described so far to create the user <code>jane@example<span>.</span>com</code> and assign them the <code>glossary<span>-</span>admin</code> role.</p><h2 id="Checking-Permissions-in-Your-API">Checking Permissions in Your API</h2><p>At this point, you&#39;ve configured your API and created users with their respective roles on Auth0. Now it&#39;s time to enable your app to have more granular control over the HTTP requests it receives.</p><p>Recall that roles are collections of permissions. When you enabled RBAC for your API in the Auth0 Dashboard, you ensured that tokens issued by Auth0 for the API will include permissions within the access token. As a result, when clients use that same token for HTTP requests, the API can parse the token&#39;s permissions.</p><p>To correctly authorize the incoming HTTP requests, your API needs to make sure the access token has the necessary permissions. You can accomplish this task by defining one or more authorization policies and applying them to the methods that implement your ASP.NET Web API.</p><p>An <strong>authorization policy</strong> is a set of requirements that users or applications must meet in order to be allowed to perform an action on a resource. Let&#39;s see how you can define and apply an authorization policy in practice.</p><p>To define an authorization policy for the glossary Web API, open the <code>Startup<span>.</span>cs</code> file in the root folder of the project and append the following code to the body of the <code><span>ConfigureServices</span><span>(</span><span>)</span></code> method:</p><pre><code><span>// Startup.cs</span>

<span>// ...existing code...</span>

<span>namespace</span> <span>Glossary</span>
<span>{</span>
  <span>public</span> <span>class</span> <span>Startup</span>
  <span>{</span>
    <span>// ...existing code...</span>
    
    <span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
    <span>{</span>
      <span>// ...existing code...</span>
      
      <span>//üëá new code</span>
      services<span>.</span><span>AddAuthorization</span><span>(</span>options <span>=&gt;</span>
      <span>{</span>
        options<span>.</span><span>AddPolicy</span><span>(</span><span>&#34;CreateAccess&#34;</span><span>,</span> policy <span>=&gt;</span> 
                          policy<span>.</span><span>RequireClaim</span><span>(</span><span>&#34;permissions&#34;</span><span>,</span> <span>&#34;create:term&#34;</span><span>)</span><span>)</span><span>;</span>
        options<span>.</span><span>AddPolicy</span><span>(</span><span>&#34;UpdateAccess&#34;</span><span>,</span> policy <span>=&gt;</span> 
                          policy<span>.</span><span>RequireClaim</span><span>(</span><span>&#34;permissions&#34;</span><span>,</span> <span>&#34;update:term&#34;</span><span>)</span><span>)</span><span>;</span>
        options<span>.</span><span>AddPolicy</span><span>(</span><span>&#34;DeleteAccess&#34;</span><span>,</span> policy <span>=&gt;</span> 
                          policy<span>.</span><span>RequireClaim</span><span>(</span><span>&#34;permissions&#34;</span><span>,</span> <span>&#34;delete:term&#34;</span><span>)</span><span>)</span><span>;</span>
      <span>}</span><span>)</span><span>;</span>
      <span>//üëÜ new code</span>
    <span>}</span>
    
    <span>// ...existing code...</span>
  <span>}</span>
<span>}</span></code></pre><p>Here, you&#39;ve invoked the <code><span>AddAuthorization</span><span>(</span><span>)</span></code> method to configure the ASP.NET authorization service. You&#39;ve also defined three authorization policies via the <code><span>AddPolicy</span><span>(</span><span>)</span></code> method of the <code>options</code> parameter. Each policy has a name and a lambda expression. For example, the <code>CreateAccess</code> authorization policy is defined by requiring the <code>permissions</code> <a href="https://auth0.com/docs/tokens/json-web-tokens/json-web-token-claims" target="_blank" rel="noreferrer noopener">claim</a> in the access token whose value must be <code>create<span>:</span>term</code>. Similarly, for the <code>UpdateAccess</code> and the  <code>DeleteAccess</code> policies.</p><blockquote><p>Different approaches to creating authorization policies in ASP.NET exist. For example, you can use a <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/claims" target="_blank" rel="noreferrer noopener">claim-based authorization</a> or a <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/policies" target="_blank" rel="noreferrer noopener">policy-based authorization</a> approach. You can even create your own approach by <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/customizingauthorizationmiddlewareresponse" target="_blank" rel="noreferrer noopener">customizing the built-in ASP.NET authorization middleware</a>.</p></blockquote><h3 id="Applying-an-authorization-policy">Applying an authorization policy</h3><p>Once you define and register your authorization policies, you can apply them in your Web API. Applying an authorization policy is just a matter of passing parameters to the <code>Authorize</code> attribute. So, open the <code>GlossaryController<span>.</span>cs</code> file under the <code>Controllers</code> folder and apply the changes pointed out in the following:</p><pre><code><span>// Controllers/GlossaryController.cs</span>

<span>// ...existing code...</span>

<span>namespace</span> <span>Glossary<span>.</span>Controllers</span>
<span>{</span>
  <span>[</span><span><span>ApiController</span></span><span>]</span>
  <span>[</span><span><span>Route</span><span><span>(</span><span>&#34;api/[controller]&#34;</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span>class</span> <span>GlossaryController</span> <span>:</span> <span><span>ControllerBase</span></span>
  <span>{</span>
    <span>// ...existing code...</span>

    <span>[</span><span><span>HttpPost</span></span><span>]</span>
    <span>[</span><span><span>Authorize</span><span><span>(</span>Policy <span>=</span> <span>&#34;CreateAccess&#34;</span><span>)</span></span></span><span>]</span>    <span>//üëà changed code</span>
    <span>public</span> <span>ActionResult</span> <span>Post</span><span>(</span><span>GlossaryItem</span> glossaryItem<span>)</span>
    <span>{</span>
      <span>// ...existing code...</span>
    <span>}</span>

    <span>[</span><span><span>HttpPut</span></span><span>]</span>
    <span>[</span><span><span>Authorize</span><span><span>(</span>Policy <span>=</span> <span>&#34;UpdateAccess&#34;</span><span>)</span></span></span><span>]</span>    <span>//üëà changed code</span>
    <span>public</span> <span>ActionResult</span> <span>Put</span><span>(</span><span>GlossaryItem</span> glossaryItem<span>)</span>
    <span>{</span>
      <span>// ...existing code...</span>
    <span>}</span>

    <span>[</span><span><span>HttpDelete</span></span><span>]</span>
    <span>[</span><span><span>Route</span><span><span>(</span><span>&#34;{term}&#34;</span><span>)</span></span></span><span>]</span>
    <span>[</span><span><span>Authorize</span><span><span>(</span>Policy <span>=</span> <span>&#34;DeleteAccess&#34;</span><span>)</span></span></span><span>]</span>    <span>//üëà changed code</span>
    <span>public</span> <span>ActionResult</span> <span>Delete</span><span>(</span><span><span>string</span></span> term<span>)</span>
    <span>{</span>
      <span>// ...existing code...</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre><p>This way, you are requesting that the ASP.NET authorization middleware evaluates a specific policy to authorize the execution of the related controller&#39;s method.</p><p>Your Web API is ready to run and check permissions!</p><h2 id="Testing-the-Web-API">Testing the Web API</h2><p>To test your glossary Web API, you need a client that allows your users to authenticate with Auth0 and get an access token with the proper permissions based on their role. Fortunately, the Swagger UI of the sample Web API is built to be very much an actual client of your API. You just need to enable OAuth support so that the user can authenticate and get their access token.</p><h3 id="Configuring-the-client">Configuring the client</h3><p>To configure your Swagger UI, you need to register it with Auth0. Head to the <a href="https://manage.auth0.com/#/applications" target="_blank" rel="noreferrer noopener">Application section of your Auth0 Dashboard</a> and click the <em>Create Application</em> button in the upper right corner. In the window that appears, provide a meaningful name, e.g., <em>Glossary client</em>, and select <em>Regular Web Applications</em> as the application type. That window should look like the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3RmuR8F9nAIR7bk9xA0mkM/2a732e3f8ab67e14d149498a927f291a/register-glossary-client-with-auth0.png" alt="Register the glossary client with Auth0"/></p><p>Now, click the <em>Create</em> button to confirm. After the client page is created, move to the <em>Settings</em> tab and take note of the Client ID and the Client Secret values.</p><p>Now, back in your project, open the <code>appsettings<span>.</span>json</code> configuration file and apply the changes highlighted below:</p><pre><code><span>// appsettings.json</span>
<span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
    <span>&#34;LogLevel&#34;</span><span>:</span> <span>{</span>
      <span>&#34;Default&#34;</span><span>:</span> <span>&#34;Information&#34;</span><span>,</span>
      <span>&#34;Microsoft&#34;</span><span>:</span> <span>&#34;Warning&#34;</span><span>,</span>
      <span>&#34;Microsoft.Hosting.Lifetime&#34;</span><span>:</span> <span>&#34;Information&#34;</span>
    <span>}</span>
  <span>}</span><span>,</span>
  <span>&#34;AllowedHosts&#34;</span><span>:</span> <span>&#34;*&#34;</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;YOUR_AUTH0_DOMAIN&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;YOUR_UNIQUE_IDENTIFIER&#34;</span><span>,</span>
    <span>// üëá new keys</span>
    <span>&#34;ClientId&#34;</span><span>:</span> <span>&#34;YOUR_CLIENT_ID&#34;</span><span>,</span>
    <span>&#34;ClientSecret&#34;</span><span>:</span> <span>&#34;YOUR_CLIENT_SECRET&#34;</span>
    <span>// üëÜ new keys</span>
  <span>}</span><span>,</span>
  <span>&#34;SwaggerUISecurityMode&#34;</span><span>:</span> <span>&#34;oauth2&#34;</span>        <span>// üëà new key</span>
<span>}</span></code></pre><p>You added the <code>ClientId</code> and <code>ClientSecret</code> keys within the <code>Auth0</code> section. Replace the <code><span>YOUR_CLIENT_ID</span></code> and <code><span>YOUR_CLIENT_SECRET</span></code> placeholders with the corresponding values you just annotated from the Auth0 Dashboard. The <code>Domain</code> and <code>Audience</code> keys keep the values you already assigned at the beginning of this article.</p><p>Also, you added the <code>SwaggerUISecurityMode</code> key with the <code>oauth2</code> value. This key enables the Swagger UI to act as an OAuth client so that it asks Auth0 for an access token on behalf of a user. You will see how it works in a moment.</p><blockquote><p>Keep in mind that the <code>SwaggerUISecurityMode</code> key is a custom key supported by this sample project. It is only required for demo purposes in order to test your API with the Swagger UI. In a real-world scenario, your API will be called by a real client.</p></blockquote><p>Now, launch the Web API by typing <code>dotnet run</code> in a terminal window and point your browser to <a href="https://localhost:5001/swagger" target="_blank" rel="noreferrer noopener">https://localhost:5001/swagger</a>.</p><blockquote><p>I suggest using your browser in incognito mode to switch between users easily.
In fact, an unresolved issue in Swagger UI prevents you from logging out from the authorization server. See <a href="https://github.com/swagger-api/swagger-ui/issues/3368" target="_blank" rel="noreferrer noopener">these</a> <a href="https://github.com/domaindrivendev/Swashbuckle.AspNetCore/issues/436" target="_blank" rel="noreferrer noopener">issues</a> for more information.</p></blockquote><h3 id="Testing-access-with-the-Editor-role">Testing access with the Editor role</h3><p>In the Swagger UI of your Web API, click the <em>Authorize</em> button. You should see a window like the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7yvXburi6A2FwFtLED0OAr/3bbe5d0f2c6a3895a35b72349db107c5/swagger-ui-authorization-window.png" alt="Swagger UI authorization window"/></p><p>This window asks to authorize the Swagger UI client to obtain an access token on behalf of the user. By clicking the <em>Authorize</em> button here, you will be redirected to the <a href="https://auth0.com/docs/login/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login page</a>. On that page, authenticate as a user having the Editor role by providing the credentials of <code>john@example<span>.</span>com</code>, as you <a href="#Creating-users-with-roles">created them before</a>. After you authenticate, you will be redirected back to the following screen:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4osuAFMDIObnRv0yOdA4Zs/d31188f8c819d8bbc7969ea5da667648/swagger-ui-authorized-window.png" alt="Swagger UI authorized window"/></p><p>Your Swagger UI client has now received the access token for that user. Click the <em>Close</em> button and try to add a new term to the glossary through the POST action. In the Swagger UI, click the <em>POST /api/Glossary</em> row and then the <em>Try it out</em> button. Now, add a new term definition as in the following example:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/198INMtj79uGHzSj0GFf6C/8c5cdc291681c150f4932ff2a9175151/create-new-glossary-term.png" alt="Create a new glossary term"/></p><p>By clicking the <em>Execute</em> button, you should get a successful response similar to the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/GKma6edlyKq8Er3g7FzAE/840c64bd654a0f8460a54cd6598dc375/successful-response-to-creating-new-term.png" alt="Successful response to creating a new term"/></p><p>If you <a href="https://auth0.com/docs/security/tokens/access-tokens/get-management-api-access-tokens-for-production#use-access-tokens" target="_blank" rel="noreferrer noopener">copy the access token</a> from the <code>curl</code> statement text box and decode it in <a href="https://jwt.io/" target="_blank" rel="noreferrer noopener">jwt.io</a>, you should see a payload similar to the following:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3BWPIoM8PTjxXjmE13EpBp/d7d31e8a349915925d1935ff3c6f5567/editor-access-token-payload.png" alt="Editor access token payload"/></p><p>You can see the <code>permissions</code> claim containing the <code>create<span>:</span>term</code> and <code>update<span>:</span>term</code> permissions. These permissions are assigned to the current user thanks to their Editor role. Also, the <code>create<span>:</span>term</code> permission is the one required by the <code>CreateAccess</code> policy that controls the access to the <code><span>Post</span><span>(</span><span>)</span></code> method in your API controller. So, everything works as expected.</p><p>If you try to modify a glossary term through the PUT action, you should get a successful response as well.</p><h3 id="Testing-the-API-with-the-Administrator-Role">Testing the API with the Administrator Role</h3><p>However, if you attempt to delete the newly created term, you should receive a <code><span>403</span> Forbidden</code> status code. In fact, your access token doesn&#39;t contain the <code><span>delete</span><span>:</span>term</code> permission. Only users with the Admin role are allowed to delete terms.</p><p>So, clear the cookies in your browser (or close it and reopen it in incognito mode).</p><p>Click the <em>Authorize</em> button again and this time authenticate as the <code>jane@example<span>.</span>com</code> user. That user has the Admin role. Now, try to execute all the three protected actions: POST, PUT, and DELETE. You should be able to perform them successfully.</p><h2 id="Roles-and-APIs">Roles and APIs</h2><p>Applying RBAC to Web APIs shown above leverages the Auth0&#39;s ability to extract permissions from user roles at login time and add them to the <code>permissions</code> access token&#39;s claim. As the API developer, this approach lets you focus just on permissions and leave the role management to Auth0.</p><p>As an ASP.NET developer, you may know that you could use the <code>Roles</code> parameter with the <code>Authorize</code> attribute, as shown in the following example:</p><pre><code><span>[</span><span><span>HttpPost</span></span><span>]</span>
<span>[</span><span><span>Authorize</span><span><span>(</span>Roles <span>=</span> <span>&#34;glossary-editor, glossary-admin&#34;</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>ActionResult</span> <span>Post</span><span>(</span><span>GlossaryItem</span> glossaryItem<span>)</span>
<span>{</span>
  <span>// ... existing code ...</span>
<span>}</span></code></pre><p>So, you might ask yourself a couple of questions at this point:</p><ul><li>Is it possible to include user roles in the access token issued by Auth0?</li><li>Why not check roles instead of permissions on the Web API side?</li></ul><p>Let&#39;s try to answer both questions.</p><h3 id="Including-roles-in-the-access-token">Including roles in the access token</h3><p>Auth0 allows you to add user roles in the access token issued at login time. However, this is not a built-in feature, i.e., something that you got without any explicit intervention. To enrich the access token with the user&#39;s roles, you need to add an <a href="https://auth0.com/docs/actions" target="_blank" rel="noreferrer noopener">Auth0 Action</a> to the login flow. An Action is a JavaScript function that allows you to customize the standard behavior of different <a href="https://auth0.com/docs/actions/triggers" target="_blank" rel="noreferrer noopener">Auth0 flows</a>. Check out <a href="https://auth0.com/blog/introducing-auth0-actions/" target="_blank" rel="noreferrer noopener">this blog post to get an overview of Auth0 Actions</a>.</p><p>Showing how to use Auth0 Actions to add user roles in the access token is out of the scope of this article. However, you can <a href="https://auth0.com/docs/actions/triggers/post-login#add-user-roles-to-tokens" target="_blank" rel="noreferrer noopener">take a look at this Action example</a> to get an idea of how it works.</p><h3 id="Checking-permissions-or-roles-">Checking permissions or roles?</h3><p>One of the reasons you may want to check roles instead of permissions on the Web API side could be that they are easy to read and understand quickly. They lead to a direct mapping between user roles and your API. They are easy to read and understand. Looking at the following code, you know at a glance who is allowed to do a given action:</p><pre><code><span>[</span><span><span>HttpDelete</span></span><span>]</span>
<span>[</span><span><span>Route</span><span><span>(</span><span>&#34;{term}&#34;</span><span>)</span></span></span><span>]</span>
<span>[</span><span><span>Authorize</span><span><span>(</span>Roles <span>=</span> <span>&#34;glossary-admin&#34;</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>ActionResult</span> <span>Delete</span><span>(</span><span><span>string</span></span> term<span>)</span>
<span>{</span>
  <span>// ... existing code ...</span>
<span>}</span></code></pre><p>It is immediately obvious that only the glossary administrator can delete a glossary term. Having the permission instead of the role requires you to think about who the users having the <code><span>delete</span><span>:</span>term</code> permission may be. It implies you have an extra layer of mapping between roles and permissions in mind.</p><p>However, there are some drawbacks in checking roles on the Web API side in return for this benefit.</p><p>Imagine you implemented your glossary Web API with role checking instead of permission checking. After your Web API is published, you need a new role for your glossary application: the Assistant role. Say you name this role <code>glossary<span>-</span>assistant</code>. Users in this role can only update existing terms, and so they will only have the <code>update<span>:</span>term</code> permission.</p><p>To enable this role on your Web API, you now need to change its code in the controller. You need to add the <code>glossary<span>-</span>assistant</code> role to the list of the allowed roles of the <code><span>Put</span><span>(</span><span>)</span></code> method. Not complicated... But now, you need to redeploy your API with the new code!</p><p>If you check permissions instead of roles, you don&#39;t need any updates on the Web API side. The role management and the permission unpacking is an Auth0 responsibility.</p><p>Once again: roles are just collections of permissions. While, in general, permissions are quite static, roles are more dynamic. The need to group permissions for new roles or combine multiple roles for the same user makes permission checking more convenient and lower-maintenance.</p><p>Think of the simple glossary Web API. It relies on only three permissions. However, it can lead to the creation of seven roles (eight, if we also consider the empty role). This should make you think about the opportunity to deal with roles on the Web API side.</p><p>Finally, consider that <a href="https://auth0.com/docs/authorization/rbac/rbac-users/assign-permissions-to-users" target="_blank" rel="noreferrer noopener">Auth0 allows you to directly assign permissions to a user</a>. In that case, if you only check roles, you miss any directly assigned permissions causing a security flaw in your Web API.</p><h2 id="Summary">Summary</h2><p>Throughout this article, you learned how to use Auth0 Role-Based Access Control in your ASP.NET Web API.</p><p>You started by defining and assigning roles to your users. Then, you registered a glossary Web API with Auth0 and enabled RBAC support. Next, you implemented an authorization policy in your Web API to check user permissions.</p><p>Finally, you learned why checking permissions on the API side is better than directly checking roles.</p><p>You can find the final version of the glossary Web API implemented throughout the article in <a href="https://github.com/auth0-blog/glossary-rbac-web-api-aspnet" target="_blank" rel="noreferrer noopener">this GitHub repository</a>.</p></div></div>]]></content:encoded>
      <author>Registering an authorization policy</author>
      <pubDate>Tue, 02 Nov 2021 16:20:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Wins Gold at WorkL Workplace Awards 2021</title>
      <link>https://auth0.com/blog/auth0-wins-gold-at-workl-workplace-awards-2021/</link>
      <description>Auth0 recognized among Britain‚Äôs five best places to work in technology, and one of 20 ‚Äúmost engaged‚Äù employers</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>LONDON ‚Äì 2 November 2021</strong> ‚Äì¬†The <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Identity Platform</a>, a product unit within <a href="https://www.okta.com/" target="_blank" rel="noreferrer noopener">Okta, Inc.</a> (NASDAQ: OKTA), today announced it has been named among Britain‚Äôs five best places to work in technology, and one of the top 20 ‚Äúmost engaged‚Äù employers in the <a href="https://www.telegraph.co.uk/business/2021/10/26/winners-workl-workplace-awards-2021-revealed/" target="_blank" rel="noreferrer noopener">WorkL Workplace Awards 2021</a>.</p><p>Conducted in partnership with The Telegraph, the awards recognize UK employers across 26 industries that score highest on a staff satisfaction survey. The five companies with the highest scores in each category are awarded gold status for the most engaged workforce. Of the 20,000 companies that entered, a select few are also recognized as the most inclusive, best in well-being, and having the most engaged employees ‚Äì including Auth0.</p><p>‚ÄúI‚Äôm pleased to congratulate Auth0 on its gold medal. After such a difficult 18 months in business, I‚Äôm pleased that our awards are celebrating organizations that are leading the way, creating happy and engaged employees,‚Äù said Lord Mark Price, founder of WorkL, and former UK Trade Minister and ex-managing director of British supermarket brand, Waitrose &amp; Partners.</p><p>Employer scores, called the ‚ÄúWorkplace Happiness Score,‚Äù are calculated based on employee feedback about reward and recognition, information sharing, empowerment, well-being, and other elements of job satisfaction over the past year. The awards are the latest in a series of accolades recognizing Auth0‚Äôs remote working DNA and culture, including the <a href="https://auth0.com/blog/auth0-named-one-of-the-10-best-mid-sized-companies-to-work-for-in-london/" target="_blank" rel="noreferrer noopener">UK‚Äôs Best Companies to Work For List</a> and <a href="https://auth0.com/blog/auth0-awarded-highest-accreditation-by-best-companies-uk/" target="_blank" rel="noreferrer noopener">Best Companies Accreditation</a>.</p><p>‚ÄúWe owe a tremendous debt of gratitude to our employees who responded to the survey, and all who continue to make Auth0 a great place to work,‚Äù said Steven Rees-Pullman, SVP International at Auth0. ‚ÄúFrom Auth0&#39;s inception, our founders instilled values of transparency, collaboration, and experimentation into the business. Those values are exemplified by all of our employees and create this award-winning culture. Many congratulations to all!‚Äù</p><p>Auth0 is now part of Okta, the leading independent identity provider, with a vision to provide secure access to any technology. Learn more about what it‚Äôs like to work here, and apply to join our growing team on the <a href="https://auth0.com/careers" target="_blank" rel="noreferrer noopener">Auth0 Careers Page</a>.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h3 id="Media-Contacts">Media Contacts</h3><p>Auth0 Global Communications <br/><a href="mailto:press@auth0.com" target="_blank" rel="noreferrer noopener">press@auth0.com</a><br/></p></div></div>]]></content:encoded>
      <pubDate>Tue, 02 Nov 2021 13:24:00 +0000</pubDate>
    </item>
    <item>
      <title>We Are Thankful for Our Team</title>
      <link>https://auth0.com/blog/we-are-thankful-for-our-team/</link>
      <description>Recognizing the efforts of the Okta and Auth0 teams during 2021</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><section itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="mainEntity"><header><div><div><p><span>Culture</span></p><p itemprop="description">Recognizing the efforts of the Okta and Auth0 teams during 2021</p></div><p>November 01, 2021</p><meta itemprop="datePublished" content="2021-11-01"/><meta itemprop="dateModified" content="2021-11-01"/></div></header><header><div><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2G5alVFWdMmLBVZZeHPkaq/dc4092634b2a6956e7f825ae149eddac/auth0-blue-logo"/></p><div><p><span>Culture</span></p><p itemprop="description">Recognizing the efforts of the Okta and Auth0 teams during 2021</p><p>November 01, 2021</p><meta itemprop="datePublished" content="2021-11-01"/><meta itemprop="dateModified" content="2021-11-01"/></div></div></header><article><main id="post-content" itemprop="articleBody"><div><p>As 2021 starts to draw to a close, we all find ourselves reflecting on the year. We‚Äôve all been through a lot ‚Äî both inside and outside of work ‚Äî and I know how hard our employees have worked this year to provide the best possible product, innovations, and service for our customers.</p><p>So to say thanks for all their efforts ‚Äî and to ensure everyone has the chance to spend time with family, go on an adventure, or just kick back on the couch with ice cream ‚Äî both Okta and Auth0 teams will have the week of US Thanksgiving and the week following Christmas as a company holiday.</p><p>While these weeks are designated holidays, business continuity and reliability are our first priority. All support, customer success, engineering, and communications teams will rotate weeks away to ensure there is no disruption for our customers. We‚Äôve also implemented an extended period of code freeze during the holiday season, with an elevated approval process for exceptions to limit any risk of service disruption. For all of the details on our ongoing resiliency efforts, <a href="https://auth0.com/blog/improving-our-platform-resiliency-and-upcoming-holiday-plans/" target="_blank" rel="noreferrer noopener">please visit here</a>.</p><p>Too often in our industry, we overvalue work and undervalue rest. We don‚Äôt work so we can rest. We rest so we can work ‚Äî and grow and change, which lets us continue to provide our customers the best possible experiences.</p><p>We are committed to bringing our very best to you all in the coming year.</p><p>Thank you,</p><p>Eugenio Pace</p></div></main></article></section></div>]]></content:encoded>
      <pubDate>Mon, 01 Nov 2021 16:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Getting To Know Will Johnson, Developer Advocate @ Auth0</title>
      <link>https://auth0.com/blog/will-johnson-developer-advocate-auth0/</link>
      <description>Meet Will Johnson, part of the developer relations team at Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Hi! My name is Will Johnson, and I&#39;m going to tell you the story of how I ended up in the Developer Relations world.
One thing I&#39;ve learned is that where you begin does not guarantee where you will end. It&#39;s been an ever-changing path for me, but it&#39;s never too late to take control and direct your path.</p><h2 id="My-Interest-In-Computers-Is-Sparked">My Interest In Computers Is Sparked</h2><p>I remember sitting in my 3rd-grade class: all the kids were quiet, but you could feel the excitement in the air. Something new was coming: our desks were lined around the walls of the room. At first, everyone faced the middle of the class. Then, the doors opened, everyone looked anxiously, waiting for what was to come through.</p><p>One by one, the computer lab team rolled in brand new colored iMacs! The class went wild! Before this, we had blocky computers with green and black UI&#39;s. They were huge, slow, and boring. The iMacs were cool, colorful, and small. Something completely new!</p><p>That sparked my interest in computers. I always wanted to be on the computer and do things on it. I remember telling my teachers I want to tell computers what to do. I had no idea what that meant, and usually, they would direct me to learn the hardware part of computers. But I had no interest in that. The programs were what caught my attention.</p><h2 id="Writing-My-First-Lines-of-Code">Writing My First Lines of Code</h2><p>Growing up, we never had a computer at home. I would only use the ones at school during lab time. I got my own computer right around the time the social media site MySpace was getting popular. One of the cool features was using HTML and CSS (even JavaScript, which I later learned) to customize my page. I spent hours googling different layouts and animations I could add to my page. (Yes, I used the <code><span>&lt;</span>marquee<span>&gt;</span></code> tag all over the place). Then I started doing my friends&#39; pages. I enjoyed playing around with the code so much. I didn&#39;t even know you could use HTML and CSS to make real websites; I thought only MySpace used them. I would just search &#34;how to make moving text myspace&#34; without realizing I was using HTML and CSS at that time.</p><p>After MySpace lost its popularity, I stopped customizing pages. At that time, I was unaware that I had a valuable skill that aligned with my interests. I started planning what I would do for work, so I looked into the local college programs. They were all IT; no computer programming, computer science, or anything that would let me &#34;tell computers what to do.&#34; Since I didn&#39;t want to go into a bunch of debt for something I wasn&#39;t sure was my thing, I put my tech dreams on hold.</p><h2 id="Getting-Over-My-Fears">Getting Over My Fears</h2><p>When working at my day jobs, I would still do random tech things on the side. Like taking broken cell phones and replacing the parts, so they looked like new. Once, I had a Windows smartphone that I modded to run Android. I think I even used Java for that, some instructions were quite tricky, but I enjoyed the process of learning and kept going. I would search Google or YouTube and try stuff, and because of that, I&#39;ve broken and bricked plenty of phones, but I was always having fun.</p><p>Around this time, I started to hear more and more about making apps and coding. Every time computer programming came up, people said: &#34;You have to be good at math or coding on a computer since you are young.&#34; Neither of those was me, so it made me stop pursuing any further. People always made it seem like working with computers was really hard, and you had to be a super genius or something like that.</p><p>After being fed up with manual labor jobs, I decided to change careers and try different things. Then one day, I came across a forum post where everyone was buying online courses. In particular, I noticed that everyone was buying a specific course on web development. I spent $10 and purchased that course. I was skeptical if this was legit or not. Could I get a job just by learning online? I was willing to give it a shot. I mean, it was only $10.</p><p>As soon as I started learning, I began to recognize the syntax. &#34;Yo! This is the stuff from MySpace that I learned a long time ago. I&#39;ve already done this.&#34;</p><h2 id="Breaking-Into-Tech">Breaking Into Tech</h2><p>Learning to code and breaking into tech involved reading lots of blogs, watching videos, and listening to podcasts. I was so thankful that developers took time out of their day to create content to help other developers. So I started doing the same: I wrote blog posts, recorded screencasts, volunteered to mentor for workshops, spoke at meetups, and hosted a podcast. I would also tweet what I was learning and help others on Twitter as well. Every time I helped another dev get unstuck, it felt really good.</p><p>All of this content and community work was very fulfilling. I was learning new things and helping people reach new levels in their careers.
At that time, I started to see the role of Developer Advocate pop up a lot. I didn&#39;t quite understand it at first, but it aligned with me more as I learned more about it. I liked tinkering with code and showing others how to do the same. Then people started to tell me all the time, &#34;You should get into Developer Relations&#34; or &#34;You&#39;d be a great developer advocate.&#34;</p><p>It took me some time and a lot of thinking, and then it clicked: I love the tech community! I&#39;ve met a lot of incredible people, and I love helping them learn new things so they can crush their goals. It&#39;s a great joy for me.</p><p>I like to be remembered as a person that tried his best to help people in any way I could. That&#39;s why, in August 2021, I joined the Auth0 developer relations team. Their vision of empowering developers aligns with mine perfectly. That&#39;s why I look forward to creating content that humanizes the technical jargon and helps developers with their daily work.</p><p>So, this is my story of how I ended up fulfilling my early dream. Even if you are not working on something that energizes you, it is never too late to pivot to what you are passionate about. Don&#39;t get discouraged, and keep pursuing your dreams.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 28 Oct 2021 15:08:00 +0000</pubDate>
    </item>
    <item>
      <title>Wharton Interactive Selects Auth0 to Help Securely Democratize and Transform Education</title>
      <link>https://auth0.com/blog/wharton-interactive-selects-auth0-to-help-securely-democratize-and-transform-education/</link>
      <description>Global identity management provider supports the launch of Ivy League MBA interactive learning platform</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>BELLEVUE, Wash. ‚Äì Oct. 28, 2021</strong> ‚Äì¬†The <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Identity Platform</a>, a product unit within Okta (NASDAQ: OKTA), today announced it has been selected as the identity and authentication provider for¬†<a href="https://interactive.wharton.upenn.edu/" target="_blank" rel="noreferrer noopener">Wharton Interactive</a>, an interactive learning platform that draws on games, simulations, and research to make Ivy League business education more accessible to all. To enable a seamless, end-to-end experience for learners and educators, Auth0‚Äôs platform will provide a <a href="https://auth0.com/blog/what-is-single-sign-on-a-non-developer-s-guide/" target="_blank" rel="noreferrer noopener">Single Sign-on</a> (SSO) solution for learners and educators throughout their journey.</p><p>Wharton Interactive ‚Äî founded by Sarah Toms, executive director, and Professor Ethan Mollick at the Wharton School, The University of Pennsylvania ‚Äî has developed different modes of delivering education on its Alternate Reality Courseware (ARC) platform. ARCs knit together leading subject matter expertise and an immersive games-based experience where users gain mastery through practice and receive personal feedback about their performance every step of the way. By increasing inclusive access to business education, this unique higher ed initiative strives to better the socio-economic status of individuals and lift economies through job creation.</p><p>To aid in Wharton Interactive‚Äôs marketplace launch, the team wanted to create one, seamless user experience across the entire platform, from the user‚Äôs account creation and management to the interactive simulations and classes, and selected Auth0 to help. By implementing SSO, students and educators can enter their login credentials once and automatically gain access to multiple applications. Through the implementation of Auth0‚Äôs SSO solution, Wharton Interactive‚Äôs platform benefits from increased security and privacy while improving the end-to-end experience for users.</p><p>‚ÄúAuth0 plays an integral role in making Wharton Interactive‚Äôs mission to transform education a reality by eliminating the hurdles associated with having to login to multiple systems along the customer journey,‚Äù said Sarah Toms, co-founder and Executive Director for Wharton Interactive. ‚ÄúWe were searching for a top-notch identity provider with proven expertise in SSO, and are so pleased that we have partnered with Auth0. From vendor selection to launch, it took only a few months to build and deliver a comprehensive solution that was ready for market.‚Äù</p><p>‚ÄúWharton Interactive is democratizing higher education and transforming the eLearning space with its cutting-edge approaches, and identity is a key enabler in supporting this mission ‚Äî strong user experience, security, and privacy practices all start at login,‚Äù said Ghazi Masood, General Manager and SVP of Americas at Auth0. ‚ÄúWe‚Äôre honored to support Wharton Interactive‚Äôs identity needs and help them seamlessly scale as they make education more attainable and secure for educators and learners around the world.‚Äù</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h3 id="Media-Contacts">Media Contacts</h3><p>Auth0 Global Communications<br/><a href="mailto:press@auth0.com" target="_blank" rel="noreferrer noopener">press@auth0.com</a><br/></p><p>Matter Communications for Auth0<br/><a href="mailto:auth0@matternow.com" target="_blank" rel="noreferrer noopener">auth0@matternow.com</a><br/></p><h3 id="Investor-Contact-">Investor Contact:</h3><p>Investor Relations <br/><a href="mailto:investor@okta.com" target="_blank" rel="noreferrer noopener">investor@okta.com</a></p></div></div>]]></content:encoded>
      <pubDate>Thu, 28 Oct 2021 13:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Improving Our Platform Resiliency and Upcoming Holiday Plans</title>
      <link>https://auth0.com/blog/improving-our-platform-resiliency-and-upcoming-holiday-plans/</link>
      <description>We are committed to delivering a Tier 0 service for our customers</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Over the last few months, there has been an increase in service degradation and outages that has shaken our customer‚Äôs confidence in Auth0. Our number one mission is to provide you with the highest level of service and reliability at all times, for the full spectrum of customers from free users to enterprise. The production environments in US-1 and EU have been impacted the most frequently and, in extreme cases, has caused downtime for some of our customers. As the Auth0 CPO, I sincerely apologize for the pain this caused you and your customers. We take ownership for the failures and recognize how disappointed you are.</p><p>We know that identity plays a critical role in your company, and it is our responsibility to make our service reliable. It is also our responsibility to provide guidance to our customers on appropriate architecture patterns. When we experience failures or degradation of our service, we correct them as swiftly as possible. Today, I wanted to share the active measures we are taking to protect against similar issues from occurring in the future.</p><h2 id="First--What-Caused-the-Outages-">First, What Caused the Outages?</h2><p>Before we explore all of the actions we have taken, it‚Äôs good to understand the patterns we have observed in these environments:</p><h3 id="Noisy-neighbors-in-our-large-multi-tenant-environments-create-throughput-bottlenecks">Noisy neighbors in our large multi-tenant environments create throughput bottlenecks</h3><p>The noisy neighbor phenomenon is a well-known issue in multi-tenant environments. In our case, one co-tenant may experience a spike in traffic which can lead them to monopolize resources available and thus reduce the throughput (requests-per-second) on the environment for the other co-tenants.</p><p>Most of our customers in the US-1 and EU environments have enjoyed many years of uninterrupted service. These environments have grown significantly and are now the longest-running and largest, which exacerbates the noisy neighbor impact.</p><p>We have not strictly enforced restrictions to the frequency of customer API calls (rate limits) and at times allowed for a 10X increase in requests-per-second (RPS) for certain tenants in a single environment. Typically, our architecture would allow us to absorb these spikes as it is the case in most of our environments, but given the volume and size of the customers in US-1 and EU, these concurrent requests restrict throughput for other tenants. We do not fault our customers for their peak traffic needs and it is on us to put in place the right protections and guardrails around each tenant. Unfortunately, we are not able to actively load shed today (i.e. automatically move tenants to other environments such as US-3, because we don‚Äôt currently have the migration tooling nor can we do it without any downtime). There are some customer scenarios where a planned migration by a customer is possible, but it requires time and effort on your part. I will cover migration scenarios and timing in the ‚ÄòLooking beyond the next 60 days‚Äô section below.</p><h3 id="Region-Mean-Time-To-Recovery--MTTR--outside-of-our-15-min-target">Region Mean Time To Recovery (MTTR) outside of our 15-min target</h3><p>The other item we are solving is meeting our 15 minutes target for region failover. This is caused by dependencies on an underlying managed service that doesn‚Äôt support automated failover within our target timeframe. Our teams are in the final stages of completing the switch, a managed service that allows us to automatically failover within 15-minutes, in Q1 2022.</p><p>We can successfully failover Availability Zones (AZ) today within our 1-minute target window as validated by quarterly testing.</p><h2 id="What-Actions-Have-We-Taken-Already-">What Actions Have We Taken Already?</h2><h3 id="Slowing-down-and-invoking-our-change-freeze-earlier">Slowing down and invoking our change freeze earlier</h3><p>Effective Sept. 30, 2021, we‚Äôve significantly reduced the number and frequency of changes that we‚Äôre introducing into production for the remainder of the year. This is to introduce increased testing and soak time in pre-production environments. Heading into the holiday season, our protocols may change slightly, however, we anticipate continuing a conservative posture to maintain the stability of our production environments. We are mostly allowing changes that are related to our resiliency initiatives or security patches. Being an authentication platform, security-related changes are non-negotiable, as is our mission to protect you and your customers.</p><h3 id="New-staging-environment">New staging environment</h3><p>As of early October, we have a staging environment that has the same load as US-1, so that we can simulate test cases reproducing production traffic at large scale. The volume and high load-related issues described above can now be more easily detected.</p><h3 id="Additional-resources-and-re-prioritization-of-our-roadmap">Additional resources and re-prioritization of our roadmap</h3><p>We have added team members and reprioritized resilience projects in order to complete these improvements in time for the holiday season. I am personally doing a daily stand-up with our Engineering leadership team to ensure there is an elevated review process and all blockers are actively being addressed. In addition, all new product and feature initiatives have been deferred until the new year.</p><h3 id="Resilience-and-holiday-readiness-efforts">Resilience and holiday readiness efforts</h3><p>After our outage on April 20th, a dedicated team of 40 engineers completed a 10-week task force to reduce the load on our environments that resulted in:</p><ul><li>Reduced cache load by removing unused feature flags and added in-memory caching of multiple per-environment feature flags.</li><li>Removed 2 collections from our database that reduced total database writes by 10%.</li><li>Reduced reads to the collection with the most reads within the database by 12%.</li><li>Added limits to refresh tokens queries from the Management API.</li><li>Added missing indexes for new collections in the database.</li></ul><p>Some of the improvements identified were multi-quarter projects that are still underway and are expected to be completed this November. These projects will:</p><ul><li>Reduce the read/write workload by 10%.</li><li>Reduce 40% of inserts/deletes from our database.</li><li>Reduce 30% of inserts/deletes from our database in US-1 enviroment. This requires a deprecation of opaque access tokens and will take 6 months to complete.</li></ul><p>In October, we started the following remediation projects to further reduce the probability of these failures:</p><ul><li>Refactoring our connections schema to remove high cardinality issues.</li><li>Addressing noisy neighbor issues in our extensibility stack (also known as Webtask).</li><li>Implementing an additional caching layer for reading requests.</li><li>Proactively and significantly over-provisioning our stack in an effort to get ready for holiday traffic.</li><li>Enforcing global active rate management per tenant at the edge.</li></ul><p>The projects listed above are also scheduled to be live and in production by November 10. We know that all of the initiatives above will reduce the load on our environments and should significantly reduce the noisy neighbor issue I referenced above.</p><p>We are also initiating code change freeze windows over the holidays:</p><p>üüß <strong>Orange Change Freeze</strong> 10/12 - 11/11 <br/></p><p>üü• <strong>Red Change Freeze</strong> 11/12 - 11/29 <br/></p><p>üüß <strong>Orange Change Freeze</strong> 11/30 - 12/16 <br/></p><p>üü• <strong>Red Change Freeze</strong> 12/17 - 01/03 <br/></p><p>üüß <strong>Orange Change Freeze:</strong> During this window, all production deployments are halted, and only work related to stability for Mission Critical Services, security patches or urgent releases on other components may be deployed. Changes must meet testing and approval criteria. <br/></p><p>üü• <strong>Red Change Freeze</strong>: During this window, all production deployments are halted. Exceptions allowed only to resolve critical customer issues or security patches. Changes must meet testing and approval criteria. <br/></p><h2 id="Looking-Beyond-the-Next-60-Days">Looking Beyond the Next 60 Days</h2><h3 id="New-environments-and-migration-capabilities">New environments and migration capabilities</h3><p>We are now actively working on creating new environments in our US and EU regions. Our target is to progressively introduce 4 new environments in the US and up to 3 new environments in the EU in CY Q1 2022. The new environments allow us to dynamically allocate load as part of our demand response strategies and significantly reduce the blast radius of disruptions and outages. Our team is also actively scoping and designing an automated tenant migration process. We expect to have an automated tenant migration tool that will enable us to work with you and migrate you over to one of our newer environments beginning late CY Q1 2022.</p><h3 id="New-platform-rollout-across-clouds-and-regions">New platform rollout across clouds and regions</h3><p>We began working on a modern platform last year that is poised to roll out across the regions and clouds that we operate in. This month we began the gradual rollout of this new platform and made it available on Microsoft&#39;s Azure cloud. This new platform architecture has been purposefully designed from the ground up to deliver a scalable, reliable, and resilient service that meets the current and future needs of our customers. We are targeting to make this available on AWS starting CY 1H 2022.</p><p>Finally, we truly appreciate your trust in Auth0 and will do everything that we can to keep that trust. I will post another public update in early CY Q1 2022 to share the results of all of our work in future blog updates including the progress of the improvement initiatives listed above.</p><p><em>Please note: any unreleased products, features, or functionality referenced in this disclosure may not be currently available and may not be delivered on time or at all. Product roadmaps do not represent a commitment, obligation, or promise to deliver any product, feature, or functionality, and you should not rely on them to make your purchase decisions.</em></p></div></div>]]></content:encoded>
      <pubDate>Wed, 27 Oct 2021 16:48:00 +0000</pubDate>
    </item>
    <item>
      <title>How To Protect Against Ransomware In 2021</title>
      <link>https://auth0.com/blog/how-to-protect-against-ransomware-in-2021/</link>
      <description>Ransomware attacks are among the most profitable for criminals and remain the most prominent malware threat today</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>As digital assets increase in value (in some cases, being <em>the most</em> valuable assets a company owns), threats become more profitable to criminals too. The largest ransomware payout made by an insurance company ($40 million) to date happened in 2021, and the trend doesn‚Äôt show any signs of slowing down.</p><p>The major problem with attacks like these is that computers today are so fast and interconnected that malware can harness those resources to spread itself throughout the network and encrypt an enormous amount of files before the victim can respond.</p><p>Unfortunately, after the files have been encrypted, there is not much that can be done. Most modern ransomware has good, or at least good-enough implementation of encryption algorithms, all but guaranteeing that the victim won‚Äôt be able to recover their data.</p><h2 id="How-Ransomware-Works">How Ransomware Works</h2><p>The first versions of ransomware were poorly implemented, and the victim stood a decent chance of recovering their files without paying the ransom.</p><p>Since the virus had to encrypt the victim‚Äôs files as fast as possible to increase the chances of a successful attack, it relied on a <strong>symmetric cipher</strong>, such as AES, as they encrypt data much faster than asymmetric ciphers.</p><p>The problem is that symmetric ciphers use the same key to encrypt <em>and</em> decrypt the files.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/uG54F3Ra1JmRNUnLVBPWM/e7079f11b2a6f61114409660eebfe6d3/Uploaded_from_How_To_Protect_Against_Ransomware_In_2021" alt="Symmetric cipher encryption"/>
</p><p><i>Symmetric cipher encryption</i></p><p>The bad actor would have to hard code the key into the malware and hope that the victim wouldn‚Äôt have the means to look for the keys in the code, or they would have to send a copy to a remote server which they controlled and delete the key on the victim‚Äôs computer. Neither option is very good for the attacker.</p><p>Most modern ransomware uses a hybrid encryption mechanism. While asymmetric ciphers are slow and not meant to encrypt huge amounts of data, using them to encrypt just <em>the encryption key</em> created by a symmetric cipher is not a problem.</p><p>Here‚Äôs how it works. Before the attack, the attacker generates an asymmetric key pair, and the public key is embedded into the malware. Once the malware is executed, it encrypts the victim‚Äôs files with a fast, symmetric cipher, and its key will then be encrypted with the public key from earlier.</p><p>To get their files back, the victim would need the attacker‚Äôs private key to decrypt the public key to then, finally, decrypt the files using the symmetric cipher key.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4sJ4KsUjN5Ez4b9u1A4YUY/4677b2dbb6a638166b57805c20b43c14/Uploaded_from_How_To_Protect_Against_Ransomware_In_2021" alt="Asymmetric cipher encryption"/>
</p><p><i>Asymmetric cipher encryption</i></p><p>(This is assuming the attacker went through the trouble of providing a way for the victim to get their data back. They could just encrypt everything with AES and delete the key with no intention of ever recovering the data.)</p><p>Other than that, the only ‚Äúrealistic‚Äù scenario to decrypt the data is by brute-forcing it. I use quotes because it‚Äôs not really realistic ‚Äì we already went over the math behind it. You would need more time than the age of the universe to decrypt AES-128 even if you were using all the computational power available today.</p><h2 id="How-To-Protect-Against-Ransomware">How To Protect Against Ransomware</h2><blockquote><p>When it comes to ransomware, the best defense is being <em>proactive</em> instead of <em>reactive</em>. If you got hit by ransomware and didn‚Äôt already have a plan in place, your chances of ever recovering your files are slim.</p></blockquote><p>With that in mind, the tips below will help you mitigate some of the risks <em>before</em> something bad happens.</p><h3 id="1--Update-Your-Systems-Regularly">1. Update Your Systems Regularly</h3><p>In May 2017, a strain of ransomware known as WannaCry was deployed around the world, affecting more than 230,000 computers in 24 hours.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5Xhk4JfQznetFAIRvPo0mf/feb1235ce512cf13d7b581d24a526129/Uploaded_from_How_To_Protect_Against_Ransomware_In_2021" alt="UWannaCry note"/>
</p><p><i>Screenshot of the WannaCry note</i></p><p>The malware exploited a vulnerability in SMB, a file-sharing protocol in Windows, that allowed the virus to spread itself through the network without being executed by the user.</p><p>To get infected, you didn‚Äôt need to run anything ‚Äì being connected to the same network as someone else who ran it and having an unpatched version of Windows was enough.</p><p>Microsoft had released a security update a month before, in April, so only the organizations that weren‚Äôt as diligent with their software updates were affected by the attack.</p><p>Keeping your systems up-to-date is your first line of defense, and in most cases, can be automated. Low-effort, high-reward.</p><h3 id="2--Think-Hard-Before-Paying-The-Ransom">2. Think Hard Before Paying The Ransom</h3><p>If you‚Äôre hit by ransomware and your data is now encrypted, you might be tempted to throw the flag and pay the ransom. After all, in the short term, paying the ransom might seem like the less expensive option. But you should think hard before paying.</p><p>There‚Äôs a reason why the official US government response is to ‚Äúnever negotiate with terrorists.‚Äù Caving in opens a can of worms and doesn‚Äôt guarantee that your problem will be solved.</p><p>First of all, paying the ransom doesn‚Äôt guarantee that the attackers will decrypt your data ‚Äì they could just ask for more money instead. Furthermore, it signals that it‚Äôs profitable to target your company, and they (and others) will target your organization again in the future. A report by Cybereason found that 80% of the companies that pay the ransom are attacked again soon.</p><p>You should also be aware that, to pressure you into paying the ransom, criminals may perform a double extortion attack, where they first exfiltrate proprietary company information before encrypting the files and then threaten to release those secrets if the ransom isn‚Äôt paid.</p><h3 id="3--Make-a-Plan-For--Foul-Weather--in-Advance">3. Make a Plan For ‚ÄúFoul-Weather‚Äù in Advance</h3><p>Regardless of the decision, it‚Äôs best if it‚Äôs made in advance. The stakeholders can keep a cool head and aren‚Äôt in a bind to come up with a solution on the fly.</p><p>Ever noticed that laminated paper that every NFL coach holds during the games? They contain the plays they have planned for different game situations. It was pioneered by Bill Walsh during the 80s:</p><p><em>Having a well-thought-out plan ready to go in advance of a change in the weather is the key to success. In the closing moments [of a playoff game against the Raiders], we recovered a fumble. We were trailing by three points, and a field goal would send us into overtime. My job [as an assistant coach] was to figure out how to get us within range of a field goal quickly. Unfortunately, the severe pressure and absolute pandemonium up at the booth where I was sitting destroyed my thinking. I completely forgot the plays we had practiced that would have worked best under those circumstances, but equally important, I recognized (in retrospect) that I had no specific plan for what to do in that ‚Äúfoul-weather‚Äù circumstance.‚Äù</em></p><p>He started scripting his entire opening drive after that game and then every ‚Äúfoul weather‚Äù situation he could think of before the game even started. Consider doing the same for ransomware ‚Äì the procedures for what to do during an attack should be prepared in advance when you are <em>not</em> under duress.</p><p>Your plan should be as detailed as you can get away with. Here are some things you could write explicit instructions for:</p><ul><li>What to do during an attack (step-by-step)</li><li>How to contact the person in charge during an attack</li><li>How communication will happen during the attack</li><li>Where the backup is stored and how to retrieve it</li><li>How to wipe the disks clean and how to restore backup images</li><li>List the partners or clients that would have to be notified and in which order, should such an attack happen</li><li>Answer to difficult questions: Do you need to contact insurance? Which equipment would you need to rent or buy immediately to keep the operation running?</li></ul><h3 id="4--Be-Aware-of-Phishing-Emails">4. Be Aware of Phishing Emails</h3><p>Phishing is the main attack vector used in ransomware cyberattacks. The attacker will send an initial malware disguised as a seemingly harmless file ‚Äì for example, an Excel or Word document.</p><p>This malware, known as a dropper, is responsible for downloading the main malware that will encrypt the files and possibly other malware to exfiltrate other valuable data it finds on the organization‚Äôs network: intellectual property, passwords, trade secrets, etc.</p><p>Phishing is a hard problem to solve; it works because people are focused on work and aren‚Äôt expecting to be tricked. However, here are some things that you can consider doing to reduce the attack surface of phishing attacks:</p><ul><li><strong>Implement email filtering.</strong> Block emails with dangerous extensions, such as .exe and .bat attached. It may stop some, but as mentioned before, sophisticated attacks will try to disguise the files.</li><li><strong>Create a process for phishing response.</strong> Here‚Äôs what we do at Auth0 when someone receives a phishing email.</li><li><strong>Train employees at your organization.</strong> Spam filters are very smart today, but even Google‚Äôs spam filter lets around 0.1% of spam emails reach your inbox. Employees must understand the risks of phishing emails.</li></ul><p>These measures won‚Äôt stop you from getting compromised, but they will stop the low-effort attacks that can be automated.  </p><h3 id="5--Implement-IAM--Identity-and-Access-Management--and-a-Password-Manager-Where-You-Can">5. Implement IAM (Identity and Access Management) and a Password Manager Where You Can</h3><p>The second most common attack vector is trying to penetrate the network directly, either by brute force or by exploiting a vulnerability. Bloomberg reported in June that hackers were able to get into the network of the largest fuel pipeline in the US, Colonial Pipeline, and deploy a ransomware attack.</p><p>The bad actors got in through a company VPN by using employee credentials found in a data breach. The VPN also wasn‚Äôt protected by 2FA, which could have prevented the hackers from getting in.</p><p>Implementing IAM (Identity and Access Management) controls help organizations manage who has access to what and prove they are who they say they are (for example, via fingerprint scanning or hardware tokens).</p><p>On top of that, consider using a password manager. It‚Äôs likely that the employee used the same password elsewhere, and the bad actors simply used those same credentials to connect through the company‚Äôs VPN. A password manager ensures good password policies for all employees and makes sure that they don‚Äôt use duplicate passwords elsewhere.</p><h3 id="6--Remove-Local-Administrative-Rights-From-Endpoints">6. Remove Local Administrative Rights From Endpoints</h3><p>Most ransomware (and malware in general) perform many actions that require administrative rights during an attack. Removing such rights reduces the chance it will spread throughout the network.</p><p>Employees shouldn‚Äôt have access to local administrative accounts, and the IT staff should not have administrative rights for day-to-day activities.</p><p>Moreover, the local admin passwords should never be the same across workstations, as the attacker may pass the hash across machines with the same password to move laterally throughout the network.</p><h3 id="7--Restrict-Permissions-To-Run-Software--And-Macros-">7. Restrict Permissions To Run Software (And Macros)</h3><p>Only a few applications are needed to run the business on a day-to-day basis. Determine the few applications that are needed, and block any other application from running using Microsoft‚Äôs Group Policy if you‚Äôre a Windows user (macOS and Linux users must look for third-party solutions).</p><p>This will prevent unauthorized processes, including those created by malware, from running.</p><h3 id="8--Limit-Network-Access">8. Limit Network Access</h3><p>As mentioned earlier, direct network exploits, such as remote services like RDP (Remote Desktop Protocol), are the second most common infection vector.</p><p>Review your ports and block anything that you don‚Äôt use. For example, port 3389 (RDP) and port 445 (SMB) are commonly exploited by hackers to infiltrate your network.</p><p>If you need them, limit them as much as possible. You probably don‚Äôt need your RDP port open to the Internet. Make it so that it‚Äôs only accessible via the organization‚Äôs VPN and secure it with 2FA.</p><p>Also, create firewall rules to automatically block incoming access after sufficient failed attempts and use a filter to block any outgoing connection from unauthorized applications. Most malware will need to connect to a remote server to carry on its attack.</p><p>Make sure that your network is properly segmented to avoid losing network drives to a single endpoint infection. Create a guest network with extremely limited access for untrusted devices. Implement read-only shares so that you can restore backups with limited attack surface; separate subnets according to purpose or application.</p><h3 id="9--Create-a-Robust-Backup-Solution">9. Create a Robust Backup Solution</h3><p>No system in the world is impenetrable ‚Äì even the most well-funded corporations in the world have been compromised. Instead of betting that you are the exception, assume the worst and create a plan to mitigate the damage when all else fails.</p><p>At roughly 3 cents per GB, it‚Äôs tough to beat hard drives when it comes to insurance against ransomware (but it doesn‚Äôt hurt to check if your insurance policy covers cyberattacks too).</p><p>When designing your backup plan, keep in mind that:</p><ul><li><strong>It must be automated.</strong> Any backup that depends on human intervention is prone to be neglected at some point.</li><li><strong>It must be rock-solid.</strong> Test your snapshots from time to time. You don‚Äôt want to <em>think</em> you have your files backed up, only to discover it hasn‚Äôt been copying the proper files this whole time.</li><li><strong>It must have at least one air-gapped copy.</strong> Air-gapped backups (disks not connected to another computer or network) make sure that, if the ransomware spreads through your systems, at least one copy is safe. Since they require manual intervention ‚Äì someone has to plug the drive-in and disconnect it afterward ‚Äì air-gapped copies generally aren‚Äôt as up-to-date as other hard drives in your backup plan. Still, it‚Äôs better to have a one-week-old copy than to have no copy at all.</li><li><strong>It must follow the 3-2-1 backup rule.</strong> You must have three copies of your data, in at least two different media types, with one of them in an offsite location.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6gZ3ZuZ4THbAAXeggjhHcn/82b94644dfff001d0270d5a365e460f6/Uploaded_from_How_To_Protect_Against_Ransomware_In_2021" alt="Create a Robust Backup Solution"/>
</p><p><i><a href="https://www.keepitsafe.com/blog/post/3-2-1-rule-for-cloud-backup/" target="_blank" rel="noreferrer noopener">Source</a></i></p><p>How that plan is going to be implemented will depend on company policy (or personal preference). Having a backup in an offsite location could be as easy as using a third-party cloud provider, but it could be against company policy to have proprietary data uploaded to someone else‚Äôs cloud. So, it will vary.</p><p>In the majority of cases, though, it makes sense to have central storage connected to the network performing automated backups, even if it is at risk of being affected by ransomware. It‚Äôs much easier to mirror the data to an offsite location or to air-gapped hard disks from one location than every computer on the network.</p><h2 id="Staying-Safe">Staying Safe</h2><p>Do the tips above <em>guarantee</em> you won‚Äôt be hit by ransomware? No, but no one can make such a promise when it comes to security. Staying safe is a process you must continually engage in, and the pointers above are a good starting point.</p><p>Ransomware attacks are still one of the most profitable attacks for bad actors, which means it‚Äôs one of the most costly for you. You can‚Äôt stop attacks from happening, as it‚Äôs completely outside of your control. What you <em>can</em> do, however, is to make it as costly as possible to attack your organization. And as the saying goes, you don‚Äôt have to outrun the bear, only the person running next to you.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 27 Oct 2021 14:48:00 +0000</pubDate>
    </item>
    <item>
      <title>What is Smishing?</title>
      <link>https://auth0.com/blog/what-is-smishing/</link>
      <description>How text messaging scams work and why a ‚Äòskeptical pause‚Äô can save you</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>You know <em>all</em> about phishing. From time to time, emails purporting to be from Facebook or your bank drift into your inbox and insist you ‚Äúverify your account.‚Äù Look closer and you spot the telltale signs of a scam: a sketchy-looking sender address, sloppy writing, and a complete lack of personalization. You sigh and hit delete.</p><p>It‚Äôs easy to be cynical about opportunistic, mass-mailed phishing attempts. Although some look genuine to even the most cautious eye, others feel decidedly amateurish and are readily identifiable. Billions of emails are sent each month, with over 245,000 phishing-related websites created in January alone <a href="https://docs.apwg.org/reports/apwg_trends_report_q1_2021.pdf" target="_blank" rel="noreferrer noopener">according to the Anti-Phishing Working Group (APWG)</a>. But when it comes to SMS-based phishing, or ‚Äòsmishing,‚Äô things are a little different.</p><p>Smishing is when a malicious actor harvests credentials and credit card details by pretending to be someone else over text. This novel spin on phishing has grown exponentially in recent years, with the volume of messages sent to North American phones <a href="https://www.proofpoint.com/us/blog/threat-protection/mobile-phishing-increases-more-300-2020-chaos-continues" target="_blank" rel="noreferrer noopener">increasing by 328% in Q3 2020 alone</a>. Similar trends can be found in other territories. In the UK, one survey found 61% of respondents received <a href="https://www.which.co.uk/news/2021/06/three-in-five-people-have-received-a-scam-delivery-text-in-the-last-year/" target="_blank" rel="noreferrer noopener">at least one smishing text during 2020</a>.</p><p>For the perpetrators, smishing can prove incredibly lucrative. For the victims, it can be financially devastating. This article will explain how the scam works, why it‚Äôs effective, and how individuals and organizations can fight back.</p><h2 id="How-a-Smishing-Scam-Works">How a Smishing Scam Works</h2><p>If you‚Äôre reasonably tech-savvy ‚Äî or have listened to the dire warnings issued by tech companies, financial institutions, and governments ‚Äî chances are high you understand the risk posed by traditional email-based phishing.</p><p>You know that email accounts can be created and hijacked. Spammers can even spoof the origins of an email. And, after countless high-profile data breaches, you may have grudgingly reconciled with the reality that your personal information is irrevocably available online.</p><p>Smishing scams, on the other hand, feel comparatively opaque. How do attackers successfully impersonate well-known brands? How do they operate at such a large scale, sending tens of thousands of messages at a time?</p><p>Let‚Äôs start by looking at the methodology. Attackers have plenty of options when it comes to the bulk distribution of text messages. They may choose to buy a device created explicitly for that purpose, with examples available online for just a few hundred dollars. Alternatively, they can use a standard mobile phone or USB cellular modem, combined with an automation program that costs just $69.</p><p>This isn&#39;t the most inconspicuous method. In June, UK law enforcement were <a href="https://www.gmp.police.uk/news/greater-manchester/news/news/2021/june/man-arrested-in-manchester-hotel-after-over-25000-phishing-messages-sent-in-one-day/" target="_blank" rel="noreferrer noopener">called to a hotel in Manchester</a> after staff became suspicious of a guest carrying a bag filled with unusual-looking wires and electrical devices. Upon inspecting his room, police found a laptop containing 44,000 mobile numbers, as well as an SMS hardware gateway. They later determined the device was used to send 26,000 messages in the previous day alone.</p><p>Alternatively, as pointed out by veteran cybersecurity journalist Brian Krebs, attackers may choose a provider to send the messages out on their behalf. Earlier this year, UK authorities arrested the 20-year-old operator <a href="https://krebsonsecurity.com/2021/02/u-k-arrest-in-sms-bandits-phishing-service/#comment-527047" target="_blank" rel="noreferrer noopener">behind the SMS Bandits gateway</a>, which he marketed within criminal circles as ‚Äúspam friendly.‚Äù Messages sent via SMS Bandits impersonated government agencies, financial services organizations, and telecommunications providers.</p><p>Now, let&#39;s talk about the composition of the text. SMS messaging is a relatively ‚Äòflat‚Äô medium. There is no room for a visual flair or branding. This works to the advantage of attackers, as they don‚Äôt have to painstakingly recreate the style of the organizations being impersonated. And many phishing approaches works</p><p>Within the body of the text, the attacker faithfully adheres to the phishing playbook. One common tactic is to create a false sense of urgency. They want the recipient to be anxious, as they‚Äôll be more likely to hand over their credentials without scrutinizing the message too closely.</p><p>The pandemic has provided many examples of this. In May, a UK man was sentenced to 4 years and three months imprisonment after perpetrating a scam where <a href="https://www.cps.gov.uk/cps/news/covid-19-fraudster-jailed-mass-cyber-scam" target="_blank" rel="noreferrer noopener">victims were asked to provide their bank details</a> in order to verify their eligibility for a Covid vaccine.</p><p>Another SMS phishing campaign <a href="https://www.f-secure.com/gb-en/consulting/our-thinking/how-smishing-uses-urgency-to-manipulate-victims-during-lockdown" target="_blank" rel="noreferrer noopener">identified in South Africa in March 2020</a> purported to be from local financial institutions and warned the recipient that their account would be terminated if they didn‚Äôt verify their credentials.</p><p>It‚Äôs interesting to note that this campaign began during the early months of the first lockdown, at a point when many contact centers were operating at a vastly reduced capacity. The ensuing long wait times ultimately disincentivized recipients from trying to independently verify the message with their bank, which contributed to its success.</p><h2 id="Why-is-Smishing-so-Effective-">Why is Smishing so Effective?</h2><p>It&#39;s hard to find solid data on the financial cost of smishing. In most cases, it is grouped together with traditional email phishing and ‚Äòvishing‚Äô (voice phishing), rather than a standalone category. However, police reports and testimony from victims suggest it can be hugely profitable for the perpetrators.</p><p>One <a href="https://inews.co.uk/news/pair-jailed-for-text-message-fraud-that-swindled-20m-from-bank-customers-and-funded-luxury-shopping-sprees-911561" target="_blank" rel="noreferrer noopener">gang made at least ¬£20m over just eight years</a>, allowing them to live a celebrity lifestyle of five-star hotels and designer clothing brands. Another man, <a href="https://www.ukfinance.org.uk/press/press-releases/enfield-student-behind-scam-texts-jailed-22-months" target="_blank" rel="noreferrer noopener">a 22-year-old computer science student from London</a>, made ¬£125,000 before his arrest. In 2019, a Georgia federal court convicted three Romanian men for their role in a smishing scheme that <a href="https://www.justice.gov/usao-ndga/pr/three-romanian-citizens-plead-guilty-participating-multi-million-dollar-vishing-and" target="_blank" rel="noreferrer noopener">cost individuals and institutions an estimated $21M</a>.</p><p>And then there are the victims. One Hong Kong flight attendant saw <a href="https://www.scmp.com/news/hong-kong/law-and-crime/article/3141567/hong-kong-sees-sharp-rise-phishing-scams-victims" target="_blank" rel="noreferrer noopener">her $10,000 life savings</a> drained after she clicked through a text purporting to be from her bank. A student in the UK was pushed <a href="https://www.bbc.co.uk/news/uk-england-birmingham-56500599" target="_blank" rel="noreferrer noopener">into her overdraft after receiving a text ostensibly from Barclays Bank</a>. Another woman in Topeka, Kansas <a href="https://www.ksnt.com/news/local-news/topeka-woman-falls-victim-to-text-message-scam-warning-others-what-to-look-for/" target="_blank" rel="noreferrer noopener">lost $600</a>.</p><p>So, why is it so effective? It falls down to a number of reasons.</p><ul><li>Smishing is a relatively novel phenomenon, especially when compared to traditional email phishing, and much of its growth has occurred in recent years. In the UK, the volume of smishing messages <a href="https://news.sky.com/story/smishing-reports-increase-nearly-700-in-first-six-months-of-this-year-12407504" target="_blank" rel="noreferrer noopener">grew 700% in the first six months of 2021 alone</a>. There isn&#39;t the same level of awareness, and therefore, skepticism, among the wider populace.</li><li>Text messages have a visibility advantage over emails. While your Gmail inbox may contain thousands of unread messages, odds are good you read every single text that shows up on your phone.</li><li>For scammers hoping to establish credibility, SMS messages are hard to get wrong. As mentioned, it is a purely plaintext medium, with no visual flair to mimic.</li><li>This simplicity allows scammers to quickly respond to events. Delivery scams ‚Äî which account for over half of all smishing attempts in the UK ‚Äî are a good example, having proliferated after the UK concluded its withdrawal from the EU. In the US, smishing epidemics have coincided with the distribution of stimulus checks, tax season, and the widespread difficulties in obtaining unemployment insurance during the early months of the pandemic.</li><li>Finally, many of the tactics that make traditional email phishing successful also work over text, such as the creation of a false sense of urgency.</li></ul><h2 id="Fighting-Back">Fighting Back</h2><p>It‚Äôs easy to dismiss smishing as a purely consumer problem. That would be a mistake. First, there is an overlap between the tools and services used by the general public, and those used by the public and private sectors. Gmail is a good example. You might also use the same bank or the same social media platforms.</p><p>Additionally, there are many examples of text messages being used to distribute malware, or as the basis for a spear-phishing campaign. This raises the prospect of smishing becoming a major headache for public and private-sector organizations.</p><p>That all said, SMS remains a prime mode of communication due to its ease of use and sheer ubiquity. Although services like WhatsApp and Facebook Messenger offer more functionality, you can‚Äôt beat the humble text message for sheer universality.</p><p>An <a href="https://www.smscomparison.com/mass-text-messaging/2021-statistics/" target="_blank" rel="noreferrer noopener">estimated 96% of US adults</a> own a device capable of receiving text messages, while 95% of SMS messages are read and responded to within three minutes of receipt.</p><p>It&#39;s therefore crucial that organizations proactively develop a strategy for combating smishing, with awareness at the heart of any such strategy. Employees and partners must understand that text messages are not inherently safe. They should be treated with the same level of cautiousness as email.</p><p>Employees should also feel empowered to report suspected smishing scams targeting the business. The sooner an organization becomes aware of an attack in progress, the quicker it can act.</p><p>Auth0 Security Culture Manager Annybell Villarroel notes that we‚Äôre seeing an increase in smishing attempts and recommends creating a culture of security and awareness for employees and partners through regular training.</p><p>But the biggest thing for all of us is just to learn to take a ‚Äúskeptical pause,‚Äù says Annybell. ‚ÄúPausing to ask yourself if the message makes sense can make a big difference. It can take you out of an emotional response back to logic. That extra few seconds can save you from a smishing click.‚Äù</p></div></div>]]></content:encoded>
      <pubDate>Tue, 26 Oct 2021 16:02:00 +0000</pubDate>
    </item>
    <item>
      <title>How Social Engineering Has (And Hasn‚Äôt) Evolved Over Time</title>
      <link>https://auth0.com/blog/how-social-engineering-has-and-hasnt-evolved-over-time/</link>
      <description>There‚Äôs no patch for humanity, but that‚Äôs not a bad thing</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Let‚Äôs face it. We all make mistakes. Even the most diligent, well-intentioned employee can inadvertently open the floodgates to an attack. Telecoms giant Verizon illustrated this earlier this year, when it published the 2021 edition of its Data Breach Investigations Report (DBIR).</p><p>The DBIR examined approximately 5,250 successful security breaches, gathering data about the methodologies used. It found 35 percent of attacks incorporated a social element. Of these, the vast majority (85%) used phishing tactics.</p><p><strong>In short:</strong> you can deploy all the technological measures you want, but unless you address the human element, an attacker can defeat your defenses with a simple phone call or email.</p><p>Social engineering has always intrigued me. There‚Äôs something weirdly compelling about someone circumventing the defenses of a company with nothing but a winning smile and a confident tone, and industry raconteurs like Jenny ‚ÄúThe People Hacker‚Äù Radcliffe and Kevin Mitnick have some incredible stories to share.</p><p>But there‚Äôs something else. Many of the tactics successfully employed by social engineers can be found throughout history, used in the fields of warfare, espionage, and criminality. Shadowy state actors targeting government departments can be found using the same playbook as Classical-era Greek military tacticians.</p><p>There‚Äôs a reason for this. Humans are social animals. We have certain inherent traits. We‚Äôre often willing to trust strangers, and we help those we don‚Äôt necessarily know. We live by a set of rules, both written and unwritten. These attributes allowed us to develop societies, permanent settlements, and eventually nation states. But they can also be exploited by malicious actors seeking to further a particular goal.</p><blockquote><p>Technologies and tactics change. Human nature is a constant.</p></blockquote><p>This article will explore some of these historical parallels. We‚Äôll take a journey through time that starts in the Roman city of Brundisium, circa 19 BCE, with detours through the swinging sixties, the latter years of the Vietnam War, and the early days of the Internet. We‚Äôll put the tactics used by social engineers into context, and show why they‚Äôre so effective. And finally, we‚Äôll learn how to defend against them.</p><h2 id="Our-Unpatchable-Human-Zero-Days">Our Unpatchable Human Zero-Days</h2><p>Before we start our trip, it‚Äôs probably a good idea to talk about the human qualities commonly targeted by social engineers.</p><p>While researching this post, I sought out as many tales of real-world social engineering as I could find. I thumbed through books by Chris Hadnagy and Kevin Mitnick. I listened to conference talks from the likes of Paul Wilson and Jenny Radcliffe. I devoured entire episodes of The Darknet Diaries.</p><p>As I went through, I noted most attacks focused on certain human attributes. These included:</p><ul><li><strong>Curiosity</strong><br/><em></em>Every great scientific and technological leap started with the words: ‚ÄúWhat if?‚Äù But you don‚Äôt need to be Einstein to have curiosity. We use trial-and-error and experimentation to make sense of our environment. Social engineers frequently exploit this when harvesting credentials or <a href="https://darknetdiaries.com/episode/100/" target="_blank" rel="noreferrer noopener">deploying malware</a>.</li><li><strong>Trust</strong><br/><em></em>Life‚Äôs easier (and nicer) when you assume everyone acts in good faith. And so, we take people at their word. If an unfamiliar voice calls and claims to be from your bank or phone company, you might instinctively believe them. Social engineers can ‚Äî and often do ‚Äî exploit this.</li><li><strong>The Desire to Help</strong><br/><em></em>Since we‚Äôre social animals, collaboration is inevitable. If we see someone in need of assistance, chances are we‚Äôll offer it. When exploiting this, a social engineer might pretend to be a low-ranking employee in need of credentials, access, or documents. They‚Äôll count on the target feeling pity for them.</li><li><strong>Fear</strong><br/><em></em>The ‚Äúfear factor‚Äù frequently features in social engineering attacks. You‚Äôre probably familiar with phishing emails claiming your bank account has been hacked, or your social media profile will be deleted unless you click a link. This tactic pressurizes the target into making hasty decisions and dropping their skepticism.</li><li><strong>The Desire to Comply</strong><br/><em></em>Almost all organizations ‚Äî both public and private sector ‚Äî are hierarchical. There‚Äôs a pecking order, with some people at the top, and others at the bottom. We tend to listen to (and obey) those higher up in the echelons. Attackers can exploit this by masquerading as high-ranking employees and issuing edicts to junior employees.</li></ul><p>Each of the historical examples listed in this article uses these innate attributes, often to devastating effect.</p><h2 id="From-USB-Sticks-to-Wooden-Horses">From USB Sticks to Wooden Horses</h2><p>The year is 2008. A threat actor, most likely working for a foreign state, had broken into the heart of the United States defense establishment. Showing remarkable skil, the attacker had successfully deployed a data-siphoning worm onto a Central Command (CENTCOM) computer. From there, it proliferated like a fungus, spreading undetected into other computers.</p><p>William J. Lynn III, an Obama-era Deputy Secretary of Defense, later described it as &#34;<a href="https://archive.defense.gov/home/features/2010/0410_cybersec/lynn-article1.aspx" target="_blank" rel="noreferrer noopener">the most significant breach of U.S. military computers ever.</a>&#34; He wasn‚Äôt wrong. The worm took almost 14 months to eradicate, and it infected both classified and unclassified machines. It‚Äôs hard to quantify the damage it inflicted on the Department of Defense.</p><p>Adding insult to injury, the damage was arguably self-inflicted. The virus, later dubbed Agent.biz, was distributed on USB sticks dropped in the parking lot at an unnamed Middle East military base. A CENTCOM employee picked one up and plugged it into their laptop.</p><p>The Department of Defense never identified the employee responsible for the first infection. We‚Äôll never know their motivations. Were they curious about the drive‚Äôs contents? Did they want to reunite the drive with its owner? Or did they just want to save the $20 on a new memory stick? It‚Äôs not clear.</p><p>In the end, it doesn‚Äôt matter. The damage was done. The Department of Defense was forced to spend critical resources identifying and wiping infected machines, as they eliminated the worm one computer at a time. And it forced the military to radically change their approach to computer security, ultimately leading to the creation of the United States Cyber Command.</p><p>Still, I can‚Äôt help but wonder what the ancient Roman poet Virgil would think of this tale. Two millennia prior, Virgil was spending his twilight years in the city of Brundisium (now Brindisi), where he worked on his opus, the epic poem Aeneid.</p><p>Aeneid described the Siege of Troy. This is perhaps the most famous battle that never actually took place ‚Äî or, at least, in the way depicted. Pretty much everything below is apocryphal. Still, it‚Äôs a great story, so indulge me.</p><p>Here‚Äôs the TL;DR: Greece was at war with Troy. It wasn‚Äôt going well. Both sides were effectively at a stalemate. Troy had retreated behind the walls of its capital city, where it could hold out indefinitely. After an exhausting decades-long siege, the Greeks were eager to end the campaign. And so, their leader, Odysseus, conjured a devious ruse.</p><p>Greece would pretend to surrender. Their forces would retreat. By means of apology, they left a large wooden horse at the gates of the city, which the Trojans interpreted as a tribute to their greatness.</p><p>We all know what happened next. The Trojans hauled the horse into the city, unbeknownst to the shock force of Greek warriors lurking within its interior. As night fell, they crept out and unlocked the gates to the city. The rest of the Greek army surged forward, flooding in and bringing the war to its conclusion in a matter of hours.</p><p>Technologically, USB drives and wooden horses couldn‚Äôt be more different. But in both of the examples cited, they were used to inflict devastating losses to the target. More importantly, they were only effective because the victim implicitly trusted they wouldn‚Äôt be used to harm them. Trust can be a dangerous thing.</p><h2 id="Helpful-Humans">Helpful Humans</h2><p>In the 1990s, Kevin Mitnick was the ultimate cybercrime bogeyman. He won his notoriety by breaking into some of the most powerful technology and telecommunications companies in the world. His misadventures were front-page news and even inspired two feature-length movies (one documentary, another dramatic).</p><p>Now, Mitnick is a legitimate cybersecurity professional and author. Through talks, articles, and books, he warns about the risks posed by social engineering attacks, giving examples from his own criminal past.</p><p>Many of his tales describe interactions with relatively low-level employees at the target company. He would build a rapport with the worker and gather information, which he would later use to achieve his larger goals.</p><p>In one example, detailed in his book <a href="https://www.amazon.com/Ghost-Wires-Adventures-Worlds-Wanted/dp/0316037729" target="_blank" rel="noreferrer noopener">Ghost in the Wires</a>, Mitnick sought to access the phone records of a friend he suspected of working for the FBI. He repeatedly called the phone provider, each time building a rapport with the employee and teasing out details relating to the account. Once he gathered enough information, he convinced the provider to fax the target‚Äôs previous invoice, claiming he needed it to rebuild his phone book.</p><p>Mitnick was successful because the employees didn‚Äôt question whether he was the real account holder. They weren‚Äôt motivated by data security, but rather customer happiness. They simply weren‚Äôt suspicious. He would successfully re-use these tactics again and again, before the FBI brought his criminal career to an abrupt end in 1995.</p><p>Twenty-five years earlier, a group of Anti-Vietnam War activists used a similar approach when breaking into a Delaware draft office. The group had already penetrated several military offices, as they sought to frustrate the recruitment of new soldiers into the highly unpopular war. They were seasoned burglars.</p><p>This Delaware office, however, proved a challenge. It was protected by an advanced, heavy duty door. Their usual tools ‚Äî crowbars and lock picks ‚Äî were useless here. And so, they had to think outside the box.</p><p>During the daytime, the office‚Äôs door was unlocked. A member of the group crept in and left a note behind. It read: ‚ÄúPlease don‚Äôt lock this door tonight.‚Äù</p><p>It was simple. Obvious, even. And it worked. The group later returned under the cover of darkness. They approached the door and twisted its handle. It opened with a satisfying click. They gathered the documents they came for and left. In 2014, after the statute of limitations expired, the group would tell their tale to veteran Washington Post journalist Betty Medsger.</p><p>No doubt, the draft office was staffed by seasoned military servicemen. They understood risk, and no doubt knew of the widespread opposition to the Vietnam war. And yet, this experience was overridden by their desire to be helpful, and to comply with the request of a colleague or superior. They trusted the note‚Äôs provenance, and didn‚Äôt think to consider that it may have been left by an adversary.</p><p>The term ‚Äúsocial engineering‚Äù sounds deceptively modern. In reality, it could be used to describe the kind of subterfuge used by criminals and military leaders throughout history.</p><p>You can draw parallels between the approaches detailed in Chris Hadnagy‚Äôs book <a href="https://www.amazon.com/Human-Hacking-Friends-Influence-People/dp/0063001780" target="_blank" rel="noreferrer noopener">Human Hacking</a>, which focuses on their application in legitimate offensive security procedures, and those used by convicted fraudster Frank Abagnale, as described in his book <a href="https://www.amazon.com/s?k=catch+me+if+you+can+book&amp;gclid=Cj0KCQjwwNWKBhDAARIsAJ8HkhcNRSvRdVegZPvCiI176SCZvOnGn3rDQGLMGOoA039SYYck0AfzRFAaAtWEEALw_wcB&amp;hvadid=409998390125&amp;hvdev=c&amp;hvlocphy=9033339&amp;hvnetw=g&amp;hvqmt=e&amp;hvrand=1184131583828329460&amp;hvtargid=kwd-421448854&amp;hydadcr=24630_11410023&amp;tag=googhydr-20&amp;ref=pd_sl_7yubf00gv6_e" target="_blank" rel="noreferrer noopener">Catch Me If You Can</a>. The basic concepts are the same, with the only real point of differentiation being how they‚Äôre used.</p><p>Complicating matters, it‚Äôs now possible to perform social engineering attacks at scale. Through phishing (as well as its evil siblings, Smishing, or SMS phishing, and Vishing, or phishing via voice), a bad actor can reach millions in a matter of moments.</p><p>In 2020, the FBI received 231,000 reports of phishing attacks ‚Äî or double that previous year‚Äôs figure. The real figure is almost certainly significantly higher, with most attempts unreported to the bureau. It affects non-profit organizations, businesses, and individuals, albeit to varying levels, and the costs can measure in the millions.</p><p>Earlier this year, US authorities sentenced the ringleader of a Business Email Compromise (BEC) scam to ten years in prison. The man, Obinwanne Okeke, stole $11m from companies in the construction industry by issuing fake invoices with the funds directed to foreign bank accounts.</p><p>Looking further back, in May 2000, Filipino malware developer Onel De Guzman caused an estimated $5.5bn to $8.7bn in damages, after he released a self-propagating worm masquerading as a love letter. The ILOVEYOU worm sought to steal dial-up internet credentials, and inadvertently took down the mail services of the UK parliament, Microsoft, and the US Department of defense.</p><blockquote><p>Here‚Äôs the good news: You can take steps to mitigate the risk social engineering poses to your organization.</p></blockquote><p>Technical measures, as recommended by the US Computer Emergency Response Team (US-CERT), include the use of multi-factor authentication (MFA), email filtering, and firewalls. It helps to stay abreast of recent developments, and the Anti-Phishing Working Group provides helpful information about new threat actors and trends.</p><p>Training also plays an important role. It‚Äôs possible your colleagues are unaware that social engineering exists. Teach them about the tactics used and the importance of verifying the identities and details of those they interact with, along with your organization‚Äôs phishing reporting procedures. If you don‚Äôt have one, make a point to create one, even if it‚Äôs something as simple as a dedicated inbox, where employees can forward suspicious communications.</p><p>Finally, creating a culture of transparency and collaboration is important. Your colleagues should feel able to report security issues without fear or judgment.</p><p>&#34;Our innate human traits make us vulnerable to social engineering attacks, and always will. The best and most scalable defense is to create a strong security culture, both within organizations and across society at large. When we empower people to detect and respond to these attacks, we build a more secure Internet for all,&#34; said Annybell Villarroel, Security Awareness and Culture Manager. To find out how Auth0 can meet your organization‚Äôs identity needs, click here.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 25 Oct 2021 14:47:00 +0000</pubDate>
    </item>
    <item>
      <title>Should You Give Users Access Before They Register</title>
      <link>https://auth0.com/blog/should-you-give-users-access-before-they-register/</link>
      <description>The business case for lazy registration</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Gating your content can be something of a gamble. On the one hand, allowing users to prematurely access your product means that you might wind up serving a lot of users who you never truly monetize. On the other hand, putting a login wall between potential users and content could lead to slower growth and a smaller user base.</p><p>According to Blue Research, <a href="http://www.prweb.com/releases/2012/1/prweb9086226.htm" target="_blank" rel="noreferrer noopener">54% of users will abandon a website</a> if the registration process is too cumbersome. Good product designers know all too well that interrupting a user in their intended path can be a great way to lose them.</p><p>Over and over again, the data shows that the more cumbersome a signup process is, the less likely a user is to bother with it at all. <a href="http://unbounce.com/conversion-rate-optimization/how-to-optimize-contact-forms/" target="_blank" rel="noreferrer noopener">Eighty-six percent of users</a> say lengthy forms make them quit registrations, and 88% will simply <a href="https://web.archive.org/web/20171209150724/http://www1.janrain.com/rs/janrain/images/Industry-Research-Value-of-Social-Login-2013.pdf" target="_blank" rel="noreferrer noopener">enter incomplete or false information</a> if the signup process is too exhaustive or intrusive.</p><p>But how do you solve for registration drop off when your signup process <em>does</em> follow best practices? Lazy registration could be the solution.</p><h2 id="What-is-Lazy-Registration-">What is Lazy Registration?</h2><p>Lazy registration allows users to access content <em>before</em> they register as a user. This allows users to experience the product without inputting any of their information and can increase the loyalty and lifetime value (LTV) of a registered user base by building a relationship with the user ahead of account creation.</p><p>Where you put the login wall is a conversation similar to deciding where to put a paywall within an app. Ultimately, you‚Äôll have to look at what‚Äôs within your user experience that users are going to want to see and use for themselves before deciding the app has value.</p><p>Lazy registration has the potential to mitigate some install-to-signup dropoff by giving users time to explore the app, and then prompting them to set up an account when they want to save the information or personalize their experience.</p><h3 id="How-progressive-profiling-fits-in">How progressive profiling fits in</h3><p>Lazy registration doesn‚Äôt just benefit the users of an application. By collecting data from your users as they interact with the application, you‚Äôll be able to tailor their experience to their needs, without bombarding them with questions.</p><p>This process is known as progressive profiling, and it means that your users get the content that‚Äôs most relevant to them, without being inundated with requests for more information. Examples of progressive profiling include incentivizing certain behaviors with points or rewards, collecting data from pop-ups as the user progresses through the application, or even prompting users to add more data via email or push notification.</p><p>Progressive profiling used in tandem with lazy registration allows you to collect a rich store of data on your users, without putting the burden on them. You‚Äôre able to build a relationship with them and establish trust ahead of asking for their personal information and use their behavioral data to serve them with more relevant information and experiences.</p><p>If your motivation for implementing lazy registration is for the purposes of progressively profiling your users, it might make sense to also look at incorporating some form of single sign on, or SSO, into your user signup experience.</p><p>SSO allows you to build a <a href="https://auth0.com/learn/social-login/" target="_blank" rel="noreferrer noopener">richer user profile</a>, without asking your users manually for a lot of information. Implementing SSO can also have a dramatic impact on your install-to-signup conversion rate. Slowly learning about your consumers also aids in serving more targeted information to them. In the case of Moogsoft, their team found <a href="https://auth0.com/case-studies/moogsoft/" target="_blank" rel="noreferrer noopener">after implementing SSO</a> with Auth0, that 60% of their users were signing up using Google.</p><h2 id="Lazy-Registration-Doesn-t-Have-to-Mean-Zero-Data-Collection">Lazy Registration Doesn‚Äôt Have to Mean Zero Data Collection</h2><p>In the age-old tug of war between user experience and data collection, it‚Äôs the product designer‚Äôs job to ensure that the former isn‚Äôt being compromised too much for the latter. Often it‚Äôs inevitable that there will be some form of the tradeoff between an easy user experience and a richer user profile, but technology is rapidly accelerating to close in on this gap.</p><p>Apps can use lazy registration to encourage brand engagement ahead of the acquisition, much like an eCommerce store allows users to browse products without an account, right up until they want to favorite an item or complete a checkout. Lazy registration coupled with SSO and progressive profiling can reduce the burden of effort on the user to register for use while allowing for richer data collection, and an all around more customizable user experience. If you‚Äôd like to learn how lazy registration can benefit your business and your customers, please <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">reach out to the team at Auth0</a>.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 21 Oct 2021 15:03:00 +0000</pubDate>
    </item>
    <item>
      <title>Top 6 Cybersecurity Predictions for 2022</title>
      <link>https://auth0.com/blog/top-6-cybersecurity-predictions-for-2022/</link>
      <description>Security leaders will increase visibility and diversity of thought to meet consumer (and business) expectations</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>From the Colonial Pipeline attack, which resulted in fuel shortages across much of the East Coast, to the devastating breach on Microsoft Exchange, it‚Äôs safe to say 2021 was a tumultuous year for cybersecurity. But what will the next year look like?</p><p>I reached out to Auth0‚Äôs leading security and privacy experts to hear their predictions for 2022, and to learn how organizations will grapple with a changing threat landscape and the ongoing pandemic.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/e8LLSbz9kUTIssTNzD33k/1c58e52ea17e0bf67b104322e8ade137/cybersecurity-prediction-sep1" alt="Predictions"/></p><h2 id="1--The-Visibility-Challenge">1. The Visibility Challenge</h2><p>It‚Äôs been almost eighteen months since the Covid-19 pandemic forced us to rethink everyday life. The workplace was no exception. States ordered tens of millions to work from home, as they sought to limit the virus‚Äô spread. To accommodate this flood of remote working, IT departments raced against the clock to build the necessary technology infrastructure.</p><p>Now, the dust has settled. The pressure has eased slightly. It‚Äôs time to take a breath. But don‚Äôt get too comfortable.</p><p>The next challenge for IT leaders ‚Äî and CISOs in particular ‚Äî is in securing the newly acquired devices and services underpinning remote working. Monitoring and threat detection will likely prove to be the biggest headache.</p><blockquote><p>‚ÄúVisibility is fundamental to security,‚Äù explained Cassio Sampaio, Senior Vice President of Product at Auth0. ‚ÄúYou can‚Äôt stop attacks you don‚Äôt see. It‚Äôs always better to see attacks in progress, rather than after they‚Äôve occurred.‚Äù</p></blockquote><p>Many workplaces deployed new hardware and software in record time to ensure the continuity of the business, leaving little time to integrate them into existing security workflows. Sampaio says the big priority for 2022 will be to bring this infrastructure into view.</p><blockquote><p>‚ÄúWith teams working remotely for the foreseeable future, now‚Äôs the time for IT teams to start focusing on security, with monitoring and threat detection both high priorities,‚Äù Sampaio added. ‚ÄúHybrid working, as well as the growth of BYOD and cloud computing, has shifted the definition of a security perimeter. It now includes identity systems, as well as firewalls and IPS tools. It‚Äôs critical organizations extend their visibility to include these.‚Äù</p></blockquote><h2 id="2--Secure-by-Default-Becomes-the-Norm">2. Secure by Default Becomes the Norm</h2><p>Security breaches can occur because of simple user errors. In some cases, vendors inadvertently facilitate that by issuing products with insecure default configurations, putting the onus on the customer to harden them.</p><blockquote><p>‚ÄúFar too often, security is treated as the user‚Äôs responsibility. This approach has arguably contributed to several high-profile incidents,‚Äù said Shiven Ramji, Chief Product Officer at Auth0.</p></blockquote><p>In August, researchers at Upguard learned some apps running on a popular infrastructure provider were leaking sensitive customer and business data totaling 39m records. This included Covid-19 contact tracing details, payroll records, and biographical customer data.</p><p>UpGuard attributed the issue to a default configuration that allowed unauthorized third parties to remotely query the underlying data source. But instead of considering it a bug, the provider described the issue as a well-documented feature.</p><p>In the face of massive data breaches and other unwelcome security lapses, we expect vendors will take a more proactive approach in creating guardrails for their customers. A Secure by Design approach will become the default. This philosophy sees products shipped with the most cautious settings by default, accompanied by other vital protective features, including Multi-Factor Authentication (MFA) and Privileged Access Management (PAM)</p><h2 id="3--Malicious-Actors-Will-Exploit-Supply-Chain-Woes">3. Malicious Actors Will Exploit Supply Chain Woes</h2><p>Global supply chains are in disarray. The cost of shipping products between continents spiked during the pandemic, with ships and containers both in short supply. Meanwhile, soaring demand for semiconductors has resulted in widespread shortages of graphics cards, games consoles, and cars, with the ‚Äúchip drought‚Äù expected to last until 2023.</p><p>Amid this turmoil, we can expect to see malicious actors take advantage of the situation, exploiting the widespread sense of desperation among businesses and consumers. There is evidence this has already started to occur, with the FBI reporting an increase in Business Email Compromise (BEC) attacks at the start of the year.</p><blockquote><p>‚ÄúIf you‚Äôre a school awaiting a shipment of Chromebooks for remote learning, or a retailer expecting stock from overseas, you might not question an unexpected invoice, especially if it comes from someone you know. The urgency may override your skepticism,‚Äù said Annybell Villaroel, Security Awareness and Culture Manager at Auth0.</p></blockquote><h2 id="4--Diversity-of-Thought-and-Skill-Becomes-Regarded-as-an-Asset">4. Diversity of Thought and Skill Becomes Regarded as an Asset</h2><p>The security landscape continuously evolves. In the past decade alone, we‚Äôve witnessed the emergence of malware-as-a-service (MaaS), threat actors expanding by franchising their brand and technology to others, and attacks upon national infrastructure. Deepfake technology and bulk SMS messaging have been used to devastating effect.  </p><p>IT teams now face increasingly sophisticated opponents, with attacks delivered in greater volume over a variety of mediums. Combatting this will require organizations to draw from a wider range of skills when filling cybersecurity roles.</p><blockquote><p>‚ÄúBad actors have already diversified their thinking. Businesses must do the same,‚Äù said Jameeka Aaron, CISO at Auth0. <br/>‚ÄúI‚Äôve always argued for a holistic approach to information security,‚Äù she added. ‚ÄúTechnical skills are important, but so are the soft skills.‚Äù</p></blockquote><p>To find candidates with these skills, organizations will have to broaden their hiring criteria and recruit from places they didn‚Äôt previously.</p><blockquote><p>‚ÄúTo respond to this new threat landscape, businesses will have to shift their focus away from GPAs and certifications. You need people who can build bridges within the organization and evangelize good security practices. And going forward, I can imagine hiring managers will recognize communication and language skills as assets, too,‚Äù said Aaron.</p></blockquote><h2 id="5--Consumer-patience-wanes-over-privacy-breaches">5. Consumer patience wanes over privacy breaches</h2><p>Five years ago, Have I Been Pwned ‚Äî a service that allows members of the public to check whether their personal credentials have been leaked ‚Äî held records on 1.4 billion accounts. Today, that figure is almost 11.5 billion.</p><p>Coinciding with that almost tenfold rise is a greater awareness of security breaches among the general public, and signs their patience has begun to wane. According to Auth0‚Äôs latest CIAM survey, 92% of consumers expect businesses to keep their personal information safe.</p><blockquote><p>‚ÄúA decade ago, security breaches were smaller and less likely to be headline news,‚Äù said Sampaio. ‚ÄúNow, they‚Äôre front-page news, and they‚Äôve ensnared some of the largest brands in the world. People are tired and scared, and they want businesses to raise their game.‚Äù</p></blockquote><p>Perhaps surprisingly, the survey showed that a larger percentage of businesses, 97%, believe they are obligated to protect their customers‚Äô personal information.</p><blockquote><p>‚ÄúThis figure likely has its roots in many places. Security breaches are bad PR and are hugely costly for the company involved,‚Äù said Sampaio.
‚ÄúRecent legislation, most notably GDPR, LGPD, and APPI, introduces significant monetary penalties for organizations that experience a security breach. That raises the pressure further.‚Äù</p></blockquote><h2 id="6--Consumers-Begin-Expecting-Data-Portability---Interoperability">6. Consumers Begin Expecting Data Portability &amp; Interoperability</h2><p>From healthcare and financial services to social networks, consumers increasingly recognize the value of data interoperability and portability. It allows you to seamlessly share medical records between practitioners, to see your banking and credit card information from a single central hub, and port your playlist between streaming services.</p><blockquote><p>‚ÄúOne of the most popular apps in the App Store is Mint, which lets users track spending across their accounts. In the US, FHIR (Fast Healthcare Interoperability Resources) is making it easier for doctors to see the information held on their patients by other medical professionals. From a consumer‚Äôs perspective, interoperability is something that makes their lives easier, and data portability allows them to make real choices about who they do business with,‚Äù said Lucy McGrath, VP of Privacy at Auth0.</p></blockquote><p><img src="https://images.ctfassets.net/23aumh6u8s0i/11v4gylcGVWijlKWnhibFw/f7e091c1883197d00af99737574c649d/cybersecurity-prediction-sep2" alt="Interoperability"/></p><p>Data portability is already a consumer right in Europe thanks in part to GDPR and a number of global sectoral laws - particularly in finance and banking. McGrath expects demand for both portability and interoperability to increase in 2021 and beyond. The OECD has outlined the detailed benefits and challenges in its report <em>Data portability, interoperability and digital platform competition, OECD Competition Committee Discussion Paper,</em> <a href="https://www.oecd.org/daf/competition/data-portability-interoperability-and-digital-platform-competition-2021.pdf" target="_blank" rel="noreferrer noopener">here</a>.</p><blockquote><p>‚ÄúIt‚Äôs likely that we‚Äôll see consumers‚Äô expectation for choice - data portability and interoperability - enshrined in more global laws. It‚Äôs an exciting space that is spurring innovation - it‚Äôs essential the technology supporting the choice continues to protect the privacy of consumers and security of their data in these complex ecosystems‚Äù McGrath said.</p></blockquote></div></div>]]></content:encoded>
      <pubDate>Wed, 20 Oct 2021 14:51:00 +0000</pubDate>
    </item>
    <item>
      <title>A Tour Through the OWASP Top 10</title>
      <link>https://auth0.com/blog/a-tour-through-the-owasp-top-10/</link>
      <description>A quick look at the refreshed OWASP Top 10 to celebrate Cybersecurity Awareness Month</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>October is <a href="https://www.dhs.gov/national-cyber-security-awareness-month" target="_blank" rel="noreferrer noopener">National Cyber Security Awareness Month</a>. On top of that, OWASP just celebrated its 20th anniversary. To celebrate, we‚Äôre going to run through the newly updated <a href="https://www.owasptopten.org/" target="_blank" rel="noreferrer noopener">OWASP TOP 10</a> to remind everyone of how you can better protect your applications, your businesses, and your customers from unlawful and damaging cyber attacks. We‚Äôll also be highlighting where the updates were made and why and throw in some tips on how strengthening your identity solution can help mitigate these threats.</p><blockquote><p>The new Top 10 is still a working draft, and OWASP is soliciting <a href="https://github.com/OWASP/Top10/issues" target="_blank" rel="noreferrer noopener">feedback</a> on errors and corrections.</p></blockquote><h2 id="What-is-OWASP-">What is OWASP?</h2><p>The <a href="https://www.owasp.org" target="_blank" rel="noreferrer noopener">Open Web Application Security Project</a> (OWASP) is a non-profit organization that was set up to help raise awareness around web application security and provides guidance on how to incorporate preventative measures into your applications, infrastructure, and internal processes.  </p><p>They have several projects, including <a href="https://www.owasp.org/index.php/OWASP_Juice_Shop_Project" target="_blank" rel="noreferrer noopener">an insecure JavaScript application used for security training</a>, but the one that we‚Äôre focusing on today is the newly updated 2021 edition of their list of the top 10 threats to web app security.  </p><p>Updated regularly, the OWASP Top 10 lists the main security threats that affect web applications today. Each entry enumerates the threat, shows possible attack vectors, and highlights preventive measures to reduce the risk of such threat. At Auth0, we take steps to mitigate most of the issues outlined below, so when you delegate your authentication needs to us, a lot of this is already taken care of for you.</p><p>Let‚Äôs run through the list, looking at the threats and what we could be doing to make sure our own applications are secure and examining some features of the Auth0 platform that help to mitigate or entirely remove such threats.</p><p>For a high-level overview of the list updates, please refer to this handy chart, provided by <a href="https://owasp.org/Top10/" target="_blank" rel="noreferrer noopener">OWASP</a>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3GzLwhF5nSZnDaHvvotBLf/3d6cca202946de7ce52e3ef02865082e/Uploaded_from_A_Tour_Through_the_OWASP_Top_10" alt="A Tour Through the OWASP Top 10"/></p><h2 id="-1--Broken-Access-Control">#1: Broken Access Control</h2><p>Moving up to the #1 spot from its 2017 position at #5, broken access control is an umbrella term for possible weaknesses associated with the implementation of a reliable access control system. Access control systems have the ability to distinguish users based on privileges or permissions and determine who gets what access to content and functions. Weaknesses emerging from access control systems can be leveraged by attackers to elevate their permissions to levels they shouldn‚Äôt have. Some examples of this are:  </p><ul><li>Failing to prevent access to ‚Äòmembers only‚Äô pages when the user is not logged in or does not have the right permissions to view the page.</li><li>Not validating URL parameters that could be changed by the user (e.g., swapping one user ID out for another).</li><li>Trusting that cookie values have not been altered where the value can be used to determine the user‚Äôs role.</li><li>Forgoing security considerations in access control token management</li></ul><p>Once Auth0 issues access and ID tokens, they cannot be revoked in the same way as cookies with session IDs for server-side sessions. As a result, tokens should be issued for relatively short periods and then <a href="https://auth0.com/docs/security/tokens/refresh-tokens" target="_blank" rel="noreferrer noopener">refreshed</a> periodically if the user remains active. You can revoke refresh tokens in case they become compromised. Auth0 treats token revocation as though the token has been potentially exposed to malicious adversaries. Taking care to validate user permissions is key. Do not trust any input that could be modified by the user when it comes to working out what that user can do.</p><h2 id="-2--Cryptographic-Failures">#2: Cryptographic Failures</h2><p>Formerly sitting at #3 and referred to as ‚ÄúSensitive Data Exposure,‚Äù this entry in the OWASP Top 10 focuses on failures related to cryptography (or lack thereof) which often lead to exposure of sensitive data. It also deals with protecting sensitive information under normal operating conditions. It‚Äôs about handling sensitive data securely, encrypting data at rest, and being diligent about holding only as much data as you need only for as long as you need it. One of the reasons that the EU‚Äôs <a href="https://auth0.com/gdpr" target="_blank" rel="noreferrer noopener">General Data Protection Regulation</a> (GDPR) exists today is because of improper handling of sensitive personal data.  </p><p>Some things that you can do to help prevent sensitive data being stolen from your application include:  </p><ul><li>Making sure that web traffic is encrypted and transmitted over HTTPS using a valid SSL certificate and that <a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet" target="_blank" rel="noreferrer noopener">insecure connections are upgraded where possible</a>. <a href="https://letsencrypt.org/" target="_blank" rel="noreferrer noopener">Let‚Äôs Encrypt</a> issue <strong>free</strong> SSL certificates, making it very easy to make sure your web traffic is secure.</li><li>Encrypting <em>and</em> signing any browser cookies that contain sensitive information.</li><li>Removing any sensitive data that is no longer needed.</li><li>Hashing passwords using a strong hashing algorithm such as Bcrypt or PBKDF2.</li><li>Encrypting sensitive data at rest.</li></ul><p>Note that using automatic database encryption technology could still leave you exposed if an SQL injection attack is successful, as the data has to be read and decrypted at the database level. Doing the encryption and decryption step as part of your core application logic would help mitigate this.</p><h2 id="-3--Injection">#3: Injection</h2><p>Injection flaws are a well-known attack vector and have been around for a long time. This vector particularly impacts legacy code. Despite slipping two spots from its former status as #1, OWASP continues to recognize SQL injection as a common attack that is not only easy to exploit and detect as a weakness in an application but can also have devastating effects if successfully exploited by an attacker. Injection has been expanded to include the former #7 ‚Äî Cross-site scripting (XSS). This type of attack mostly involves the injection of unsanitized input that causes the user to unwittingly interact with a malicious site or file.  </p><p>In most cases, these types of attacks are successful because either:  </p><ul><li>the application relies on user input that has not been sanitized directly in an SQL query, or;</li><li>the query itself is not parameterized.</li></ul><p>Assuming that all user input could potentially be malicious is a good mantra to have when validating and processing it. <a href="https://www.owasp.org/index.php/Query_Parameterization_Cheat_Sheet" target="_blank" rel="noreferrer noopener">Parameterizing your SQL queries</a> can also help to protect your datastore from malformed queries manipulating your data in undesirable and damaging ways.  </p><p>As an example of what SQL query parameterization looks like, imagine a query that inserts a new user into a database:  </p><pre><code>sql <span>=</span> db<span>.</span>prepare <span>&#34;INSERT INTO users (name, email) VALUES (&#39;<span><span>#{</span>name<span>}</span></span>&#39;, &#39;<span><span>#{</span>email<span>}</span></span>&#39;)&#34;</span>
sql<span>.</span>execute</code></pre><p>In the code snippet above, the values for <code>name</code> and <code>email</code> are inserted into the SQL string without any sanitization performed on the input values. If those input values were to come from form fields, then an attacker could potentially supply malicious values that malform the SQL string and perform an attack. The same query using parameterized values might look like the following:  </p><pre><code>sql <span>=</span> db<span>.</span>prepare <span>&#34;INSERT INTO users (name, email) VALUES (?, ?)&#34;</span>
sql<span>.</span>execute <span>&#39;some_user&#39;</span><span>,</span> <span>&#39;some_user@email.com&#39;</span></code></pre><p>In this case, the values can be escaped and sanitized by the database library before they are included in the SQL statement. This way the SQL statement cannot be malformed in such a way that it can do damage or expose data.  </p><p>In more recent times, <a href="https://www.owasp.org/index.php/Testing_for_NoSQL_injection" target="_blank" rel="noreferrer noopener">NoSQL Injection</a> has become a factor when using NoSQL databases such as Mongo. Although it doesn‚Äôt use SQL, it‚Äôs still potentially susceptible to attacks when user input has not been validated and sanitized, as the query itself can be manipulated. Validating your user input and rejecting values that do not conform to an expected format would be a good strategy.</p><p>SQL and NoSQL injection attacks are just a subset of a broad category of injection attacks, which also includes <a href="https://cwe.mitre.org/data/definitions/77.html" target="_blank" rel="noreferrer noopener">Command</a>, <a href="https://cwe.mitre.org/data/definitions/917.html" target="_blank" rel="noreferrer noopener">Expression Language</a>, and <a href="https://www.owasp.org/index.php/LDAP_injection" target="_blank" rel="noreferrer noopener">LDAP</a>.</p><p>Many XSS issues can be mitigated by making sure that any data retrieved from third-party sources is properly encoded according to the context. Also, using frameworks that contain built-in mechanisms for sanitizing user input (such as Ruby on Rails or Play Framework) would go a long way to protecting your applications from these types of attacks.</p><h2 id="-4--Insecure-Design">#4: Insecure Design</h2><p>Making its debut at #4 on this year&#39;s list, Insecure Design is a new entry that focuses on the design and architectural flaws. It is defined by OWASP as a broad category that centers around missing or ineffective control design.</p><p>Before we go further into this one, it‚Äôs important to understand that there is a difference between insecure design and insecure implementation. We differentiate between design flaws and implementation defects for a reason; they have different root causes and remediation. A secure design can still have implementation defects leading to vulnerabilities that may be exploited. An insecure design cannot be fixed by a perfect implementation as by definition, needed security controls were never created to defend against specific attacks.</p><p>Insecure design issues can be identified and remediated through effective threat modeling in the design phase. Threat modeling should be performed early in the development cycle when potential issues can be caught early and remedied, preventing a much costlier fix down the line. Threat modeling methods are used to create:</p><ul><li>an abstraction of the system (Assets, components involved, and data flow between them)</li><li>personae of potential attackers and attack surfaces</li><li>a catalog of potential threats that may arise</li></ul><p>The outcome of threat modeling is documentation that outlines secure design recommendations and requirements for the system under consideration. This helps identify potential vulnerabilities earlier in the software development lifecycle.</p><h2 id="-5--Security-Misconfiguration">#5: Security Misconfiguration</h2><p>Moving up one spot from #6, this entry in the Top 10 list has been identified by OWASP as something that is easy to exploit, easy to discover, and extremely common. It concerns themes such as:  </p><ul><li>Out of date security patches on the host system</li><li>Application framework security feature not turned on or improperly configured</li><li>Default accounts, passwords, and secure keys left enabled and unchanged</li><li>Unused or default ports and services enabled on the host system</li><li>Verbose error pages or directory listing turned on</li></ul><p>This item also incorporates aspects of the former #4 on the list, XML External Entities (XXE). An XXE attack is designed to expose a vulnerability in poorly configured XML parsers. Such attacks can be used to expose sensitive data (such as reading system password files) or invoke a <a href="https://msdn.microsoft.com/en-us/magazine/ee335713.aspx" target="_blank" rel="noreferrer noopener">Denial of Service</a> (DoS) attack on a resource.</p><p>It is important to make sure that the host system running your applications is updated with the latest security patches, and that your application frameworks have all of the appropriate security features turned on in order to mitigate these types of misconfiguration vulnerabilities.  </p><p>Another serious concern in this area is making sure that any secret keys for third-party platforms (such as Auth0) are not committed and uploaded to your source control provider along with the rest of your code, particularly if your application is open source. These can be scanned by attackers using automation tools. Better to store these keys securely separate from your source code.</p><h2 id="-6--Vulnerable-and-Outdated-Components">#6: Vulnerable and Outdated Components</h2><p>This entry jumped three spots from 2017 and was renamed from ‚Äúusing components with known vulnerabilities.‚Äù Software these days tends to make use of many third-party components, and so being diligent about which version of these components you are using and keeping them up to date is paramount in protecting your application from attacks that stem from vulnerable dependencies.  </p><p>Unfortunately, the number of dependencies that a given application uses ‚Äî directly or indirectly ‚Äî can sometimes make identifying and triaging vulnerable components difficult, usually meaning that the task doesn‚Äôt get done and developers are completely unaware as to their existence.  </p><p>OWASP recommends a few tools that can help to identify and upgrade components that present a security risk, including their own <a href="https://www.owasp.org/index.php/OWASP_Dependency_Check" target="_blank" rel="noreferrer noopener">OWASP Dependency-Check</a>. Node.js applications using NPM version 5.10.0 or 6 and above can make use of the ‚Äò<a href="https://docs.npmjs.com/cli/audit" target="_blank" rel="noreferrer noopener">audit</a>‚Äô command in the terminal, which can <a href="https://blog.npmjs.org/post/173719309445/npm-audit-identify-and-fix-insecure" target="_blank" rel="noreferrer noopener">identify and automatically upgrade dependencies</a> that have been identified as vulnerable.  </p><p>Another popular tool (and one that we use ourselves here at Auth0) for the checking of vulnerabilities in dependencies is <a href="https://snyk.io/" target="_blank" rel="noreferrer noopener">Snyk</a>. Snyk can be set up to evaluate your projects directly in GitHub or can be used as a <a href="https://snyk.io/docs/using-snyk/" target="_blank" rel="noreferrer noopener">command-line tool</a> to act directly on your project code.</p><h2 id="-7--Identification-and-Authentication-Failures">#7: Identification and Authentication Failures</h2><p>Formerly sitting at #2 and called ‚Äúbroken authentication,‚Äù this entry is close to our hearts here at Auth0. OWASP acknowledges this as easily exploitable with extreme damage potential.  </p><p>Broken authentication covers many things to do with authenticating users with an application or service, including:  </p><ul><li>Automated brute-force attacks using known password lists</li><li>Permission of weak or well-known passwords</li><li>Storage of plain-text or weakly-hashed passwords over strong hashes</li><li>Lack of <a href="https://auth0.com/docs/multifactor-authentication" target="_blank" rel="noreferrer noopener">multi-factor authentication (MFA)</a></li><li>Improper invalidation of a session when logging out or after a period of inactivity</li></ul><p>Implementing features like Auth0‚Äôs adaptive MFA into your application will help prevent <a href="https://auth0.com/blog/what-is-credential-stuffing" target="_blank" rel="noreferrer noopener">credential stuffing</a> and other brute force attacks, as the attacker will not be able to complete the authentication steps. Regarding passwords, validating for weak or well-known passwords using a common password list and hashing the user‚Äôs password using a strong hashing algorithm (such as <a href="https://en.wikipedia.org/wiki/Bcrypt" target="_blank" rel="noreferrer noopener">Bcrypt</a> or <a href="https://en.wikipedia.org/wiki/PBKDF2" target="_blank" rel="noreferrer noopener">PBKDF2</a>) take the protection a step further. Never use a weak hash like MD5, and never store your passwords in plain text.  </p><p>It‚Äôs also good practice to purposefully use vague login failure messages when your users enter an incorrect username or password. Otherwise, attackers may be able to identify valid accounts that they could use in order to instigate an attack.</p><p>The Auth0 identity platform has built-attack protection to address most of the issues around brute-force attacks, including cross-site scripting attacks (XSS) and strong password hashing are all handled for you. Additionally, we make it very easy to turn on and <a href="https://auth0.com/blog/auth0-introduces-adaptive-mfa/" target="_blank" rel="noreferrer noopener">integrate MFA into your applications</a> for that extra level of security.</p><h2 id="-8--Software-and-Data-Integrity-Failures">#8: Software and Data Integrity Failures</h2><p>Another new entry for 2021, this category includes the former #8: Insecure Deserialization. OWASP expanded the definition to include other ways software and data integrity can slip between the cracks and end in calamity. An insecure CI/CD pipeline, using plug-ins or modules from untrusted repositories or CDNs, along with situations where data is serialized in a structure that an attacker can access and modify are all possible vectors of attack covered by this category.</p><p>A partial list of security measures to implement includes:</p><ul><li>Ensuring your CI/CD processes are securely configured and have access controls in place to enable integrity checks on the code flowing through them.</li><li>Incorporate software supply chain security controls to verify the integrity of any modules and plug-ins being used.</li><li>Run any unsigned or unencrypted data through an integrity check before usage.</li></ul><p>If your application deserializes objects from untrusted sources, you could be open to this kind of attack. The only safe way to prevent these from happening is to not accept serialized objects from untrusted locations. If that‚Äôs not possible, OWASP recommends using digital signatures to verify integrity, enforcing strict primitive type checking, and performing deserialization logic inside a low-privilege environment.</p><h2 id="-9--Security-Logging-and-Monitoring-Failures">#9: Security Logging and Monitoring Failures</h2><p>Entry 9 was bumped up from #10 and renamed from ‚Äúinsufficient logging and monitoring.‚Äù Being able to discover breaches, attack patterns, and user activity is a key property of a secure system. Without <a href="https://auth0.com/blog/log-streaming--what-it-is-and-why-it-matters/" target="_blank" rel="noreferrer noopener">sufficient logging</a> and application monitoring, it will be difficult to ascertain how a system was breached, where the breach came from, and where the holes lie in your application security strategy. If you don‚Äôt know where the holes are, you can‚Äôt fill them in!  </p><p>OWASP recommends that application activity ‚Äî particularly around authentication and permission activities ‚Äî are logged in a common format that can be easily processed by a centralized logging system. As much detail about user context should be logged and retained as possible without compromising their personal data, which not only includes personally identifiable information (PII) but also secure keys, access tokens, and session tokens. If detailed information that could be used to identify a person must be recorded for forensics purposes, use a secure data warehouse coupled with tight access controls available only to trusted individuals.</p><h2 id="-10--Server-Side-Request-Forgery--SSRF-">#10: Server-Side Request Forgery (SSRF)</h2><p>Making a debut at #10 this year is Server-Side Request Forgery, an item from OWASPs industry survey. Despite relatively low incidence rates (per the survey), this attack vector rates high in potential impact and damage, so it garnered the #10 spot. SSRF is a flaw that occurs when a web app fails to validate a user-supplied URL. An attacker can exploit this scenario to send a malicious request to any destination server they want.</p><p>There are numerous common ways to prevent this type of attack, some are more apt to be overlooked than others:</p><ul><li>Disable HTTP redirection</li><li>Segment remote access functionality to a secure network separate from potential target resources</li><li>Validate all client-supplied input data</li><li>Employ a robust identity and access management solution</li></ul><h2 id="Mitigating-Security-Issues-with-Auth0">Mitigating Security Issues with Auth0</h2><p>The Auth0 platform has many features which help protect your application and your users from security attacks. For starters, simply by using our Universal Login offering, you are effectively delegating all the work of making your login pages <a href="https://auth0.com/docs/hosted-pages/login#why-use-universal-login" target="_blank" rel="noreferrer noopener">secure and resilient to attacks</a>.  </p><p>Additionally, <a href="https://auth0.com/blog/multifactor-authentication-mfa/" target="_blank" rel="noreferrer noopener">Multi-factor Authentication</a> (MFA) can easily be enabled on any application to provide an extra layer of security when your users log in and decrease the likelihood of unauthorized access. Options for completing the MFA step include receiving push notifications and codes via mobile authenticator apps.  </p><p>Auth0‚Äôs <a href="https://auth0.com/docs/anomaly-detection" target="_blank" rel="noreferrer noopener">Anomaly Detection</a> includes options for protecting against brute-force attacks, blocking repeated attempts to log in, and notifying designated recipients of such unauthorized attempts. Furthermore, enabling our <a href="https://auth0.com/breached-passwords" target="_blank" rel="noreferrer noopener">Breached Password Detection</a> feature means that your users will be notified if we detect that their credentials were part of a published security breach.  </p><p><a href="https://auth0.com/blog/log-streaming--what-it-is-and-why-it-matters/" target="_blank" rel="noreferrer noopener">Comprehensive logging</a> is a feature of the Auth0 platform, which can be interrogated for events, such as:  </p><ul><li>Failed login attempts</li><li>Failed password changes</li><li>Failed Access Token exchanges</li><li>Too many failures</li></ul><p>Logs can also be shipped to other providers via <a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">marketplace</a> integrations, such as <a href="https://auth0.com/docs/extensions/logstash" target="_blank" rel="noreferrer noopener">Logstash</a>, <a href="https://auth0.com/docs/extensions/papertrail" target="_blank" rel="noreferrer noopener">Papertrail</a>, and <a href="https://auth0.com/docs/extensions/splunk" target="_blank" rel="noreferrer noopener">Splunk</a>.  </p><p>As added protection against <a href="https://us.norton.com/internetsecurity-wifi-what-is-a-man-in-the-middle-attack.html" target="_blank" rel="noreferrer noopener">man-in-the-middle attacks</a>, we also enforce HTTPS connections to our services, meaning that any non-HTTPS connections are upgraded according to <a href="https://tools.ietf.org/html/rfc6797" target="_blank" rel="noreferrer noopener">HSTS specifications</a>.  </p><p>Finally, to protect against XXE attacks through SAML, we use <a href="https://github.com/auth0/xmldom" target="_blank" rel="noreferrer noopener">our own fork of XML parsing library &#39;XMLDOM&#39;</a>, which does not allow DOCTYPE entity parsing at all‚Äîa key component of XXE attacks.</p><h2 id="Summary">Summary</h2><p>In this article, we‚Äôve had a brief run through the newly updated OWASP Top 10 and examined the main threats to web application security that exist today. We&#39;ve also considered some of the possible mitigations against such threats and how we can all do better to help protect our businesses and our users from problems arising as a result of poor and insecure implementation.</p><p>Some of these solutions are easy to implement and take only a short amount of time, while others require a bit more thought and planning to do properly. However, anything that can be done to improve the security of your products ‚Äî especially where personal information and other sensitive data is concerned ‚Äî can only be beneficial, and could be a key factor in <a href="https://auth0.com/blog/the-worst-data-breaches-of-2021-q1-and-q2/" target="_blank" rel="noreferrer noopener">preventing a data disaster</a> should an attack be attempted.</p><p>We&#39;ve also looked at several key features of the Auth0 platform that bolster the security of web applications and APIs, from relieving you of a lot of these issues through Universal Login to rich audit trails through comprehensive logging. To start taking advantage, <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">sign up for a free account today</a> or <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">reach out to our team of identity experts</a> to have your questions answered.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 19 Oct 2021 14:56:00 +0000</pubDate>
    </item>
    <item>
      <title>Exploring the Auth0 ASP.NET Core Authentication SDK</title>
      <link>https://auth0.com/blog/exploring-auth0-aspnet-core-authentication-sdk/</link>
      <description>The new Auth0 ASP.NET Core Authentication SDK makes adding authentication and authorization to your web applications a breeze. Learn how.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Auth0 brings you the new <a href="https://github.com/auth0/auth0-aspnetcore-authentication" target="_blank" rel="noreferrer noopener">ASP.NET Core Authentication SDK</a>, which improves your development experience and better integrates with Auth0 features! Let&#39;s take a tour through the main features of the SDK to see how easy it becomes to integrate your ASP.NET applications with Auth0.</p><h2 id="The-SDK-Overview">The SDK Overview</h2><p>So far, you were used to relying on the standard <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>OpenIdConnect</code> package to integrate your ASP.NET application with Auth0. That library does its job very well. However, when you move away from implementing the simple login and logout, your code starts becoming verbose until it gets messy.</p><p>You can mitigate this issue by <a href="https://auth0.com/blog/using-csharp-extension-methods-for-auth0-authentication/" target="_blank" rel="noreferrer noopener">implementing your authentication with C# extension methods</a>. But why do it yourself when the experts at Auth0 can provide you with a ready-to-use SDK?</p><p>The  <a href="https://github.com/auth0/auth0-aspnetcore-authentication" target="_blank" rel="noreferrer noopener">ASP.NET Core Authentication SDK</a> allows you to write less code to integrate Auth0 authentication and authorization into your ASP.NET applications. It simplifies configuration, supports additional query parameters and refresh tokens, natively supports <a href="https://auth0.com/docs/organizations" target="_blank" rel="noreferrer noopener">Auth0 Organizations</a> and user invitations. It is actually a wrapper around the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>OpenIdConnect</code> library, but it brings you a standard and easy way to integrate Auth0 into your applications.</p><p>You can use the SDK for all your ASP.NET applications that require authentication, such as ASP.NET MVC apps, Razor web apps, and Blazor server apps.</p><h2 id="Install-the-ASP-NET-Core-Authentication-SDK">Install the ASP.NET Core Authentication SDK</h2><p>You can install the Auth0 ASP.NET Core SDK by using the NuGet Package Manager UI in Visual Studio, as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/52AB2b6XDotBDpBlPPR1F7/f4b71a1b33c3cecb56b46d96b2e27788/installing-auth0-aspnet-core-authentication-sdk.png" alt="Installing the Auth0 ASP.NET SDK with NuGet Package Manager UI"/></p><p>You can also install it by running the following command in the Package Manager Console:</p><pre><code><span>Install-Package</span> Auth0<span>.</span>AspNetCore<span>.</span>Authentication</code></pre><p>Or you can use the following command in a terminal window:</p><pre><code>dotnet <span>add</span> package Auth0.AspNetCore.Authentication</code></pre><p>Independently of your preferred approach, you will get the <code>Auth0<span>.</span>AspNetCore<span>.</span>Authentication</code> dependency in your ASP.NET project.</p><h2 id="The-Basic-Login-Use-Case">The Basic Login Use Case</h2><p>Let&#39;s start to take a look at the way the new SDK improves your developer experience. Of course, you need an Auth0 account to integrate your ASP.NET application with Auth0. If you haven&#39;t, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one</a> right now. Follow <a href="https://auth0.com/docs/quickstart/webapp/aspnet-core#configure-auth0" target="_blank" rel="noreferrer noopener">the Auth0 ASP.NET Core Authentication SDK quickstart to register your application and get your application keys</a>. </p><p>The following is the typical code you write to enable authentication in your ASP.NET application when using <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>OpenIdConnect</code>:</p><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuthentication</span><span>(</span>options <span>=&gt;</span> <span>{</span>
    options<span>.</span>DefaultAuthenticateScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
    options<span>.</span>DefaultSignInScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
    options<span>.</span>DefaultChallengeScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
  <span>}</span><span>)</span>
  <span>.</span><span>AddCookie</span><span>(</span><span>)</span>
  <span>.</span><span>AddOpenIdConnect</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> options <span>=&gt;</span> <span>{</span>
    options<span>.</span>Authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>
    options<span>.</span>ClientId <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    options<span>.</span>CallbackPath <span>=</span> <span>new</span> <span>PathString</span><span>(</span><span>&#34;/callback&#34;</span><span>)</span><span>;</span>
    options<span>.</span>TokenValidationParameters <span>=</span> <span>new</span> <span>TokenValidationParameters</span>
    <span>{</span>
      NameClaimType <span>=</span> <span>&#34;name&#34;</span>
    <span>}</span><span>;</span>
    options<span>.</span>Events <span>=</span> <span>new</span> <span>OpenIdConnectEvents</span>
    <span>{</span>
      OnRedirectToIdentityProviderForSignOut <span>=</span> <span>(</span>context<span>)</span> <span>=&gt;</span>
      <span>{</span>
        <span><span>var</span></span> logoutUri <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>/v2/logout?client_id=</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>

        <span><span>var</span></span> postLogoutUri <span>=</span> context<span>.</span>Properties<span>.</span>RedirectUri<span>;</span>
        <span>if</span> <span>(</span><span>!</span><span>string</span><span>.</span><span>IsNullOrEmpty</span><span>(</span>postLogoutUri<span>)</span><span>)</span>
        <span>{</span>
          <span>if</span> <span>(</span>postLogoutUri<span>.</span><span>StartsWith</span><span>(</span><span>&#34;/&#34;</span><span>)</span><span>)</span>
          <span>{</span>
            <span>// transform to absolute</span>
            <span><span>var</span></span> request <span>=</span> context<span>.</span>Request<span>;</span>
            postLogoutUri <span>=</span> request<span>.</span>Scheme <span>+</span> <span>&#34;://&#34;</span> <span>+</span> request<span>.</span>Host <span>+</span> request<span>.</span>PathBase <span>+</span> postLogoutUri<span>;</span>
          <span>}</span>
          logoutUri <span>+=</span> <span><span>$&#34;&amp;returnTo=</span><span><span>{</span><span> Uri<span>.</span><span>EscapeDataString</span><span>(</span>postLogoutUri<span>)</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>
        <span>}</span>

        context<span>.</span>Response<span>.</span><span>Redirect</span><span>(</span>logoutUri<span>)</span><span>;</span>
        context<span>.</span><span>HandleResponse</span><span>(</span><span>)</span><span>;</span>

        <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
      <span>}</span>
    <span>}</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>I will not go through that code to explain every single step. You just need to know it implements the login and logout features in your applications by relying on the <a href="https://auth0.com/docs/login/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login</a> page.</p><p>By using the Auth0 ASP.NET Core Authentication SDK, your code shortens as follows:</p><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span>
  <span>{</span>
    options<span>.</span>Domain <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientId <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>Impressive, isn&#39;t it? üò≤</p><p>The SDK takes care of all the configuration stuff you previously needed to do manually. And that&#39;s just the beginning! üéâ</p><h2 id="Get-an-Access-Token">Get an Access Token</h2><p>What if you want to call an API from your ASP.NET application? In this case, you need to <a href="https://auth0.com/docs/security/tokens/access-tokens/get-access-tokens#control-access-token-audience" target="_blank" rel="noreferrer noopener">request an access token for a specific audience</a> to Auth0.</p><p>Doing it without the SDK would require a code similar to the following:</p><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuthentication</span><span>(</span>options <span>=&gt;</span> <span>{</span>
    options<span>.</span>DefaultAuthenticateScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
    options<span>.</span>DefaultSignInScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
    options<span>.</span>DefaultChallengeScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
  <span>}</span><span>)</span>
  <span>.</span><span>AddCookie</span><span>(</span><span>)</span>
  <span>.</span><span>AddOpenIdConnect</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> options <span>=&gt;</span> <span>{</span>
    options<span>.</span>Authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>
    options<span>.</span>ClientId <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    <span>//üëánew code</span>
    options<span>.</span>ClientSecret <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientSecret&#34;</span><span>]</span><span>;</span>
    options<span>.</span>SaveTokens <span>=</span> <span>true</span><span>;</span>
    options<span>.</span>ResponseType <span>=</span> OpenIdConnectResponseType<span>.</span>Code<span>;</span>
    <span>//üëÜnew code</span>
    options<span>.</span>CallbackPath <span>=</span> <span>new</span> <span>PathString</span><span>(</span><span>&#34;/callback&#34;</span><span>)</span><span>;</span>
    options<span>.</span>TokenValidationParameters <span>=</span> <span>new</span> <span>TokenValidationParameters</span>
    <span>{</span>
      NameClaimType <span>=</span> <span>&#34;name&#34;</span>
    <span>}</span><span>;</span>
    options<span>.</span>Events <span>=</span> <span>new</span> <span>OpenIdConnectEvents</span>
    <span>{</span>
      OnRedirectToIdentityProviderForSignOut <span>=</span> <span>(</span>context<span>)</span> <span>=&gt;</span>
      <span>{</span>
        <span><span>var</span></span> logoutUri <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>/v2/logout?client_id=</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>

        <span><span>var</span></span> postLogoutUri <span>=</span> context<span>.</span>Properties<span>.</span>RedirectUri<span>;</span>
        <span>if</span> <span>(</span><span>!</span><span>string</span><span>.</span><span>IsNullOrEmpty</span><span>(</span>postLogoutUri<span>)</span><span>)</span>
        <span>{</span>
          <span>if</span> <span>(</span>postLogoutUri<span>.</span><span>StartsWith</span><span>(</span><span>&#34;/&#34;</span><span>)</span><span>)</span>
          <span>{</span>
            <span>// transform to absolute</span>
            <span><span>var</span></span> request <span>=</span> context<span>.</span>Request<span>;</span>
            postLogoutUri <span>=</span> request<span>.</span>Scheme <span>+</span> <span>&#34;://&#34;</span> <span>+</span> request<span>.</span>Host <span>+</span> request<span>.</span>PathBase <span>+</span> postLogoutUri<span>;</span>
          <span>}</span>
          logoutUri <span>+=</span> <span><span>$&#34;&amp;returnTo=</span><span><span>{</span><span> Uri<span>.</span><span>EscapeDataString</span><span>(</span>postLogoutUri<span>)</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>
        <span>}</span>

        context<span>.</span>Response<span>.</span><span>Redirect</span><span>(</span>logoutUri<span>)</span><span>;</span>
        context<span>.</span><span>HandleResponse</span><span>(</span><span>)</span><span>;</span>

        <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
      <span>}</span>
      <span>//üëánew code</span>
      OnRedirectToIdentityProvider <span>=</span> context <span>=&gt;</span>
      <span>{</span>
        context<span>.</span>ProtocolMessage<span>.</span><span>SetParameter</span><span>(</span><span>&#34;audience&#34;</span><span>,</span> Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>)</span><span>;</span>
        <span>return</span> Task<span>.</span><span>FromResult</span><span>(</span><span>0</span><span>)</span><span>;</span>
      <span>}</span>
      <span>//üëÜnew code</span>
    <span>}</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>Basically, you need to add a few more lines to the previous code in order to change the OAuth flow, provide the client secret, enable token saving, and attach the audience value to the authorization request.</p><p>The equivalent code to achieve the same result using the SDK is as follows:</p><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span>
  <span>{</span>
    options<span>.</span>Domain <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientId <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientSecret <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientSecret&#34;</span><span>]</span><span>;</span>
  <span>}</span><span>)</span>
  <span>.</span><span>WithAccessToken</span><span>(</span>options <span>=&gt;</span>
  <span>{</span>
    options<span>.</span>Audience <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>;</span>
  <span>}</span><span>)</span><span>;</span> 
<span>}</span></code></pre><p>Aren&#39;t you excited about this? üí• Your code will be more concise, clean, and clear!</p><h2 id="Refresh-Tokens-As-Magic">Refresh Tokens As Magic</h2><p>And in case you need a <a href="https://auth0.com/docs/security/tokens/refresh-tokens" target="_blank" rel="noreferrer noopener">refresh token</a>? ü§î Nothing could be simpler. Just set a flag:</p><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span>
  <span>{</span>
    options<span>.</span>Domain <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientId <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientSecret <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientSecret&#34;</span><span>]</span><span>;</span>
  <span>}</span><span>)</span>
  <span>.</span><span>WithAccessToken</span><span>(</span>options <span>=&gt;</span>
  <span>{</span>
    options<span>.</span>Audience <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>;</span>
    options<span>.</span>UseRefreshTokens <span>=</span> <span>true</span><span>;</span>   <span>//üëà new code</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>Compare it with the code you need to add to the SDK-less code:</p><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuthentication</span><span>(</span>options <span>=&gt;</span> <span>{</span>
  <span>//...the code to configure authentication...</span>
  <span>}</span><span>)</span>
  <span>.</span><span>AddCookie</span><span>(</span>options <span>=&gt;</span> <span>{</span>
    options<span>.</span>Events<span>.</span>OnValidatePrincipal <span>=</span> <span>(</span>context<span>)</span> <span>=&gt;</span> <span>{</span>
    <span><span>var</span></span> options <span>=</span> context<span>.</span>HttpContext<span>.</span>RequestServices<span>.</span><span><span>GetRequiredService</span><span><span>&lt;</span>Auth0Options<span>&gt;</span></span></span><span>(</span><span>)</span><span>;</span>

    <span><span>string</span></span> accessToken<span>;</span>
    <span>if</span> <span>(</span>context<span>.</span>Properties<span>.</span>Items<span>.</span><span>TryGetValue</span><span>(</span><span>&#34;.Token.access_token&#34;</span><span>,</span> <span>out</span> accessToken<span>)</span><span>)</span>
    <span>{</span>
      <span>if</span> <span>(</span>options<span>.</span>UseRefreshTokens<span>)</span>
      <span>{</span>
        <span><span>string</span></span> refreshToken<span>;</span>
        <span>if</span> <span>(</span>context<span>.</span>Properties<span>.</span>Items<span>.</span><span>TryGetValue</span><span>(</span><span>&#34;.Token.refresh_token&#34;</span><span>,</span> <span>out</span> refreshToken<span>)</span><span>)</span>
        <span>{</span>
          <span><span>var</span></span> now <span>=</span> DateTimeOffset<span>.</span>Now<span>;</span>
          <span><span>var</span></span> expiresAt <span>=</span> DateTimeOffset<span>.</span><span>Parse</span><span>(</span>context<span>.</span>Properties<span>.</span>Items<span>[</span><span>&#34;.Token.expires_at&#34;</span><span>]</span><span>)</span><span>;</span>
          <span><span>var</span></span> leeway <span>=</span> <span>60</span><span>;</span>
          <span><span>var</span></span> difference <span>=</span> DateTimeOffset<span>.</span><span>Compare</span><span>(</span>expiresAt<span>,</span> now<span>.</span><span>AddSeconds</span><span>(</span>leeway<span>)</span><span>)</span><span>;</span>
          <span><span>var</span></span> isExpired <span>=</span> difference <span>&lt;=</span> <span>0</span><span>;</span>

          <span>if</span> <span>(</span>isExpired <span>&amp;&amp;</span> <span>!</span><span>string</span><span>.</span><span>IsNullOrWhiteSpace</span><span>(</span>refreshToken<span>)</span><span>)</span>
          <span>{</span>
            <span><span>var</span></span> result <span>=</span> <span>await</span> <span>RefreshTokens</span><span>(</span>options<span>,</span> refreshToken<span>,</span> auth0Options<span>.</span>Backchannel<span>)</span><span>;</span>

            <span>if</span> <span>(</span>result <span>!=</span> <span>null</span><span>)</span>
            <span>{</span>
              context<span>.</span>Properties<span>.</span><span>UpdateTokenValue</span><span>(</span><span>&#34;access_token&#34;</span><span>,</span> result<span>.</span>AccessToken<span>)</span><span>;</span>
              context<span>.</span>Properties<span>.</span><span>UpdateTokenValue</span><span>(</span><span>&#34;refresh_token&#34;</span><span>,</span> result<span>.</span>RefreshToken<span>)</span><span>;</span>
              context<span>.</span>Properties<span>.</span><span>UpdateTokenValue</span><span>(</span><span>&#34;id_token&#34;</span><span>,</span> result<span>.</span>IdToken<span>)</span><span>;</span>
              context<span>.</span>Properties<span>.</span><span>UpdateTokenValue</span><span>(</span><span>&#34;expires_at&#34;</span><span>,</span> DateTimeOffset<span>.</span>Now<span>.</span><span>AddSeconds</span><span>(</span>result<span>.</span>ExpiresIn<span>)</span><span>.</span><span>ToString</span><span>(</span><span>&#34;o&#34;</span><span>)</span><span>)</span><span>;</span>
            <span>}</span>
            <span>else</span>
            <span>{</span>
              context<span>.</span>Properties<span>.</span><span>UpdateTokenValue</span><span>(</span><span>&#34;refresh_token&#34;</span><span>,</span> <span>null</span><span>)</span><span>;</span>
            <span>}</span>

            context<span>.</span>ShouldRenew <span>=</span> <span>true</span><span>;</span>
          <span>}</span>
        <span>}</span> 
      <span>}</span>
    <span>}</span>
  <span>}</span><span>)</span>
  <span>.</span><span>AddOpenIdConnect</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> options <span>=&gt;</span> <span>{</span>
    <span>//...the code to configure OpenID Connect...</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>You should take care of all the details about determining the token expiration and requesting a new access token. The Auth0 ASP.NET Core Authentication SDK does this on your behalf. Do you agree it&#39;s magic? ‚ú®</p><h2 id="Auth0-Organizations-Support">Auth0 Organizations Support</h2><p>Not only the ASP.NET Core Authentication SDK lets you deal with standard OpenID Connect and OAuth duties, but it also simplifies your life in using specific Auth0 features such as <a href="https://auth0.com/docs/organizations" target="_blank" rel="noreferrer noopener">Auth0 Organizations</a>. By using Organizations, you can represent logical groups of users such as teams, partners, business customers, and so on. They can have specific policies, branding, and other customizations. So, to enable a user to log in to an organization, you need to specify it in your ASP.NET application. The following is an example of how you can accomplish this by using the SDK:</p><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span>
  <span>{</span>
    options<span>.</span>Domain <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientId <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    options<span>.</span>Organization <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Organization&#34;</span><span>]</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>Pretty straightforward, right? üôå Of course, you can do more with Organizations. Please, take a look at <a href="https://github.com/auth0/auth0-aspnetcore-authentication#organization" target="_blank" rel="noreferrer noopener">the ASP.NET Core Authentication SDK documentation</a> to learn more.</p><h2 id="Customization">Customization</h2><p>At this point, you may think that having an SDK forces you to use its methods to work with OpenID Connect and OAuth. So you no longer have the freedom of adding extra parameters to the authorization request, for example. Or you may think you can&#39;t anymore apply your custom token validation or freely manage OpenID Connect events.</p><p>I have good news: you don&#39;t need to worry about this. The ASP.NET Core Authentication SDK leaves you the freedom to customize many things.</p><p>For example, you can add custom parameters to the authorization request. Look at the following example:</p><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span>
  <span>{</span>
    options<span>.</span>Domain <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientId <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    options<span>.</span>LoginParameters <span>=</span> <span>new</span> <span>Dictionary<span>&lt;</span><span>string</span><span>,</span> <span>string</span><span>&gt;</span></span><span>(</span><span>)</span> <span>{</span> 
      <span>{</span> <span>&#34;screen_hint&#34;</span><span>,</span> <span>&#34;signup&#34;</span> <span>}</span> 
    <span>}</span><span>;</span>
  <span>}</span><span>)</span><span>;</span> 
<span>}</span></code></pre><p>Here you configured your ASP.NET application to attach the <code>screen_hint</code> parameter with the <code>signup</code> value  to the authorization request. In this specific case, the user will see the signup window instead of the default login screen.</p><p>But you can also apply your custom validation, as in the following case:</p><pre><code><span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuth0WebAppAuthentication</span><span>(</span>options <span>=&gt;</span>
  <span>{</span>
    options<span>.</span>Domain <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientId <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    options<span>.</span>OpenIdConnectEvents <span>=</span> <span>new</span> <span>OpenIdConnectEvents</span>
    <span>{</span>
      OnTokenValidated <span>=</span> <span>(</span>context<span>)</span> <span>=&gt;</span>
      <span>{</span>
        <span><span>var</span></span> birthDateClaim <span>=</span> context<span>.</span>SecurityToken<span>.</span>Claims<span>.</span><span>SingleOrDefault</span><span>(</span>claim <span>=&gt;</span> claim<span>.</span>Type <span>==</span> <span>&#34;birthdate&#34;</span><span>)</span><span>?.</span>Value<span>;</span>

        <span>if</span> <span>(</span><span>string</span><span>.</span><span>IsNullOrWhiteSpace</span><span>(</span>birthDateClaim<span>)</span><span>)</span>
        <span>{</span>
          context<span>.</span><span>Fail</span><span>(</span><span>&#34;The &#39;birthdate&#39; claim must be present in the ID token.&#34;</span><span>)</span><span>;</span>
        <span>}</span>
            
        <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
      <span>}</span>
    <span>}</span><span>;</span>
  <span>}</span><span>)</span>
<span>}</span></code></pre><p>As you can see, the ASP.NET Core Authentication SDK exposes the <code>OpenIdConnectEvents</code> option to let you handle the standard events triggered by the <code>Microsoft<span>.</span>AspNetCore<span>.</span>Authentication<span>.</span>OpenIdConnect</code> library. This way, you can combine the SDK simplicity with the standard library behavior to get the maximum flexibility.</p><h2 id="Summary">Summary</h2><p>Now you should have a clearer idea about the benefits you have by using the ASP.NET Core Authentication SDK to integrate Auth0 into your ASP.NET applications: less code, more readability, flexibility, and best practices inside. So, give a try to the SDK and integrate your <a href="https://auth0.com/docs/quickstart/webapp/aspnet-core" target="_blank" rel="noreferrer noopener">ASP.NET applications with Auth0 by following the QuickStart</a>. Check out <a href="https://auth0.github.io/auth0-aspnetcore-authentication/" target="_blank" rel="noreferrer noopener">the SDK documentation</a> to learn more.</p><p>You can also <a href="https://github.com/auth0/auth0-aspnetcore-authentication#contributing" target="_blank" rel="noreferrer noopener">contribute to it</a>: it&#39;s open-source!</p></div></div>]]></content:encoded>
      <pubDate>Fri, 15 Oct 2021 15:05:00 +0000</pubDate>
    </item>
    <item>
      <title>The Future of Healthcare Relies on Adaptation</title>
      <link>https://auth0.com/blog/the-future-of-healthcare-relies-on-adaptation/</link>
      <description>Interoperability, liberating patient data, and the identity lynchpin</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>The delivery of healthcare services has gone through an unprecedented transformation during the COVID-19 pandemic. COVID-19 has accelerated the move to a digital-forward model and elevated trends that were previously slow to be adopted. In addition, the final rule of the 21st Century Cures Act, effective June 30, 2020, implements provisions to ‚Äúadvance interoperability and support the access, exchange, and use of electronic health information‚Äù.</p><p>Technology leaders in the healthcare industry will drive positive business outcomes by continuing to innovate in ways that meet the demands of consumers while also meeting security compliance requirements. Healthcare companies have an opportunity to leverage the current momentum to capture more market share by providing cutting-edge, secure experiences for patients, providers, payers, and insurance companies.</p><h2 id="Consumer-Demands">Consumer Demands</h2><p>Consumer habits have permanently changed across industries over the past 18 months. Healthcare companies providing the best digital experiences will be the ones to attract consumers. In healthcare, consumers include the patients themselves, but could also be caregivers, parents, or patient representatives. Consumers are also the medical staff providing care. A digital experience that makes it easy to share data, retrieve lab results, check coverage, pay bills, etc. will make a big difference to all of these kinds of consumers. It‚Äôs likely that in healthcare, consumers will follow the best user experience, as they have in other industries.</p><p>A <a href="https://www.healthcaredive.com/news/convenience-more-important-to-patients-than-quality-of-care-survey-finds/545365/" target="_blank" rel="noreferrer noopener">survey</a> of healthcare consumers found that 51% said convenience and access to care are the most important factors in their decision-making. Convenience ranked above insurance coverage (46%), doctor/nurse conduct (44%), brand reputation (40%), and quality of care (35%). Healthcare companies that continue to require patients and providers to use antiquated and disconnected methods to share information with hospitals, specialists, and insurance companies will become less compelling, leading consumers to choose something else. The same applies to providers that stop offering telehealth options for patients. Although the personal experience of an in-person visit cannot be replicated via Zoom, most consumers and providers enjoy having the option when needed.</p><p>The intersection of factors such as COVID-19 driving the rise in telehealth services, consumer demand for improved digital access to healthcare data, and recent regulatory mandates creates a shifting technology landscape in healthcare.</p><h2 id="Enabling-Patient-Control-over-Data--Interoperability-with-SMART-on-FHIR">Enabling Patient Control over Data: Interoperability with SMART on FHIR</h2><p><a href="https://auth0.com/blog/what-smart-on-fhir-means-for-the-future-of-healthcare/" target="_blank" rel="noreferrer noopener">SMART on FHIR</a> is an API that facilitates the exchange of healthcare data. It is part of the 21st Century Cures Act certification requirements. SMART on FHIR is built on open standards including HL7‚Äôs FHIR, OAuth2, and OpenID Connect. Developers have the ability to write apps that will run anywhere in the healthcare system. The SMART on FHIR Patient Access API and Provider Directory API came into force on July 1, 2021. The Payer-to-Payer Data Exchange is applicable from January 1, 2022.</p><p>SMART on FHIR creates the potential for interoperability and will enable patients, providers, payers, and any other healthcare-related organizations to securely share information, giving patients control over their healthcare data. Patients will no longer have to request records and wait to have them mailed or picked up. Patient control over how and when information is shared will lead to a smoother experience for all parties.</p><h2 id="Unlocking-Interoperability--Identity-as-the-Key-to-the-Digital-Front-Door">Unlocking Interoperability: Identity as the Key to the Digital Front Door</h2><h3 id="ID-linking">ID linking</h3><p>Identity is the key to the digital front door for any healthcare transaction, and also provides the backbone to securely interconnecting systems. Many users have multiple identities that they use to log in to various applications. Frequently, patients will have to reenter credentials to access every application or portal. This approach is frustrating for patients and increases the risk of phishing attacks and other security breaches. The ability to link disparate identities through a common platform can reduce user friction and increase security.</p><p>Centralizing patient identity and providing a seamless SSO experience between all of those identities helps consumers reduce the number of login credentials they need to access their data. Each login attempt can be evaluated for malicious or risky behavior and properly blocked or logged. This protects the user, resources, and the applications or platforms they use. Using this approach creates a patient-focused ecosystem leading to better service and outcomes.</p><h3 id="Managing-identity">Managing identity</h3><p>Many healthcare companies have developed in-house custom solutions for managing identity and access to their applications. This traditional stovepiped approach worked when there were limited numbers of users and much of the data remained in-house. Custom solutions don‚Äôt easily scale or integrate with other systems. They also require a significant amount of maintenance and IT costs. This can lead to end-user friction in the form of multiple passwords to manage, an inconsistent experience, and a lack of adoption.</p><p>With these in-house solutions, organizations are also responsible for supporting end-users with account management activities, such as password reset and account recovery and handling costly help desk tickets. Poor identity management creates a poor user experience. Automating user account functions, such as signup, password reset, and self-enrollment in MFA greatly reduces friction and inefficiency.</p><h3 id="Data-security">Data security</h3><p>Securing patient data should be the top consideration for any solution, yet based on a recent <a href="https://marketing.rsvpportal.com/acton/attachment/3648/f-49df9907-d20f-4de6-87f4-ac7736211d20/1/-/-/-/-/Okta_Healthcare_Pulse_Survey_Whitepaper.pdf?sid=TV2:fx7gELoz4" target="_blank" rel="noreferrer noopener">survey</a> of 100 healthcare executives, speed was prioritized over security with the move to telehealth during COVID-19. Even more worryingly, 95% of these leaders admitted that confidential patient records are only secured with a password. Providing built-in security features, such as multi-factor authentication, bot detection, breached password detection, suspicious IP throttling, and brute force detection can significantly increase the security posture of protecting critical data. Cyber attacks are increasingly common, and the cost of a breach can be devastating. In addition, new security threats are constantly exposed.</p><h3 id="Secure-identity-and-focus-on-core-competencies">Secure identity and focus on core competencies</h3><p>Most healthcare organizations are and should be, focused on their core business pursuits, such as patient care or processing insurance claims. Information security and identity management is not their core business, yet is a critical factor in compliant, secure business operations. Focusing on core competencies while ensuring secure identity management doesn‚Äôt mean giving up control of identity management but instead places the responsibility for the technical aspects of identity building and protection in the hands of experts who work with identity every day.</p><p>Identity and security are complex and require a particular skill set to ensure that data is properly handled and protected. As the industry moves to meet the compliance requirements for interoperability, this leaves the systems dependent on each other to properly secure and protect user data, including usernames and passwords. Choosing an identity provider that focuses on security as their core business can greatly reduce the burden and risk for healthcare companies.</p><p>Auth0 has helped many healthcare customers provide their users with a highly customized, secure, seamless user experience while driving down costs and reducing risk. To learn more, <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">reach out to the team at Auth0</a>.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 14 Oct 2021 14:41:00 +0000</pubDate>
    </item>
    <item>
      <title>Okta + Auth0 Showcase 2021: Identity for All</title>
      <link>https://auth0.com/blog/okta-auth0-showcase-2021-identity-for-all/</link>
      <description>CEOs Todd McKinnon and Eugenio Pace highlight the exciting opportunities ahead for the combined company</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Today, we‚Äôre bringing you Okta‚Äôs third <a href="https://www.okta.com/showcase/" target="_blank" rel="noreferrer noopener"><strong>Showcase</strong></a>, joining forces virtually with teammates, customers, and partners from around the world for our annual fall event that provides an inside look at how the company is innovating. </p><p>This year, it‚Äôs not just Okta taking the stage: it‚Äôs <strong>Okta + Auth0</strong>. Six months ago, we officially embarked on a mission to join our two companies and lead together in the customer identity and access management (CIAM) market with our shared worldview for a neutral, independent identity cloud. While we came from very different backgrounds, we both built our companies to innovate on identity from the ground up and prioritize customer success‚Äîso we connect on helping customers drive outcomes that matter most to them. Our cultures are strongly aligned with a strong focus on transparency and innovation, all with trust at the center. </p><p>Since the acquisition closed in May, we‚Äôve learned so much about our teams, companies, and technology. This partnership (eight years in the making!) has exceeded expectations beyond what we‚Äôve imagined and has reinforced our commitment to continue investing in both platforms. We‚Äôve invited both teams here today to share our joint story of growth, momentum, and strategy in the CIAM market. </p><h2 id="The-World-Is-Shifting-to-Identity-First">The World Is Shifting to Identity-First</h2><p>It has become clear that the role of identity in the world has evolved, and we‚Äôre here to address that shift. Together, Okta and Auth0 are reimagining identity‚Äôs role in every organization‚Äôs technology strategy. Cloud, mobile, and Bring Your Own Device (BYOD) have transformed the dynamics of the digital world over the past decade. At the same time, IT is struggling to keep up with all of these changes, and developers are more burdened than ever to build more applications quickly and without sacrificing security and user experience. Identity is the perimeter, and it‚Äôs at the heart of every technology choice and transformation. Governments globally are shifting to identity-first through initiatives like MFA mandates with Zero Trust security architecture. Customer experiences must be identity-first as companies rush to secure platforms and provide seamless, personalized experiences amidst a growing number of data breaches in the wake of the pandemic. </p><p>This Showcase, we‚Äôre thrilled to introduce product innovation and joint momentum on the heels of the acquisition‚Äîall with the goal of helping organizations thrive in an identity-first world.</p><h2 id="Adopting-an-Identity-First-Strategy-with-Okta---Auth0">Adopting an Identity-First Strategy with Okta + Auth0</h2><p>The digital world is heterogeneous: we all work across multiple stacks, many clouds, and myriad applications. Digital experiences are connecting more companies, customers, and employees than ever before. Okta understands this need to connect. Through the <a href="https://www.okta.com/okta-integration-network/" target="_blank" rel="noreferrer noopener">Okta Integration Network</a>, we have the broadest and deepest set of independent and neutral integrations to securely connect to everything. And through our Workflows technology, we empower companies to weave the best employee and customer experience throughout those integrations and applications.</p><p>Okta Workflows is the key to simplifying and automating identity processes in an identity-first world at scale. We first introduced this technology to customers with democratization at the heart. Democratizing identity means providing everyone with the choice of tools and technology needed to harness it. Today we‚Äôre excited to announce <strong>Workflows for Any Identity Use Case</strong>, meaning our identity automation and orchestration solution is now available as a standalone product for all customers, including a no-cost option for up to five flows. We really mean anyone: anyone at any company, development or non-development teams alike, can now leverage the power and extensibility of identity in a low or no-code user interface. </p><p>What‚Äôs more, we‚Äôre also introducing new connectors, including Jamf, Microsoft Teams, ITSM (FreshService), and alert management (OpsGenie), along with new templates such as app access requests with Slack. Okta Workflows helps customers solve highly complex use cases and now enables even more innovation to happen more securely and faster. </p><p>We are also announcing the availability of the <strong>Auth0 Identity Platform on Microsoft Azure</strong>, offering customers the ability to choose Azure as a private cloud deployment option from Auth0. This addition provides customers with another secure cloud deployment option that better aligns with their technology stack and supports regional data residency needs, unlocking a comprehensive CIAM solution for organizations in regions where Azure has a larger infrastructure presence. Ultimately, more flexibility means more ways to deploy identity in the way that works best for each business. </p><h2 id="Accelerating-Momentum---Innovation-in-the-CIAM-Market">Accelerating Momentum &amp; Innovation in the CIAM Market</h2><p>Every company connecting directly with customers must manage customer identities and the massive volumes of data and insight accompanying them. An identity-first, CX strategy is critical in a world where businesses feel increased urgency around digital transformation, security threats, and growing user experience demands.</p><p>As a joint Okta + Auth0 team, we can better meet the demands of a fast-growing CIAM market. When we look closely inside our customers‚Äô technology environments, we see a wide range of situations‚Äîsome are digital natives, others are building their first apps to connect with customers. While some live fully in the cloud, others choose a hybrid model, and some still manage massive legacy on-premises deployments. It‚Äôs within this diversity of technology environments that we see the biggest opportunity to make a difference.</p><p>To further our offerings in this space, we‚Äôre rolling out new CIAM capabilities across Okta‚Äôs CIAM offering, including <strong>Device Authorization Grant, Branding</strong>, and <strong>Custom Administration Roles</strong> to deliver universal customization from internal management and compliance to devices and customer-facing applications. These features address critical pain points across IT, security, and engineering when implementing identity and are rooted in choice and extensibility. Together, Okta and Auth0 now enable end-to-end customer journeys and address every use case imaginable, driving better digital customer experiences. </p><p>With our combined company, we have one vision for identity. We‚Äôre ready to create solutions for all, offering more opportunities for current and future customers. The world now is identity-first; it ensures our environments are kept safe and secure and that every digital experience fits each customer‚Äôs needs. We‚Äôre just at the beginning of our journey together‚Äîwe can‚Äôt wait to see what the future holds.</p><p>If you missed the live event, you can watch the <a href="https://www.okta.com/showcase/" target="_blank" rel="noreferrer noopener"><strong>on-demand content</strong></a> beginning on October 14.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Wed, 13 Oct 2021 15:42:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Identity Platform Now Available on Microsoft Azure</title>
      <link>https://auth0.com/blog/auth0-identity-platform-now-available-on-microsoft-azure/</link>
      <description>New private cloud deployment option offers customers greater choice, scalability, and reliability</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><section itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="mainEntity"><header><div><div><p><span>Azure</span></p><p itemprop="description">New private cloud deployment option offers customers greater choice, scalability, and reliability</p></div><p>October 13, 2021</p><meta itemprop="datePublished" content="2021-10-13"/><meta itemprop="dateModified" content="2021-10-13"/></div></header><header><div><p><img src="https://images.ctfassets.net/23aumh6u8s0i/48HABlVaavxkvSpCEpgHdZ/f9de8b608b229dda310c5296187890f4/Announcements3.png"/></p><div><p><span>Azure</span></p><p itemprop="description">New private cloud deployment option offers customers greater choice, scalability, and reliability</p><p>October 13, 2021</p><meta itemprop="datePublished" content="2021-10-13"/><meta itemprop="dateModified" content="2021-10-13"/></div></div></header><article><main id="post-content" itemprop="articleBody"><div><p><strong>BELLEVUE, Wash. ‚Äì Oct. 13, 2021 ‚Äì</strong> The <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Identity Platform</a>, a product unit within Okta (NASDAQ: OKTA), today announced the launch of the <a href="https://auth0.com/cloud/azure" target="_blank" rel="noreferrer noopener">Auth0 Identity Platform on Microsoft Azure</a>. The launch gives customers the ability to choose Azure as their cloud deployment option from Auth0. The addition of Azure as an Auth0 private cloud platform option unlocks a secure cloud deployment option for organizations seeking strategic fit with their technology stack, supporting regional data residency capabilities and higher control over customer data.</p><p>Today, organizations moving to the cloud and selecting a <a href="https://auth0.com/blog/what-is-ciam/" target="_blank" rel="noreferrer noopener">Customer Identity and Access Management (CIAM)</a> solution require significant control over sensitive customer data and may require local data residency capabilities. They often have to make a hard choice of selecting either a CIAM solution that supports their product differentiation goals or one that meets their technical requirements and regulatory needs. Auth0‚Äôs modern identity platform eliminates the need to choose by providing organizations with tools designed to support security, compliance, and data residency needs that may apply to them across multiple regions globally. The platform‚Äôs design can accelerate their time to value and go-to-market strategies to meet their long-term growth goals. </p><p>Key benefits of the Auth0 Identity Platform on Azure include:</p><ul><li><strong>Technology Stack Alignment:</strong> Organizations have the flexibility to choose Azure as their preferred cloud vendor for greater technology stack alignment with existing investments in Azure.</li><li><strong>Data Residency:</strong> Improved data residency capabilities for Auth0 customers with Azure‚Äôs widespread geographic infrastructure.</li><li><strong>Streamlined Experience with Private Cloud:</strong> A modern, cloud-native platform built with a focus on security and compliance at every level. Organizations requiring data residency options can take advantage of periodic feature updates while maintaining control over the timing and the ability to roll back without the hassle of having to maintain them ‚Äî resulting in faster time to market and a more seamless experience for organizations and their customers.</li></ul><p>‚ÄúAs more applications move to the cloud and expand globally, organizations depend on their identity service to protect and manage access for their most critical users, applications, and data,‚Äù said Shiv Ramji, Chief Product Officer at Auth0. ‚ÄúThe Auth0 Identity Platform on Azure can help unlock a secure and compliant cloud deployment experience for organizations seeking support across CIAM use cases. This is especially true for organizations in industries like retail or financial services where selecting vendors that are not competitive to their business is top priority, organizations operating in regions where certain cloud providers have higher geographic availability, and those that have existing technology investments in Azure.‚Äù</p><p>‚ÄúCompanies like Auth0 add value by integrating their solutions with Microsoft Azure,‚Äù said Mandana Javaheri, Global Senior Director, SCI Business Development at Microsoft Corp. ‚ÄúWith Azure, Auth0 customers have ultimate performance capabilities and control over their environment without the hassle of maintaining it, allowing customers to focus more on their core business proposition.‚Äù</p><p>More detailed information on the Auth0 Identity Platform on Azure can be found on <a href="https://auth0.com/blog/auth0-on-microsoft-azure-as-a-private-cloud-deployment-option" target="_blank" rel="noreferrer noopener">Auth0‚Äôs blog</a>. Auth0 will discuss this offering in greater detail with Okta at Showcase21 taking place today, Oct. 13, 2021. To learn more, visit: <a href="https://www.okta.com/showcase/register" target="_blank" rel="noreferrer noopener">https://www.okta.com/showcase/register</a>  </p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h3 id="Media-Contacts-">Media Contacts:</h3><p>Global Communications<br/>Auth0<br/><a href="mailto:press@auth0.com" target="_blank" rel="noreferrer noopener">press@auth0.com</a><br/></p><p>Matter Communications for Auth0<br/><a href="mailto:auth0@matternow.com" target="_blank" rel="noreferrer noopener">auth0@matternow.com</a><br/></p><h3 id="Investor-Contact-">Investor Contact:</h3><p>Investor Relations<br/><a href="mailto:investor@okta.com" target="_blank" rel="noreferrer noopener">investor@okta.com</a><br/></p></div></main></article></section></div>]]></content:encoded>
      <pubDate>Wed, 13 Oct 2021 12:48:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Identity Platform Now Available on Microsoft Azure</title>
      <link>https://auth0.com/blog/auth0-on-microsoft-azure-as-a-private-cloud-deployment-option/</link>
      <description>Take advantage of cloud provider flexibility, data residency options, and a streamlined experience for your identity needs with a private cloud deployment</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>We‚Äôre excited to announce the availability<a href="#1"><sup>1</sup></a> of Auth0 <strong>Identity Platform</strong> as a private cloud deployment option <strong>on <a href="https://auth0.com/cloud/azure" target="_blank" rel="noreferrer noopener">Microsoft Azure</a></strong>. </p><p>Auth0 is an Identity-as-a-Service platform that eliminates the complexity of implementing authentication and authorization capabilities by providing easy-to-use APIs (application programming interfaces) that you can use in a variety of applications. It processes billions of login transactions each month across thousands of customers, ensuring that end-users get a secure, fast and seamless login experience within their applications.</p><p>Auth0‚Äôs capabilities are available in two deployment options ‚Äî public cloud and private cloud. Public cloud is a multi-tenant SaaS application available in four regions (United States, Europe, Japan, and Australia), <strong>used by companies of all sizes</strong>. Alternatively, a private cloud deployment provides Auth0‚Äôs comprehensive CIAM capabilities to enterprises who want dedicated resources. </p><h2 id="The-Benefits-of-Auth0-on-Azure">The Benefits of Auth0 on Azure</h2><p>Microsoft Azure is an industry-leading cloud computing provider, offering hundreds of products and services used by developers and organizations around the world. With this release, Auth0 customers now have the flexibility to choose Azure (in addition to AWS) as the target cloud for their private cloud deployment.</p><p>Some of the key reasons for customers to choose Auth0 on Azure for their private cloud deployment are:</p><h3 id="Data-Residency-and-Compliance">Data Residency and Compliance</h3><p>Azure offers <a href="https://azure.microsoft.com/en-us/global-infrastructure/geographies/#overview" target="_blank" rel="noreferrer noopener">over 60 regions</a> worldwide, and has plans to continue <a href="https://azure.microsoft.com/en-us/global-infrastructure/geographies/#new-regions" target="_blank" rel="noreferrer noopener">expanding</a> worldwide. This global coverage lets Auth0 meet your data residency and other regulatory compliance requirements by offering greater choice when planning deployments.</p><h3 id="Microsoft-Ecosystem-and-Security">Microsoft Ecosystem and Security</h3><p>Many customers prefer to pick a SaaS vendor deployed in the same cloud as their core applications. This is due to a number of considerations, including security or performance. Azure Private Link reduces latency between Auth0 and the customer‚Äôs applications. This also gives a choice to customers that have an internal strategic requirement to pick one cloud over another.</p><h2 id="How-We-Evolved-our-Platform">How We Evolved our Platform</h2><p>Adding support for Microsoft Azure meant that we had an opportunity to improve our technology stack and development processes. As part of this effort, we focused on improving the resilience, reliability, and customer experience provided by the platform.</p><p>The private cloud support of Azure is built on top of a modern, cloud-native platform that is also compatible with AWS. As well as providing a number of internal benefits due to standardization and automation, here are some of the additional highlights for customers:</p><h3 id="Fully-Automated-Environment-Creation-and-Management">Fully Automated Environment Creation and Management</h3><p>Creating a new environment is now fully automated. Behind the scenes, we use cutting-edge automation tools to kick off environment provisioning. This ensures all environments are represented as code and are immutable. A host of flexible, scalable, and cloud-independent services are used as part of the technology stack.</p><h3 id="High-Availability-and-Disaster-Recovery">High Availability and Disaster Recovery</h3><p>Similar to our existing AWS deployment option, all Azure deployment service components are deployed in a highly-available, three Availability Zones (AZ) configuration. If an AZ is affected as a result of an incident, services automatically reorganize their workload on the remaining AZs within the same region. In addition to HA, all customer data is backed up at a regular cadence, backups are encrypted at rest and in transit, and there is an option to restore a customer‚Äôs environment from the last backup.</p><h3 id="Security-first-Architecture--Shifting-Left">Security-first Architecture: Shifting Left</h3><p>As we developed the Auth0 Identity Platform for Microsoft Azure, we emphasized ‚Äúshift-left‚Äù principles, focussing on building a strong security architecture at the start of the development cycle. We established a dedicated Azure AD tenant and automated governance controls to ensure resource and identity isolation, required MFA and Azure PIM for privileged access, and enforced security standards with Azure Policy. Prioritizing security in the early stages of the development process is part of our secure by design strategy to mitigate risk and keep customers safe from cyber threats.</p><h3 id="Automated--Periodic-Release-Updates--and-Roll-back-Option">Automated, Periodic Release Updates, and Roll-back Option</h3><p>With this modern platform, we will now ship smaller, weekly releases that automatically deploy to private cloud environments. Additionally, the private cloud platform provides the ability to schedule deployments and roll back specific versions within predefined time windows, enabling greater control over the software delivery process.</p><p>With this launch, customers have the option of choosing a comprehensive CIAM solution on Azure, built on a technology stack geared for resilience, reliance, and security. Learn more about Auth0 Identity Platform on Azure<a href="https://auth0.com/contact-us?place=header&amp;type=button&amp;text=contact%20sales" target="_blank" rel="noreferrer noopener"> here</a>.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div>
</div></div>]]></content:encoded>
      <pubDate>Wed, 13 Oct 2021 10:31:00 +0000</pubDate>
    </item>
    <item>
      <title>Configuring PostgreSQL as Auth0 Custom Database</title>
      <link>https://auth0.com/blog/configuring-postgresql-as-auth0-custom-database/</link>
      <description>Connect Auth0 to PostgreSQL to create and maintain your own user store.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>You can use Auth0 to create and maintain your own user store while also providing a secure authentication system on top of it. Auth0 lets you store users in your own database. Furthermore, Auth0 uses <a href="https://oauth.net/2/" target="_blank" rel="noreferrer noopener">OAuth 2.0</a> as an authorization framework with which you can be confident in terms of security. Using a custom database as a user store in Auth0 facilitates <a href="https://auth0.com/docs/users/import-and-export-users" target="_blank" rel="noreferrer noopener">user migration</a> and adds an OAuth and <a href="https://openid.net/connect/" target="_blank" rel="noreferrer noopener">OpenID Connect</a> layer to your existing user database. You can configure any database or web service, including ASP.NET Membership Provider, MongoDB, MySQL, PostgreSQL, as an Auth0 custom database. In this article, you will learn how to set up PostgreSQL as a custom database for Auth0.</p><blockquote><p><strong>Limited Access:</strong> Some features are available depending on your Auth0 subscription. For more information, see <a href="https://auth0.com/pricing" target="_blank" rel="noreferrer noopener">Auth0 pricing plans</a>.</p></blockquote><h2 id="Enabling-Custom-Databases">Enabling Custom Databases</h2><p>Don&#39;t already have an Auth0 account yet? <a href="https://auth0.com/signup/" target="_blank" rel="noreferrer noopener">Sign up for free right now!</a></p><p>Once you <a href="https://auth0.com/auth/login" target="_blank" rel="noreferrer noopener">log in</a>, navigate to the <a href="https://manage.auth0.com/#/connections/database" target="_blank" rel="noreferrer noopener">Database connections page</a> (Auth0 Dashboard &gt; Authentication &gt; Database). Click on the <strong>Create DB Connection</strong> button, give your database a nice name, and click the <strong>Create</strong> button. Go to the <strong>Custom Database</strong> tab and enable <strong>Use my own database</strong> to configure the custom database.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/OGyNXnaAOAwmDmJeSS29o/f2462f845f94aba70a41caac89f0d495/01_8enable-custom-database.png" alt="Enabling &#39;use my own database&#39; on custom database tab of Auth0 interface"/></p><p>Auth0 uses Node.js scripts, called Action Scripts, for connecting and accessing your database. These scripts include JavaScript functions that allow you to execute a variety of tasks such as adding a new user, logging in a user, and so on. You should define <strong>Custom Database Action Scripts</strong> to perform the following actions:</p><ul><li>Create: The <strong>Create</strong> script inserts a new user with <code>email</code> and <code>password</code> into your PostgreSQL database.</li><li>Login: The <strong>Login</strong> script verifies the identity of the user in your PostgreSQL database whenever a user needs to authenticate.</li><li>Verify: The <strong>Verify</strong> script updates the verification status of a user&#39;s email address in your database.</li><li>Change Password: The <strong>Change Password</strong> script modifies the password for the user&#39;s email address. It changes the user&#39;s password in the database for future logins (forgot password functionality).</li><li>Get User: The <strong>Get User</strong> script retrieves a specified user&#39;s information from your database. It returns <code><span>undefined</span></code> if the user is not present in your database.</li><li>Delete: The <strong>Delete</strong> script removes the specified user identity from your database.</li></ul><p>Fortunately, Auth0 provides templates for these custom database scripts. You can use the template and update the <strong>connection string</strong> with your database URL. Refer to the <a href="https://auth0.com/docs/connections/database/custom-db/templates" target="_blank" rel="noreferrer noopener">official documentation</a> for additional information on Auth0 custom database action scripts. Let&#39;s start by creating a PostgreSQL database to connect with Auth0.</p><h2 id="Setting-up-a-PostgreSQL-Database">Setting up a PostgreSQL Database</h2><p>You cannot use the database in your local environment. You should make your database accessible via the internet or use tools like <a href="https://www.ibm.com/cloud/learn/dbaas" target="_blank" rel="noreferrer noopener">Database as A Service</a>. In this tutorial, I&#39;ll use <a href="https://www.elephantsql.com/" target="_blank" rel="noreferrer noopener">ElephantSQL</a>, which offers a fully configured and cloud-hosted PostgreSQL database in few minutes. However, it does not display any data inside your database; instead, you can run SQL commands to show your data. You can design your own database and host it on any cloud provider like <a href="https://aws.amazon.com/rds/postgresql/" target="_blank" rel="noreferrer noopener">AWS</a>, <a href="https://cloud.google.com/sql/docs/postgres/quickstart" target="_blank" rel="noreferrer noopener">Google Cloud</a> or <a href="https://devcenter.heroku.com/articles/heroku-postgresql" target="_blank" rel="noreferrer noopener">Heroku</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/67kI5tanFdPenloG7UPWmo/a9901332759fdf407562eedfefce6f0a/02_5elephant-sql.png" alt="Elephant sql home page"/></p><p>Head over to <a href="https://www.elephantsql.com/" target="_blank" rel="noreferrer noopener">https://www.elephantsql.com/</a> and create an account for yourself or log in if you already have one. It takes you to the dashboard page; Click on the <strong>Create New Instance</strong> to create a new database instance. Give a suitable name to your database instance and choose a plan and a region. I&#39;ll use the free plan for demonstration purposes. Configure the database to meet your requirements, then click <strong>Create instance</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2KypO18fJdOwAUAUzAvEaI/f0637c4914da6ed6c106f203bf1651a2/03_0create-new-instance.png" alt="Elephantsql create instance confirmation page"/></p><p>If you encounter any error in creating an instance, refer to the <a href="https://www.elephantsql.com/docs/" target="_blank" rel="noreferrer noopener">ElephantSQL documentation</a> for troubleshooting.</p><p>Now, navigate to the freshly created database instance and copy the <strong>URL</strong> from the details page. You&#39;ll need this to connect your Auth0 application to this database. Anyone can access your database with this connection string. It would help if you were to keep it very secret for security purposes.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6ygHuLT6dz2nL3E7rLGprV/5ac2748f274fec16755aa97402506126/04_9instance-details.png" alt="Click on show button and copy the &#39;URL&#39; on the ElephantSQL instance details page"/></p><p><strong>PS:</strong> Auth0 provides several IP addresses to configure your database network connections if you&#39;re using a firewall. You can find them under the action scripts.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7z4pzq4dETiiHaHk3hUY1T/8e22ded36e15b4eaffa7588d65ed30a3/05_3database-ips.png" alt="List of IP addresses under action scripts"/></p><blockquote><p><strong>Note:</strong> Using your own database leads to several security concerns. Allowing your database accessible over the internet without any firewalls or security measures may result in data leakage.</p></blockquote><h2 id="Creating-a-Table-for-Storing-Users">Creating a Table for Storing Users</h2><p>Switch to the <strong>Browser</strong> tab and execute the following command.</p><pre><code><span>CREATE</span> <span>TABLE</span> users<span>(</span>
    id UUID <span>DEFAULT</span> uuid_generate_v4<span>(</span><span>)</span><span>,</span>
    nickname <span>VARCHAR</span><span>(</span><span>255</span><span>)</span><span>,</span>
    email <span>VARCHAR</span><span>(</span><span>255</span><span>)</span> <span>NOT</span> <span>NULL</span> <span>UNIQUE</span><span>,</span>
    password <span>VARCHAR</span><span>(</span><span>255</span><span>)</span> <span>NOT</span> <span>NULL</span><span>,</span>
    email_Verified <span>BOOLEAN</span> <span>DEFAULT</span> <span>FALSE</span>
<span>)</span><span>;</span></code></pre><p><img src="https://images.ctfassets.net/23aumh6u8s0i/57cmWLADlzyKQcMgIj7hVk/f4758d8ccdc9bcc214b9b30da842b2fe/06_1create-table.png" alt="creating a new table using SQL command in SQL Browser"/></p><p>The above command creates a new table called <code>users</code> to store the user information from Auth0. You need at least the above five columns to save and validate the user identity.</p><h2 id="Defining-the-Auth0-Custom-Database-Scripts">Defining the Auth0 Custom Database Scripts</h2><p>Open the custom database tab in the Auth0 interface and navigate to the <strong>Database Action Scripts</strong> section. Select a script (say <em>Login</em>) to edit and choose <strong>PostgreSQL</strong> from the templates drop-down. To connect your database to Auth0, you should add the connection string (<code>conString</code>) of your database in the action scripts.</p><p>Scroll down a little to the <strong>Database Settings</strong> under the Action scripts section. Add the database URL you copied from your ElephantSQL as an environment variable (to keep it as a secret).</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/qkAAeUkyauInLsJYqqGZw/fdddd502f0dbf1048d40bf47c3526c56/07_4database-settings.png" alt="Adding the database URL as an env variable &#39;POSTGRES_URL&#39; settings section"/></p><p>Now, update the <code>conString</code> in your action scripts with this value.</p><pre><code><span><span>-</span><span> const conString = &#39;postgres://user:pass@localhost/mydb&#39;;
</span></span><span><span>+</span><span> const conString = configuration.POSTGRES_URL;</span></span></code></pre><p>Remember to add the connection string in every database action script, and that&#39;s all! Now you can click on <strong>Save and Try</strong> button to test your database.</p><blockquote><p><strong>Note:</strong> You can also link an existing user database to Auth0. You should modify some code in the action scripts to match your database configuration.</p></blockquote><h2 id="Testing-the-Database">Testing the Database</h2><p>First, try creating a user in the database using <strong>Create</strong> script.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7EZTXGBq7Yks8RnklmrcfP/66a3c8c9c4c6c2dcffc6c61c456116ec/08_2create-user.png" alt="user created successfully after trying the custom create script"/></p><p>You can find the user in your database. Open the <strong>SQL Browser</strong> in ElephantSQL and run the following command. It retrieves the first 100 records from the database containing information about the users.</p><pre><code><span>SELECT</span> <span>*</span> <span>FROM</span> <span>&#34;public&#34;</span><span>.</span><span>&#34;users&#34;</span> <span>LIMIT</span> <span>100</span></code></pre><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2OEtiruBOBch1KQuxrJxlm/6c799eba9dcd0693d2f08a9e89259b52/09_7elephantsql-users.png" alt="database rows will be displayed on the browser tab after executing the above command"/></p><p>Similarly, login, validate your email and delete the user. For deleting a user, you should use the unique id of the specific user. Test all the scripts and use this database in applications that you create on the Auth0 dashboard. You can select to use this database on <strong>Connections</strong> tab in your application. If you experience any problem through the whole process, reach out to the <a href="https://community.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 community</a> for assistance.</p><h2 id="Conclusion">Conclusion</h2><p>In this article, you learned how to set up your PostgreSQL database as an Auth0 custom database. Even if you have a different type of database, you can easily connect to Auth0 using the templates provided. In this tutorial, you merely changed the Auth0 templates. Modify the action scripts accordingly if you need to keep more information about the user or want to configure the already existing user store as Auth0 custom database. </p><p>Using a custom database introduces several security issues as well as additional configuration work. You should keep your database in a secure cloud to prevent data leakage. You can rely on Auth0 if you don&#39;t want to put in any extra effort. It saves your users&#39; information in very secure databases (<a href="https://auth0.com/blog/how-we-store-data-in-the-cloud-at-auth0/" target="_blank" rel="noreferrer noopener">see how Auth0 stores data?</a>).</p></div></div>]]></content:encoded>
      <pubDate>Tue, 12 Oct 2021 14:55:00 +0000</pubDate>
    </item>
    <item>
      <title>Build and Secure a FastAPI Server with Auth0</title>
      <link>https://auth0.com/blog/build-and-secure-fastapi-server-with-auth0/</link>
      <description>Learn the basics of FastAPI, how to quickly set up a server and secure endpoints with Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>FastAPI is a relatively new Python framework that enables you to create applications very quickly. This framework allows you to read API request data seamlessly with built-in modules and is a lightweight alternative to Flask.</p><p>In this article, we will go over the features of <code>FastAPI</code>, set up a basic API, protect an endpoint using Auth0, and you&#39;ll learn how simple it is to get started.</p><p>Before we get started, you can also check out the contents of this blog post in video format by playing the video below: üëá</p>
<p><iframe src="https://www.youtube.com/embed/gkkDP_SVxyk" frameborder="0" allowfullscreen=""></iframe></p><h2 id="Prerequisites">Prerequisites</h2><p>Before you start building with <a href="https://fastapi.tiangolo.com/" target="_blank" rel="noreferrer noopener">FastAPI</a>, you need to have Python <code><span>3.8</span><span>.2</span></code> and a <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">free Auth0 account; you can sign up here</a>.</p><p>If you got that Python version installed and your Auth0 account, you can create a new <code>FastAPI</code> application. To begin, create a new directory to develop within. For this example, you will make a directory called <code>fastapi<span>-</span>example</code> and a subfolder called <code>application</code>; this subfolder is where your code will live.</p><p>In the <code>fastapi<span>-</span>example</code> folder, create a virtual environment using the following command:</p><pre><code>python3 -m venv .env</code></pre><p>This creates a virtual environment, and it separates the dependencies from the rest of your computer libraries. In other words, you don&#39;t pollute the global namespace with libraries and dependencies, which might impact other Python projects.</p><p>After creating the virtual environment, you need to activate it. For Unix-based operating systems, here&#39;s the command:</p><pre><code><span>source</span> .env/bin/activate</code></pre><p>If you are in another operating system, you can find a list of <a href="https://docs.python.org/3/library/venv.html#creating-virtual-environments" target="_blank" rel="noreferrer noopener">how you can activate an environment on this documentation page</a>. After activating your virtual environment, you can install the packages you are going to use: <code>FastAPI</code>, <a href="https://www.uvicorn.org/" target="_blank" rel="noreferrer noopener">uvicorn</a> server, <a href="https://pyjwt.readthedocs.io/en/latest/usage.html" target="_blank" rel="noreferrer noopener">pyjwt</a>, and update <code>pip</code>:</p><pre><code>pip <span>install</span> -U pip
pip <span>install</span> fastapi uvicorn <span>&#39;pyjwt[crypto]&#39;</span></code></pre><h2 id="Get-Started-with-FastAPI">Get Started with FastAPI</h2><p>Now that all the libraries are installed, you can create a <code>main<span>.</span>py</code> file inside the <code>application</code> folder; that&#39;s where your API code will live. The contents of the <code>main<span>.</span>py</code> will look like this:</p><pre><code><span>&#34;&#34;&#34;main.py
Python FastAPI Auth0 integration example
&#34;&#34;&#34;</span>
 
<span>from</span> fastapi <span>import</span> FastAPI
<span># Creates app instance</span>
app <span>=</span> FastAPI<span>(</span><span>)</span>
 
 
<span>@app<span>.</span>get</span><span>(</span><span>&#34;/api/public&#34;</span><span>)</span>
<span>def</span> <span>public</span><span>(</span><span>)</span><span>:</span>
    <span>&#34;&#34;&#34;No access token required to access this route&#34;&#34;&#34;</span>

    result <span>=</span> <span>{</span>
        <span>&#34;status&#34;</span><span>:</span> <span>&#34;success&#34;</span><span>,</span>
        <span>&#34;msg&#34;</span><span>:</span> <span>(</span><span>&#34;Hello from a public endpoint! You don&#39;t need to be &#34;</span>
                <span>&#34;authenticated to see this.&#34;</span><span>)</span>
    <span>}</span>
    <span>return</span> result</code></pre><p>Let&#39;s break this down:
 - To start, you are importing the <code>FastAPI</code> library;
 - Then creating your app by instantiating a <code><span>FastAPI</span><span>(</span><span>)</span></code> object;
 - After that, you use <code>@app<span>.</span>get</code> to define a route that handles <code><span>GET</span></code> requests;
 - Finally, you have the path operation function called <code><span>public</span><span>(</span><span>)</span></code>, which is a function that will run each time that route is called, and it returns a dictionary with the welcome message.</p><p>Now that you&#39;ve got your first endpoint code, to get the server up and running, run the following command on the root directory of the project:</p><pre><code>uvicorn application.main:app --reload</code></pre><p>With your server is running, you can go either to <a href="http://127.0.0.1:8000/docs" target="_blank" rel="noreferrer noopener">http://127.0.0.1:8000/docs</a> to see the automatically generated documentation for the first endpoint like shown in the image below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3fE3ngkaleHJw78ZNzQway/24719642235593cbf2016b4b86f38c54/Screen_Shot_2021-10-04_at_09.55.16.png" alt="FastAPI documentation page showing the public endpoint"/></p><p>Or you can make your first request in a new terminal window by using <code>cURL</code>. Keep in mind that if you are a Windows user on an older version of the operating system, you will have to <a href="https://curl.se/dlwiz/?type=bin" target="_blank" rel="noreferrer noopener">install curl</a> before running the following command:</p><pre><code><span>curl</span> -X <span>&#39;GET&#39;</span> <span>\</span>
  --url http://127.0.0.1:8000/api/public</code></pre><p>And you should see a JSON as a result of the request you just did similar to this:</p><pre><code><span>{</span>
  <span>&#34;status&#34;</span><span>:</span> <span>&#34;success&#34;</span><span>,</span>
  <span>&#34;msg&#34;</span><span>:</span> <span>&#34;Hello from a public endpoint! You don&#39;t need to be authenticated to see this.&#34;</span>
<span>}</span></code></pre><p>For simplicity&#39;s sake, you are going to use the <code>cURL</code> for the rest of this post.</p><h2 id="Create-a-Private-Endpoint">Create a Private Endpoint</h2><p>Now that a base API server is set up, you will add one more endpoint to your <code>main<span>.</span>py</code> file. In this application, you will have a <code><span>GET</span> <span>/</span>api<span>/</span><span>public</span></code> route available for everyone and a <code><span>GET</span> <span>/</span>api<span>/</span><span>private</span></code> route that only you can access with the access token you&#39;ll get from Auth0.</p><p>Now you need to update the <code>main<span>.</span>py</code> file. Here&#39;s what you&#39;ll need to change to the imports section:</p><ul><li>First, you need to import <code>Depends</code> from the <code>fastapi</code> module, that&#39;s FastAPI dependency injection system;</li><li>Then, you&#39;ll also need to import the <code>HTTPBearer</code> class from the <code>fastapi<span>.</span>security</code> module, a built-in security scheme for authorization headers with bearer tokens;</li><li>You will need to create the authorization scheme based on the <code>HTTPBearer</code>. This will be used to guarantee the presence of the authorization header with the <code>Bearer</code> token in each request made to the private endpoint.</li></ul><blockquote><p>The <a href="https://auth0.com/docs/security/tokens/access-tokens" target="_blank" rel="noreferrer noopener">token informs the API that the bearer of the token</a> has been authorized to access the API and perform specific actions specified by the scope that was granted during authorization.</p></blockquote><p>Other than updating the imports, you need to implement the private endpoint. The <code><span>/</span>api<span>/</span><span>private</span></code> endpoint will also accept <code><span>GET</span></code> requests, and here is what the code <code>main<span>.</span>py</code> looks like for now:</p><pre><code><span>&#34;&#34;&#34;main.py
Python FastAPI Auth0 integration example
&#34;&#34;&#34;</span>
 
<span>from</span> fastapi <span>import</span> Depends<span>,</span> FastAPI  <span># üëà new imports</span>
<span>from</span> fastapi<span>.</span>security <span>import</span> HTTPBearer  <span># üëà new imports</span>


<span># Scheme for the Authorization header</span>
token_auth_scheme <span>=</span> HTTPBearer<span>(</span><span>)</span>  <span># üëà new code</span>
 
<span># Creates app instance</span>
app <span>=</span> FastAPI<span>(</span><span>)</span>

<span>@app<span>.</span>get</span><span>(</span><span>&#34;/api/public&#34;</span><span>)</span>
<span>def</span> <span>public</span><span>(</span><span>)</span><span>:</span>
    <span>&#34;&#34;&#34;No access token required to access this route&#34;&#34;&#34;</span>
 
    result <span>=</span> <span>{</span>
        <span>&#34;status&#34;</span><span>:</span> <span>&#34;success&#34;</span><span>,</span>
        <span>&#34;msg&#34;</span><span>:</span> <span>(</span><span>&#34;Hello from a public endpoint! You don&#39;t need to be &#34;</span>
                <span>&#34;authenticated to see this.&#34;</span><span>)</span>
    <span>}</span>
    <span>return</span> result


<span># new code üëá</span>
<span>@app<span>.</span>get</span><span>(</span><span>&#34;/api/private&#34;</span><span>)</span>
<span>def</span> <span>private</span><span>(</span>token<span>:</span> <span>str</span> <span>=</span> Depends<span>(</span>token_auth_scheme<span>)</span><span>)</span><span>:</span>
    <span>&#34;&#34;&#34;A valid access token is required to access this route&#34;&#34;&#34;</span>
 
    result <span>=</span> token<span>.</span>credentials

    <span>return</span> result</code></pre><p>The <code>Depends</code> class is responsible for evaluating each request that a given endpoint receives against a function, class, or instance. In this case, it will evaluate the requests against the <code>HTTPBearer</code> scheme that will check the request for an authorization header with a bearer token.</p><blockquote><p>You can find more details on how <code>FastAPI</code> <a href="https://fastapi.tiangolo.com/tutorial/dependencies/" target="_blank" rel="noreferrer noopener">dependency injection works on its documentation</a>.</p></blockquote><p>Now your private endpoint returns the received token. If no token is provided, it will return a <code><span>403</span> Forbidden</code> status code with the detail saying you are <code><span>&#34;Not authenticated&#34;</span></code>. Because you used the <code><span>--</span>reload</code> flag while running your server, you don&#39;t need to re-run the command; <code>uvicorn</code> will pick up the changes and update the server every time you save your files. Now make a request to the <code><span>GET</span> <span>/</span>api<span>/</span><span>private</span></code> endpoint to check its behavior. First, let&#39;s make a request <em>without</em> passing an authorization header:</p><pre><code><span>curl</span> -X <span>&#39;GET&#39;</span> <span>\</span>
  --url <span>&#39;http://127.0.0.1:8000/api/private&#39;</span>
<span># {&#34;detail&#34;: &#34;Not authenticated&#34;}</span></code></pre><p>And now, if you make a request with the authorization header, but with a <strong>random</strong> string as token value, you should see the same random value as a result:</p><pre><code><span>curl</span> -X <span>&#39;GET&#39;</span> <span>\</span>
  --url <span>&#39;http://127.0.0.1:8000/api/private&#39;</span> <span>\</span>
  --header <span>&#39;Authorization: Bearer FastAPI is awesome&#39;</span>
<span># &#34;FastAPI is awesome&#34;</span></code></pre><p>As you can see, your endpoint <strong>isn&#39;t protected</strong> since it accepts any string as the value for the authorization header. It is <strong>not enough</strong> to receive an authorization header; you must also <strong>verify the value of the bearer token</strong> to let somebody access the endpoint. Let&#39;s fix that behavior.</p><h2 id="Set-up-Auth0-an-API">Set up Auth0 an API</h2><p>Before you get to the point where you are ready to validate tokens in your endpoints, you need to <a href="https://auth0.com/docs/get-started/set-up-apis" target="_blank" rel="noreferrer noopener">set up an API in Auth0</a>. When this API is set up, you get access to a few pieces of information that Auth0 requires - an audience, client ID, and client secret.</p><p>You also need to have access to that information from within the server; that&#39;s where a configuration file comes into play. You will need to create a configuration file called <code><span>.</span>config</code> at the root of the project. This is what the <code><span>.</span>config</code> file should look like below. Remember to update the values accordingly:</p><pre><code># .config
 
[AUTH0]
DOMAIN = your.domain.auth0.com
API_AUDIENCE = your.api.audience
ALGORITHMS = RS256
ISSUER = https://your.domain.auth0.com/</code></pre><p>This configuration is the first piece of the puzzle of checking for the Auth0 configuration settings in the token validation stage. Another good rule to follow is to never commit your configuration files with environment variables to source code. To prevent this from occurring, you should create a <code><span>.</span>gitignore</code> file in the project&#39;s root and add the <code><span>.</span>config</code> file as an entry:</p><pre><code># .gitignore
.config</code></pre><h2 id="Add-JSON-Web-Token--JWT--Validation">Add JSON Web Token (JWT) Validation</h2><p>Your <code>FastAPI</code> server now has a <code><span>GET</span> <span>/</span>api<span>/</span><span>private</span></code> route, but it is not protected yet. It only checks if you have an authorization header in the request, which means you are missing a step in the process: you need to validate the access token. To do that, you need to create an object that does <a href="https://auth0.com/learn/json-web-tokens/" target="_blank" rel="noreferrer noopener">all the steps for validating a JWT</a> because Auth0&#39;s access tokens are JWTs.</p><p>To separate responsibilities from the routing definition, you should create a new file called <code>utils<span>.</span>py</code> inside the <code>application</code> folder to hold all the utility code, like validating the access token and reading the configuration information.</p><p>Start by importing the Python <code>os</code> library, as well as the <code>PyJWT</code> and <code>configparser</code> libraries. The OS library gives you access to the environment variables. The JWT library gives you functions to check and validate a JWT. The <code>ConfigParser</code> class from the namesake library provides a way for Python to read the configuration settings found in the <code><span>.</span>config</code> file you created earlier. And the first thing you have after the imports is a function called <code><span>set_up</span><span>(</span><span>)</span></code>, which you can see below:</p><pre><code><span>&#34;&#34;&#34;utils.py
&#34;&#34;&#34;</span>

<span>import</span> os
<span>import</span> jwt
<span>from</span> configparser <span>import</span> ConfigParser

 
<span>def</span> <span>set_up</span><span>(</span><span>)</span><span>:</span>
    <span>&#34;&#34;&#34;Sets up configuration for the app&#34;&#34;&#34;</span>

    env <span>=</span> os<span>.</span>getenv<span>(</span><span>&#34;ENV&#34;</span><span>,</span> <span>&#34;.config&#34;</span><span>)</span>

    <span>if</span> env <span>==</span> <span>&#34;.config&#34;</span><span>:</span>
        config <span>=</span> ConfigParser<span>(</span><span>)</span>
        config<span>.</span>read<span>(</span><span>&#34;.config&#34;</span><span>)</span>
        config <span>=</span> config<span>[</span><span>&#34;AUTH0&#34;</span><span>]</span>
    <span>else</span><span>:</span>
        config <span>=</span> <span>{</span>
            <span>&#34;DOMAIN&#34;</span><span>:</span> os<span>.</span>getenv<span>(</span><span>&#34;DOMAIN&#34;</span><span>,</span> <span>&#34;your.domain.com&#34;</span><span>)</span><span>,</span>
            <span>&#34;API_AUDIENCE&#34;</span><span>:</span> os<span>.</span>getenv<span>(</span><span>&#34;API_AUDIENCE&#34;</span><span>,</span> <span>&#34;your.audience.com&#34;</span><span>)</span><span>,</span>
            <span>&#34;ISSUER&#34;</span><span>:</span> os<span>.</span>getenv<span>(</span><span>&#34;ISSUER&#34;</span><span>,</span> <span>&#34;https://your.domain.com/&#34;</span><span>)</span><span>,</span>
            <span>&#34;ALGORITHMS&#34;</span><span>:</span> os<span>.</span>getenv<span>(</span><span>&#34;ALGORITHMS&#34;</span><span>,</span> <span>&#34;RS256&#34;</span><span>)</span><span>,</span>
        <span>}</span>
    <span>return</span> config</code></pre><p>The <code><span>set_up</span><span>(</span><span>)</span></code> function is responsible for reading the <code><span>.</span>config</code> file and creating a configuration object that works like a dictionary. Because this sample code is prepared to also run on environment variables, the <code><span>set_up</span><span>(</span><span>)</span></code> function by default will try to read the <code><span>.</span>config</code> file. You can change this behavior by setting the <code><span>ENV</span></code> environment variable to any other value, in which case a dictionary will be created by reading all the environment variables you can see under the <code><span>else</span></code> clause above.</p><p>The next piece of the puzzle is where the magic happens. You&#39;ll create a <code>VerifyToken</code> class to handle JWT token validation:</p><pre><code><span># paste the code üëá after the set_up() function in the utils.py file</span>
<span>class</span> <span>VerifyToken</span><span>(</span><span>)</span><span>:</span>
    <span>&#34;&#34;&#34;Does all the token verification using PyJWT&#34;&#34;&#34;</span>

    <span>def</span> <span>__init__</span><span>(</span>self<span>,</span> token<span>)</span><span>:</span>
        self<span>.</span>token <span>=</span> token
        self<span>.</span>config <span>=</span> set_up<span>(</span><span>)</span>

        <span># This gets the JWKS from a given URL and does processing so you can</span>
        <span># use any of the keys available</span>
        jwks_url <span>=</span> <span><span>f&#39;https://</span><span><span>{</span>self<span>.</span>config<span>[</span><span>&#34;DOMAIN&#34;</span><span>]</span><span>}</span></span><span>/.well-known/jwks.json&#39;</span></span>
        self<span>.</span>jwks_client <span>=</span> jwt<span>.</span>PyJWKClient<span>(</span>jwks_url<span>)</span>

    <span>def</span> <span>verify</span><span>(</span>self<span>)</span><span>:</span>
        <span># This gets the &#39;kid&#39; from the passed token</span>
        <span>try</span><span>:</span>
            self<span>.</span>signing_key <span>=</span> self<span>.</span>jwks_client<span>.</span>get_signing_key_from_jwt<span>(</span>
                self<span>.</span>token
            <span>)</span><span>.</span>key
        <span>except</span> jwt<span>.</span>exceptions<span>.</span>PyJWKClientError <span>as</span> error<span>:</span>
            <span>return</span> <span>{</span><span>&#34;status&#34;</span><span>:</span> <span>&#34;error&#34;</span><span>,</span> <span>&#34;msg&#34;</span><span>:</span> error<span>.</span>__str__<span>(</span><span>)</span><span>}</span>
        <span>except</span> jwt<span>.</span>exceptions<span>.</span>DecodeError <span>as</span> error<span>:</span>
            <span>return</span> <span>{</span><span>&#34;status&#34;</span><span>:</span> <span>&#34;error&#34;</span><span>,</span> <span>&#34;msg&#34;</span><span>:</span> error<span>.</span>__str__<span>(</span><span>)</span><span>}</span>

        <span>try</span><span>:</span>
            payload <span>=</span> jwt<span>.</span>decode<span>(</span>
                self<span>.</span>token<span>,</span>
                self<span>.</span>signing_key<span>,</span>
                algorithms<span>=</span>self<span>.</span>config<span>[</span><span>&#34;ALGORITHMS&#34;</span><span>]</span><span>,</span>
                audience<span>=</span>self<span>.</span>config<span>[</span><span>&#34;API_AUDIENCE&#34;</span><span>]</span><span>,</span>
                issuer<span>=</span>self<span>.</span>config<span>[</span><span>&#34;ISSUER&#34;</span><span>]</span><span>,</span>
            <span>)</span>
        <span>except</span> Exception <span>as</span> e<span>:</span>
            <span>return</span> <span>{</span><span>&#34;status&#34;</span><span>:</span> <span>&#34;error&#34;</span><span>,</span> <span>&#34;message&#34;</span><span>:</span> <span>str</span><span>(</span>e<span>)</span><span>}</span>

        <span>return</span> payload</code></pre><p>Let&#39;s break down this class to understand the steps here:</p><ol start="1"><li>First, you have the <code><span>__init__</span><span>(</span><span>)</span></code> method:
 <ol start="1"><li>This method is responsible for specifying the <code>token</code> parameter the <code>VerifyToken</code> class needs;</li><li>It also runs the <code><span>set_up</span><span>(</span><span>)</span></code> function to build the configuration the class will need;</li><li>And finally, it sets the path for the <code><span>JWKS</span></code> file by using the <code>PyJWKClient</code> from the <code>PyJWT</code> package. A <a href="https://auth0.com/docs/tokens/json-web-tokens/json-web-key-sets" target="_blank" rel="noreferrer noopener">JSON Web Key Set, or JWKS for short</a> contains the information necessary to validate a token signature and ensure that it is a valid token. Because Auth0 implements OAuth 2.0, it has a &#34;well-known&#34; endpoint which you can call and get the extra metadata used to validate the token and its properties.</li></ol></li><li>Second, you have the <code><span>verify</span><span>(</span><span>)</span></code> method:
 <ol start="1"><li>This method uses the key ID (<code>kid</code> claim present in the token header) to grab the key used from the JWKS to verify the token signature. If this step fails by any of the possible errors, the error message is returned;</li><li>Then, the method tries to decode the JWT by using the information gathered so far. In case of errors, it returns the error message. When successful, the token payload is returned.</li></ol></li></ol><p>Let&#39;s see how to use this piece of code in our private endpoint in the section ahead.</p><h2 id="Validate-an-Auth0-Access-Token">Validate an Auth0 Access Token</h2><p>The final puzzle piece is to import the class you just created in the <code>utils<span>.</span>py</code> file and use it in the <code><span>GET</span> <span>/</span>api<span>/</span><span>private</span></code> endpoint. Here&#39;s what you need to change:</p><ol start="1"><li>Update the imports section to add the import clause for the <code>VerifyToken</code>, then head to your endpoint; you will also need to import the <code>Response</code> class and the <code>status</code> object from <code>fastapi</code> so you can give a detailed response in case of an error;</li><li>Then, you&#39;ll need to adjust the endpoint by passing the token to the <code>VerifyToken</code> class and checking whether the result of the <code><span>verify</span><span>(</span><span>)</span></code> method is an error.</li></ol><p>Here&#39;s what your <code>main<span>.</span>py</code> file should look like with all the changes above:</p><pre><code><span>&#34;&#34;&#34;main.py
Python FastAPI Auth0 integration example
&#34;&#34;&#34;</span>
 
<span>from</span> fastapi <span>import</span> Depends<span>,</span> FastAPI<span>,</span> Response<span>,</span> status  <span># üëà new imports</span>
<span>from</span> fastapi<span>.</span>security <span>import</span> HTTPBearer
 
<span>from</span> <span>.</span>utils <span>import</span> VerifyToken  <span># üëà new import</span>

<span># Scheme for the Authorization header</span>
token_auth_scheme <span>=</span> HTTPBearer<span>(</span><span>)</span>
 
<span># Creates app instance</span>
app <span>=</span> FastAPI<span>(</span><span>)</span>
 
 
<span>@app<span>.</span>get</span><span>(</span><span>&#34;/api/public&#34;</span><span>)</span>
<span>def</span> <span>public</span><span>(</span><span>)</span><span>:</span>
   <span>&#34;&#34;&#34;No access token required to access this route&#34;&#34;&#34;</span>
 
   result <span>=</span> <span>{</span>
       <span>&#34;status&#34;</span><span>:</span> <span>&#34;success&#34;</span><span>,</span>
       <span>&#34;msg&#34;</span><span>:</span> <span>(</span><span>&#34;Hello from a public endpoint! You don&#39;t need to be &#34;</span>
               <span>&#34;authenticated to see this.&#34;</span><span>)</span>
   <span>}</span>
   <span>return</span> result
 
 
<span>@app<span>.</span>get</span><span>(</span><span>&#34;/api/private&#34;</span><span>)</span>
<span>def</span> <span>private</span><span>(</span>response<span>:</span> Response<span>,</span> token<span>:</span> <span>str</span> <span>=</span> Depends<span>(</span>token_auth_scheme<span>)</span><span>)</span><span>:</span>  <span># üëà updated code</span>
    <span>&#34;&#34;&#34;A valid access token is required to access this route&#34;&#34;&#34;</span>
 
    result <span>=</span> VerifyToken<span>(</span>token<span>.</span>credentials<span>)</span><span>.</span>verify<span>(</span><span>)</span>  <span># üëà updated code</span>

    <span># üëá new code</span>
    <span>if</span> result<span>.</span>get<span>(</span><span>&#34;status&#34;</span><span>)</span><span>:</span>
       response<span>.</span>status_code <span>=</span> status<span>.</span>HTTP_400_BAD_REQUEST
       <span>return</span> result
    <span># üëÜ new code</span>
 
    <span>return</span> result</code></pre><p>With this update, you are properly setting up your protected endpoint and doing all the verification steps for the access tokens you need. üéâ</p><p>Even though you started your server with the <code><span>--</span>reload</code> flag because you need to make sure the configuration is loaded, it is a good time to terminate the <code>uvicorn</code> process and then restart the server. That will guarantee the proper functionality of your API with the configuration parameters from the <code><span>.</span>config</code> file or environment variables.</p><p>Before you can make requests to the protected endpoint in the <code>FastAPI</code> server, you need the access token from Auth0. You can get it by copying it from the Auth0 dashboard in the <code>Test</code> tab of your API. </p><p>You can also use a curl <code><span>POST</span></code> request to Auth0&#39;s <code>oauth<span>/</span>token</code> endpoint to get the access token, and you can copy this request from the <code>Test</code> tab of your API in the Auth0 dashboard. The curl request will look like this; remember to fill the values as necessary:</p><pre><code><span>curl</span> -X <span>&#39;POST&#39;</span> <span>\</span>
--url <span>&#39;https://&lt;YOUR DOMAIN HERE&gt;/oauth/token&#39;</span> <span>\</span>
 --header <span>&#39;content-type: application/x-www-form-urlencoded&#39;</span> <span>\</span>
 --data <span>grant_type</span><span>=</span>client_credentials <span>\</span>
 --data <span>&#39;client_id=&lt;YOUR CLIENT ID HERE&gt;&#39;</span> <span>\</span>
 --data <span>client_secret</span><span>=</span><span>&lt;</span>YOUR CLIENT SECRET HERE<span>&gt;</span> <span>\</span>
 --data <span>audience</span><span>=</span><span>&lt;</span>YOUR AUDIENCE HERE<span>&gt;</span></code></pre><p>In the command line, you should see a response containing your bearer token, like this one:‚Äã‚Äã</p><pre><code><span>{</span>
    <span>&#34;access_token&#34;</span><span>:</span> <span>&#34;&lt;YOUR_BEARER_TOKEN&gt;&#34;</span><span>,</span>
    <span>&#34;expires_in&#34;</span><span>:</span> <span>86400</span><span>,</span>
    <span>&#34;token_type&#34;</span><span>:</span> <span>&#34;Bearer&#34;</span>
<span>}</span></code></pre><p>Now you can use this access token to access the private endpoint:</p><pre><code><span>curl</span> -X <span>&#39;GET&#39;</span> <span>\</span>
--url <span>&#39;http://127.0.0.1:8000/api/private&#39;</span> <span>\</span>
--header  <span>&#39;Authorization: Bearer &lt;YOUR_BEARER_TOKEN&gt;&#39;</span></code></pre><p>If the request succeeds, the server will send back the payload of the access token:</p><pre><code><span>{</span>
    <span>&#34;iss&#34;</span><span>:</span> <span>&#34;https://&lt;YOUR_DOMAIN&gt;/&#34;</span><span>,</span>
    <span>&#34;sub&#34;</span><span>:</span> <span>&#34;iojadoijawdioWDasdijasoid@clients&#34;</span><span>,</span>
    <span>&#34;aud&#34;</span><span>:</span> <span>&#34;http://&lt;YOUR_AUDIENCE&gt;&#34;</span><span>,</span>
    <span>&#34;iat&#34;</span><span>:</span> <span>1630341660</span><span>,</span>
    <span>&#34;exp&#34;</span><span>:</span> <span>1630428060</span><span>,</span>
    <span>&#34;azp&#34;</span><span>:</span> <span>&#34;ADKASDawdopjaodjwopdAWDdsd&#34;</span><span>,</span>
    <span>&#34;gty&#34;</span><span>:</span> <span>&#34;client-credentials&#34;</span>
<span>}</span></code></pre><p>Keep in mind that if the validation fails, you should see the details of what went wrong. </p><p>And that‚Äôs it ‚Äî you have finished protecting the private endpoint and testing its protection.</p><h2 id="Recap">Recap</h2><p>You learned quite a few things in this blog post. To start, you learned the basics of <code>FastAPI</code> by implementing two endpoints ‚Äî one public, one private. You saw how simple it is to make requests to both of these endpoints. You created a verification class and saw how PyJWT helps you validate an Auth0 access token, and you learned what JWKS is.</p><p>You went through the process of creating your API in the Auth0 dashboard. You also learned how to secure one of your endpoints by leveraging the dependency injection system FastAPI provides to help you implement integrations. And you did all of this very quickly.</p><p>In short, you‚Äôve learned how easy it is to get up and running with <code>FastAPI</code>, as well as how to use Auth0 for protecting your endpoints.</p><p><a href="https://github.com/auth0-blog/auth0-python-fastapi-sample" target="_blank" rel="noreferrer noopener">In this GitHub repo</a>, you‚Äôll find the full code for the sample application you built today. If you have any questions, ask them in the community forum thread for this blog post.</p></div></div>]]></content:encoded>
      <pubDate>Fri, 08 Oct 2021 20:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Secure a Rails API with Auth0</title>
      <link>https://auth0.com/blog/secure-rails-api/</link>
      <description>Learn how to secure an API written using Ruby On Rails with Auth0 authorization services.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>If you want to expose an API publicly on the Internet, authorization will be a requirement for you sooner or later. You want to verify that the client consuming the API has the appropriate permissions.</p><p>This guide is exactly about that. We&#39;ll be securing an API written using <a href="https://rubyonrails.org/" target="_blank" rel="noreferrer noopener">Ruby On Rails</a>, with <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a> as the authorization server.</p><p>There&#39;s a repository with the code so that you can follow along in <a href="https://github.com/auth0-blog/rails-api-auth0" target="_blank" rel="noreferrer noopener">Github</a>.</p><h2 id="Securing-an-API">Securing an API</h2><p>I didn&#39;t explain what I mean by securing an API yet. Essentially, we&#39;re ensuring that protected routes are accessible only for the users with enough rights.</p><p>When it comes to security, it&#39;s generally considered a bad idea to roll your own bespoke implementation. Instead, I&#39;m using <a href="https://auth0.com/docs/protocols/protocol-oauth2" target="_blank" rel="noreferrer noopener">OAuth</a>, a battle-tested and widely used authorization framework for web applications.</p><p>In this context, Auth0 fulfills the role of the <em>authorization server</em> and abstracts a significant part of the work away from us. That way, we can focus on delivering value to our users.</p><p>Without getting into too many details on how OAuth works, we assume that calls to our API will include a bearer token using the industry-standard <a href="https://jwt.io/" target="_blank" rel="noreferrer noopener">JWT</a> format. The token contains a series of claims regarding its issuer, how long it is valid, and what rights it grants. Let&#39;s have a look at a sample token:</p><pre><code><span>{</span>
  <span>&#34;iss&#34;</span><span>:</span> <span>&#34;https://yourTenant.eu.auth0.com/&#34;</span><span>,</span>
  <span>&#34;sub&#34;</span><span>:</span> <span>&#34;zHwnsh0j2sTj4u3ss6YedSFrzyb2&#34;</span><span>,</span>
  <span>&#34;aud&#34;</span><span>:</span> <span>&#34;https://targetAudience.com&#34;</span><span>,</span>
  <span>&#34;iat&#34;</span><span>:</span> <span>1621369130</span><span>,</span>
  <span>&#34;exp&#34;</span><span>:</span> <span>1791455530</span><span>,</span>
  <span>&#34;azp&#34;</span><span>:</span> <span>&#34;ThEkgdG1NndLlWoNMcEdEr2KJIs9vKad&#34;</span><span>,</span>
  <span>&#34;scope&#34;</span><span>:</span> <span>&#34;openid profile read:admin-messages&#34;</span><span>,</span>
  <span>&#34;permissions&#34;</span><span>:</span> <span>[</span><span>&#34;read:admin-messages&#34;</span><span>]</span>
<span>}</span></code></pre><p>We&#39;re going to implement verification for that token and reject requests that don&#39;t have the required permissions.</p><h2 id="Getting-Started">Getting Started</h2><p>We&#39;re getting started with our base application, bootstrapped with Rails 6. This <a href="https://github.com/auth0-blog/rails-api-auth0/tree/starter" target="_blank" rel="noreferrer noopener">branch</a> is a good starting point. You can download it by running the following command in a terminal window:</p><pre><code><span>git</span> clone -b starter --single-branch https://github.com/auth0-blog/rails-api-auth0.git</code></pre><p>The API has three endpoints with different levels of protection:</p><ul><li><code><span>/</span>api<span>/</span>messages<span>/</span><span>public</span></code>: Public route.</li><li><code><span>/</span>api<span>/</span>messages<span>/</span><span>protected</span></code>: Requires a valid access token.</li><li><code><span>/</span>api<span>/</span>messages<span>/</span>admin</code>: Requires a valid access token. Since Auth0 uses JWT as its access token format, we can inspect it and make sure it has a <code>permissions</code> claim that contains the scope <code>read<span>:</span>admin<span>-</span>messages</code>.</li></ul><h3 id="Running-the-Application">Running the Application</h3><p>To run the application, we first need the correct ruby version. The easiest way to do so is to use a version manager like <a href="https://github.com/rbenv/rbenv" target="_blank" rel="noreferrer noopener">rbenv</a>. Once you install it, run this command inside the repository to install the right version of ruby:</p><pre><code>rbenv <span>install</span></code></pre><p>Install the dependencies for the application:</p><pre><code>bundle <span>install</span></code></pre><p>And finally, run the application:</p><pre><code>bin/rails s</code></pre><p>You can verify that the application is working correctly with <code>curl</code>:</p><pre><code><span>curl</span> localhost:6060/api/messages/public</code></pre><p>The command will return a 200 code, plus the message:</p><pre><code><span>{</span><span>&#34;message&#34;</span><span>:</span> <span>&#34;The API doesn&#39;t require an access token to share this message.&#34;</span><span>}</span></code></pre><h3 id="Creating-an-API-on-Auth0">Creating an API on Auth0</h3><p>To secure the API with Auth0, you need an Auth0 account. If you haven&#39;t one, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for free</a> right now. In the <em>APIs</em> section of the <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a>, click <em>Create API</em>. Provide a name and an identifier for your API. You will use the identifier as an <code>audience</code> later, when you are configuring the access token verification. Leave the <em>Signing Algorithm</em> as RS256.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5y9rQHvjBzjxQo5aDIrsKE/842c2fadf99e521fc20a8326dfa8ee2e/create-auth0-api.png" alt="Create API"/></p><p>Once you create the API, go to the <em>Permissions</em> tab in the API details and add a permission called <code>read<span>:</span>admin<span>-</span>messages</code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/jT9dzB4AcCM0BAoYgCizu/2abc44d5604d03267b957281e93749a8/configure-permissions.png" alt="Create permission"/></p><blockquote><p><strong>Note</strong>: While you are in the Auth0 Dashboard, take note of your Auth0 domain. You will need it soon. This is a string in the form <code><span>YOUR</span><span>-</span><span>TENANT</span><span>-</span><span>NAME</span><span>.</span>auth0<span>.</span>com</code> where <code><span>YOUR</span><span>-</span><span>TENANT</span><span>-</span><span>NAME</span></code> is the name you provided when you created your account with Auth0. For more information, <a href="https://auth0.com/docs/getting-started/the-basics#domains" target="_blank" rel="noreferrer noopener">check the documentation</a>.</p></blockquote><h2 id="Preparing-the-Application-for-Validation">Preparing the Application for Validation</h2><p>Alright, our application is ready to go and in dire need of some <em>security</em>. Before that, we need to add some configurations.</p><p>You dutifully stored the <code>domain</code> and the <code>audience</code> after creating the API, right? Let&#39;s use them. In the <em>Rails</em> world, the convention is to add this in the <code>config</code> folder, using <a href="https://yaml.org/" target="_blank" rel="noreferrer noopener">YAML</a>. The file is called <code>config<span>/</span>auth0<span>.</span>yml</code>.</p><p>We don&#39;t want to store credentials in our code, so we&#39;ll export the values as environment variables, named <code><span>AUTH0_DOMAIN</span></code> and <code><span>AUTH0_AUDIENCE</span></code>. The configuration uses those values and keeps them safely away from source control!</p><pre><code><span>development</span><span>:</span>
  <span>issuerUri</span><span>:</span> &lt;%= ENV<span>[</span><span>&#34;AUTH0_DOMAIN&#34;</span><span>]</span> %<span>&gt;</span>
  <span>audience</span><span>:</span> &lt;%= ENV<span>[</span><span>&#34;AUTH0_AUDIENCE&#34;</span><span>]</span> %<span>&gt;</span></code></pre><p>Now, set <code><span>AUTH0_DOMAIN</span></code> and <code><span>AUTH0_AUDIENCE</span></code> environment variables to the <code>domain</code> and <code>audience</code> values for your API.</p><p>With this, the application is ready to connect with Auth0. Let&#39;s move on to the implementation.</p><h2 id="Validating-the-Access-Token">Validating the Access Token</h2><p>Before we get started, let&#39;s talk for a second about authentication frameworks for rails. There are a bunch of alternatives in the ecosystem, such as <a href="https://github.com/CanCanCommunity/cancancan" target="_blank" rel="noreferrer noopener">CanCanCan</a>, or <a href="https://github.com/heartcombo/devise" target="_blank" rel="noreferrer noopener">devise</a>.</p><p>However, our case is an awkward fit for those. We don&#39;t want to take over user management. We only want to validate tokens issued by the authorization server. In this case, using a framework won&#39;t bring us as much benefit as something like, say, <a href="https://spring.io/projects/spring-security" target="_blank" rel="noreferrer noopener">Spring Security</a>. That&#39;s why we only rely on an extra gem, <a href="https://github.com/jwt/ruby-jwt" target="_blank" rel="noreferrer noopener">jwt</a>.</p><p>The code implementing the authorization check lives in the <a href="https://github.com/auth0-blog/rails-api-auth0/tree/add-authorization" target="_blank" rel="noreferrer noopener">add-authorization</a> branch. Let&#39;s see how it works!</p><h3 id="Utilizing-the-JWT-Library">Utilizing the JWT Library</h3><p>The <code>jwt</code> library brings a lot of functionality to make our API able to validate and manage tokens in JWT formats like the ones issued by Auth0. We need to do three things:</p><ul><li>We need to fetch the <a href="https://auth0.com/docs/tokens/json-web-tokens/json-web-key-sets" target="_blank" rel="noreferrer noopener">JWKS</a> configuration from <em>Auth0</em> so that we know what is the public key to verify the access token signature</li><li>With the public key, the issuer, and the audience, we want to verify the token</li><li>After verifying the token, we&#39;re decoding it to access the <code>permissions</code> claim (or any other information contained in the token, really)</li></ul><h3 id="Decoding-the-Token">Decoding the Token</h3><p>Let&#39;s get down to business. We&#39;re implementing the verification/decoding logic in the <code>lib</code> folder, in a file called <code>json_web_token<span>.</span>rb</code>. We&#39;re starting by fetching the <em>JWKS</em> data:</p><pre><code><span># lib/json_web_token.rb</span>
<span>require</span> <span>&#39;jwt&#39;</span>
<span>require</span> <span>&#39;net/http&#39;</span>

<span>class</span> <span>JsonWebToken</span>
  <span>class</span> <span>&lt;</span><span>&lt;</span> <span>self</span>
    <span>def</span> <span><span>algorithm</span></span>
      <span>&#39;RS256&#39;</span>
    <span>end</span>

    <span>def</span> <span><span>key</span></span><span>(</span>header<span>)</span>
      jwks_hash<span>[</span>header<span>[</span><span>&#39;kid&#39;</span><span>]</span><span>]</span>
    <span>end</span>

    <span>def</span> <span><span>jwks_hash</span></span>
      jwks_raw <span>=</span> <span>Net</span><span>:</span><span>:</span><span>HTTP</span><span>.</span>get <span>URI</span><span>(</span><span>&#34;<span><span>#{</span>issuer<span>}</span></span>.well-known/jwks.json&#34;</span><span>)</span>
      jwks_keys <span>=</span> <span>Array</span><span>(</span><span>JSON</span><span>.</span>parse<span>(</span>jwks_raw<span>)</span><span>[</span><span>&#39;keys&#39;</span><span>]</span><span>)</span>
      jwks_keys<span>.</span>map <span>do</span> <span>|</span>k<span>|</span>
        <span>[</span>
          k<span>[</span><span>&#39;kid&#39;</span><span>]</span><span>,</span>
          <span>OpenSSL</span><span>:</span><span>:</span><span>X509</span><span>:</span><span>:</span><span>Certificate</span><span>.</span><span>new</span><span>(</span><span>Base64</span><span>.</span>decode64<span>(</span>k<span>[</span><span>&#39;x5c&#39;</span><span>]</span><span>.</span>first<span>)</span><span>)</span><span>.</span>public_key
        <span>]</span>
      <span>end</span><span>.</span>to_h
    <span>end</span>

    <span>def</span> <span><span>issuer</span></span>
      <span>&#34;https://<span><span>#{</span><span>Rails</span><span>.</span>application<span>.</span>config<span>.</span>x<span>.</span>auth0<span>.</span>issuerUri<span>}</span></span>/&#34;</span>
    <span>end</span>
  <span>end</span>
<span>end</span></code></pre><p>As you can see, through the <code>issuerUri</code> we know where to look for the data. Then, we parse the key so that we can consume it in the library.</p><p>The next step is to add an extra method to the class, <code>verify</code>, that verifies and decodes the token at the same time:</p><pre><code><span># lib/json_web_token.rb</span>
<span>class</span> <span>JsonWebToken</span>
  <span>class</span> <span>&lt;</span><span>&lt;</span> <span>self</span>
    <span>def</span> <span><span>verify</span></span><span>(</span>token<span>)</span>
      <span>JWT</span><span>.</span>decode<span>(</span>token<span>,</span> <span>nil</span><span>,</span>
                 <span>true</span><span>,</span> <span># Verify the signature of this token</span>
                 algorithm<span>:</span> algorithm<span>,</span>
                 iss<span>:</span> <span>Rails</span><span>.</span>application<span>.</span>config<span>.</span>x<span>.</span>auth0<span>.</span>issuerUri<span>,</span>
                 verify_iss<span>:</span> <span>true</span><span>,</span>
                 aud<span>:</span> <span>Rails</span><span>.</span>application<span>.</span>config<span>.</span>x<span>.</span>auth0<span>.</span>audience<span>,</span>
                 verify_aud<span>:</span> <span>true</span><span>)</span> <span>do</span> <span>|</span>header<span>|</span>
        key<span>(</span>header<span>)</span>
      <span>end</span>
    <span>end</span>
    
    <span># ... existing code ...</span>
    
  <span>end</span>
<span>end</span></code></pre><p>This is all the code that we need for the actual verification. Neat, isn&#39;t it? But our controllers are still insecure. Not for long, though.</p><h2 id="Protecting-the-Endpoints">Protecting the Endpoints</h2><p>To make it as convenient as possible, we&#39;re creating a hook that we&#39;re going to run before any route that needs authentication. To make it available for every controller, it lives in the <code>app<span>/</span>controllers<span>/</span>application_controller<span>.</span>rb</code>:</p><pre><code><span># app/controllers/application_controller.rb</span>
<span>require</span> <span>&#39;json_web_token&#39;</span>

<span>class</span> <span>ApplicationController</span> <span>&lt;</span> <span>ActionController</span><span>:</span><span>:</span><span>API</span>
  <span>def</span> <span><span>authorize</span></span><span>!</span>
    valid<span>,</span> result <span>=</span> verify<span>(</span>raw_token<span>(</span>request<span>.</span>headers<span>)</span><span>)</span>

    head <span>:unauthorized</span> <span>unless</span> valid

    <span>@token</span> <span>||</span><span>=</span> result
  <span>end</span>

  <span>private</span>

  <span>def</span> <span><span>verify</span></span><span>(</span>token<span>)</span>
    payload<span>,</span> <span>=</span> <span>JsonWebToken</span><span>.</span>verify<span>(</span>token<span>)</span>
    <span>[</span><span>true</span><span>,</span> payload<span>]</span>
  <span>rescue</span> <span>JWT</span><span>:</span><span>:</span><span>DecodeError</span> <span>=</span><span>&gt;</span> e
    <span>[</span><span>false</span><span>,</span> e<span>]</span>
  <span>end</span>

  <span>def</span> <span><span>raw_token</span></span><span>(</span>headers<span>)</span>
    <span>return</span> headers<span>[</span><span>&#39;Authorization&#39;</span><span>]</span><span>.</span>split<span>.</span>last <span>if</span> headers<span>[</span><span>&#39;Authorization&#39;</span><span>]</span><span>.</span>present<span>?</span>

    <span>nil</span>
  <span>end</span>
<span>end</span></code></pre><p>We take the token from the standard <em>Authorization</em> header. Then, we verify it with the code from the previous section. There are two possible paths after running <code>authorize<span>!</span></code>:</p><ul><li>If the token isn&#39;t there, or it&#39;s invalid for any reason, the processing stops right there, and the call returns a 401</li><li>If the token is valid, we continue the execution and store the token in <code>@token</code> so that it&#39;s available</li></ul><p>We&#39;re protecting both the <code><span>protected</span></code> and the <code>admin</code> routes with this hook, thanks to <a href="https://api.rubyonrails.org/v6.1.4/classes/AbstractController/Callbacks/ClassMethods.html#method-i-before_action" target="_blank" rel="noreferrer noopener">before_action</a>:</p><pre><code><span># app/controllers/api/messages_controller.rb</span>
<span>module</span> <span>Api</span>
  <span>class</span> <span>MessagesController</span> <span>&lt;</span> <span>ApplicationController</span>
    before_action <span>:authorize!</span><span>,</span> except<span>:</span> <span>%i[public]</span>
<span>end</span></code></pre><h3 id="Custom-Error-Messages">Custom Error Messages</h3><p>Don&#39;t you feel better knowing that the application is not exposing private stuff anymore? I definitely do. But we got to help our users. A blank 401 message might not give them enough information to debug the issue. Let&#39;s extend the hook to return something more explicit:</p><pre><code><span># app/controllers/application_controller.rb</span>
<span>class</span> <span>ApplicationController</span> <span>&lt;</span> <span>ActionController</span><span>:</span><span>:</span><span>API</span>
   <span>def</span> <span><span>authorize</span></span><span>!</span>
     valid<span>,</span> result <span>=</span> verify<span>(</span>raw_token<span>(</span>request<span>.</span>headers<span>)</span><span>)</span>

     <span># üëá old code</span>
     <span># head :unauthorized unless valid</span>
     <span># üëá new code</span>
     render json<span>:</span> <span>{</span> message<span>:</span> result <span>}</span><span>.</span>to_json<span>,</span> status<span>:</span> <span>:unauthorized</span> <span>unless</span> valid

     <span>@token</span> <span>||</span><span>=</span> result
   <span>end</span></code></pre><p>Now we get a message that&#39;s more helpful than an HTTP code without a body.</p><h2 id="Testing-the-Protected-Endpoints">Testing the Protected Endpoints</h2><p>Let&#39;s test the protected endpoint:</p><pre><code><span>curl</span> localhost:6060/api/messages/protected</code></pre><p>The command will return a 401, because we&#39;re not authorized. We need to get a valid token from Auth0.</p><p>The simplest way is to access the <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">API section of your Auth0 Dashboard</a> again, select the API that you created before and click the <em>Test</em> tab. In this section, you can get a temporary token to test your Web API by clicking the <em>Copy Token</em> icon as shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6zmU9XWwgZLWIAFF0qu6IP/50e2aa27469142c138b814731aa0233d/copy-access-token.png" alt="Test Token"/></p><p>Let&#39;s attach the token to the request:</p><pre><code><span>export</span> <span>TOKEN</span><span>=</span>the-test-token
<span>curl</span> localhost:6060/api/messages/protected -H <span>&#34;Authorization: Bearer <span>$TOKEN</span>&#34;</span></code></pre><p>The request works now! </p><pre><code><span>{</span><span>&#34;message&#34;</span><span>:</span> <span>&#34;The API successfully validated your access token.&#34;</span><span>}</span></code></pre><h2 id="Checking-for-permissions">Checking for permissions</h2><p>There&#39;s one requirement pending. As you might recall, for <code><span>/</span>api<span>/</span>messages<span>/</span>admin</code> a valid token isn&#39;t enough. Rather, we expect the correct permission in the <code>permissions</code> claim. This extra check allows us to define more granular access criteria for our endpoints. This functionality is implemented in the <a href="https://github.com/auth0-blog/rails-api-auth0/tree/add-rbac" target="_blank" rel="noreferrer noopener">add-rbac</a> branch.</p><p>We&#39;re adding a new method in the <code>application_controller</code>, <code>check_permissions</code>. It takes the decoded token and looks for a given permission:</p><pre><code><span># app/controllers/application_controller.rb</span>
<span>require</span> <span>&#39;json_web_token&#39;</span>

<span>class</span> <span>ApplicationController</span> <span>&lt;</span> <span>ActionController</span><span>:</span><span>:</span><span>API</span>
  <span># ... existing code ...</span>
  
  <span>def</span> <span><span>can_read_admin_messages</span></span><span>!</span>
    check_permissions<span>(</span><span>@token</span><span>,</span> <span>&#39;read:admin-messages&#39;</span><span>)</span>
  <span>end</span>
  
  <span>def</span> <span><span>check_permissions</span></span><span>(</span>token<span>,</span> permission<span>)</span>
    permissions <span>=</span> token<span>[</span><span>&#39;permissions&#39;</span><span>]</span> <span>||</span> <span>[</span><span>]</span>
    permissions <span>=</span> permissions<span>.</span>split <span>if</span> permissions<span>.</span>is_a<span>?</span> <span>String</span>

    <span>unless</span> permissions<span>.</span><span>include</span><span>?</span><span>(</span>permission<span>)</span>
      render json<span>:</span> <span>{</span> message<span>:</span> <span>&#39;Access is denied&#39;</span> <span>}</span><span>.</span>to_json<span>,</span>
             status<span>:</span> <span>:unauthorized</span>
    <span>end</span>
  <span>end</span>
  
  <span># ... existing code ...</span>
<span>end</span></code></pre><p>We use a <code>before_action</code> again to protect the <code>admin</code> endpoint:</p><pre><code><span># app/controllers/api/messages_controller.rb</span>
<span>module</span> <span>Api</span>
  <span>class</span> <span>MessagesController</span> <span>&lt;</span> <span>ApplicationController</span>
    before_action <span>:can_read_admin_messages!</span><span>,</span> only<span>:</span> <span>%i[admin]</span>
    
    <span># ... existing code ...</span>
<span>end</span></code></pre><p>With this, each route in our sample application is safe the way we wanted.</p><h3 id="Testing-Permissions">Testing Permissions</h3><p>If you try to call the <code><span>/</span>api<span>/</span>messages<span>/</span>admin</code> endpoint with the token we generated before, it will return a 401. Our token is valid but doesn&#39;t have the necessary permissions. Let&#39;s create a new one!</p><p>Back in your <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">API configuration page on the Auth0 Dashboard</a>, select the <em>Machine to Machine Applications</em> tab. You&#39;ll get a list of applications, some of them with the <em>(Test Application)</em> label in the name. These applications are automatically created by Auth0 when you create an API there. They are meant as test clients from your API. One of them should have the <em>Authorized</em> switch on. Click the dropdown next to it and check the <code>read<span>:</span>admin<span>-</span>messages</code> permission:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Iva8EtxfjdsunLbDTGVyD/71034bf799e82e51c7e5f7152ccd6adf/adding-permissions.png" alt="Adding Permissions"/></p><p>Then, click the <em>Update</em> button, move again to the <em>Test</em> tab, and copy the new token that has been generated for you. Let&#39;s try again:</p><pre><code><span>export</span> <span>TOKEN</span><span>=</span>the-new-test-token
<span>curl</span> localhost:6060/api/messages/admin -H <span>&#34;Authorization: Bearer <span>$TOKEN</span>&#34;</span></code></pre><p>The request works now!</p><pre><code><span>{</span><span>&#34;message&#34;</span><span>:</span><span>&#34;The API successfully recognized you as an admin.&#34;</span><span>}</span></code></pre><h2 id="Conclusion">Conclusion</h2><p>In this guide, we&#39;ve added authorization to a Rails API by using Auth0 as an authorization server. Thanks to the <code>jwt</code> gem, we don&#39;t have to invest much effort. We use the library to decode the bearer token that the API receives. After that, it&#39;s a matter of checking the relevant routes before each request.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 07 Oct 2021 15:03:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Welcomes Bhawna Singh to the Team</title>
      <link>https://auth0.com/blog/auth0-welcomes-bhawna-singh-to-the-team/</link>
      <description>Bhawna Singh joined Auth0 as SVP of Engineering. Why she plans to focus on mentoring innovation.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><section itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="mainEntity"><header><div><div><p><span>ENGINEERING</span></p><p itemprop="description">Bhawna Singh joined Auth0 as SVP of Engineering. Why she plans to focus on mentoring innovation.</p></div><p>October 07, 2021</p><meta itemprop="datePublished" content="2021-10-07"/><meta itemprop="dateModified" content="2021-10-07"/></div></header><header><div><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7AsuaROfW0vGJaHpUPqGrW/c509de75eeb8c42543afe95883138554/Bhawna_Singh.jpg"/></p><div><p><span>ENGINEERING</span></p><p itemprop="description">Bhawna Singh joined Auth0 as SVP of Engineering. Why she plans to focus on mentoring innovation.</p><p>October 07, 2021</p><meta itemprop="datePublished" content="2021-10-07"/><meta itemprop="dateModified" content="2021-10-07"/></div></div></header><article><main id="post-content" itemprop="articleBody"><div><p>Relying on Ask.com for quick answers or researching your next role at Glassdoor? You‚Äôre likely leaning on innovations <a href="https://auth0.com/blog/bhawna-singh-joins-auth0-leadership-team-as-senior-vice-president-of-engineering" target="_blank" rel="noreferrer noopener">Bhawna Singh</a> helped make possible. With over twenty years of helping companies through tech transformations, scaling challenges, and participating in multiple acquisitions, Bhawna brings an understanding of how to deliver growth that serves end users and develops talent on the way to building revenue.</p><p>That experience is coming to Auth0 at a critical moment. While we‚Äôre seeking to strongly align our product and engineering teams, we‚Äôre also working through our recent acquisition by Okta ‚Äî and we want to do that while sustaining our growth trajectory.</p><p>We sat down with Bhawna to learn more about how she grows talent through innovation, what brought her to Auth0, and why she‚Äôll be applying the power of diversity of thought to the global identity market.</p><h3 id="Why-join-Auth0-">Why join Auth0?</h3><p>Three things intrigued me. </p><p>First, you, Eugenio [Pace], Matias [Woloski], were upfront and transparent about challenges. More importantly, though, Auth0‚Äôs mission and roadmap was compelling. </p><p>Second, I really enjoy the people interaction that comes from working with a global team. But Auth0‚Äôs engineering talent spread across many countries presents an interesting time zone challenge.</p><p>Third, the technological challenges presented with Auth0‚Äôs high growth. Auth0 needs to work across 21 deployment regions to securely and reliably support billions of logins a month while continuously calling the team and technology to meet growth demands. This is an area where I can help and learn at the same time. Bottom line? I see the high growth and complexity of challenges ahead as an opportunity to make a larger impact.</p><h3 id="Now-that-you-re-here--what-are-your-short-term-goals-">Now that you‚Äôre here, what are your short-term goals?</h3><p>In the short term, hiring is my top priority. Even before Okta‚Äôs acquisition, Auth0 had big hiring goals. I am currently partnering with multiple teams and leaders on our hiring and onboarding strategy. At Auth0, we are solving hard problems around authentication, security, scale, and a product that needs to be highly available, along with continuous innovation in the identity space. So making sure new engineers understand that when they come to Auth0, they‚Äôre going to get to solve hard problems with leadership support (which means mentorship, team building, and securing proper funding) and strong cross-org alignment, specifically with product and process teams.</p><h3 id="Longer-term-">Longer-term?</h3><p>Mid-term, I‚Äôm looking to build Auth0‚Äôs engineering vision and roadmap to align our technology investments and product innovation plans. This will also play into our longer-term Okta + Auth0 vision. As a team, we are constantly innovating and making big bets. It is important that we build external awareness of key initiatives (watch for more engineering-specific content) to help continue attracting top talent and satisfying evolving customer needs.</p><h3 id="If-I-m-a-new-or-current-engineer-at-Auth0--what-kind-of-leadership-can-I-expect-from-you-">If I‚Äôm a new or current engineer at Auth0, what kind of leadership can I expect from you?</h3><p>Table stakes for me are genuine empathy. But if I am going to ask you to rally behind me, there are really four core qualities that I look for in leaders, whether I am looking in the mirror or at leadership across an org.</p><ol start="1"><li><strong>High-accountability.</strong> Everyone is going to make mistakes. I hold myself highly accountable for what happens in my org. This helps build team integrity, trust, and collective ethics. The point is never to be mistake-free but to make sure we take the time to learn from our mistakes.</li><li><strong>Listening-based communication.</strong> For a lot of people, listening is passive. For me, active listening means checking that you‚Äôve effectively communicated what needs to be communicated and making sure it was received correctly. Information and feedback need to flow both ways, which is also key to building a transparent organization.</li><li><strong>Planning long-term.</strong> As we look at our organization and tech stack, we need to invest in our long-term vision and strategy along with making short-term bets and wins. Aligning engineering with our vision and long-term goals means investing in people, investing in our technology, and strengthening innovation.</li><li><strong>Investing in leaders.</strong> The mentors I wanted and needed weren‚Äôt right there at the start of my career. If I could go back and change something in my own career, it would be to mentor sooner. Investing in developing team leadership through mentoring, coaching, or providing access to additional training and contacts can make a huge difference in the amount of creativity and innovation that comes out of an org. But more importantly, it helps keep the entire industry growing and innovating. I ensure that I am coaching my leaders to grow, and together we are building an organization inspired by learning and problem-solving. I also make every effort in connecting with underrepresented groups regularly and evaluate how effectively I help them to achieve their goals. If you‚Äôre on my team and would appreciate mentorship, I will either mentor you directly or connect you with someone within my network.</li></ol><h3 id="What-did-it-take-to-break-into-executive-roles--Especially-if-you-re-a-woman-or-underrepresented-person-in-tech--what-five-steps-should-you-take-to-break-in-">What did it take to break into executive roles? Especially if you‚Äôre a woman or underrepresented person in tech, what five steps should you take to break in?</h3><ol start="1"><li><strong>Say yes to stretch assignments.</strong> Mentors or coaches are usually telling you what‚Äôs happening, but if an opportunity comes your way, it means someone has vouched for you. Of course, you need to evaluate whether or not this assignment is right for you at this point in your life, but if you can, say ‚Äúyes‚Äù.</li><li><strong>Seek mentors ‚Äî and trust them to identify your gaps.</strong> We all have self-doubts, but I sometimes see women calling out ‚Äúgaps‚Äù that I don‚Äôt really see as their weakness. Finding a mentor who can confirm your true gaps and strengths is critical. Then it‚Äôs important to do that homework to actively address the things you need to do in order to reach that goal.</li><li><strong>Get comfortable with taking risks and failing.</strong> As an executive, the situations that come your way usually do not have a playbook. Being comfortable with taking risks, failing, and learning from the experience is the only path forward.</li><li><strong>Network.</strong> Look for peers (in addition to mentors) that you can lean on and ask for best practices. This is easier for some than others. Here are concrete steps that work:</li><li><strong>Talk to your manager and express interest in mentorship.</strong> Your manager can lean in and help and/or provide recommendations and intros to other mentors.</li><li><strong>Reach out to your People/Human Resources partner for mentorship.</strong> They can connect you with internal mentors, in addition to external opportunities.</li><li><strong>Identify your goals.</strong> Work on self-awareness. Avoid an open-ended discussion. Identify two to three areas you‚Äôd like to work on. This will make it easier for your network to help you take action that matters.</li></ol><h3 id="Our-security-team-talks-about-relying-on--diversity-of-thought--to-help-secure-our-product-and-ensure-a-stronger-security-culture-that-protects-our-customers-and-the-internet--How-does-diverse-thinking-help-fuel-an-effective-engineering-team-">Our security team talks about relying on ‚Äúdiversity of thought‚Äù to help secure our product and ensure a stronger security culture that protects our customers and the internet. How does diverse thinking help fuel an effective engineering team?</h3><p>Security is part of engineering, and the teams collaborate closely to identify solutions grounded in the <a href="https://auth0.com/blog/why-auth0-is-shifting-left-on-security/" target="_blank" rel="noreferrer noopener">Secure by Design approach</a>. Diverse backgrounds bring diverse thoughts with multiple perspectives to get us to the right solution for all our customers. Auth0 was not created for just one company in the US or one company in another country. Our customer space requires a large global setup. One perspective just won‚Äôt work.</p><p><strong>Tell me about why you helped found the <a href="https://www.linkedin.com/company/neythri-futures-fund/" target="_blank" rel="noreferrer noopener">Neythri Futures Fund</a> (NFF).</strong></p><p>The core reason we all came together to found the NFF was to fuel diversity at the top. We focus specifically on funding companies founded by women and underrepresented groups because we weren‚Äôt seeing women investors in this space. If you want to fuel diversity, you have to fund it.</p><p><strong>What makes a good ally?</strong> </p><p>We all feel we should know the answer here, but this is an evolving area. I am a continual learner in this space, so this means making sure I am listening and aware that I am going to make mistakes. Not intentionally, of course, but coming from a place of being comfortable with learning and listening hopefully makes it easier for others to point out my mistakes so I can learn from them. Immediately trying to fix everything is not the answer. The constant learning can‚Äôt stop with me. I need to pass it on to my team, leadership, and my network. We need to share what we learn to build collective awareness in this area.</p><h3 id="After-being-through-more-than-five-acquisitions--what-kind-of-leadership-does-it-take-to-move-companies-through-mergers-and-acquisitions-towards-success-for-both-employees-and-customers-">After being through more than five acquisitions, what kind of leadership does it take to move companies through mergers and acquisitions towards success for both employees and customers?</h3><ul><li><strong>Aligning mission and core values.</strong> How does the acquiree fit in/influence the mission?</li><li><strong>Bringing people along through communication.</strong> An acquisition is change management at a grand scale. Being clear about challenges and opportunities, especially for growth acquisitions, helps people bring the collaborative vision into reality.</li><li><strong>Put together a plan for how you will bring people together ‚Äî and actively communicate that plan.</strong></li><li><strong>Understand that this is a complex process.</strong> Know that there are areas that might not work out, while there are people who thrive on complex challenges. Actively choose to let those people lead and bring in those who are looking to work collaboratively. Frankly, I‚Äôm excited to be able to help Okta and Auth0 at this time.</li></ul><h2 id="Learn-more-about-identity-and-opportunities-at-Auth0">Learn more about identity and opportunities at Auth0</h2><ul><li>If you‚Äôd like to learn more about how Auth0 can help speed your product to market, reach <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">out to our team</a>.</li><li>If you‚Äôre interested in helping us solve complex problems, you‚Äôll find <a href="https://auth0.com/careers/" target="_blank" rel="noreferrer noopener">current listings here</a>.</li></ul></div></main></article></section></div>]]></content:encoded>
      <pubDate>Thu, 07 Oct 2021 14:18:00 +0000</pubDate>
    </item>
    <item>
      <title>Bhawna Singh Joins Auth0 Leadership Team as Senior Vice President of Engineering</title>
      <link>https://auth0.com/blog/bhawna-singh-joins-auth0-leadership-team-as-senior-vice-president-of-engineering/</link>
      <description>Former SVP of Engineering and CTO at Glassdoor and Ask.com bolsters management team</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><section itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="mainEntity"><header><div><div><p><span>Leadership</span></p><p itemprop="description">Former SVP of Engineering and CTO at Glassdoor and Ask.com bolsters management team</p></div><p>Last Updated On: October 07, 2021</p><meta itemprop="datePublished" content="2021-10-07"/><meta itemprop="dateModified" content="2021-10-07"/></div></header><header><div><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4WvCBPXRYPtxWSIIO3yHVJ/b42049305c220e3957595e0d32eeb5f3/Announcements1.png"/></p><div><p><span>Leadership</span></p><p itemprop="description">Former SVP of Engineering and CTO at Glassdoor and Ask.com bolsters management team</p><p>Last Updated On: October 07, 2021</p><meta itemprop="datePublished" content="2021-10-07"/><meta itemprop="dateModified" content="2021-10-07"/></div></div></header><article><main id="post-content" itemprop="articleBody"><div><p><strong>BELLEVUE, Wash. ‚Äì Oct. 7, 2021 ‚Äì</strong> The <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Identity Platform</a>, a product unit within Okta (NASDAQ: OKTA), today announced that <a href="https://www.linkedin.com/in/bhawnasingh/" target="_blank" rel="noreferrer noopener">Bhawna Singh</a> has joined the company as Senior Vice President (SVP) of Engineering. With more than two decades of engineering and technology leadership, Singh will be instrumental in continuing to build and lead Auth0‚Äôs talented team of engineers in transforming technology and increasing value to its growing customer base.</p><p>Prior to joining Auth0, Singh held senior engineering and technology roles, including SVP of Engineering and CTO at Glassdoor, where she was responsible for technological innovation overseeing the company‚Äôs websites and mobile platforms, in addition to its software engineering data platform and machine learning teams. Before Glassdoor, Singh held engineering leadership roles at Ask.com, Sybase, and AT&amp;T. As SVP of Engineering, Singh will lead the high growth of Auth0‚Äôs solutions, strengthen trust and reliability for their global customer base, and continue to invest in engineering excellence. </p><p>‚ÄúThe technological complexity of identity, innovation of the company‚Äôs solutions, and transparent and inclusive workplace culture immediately drew me to Auth0,‚Äù said Singh. ‚ÄúI‚Äôm excited to join a global team filled with experts that continuously innovate and all share one common vision ‚Äî secure access for all.‚Äù</p><p>‚ÄúIdentity is one of the most strategic investments an organization will make today, and as a company deeply passionate about our customers and dedicated to continuous improvement, Bhawna will play a critical role in helping us shape the future of identity and enabling our customers to accelerate innovation,‚Äù said Shiv Ramji, Chief Product Officer at Auth0. ‚ÄúWith deeply experienced leadership in engineering and technology, Bhawna is an invaluable addition to Auth0, and we are honored she is joining us.‚Äù</p><p>To learn more about Singh and Auth0‚Äôs engineering team, visit <a href="https://auth0.com/blog/auth0-welcomes-bhawna-singh-to-the-team" target="_blank" rel="noreferrer noopener">Auth0‚Äôs blog</a>.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>The Auth0 Identity Platform, a product unit within Okta, takes a modern approach to identity and enables organizations to provide secure access to any application, for any user. Auth0 is a highly customizable platform that is as simple as development teams want, and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h3 id="Media-Contacts-">Media Contacts:</h3><p>Global Communications<br/>Auth0<br/><a href="mailto:press@auth0.com" target="_blank" rel="noreferrer noopener">press@auth0.com</a><br/></p><p>Matter Communications for Auth0<br/><a href="mailto:auth0@matternow.com" target="_blank" rel="noreferrer noopener">auth0@matternow.com</a><br/></p><h3 id="Investor-Contact-">Investor Contact:</h3><p>Investor Relations<br/><a href="mailto:investor@okta.com" target="_blank" rel="noreferrer noopener">investor@okta.com</a></p></div></main></article></section></div>]]></content:encoded>
      <pubDate>Thu, 07 Oct 2021 14:16:00 +0000</pubDate>
    </item>
    <item>
      <title>What Your Customers Really Want From Your Login Box</title>
      <link>https://auth0.com/blog/what-your-customers-really-want-from-your-login-box/</link>
      <description>Taking a closer look at our recent YouGov survey results</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3ECzfjyrDSou0kNDj6grh6/dcd039b4cd4f6f4b85d3aa4da305d679/Uploaded_from_What_Your_Customers_Really_Want_From_Your_Login_Box_-_Steven_Rees-Pullman" alt="image"/></p><p>We think a lot about login boxes. </p><p>But you would be surprised by just how much your customers are thinking about them as well.</p><p>Now, we would say that, since we are in the business of making login boxes. So that‚Äôs why we went out and asked people what <em>they</em> thought: more than 17,000 global technology leaders and consumers across 12 global markets: United States, United Kingdom, Belgium, France, Germany, the Netherlands, Australia, Singapore, Japan, Argentina, Brazil, and Mexico.</p><p>The survey report, called ‚Äú<a href="https://info.auth0.com/expectation-vs-reality" target="_blank" rel="noreferrer noopener">Expectation vs. Reality at The Log Inn</a>,‚Äù and conducted in partnership with third-party research firm YouGov, revealed that most organizations fail to meet consumer expectations around login experiences.</p><p>Everywhere we looked, consumers&#39; expectations didn‚Äôt match reality. If you‚Äôve ever had to fill out endless registration forms just to buy a pair of jeans, or create yet another (weak) password for websites owned by the same company (even worse), you know the pain. </p><p>And it makes sense, right? Login should be simple, invisible almost. Because it‚Äôs a marketer‚Äôs worst nightmare when you get frustrated and decide to take your business elsewhere.</p><p>At least, that <em>would</em> <em>be</em> the case, if anyone were paying attention to the login box.</p><h2 id="Won-t-Somebody-Think-of-the-Login-Boxes-">Won‚Äôt Somebody Think of the Login Boxes?</h2><p>It‚Äôs easy to forget about login boxes. After all, no one visits a website just to play with the <a href="https://auth0.com/blog/introducing-auth0-craptchas/" target="_blank" rel="noreferrer noopener">CAPTCHA</a> ‚Äì and they are rarely the first place executives and their marketing teams look to increase revenue and reduce churn. But, if you have a website or application, it‚Äôs likely you have a login box, and it‚Äôs the first thing that customers see. </p><p>So, what did the study show customers want?</p><p>A winning lottery ticket?</p><p>No.</p><p>They want choice.</p><p>When they arrive at your login, customers want convenience and control: they want to choose which authentication method to use ‚Äì whether it‚Äôs MFA or SSO or biometrics. They want a brand experience that resembles a concierge desk: a 24/7 service where no demand is too big. To top it off, they don‚Äôt want to see any technical glitches, or have to re-sign up on another device: they want seamless omni-channel experiences ‚Äì not to be left out in the cold.</p><ul><li><strong>Passwords just don‚Äôt do it for people</strong> ‚Äî Consumers rank ‚ÄúCreating a password that has to meet certain requirements‚Äù (e.g. number of digits, symbols) among their top frustrations with the sign-up process (47%).</li><li><strong>One ID to rule them all</strong> ‚Äî Almost half (48%) of consumers are likely to sign up to an app or service if they can use Single Sign-On (SSO) ‚Äì using a single ID and password for multiple related services. This number is higher for Latin American (61%) consumers compared to their global counterparts (APAC 52%, EMEA 41%, and the US 47%).</li></ul><h2 id="But-Login-Boxes-Aren-t-Really-a-Big-Deal--Right-">But Login Boxes Aren‚Äôt Really a Big Deal, Right?</h2><p>To make things interesting, we asked businesses what they thought consumers thought (getting meta with this study), and they often didn‚Äôt realize just how important login experiences really are:</p><ul><li><strong>Minding the gap with biometrics</strong>
  <ul><li>44% of consumers are likely to sign up to an app or online service if a company offers biometric authentication ‚Äî only 25% of companies offer biometrics as an option.</li></ul></li><li><strong>Going fully passwordless</strong>
  <ul><li>LATAM (43%), US (42%), and APAC (40%) consumers are more likely than their EMEA counterparts (29%) to sign-up to an app/online service if they were able to use passwordless services. Across the globe, just 20% of companies offer passwordless authentication.</li></ul></li></ul><h2 id="It-s-More-than-Just-a-Login-Box">It‚Äôs More than Just a Login Box</h2><p>Not having the technologies above is not just a minor annoyance; it‚Äôs an actual turn-off for many consumers when it comes to engaging with your brand. Oftentimes your login box is actually standing in the way of users signing up to your app or making a purchase.</p><ul><li><strong>It‚Äôs not about the journey, it‚Äôs about the destination</strong>
  <ul><li>About half of the consumers (48%) are frustrated by having to fill in long login or sign-up forms. This number rises for consumers in APAC (55%) and LATAM (51%) compared to consumers in EMEA (46%) and the US (36%).</li></ul></li><li><strong>I‚Äôm outta here</strong>
  <ul><li>Our research shows that 83% of consumers have abandoned a purchase or an account setup because the login process was too arduous. This rises to the highest levels in Singapore (89%), Brazil (87%), Australia (86%), France (86%), US (86%), UK (85%), and Mexico (85%).</li></ul></li></ul><h2 id="Okay--You-Have-My-Attention">Okay, You Have My Attention</h2><p>Good. Very few executives are used to paying much attention to customer identity management (their login box). But as many of us emerge from the past year, more digital than we‚Äôve ever been, creating safe and simple access to online services is essential. </p><p>The opportunity to build trust is massive.</p><p>This is admittedly just a glimpse into the minds and behaviors of consumers. We are working on a series of blogs that look deeper at what consumers want, and how the login box can help.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 06 Oct 2021 12:53:00 +0000</pubDate>
    </item>
    <item>
      <title>Implementing an API Gateway in ASP.NET Core with Ocelot</title>
      <link>https://auth0.com/blog/implementing-api-gateway-in-aspnet-core-with-ocelot/</link>
      <description>Learn what an API Gateway is and how to build yours in ASP.NET Core by using Ocelot.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>The urge towards adopting microservices architecture has been a welcome trend in the software development industry.  Microservices architecture has been one of the most talked-about technologies in recent times ‚Äì it has been embraced by many leading organizations worldwide. Originally developed to solve the limitations of monolithic systems, microservices architecture has seen a significant increase in popularity over the last several years, mainly due to increased scalability, flexibility, and performance.</p><p>Since microservices-based applications comprise several different services, you often need a common interface or gateway to call these services so that you define and manage all concerns in one place rather than replicate them across all downstream services. This is precisely where an API Gateway comes in. This article briefly discusses the concepts around microservices architecture and how you can work with API Gateways to have a consistent way to connect to the microservices. Let&#39;s get started!</p><h2 id="What-Is-Microservices-Architecture-">What Is Microservices Architecture?</h2><p>Microservices architecture is a service-oriented architecture (SOA) variant in which an application comprises a collection of lightweight, loosely coupled, modular services. These services can be built to execute on various platforms and independently developed, tested, deployed, and managed.</p><p>Microservices architecture can replace long-running, complicated monolithic systems requiring considerable resource and management overhead. Microservice is a word that refers to a service having a limited set of functionalities rather than referring to the length of the code used to create it.</p><h2 id="What-Is-an-API-Gateway-">What Is an API Gateway?</h2><p>When building microservices-based applications, an API Gateway is needed to have a central place where authentication, throttling, orchestration, etc., is implemented. Without an API Gateway in place, you might typically implement each of these in each service, and hence maintaining them for each service would be a daunting task at hand. An API Gateway decouples the service producer from its consumer, providing a security layer since you need not expose your microservices directly.</p><p>As soon as it receives a request, it breaks it into multiple requests (if needed) and then routes them to the appropriate downstream microservice. You can take advantage of an API Gateway to centralize, manage, and monitor the non-functional requirements of an application, orchestrate the cross-functional microservices, and reduce roundtrips. By managing requests consistently, an API Gateway can help reduce the latency and improve security.</p><p>The figure below illustrates an API Gateway used to connect to two downstream microservices named Customer and Product.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3GS9a9hK4MG45UQuG2DVC8/bf86b3d095b072199d88dce416907472/api-gateway-architecture.png" alt="API Gateway architecture diagram"/></p><p>Usually, the service consumers or clients of a microservice don&#39;t communicate with it directly. Instead, an API Gateway provides a single entry point for directing traffic to various microservices, as shown in the figure above. Hence the clients don&#39;t have any direct access to the services and cannot exploit the services. If your API Gateway is behind the firewall, you can add an extra layer of protection around the attack surface.</p><p>An API Gateway pattern corresponds to two famous <a href="https://en.wikipedia.org/wiki/Design_Patterns" target="_blank" rel="noreferrer noopener">Gang of Four design patterns</a>: Facade and Adapter. Like the Facade design pattern, an API Gateway provides an API to the consumers while encapsulating the internal architecture. An API Gateway enables communication and collaboration like in the Adapter design pattern, even if the interfaces are incompatible.</p><h3 id="--Why-Do-We-Need-an-API-Gateway---"><strong>Why Do We Need an API Gateway?</strong></h3><p>A microservices-based application comprises many different microservices built using homogenous or heterogeneous technologies. An API Gateway provides a centralized point of entry for external consumers, regardless of the number or composition of the downstream microservices. An API Gateway can often contain an additional layer of rate-limiting and security.</p><p>Here are the main benefits of an API Gateway:</p><ul><li><strong>Better isolation</strong>: An API Gateway provides isolation by preventing direct access to internal concerns. As a result, it can encapsulate service discovery, versioning, and other internal details from the service consumers or clients. Additionally, an API Gateway enables you to add more microservices or change boundaries without impacting the external consumers.</li><li><strong>Improved security</strong>: An API Gateway provides a security layer for your microservices that can help prevent attack vectors such as SQL Injection, Denial-of-Service (DoS), etc. You can leverage an API Gateway to authenticate users. If a particular service consumer needs data from multiple services, you need to authenticate the user just once hence reducing latency and making your authentication mechanism consistent across the application.</li><li><strong>Performance metrics</strong>: Since an API Gateway is a single component through which all requests and responses flow, it is a great place to collect metrics. For example, you can measure the count and execution times of the requests forwarded to the downstream microservices.</li><li><strong>Reduced complexity</strong>: Microservices have specific common concerns that include logging, rate-limiting, security, etc. You&#39;ll need more time to develop these concerns in each of the microservices your application is using. An API Gateway can eliminate this code duplication hence reducing the effort required to create these components.</li></ul><h3 id="API-Gateways-and-reverse-proxies">API Gateways and reverse proxies</h3><p>There is a lot of confusion around a reverse proxy and an API Gateway. While there are similarities between them, there are subtle differences between the two as well.</p><p>Reverse proxy servers typically sit behind a firewall and route requests from the client to the appropriate back-end server. A reverse proxy is a lightweight API Gateway that comprises a few basic security and monitoring capabilities. So, if you need an API Gateway with basic features, a reverse proxy server should suffice. Note that a reverse proxy is incapable of performing transformation or orchestration.</p><p>An API gateway sits between the client and a set of back-end services and provides much more extensive security and monitoring capabilities than a reverse proxy server. An API Gateway provides support for comprehensive service orchestration, transformation, and mediation. It also offers extensive support for transport security - much more than a simple proxy can provide.</p><h2 id="Introducing-Ocelot">Introducing Ocelot</h2><p>In this article, we are going to use <a href="https://github.com/ThreeMammals/Ocelot" target="_blank" rel="noreferrer noopener">Ocelot API Gateway</a>. It is a lightweight, open-source, scalable, and fast API Gateway based on .NET Core and specially designed for microservices architecture. Basically, it is a set of middleware designed to work with ASP.NET Core. It has several features such as routing, caching, security, rate limiting, etc.</p><h2 id="The-Order-Processing-Microservices-Based-Application">The Order Processing Microservices-Based Application</h2><p>Let&#39;s now put the concepts we&#39;ve learned thus far into practice by implementing a concrete example. We&#39;ll build an order processing application that illustrates how an API Gateway can be used to invoke each service to retrieve customer and product data using the Customer and Product microservice, respectively. </p><p>Typically, an order processing microservices-based application comprises microservices such as Product, Customer, Order, OrderDetails, etc. In this example, we&#39;ll consider a minimalistic microservices-based application. This application will contain an API Gateway and two microservices - the Product and Customer microservice. The application would be simple so that we can focus more on building the API Gateway.</p><h3 id="Prerequisites">Prerequisites</h3><p>To execute the code examples shown in this article, here are the minimum requirements you should have installed in your system:</p><ul><li>.NET 5 SDK</li><li>Visual Studio 2019</li></ul><h3 id="The-solution-structure">The solution structure</h3><p>The application you are going to build will comprise the following projects as part of a single Visual Studio solution:</p><ul><li><code>OrderProcessing</code> project - This project represents the API Gateway and is responsible for getting requests from the clients and invoking the microservices.</li><li><code>OrderProcessing<span>.</span>Customer</code> project - This project defines the classes and interfaces used to represent the customer microservice.</li><li><code>OrderProcessing<span>.</span>Product</code> project - This project defines the types used to represent the product microservice.</li></ul><p>The Customer microservice project will comprise the following classes and interfaces:</p><ul><li><code>Customer</code> class ‚Äì This represents the customer entity class.</li><li><code>ICustomerRepository</code> interface ‚Äì This represents the interface for the customer repository.</li><li><code>CustomerRepository</code>class ‚Äì This represents the customer repository class that implements the <code>ICustomerRepository</code> interface.</li><li><code>CustomerController</code> class ‚Äì This class represents the API controller for the Customer microservice.</li></ul><p>The Product microservice project will contain the following types:</p><ul><li><code>Product</code> class ‚Äì This class represents the product entity.</li><li><code>IProductRepository</code> interface ‚Äì This represents the interface for the product repository.</li><li><code>ProductRepository</code> class ‚Äì This is the product repository class that implements the <code>IProductRepository</code> interface.</li><li><code>ProductController</code> class ‚Äì This represents the API controller class for the Product microservice.</li></ul><p>The following picture shows how the solution structure of the completed
application will look like:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5eiiZahb4K7nC6X3W8IIGw/1d3fca58dfba684ba2be6c9902fc6beb/demo-project-structure.png" alt="Solution Structure of the OrderProcessing Application"/></p><h3 id="Create-the-projects-for-the-Order-Processing-application">Create the projects for the Order Processing application</h3><p>Open a command shell and enter the following commands to create the three ASP.NET projects we need:</p><pre><code>dotnet new web --framework <span>&#34;net5.0&#34;</span> -o OrderProcessing
dotnet new webapi --framework <span>&#34;net5.0&#34;</span> -o OrderProcessing.Customer
dotnet new webapi --framework <span>&#34;net5.0&#34;</span> -o OrderProcessing.Product</code></pre><p>While the <code>OrderProcessing</code> project is an empty ASP.NET project, the other two projects are WebAPI projects. Ensure that you delete the default controller and entity classes from these two projects as we don‚Äôt need them.</p><h3 id="Create-the-Customer-microservice">Create the Customer microservice</h3><p>Create a new file named <code>Customer<span>.</span>cs</code> at the root of the <code>OrderProcessing<span>.</span>Customer</code> project with the following code in there:</p><pre><code><span>// OrderProcessing.Customer/Customer.cs</span>

<span>using</span> <span>System</span><span>;</span>

<span>namespace</span> <span>OrderProcessing<span>.</span>Customer</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>Customer</span>
    <span>{</span>
        <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> FirstName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> LastName <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> EmailAddress <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
<span>}</span></code></pre><h4 id="Create-the-CustomerRepository-class">Create the CustomerRepository class</h4><p>Create an interface named <code>ICustomerRepository</code> in a file named <code>ICustomerRepository<span>.</span>cs</code> at the root of the <code>OrderProcessing<span>.</span>Customer</code> project with the following code in there:</p><pre><code><span>// OrderProcessing.Customer/ICustomerRepository.cs</span>

<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>namespace</span> <span>OrderProcessing<span>.</span>Customer</span>
<span>{</span>
    <span>public</span> <span>interface</span> <span>ICustomerRepository</span>
    <span>{</span>
        <span>public</span> <span>Task<span>&lt;</span>List<span>&lt;</span>Customer<span>&gt;</span><span>&gt;</span></span> <span>GetAllCustomers</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Create the <code>CustomerRepository</code> class that implements the <code>ICustomerRepository</code> interface at the root of the <code>OrderProcessing<span>.</span>Customer</code> project as shown in the following code snippet:</p><pre><code><span>// OrderProcessing.Customer/CustomerRepository.cs</span>

<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Linq</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>namespace</span> <span>OrderProcessing<span>.</span>Customer</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>CustomerRepository</span> <span>:</span> <span><span>ICustomerRepository</span></span>
    <span>{</span>
        <span>private</span> <span>readonly</span> <span>List<span>&lt;</span>Customer<span>&gt;</span></span> customers <span>=</span> <span>new</span> <span>List<span>&lt;</span>Customer<span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
        <span>public</span> <span>CustomerRepository</span><span>(</span><span>)</span>
        <span>{</span>
            customers<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Customer</span><span>(</span><span>)</span>
            <span>{</span>
                Id <span>=</span> Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>,</span>
                FirstName <span>=</span> <span>&#34;Joydip&#34;</span><span>,</span>
                LastName <span>=</span> <span>&#34;Kanjilal&#34;</span><span>,</span>
                EmailAddress <span>=</span> <span>&#34;joydipkanjilal@yahoo.com&#34;</span>
            <span>}</span><span>)</span><span>;</span>

            customers<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Customer</span><span>(</span><span>)</span>
            <span>{</span>
                Id <span>=</span> Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>,</span>
                FirstName <span>=</span> <span>&#34;Steve&#34;</span><span>,</span>
                LastName <span>=</span> <span>&#34;Smith&#34;</span><span>,</span>
                EmailAddress <span>=</span> <span>&#34;stevesmith@yahoo.com&#34;</span>
            <span>}</span><span>)</span><span>;</span>
        <span>}</span>
        <span>public</span> <span>Task<span>&lt;</span>List<span>&lt;</span>Customer<span>&gt;</span><span>&gt;</span></span> <span>GetAllCustomers</span><span>(</span><span>)</span>
        <span>{</span>
            <span>return</span> Task<span>.</span><span>FromResult</span><span>(</span>customers<span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><h4 id="Create-the-CustomerController-class">Create the CustomerController class</h4><p>In the <code>Controllers</code> folder of the <code>OrderProcessing<span>.</span>Customer</code> project, create an API controller named <code>CustomerController</code> and replace the default code with the following:</p><pre><code><span>// OrderProcessing.Customer/Controllers/CustomerController.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>namespace</span> <span>OrderProcessing<span>.</span>Customer<span>.</span>Controllers</span>
<span>{</span>
    <span>[</span><span><span>Route</span><span><span>(</span><span>&#34;api/[controller]&#34;</span><span>)</span></span></span><span>]</span>
    <span>[</span><span><span>ApiController</span></span><span>]</span>
    <span>public</span> <span>class</span> <span>CustomerController</span> <span>:</span> <span><span>ControllerBase</span></span>
    <span>{</span>
        <span>private</span> <span>readonly</span> <span>ICustomerRepository</span> _customerRepository<span>;</span>
        <span>public</span> <span>CustomerController</span><span>(</span><span>ICustomerRepository</span> customerRepository<span>)</span>
        <span>{</span>
            _customerRepository <span>=</span> customerRepository<span>;</span>
        <span>}</span>

        <span>[</span><span><span>HttpGet</span></span><span>]</span>
        <span>public</span> <span>async</span> <span>Task<span>&lt;</span>ActionResult<span>&lt;</span>List<span>&lt;</span>Customer<span>&gt;</span><span>&gt;</span><span>&gt;</span></span> <span>GetAllCustomers</span><span>(</span><span>)</span>
        <span>{</span>
            <span>return</span> <span>await</span> _customerRepository<span>.</span><span>GetAllCustomers</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><h3 id="Create-the-Product-microservice">Create the Product microservice</h3><p>Create a new file named <code>Product<span>.</span>cs</code> at the root of the <code>OrderProcessing<span>.</span>Product</code> project with the following code in there:</p><pre><code><span>// OrderProcessing.Product/Product.cs</span>

<span>using</span> <span>System</span><span>;</span>

<span>namespace</span> <span>OrderProcessing<span>.</span>Product</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>Product</span>
    <span>{</span>
        <span>public</span> <span>Guid</span> Id <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Code <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>string</span></span> Name <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>int</span></span> Quantity_In_Stock <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
        <span>public</span> <span><span>decimal</span></span> Unit_Price <span>{</span> <span>get</span><span>;</span> <span>set</span><span>;</span> <span>}</span>
    <span>}</span>
<span>}</span></code></pre><h4 id="Create-the-ProductRepository-class">Create the ProductRepository class</h4><p>Next, you should create a new file called <code>IProductRepository<span>.</span>cs</code> in the <code>OrderProcessing<span>.</span>Product</code> project and write the following code to create the <code>IProductRepository</code> interface.</p><pre><code><span>// OrderProcessing.Product/IProductRepository.cs</span>

<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>namespace</span> <span>OrderProcessing<span>.</span>Product</span>
<span>{</span>
    <span>public</span> <span>interface</span> <span>IProductRepository</span>
    <span>{</span>
        <span>public</span> <span>Task<span>&lt;</span>List<span>&lt;</span>Product<span>&gt;</span><span>&gt;</span></span> <span>GetAllProducts</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Create the <code>ProductRepository</code> class that implements the <code>IProductRepository</code> interface at the root of the <code>OrderProcessing<span>.</span>Product</code> project as shown in the following code snippet:</p><pre><code><span>// OrderProcessing.Product/ProductRepository.cs</span>

<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>namespace</span> <span>OrderProcessing<span>.</span>Product</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>ProductRepository</span> <span>:</span> <span><span>IProductRepository</span></span>
    <span>{</span>
        <span>private</span> <span>readonly</span> <span>List<span>&lt;</span>Product<span>&gt;</span></span> products <span>=</span> <span>new</span> <span>List<span>&lt;</span>Product<span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
        <span>public</span> <span>ProductRepository</span><span>(</span><span>)</span>
        <span>{</span>
            products<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Product</span>
            <span>{</span>
                Id <span>=</span> Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>,</span>
                Code <span>=</span> <span>&#34;P0001&#34;</span><span>,</span>
                Name <span>=</span> <span>&#34;Lenovo Laptop&#34;</span><span>,</span>
                Quantity_In_Stock <span>=</span> <span>15</span><span>,</span>
                Unit_Price <span>=</span> <span>125000</span>
            <span>}</span><span>)</span><span>;</span>

            products<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Product</span>
            <span>{</span>
                Id <span>=</span> Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>,</span>
                Code <span>=</span> <span>&#34;P0002&#34;</span><span>,</span>
                Name <span>=</span> <span>&#34;DELL Laptop&#34;</span><span>,</span>
                Quantity_In_Stock <span>=</span> <span>25</span><span>,</span>
                Unit_Price <span>=</span> <span>135000</span>
            <span>}</span><span>)</span><span>;</span>

            products<span>.</span><span>Add</span><span>(</span><span>new</span> <span>Product</span>
            <span>{</span>
                Id <span>=</span> Guid<span>.</span><span>NewGuid</span><span>(</span><span>)</span><span>,</span>
                Code <span>=</span> <span>&#34;P0003&#34;</span><span>,</span>
                Name <span>=</span> <span>&#34;HP Laptop&#34;</span><span>,</span>
                Quantity_In_Stock <span>=</span> <span>20</span><span>,</span>
                Unit_Price <span>=</span> <span>115000</span>
            <span>}</span><span>)</span><span>;</span>
        <span>}</span>
        <span>public</span> <span>Task<span>&lt;</span>List<span>&lt;</span>Product<span>&gt;</span><span>&gt;</span></span> <span>GetAllProducts</span><span>(</span><span>)</span>
        <span>{</span>
            <span>return</span> Task<span>.</span><span>FromResult</span><span>(</span>products<span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><h4 id="Create-the-ProductController-class">Create the ProductController class</h4><p>In the <code>Controllers</code> folder of the <code>OrderProcessing<span>.</span>Product</code> project, create an API controller named <code>ProductController</code> and replace the default code with the following:</p><pre><code><span>// OrderProcessing.Product/ProductController.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Mvc</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>namespace</span> <span>OrderProcessing<span>.</span>Product<span>.</span>Controllers</span>
<span>{</span>
    <span>[</span><span><span>Route</span><span><span>(</span><span>&#34;api/[controller]&#34;</span><span>)</span></span></span><span>]</span>
    <span>[</span><span><span>ApiController</span></span><span>]</span>
    <span>public</span> <span>class</span> <span>ProductController</span> <span>:</span> <span><span>ControllerBase</span></span>
    <span>{</span>
        <span>private</span> <span>readonly</span> <span>IProductRepository</span> _productRepository<span>;</span>
        <span>public</span> <span>ProductController</span><span>(</span><span>IProductRepository</span> customerRepository<span>)</span>
        <span>{</span>
            _productRepository <span>=</span> customerRepository<span>;</span>
        <span>}</span>

        <span>[</span><span><span>HttpGet</span></span><span>]</span>
        <span>public</span> <span>async</span> <span>Task<span>&lt;</span>ActionResult<span>&lt;</span>List<span>&lt;</span>Product<span>&gt;</span><span>&gt;</span><span>&gt;</span></span> <span>GetAllCustomers</span><span>(</span><span>)</span>
        <span>{</span>
            <span>return</span> <span>await</span> _productRepository<span>.</span><span>GetAllProducts</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><h2 id="Implement-the-API-Gateway-Using-Ocelot">Implement the API Gateway Using Ocelot</h2><p>Now that the projects have been created with the necessary files in them, let‚Äôs implement the API Gateway using Ocelot.</p><p>Before going any further, you should be aware of the terms <strong>upstream</strong> and <strong>downstream</strong>. While upstream refers to the request sent by the client to the API Gateway, downstream is related to the request that the API Gateway sends to a particular microservice.</p><h3 id="Install-the-required-package">Install the required package</h3><p>To work with Ocelot, you must install it in your ASP.NET Core project. In our case, you will install Ocelot in the <code>OrderProcessing</code> project. You can do it by using the NuGet Package Manager inside Visual Studio IDE. Alternatively, you can execute the following command at the Package Manager Console window:</p><pre><code><span>Install-Package</span> Ocelot</code></pre><h3 id="Implement-routing">Implement routing</h3><p>An Ocelot API Gateway accepts an incoming HTTP request and forwards it to a downstream service. Ocelot makes use of routes to  define how a request is routed from one place to another. Add a new file named <code>ocelot<span>.</span>json</code> to this project with the following content in there:</p><pre><code><span>// OrderProcessing/Ocelot.json</span>
<span>{</span>
   <span>&#34;Routes&#34;</span><span>:</span><span>[</span>
      <span>//Customer API{</span>
         <span>&#34;DownstreamPathTemplate&#34;</span><span>:</span><span>&#34;/api/Customer&#34;</span><span>,</span>
         <span>&#34;DownstreamScheme&#34;</span><span>:</span><span>&#34;http&#34;</span><span>,</span>
         <span>&#34;DownstreamHostAndPorts&#34;</span><span>:</span><span>[</span>
            <span>{</span>
               <span>&#34;Host&#34;</span><span>:</span><span>&#34;localhost&#34;</span><span>,</span>
               <span>&#34;Port&#34;</span><span>:</span><span>&#34;20057&#34;</span>
            <span>}</span>
         <span>]</span><span>,</span>
         <span>&#34;UpstreamPathTemplate&#34;</span><span>:</span><span>&#34;/Customer&#34;</span><span>,</span>
         <span>&#34;UpstreamHttpMethod&#34;</span><span>:</span><span>[</span>
            <span>&#34;GET&#34;</span>
         <span>]</span>
      <span>}</span><span>,</span>
      <span>//Product API{</span>
         <span>&#34;DownstreamPathTemplate&#34;</span><span>:</span><span>&#34;/api/Product&#34;</span><span>,</span>
         <span>&#34;DownstreamScheme&#34;</span><span>:</span><span>&#34;http&#34;</span><span>,</span>
         <span>&#34;DownstreamHostAndPorts&#34;</span><span>:</span><span>[</span>
            <span>{</span>
               <span>&#34;Host&#34;</span><span>:</span><span>&#34;localhost&#34;</span><span>,</span>
               <span>&#34;Port&#34;</span><span>:</span><span>&#34;32345&#34;</span>
            <span>}</span>
         <span>]</span><span>,</span>
         <span>&#34;UpstreamPathTemplate&#34;</span><span>:</span><span>&#34;/Product&#34;</span><span>,</span>
         <span>&#34;UpstreamHttpMethod&#34;</span><span>:</span><span>[</span>
            <span>&#34;GET&#34;</span>
         <span>]</span>
      <span>}</span>
   <span>]</span>
<span>}</span></code></pre><p>The above configuration specifies the downstream and upstream metadata (scheme, path, ports) for the customer and product microservices. So, while use the upstream metadata to call the endpoints specified here, the request is routed to the appropriate downstream service as specified in the downstream metadata. In other words, the downstream metadata is used to specify the internal service URL to redirect a request to when the API Gateway receives a new request.</p><p>You should add Ocelot to the service container by calling the <code>AddOcelot</code> method in the <code>ConfigureServices</code> method of the <code>Startup</code> class as shown below:</p><pre><code><span>// OrderProcessing/Startup.cs</span>

<span>// ... existing code</span>

<span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span> 
<span>{</span>
  services<span>.</span><span>AddOcelot</span><span>(</span>Configuration<span>)</span><span>;</span>
<span>}</span>

<span>// ... existing code</span></code></pre><p>Next, you should enable Ocelot in the <code>Configure</code> method of the <code>Startup</code> class by calling the <code>UseOcelot</code> extension method as shown here:</p><pre><code><span>// OrderProcessing/Startup.cs</span>

<span>// ... existing code</span>

<span>public</span> <span><span>void</span></span> <span>Configure</span><span>(</span><span>IApplicationBuilder</span> app<span>,</span> <span>IWebHostEnvironment</span> env<span>)</span> 
<span>{</span>
  <span>if</span> <span>(</span>env<span>.</span><span>IsDevelopment</span><span>(</span><span>)</span><span>)</span>
  <span>{</span>
    app<span>.</span><span>UseDeveloperExceptionPage</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>
  app<span>.</span><span>UseOcelot</span><span>(</span><span>)</span><span>;</span>

  app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=&gt;</span> <span>{</span>
    endpoints<span>.</span><span>MapGet</span><span>(</span><span>&#34;/&#34;</span><span>,</span> <span>async</span> context <span>=&gt;</span> <span>{</span>
      <span>await</span> context<span>.</span>Response<span>.</span><span>WriteAsync</span><span>(</span><span>&#34;Hello World!&#34;</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>// ... existing code</span></code></pre><h3 id="Run-the-projects">Run the projects</h3><p>Now make sure that you&#39;ve made all three projects as startup projects. To do this, follow these steps:</p><ol start="1"><li>In the Solution Explorer window, right-click on the solution file.</li><li>Click &#34;Properties&#34;.</li><li>In the &#34;Property Pages&#34; window, select the &#34;Multiple startup projects&#34; radio button:</li></ol><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6has5yWrFDhGSMhgwEkrzK/6f237e6c673353528c0b7dbe2b8eef59/multiple-startup-projects-option.png" alt="Multiple startup projects option in Visual Studio"/></p><ol start="4"><li>Click Ok.</li></ol><p>Press the F5 key to run the application. Now send an HTTP Get request to the following URL from <a href="https://www.postman.com/" target="_blank" rel="noreferrer noopener">Postman</a> or any other HTTP client of your choice:</p><p><a href="http://localhost:39469/Customer" target="_blank" rel="noreferrer noopener">http://localhost:39469/Customer</a></p><p>The HTTP Get method of the Customer controller will be executed and the output will look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1HXo0qIRynV06ghuJGWzF9/3f3e0a5d04b69e8c9b7f752efa1eabc6/customer-response-from-microservice.png" alt="The Customer Microservice in Execution!"/></p><p>Send an HTTP Get request from Postman to the following URL:</p><p><a href="http://localhost:39469/Product" target="_blank" rel="noreferrer noopener">http://localhost:39469/Product</a></p><p>The request first goes to the API Gateway. Next, the API Gateway routes the request to the correct downstream microservice as specified in <code>ocelot<span>.</span>json</code>. The HTTP Get method named <code>GetAllProducts</code> of the <code>ProductController</code> will be called, and the output will look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/Y9M6Ephso4Stg4JJcDTQC/fa5e9ac505ca25b855ed544af7d1a0cf/product-response-from-microservice.png" alt="The Product Microservice in Execution!"/></p><h3 id="--Implement-rate-limiting--"><strong>Implement rate limiting</strong></h3><p>Rate limiting is a technique for controlling network traffic. It sets a limit on how many times you can perform a specific activity within a given period - for example, accessing a particular resource, logging into an account, etc. Typically, rate-limiting keeps track of the IP addresses and the time elapsed between requests. The IP address helps determine the source of a particular request.</p><p>A rate-limiting solution is adept at tracking the time elapsed between each request and the total number of requests in a particular period. If a single IP address makes excessive requests within a specific timeframe, the rate-limiting solution will reject the requests for a specified period.</p><p>In order to prevent your downstream services from being overburdened,  Ocelot enables rate-limiting of upstream requests. The following configuration illustrates how you specify rate-limiting in Ocelot:</p><pre><code><span>// OrderProcessing/Ocelot.json</span>

<span>&#34;RateLimitOptions&#34;</span><span>:</span><span>{</span>
   <span>&#34;ClientWhitelist&#34;</span><span>:</span><span>[</span>      
   <span>]</span><span>,</span>
   <span>&#34;EnableRateLimiting&#34;</span><span>:</span><span>true</span><span>,</span>
   <span>&#34;Period&#34;</span><span>:</span><span>&#34;5s&#34;</span><span>,</span>
   <span>&#34;PeriodTimespan&#34;</span><span>:</span><span>1</span><span>,</span>
   <span>&#34;Limit&#34;</span><span>:</span><span>1</span><span>,</span>
   <span>&#34;HttpStatusCode&#34;</span><span>:</span><span>429</span>
<span>}</span></code></pre><p>Let us now examine each of these options briefly:</p><ul><li><code>ClientWhitelist</code> setting - This is an array used to specify the clients that should not be affected by the rate-limiting.</li><li><code>EnableRateLimiting</code> setting - This is a boolean value, <code><span>true</span></code> if you want to enable rate-limiting, <code><span>false</span></code> otherwise.</li><li><code>HttpStatusCode</code> setting - This is used to specify <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429" target="_blank" rel="noreferrer noopener">the HTTP status code that is returned when rate limiting occurs</a>.</li><li><code>Period</code> setting - This specifies the duration that the rate limit is applicable, which in turn implies that if you make more requests within this duration than what is allowed, you&#39;ll need to wait for the duration specified in the <code>PeriodTimespan</code>.</li><li><code>PeriodTimespan</code> setting - This is used to specify the duration after which you can retry to connect to a service.</li><li><code>Limit</code> setting - This specifies the maximum number of requests that are allowed within the duration specified in <code>Period</code>.</li></ul><p>Let us assume that rate limiting is applied to the Product microservice only. The updated <code>ocelot<span>.</span>json</code> file will now look like this:</p><pre><code><span>// OrderProcessing/Ocelot.json</span>

<span>{</span>
   <span>&#34;Routes&#34;</span><span>:</span><span>[</span>
      <span>//Customer API</span>
     <span>{</span>
         <span>&#34;DownstreamPathTemplate&#34;</span><span>:</span><span>&#34;/api/Customer&#34;</span><span>,</span>
         <span>&#34;DownstreamScheme&#34;</span><span>:</span><span>&#34;http&#34;</span><span>,</span>
         <span>&#34;DownstreamHostAndPorts&#34;</span><span>:</span><span>[</span>
            <span>{</span>
               <span>&#34;Host&#34;</span><span>:</span><span>&#34;localhost&#34;</span><span>,</span>
               <span>&#34;Port&#34;</span><span>:</span><span>&#34;20057&#34;</span>
            <span>}</span>
         <span>]</span><span>,</span>
         <span>&#34;UpstreamPathTemplate&#34;</span><span>:</span><span>&#34;/Customer&#34;</span><span>,</span>
         <span>&#34;UpstreamHttpMethod&#34;</span><span>:</span><span>[</span>
            <span>&#34;GET&#34;</span>
         <span>]</span>
      <span>}</span><span>,</span>
      <span>//Product API</span>
      <span>{</span>
         <span>&#34;DownstreamPathTemplate&#34;</span><span>:</span><span>&#34;/api/Product&#34;</span><span>,</span>
         <span>&#34;DownstreamScheme&#34;</span><span>:</span><span>&#34;http&#34;</span><span>,</span>
         <span>&#34;DownstreamHostAndPorts&#34;</span><span>:</span><span>[</span>
            <span>{</span>
               <span>&#34;Host&#34;</span><span>:</span><span>&#34;localhost&#34;</span><span>,</span>
               <span>&#34;Port&#34;</span><span>:</span><span>&#34;32345&#34;</span>
            <span>}</span>
         <span>]</span><span>,</span>
         <span>&#34;RateLimitOptions&#34;</span><span>:</span><span>{</span>
            <span>&#34;ClientWhitelist&#34;</span><span>:</span><span>[</span>
               
            <span>]</span><span>,</span>
            <span>&#34;EnableRateLimiting&#34;</span><span>:</span><span>true</span><span>,</span>
            <span>&#34;Period&#34;</span><span>:</span><span>&#34;5s&#34;</span><span>,</span>
            <span>&#34;PeriodTimespan&#34;</span><span>:</span><span>1</span><span>,</span>
            <span>&#34;Limit&#34;</span><span>:</span><span>1</span>
         <span>}</span><span>,</span>
         <span>&#34;UpstreamPathTemplate&#34;</span><span>:</span><span>&#34;/Product&#34;</span><span>,</span>
         <span>&#34;UpstreamHttpMethod&#34;</span><span>:</span><span>[</span>
            <span>&#34;GET&#34;</span>
         <span>]</span>
      <span>}</span>
   <span>]</span>
<span>}</span></code></pre><p>Now, run the application and send frequent requests (more than 1 per 5sec) and you‚Äôll see the following error:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4E7h9U32IrkfVkDUte217c/adcd0d2f62ed0bdebd623ff74ac324c7/rate-limit-error.png" alt="Rate Limiting at work!"/></p><h3 id="Implement-caching">Implement caching</h3><p>Caching is a widely popular technique used in web applications to keep data in memory so that the same data may be quickly accessed when required by the application. Ocelot provides support for basic caching. To take advantage of it, you should install the <code>Ocelot<span>.</span>Cache<span>.</span>CacheManager</code> NuGet package as shown below:</p><pre><code><span>Install-Package</span> Ocelot<span>.</span>Cache<span>.</span>CacheManager</code></pre><p>Next, you should configure caching using the following code in the <code>ConfigureServices</code> method:</p><pre><code><span>// OrderProcessing/Startup.cs</span>

<span>// ... existing code ...</span>

<span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddOcelot</span><span>(</span>Configuration<span>)</span>
    <span>.</span><span>AddCacheManager</span><span>(</span>x <span>=&gt;</span>
      <span>{</span>
        x<span>.</span><span>WithDictionaryHandle</span><span>(</span><span>)</span><span>;</span>
      <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>// ... existing code ...</span></code></pre><p>Lastly, you should specify caching on a particular route in the route configuration using the following settings:</p><pre><code><span>// OrderProcessing/Ocelot.json</span>

<span>// ... existing settings ...</span>

<span>&#34;Routes&#34;</span><span>:</span><span>[</span>
   <span>//Customer API{</span>
      <span>&#34;DownstreamPathTemplate&#34;</span><span>:</span><span>&#34;/api/Customer&#34;</span><span>,</span>
      <span>&#34;DownstreamScheme&#34;</span><span>:</span><span>&#34;http&#34;</span><span>,</span>
      <span>&#34;DownstreamHostAndPorts&#34;</span><span>:</span><span>[</span>
         <span>{</span>
            <span>&#34;Host&#34;</span><span>:</span><span>&#34;localhost&#34;</span><span>,</span>
            <span>&#34;Port&#34;</span><span>:</span><span>&#34;20057&#34;</span>
         <span>}</span>
      <span>]</span><span>,</span>
      <span>&#34;FileCacheOptions&#34;</span><span>:</span><span>{</span>
         <span>&#34;TtlSeconds&#34;</span><span>:</span><span>30</span><span>,</span>
         <span>&#34;Region&#34;</span><span>:</span><span>&#34;customercaching&#34;</span>
      <span>}</span><span>,</span>
      <span>&#34;UpstreamPathTemplate&#34;</span><span>:</span><span>&#34;/Customer&#34;</span><span>,</span>
      <span>&#34;UpstreamHttpMethod&#34;</span><span>:</span><span>[</span>
         <span>&#34;GET&#34;</span>
      <span>]</span>
   <span>}</span>
<span>]</span>

<span>// ... existing settings ...</span></code></pre><p>Here, we&#39;ve set <code>TtlSeconds</code> to 30 seconds which implies that the cache will expire after this time has elapsed. Note that you should specify your cache configuration in the <code>FileCacheOptions</code> section. The <code>Region</code> setting identifies the area within the cache that will contain the data. This way you can clear that area by using the Ocelot&#39;s administration API. </p><p>To test this, you can set a breakpoint on the HTTP Get method named <code>GetAllCustomers</code> in the <code>CustomerController</code> class. When you execute the application and send an HTTP Get request to the endpoint, the breakpoint will be hit as usual. However, all subsequent calls to the same endpoint within 30 seconds (this is the duration we&#39;ve specified) will fetch data, but the breakpoint will not be hit anymore.</p><h3 id="Implement-correlation-ID">Implement correlation ID</h3><p>Ocelot enables a client to send a request Id in the header to the  server. Once this request Id is available in the middleware pipeline,  you can log it along with other information. Ocelot can also forward  this request Id to the downstream services if required. A <strong>correlation ID</strong> is a unique identifier attached to every request and response and used to track requests and responses in a distributed application. You can use either a request Id or a correlation ID when working with Ocelot to track requests.</p><p>The primary difference between a request Id and a correlation ID is that while the former uniquely identifies every HTTP request, the latter is a unique identifier attached to a particular request-response chain. While you can use <code>Request<span>-</span>Id</code> for every HTTP request, you can use <code><span>X</span><span>-</span>Correlation<span>-</span>Id</code> for an event chain of requests and responses. <code><span>X</span><span>-</span>Correlation<span>-</span>Id</code> is the name of the HTTP header attached to the downstream requests used to track HTTP requests that flow through multiple back-end services.</p><p>Ocelot must know the URL that it is running on in order to perform certain administration configurations. This is the <code>BaseUrl</code> specified in the <code>ocelot<span>.</span>json</code> file. Note that this URL should be the URL that your clients will see the API Gateway running on.</p><p>Here&#39;s the complete source code of the <code>ocelot<span>.</span>json</code> file for your reference:</p><pre><code><span>// OrderProcessing/Ocelot.json</span>

<span>{</span>
   <span>&#34;Routes&#34;</span><span>:</span><span>[</span>
      <span>//Customer API</span>
     <span>{</span>
         <span>&#34;DownstreamPathTemplate&#34;</span><span>:</span><span>&#34;/api/Customer&#34;</span><span>,</span>
         <span>&#34;DownstreamScheme&#34;</span><span>:</span><span>&#34;http&#34;</span><span>,</span>
         <span>&#34;DownstreamHostAndPorts&#34;</span><span>:</span><span>[</span>
            <span>{</span>
               <span>&#34;Host&#34;</span><span>:</span><span>&#34;localhost&#34;</span><span>,</span>
               <span>&#34;Port&#34;</span><span>:</span><span>&#34;20057&#34;</span>
            <span>}</span>
         <span>]</span><span>,</span>
         <span>&#34;FileCacheOptions&#34;</span><span>:</span><span>{</span>
            <span>&#34;TtlSeconds&#34;</span><span>:</span><span>30</span><span>,</span>
            <span>&#34;Region&#34;</span><span>:</span><span>&#34;customercaching&#34;</span>
         <span>}</span><span>,</span>
         <span>&#34;UpstreamPathTemplate&#34;</span><span>:</span><span>&#34;/Customer&#34;</span><span>,</span>
         <span>&#34;UpstreamHttpMethod&#34;</span><span>:</span><span>[</span>
            <span>&#34;GET&#34;</span>
         <span>]</span>
      <span>}</span><span>,</span>
      <span>//Product API</span>
     <span>{</span>
         <span>&#34;DownstreamPathTemplate&#34;</span><span>:</span><span>&#34;/api/Product&#34;</span><span>,</span>
         <span>&#34;DownstreamScheme&#34;</span><span>:</span><span>&#34;http&#34;</span><span>,</span>
         <span>&#34;DownstreamHostAndPorts&#34;</span><span>:</span><span>[</span>
            <span>{</span>
               <span>&#34;Host&#34;</span><span>:</span><span>&#34;localhost&#34;</span><span>,</span>
               <span>&#34;Port&#34;</span><span>:</span><span>&#34;32345&#34;</span>
            <span>}</span>
         <span>]</span><span>,</span>
         <span>&#34;RateLimitOptions&#34;</span><span>:</span><span>{</span>
            <span>&#34;ClientWhitelist&#34;</span><span>:</span><span>[</span>
               
            <span>]</span><span>,</span>
            <span>&#34;EnableRateLimiting&#34;</span><span>:</span><span>true</span><span>,</span>
            <span>&#34;Period&#34;</span><span>:</span><span>&#34;5s&#34;</span><span>,</span>
            <span>&#34;PeriodTimespan&#34;</span><span>:</span><span>1</span><span>,</span>
            <span>&#34;Limit&#34;</span><span>:</span><span>1</span>
         <span>}</span><span>,</span>
         <span>&#34;UpstreamPathTemplate&#34;</span><span>:</span><span>&#34;/Product&#34;</span><span>,</span>
         <span>&#34;UpstreamHttpMethod&#34;</span><span>:</span><span>[</span>
            <span>&#34;GET&#34;</span>
         <span>]</span>
      <span>}</span>
   <span>]</span><span>,</span>
   <span>&#34;GlobalConfiguration&#34;</span><span>:</span><span>{</span>
      <span>&#34;RequestIdKey&#34;</span><span>:</span><span>&#34;X-Correlation-Id&#34;</span><span>,</span>
      <span>&#34;BaseUrl&#34;</span><span>:</span><span>&#34;http://localhost:39469&#34;</span>
   <span>}</span>
<span>}</span></code></pre><h2 id="Conclusion">Conclusion</h2><p>Choosing an exemplary architecture for the needs of your business is the first and foremost step in building applications that are flexible, scalable, and high performant. One of the most significant advantages of microservices architecture is its support for heterogeneous platforms and technologies.</p><p>Your API Gateway can manage concerns such as security, rate limiting, performance, and scalability. However, you should be aware of handling the complexity it brings in and the risk of a single point of failure. Besides, there is a learning curve when you&#39;re building microservices-based applications using an API Gateway. Possible performance degradation is yet another concern that you must handle.</p><p>The complete source code of the <em>OrderProcessing</em> application built throughout this article is available <a href="https://github.com/auth0-blog/api-gateway-aspnetcore-ocelot" target="_blank" rel="noreferrer noopener">here</a>.</p><div><h2 id="Aside--Securing-ASP-NET-Core-with-Auth0">Aside: Securing ASP.NET Core with Auth0</h2><p>Securing ASP.NET Core applications with Auth0 is easy and brings a lot of great features to the table. With <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>, you only have to write a few lines of code to get a solid <a href="https://auth0.com/user-management" target="_blank" rel="noreferrer noopener">identity management solution</a>, <a href="https://auth0.com/docs/sso/single-sign-on" target="_blank" rel="noreferrer noopener">single sign-on</a>, support for <a href="https://auth0.com/docs/identityproviders" target="_blank" rel="noreferrer noopener">social identity providers (like Facebook, GitHub, Twitter, etc.)</a>, and support for <a href="https://auth0.com/enterprise" target="_blank" rel="noreferrer noopener">enterprise identity providers (like Active Directory, LDAP, SAML, custom, etc.)</a>.</p><p>On ASP.NET Core, you need <a href="https://auth0.com/docs/apis" target="_blank" rel="noreferrer noopener">to create an API in your Auth0 Management Dashboard</a> and change a few things on your code. To create an API, you need to <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free Auth0 account</a>. After that, you need to go to <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">the API section of the dashboard</a> and click on &#34;Create API&#34;. On the dialog shown, you can set the <em>Name</em> of your API as &#34;Books&#34;, the <em>Identifier</em> as &#34;<a href="http://books.mycompany.com" target="_blank" rel="noreferrer noopener">http://books.mycompany.com</a>&#34;, and leave the <em>Signing Algorithm</em> as &#34;RS256&#34;.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6HrObJ2eGY7YehLzbBM0sH/066be814a124d98f03224d9b177caa22/net-core-2_creating-api-on-auth0.png" alt="Creating API on Auth0"/></p><p>After that, you have to add the call to <code>services<span>.</span><span>AddAuthentication</span><span>(</span><span>)</span></code> in the <code><span>ConfigureServices</span><span>(</span><span>)</span></code> method of the <code>Startup</code> class as follows:</p><pre><code><span><span>string</span></span> authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>/&#34;</span></span><span>;</span>
<span><span>string</span></span> audience <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>;</span>

services<span>.</span><span>AddAuthentication</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  options<span>.</span>DefaultAuthenticateScheme <span>=</span> JwtBearerDefaults<span>.</span>AuthenticationScheme<span>;</span>
  options<span>.</span>DefaultChallengeScheme <span>=</span> JwtBearerDefaults<span>.</span>AuthenticationScheme<span>;</span>
<span>}</span><span>)</span><span>.</span><span>AddJwtBearer</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  options<span>.</span>Authority <span>=</span> authority<span>;</span>
  options<span>.</span>Audience <span>=</span> audience<span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>In the body of the <code><span>Configure</span><span>(</span><span>)</span></code> method of the <code>Startup</code> class, you also need to add an invocation to <code>app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span></code> and <code>app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span></code> as shown below:</p><pre><code>app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=&gt;</span>
<span>{</span>
    endpoints<span>.</span><span>MapControllers</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><blockquote><p>Make sure you invoke these methods in the order shown above. It is essential so that everything works properly.</p></blockquote><p>Finally, add the following element to the <code>appsettings<span>.</span>json</code> configuration file:</p><pre><code><span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
    <span>// ...</span>
  <span>}</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;YOUR_DOMAIN&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;YOUR_AUDIENCE&#34;</span>
  <span>}</span>
<span>}</span></code></pre><blockquote><p><strong>Note</strong>: Replace the placeholders <code><span>YOUR_DOMAIN</span></code> and <code><span>YOUR_AUDIENCE</span></code> with the actual values for the domain that you specified when creating your Auth0 account and the <em>Identifier</em> you assigned to your API.</p></blockquote></div></div></div>]]></content:encoded>
      <pubDate>Tue, 05 Oct 2021 14:51:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Introduces zanzibar.academy</title>
      <link>https://auth0.com/blog/auth0-introduces-zanzibar-academy/</link>
      <description>A microsite to help developers understand how a Zanzibar style system works.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>While our customers tell us they appreciate our Authentication (AuthN) features, we‚Äôve seen an increase in requests to expand our Authorization (AuthZ) offering to help builders accelerate their development. This is why we‚Äôve released key features like <a href="https://auth0.com/blog/introducing-auth0-organizations/" target="_blank" rel="noreferrer noopener">Organizations</a> and <a href="https://auth0.com/docs/authorization/rbac/roles" target="_blank" rel="noreferrer noopener">Roles</a>.</p><p>While reading <a href="https://research.google/pubs/pub48190/" target="_blank" rel="noreferrer noopener">Google‚Äôs Zanzibar paper</a> describing their global access system, we found the approach to be highly creative and inspiring. It had the flexibility to support so many of their products and was scalable, highly reliable, and extremely fast. Companies like <a href="https://medium.com/airbnb-engineering/himeji-a-scalable-centralized-system-for-authorization-at-airbnb-341664924574" target="_blank" rel="noreferrer noopener">Airbnb</a> and <a href="https://medium.com/building-carta/authz-cartas-highly-scalable-permissions-system-782a7f2c840f" target="_blank" rel="noreferrer noopener">Carta</a> have developed their own version, and companies and new products are being built inspired by Zanzibar. This is why we believe that Authorization systems built using the Zanzibar model are going to grow in number over the next few years.</p><h2 id="What-is-Zanzibar">What is Zanzibar</h2><p>Zanzibar is Google‚Äôs global authorization system. It powers authorization for YouTube, Google Drive, Google Workspaces, Google Cloud Platform, and their other services. It drives Google‚Äôs core collaboration features like sharing a document with someone or sharing photos with a friend. Like anything Google makes, it has to scale to billions of users and trillions of digital objects. Creating an access control system for that many people and object combinations is a daunting task, and Google laid out how they did it in their <a href="https://research.google/pubs/pub48190/" target="_blank" rel="noreferrer noopener">2019 Google Zanzibar paper</a>. It talks about the different considerations and tradeoffs they made. Simplicity and extensibility were key considerations because Google needed to ensure that its internal teams could use the system for a wide array of use cases with certainty with how it would respond to their specific needs.</p><p>Zanzibar has steadily grown in popularity since the paper‚Äôs release. We set out this past year to talk with the organizations about their implementation experiences, and learn from what worked and didn‚Äôt work. You can find some of those discussions <a href="https://www.youtube.com/playlist?list=PLZuCrkqyqw9wY0bCosGYDMI9enFpg_tk-" target="_blank" rel="noreferrer noopener">here</a><a href="https://www.youtube.com/playlist?list=PLZuCrkqyqw9wY0bCosGYDMI9enFpg_tk-." target="_blank" rel="noreferrer noopener">.</a></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6NDVD79nUcJB0wtfL9OM4v/1ec383bc257192ca0b2c83438c27891b/Uploaded_from_Auth0_Introduces_zanzibar" alt="Zanzibar"/></p><h2 id="Introducing-Zanzibar-Academy">Introducing Zanzibar Academy</h2><p>We&#39;ve always pushed to create content that is useful for the global development community and today we‚Äôre taking another important step in our Authorization journey by releasing the <a href="http://zanzibar.academy" target="_blank" rel="noreferrer noopener">zanzibar.academy</a> learning site. <a href="http://zanzibar.academy" target="_blank" rel="noreferrer noopener">Zanzibar.academy</a> is meant to help builders understand the value and power of Zanzibar style systems, much like <a href="http://jwt.io" target="_blank" rel="noreferrer noopener">JWT.io</a> educates and spreads the understanding of the JSON Web Token standard. It‚Äôs a place for builders to learn the Zanzibar concepts in a progressive, guided way.</p><h2 id="ReBAC-in-a-Wider-AuthZ-World">ReBAC in a Wider AuthZ World</h2><p>One of the key differences between Google Zanzibar and other AuthZ systems is that Google Zanzibar uses graph-based data structures to create Relationship-Based Access Control (ReBAC). ReBAC centralizes more data so Access Control Lists (ACLs) are less cumbersome to manage.</p><p>With no viable alternatives, organizations have been rolling their own AuthZ, or extending systems like OPA, that handle policies for authorization based on attribute-based access control (ABAC), to manage things outside their typical use cases. These types of systems give developers an incredible amount of control over their authorization decisions, but also an incredible amount of responsibility to develop and manage them. Policies are also hard to build against, it‚Äôs very hard to create filtered lists of accessible resources in a search function based on a policy system.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/68daT6P0GYPtQtDBUFqTFL/3eecd0d6e0390c61e23d0e454bd6c09c/Uploaded_from_Auth0_Introduces_zanzibar" alt="ReBAC"/></p><p>Instead, Zanzibar offers a system that can be indexed and reverse indexed for various purposes in an application. It‚Äôs easily extensible, so new features can easily be added. In our own version we‚Äôre working to make this process easier for developers by creating an out-of-the-box assertions system, so developers can create automated tests of changes to their implementation. Zanzibar-style systems won‚Äôt solve all AtuthZ problems, there is still an important place for OPA-style ABAC systems, but Zanzibar systems will only be more widely adopted as time goes on.</p><h2 id="Supporting-Builders">Supporting Builders</h2><p>Auth0 is here to support builders ‚Äî and, frankly, what the team at Google created is inspiring. But learning from a paper isn‚Äôt always easy. With the Zanzibar Academy website and related presentations, we seek to make the concepts and practices in the Zanzibar paper easier to understand with interactive descriptions and examples ‚Äî always with full credit to the original team.</p><p>We‚Äôre further supporting builders by creating our own version for developers to use. You can explore our implementation <a href="http://learn.sandcastle.cloud" target="_blank" rel="noreferrer noopener">here</a>. Inspired by the Zanzibar paper, we‚Äôve applied our 8 years of experience in building tools for developers to build a version all builders will be delighted to use.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3f4HlkamlZDMh86euuxGTo/8675f6c32d593e6d3f96fc5aec43c379/Uploaded_from_Auth0_Introduces_zanzibar" alt="Supporting"/></p><p>We‚Äôre excited for you to learn more at <a href="http://zanzibar.academy" target="_blank" rel="noreferrer noopener">zanzibar.academy</a>, we‚Äôll see you there! If you‚Äôre interested in learning more about Zanzibar and <a href="http://learn.sandcastle.cloud" target="_blank" rel="noreferrer noopener">Auth0s new Zanzibar based AuthZ platform</a>, join our <a href="https://discord.com/invite/pvbNmqC" target="_blank" rel="noreferrer noopener">Discord community</a>.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 05 Oct 2021 13:54:00 +0000</pubDate>
    </item>
    <item>
      <title>Flutter Authentication and Authorization with Auth0, Part 3: Adding Real-Time Chat to the App</title>
      <link>https://auth0.com/blog/flutter-authentication-authorization-with-auth0-part-3-adding-real-time-chat-to-the-app/</link>
      <description>In this tutorial, you‚Äôll learn how to enhance your Flutter apps by enabling authentication, supporting federated identity providers, adding authorization by introducing roles and permissions, all leveraging Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the previous sections of this tutorial, you added authentication to <em>MJ Coffee</em>, a Flutter app, and then enhanced that authentication by adding refresh token rotation and social logins. You also looked at customizing the login page with your own branding, and user management in Auth0.</p><p>In this section, we‚Äôll focus on authorization. Remember:</p><ul><li><strong>Authentication</strong> concerns itself with answering the question ‚ÄúWho are you?‚Äù</li><li><strong>Authorization</strong> ‚Äî this section‚Äôs topic ‚Äî¬†is all about answering the question ‚ÄúWhat are you allowed to do?‚Äù</li></ul><p>We‚Äôll cover authorization by adding real-time chat to <em>MJ Coffee</em> so that we can later see how the chat can be integrated with Auth0, limit its functionalities and UIs based on roles and permissions.</p><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong></p></blockquote><h2 id="Add-Real-Time-Chat-to-the-Flutter-Application">Add Real-Time Chat to the Flutter Application</h2><p>Having a real-time chat service in the <em>MJ Coffee</em> app can significantly improve how fast users can communicate with our customer service or employees. Having looked around, I found <a href="https://getstream.io" target="_blank" rel="noreferrer noopener">Stream</a>, an exciting service with a solid Flutter SDK that you can integrate and customize quickly and easily.</p><h2 id="Install-Dependencies">Install Dependencies</h2><p>Stream comes with several SDKs that can be used in Dart or Flutter applications. However, one of them comes with all features, a beautiful theme, and enough API so that you can customize it as much as you wish. We‚Äôll use that one.</p><p>üõ† Open the <code><span>/</span>pubspec<span>.</span>yaml</code> file and add <code>stream_chat_flutter</code> to your dependencies. The <code>dependencies</code> section of the file should end up looking like this:</p><pre><code>// /pubspec.yaml

<span>dependencies</span><span>:</span>
  <span>flutter</span><span>:</span>
    <span>sdk</span><span>:</span> flutter
  <span>font_awesome_flutter</span><span>:</span> ^9.1.0
  <span>flutter_svg</span><span>:</span> ^0.22.0
  <span>google_fonts</span><span>:</span> ^2.1.0
  <span>json_annotation</span><span>:</span> ^4.0.1
  <span>http</span><span>:</span> ^0.13.3
  <span>flutter_appauth</span><span>:</span> ^1.1.0
  <span>flutter_secure_storage</span><span>:</span> ^4.2.0
  <span>stream_chat_flutter</span><span>:</span> ^2.0.0</code></pre><p>I recommend using a version later than 2.0, which is fully compatible with Flutter 2 and its support for <a href="https://flutter.dev/docs/null-safety" target="_blank" rel="noreferrer noopener">null safety</a>.</p><p>If you‚Äôre only targeting Android, you can ignore the next section.</p><h4 id="If-you-re-targeting-iOS">If you‚Äôre targeting iOS</h4><p>üõ† If you‚Äôre targeting iOS, you‚Äôll need to take a few extra steps:</p><ul><li>The Stream library uses the <a href="https://github.com/miguelpruivo/flutter_file_picker" target="_blank" rel="noreferrer noopener"><em>flutter file picker</em> plugin</a> to present the user with an interface to select files. You‚Äôll need to follow the steps in <a href="https://github.com/miguelpruivo/flutter_file_picker/wiki/Setup#ios" target="_blank" rel="noreferrer noopener">the <em>iOS</em> section of this page</a> to make use of it.</li><li>The library also uses the <em>video_player</em> plugin to display inline videos. Follow <a href="https://pub.dev/packages/video_player#installation" target="_blank" rel="noreferrer noopener">this guide</a> to install and enable it.</li><li>Finally, the library uses the <em>image_picker</em> plugin to provide a user interface for selecting images. Follow [these instructions] to use this plugin.</li></ul><p>üõ† Don‚Äôt forget to actually install the dependencies! Enter <code>flutter pub get</code> in the terminal or PowerShell, or <code>Pub get</code> in your IDE.</p><h2 id="Create-a-Stream-Account-and-App">Create a Stream Account and App</h2><p>Before you can integrate Stream with your app, you need a Stream account, which you‚Äôll use to register the app.</p><p>üõ† <a href="https://getstream.io/accounts/signup/" target="_blank" rel="noreferrer noopener">Create your account if you don‚Äôt already have one,</a> then log in and go to the Stream dashboard:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5g116jkNGeqaZvFk5nesaZ/e01470d789d92e658ca0d4ac16605d5e/stream_dashboard.png" alt="Stream dashboard."/></p><p>üõ† Tap on the <strong>Create App</strong> button, then follow these steps:</p><ul><li>Enter a name for your app in the <strong>App Name</strong> field. For this example, we‚Äôll use <code>MJCoffee</code>.</li><li>In the <strong>Feeds Server Location</strong> menu, select the location closest to you.</li><li><em>Don‚Äôt</em> select anything from the <strong>Clone Existing App</strong> menu ‚Äî just leave it set to <code><span>--</span><span>-</span></code>.</li><li>Select your environment. Usually, it&#39;s a good idea to create separate apps for production and development. In this tutorial, we‚Äôll focus on production, so select <strong>Production</strong>.</li><li>Finally, click the <strong>Create App</strong> button.</li></ul><p>You should see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Zh9QmY69R9Bwo4p3PZawt/f8c55e169d20282c17e3592216344fd6/stream_app.png" alt="A newly-created app in Stream."/></p><p>üõ† Once your app has been created, make a note of your Stream key. </p><p>Notice that you will need a secret key to sign the user ID and get a production user token to connect users. You‚Äôll learn how to do that with Auth0 Actions.</p><p>I recommend passing sensitive data and keys with <code><span>--</span>dart<span>-</span>define</code> via the command line or adding to your editor or IDE run command rather than storing it in your app‚Äôs code.</p><p>You took this approach when implementing basic authentication for the app. You passed two sensitive values ‚Äî your Auth0 domain and Auth0 client ID ‚Äî as command-line arguments when launching the app. You‚Äôll simply add the Stream key as a third argument, like so:</p><pre><code>flutter run -d all --dart-define<span>=</span>AUTH0_DOMAIN<span>=</span><span>[</span>YOUR DOMAIN<span>]</span> --dart-define<span>=</span>AUTH0_CLIENT_ID<span>=</span><span>[</span>YOUR CLIENT ID<span>]</span> --dart-define<span>=</span>STREAM_API_KEY<span>=</span><span>[</span>YOUR STREAM KEY<span>]</span></code></pre><p>In order for your application to use the Stream key argument, you‚Äôll need to define a new constant.</p><p>üõ† Add the following to your <code>constants<span>.</span>dart</code> file, which is located in the in the <code><span>/</span>lib<span>/</span>helpers<span>/</span></code> directory:</p><pre><code><span>// /lib/helpers/constants.dart</span>

<span>const</span> STREAM_API_KEY <span>=</span> String<span>.</span><span>fromEnvironment</span><span>(</span><span>&#39;STREAM_API_KEY&#39;</span><span>)</span><span>;</span></code></pre><h2 id="Integrate-Chat-Into-the-Flutter-Application">Integrate Chat Into the Flutter Application</h2><p>Let&#39;s start by creating a new <code>StreamChatClient</code> in the <code>ChatService</code> singleton class. In doing this, there are three essential things that you need to take into account:</p><ol start="1"><li>Initializing the Dart API client with your API Key</li><li>Setting the current user</li><li>Passing the client to the top-level StreamChat widget</li></ol><p>üõ† Open <code>chat_service<span>.</span>dart</code> (located in the <code><span>/</span>lib<span>/</span>services<span>/</span></code> directory) and initialize <code>StreamChatClient</code> by updating the <code>ChatService</code> class so that it appears as follows:</p><pre><code><span>// /lib/services/chat_service.dart</span>

<span>class</span> <span>ChatService</span> <span>{</span>
  <span>static</span> <span>final</span> ChatService instance <span>=</span> ChatService<span>.</span><span>_internal</span><span>(</span><span>)</span><span>;</span>
  <span>factory</span> <span>ChatService</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> instance<span>;</span>
  ChatService<span>.</span><span>_internal</span><span>(</span><span>)</span><span>;</span>

  <span>final</span> StreamChatClient client <span>=</span> <span>StreamChatClient</span><span>(</span>
    STREAM_API_KEY<span>,</span>
    logLevel<span>:</span> isInDebugMode <span>?</span> Level<span>.</span>INFO <span>:</span> Level<span>.</span>OFF<span>,</span>
  <span>)</span><span>;</span>

<span>}</span></code></pre><p>The only required positional parameter for <code><span>StreamChatClient</span><span>(</span><span>)</span></code> is <code><span>STREAM_API_KEY</span></code>, but you have more options to configure your client. For instance, it might be pretty helpful to see all the logs during debugging. That&#39;s why we used the optional <code>logLevel</code> parameter to set the amount of logging that will take place, based on whether or not the app is in debug mode.</p><p>Now that you‚Äòve created the client, you need to ensure that your current user is connected appropriately.</p><p>üõ† Add the <code><span>connectUser</span><span>(</span><span>)</span></code> to the <code>ChatService</code> class in  <code>chat_service<span>.</span>dart</code>:</p><pre><code><span>// /lib/services/chat_service.dart</span>

<span>class</span> <span>ChatService</span> <span>{</span>

<span>.</span><span>.</span><span>.</span>

  Future<span>&lt;</span>Auth0User<span>&gt;</span> <span>connectUser</span><span>(</span>Auth0User<span>?</span> user<span>)</span> <span>async</span> <span>{</span>
    <span>if</span> <span>(</span>user <span>==</span> <span>null</span><span>)</span> <span>{</span>
      <span>throw</span> <span>Exception</span><span>(</span><span>&#39;User was not received&#39;</span><span>)</span><span>;</span>
    <span>}</span>
    <span>await</span> client<span>.</span><span>connectUser</span><span>(</span>
      <span>User</span><span>(</span>
        id<span>:</span> user<span>.</span>id<span>,</span>
        extraData<span>:</span> <span>{</span>
          <span>&#39;image&#39;</span><span>:</span> user<span>.</span>picture<span>,</span>
          <span>&#39;name&#39;</span><span>:</span> user<span>.</span>name<span>,</span>
        <span>}</span><span>,</span>
      <span>)</span><span>,</span>
      <span>// To be replaced with PRODUCTION TOKEN for user</span>
      client<span>.</span><span>devToken</span><span>(</span>user<span>.</span>id<span>)</span><span>.</span>rawValue<span>,</span>
    <span>)</span><span>;</span>
    <span>return</span> user<span>;</span>
  <span>}</span>
  
<span>.</span><span>.</span><span>.</span>
  
<span>}</span></code></pre><p>This new method of the <code>ChatService</code> class, <code><span>connectUser</span><span>(</span><span>)</span></code>, will handle the logic for connecting the current user. It accepts an <code>Auth0User</code> object. If it doesn‚Äòt receive one, it means the authentication has probably failed and that the user should not be connected to the chat.</p><p>üõ† Open <code><span>/</span>lib<span>/</span>screens<span>/</span>home<span>.</span>dart</code>, look for the <code>_HomeScreenState</code> class, and within it, the <code><span>setSuccessAuthState</span><span>(</span><span>)</span></code> method. Update <code><span>setSuccessAuthState</span><span>(</span><span>)</span></code> to the following:</p><pre><code><span>// /lib/screens/home.dart</span>

<span>setSuccessAuthState</span><span>(</span><span>)</span> <span>{</span>
  <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
    isProgressing <span>=</span> <span>false</span><span>;</span>
    isLoggedIn <span>=</span> <span>true</span><span>;</span>
    name <span>=</span> AuthService<span>.</span>instance<span>.</span>idToken<span>?</span><span>.</span>name<span>;</span>
  <span>}</span><span>)</span><span>;</span>

  ChatService<span>.</span>instance<span>.</span><span>connectUser</span><span>(</span>AuthService<span>.</span>instance<span>.</span>profile<span>)</span><span>;</span>
  CoffeeRouter<span>.</span>instance<span>.</span><span>push</span><span>(</span>MenuScreen<span>.</span><span>route</span><span>(</span><span>)</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>You need to pass two required positional parameters:</p><ul><li>The <code>User</code> object with a defined user ID, and</li><li>the user token, a signed and encrypted hash string.</li></ul><p>Typically, the user token should be generated on a back-end server to store the aforementioned secret key and to sign and get the token. You&#39;ll soon learn how Auth0 can handle that as your backend.</p><p>To continue, you need to:</p><ul><li>Get a development token,</li><li>pass <code>user<span>.</span>id</code> to the <code><span>devToken</span><span>(</span><span>)</span></code> method on the chat client, and</li><li>Get the <code>rawValue</code> which is the token string.</li></ul><p>üõ† To ensure that <code>devToken</code> works, you need to disable auth checks. In the <code>GetStream</code> app‚Äôs chat dashboard, turn on the <strong>Disable Auth0 Checks</strong> option.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3DMx1hZFHbDqt50gtJErjO/9c4c7e3c1da342ddf10c8fb208ac8960/disable_auth_checks.png" alt="Stream dashboard."/></p><blockquote><p>When you move the app to production and you have a proper method to receive the production token, make sure that you turn off the <strong>Disable Auth0 Checks</strong> option.</p></blockquote><p>Stream chat UI components will accept additional data that you provide while connecting a user. For example, you may create a <code>Map</code> containing the user‚Äòs image and name, so they appear automatically and beautifully throughout the chat widget.</p><p>At the time of writing, Stream does not accept Auth0‚Äôs user ID format, which includes <code><span>|</span></code> between the Auth source and user hash ID. You‚Äôll need to make a change to the <code>id</code> arrow function in the <code>Auth0User</code> model to account for this.</p><p>üõ† Open <code><span>/</span>lib<span>/</span>models<span>/</span>auth0_user<span>.</span>dart</code> and make this change to the <code>id</code> arrow function: </p><pre><code><span>// /lib/models/auth0_user.dart</span>

String <span>get</span> id <span>=</span><span>&gt;</span> sub<span>.</span><span>split</span><span>(</span><span>&#39;|&#39;</span><span>)</span><span>.</span><span>join</span><span>(</span><span>&#39;&#39;</span><span>)</span><span>;</span></code></pre><p>The next and final step is to create <code>StreamChat</code>, the root widget of the application.</p><p>üõ† Open the <code><span>/</span>lib<span>/</span>main<span>.</span>dart</code> file, locate the call to  <code>MaterialApp</code>, and add the <code>builder</code> parameter so that it returns a <code>StreamChat</code> object:</p><pre><code><span>// /lib/main.dart</span>

<span>.</span><span>.</span><span>.</span>
<span>MaterialApp</span><span>(</span>
  debugShowCheckedModeBanner<span>:</span> <span>false</span><span>,</span>
  themeMode<span>:</span> ThemeMode<span>.</span>system<span>,</span>
  home<span>:</span> <span>HomeScreen</span><span>(</span><span>)</span><span>,</span>
  navigatorKey<span>:</span> CoffeeRouter<span>.</span>instance<span>.</span>navigatorKey<span>,</span>
  theme<span>:</span> <span>getTheme</span><span>(</span><span>)</span><span>,</span>
  builder<span>:</span> <span>(</span>context<span>,</span> child<span>)</span> <span>{</span>
    <span>return</span> <span>StreamChat</span><span>(</span>
      child<span>:</span> child<span>,</span>
      client<span>:</span> ChatService<span>.</span>instance<span>.</span>client<span>,</span>
    <span>)</span><span>;</span>
  <span>}</span><span>,</span>
<span>)</span><span>,</span>
<span>.</span><span>.</span><span>.</span></code></pre><p>The <code>StreamChat</code> object returned by <code>builder</code> is an inherited widget and aims to provide APIs for advanced customization. It requires a child and a client that you have initialized in the <code>ChatService</code> class.</p><p>That&#39;s it ‚Äî your chat is ready! Restart the app, and let&#39;s continue to add the support screen and community screen using the prebuilt <code>StreamChat</code> UI widget to leverage the chat service that you added.</p><h2 id="Implement-the-Support-Chat-Screen">Implement the Support Chat Screen</h2><p>Typically, a support chat consists of a user and an agent interacting in a channel created for both. Hence the support chat screen will do the following:</p><ul><li>Create a private channel for the current user and one of the available agents</li><li>Listen to the channel for updates</li><li>Load existing chat content, if any</li><li>Upon chat completion, archive the chat history</li></ul><p>Let&#39;s create a <code><span>createSupportChat</span><span>(</span><span>)</span></code> method in the <code>ChatService</code> class.</p><p>üõ† First, add the following instance variable to the start of the <code>ChatService</code> class:</p><pre><code><span>// /lib/services/chat_service.dart</span>

String<span>?</span> _currentChannelId<span>;</span></code></pre><p>üõ† Then add the <code><span>createSupportChat</span><span>(</span><span>)</span></code> method to the <code>ChatService</code> class:</p><pre><code><span>// /lib/services/chat_service.dart</span>

Future<span>&lt;</span>Channel<span>&gt;</span> <span>createSupportChat</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
  <span>// To be replaced with EmployeeRole via Auth0</span>
  <span>final</span> String employeeId <span>=</span> <span>&#39;rootEmployeeId&#39;</span><span>;</span>
  <span>final</span> channel <span>=</span> client<span>.</span><span>channel</span><span>(</span>
    <span>&#39;support&#39;</span><span>,</span>
    id<span>:</span> _currentChannelId<span>,</span>
    extraData<span>:</span> <span>{</span>
      <span>&#39;name&#39;</span><span>:</span> <span>&#39;MJCoffee Support&#39;</span><span>,</span>
      <span>&#39;members&#39;</span><span>:</span> <span>[</span>
        employeeId<span>,</span>
        client<span>.</span>state<span>.</span>user<span>!</span><span>.</span>id<span>,</span>
      <span>]</span>
    <span>}</span><span>,</span>
  <span>)</span><span>;</span>
  <span>await</span> channel<span>.</span><span>watch</span><span>(</span><span>)</span><span>;</span>
  _currentChannelId <span>=</span> channel<span>.</span>id<span>;</span>
  <span>return</span> channel<span>;</span>
<span>}</span></code></pre><p>There‚Äôs a lot going on here. Let&#39;s review it step by step.</p><p>First, to create a support chat channel for the current user, you need to know the ID of an available agent. In this tutorial, you will eventually learn how to create an API to get an available agent via Auth0 based on their roles. However, we‚Äôll skip this part for now.</p><p>Second, you need to create a channel with a specific type. In this case, the type will be <code>support</code>. Stream provides default types for channels; however, you can define your types as needed. To create a channel type, navigate to the Stream dashboard, go to your app in the Chat overview tab, and add your channel types to the list.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6W33zODRlOuxetIMT5FFX5/c3b4894e13324aa8db4822545716248e/streamchat_type.png" alt="Stream channel types."/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Waym3vZQnTvKNejptTCJp/64b96fb65f65f5b1ceae5bf485eb2856/chat_type.png" alt="New stream channel type."/></p><p>Next, you can pass an existing channel ID to reconnect to a channel or leave it <code><span>null</span></code> to create a new channel. Stream will automatically assign an ID to new channels. Since this support chat is private and exclusive to one agent and a current user, you may add IDs to <code>members</code> in the <code>extraData</code> map.</p><p>Then, call the <code><span>watch</span><span>(</span><span>)</span></code> method on the channel to create and listen to the events on that channel. The <code><span>watch</span><span>(</span><span>)</span></code> method is a <code>Future</code> and will perform its tasks asynchronously. You can assign the channel ID to the <code>_currentChannelId</code> private instance variable so that you can reconnect to the channel when needed.</p><blockquote><p>Later on, it might be a good idea to store the channel ID in an external database or local secure storage in the app so that it persists between user sessions.</p></blockquote><p>Finally, the method returns the newly created channel.</p><p>With the <code><span>createSupportChat</span><span>(</span><span>)</span></code> method implemented, you can now implement the chat UI.</p><p>üõ† Open the <code><span>/</span>lib<span>/</span>screens<span>/</span>support<span>.</span>dart</code> file, where you‚Äôll find the <code>SupportChatScreen</code> class. Update the file‚Äôs contents to the following:</p><pre><code><span>// /lib/screens/support.dart</span>

<span>import</span> <span>&#39;package:flutter/material.dart&#39;</span><span>;</span>
<span>import</span> <span>&#39;package:flutter/widgets.dart&#39;</span><span>;</span>

<span>class</span> <span>SupportChatScreen</span> <span>extends</span> <span>StatefulWidget</span> <span>{</span>
  <span>@override</span>
  _SupportChatScreenState <span>createState</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> <span>_SupportChatScreenState</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>class</span> <span>_SupportChatScreenState</span> <span>extends</span> <span>State</span><span>&lt;</span>SupportChatScreen<span>&gt;</span> <span>{</span>
  Auth0User<span>?</span> profile <span>=</span> AuthService<span>.</span>instance<span>.</span>profile<span>;</span>
  Channel<span>?</span> channel<span>;</span>

  <span>@override</span>
  <span>void</span> <span>initState</span><span>(</span><span>)</span> <span>{</span>
    <span>super</span><span>.</span><span>initState</span><span>(</span><span>)</span><span>;</span>
    <span>createChannel</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>createChannel</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
    <span>final</span> _channel <span>=</span> <span>await</span> ChatService<span>.</span>instance<span>.</span><span>createSupportChat</span><span>(</span><span>)</span><span>;</span>
    <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
      channel <span>=</span> _channel<span>;</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>@override</span>
  Widget <span>build</span><span>(</span>BuildContext context<span>)</span> <span>{</span>
    <span>return</span> channel <span>==</span> <span>null</span>
        <span>?</span> <span>Center</span><span>(</span>
            child<span>:</span> <span>Text</span><span>(</span><span>&#39;You are in the queue!, please wait...&#39;</span><span>)</span><span>,</span>
          <span>)</span>
        <span>:</span> <span>Scaffold</span><span>(</span>
            body<span>:</span> <span>SafeArea</span><span>(</span>
              child<span>:</span> <span>StreamChannel</span><span>(</span>
                channel<span>:</span> channel<span>!</span><span>,</span>
                child<span>:</span> <span>Column</span><span>(</span>
                  children<span>:</span> <span>&lt;</span>Widget<span>&gt;</span><span>[</span>
                    <span>Expanded</span><span>(</span>
                      child<span>:</span> <span>MessageListView</span><span>(</span><span>)</span><span>,</span>
                    <span>)</span><span>,</span>
                    <span>MessageInput</span><span>(</span>
                      disableAttachments<span>:</span> <span>true</span><span>,</span>
                      sendButtonLocation<span>:</span> SendButtonLocation<span>.</span>inside<span>,</span>
                      actionsLocation<span>:</span> ActionsLocation<span>.</span>leftInside<span>,</span>
                      showCommandsButton<span>:</span> <span>true</span><span>,</span>
                    <span>)</span><span>,</span>
                  <span>]</span><span>,</span>
                <span>)</span><span>,</span>
              <span>)</span><span>,</span>
            <span>)</span><span>,</span>
          <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Here‚Äôs what‚Äôs happening in this UI implementation:</p><ul><li>This support chat screen, <code>SupportChatScreen</code>, is a <code>StatefulWidget</code>.</li><li>The <code>profile</code> variable is the user profile from <code>AuthService</code> that you created in the previous section.</li><li>The <code>channel</code> variable is used to detect if a support channel has been created.</li><li>The <code><span>createChannel</span><span>(</span><span>)</span></code> method calls <code>ChatService</code>‚Äôs <code><span>createSupportChat</span><span>(</span><span>)</span></code> method, which you recently defined.</li><li>Once the channel is ready, <code><span>setState</span><span>(</span><span>)</span></code> is called, which renders the chat UI.</li><li>In the <code><span>build</span><span>(</span><span>)</span></code> method, you can show a message while the channel is being created or return a <code>StreamChannel</code> object, which provides information about the channel to the widget tree and passes a reference to the <code>channel</code>.</li><li>Typically, a child of <code>SupportChatScreen</code> should be a <code>Column</code> that includes <code><span>MessageListView</span><span>(</span><span>)</span></code> and is wrapped by <code>Expanded</code> to ensure it takes up all the available space.</li><li>You can highly customize <code><span>MessageInput</span><span>(</span><span>)</span></code> in a number of ways, such as disabling the file attachment or command buttons. You‚Äôll do this later by using Auth0‚Äôs permissions and roles to determine which buttons should be enabled or disabled, so stay tuned.</li></ul><p>Congratulations ‚Äî you‚Äôve implemented the support chat screen! Let&#39;s move on to the community view.</p><p>It&#39;s time to make a screen to allow agents to see all the messages they receive via support. Let&#39;s call this screen <code>CommunityScreen</code>.</p><p>üõ† Open the <code><span>/</span>lib<span>/</span>screens<span>/</span>community<span>.</span>dart</code> file, and update the <code>CommunityScreen</code> class within to the following:</p><pre><code><span>// /lib/screens/community.dart</span>

<span>class</span> <span>CommunityScreen</span> <span>extends</span> <span>StatelessWidget</span> <span>{</span>
  <span>final</span> userId <span>=</span> ChatService<span>.</span>instance<span>.</span>client<span>.</span>state<span>.</span>user<span>?</span><span>.</span>id <span>as</span> Object<span>;</span>

  <span>@override</span>
  Widget <span>build</span><span>(</span>BuildContext context<span>)</span> <span>{</span>
    <span>return</span> <span>Scaffold</span><span>(</span>
      body<span>:</span> <span>ChannelsBloc</span><span>(</span>
        child<span>:</span> <span>ChannelListView</span><span>(</span>
          filter<span>:</span> Filter<span>.</span><span>in_</span><span>(</span>
            <span>&#39;members&#39;</span><span>,</span>
            <span>[</span>userId<span>]</span><span>,</span><span>// current user is employee (role/permission)</span>
          <span>)</span><span>,</span>
          sort<span>:</span> <span>[</span><span>SortOption</span><span>(</span><span>&#39;last_message_at&#39;</span><span>)</span><span>]</span><span>,</span>
          pagination<span>:</span> <span>PaginationParams</span><span>(</span>
            limit<span>:</span> <span>30</span><span>,</span>
          <span>)</span><span>,</span>
          channelWidget<span>:</span> <span>ChannelPage</span><span>(</span><span>)</span><span>,</span>
        <span>)</span><span>,</span>
      <span>)</span><span>,</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span>

<span>class</span> <span>ChannelPage</span> <span>extends</span> <span>StatelessWidget</span> <span>{</span>
  <span>@override</span>
  Widget <span>build</span><span>(</span>BuildContext context<span>)</span> <span>{</span>
    <span>return</span> <span>Scaffold</span><span>(</span>
      appBar<span>:</span> <span>ChannelHeader</span><span>(</span><span>)</span><span>,</span>
      body<span>:</span> <span>Column</span><span>(</span>
        children<span>:</span> <span>&lt;</span>Widget<span>&gt;</span><span>[</span>
          <span>Expanded</span><span>(</span>
            child<span>:</span> <span>MessageListView</span><span>(</span><span>)</span><span>,</span>
          <span>)</span><span>,</span>
          <span>MessageInput</span><span>(</span><span>)</span><span>,</span>
        <span>]</span><span>,</span>
      <span>)</span><span>,</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>The logic behind this page is relatively simple. You want to load all channels seen by the current user, an agent in this context, then open each channel to answer its respective customer.</p><p><code>ChannelsBloc</code> manages a list of channels with pagination, re-ordering, querying, and other operations associated with channels together with <code><span>ChannelListView</span><span>(</span><span>)</span></code>. The <code>Bloc</code> is not related to the <code>Bloc</code> package or pattern; this is just a coincidence.</p><p>You need to filter all channels by the membership of the current user. If necessary, do custom sorting and pagination too.</p><p>Lastly, you need to ensure that the <code><span>ChannelPage</span><span>(</span><span>)</span></code> is also passed to correctly as it makes channels routable. The <code><span>ChannelPage</span><span>(</span><span>)</span></code> is nothing fancy ‚Äî just a straightforward implementation of what you have done already in <code>SupportScreen</code>.</p><p>Perfect! You have created all screens for the app. However, we still need to implement permissions and roles to load each screen and functionalities based on what we can define and receive via Auth0 tokens. But if you are curious, you can simply add another tab to the <code>MenuScreen</code> and load these pages (although you might not see any channels yet).</p><p>üõ† In the file <code><span>/</span>lib<span>/</span>screens<span>/</span>menu<span>.</span>dart</code>, locate <code>final List<span>&lt;</span>Widget<span>&gt;</span> tabs</code> in <code>MenuScreenState</code> and update it to the following:</p><pre><code><span>// /lib/screens/menu.dart</span>

<span>.</span><span>.</span><span>.</span>
  <span>final</span> List<span>&lt;</span>Widget<span>&gt;</span> tabs <span>=</span> <span>[</span>
    <span>MenuList</span><span>(</span>coffees<span>:</span> coffees<span>)</span><span>,</span>
    <span>SupportChatScreen</span><span>(</span><span>)</span><span>,</span>
    <span>ProfileScreen</span><span>(</span><span>)</span><span>,</span>
  <span>]</span><span>;</span>
<span>.</span><span>.</span><span>.</span></code></pre><p>üõ† In the same file, add a new icon to <code>bottomNavigationBar</code> by replacing the <code>items</code> parameter with the following:</p><pre><code><span>// /lib/screens/menu.dart</span>

items<span>:</span> <span>&lt;</span>BottomNavigationBarItem<span>&gt;</span><span>[</span>
  <span>BottomNavigationBarItem</span><span>(</span>
    icon<span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>list_alt<span>)</span><span>,</span>
    label<span>:</span> <span>&#34;Menu&#34;</span><span>,</span>
  <span>)</span><span>,</span>
  <span>BottomNavigationBarItem</span><span>(</span>
    icon<span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>support<span>)</span><span>,</span>
    label<span>:</span> <span>&#34;Support&#34;</span><span>,</span>
  <span>)</span><span>,</span>
  <span>BottomNavigationBarItem</span><span>(</span>
    icon<span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>person<span>)</span><span>,</span>
    label<span>:</span> <span>&#34;Profile&#34;</span><span>,</span>
  <span>)</span><span>,</span>
<span>]</span><span>,</span></code></pre><p>üõ† Before you can test the chat, you should temporarily add the <code>rootEmployeeId</code> user ID that you defined in <code>createSupportChat</code>  in the Stream dashboard.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2RqndsI9Xp4CR35fYyRRSG/4832ae874ee2b4622ae4282560d1f396/chat_custom_user.png" alt="Custom user in the chat."/></p><p>You can skip this step, but it‚Äôs still a good idea to have a root support user in case of a specific agent is unavailable. That way, the user with the absent agent can still get support.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/qFcfGuNTipVpuEWJtAfM0/312b8561bbbbc47ed9a97342dbd46764/custom_user_root.png" alt="Custom user in the chat."/></p><p>üõ† Run your app in the emulator, go to the support chat screen, and try it out!</p><blockquote><p>If you encounter an error regarding an outdated Kotlin version on the Android emulator, open <code>android<span>/</span>app<span>/</span>build<span>.</span>gradle</code>, and search for <code>ext<span>.</span>kotlin_version</code>. Change that line to <code>ext<span>.</span>kotlin_version <span>=</span> <span>&#39;1.5.10&#39;</span></code>.</p></blockquote><h2 id="Auth0-Actions-and-Generating-Stream-User-Production-Tokens">Auth0 Actions and Generating Stream User Production Tokens</h2><p>Until now, for each user, you have been using a token generated for the development environment. In order to release your app, the app will have to request production tokens.</p><p>As I mentioned earlier, retrieving production tokens is usually done by your backend server. Auth0 can act as this service and retrieve those tokens for you, thanks to a potent tool called <em>Auth0 Actions</em>. </p><p>You can use Auth0 Actions to handle your application logic and fit it into a particular flow. They are secure, tenant-specific, versioned functions written in Node.js that execute at specific points when Auth0 is doing its work. This allows you to customize and extend Auth0&#39;s capabilities with custom logic. Think of Actions as serverless functions, such as AWS Lambda or Google Cloud Functions.</p><p>You can determine when and where to execute an Action in the Auth0 runtime environment. Your flows might be:</p><ul><li><strong>Login:</strong> Executed after a user logs in and when refresh tokens are issued.</li><li><strong>Machine to Machine:</strong> Executed after a user logs in after the Client Credentials hook.</li><li><strong>Pre-User Registration:</strong> Executed before a user is added to the database or passwordless connections.</li><li><strong>Post-User Registration:</strong> Executed after a user is added to a database or passwordless connections. The execution is asynchronous and will not affect the transaction.</li><li><strong>Post-Change Password:</strong> Executed after a password is changed for a database connection user.</li><li><strong>Send Phone Message:</strong> Executed when using a custom MFA provider.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7fpne9yUGBpXYzAT5km5l5/83ab5c891c02495d53a9d2661e10083e/actions_flow.png" alt="Actions flow"/></p><p>You‚Äôve probably already thought of several use cases for each of these scenarios.</p><p>Let&#39;s create a custom action to exchange Stream production user tokens for users after they logged in and hooked it up to the ID token and user metadata received by the Flutter app.</p><p>First, you need to create a new action. Go to the Custom Actions menu under Actions in Auth0 Dashboard and hit the &#34;Create&#34; button.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/oR6jv9IA92twMdtRrAvIz/e414cac9a740c5fdd5eaab85a7795ebb/create_action.png" alt="Create action"/></p><p>üõ† You should provide a name for the action, select a trigger from the list, and then create it. For the purpose of generating a chat token and attaching it to <code>idToken</code>, select the <strong>Login / Post Login</strong> trigger, which allows you to use the action in the login flow.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5wbUmlcD0qq7FrgBCiURrS/a95bb544b5d4fdaa4eac2a87b5fd9361/create_action_trigger.png" alt="Create action trigger"/></p><p>You&#39;ll see an editor where you can write your logic. You can run the code, try it out before deploying it, add your secrets to the environment instead of putting it in the application code, and even add almost all public NPM packages!</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/46DWkLU05SPD1kTE6i5oGF/54f46b0d30cd13bf141b4beb28a2445e/action_module.png" alt=" action module"/></p><p>üõ† Start by adding the <code>getstream</code> npm package. At the time of writing, the current version of the package is <code><span>7.2</span><span>.10</span></code>.</p><p>üõ† Go back to the Stream dashboard, copy your secret and client keys...</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5aLtEOAjfXguB6BQlI8fmB/b55f3fd1d0c7c44c91c760c5850d8457/chat_app_secret.png" alt="chat app secret"/></p><p>üõ† ...and then add them with the name of <code><span>GET_STREAM_CHAT_SECRET_KEY</span></code> and <code><span>GET_STREAM_CHAT_CLIENT_KEY</span></code>, respectively, to this function in Auth0.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4JgG1WLTfWa2RTlkzAkV8j/1704cdf6b2e7abfd23e611171440dce5/action_secrets.png" alt=" action secrets"/></p><p>üõ† Lastly, you can import <code>getStream</code> and connect and create a user token bypassing <code>user_id</code>.</p><pre><code><span>// Javascript</span>

<span>const</span> stream <span>=</span> <span>require</span><span>(</span><span>&#39;getstream&#39;</span><span>)</span><span>;</span>

exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> getStreamClient <span>=</span> stream<span>.</span><span>connect</span><span>(</span>
    event<span>.</span>secrets<span>.</span><span>GET_STREAM_CHAT_CLIENT_KEY</span><span>,</span>
    event<span>.</span>secrets<span>.</span><span>GET_STREAM_CHAT_SECRET_KEY</span>
  <span>)</span><span>;</span>
  <span>const</span> getStreamToken <span>=</span> getStreamClient<span>.</span><span>createUserToken</span><span>(</span>
    <span><span>`</span><span><span>${</span>event<span>.</span>user<span>.</span>user_id<span>.</span><span>split</span><span>(</span><span>&#39;|&#39;</span><span>)</span><span>.</span><span>join</span><span>(</span><span>&#39;&#39;</span><span>)</span><span>}</span></span><span>`</span></span> <span>// getstream does not support `|` in the ID yet, so we have to omit it.</span>
  <span>)</span><span>;</span>

  <span>// api.user.setAppMetadata(&#34;stream_chat_token&#34;, getStreamToken);</span>
  <span>// api.user.setUserMetadata(&#34;stream_chat_token&#34;, getStreamToken);</span>
  <span>const</span> namespace <span>=</span> <span>&#39;https://getstream.mjcoffee.app&#39;</span><span>;</span>
  <span>if</span> <span>(</span>event<span>.</span>authorization<span>)</span> <span>{</span>
    api<span>.</span>idToken<span>.</span><span>setCustomClaim</span><span>(</span><span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/user_token</span><span>`</span></span><span>,</span> getStreamToken<span>)</span><span>;</span>
    api<span>.</span>accessToken<span>.</span><span>setCustomClaim</span><span>(</span><span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/user_token</span><span>`</span></span><span>,</span> getStreamToken<span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>Let&#39;s explore the implementation above. </p><p>Once you get the token, you can set a user or app metadata named <code>stream_chat_token</code> with the token value. </p><p>Alternately, you can set a custom claim on <code>idToken</code> and <code>accessToken</code>. A custom claim must take the form of a URI, which means that <code>https<span>:</span><span>/</span><span>/</span>getstream<span>.</span>mjcoffee<span>.</span>app<span>/</span>user_token</code> is an acceptable name for a claim, while <code>user_token</code> alone is not.</p><blockquote><p><strong>Important:</strong> In Stream, only the characters <code>a</code> through <code>z</code>, <code><span>0</span></code> through <code><span>9</span></code>, <code>@</code>, <code>_</code>, and <code><span>-</span></code> are allowed in the user ID. Therefore, we shouldn‚Äôt use the <code><span>|</span></code> for <code>user_id</code> in Auth0.</p></blockquote><p>Let&#39;s run and test this function before we deploy. Click on the play icon and run with the example event, which is automatically generated for you.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1b3pOpx8O1g4MBOqmhI6ix/88e2335e0b2bb8a3730dba6ebcc57e44/action_run.png" alt=" action run"/></p><p>If everything goes well, you‚Äôll get a generated token in JWT format. Its payload will contain <code>user_id</code>, and it will be signed with your secret key by the Stream servers.</p><p>Here‚Äôs an example of what you‚Äôll get:</p><pre><code><span>// response in Action run</span>

<span>[</span>
  <span>{</span>
    name<span>:</span> <span>&#39;https://getstream.mjcoffee.app/user_token&#39;</span><span>,</span>
    target<span>:</span> <span>&#39;idToken&#39;</span><span>,</span>
    type<span>:</span> <span>&#39;SetCustomClaim&#39;</span><span>,</span>
    value<span>:</span>
      <span>&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYXV0aDA1ZjdjOGVjN2MzM2M2YzAwNGJiYWZlODIifQ.7ZIyr27skgrGm6REEz5o-WvoCArNblDnwiOdxXW4dp8&#39;</span><span>,</span>
  <span>}</span><span>,</span>
  <span>{</span>
    name<span>:</span> <span>&#39;https://getstream.mjcoffee.app/user_token&#39;</span><span>,</span>
    target<span>:</span> <span>&#39;accessToken&#39;</span><span>,</span>
    type<span>:</span> <span>&#39;SetCustomClaim&#39;</span><span>,</span>
    value<span>:</span>
      <span>&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYXV0aDA1ZjdjOGVjN2MzM2M2YzAwNGJiYWZlODIifQ.7ZIyr27skgrGm6REEz5o-WvoCArNblDnwiOdxXW4dp8&#39;</span><span>,</span>
  <span>}</span><span>,</span>
<span>]</span><span>;</span></code></pre><p><img src="https://images.ctfassets.net/23aumh6u8s0i/Ax6b4nRMkHyjvfGBK47bV/d15969eb0f4740dfe1057372e04c4437/jwt_stream.png" alt="action run"/></p><p>üõ† Next, go back to <strong>Flow</strong>, select <strong>Login</strong>, and drag your newly-created custom action to the flow and apply the changes:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5oYj9z0hIawXOi3dSW8dEZ/4684098fb3b108dd0cc4f32e01aa4e59/login_flow.png" alt=" action run"/></p><p>For the last step, the Flutter app needs to read this token and add it to the user model. That way, when you connect a user to Stream‚Äôs chat, instead of the development tokens you‚Äôve been using, you can replace it with the token that Auth0 received.</p><p>üõ† Since it&#39;s a custom claim, it will show up in <code>idToken</code>; thus you‚Äôll need to modify your <code>Auth0IdToken</code> model class (located in <code><span>/</span>lib<span>/</span>models<span>/</span>auth0_id_token<span>.</span>dart</code>)...</p><pre><code><span>// /lib/models/auth0_id_token.dart</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0IdToken</span> <span>{</span>
  <span>Auth0IdToken</span><span>(</span><span>{</span>
  
  <span>.</span><span>.</span><span>.</span><span>.</span>
  
    required <span>this</span><span>.</span>streamChatUserToken<span>,</span>
  
  <span>.</span><span>.</span><span>.</span><span>.</span>
  
<span>}</span><span>)</span>

<span>.</span><span>.</span><span>.</span><span>.</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://getstream.mjcoffee.app/user_token&#39;</span><span>)</span>
  <span>final</span> String streamChatUserToken<span>;</span>

<span>.</span><span>.</span><span>.</span><span>.</span>

<span>}</span></code></pre><p>üõ† Then do the same with your <code>Auth0User</code> class (located in <code><span>/</span>lib<span>/</span>models<span>/</span>auth0_user<span>.</span>dart</code>), as it will be part of the user details:</p><pre><code><span>// m/lib/models/auth0_user.dart</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0User</span> <span>{</span>
  <span>Auth0User</span><span>(</span><span>{</span>
  <span>.</span><span>.</span><span>.</span><span>.</span>
      required <span>this</span><span>.</span>streamChatUserToken<span>,</span>
  <span>.</span><span>.</span><span>.</span><span>.</span>
<span>}</span><span>)</span>
<span>.</span><span>.</span><span>.</span><span>.</span>
  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://getstream.mjcoffee.app/user_token&#39;</span><span>)</span>
  <span>final</span> String streamChatUserToken<span>;</span>
<span>.</span><span>.</span><span>.</span><span>.</span>
<span>}</span></code></pre><p>üõ† Once you are done, run the <code>build_runner</code> command to generate models again.</p><pre><code>flutter pub run build_runner build --delete-conflicting-outputs</code></pre><p>üõ† Locate <code>connectUser</code> in the <code>ChatService</code> class (located in <code><span>/</span>lib<span>/</span>services<span>/</span>chat_service<span>.</span>dart</code>) and replace <code><span>devToken</span><span>(</span><span>)</span></code> with the newly-received token on the user object.</p><pre><code><span>// /lib/services/chat_service.dart</span>

<span>await</span> client<span>.</span><span>connectUser</span><span>(</span>
  <span>User</span><span>(</span>
    id<span>:</span> user<span>.</span>id<span>,</span>
    extraData<span>:</span> <span>{</span>
      <span>&#39;image&#39;</span><span>:</span> user<span>.</span>picture<span>,</span>
      <span>&#39;name&#39;</span><span>:</span> user<span>.</span>name<span>,</span>
    <span>}</span><span>,</span>
  <span>)</span><span>,</span>
  <span>// client.devToken(user.id).rawValue,</span>
    user<span>.</span>streamChatUserToken<span>,</span>
<span>)</span><span>;</span></code></pre><p>Well done! Log out of the app, restart it. and log in again. This time, you&#39;ll receive a production-ready user token. When you go to the support chat screen, everything should work as expected.</p><h2 id="Looking-Ahead">Looking Ahead</h2><p>Now that the app has a real-time chat is ready with a proper authentication flow, you can move on to the next section to focus on authorization, roles, and permissions.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 04 Oct 2021 17:13:00 +0000</pubDate>
    </item>
    <item>
      <title>Flutter Authentication and Authorization with Auth0, Part 3: Adding Real-Time Chat to the App</title>
      <link>https://auth0.com/blog/flutter-authentication-authorization-with-auth0-part-3-adding-real-time-chat-to-the-app/</link>
      <description>In this tutorial, you‚Äôll learn how to enhance your Flutter apps by enabling authentication, supporting federated identity providers, adding authorization by introducing roles and permissions, all leveraging Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the previous sections of this tutorial, you added authentication to <em>MJ Coffee</em>, a Flutter app, and then enhanced that authentication by adding refresh token rotation and social logins. You also looked at customizing the login page with your own branding, and user management in Auth0.</p><p>In this section, we‚Äôll focus on authorization. Remember:</p><ul><li><strong>Authentication</strong> concerns itself with answering the question ‚ÄúWho are you?‚Äù</li><li><strong>Authorization</strong> ‚Äî this section‚Äôs topic ‚Äî¬†is all about answering the question ‚ÄúWhat are you allowed to do?‚Äù</li></ul><p>We‚Äôll cover authorization by adding real-time chat to <em>MJ Coffee</em> so that we can later see how the chat can be integrated with Auth0, limit its functionalities and UIs based on roles and permissions.</p><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong></p></blockquote><h2 id="Add-Real-Time-Chat-to-the-Flutter-Application">Add Real-Time Chat to the Flutter Application</h2><p>Having a real-time chat service in the <em>MJ Coffee</em> app can significantly improve how fast users can communicate with our customer service or employees. Having looked around, I found <a href="https://getstream.io" target="_blank" rel="noreferrer noopener">Stream</a>, an exciting service with a solid Flutter SDK that you can integrate and customize quickly and easily.</p><h2 id="Install-Dependencies">Install Dependencies</h2><p>Stream comes with several SDKs that can be used in Dart or Flutter applications. However, one of them comes with all features, a beautiful theme, and enough API so that you can customize it as much as you wish. We‚Äôll use that one.</p><p>üõ† Open the <code><span>/</span>pubspec<span>.</span>yaml</code> file and add <code>stream_chat_flutter</code> to your dependencies. The <code>dependencies</code> section of the file should end up looking like this:</p><pre><code>// /pubspec.yaml

<span>dependencies</span><span>:</span>
  <span>flutter</span><span>:</span>
    <span>sdk</span><span>:</span> flutter
  <span>font_awesome_flutter</span><span>:</span> ^9.1.0
  <span>flutter_svg</span><span>:</span> ^0.22.0
  <span>google_fonts</span><span>:</span> ^2.1.0
  <span>json_annotation</span><span>:</span> ^4.0.1
  <span>http</span><span>:</span> ^0.13.3
  <span>flutter_appauth</span><span>:</span> ^1.1.0
  <span>flutter_secure_storage</span><span>:</span> ^4.2.0
  <span>stream_chat_flutter</span><span>:</span> ^2.0.0</code></pre><p>I recommend using a version later than 2.0, which is fully compatible with Flutter 2 and its support for <a href="https://flutter.dev/docs/null-safety" target="_blank" rel="noreferrer noopener">null safety</a>.</p><p>If you‚Äôre only targeting Android, you can ignore the next section.</p><h4 id="If-you-re-targeting-iOS">If you‚Äôre targeting iOS</h4><p>üõ† If you‚Äôre targeting iOS, you‚Äôll need to take a few extra steps:</p><ul><li>The Stream library uses the <a href="https://github.com/miguelpruivo/flutter_file_picker" target="_blank" rel="noreferrer noopener"><em>flutter file picker</em> plugin</a> to present the user with an interface to select files. You‚Äôll need to follow the steps in <a href="https://github.com/miguelpruivo/flutter_file_picker/wiki/Setup#ios" target="_blank" rel="noreferrer noopener">the <em>iOS</em> section of this page</a> to make use of it.</li><li>The library also uses the <em>video_player</em> plugin to display inline videos. Follow <a href="https://pub.dev/packages/video_player#installation" target="_blank" rel="noreferrer noopener">this guide</a> to install and enable it.</li><li>Finally, the library uses the <em>image_picker</em> plugin to provide a user interface for selecting images. Follow [these instructions] to use this plugin.</li></ul><p>üõ† Don‚Äôt forget to actually install the dependencies! Enter <code>flutter pub get</code> in the terminal or PowerShell, or <code>Pub get</code> in your IDE.</p><h2 id="Create-a-Stream-Account-and-App">Create a Stream Account and App</h2><p>Before you can integrate Stream with your app, you need a Stream account, which you‚Äôll use to register the app.</p><p>üõ† <a href="https://getstream.io/accounts/signup/" target="_blank" rel="noreferrer noopener">Create your account if you don‚Äôt already have one,</a> then log in and go to the Stream dashboard:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5g116jkNGeqaZvFk5nesaZ/e01470d789d92e658ca0d4ac16605d5e/stream_dashboard.png" alt="Stream dashboard."/></p><p>üõ† Tap on the <strong>Create App</strong> button, then follow these steps:</p><ul><li>Enter a name for your app in the <strong>App Name</strong> field. For this example, we‚Äôll use <code>MJCoffee</code>.</li><li>In the <strong>Feeds Server Location</strong> menu, select the location closest to you.</li><li><em>Don‚Äôt</em> select anything from the <strong>Clone Existing App</strong> menu ‚Äî just leave it set to <code><span>--</span><span>-</span></code>.</li><li>Select your environment. Usually, it&#39;s a good idea to create separate apps for production and development. In this tutorial, we‚Äôll focus on production, so select <strong>Production</strong>.</li><li>Finally, click the <strong>Create App</strong> button.</li></ul><p>You should see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Zh9QmY69R9Bwo4p3PZawt/f8c55e169d20282c17e3592216344fd6/stream_app.png" alt="A newly-created app in Stream."/></p><p>üõ† Once your app has been created, make a note of your Stream key. </p><p>Notice that you will need a secret key to sign the user ID and get a production user token to connect users. You‚Äôll learn how to do that with Auth0 Actions.</p><p>I recommend passing sensitive data and keys with <code><span>--</span>dart<span>-</span>define</code> via the command line or adding to your editor or IDE run command rather than storing it in your app‚Äôs code.</p><p>You took this approach when implementing basic authentication for the app. You passed two sensitive values ‚Äî your Auth0 domain and Auth0 client ID ‚Äî as command-line arguments when launching the app. You‚Äôll simply add the Stream key as a third argument, like so:</p><pre><code>flutter run -d all --dart-define<span>=</span>AUTH0_DOMAIN<span>=</span><span>[</span>YOUR DOMAIN<span>]</span> --dart-define<span>=</span>AUTH0_CLIENT_ID<span>=</span><span>[</span>YOUR CLIENT ID<span>]</span> --dart-define<span>=</span>STREAM_API_KEY<span>=</span><span>[</span>YOUR STREAM KEY<span>]</span></code></pre><p>In order for your application to use the Stream key argument, you‚Äôll need to define a new constant.</p><p>üõ† Add the following to your <code>constants<span>.</span>dart</code> file, which is located in the in the <code><span>/</span>lib<span>/</span>helpers<span>/</span></code> directory:</p><pre><code><span>// /lib/helpers/constants.dart</span>

<span>const</span> STREAM_API_KEY <span>=</span> String<span>.</span><span>fromEnvironment</span><span>(</span><span>&#39;STREAM_API_KEY&#39;</span><span>)</span><span>;</span></code></pre><h2 id="Integrate-Chat-Into-the-Flutter-Application">Integrate Chat Into the Flutter Application</h2><p>Let&#39;s start by creating a new <code>StreamChatClient</code> in the <code>ChatService</code> singleton class. In doing this, there are three essential things that you need to take into account:</p><ol start="1"><li>Initializing the Dart API client with your API Key</li><li>Setting the current user</li><li>Passing the client to the top-level StreamChat widget</li></ol><p>üõ† Open <code>chat_service<span>.</span>dart</code> (located in the <code><span>/</span>lib<span>/</span>services<span>/</span></code> directory) and initialize <code>StreamChatClient</code> by updating the <code>ChatService</code> class so that it appears as follows:</p><pre><code><span>// /lib/services/chat_service.dart</span>

<span>class</span> <span>ChatService</span> <span>{</span>
  <span>static</span> <span>final</span> ChatService instance <span>=</span> ChatService<span>.</span><span>_internal</span><span>(</span><span>)</span><span>;</span>
  <span>factory</span> <span>ChatService</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> instance<span>;</span>
  ChatService<span>.</span><span>_internal</span><span>(</span><span>)</span><span>;</span>

  <span>final</span> StreamChatClient client <span>=</span> <span>StreamChatClient</span><span>(</span>
    STREAM_API_KEY<span>,</span>
    logLevel<span>:</span> isInDebugMode <span>?</span> Level<span>.</span>INFO <span>:</span> Level<span>.</span>OFF<span>,</span>
  <span>)</span><span>;</span>

<span>}</span></code></pre><p>The only required positional parameter for <code><span>StreamChatClient</span><span>(</span><span>)</span></code> is <code><span>STREAM_API_KEY</span></code>, but you have more options to configure your client. For instance, it might be pretty helpful to see all the logs during debugging. That&#39;s why we used the optional <code>logLevel</code> parameter to set the amount of logging that will take place, based on whether or not the app is in debug mode.</p><p>Now that you‚Äòve created the client, you need to ensure that your current user is connected appropriately.</p><p>üõ† Add the <code><span>connectUser</span><span>(</span><span>)</span></code> to the <code>ChatService</code> class in  <code>chat_service<span>.</span>dart</code>:</p><pre><code><span>// /lib/services/chat_service.dart</span>

<span>class</span> <span>ChatService</span> <span>{</span>

<span>.</span><span>.</span><span>.</span>

  Future<span>&lt;</span>Auth0User<span>&gt;</span> <span>connectUser</span><span>(</span>Auth0User<span>?</span> user<span>)</span> <span>async</span> <span>{</span>
    <span>if</span> <span>(</span>user <span>==</span> <span>null</span><span>)</span> <span>{</span>
      <span>throw</span> <span>Exception</span><span>(</span><span>&#39;User was not received&#39;</span><span>)</span><span>;</span>
    <span>}</span>
    <span>await</span> client<span>.</span><span>connectUser</span><span>(</span>
      <span>User</span><span>(</span>
        id<span>:</span> user<span>.</span>id<span>,</span>
        extraData<span>:</span> <span>{</span>
          <span>&#39;image&#39;</span><span>:</span> user<span>.</span>picture<span>,</span>
          <span>&#39;name&#39;</span><span>:</span> user<span>.</span>name<span>,</span>
        <span>}</span><span>,</span>
      <span>)</span><span>,</span>
      <span>// To be replaced with PRODUCTION TOKEN for user</span>
      client<span>.</span><span>devToken</span><span>(</span>user<span>.</span>id<span>)</span><span>.</span>rawValue<span>,</span>
    <span>)</span><span>;</span>
    <span>return</span> user<span>;</span>
  <span>}</span>
  
<span>.</span><span>.</span><span>.</span>
  
<span>}</span></code></pre><p>This new method of the <code>ChatService</code> class, <code><span>connectUser</span><span>(</span><span>)</span></code>, will handle the logic for connecting the current user. It accepts an <code>Auth0User</code> object. If it doesn‚Äòt receive one, it means the authentication has probably failed and that the user should not be connected to the chat.</p><p>üõ† Open <code><span>/</span>lib<span>/</span>screens<span>/</span>home<span>.</span>dart</code>, look for the <code>_HomeScreenState</code> class, and within it, the <code><span>setSuccessAuthState</span><span>(</span><span>)</span></code> method. Update <code><span>setSuccessAuthState</span><span>(</span><span>)</span></code> to the following:</p><pre><code><span>// /lib/screens/home.dart</span>

<span>setSuccessAuthState</span><span>(</span><span>)</span> <span>{</span>
  <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
    isProgressing <span>=</span> <span>false</span><span>;</span>
    isLoggedIn <span>=</span> <span>true</span><span>;</span>
    name <span>=</span> AuthService<span>.</span>instance<span>.</span>idToken<span>?</span><span>.</span>name<span>;</span>
  <span>}</span><span>)</span><span>;</span>

  ChatService<span>.</span>instance<span>.</span><span>connectUser</span><span>(</span>AuthService<span>.</span>instance<span>.</span>profile<span>)</span><span>;</span>
  CoffeeRouter<span>.</span>instance<span>.</span><span>push</span><span>(</span>MenuScreen<span>.</span><span>route</span><span>(</span><span>)</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>You need to pass two required positional parameters:</p><ul><li>The <code>User</code> object with a defined user ID, and</li><li>the user token, a signed and encrypted hash string.</li></ul><p>Typically, the user token should be generated on a back-end server to store the aforementioned secret key and to sign and get the token. You&#39;ll soon learn how Auth0 can handle that as your backend.</p><p>To continue, you need to:</p><ul><li>Get a development token,</li><li>pass <code>user<span>.</span>id</code> to the <code><span>devToken</span><span>(</span><span>)</span></code> method on the chat client, and</li><li>Get the <code>rawValue</code> which is the token string.</li></ul><p>üõ† To ensure that <code>devToken</code> works, you need to disable auth checks. In the <code>GetStream</code> app‚Äôs chat dashboard, turn on the <strong>Disable Auth0 Checks</strong> option.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3DMx1hZFHbDqt50gtJErjO/9c4c7e3c1da342ddf10c8fb208ac8960/disable_auth_checks.png" alt="Stream dashboard."/></p><blockquote><p>When you move the app to production and you have a proper method to receive the production token, make sure that you turn off the <strong>Disable Auth0 Checks</strong> option.</p></blockquote><p>Stream chat UI components will accept additional data that you provide while connecting a user. For example, you may create a <code>Map</code> containing the user‚Äòs image and name, so they appear automatically and beautifully throughout the chat widget.</p><p>At the time of writing, Stream does not accept Auth0‚Äôs user ID format, which includes <code><span>|</span></code> between the Auth source and user hash ID. You‚Äôll need to make a change to the <code>id</code> arrow function in the <code>Auth0User</code> model to account for this.</p><p>üõ† Open <code><span>/</span>lib<span>/</span>models<span>/</span>auth0_user<span>.</span>dart</code> and make this change to the <code>id</code> arrow function: </p><pre><code><span>// /lib/models/auth0_user.dart</span>

String <span>get</span> id <span>=</span><span>&gt;</span> sub<span>.</span><span>split</span><span>(</span><span>&#39;|&#39;</span><span>)</span><span>.</span><span>join</span><span>(</span><span>&#39;&#39;</span><span>)</span><span>;</span></code></pre><p>The next and final step is to create <code>StreamChat</code>, the root widget of the application.</p><p>üõ† Open the <code><span>/</span>lib<span>/</span>main<span>.</span>dart</code> file, locate the call to  <code>MaterialApp</code>, and add the <code>builder</code> parameter so that it returns a <code>StreamChat</code> object:</p><pre><code><span>// /lib/main.dart</span>

<span>.</span><span>.</span><span>.</span>
<span>MaterialApp</span><span>(</span>
  debugShowCheckedModeBanner<span>:</span> <span>false</span><span>,</span>
  themeMode<span>:</span> ThemeMode<span>.</span>system<span>,</span>
  home<span>:</span> <span>HomeScreen</span><span>(</span><span>)</span><span>,</span>
  navigatorKey<span>:</span> CoffeeRouter<span>.</span>instance<span>.</span>navigatorKey<span>,</span>
  theme<span>:</span> <span>getTheme</span><span>(</span><span>)</span><span>,</span>
  builder<span>:</span> <span>(</span>context<span>,</span> child<span>)</span> <span>{</span>
    <span>return</span> <span>StreamChat</span><span>(</span>
      child<span>:</span> child<span>,</span>
      client<span>:</span> ChatService<span>.</span>instance<span>.</span>client<span>,</span>
    <span>)</span><span>;</span>
  <span>}</span><span>,</span>
<span>)</span><span>,</span>
<span>.</span><span>.</span><span>.</span></code></pre><p>The <code>StreamChat</code> object returned by <code>builder</code> is an inherited widget and aims to provide APIs for advanced customization. It requires a child and a client that you have initialized in the <code>ChatService</code> class.</p><p>That&#39;s it ‚Äî your chat is ready! Restart the app, and let&#39;s continue to add the support screen and community screen using the prebuilt <code>StreamChat</code> UI widget to leverage the chat service that you added.</p><h2 id="Implement-the-Support-Chat-Screen">Implement the Support Chat Screen</h2><p>Typically, a support chat consists of a user and an agent interacting in a channel created for both. Hence the support chat screen will do the following:</p><ul><li>Create a private channel for the current user and one of the available agents</li><li>Listen to the channel for updates</li><li>Load existing chat content, if any</li><li>Upon chat completion, archive the chat history</li></ul><p>Let&#39;s create a <code><span>createSupportChat</span><span>(</span><span>)</span></code> method in the <code>ChatService</code> class.</p><p>üõ† First, add the following instance variable to the start of the <code>ChatService</code> class:</p><pre><code><span>// /lib/services/chat_service.dart</span>

String<span>?</span> _currentChannelId<span>;</span></code></pre><p>üõ† Then add the <code><span>createSupportChat</span><span>(</span><span>)</span></code> method to the <code>ChatService</code> class:</p><pre><code><span>// /lib/services/chat_service.dart</span>

Future<span>&lt;</span>Channel<span>&gt;</span> <span>createSupportChat</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
  <span>// To be replaced with EmployeeRole via Auth0</span>
  <span>final</span> String employeeId <span>=</span> <span>&#39;rootEmployeeId&#39;</span><span>;</span>
  <span>final</span> channel <span>=</span> client<span>.</span><span>channel</span><span>(</span>
    <span>&#39;support&#39;</span><span>,</span>
    id<span>:</span> _currentChannelId<span>,</span>
    extraData<span>:</span> <span>{</span>
      <span>&#39;name&#39;</span><span>:</span> <span>&#39;MJCoffee Support&#39;</span><span>,</span>
      <span>&#39;members&#39;</span><span>:</span> <span>[</span>
        employeeId<span>,</span>
        client<span>.</span>state<span>.</span>user<span>!</span><span>.</span>id<span>,</span>
      <span>]</span>
    <span>}</span><span>,</span>
  <span>)</span><span>;</span>
  <span>await</span> channel<span>.</span><span>watch</span><span>(</span><span>)</span><span>;</span>
  _currentChannelId <span>=</span> channel<span>.</span>id<span>;</span>
  <span>return</span> channel<span>;</span>
<span>}</span></code></pre><p>There‚Äôs a lot going on here. Let&#39;s review it step by step.</p><p>First, to create a support chat channel for the current user, you need to know the ID of an available agent. In this tutorial, you will eventually learn how to create an API to get an available agent via Auth0 based on their roles. However, we‚Äôll skip this part for now.</p><p>Second, you need to create a channel with a specific type. In this case, the type will be <code>support</code>. Stream provides default types for channels; however, you can define your types as needed. To create a channel type, navigate to the Stream dashboard, go to your app in the Chat overview tab, and add your channel types to the list.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6W33zODRlOuxetIMT5FFX5/c3b4894e13324aa8db4822545716248e/streamchat_type.png" alt="Stream channel types."/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Waym3vZQnTvKNejptTCJp/64b96fb65f65f5b1ceae5bf485eb2856/chat_type.png" alt="New stream channel type."/></p><p>Next, you can pass an existing channel ID to reconnect to a channel or leave it <code><span>null</span></code> to create a new channel. Stream will automatically assign an ID to new channels. Since this support chat is private and exclusive to one agent and a current user, you may add IDs to <code>members</code> in the <code>extraData</code> map.</p><p>Then, call the <code><span>watch</span><span>(</span><span>)</span></code> method on the channel to create and listen to the events on that channel. The <code><span>watch</span><span>(</span><span>)</span></code> method is a <code>Future</code> and will perform its tasks asynchronously. You can assign the channel ID to the <code>_currentChannelId</code> private instance variable so that you can reconnect to the channel when needed.</p><blockquote><p>Later on, it might be a good idea to store the channel ID in an external database or local secure storage in the app so that it persists between user sessions.</p></blockquote><p>Finally, the method returns the newly created channel.</p><p>With the <code><span>createSupportChat</span><span>(</span><span>)</span></code> method implemented, you can now implement the chat UI.</p><p>üõ† Open the <code><span>/</span>lib<span>/</span>screens<span>/</span>support<span>.</span>dart</code> file, where you‚Äôll find the <code>SupportChatScreen</code> class. Update the file‚Äôs contents to the following:</p><pre><code><span>// /lib/screens/support.dart</span>

<span>import</span> <span>&#39;package:flutter/material.dart&#39;</span><span>;</span>
<span>import</span> <span>&#39;package:flutter/widgets.dart&#39;</span><span>;</span>

<span>class</span> <span>SupportChatScreen</span> <span>extends</span> <span>StatefulWidget</span> <span>{</span>
  <span>@override</span>
  _SupportChatScreenState <span>createState</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> <span>_SupportChatScreenState</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>class</span> <span>_SupportChatScreenState</span> <span>extends</span> <span>State</span><span>&lt;</span>SupportChatScreen<span>&gt;</span> <span>{</span>
  Auth0User<span>?</span> profile <span>=</span> AuthService<span>.</span>instance<span>.</span>profile<span>;</span>
  Channel<span>?</span> channel<span>;</span>

  <span>@override</span>
  <span>void</span> <span>initState</span><span>(</span><span>)</span> <span>{</span>
    <span>super</span><span>.</span><span>initState</span><span>(</span><span>)</span><span>;</span>
    <span>createChannel</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>createChannel</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
    <span>final</span> _channel <span>=</span> <span>await</span> ChatService<span>.</span>instance<span>.</span><span>createSupportChat</span><span>(</span><span>)</span><span>;</span>
    <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
      channel <span>=</span> _channel<span>;</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>@override</span>
  Widget <span>build</span><span>(</span>BuildContext context<span>)</span> <span>{</span>
    <span>return</span> channel <span>==</span> <span>null</span>
        <span>?</span> <span>Center</span><span>(</span>
            child<span>:</span> <span>Text</span><span>(</span><span>&#39;You are in the queue!, please wait...&#39;</span><span>)</span><span>,</span>
          <span>)</span>
        <span>:</span> <span>Scaffold</span><span>(</span>
            body<span>:</span> <span>SafeArea</span><span>(</span>
              child<span>:</span> <span>StreamChannel</span><span>(</span>
                channel<span>:</span> channel<span>!</span><span>,</span>
                child<span>:</span> <span>Column</span><span>(</span>
                  children<span>:</span> <span>&lt;</span>Widget<span>&gt;</span><span>[</span>
                    <span>Expanded</span><span>(</span>
                      child<span>:</span> <span>MessageListView</span><span>(</span><span>)</span><span>,</span>
                    <span>)</span><span>,</span>
                    <span>MessageInput</span><span>(</span>
                      disableAttachments<span>:</span> <span>true</span><span>,</span>
                      sendButtonLocation<span>:</span> SendButtonLocation<span>.</span>inside<span>,</span>
                      actionsLocation<span>:</span> ActionsLocation<span>.</span>leftInside<span>,</span>
                      showCommandsButton<span>:</span> <span>true</span><span>,</span>
                    <span>)</span><span>,</span>
                  <span>]</span><span>,</span>
                <span>)</span><span>,</span>
              <span>)</span><span>,</span>
            <span>)</span><span>,</span>
          <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Here‚Äôs what‚Äôs happening in this UI implementation:</p><ul><li>This support chat screen, <code>SupportChatScreen</code>, is a <code>StatefulWidget</code>.</li><li>The <code>profile</code> variable is the user profile from <code>AuthService</code> that you created in the previous section.</li><li>The <code>channel</code> variable is used to detect if a support channel has been created.</li><li>The <code><span>createChannel</span><span>(</span><span>)</span></code> method calls <code>ChatService</code>‚Äôs <code><span>createSupportChat</span><span>(</span><span>)</span></code> method, which you recently defined.</li><li>Once the channel is ready, <code><span>setState</span><span>(</span><span>)</span></code> is called, which renders the chat UI.</li><li>In the <code><span>build</span><span>(</span><span>)</span></code> method, you can show a message while the channel is being created or return a <code>StreamChannel</code> object, which provides information about the channel to the widget tree and passes a reference to the <code>channel</code>.</li><li>Typically, a child of <code>SupportChatScreen</code> should be a <code>Column</code> that includes <code><span>MessageListView</span><span>(</span><span>)</span></code> and is wrapped by <code>Expanded</code> to ensure it takes up all the available space.</li><li>You can highly customize <code><span>MessageInput</span><span>(</span><span>)</span></code> in a number of ways, such as disabling the file attachment or command buttons. You‚Äôll do this later by using Auth0‚Äôs permissions and roles to determine which buttons should be enabled or disabled, so stay tuned.</li></ul><p>Congratulations ‚Äî you‚Äôve implemented the support chat screen! Let&#39;s move on to the community view.</p><p>It&#39;s time to make a screen to allow agents to see all the messages they receive via support. Let&#39;s call this screen <code>CommunityScreen</code>.</p><p>üõ† Open the <code><span>/</span>lib<span>/</span>screens<span>/</span>community<span>.</span>dart</code> file, and update the <code>CommunityScreen</code> class within to the following:</p><pre><code><span>// /lib/screens/community.dart</span>

<span>class</span> <span>CommunityScreen</span> <span>extends</span> <span>StatelessWidget</span> <span>{</span>
  <span>final</span> userId <span>=</span> ChatService<span>.</span>instance<span>.</span>client<span>.</span>state<span>.</span>user<span>?</span><span>.</span>id <span>as</span> Object<span>;</span>

  <span>@override</span>
  Widget <span>build</span><span>(</span>BuildContext context<span>)</span> <span>{</span>
    <span>return</span> <span>Scaffold</span><span>(</span>
      body<span>:</span> <span>ChannelsBloc</span><span>(</span>
        child<span>:</span> <span>ChannelListView</span><span>(</span>
          filter<span>:</span> Filter<span>.</span><span>in_</span><span>(</span>
            <span>&#39;members&#39;</span><span>,</span>
            <span>[</span>userId<span>]</span><span>,</span><span>// current user is employee (role/permission)</span>
          <span>)</span><span>,</span>
          sort<span>:</span> <span>[</span><span>SortOption</span><span>(</span><span>&#39;last_message_at&#39;</span><span>)</span><span>]</span><span>,</span>
          pagination<span>:</span> <span>PaginationParams</span><span>(</span>
            limit<span>:</span> <span>30</span><span>,</span>
          <span>)</span><span>,</span>
          channelWidget<span>:</span> <span>ChannelPage</span><span>(</span><span>)</span><span>,</span>
        <span>)</span><span>,</span>
      <span>)</span><span>,</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span>

<span>class</span> <span>ChannelPage</span> <span>extends</span> <span>StatelessWidget</span> <span>{</span>
  <span>@override</span>
  Widget <span>build</span><span>(</span>BuildContext context<span>)</span> <span>{</span>
    <span>return</span> <span>Scaffold</span><span>(</span>
      appBar<span>:</span> <span>ChannelHeader</span><span>(</span><span>)</span><span>,</span>
      body<span>:</span> <span>Column</span><span>(</span>
        children<span>:</span> <span>&lt;</span>Widget<span>&gt;</span><span>[</span>
          <span>Expanded</span><span>(</span>
            child<span>:</span> <span>MessageListView</span><span>(</span><span>)</span><span>,</span>
          <span>)</span><span>,</span>
          <span>MessageInput</span><span>(</span><span>)</span><span>,</span>
        <span>]</span><span>,</span>
      <span>)</span><span>,</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>The logic behind this page is relatively simple. You want to load all channels seen by the current user, an agent in this context, then open each channel to answer its respective customer.</p><p><code>ChannelsBloc</code> manages a list of channels with pagination, re-ordering, querying, and other operations associated with channels together with <code><span>ChannelListView</span><span>(</span><span>)</span></code>. The <code>Bloc</code> is not related to the <code>Bloc</code> package or pattern; this is just a coincidence.</p><p>You need to filter all channels by the membership of the current user. If necessary, do custom sorting and pagination too.</p><p>Lastly, you need to ensure that the <code><span>ChannelPage</span><span>(</span><span>)</span></code> is also passed to correctly as it makes channels routable. The <code><span>ChannelPage</span><span>(</span><span>)</span></code> is nothing fancy ‚Äî just a straightforward implementation of what you have done already in <code>SupportScreen</code>.</p><p>Perfect! You have created all screens for the app. However, we still need to implement permissions and roles to load each screen and functionalities based on what we can define and receive via Auth0 tokens. But if you are curious, you can simply add another tab to the <code>MenuScreen</code> and load these pages (although you might not see any channels yet).</p><p>üõ† In the file <code><span>/</span>lib<span>/</span>screens<span>/</span>menu<span>.</span>dart</code>, locate <code>final List<span>&lt;</span>Widget<span>&gt;</span> tabs</code> in <code>MenuScreenState</code> and update it to the following:</p><pre><code><span>// /lib/screens/menu.dart</span>

<span>.</span><span>.</span><span>.</span>
  <span>final</span> List<span>&lt;</span>Widget<span>&gt;</span> tabs <span>=</span> <span>[</span>
    <span>MenuList</span><span>(</span>coffees<span>:</span> coffees<span>)</span><span>,</span>
    <span>SupportChatScreen</span><span>(</span><span>)</span><span>,</span>
    <span>ProfileScreen</span><span>(</span><span>)</span><span>,</span>
  <span>]</span><span>;</span>
<span>.</span><span>.</span><span>.</span></code></pre><p>üõ† In the same file, add a new icon to <code>bottomNavigationBar</code> by replacing the <code>items</code> parameter with the following:</p><pre><code><span>// /lib/screens/menu.dart</span>

items<span>:</span> <span>&lt;</span>BottomNavigationBarItem<span>&gt;</span><span>[</span>
  <span>BottomNavigationBarItem</span><span>(</span>
    icon<span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>list_alt<span>)</span><span>,</span>
    label<span>:</span> <span>&#34;Menu&#34;</span><span>,</span>
  <span>)</span><span>,</span>
  <span>BottomNavigationBarItem</span><span>(</span>
    icon<span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>support<span>)</span><span>,</span>
    label<span>:</span> <span>&#34;Support&#34;</span><span>,</span>
  <span>)</span><span>,</span>
  <span>BottomNavigationBarItem</span><span>(</span>
    icon<span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>person<span>)</span><span>,</span>
    label<span>:</span> <span>&#34;Profile&#34;</span><span>,</span>
  <span>)</span><span>,</span>
<span>]</span><span>,</span></code></pre><p>üõ† Before you can test the chat, you should temporarily add the <code>rootEmployeeId</code> user ID that you defined in <code>createSupportChat</code>  in the Stream dashboard.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2RqndsI9Xp4CR35fYyRRSG/4832ae874ee2b4622ae4282560d1f396/chat_custom_user.png" alt="Custom user in the chat."/></p><p>You can skip this step, but it‚Äôs still a good idea to have a root support user in case of a specific agent is unavailable. That way, the user with the absent agent can still get support.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/qFcfGuNTipVpuEWJtAfM0/312b8561bbbbc47ed9a97342dbd46764/custom_user_root.png" alt="Custom user in the chat."/></p><p>üõ† Run your app in the emulator, go to the support chat screen, and try it out!</p><blockquote><p>If you encounter an error regarding an outdated Kotlin version on the Android emulator, open <code>android<span>/</span>app<span>/</span>build<span>.</span>gradle</code>, and search for <code>ext<span>.</span>kotlin_version</code>. Change that line to <code>ext<span>.</span>kotlin_version <span>=</span> <span>&#39;1.5.10&#39;</span></code>.</p></blockquote><h2 id="Auth0-Actions-and-Generating-Stream-User-Production-Tokens">Auth0 Actions and Generating Stream User Production Tokens</h2><p>Until now, for each user, you have been using a token generated for the development environment. In order to release your app, the app will have to request production tokens.</p><p>As I mentioned earlier, retrieving production tokens is usually done by your backend server. Auth0 can act as this service and retrieve those tokens for you, thanks to a potent tool called <em>Auth0 Actions</em>. </p><p>You can use Auth0 Actions to handle your application logic and fit it into a particular flow. They are secure, tenant-specific, versioned functions written in Node.js that execute at specific points when Auth0 is doing its work. This allows you to customize and extend Auth0&#39;s capabilities with custom logic. Think of Actions as serverless functions, such as AWS Lambda or Google Cloud Functions.</p><p>You can determine when and where to execute an Action in the Auth0 runtime environment. Your flows might be:</p><ul><li><strong>Login:</strong> Executed after a user logs in and when refresh tokens are issued.</li><li><strong>Machine to Machine:</strong> Executed after a user logs in after the Client Credentials hook.</li><li><strong>Pre-User Registration:</strong> Executed before a user is added to the database or passwordless connections.</li><li><strong>Post-User Registration:</strong> Executed after a user is added to a database or passwordless connections. The execution is asynchronous and will not affect the transaction.</li><li><strong>Post-Change Password:</strong> Executed after a password is changed for a database connection user.</li><li><strong>Send Phone Message:</strong> Executed when using a custom MFA provider.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7fpne9yUGBpXYzAT5km5l5/83ab5c891c02495d53a9d2661e10083e/actions_flow.png" alt="Actions flow"/></p><p>You‚Äôve probably already thought of several use cases for each of these scenarios.</p><p>Let&#39;s create a custom action to exchange Stream production user tokens for users after they logged in and hooked it up to the ID token and user metadata received by the Flutter app.</p><p>First, you need to create a new action. Go to the Custom Actions menu under Actions in Auth0 Dashboard and hit the &#34;Create&#34; button.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/oR6jv9IA92twMdtRrAvIz/e414cac9a740c5fdd5eaab85a7795ebb/create_action.png" alt="Create action"/></p><p>üõ† You should provide a name for the action, select a trigger from the list, and then create it. For the purpose of generating a chat token and attaching it to <code>idToken</code>, select the <strong>Login / Post Login</strong> trigger, which allows you to use the action in the login flow.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5wbUmlcD0qq7FrgBCiURrS/a95bb544b5d4fdaa4eac2a87b5fd9361/create_action_trigger.png" alt="Create action trigger"/></p><p>You&#39;ll see an editor where you can write your logic. You can run the code, try it out before deploying it, add your secrets to the environment instead of putting it in the application code, and even add almost all public NPM packages!</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/46DWkLU05SPD1kTE6i5oGF/54f46b0d30cd13bf141b4beb28a2445e/action_module.png" alt=" action module"/></p><p>üõ† Start by adding the <code>getstream</code> npm package. At the time of writing, the current version of the package is <code><span>7.2</span><span>.10</span></code>.</p><p>üõ† Go back to the Stream dashboard, copy your secret and client keys...</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5aLtEOAjfXguB6BQlI8fmB/b55f3fd1d0c7c44c91c760c5850d8457/chat_app_secret.png" alt="chat app secret"/></p><p>üõ† ...and then add them with the name of <code><span>GET_STREAM_CHAT_SECRET_KEY</span></code> and <code><span>GET_STREAM_CHAT_CLIENT_KEY</span></code>, respectively, to this function in Auth0.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4JgG1WLTfWa2RTlkzAkV8j/1704cdf6b2e7abfd23e611171440dce5/action_secrets.png" alt=" action secrets"/></p><p>üõ† Lastly, you can import <code>getStream</code> and connect and create a user token bypassing <code>user_id</code>.</p><pre><code><span>// Javascript</span>

<span>const</span> stream <span>=</span> <span>require</span><span>(</span><span>&#39;getstream&#39;</span><span>)</span><span>;</span>

exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> getStreamClient <span>=</span> stream<span>.</span><span>connect</span><span>(</span>
    event<span>.</span>secrets<span>.</span><span>GET_STREAM_CHAT_CLIENT_KEY</span><span>,</span>
    event<span>.</span>secrets<span>.</span><span>GET_STREAM_CHAT_SECRET_KEY</span>
  <span>)</span><span>;</span>
  <span>const</span> getStreamToken <span>=</span> getStreamClient<span>.</span><span>createUserToken</span><span>(</span>
    <span><span>`</span><span><span>${</span>event<span>.</span>user<span>.</span>user_id<span>.</span><span>split</span><span>(</span><span>&#39;|&#39;</span><span>)</span><span>.</span><span>join</span><span>(</span><span>&#39;&#39;</span><span>)</span><span>}</span></span><span>`</span></span> <span>// getstream does not support `|` in the ID yet, so we have to omit it.</span>
  <span>)</span><span>;</span>

  <span>// api.user.setAppMetadata(&#34;stream_chat_token&#34;, getStreamToken);</span>
  <span>// api.user.setUserMetadata(&#34;stream_chat_token&#34;, getStreamToken);</span>
  <span>const</span> namespace <span>=</span> <span>&#39;https://getstream.mjcoffee.app&#39;</span><span>;</span>
  <span>if</span> <span>(</span>event<span>.</span>authorization<span>)</span> <span>{</span>
    api<span>.</span>idToken<span>.</span><span>setCustomClaim</span><span>(</span><span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/user_token</span><span>`</span></span><span>,</span> getStreamToken<span>)</span><span>;</span>
    api<span>.</span>accessToken<span>.</span><span>setCustomClaim</span><span>(</span><span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/user_token</span><span>`</span></span><span>,</span> getStreamToken<span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>Let&#39;s explore the implementation above. </p><p>Once you get the token, you can set a user or app metadata named <code>stream_chat_token</code> with the token value. </p><p>Alternately, you can set a custom claim on <code>idToken</code> and <code>accessToken</code>. A custom claim must take the form of a URI, which means that <code>https<span>:</span><span>/</span><span>/</span>getstream<span>.</span>mjcoffee<span>.</span>app<span>/</span>user_token</code> is an acceptable name for a claim, while <code>user_token</code> alone is not.</p><blockquote><p><strong>Important:</strong> In Stream, only the characters <code>a</code> through <code>z</code>, <code><span>0</span></code> through <code><span>9</span></code>, <code>@</code>, <code>_</code>, and <code><span>-</span></code> are allowed in the user ID. Therefore, we shouldn‚Äôt use the <code><span>|</span></code> for <code>user_id</code> in Auth0.</p></blockquote><p>Let&#39;s run and test this function before we deploy. Click on the play icon and run with the example event, which is automatically generated for you.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1b3pOpx8O1g4MBOqmhI6ix/88e2335e0b2bb8a3730dba6ebcc57e44/action_run.png" alt=" action run"/></p><p>If everything goes well, you‚Äôll get a generated token in JWT format. Its payload will contain <code>user_id</code>, and it will be signed with your secret key by the Stream servers.</p><p>Here‚Äôs an example of what you‚Äôll get:</p><pre><code><span>// response in Action run</span>

<span>[</span>
  <span>{</span>
    name<span>:</span> <span>&#39;https://getstream.mjcoffee.app/user_token&#39;</span><span>,</span>
    target<span>:</span> <span>&#39;idToken&#39;</span><span>,</span>
    type<span>:</span> <span>&#39;SetCustomClaim&#39;</span><span>,</span>
    value<span>:</span>
      <span>&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYXV0aDA1ZjdjOGVjN2MzM2M2YzAwNGJiYWZlODIifQ.7ZIyr27skgrGm6REEz5o-WvoCArNblDnwiOdxXW4dp8&#39;</span><span>,</span>
  <span>}</span><span>,</span>
  <span>{</span>
    name<span>:</span> <span>&#39;https://getstream.mjcoffee.app/user_token&#39;</span><span>,</span>
    target<span>:</span> <span>&#39;accessToken&#39;</span><span>,</span>
    type<span>:</span> <span>&#39;SetCustomClaim&#39;</span><span>,</span>
    value<span>:</span>
      <span>&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiYXV0aDA1ZjdjOGVjN2MzM2M2YzAwNGJiYWZlODIifQ.7ZIyr27skgrGm6REEz5o-WvoCArNblDnwiOdxXW4dp8&#39;</span><span>,</span>
  <span>}</span><span>,</span>
<span>]</span><span>;</span></code></pre><p><img src="https://images.ctfassets.net/23aumh6u8s0i/Ax6b4nRMkHyjvfGBK47bV/d15969eb0f4740dfe1057372e04c4437/jwt_stream.png" alt="action run"/></p><p>üõ† Next, go back to <strong>Flow</strong>, select <strong>Login</strong>, and drag your newly-created custom action to the flow and apply the changes:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5oYj9z0hIawXOi3dSW8dEZ/4684098fb3b108dd0cc4f32e01aa4e59/login_flow.png" alt=" action run"/></p><p>For the last step, the Flutter app needs to read this token and add it to the user model. That way, when you connect a user to Stream‚Äôs chat, instead of the development tokens you‚Äôve been using, you can replace it with the token that Auth0 received.</p><p>üõ† Since it&#39;s a custom claim, it will show up in <code>idToken</code>; thus you‚Äôll need to modify your <code>Auth0IdToken</code> model class (located in <code><span>/</span>lib<span>/</span>models<span>/</span>auth0_id_token<span>.</span>dart</code>)...</p><pre><code><span>// /lib/models/auth0_id_token.dart</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0IdToken</span> <span>{</span>
  <span>Auth0IdToken</span><span>(</span><span>{</span>
  
  <span>.</span><span>.</span><span>.</span><span>.</span>
  
    required <span>this</span><span>.</span>streamChatUserToken<span>,</span>
  
  <span>.</span><span>.</span><span>.</span><span>.</span>
  
<span>}</span><span>)</span>

<span>.</span><span>.</span><span>.</span><span>.</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://getstream.mjcoffee.app/user_token&#39;</span><span>)</span>
  <span>final</span> String streamChatUserToken<span>;</span>

<span>.</span><span>.</span><span>.</span><span>.</span>

<span>}</span></code></pre><p>üõ† Then do the same with your <code>Auth0User</code> class (located in <code><span>/</span>lib<span>/</span>models<span>/</span>auth0_user<span>.</span>dart</code>), as it will be part of the user details:</p><pre><code><span>// m/lib/models/auth0_user.dart</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0User</span> <span>{</span>
  <span>Auth0User</span><span>(</span><span>{</span>
  <span>.</span><span>.</span><span>.</span><span>.</span>
      required <span>this</span><span>.</span>streamChatUserToken<span>,</span>
  <span>.</span><span>.</span><span>.</span><span>.</span>
<span>}</span><span>)</span>
<span>.</span><span>.</span><span>.</span><span>.</span>
  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://getstream.mjcoffee.app/user_token&#39;</span><span>)</span>
  <span>final</span> String streamChatUserToken<span>;</span>
<span>.</span><span>.</span><span>.</span><span>.</span>
<span>}</span></code></pre><p>üõ† Once you are done, run the <code>build_runner</code> command to generate models again.</p><pre><code>flutter pub run build_runner build --delete-conflicting-outputs</code></pre><p>üõ† Locate <code>connectUser</code> in the <code>ChatService</code> class (located in <code><span>/</span>lib<span>/</span>services<span>/</span>chat_service<span>.</span>dart</code>) and replace <code><span>devToken</span><span>(</span><span>)</span></code> with the newly-received token on the user object.</p><pre><code><span>// /lib/services/chat_service.dart</span>

<span>await</span> client<span>.</span><span>connectUser</span><span>(</span>
  <span>User</span><span>(</span>
    id<span>:</span> user<span>.</span>id<span>,</span>
    extraData<span>:</span> <span>{</span>
      <span>&#39;image&#39;</span><span>:</span> user<span>.</span>picture<span>,</span>
      <span>&#39;name&#39;</span><span>:</span> user<span>.</span>name<span>,</span>
    <span>}</span><span>,</span>
  <span>)</span><span>,</span>
  <span>// client.devToken(user.id).rawValue,</span>
    user<span>.</span>streamChatUserToken<span>,</span>
<span>)</span><span>;</span></code></pre><p>Well done! Log out of the app, restart it. and log in again. This time, you&#39;ll receive a production-ready user token. When you go to the support chat screen, everything should work as expected.</p><h2 id="Looking-Ahead">Looking Ahead</h2><p>Now that the app has a real-time chat is ready with a proper authentication flow, you can move on to the next section to focus on authorization, roles, and permissions.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 04 Oct 2021 17:13:00 +0000</pubDate>
    </item>
    <item>
      <title>Flutter Authentication and Authorization with Auth0, Part 4: Roles and Permissions</title>
      <link>https://auth0.com/blog/flutter-authentication-authorization-with-auth0-part-4-roles-permissions/</link>
      <description>In this tutorial, you‚Äôll learn how to enhance your Flutter apps by enabling authentication, supporting federated identity providers, adding authorization by introducing roles and permissions, all leveraging Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the previous section, you learned how to add real-time chat to the application and set up the <em>MJ Coffee</em> app to load different chat screens. </p><p>In this section, you will learn how to manage roles and permissions in Auth0 and a Flutter app, as well as how to apply a proper authorization flow. You&#39;ll also learn how to leverage RBAC and permission-based functionalities in a Flutter application.</p><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong></p></blockquote><h2 id="Managing-Roles">Managing Roles</h2><p>In a previous section in this tutorial, you learned how to create roles in the Auth0 dashboard. It‚Äôs time to see why you need roles and learn how you can leverage them into your app.</p><p>Role-based access control (RBAC) is a way to assign permissions to users based on their roles. It offers a simple approach to access management that is less prone to error than assigning permissions to users individually.</p><p>For example, suppose you use RBAC to control Customer/Employee access in the <em>MJ Coffee</em> application. In that case, you could give employees a role that allows them to update users‚Äô details or access the community chat screen. In contrast, customers would view the support screen, but wouldn‚Äôt be authorized to perform tasks such as deleting messages or uploading attachments.</p><p>When planning your access control strategy, it‚Äôs generally a good idea to assign users a smalled number of permissions that allow them to get their work done.</p><p>You can leverage Auth0 Actions to assign roles automatically to each user after they sign up.</p><p>üõ† Once more, create a new custom action. In the left column menu of the Auth0 dashboard, select <strong>Actions</strong>, then <strong>Flows</strong>. The <strong>Choose Flow</strong> page will appear. Select <strong>Post User Registration</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1pbuab4m48ur5r0abMjpx5/0c67319150786f3ccff7a1fd4f788b60/create_new_post_user_registration.png" alt="Creating a new post user registration"/></p><p>üõ† Name the action <code>Assign Role</code> and add the <code>auth0</code> npm module with version <code><span>2.35</span><span>.1</span></code>.</p><p>üõ† Add the following handler, which will be called during the execution of a <code>PostUserRegistration</code> flow:</p><pre><code><span>// Auth0 Actions</span>

<span>const</span> ManagementClient <span>=</span> <span>require</span><span>(</span><span>&#39;auth0&#39;</span><span>)</span><span>.</span>ManagementClient<span>;</span>
<span>const</span> AuthenticationClient <span>=</span> <span>require</span><span>(</span><span>&#39;auth0&#39;</span><span>)</span><span>.</span>AuthenticationClient<span>;</span>

exports<span>.</span><span>onExecutePostUserRegistration</span> <span>=</span> <span>async</span> <span>(</span><span>event</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>DOMAIN</span> <span>=</span> <span>&#39;{YOUR_DOMAIN}&#39;</span><span>;</span>
  <span>const</span> auth0 <span>=</span> <span>new</span> <span>AuthenticationClient</span><span>(</span><span>{</span>
    domain<span>:</span> <span>DOMAIN</span><span>,</span>
    clientId<span>:</span> event<span>.</span>secrets<span>.</span><span>M2M_CLIENT_ID</span><span>,</span>
    clientSecret<span>:</span> event<span>.</span>secrets<span>.</span><span>M2M_CLIENT_SECRET</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
  <span>const</span> response <span>=</span> <span>await</span> auth0<span>.</span><span>clientCredentialsGrant</span><span>(</span><span>{</span>
    audience<span>:</span> <span><span>`</span><span>https://</span><span><span>${</span><span>DOMAIN</span><span>}</span></span><span>/api/v2/</span><span>`</span></span><span>,</span>
    scope<span>:</span> <span>&#39;read:users update:users&#39;</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
  <span>const</span> <span>API_TOKEN</span> <span>=</span> response<span>.</span>access_token<span>;</span>
  <span>const</span> management <span>=</span> <span>new</span> <span>ManagementClient</span><span>(</span><span>{</span>
    domain<span>:</span> <span>DOMAIN</span><span>,</span>
    token<span>:</span> <span>API_TOKEN</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>if</span> <span>(</span>event<span>.</span>user<span>.</span>email<span>.</span><span>endsWith</span><span>(</span><span>&#39;@mjcoffee.app&#39;</span><span>)</span><span>)</span> <span>{</span>
    <span>// employee</span>
    <span>await</span> management<span>.</span><span>assignRolestoUser</span><span>(</span>
      <span>{</span> id<span>:</span> event<span>.</span>user<span>.</span>user_id <span>}</span><span>,</span>
      <span>{</span> roles<span>:</span> <span>[</span><span>&#39;rol_CHpJMdZUPCLzo6E2&#39;</span><span>]</span> <span>}</span>
    <span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>// customer</span>
    <span>await</span> management<span>.</span><span>assignRolestoUser</span><span>(</span>
      <span>{</span> id<span>:</span> event<span>.</span>user<span>.</span>user_id <span>}</span><span>,</span>
      <span>{</span> roles<span>:</span> <span>[</span><span>&#39;rol_fG50GuNE9S72jNZn&#39;</span><span>]</span> <span>}</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>Let&#39;s analyze this handler‚Äôs logic step by step.</p><p>The handler imports both <code>ManagementClient</code> and <code>AuthenticationClient</code> from the <code>auth0</code> module, a Node.js SDK that conveniently provides official Auth0 public APIs.</p><p>It then defines your domain name, <code><span>DOMAIN</span></code>. </p><p>üõ† In the handler, replace <code><span>{</span><span>YOUR_DOMAIN</span><span>}</span></code> with your application‚Äôs domain, which you‚Äôll find in the Auth0 dashboard.</p><p>The handler initializes an authentication client, passing its constructor the application‚Äôs domain, client ID, and client secret. </p><p><strong>Note that the application client is a bit special here!</strong> This is <em>not</em> the application you have created and worked with so far. You need to create a Machine-to-Machine (M2M) application or Auth0 non-interactive client, which makes it possible to request a client credentials grant.</p><p>üõ† Open the Auth0 dashboard in a new tab in your browser. Go to the <strong>Applications</strong> page and creating a new application, selecting the <strong>Machine to Machine Applications</strong> type:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4s9EPsMj5Lg5StnSURGU4X/df7a4f7a97be3e83a4ff84d446137df3/create_new_m2m_app.png" alt="Creating a new M2M application in the Auth0 dashboard"/></p><p>üõ† Once the M2M application is created, take a note of Client ID and Client Secret. You will need to add them to your Actions‚Äô secrets in the next step, then go to the <strong>APIs</strong> tab and authorize the Auth0 Management API.</p><p>As mentioned before, it&#39;s always a good idea to limit the permissions. Hence, select only those permissions needed to perform actions with this Client. </p><p>üõ† We want to be able to add roles to users, so select the <code>read<span>:</span>users</code> and <code>update<span>:</span>users</code> permissions:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1zQbWKfW0orBdHROj3RR3j/ce856b0663b4f78610c9d3aa1ea9e0e5/authorize_api.png" alt="Authorizing the API"/></p><p>üõ† Add the following to the action:</p><ul><li>The key <code><span>M2M_CLIENT_ID</span></code>, with the client ID as its corresponding value</li><li>The key <code><span>M2M_CLIENT_SECRET</span></code>, with the client secret as the value</li></ul><p>You can now successfully authenticate an Auth0 client and request a management API token by specifying audiences and scopes. Scopes are the ones that you have selected in the previous steps in the permission tab under Auth0 management API.</p><p>Once access is granted and the token is received, you can create a management client.</p><p>The logic is relatively simple for this MJ Coffee app.</p><pre><code><span>if</span> <span>(</span>event<span>.</span>user<span>.</span>email<span>.</span><span>endsWith</span><span>(</span><span>&#39;@mjcoffee.app&#39;</span><span>)</span><span>)</span> <span>{</span>
  <span>// employee</span>
<span>}</span> <span>else</span> <span>{</span>
  <span>// customer</span>
<span>}</span></code></pre><p>Simply put, if the user‚Äôs email address ends with  <code>@mjcoffee<span>.</span>app</code> they will be assigned the <em>employee</em> role; otherwise, they‚Äôll be assigned the <em>customer</em> role. This, of course, could change based on your implementation.</p><p>Finally, the handler calls <code><span>assignRolesToUser</span><span>(</span><span>)</span></code> on the <code>management</code> client and passes:</p><ul><li>a map containing the user ID, and</li><li>a list of role IDs.</li></ul><p>To get a role‚Äôs ID, select <strong>User Management</strong> in the Auth0 dashboard‚Äôs left column menu, then select <strong>Roles</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4WKeTj5YRcq1IZUcxCO32d/d627b895fe44352d1e4f7de01fa406c6/role_id.png" alt="Getting a Role‚Äôs ID"/></p><p>Fantastic! Don‚Äôt forget to deploy your function.</p><p>üõ† For the last step, go to <strong>Flows</strong>, then <strong>Post User Registration</strong>. Add your <code>Assign Role</code> custom action to the flow.</p><p>If you are impatient to test what you have created so far, navigate to the Auth0 dashboard‚Äôs <strong>Users</strong> page and create new users with and without email addresses that you have specified in your function logic. Then, go to the <strong>Role</strong> tab ‚Äî you should see that for each user, their role was assigned automatically:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/30XsYPDx2euHspY9BGnk6s/ddcaf08706e6dda515179b46611cd724/user_role.png" alt="Users and their automatically assigned roles"/></p><h2 id="Managing-Permissions">Managing Permissions</h2><p>You‚Äôll often need to create a custom API that defines permissions. Then you can assign those permissions to roles, which can then be assigned to users.</p><p>üõ† In the Auth0 dashboard, select <strong>Applications</strong> in the left column menu, select <strong>APIs</strong> in the submenu, and then click the <strong>Create API</strong> button to create a new custom API.</p><p>üõ† Give the API a recognizable name, such as <code>StreamChat Management <span>API</span></code>, then define your identifier. This identifier will become your API audience. Note that the identifier cannot be modified. A good practice for naming identifiers is to use a URL, even if that URL is not publicly available. For example, you could name the identifier <code>https<span>:</span><span>/</span><span>/</span>getStreamChat<span>.</span>mjcoffee<span>.</span>app<span>/</span>v1<span>/</span></code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4NdodtRf9CZSY8O8Onb5fP/7b0216eed696a44a99ef5a99437431a5/custom_api.png" alt="Creating a new custom API"/></p><p>üõ† Once the API is created, go to the RBAC Settings section and enable RBAC and Add Permissions in the Access Token. The API is supposed to be flagged as First Party so that you can turn on Allow Skipping User Consent. Turn on Allow Offline Access so that Auth0 will allow applications to ask for Refresh Tokens for this API.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1egWhGNMvy0g12Oh6ccQyq/ee28278cf4831101c95dc9ceb5acbf50/rbac-api.png" alt="RBAC API"/></p><p>üõ† Navigate to the <strong>Permissions</strong> tab and add your permissions and description. I recommend at adding at least these permissions:</p><ul><li><code><span>delete</span><span>.</span>user<span>.</span>message</code></li><li><code>edit<span>.</span>user<span>.</span>message</code></li><li><code>upload<span>.</span>attachments</code></li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/47v9LpCiZKbnsTL3VDBQoe/fc80c54e22f8d316b3bf02a6ab3e656f/custom_permissions.png" alt="Custome permissions"/></p><p>The more permissions you define, and the more explicit they are,  the better you can control the resources.</p><p>üõ† Next, head over to <strong>Roles</strong> under <strong>User Management</strong>. Go to each role and assign the following permissions:</p><ul><li><strong>Employee</strong>
<ul><li><code>edit<span>.</span>user<span>.</span>message</code></li><li><code>upload<span>.</span>attachments</code></li></ul></li><li><strong>Customer</strong>
<ul><li><code>edit<span>.</span>user<span>.</span>message</code></li></ul></li><li><strong>Admin</strong>
<ul><li><code><span>delete</span><span>.</span>user<span>.</span>message</code></li><li><code>edit<span>.</span>user<span>.</span>message</code></li><li><code>upload<span>.</span>attachments</code></li></ul></li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6JylazPCTIIvUKwrSicEib/116523b7e52452211349376dff85dba0/role_permission.png" alt="Defining custom permissions"/></p><p>You have managed to create roles and users are automatically assigned roles on registration. Although role assignment is automatic now, you can still alter user roles manually. For example, you can add the <strong>Admin</strong> role to specific users in the Auth0 dashboard.</p><p>The only step remaining is to expose the roles and permissions to <code>idToken</code> and <code>accessToken</code> that the Flutter app can consume.</p><h2 id="Exposing-Roles-and-Permission">Exposing Roles and Permission</h2><p>üõ† This step is pretty similar to what you have done when assigning roles. As a reminder, here are the steps:</p><ul><li>Create a custom action, triggering Login/Post Login</li><li>Name the action ‚ÄúRevealing User Roles &amp; Permissions‚Äù</li><li>Add the machine-to-machine application‚Äôs client ID and client key to the action‚Äôs secrets</li><li>Add <code>auth0</code> npm package version <code><span>2.35</span><span>.1</span></code></li></ul><p>üõ† Once you‚Äôve done that, follow the code below:</p><pre><code><span>// Auth0 Actions</span>

<span>const</span> ManagementClient <span>=</span> <span>require</span><span>(</span><span>&#39;auth0&#39;</span><span>)</span><span>.</span>ManagementClient<span>;</span>
<span>const</span> AuthenticationClient <span>=</span> <span>require</span><span>(</span><span>&#39;auth0&#39;</span><span>)</span><span>.</span>AuthenticationClient<span>;</span>
exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>DOMAIN</span> <span>=</span> <span>&#39;mhadaily.eu.auth0.com&#39;</span><span>;</span>
  <span>const</span> auth0 <span>=</span> <span>new</span> <span>AuthenticationClient</span><span>(</span><span>{</span>
    domain<span>:</span> <span>DOMAIN</span><span>,</span>
    clientId<span>:</span> event<span>.</span>secrets<span>.</span><span>M2M_CLIENT_ID</span><span>,</span>
    clientSecret<span>:</span> event<span>.</span>secrets<span>.</span><span>M2M_CLIENT_SECRET</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
  <span>const</span> response <span>=</span> <span>await</span> auth0<span>.</span><span>clientCredentialsGrant</span><span>(</span><span>{</span>
    audience<span>:</span> <span><span>`</span><span>https://</span><span><span>${</span><span>DOMAIN</span><span>}</span></span><span>/api/v2/</span><span>`</span></span><span>,</span>
    scope<span>:</span> <span>&#39;read:users update:users read:roles&#39;</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
  <span>const</span> <span>API_TOKEN</span> <span>=</span> response<span>.</span>access_token<span>;</span>
  <span>const</span> management <span>=</span> <span>new</span> <span>ManagementClient</span><span>(</span><span>{</span>
    domain<span>:</span> <span>DOMAIN</span><span>,</span>
    token<span>:</span> <span>API_TOKEN</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>const</span> params <span>=</span> <span>{</span> id<span>:</span> event<span>.</span>user<span>.</span>user_id <span>}</span><span>;</span>
  <span>const</span> roles <span>=</span> <span>await</span> management<span>.</span><span>getUserRoles</span><span>(</span>params<span>)</span><span>;</span>
  <span>const</span> permissions <span>=</span> <span>await</span> management<span>.</span><span>getUserPermissions</span><span>(</span>params<span>)</span><span>;</span>

  <span>const</span> namespace <span>=</span> <span>&#39;https://users.mjcoffee.app&#39;</span><span>;</span>
  <span>if</span> <span>(</span>event<span>.</span>authorization<span>)</span> <span>{</span>
    api<span>.</span>idToken<span>.</span><span>setCustomClaim</span><span>(</span><span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/roles</span><span>`</span></span><span>,</span> roles<span>)</span><span>;</span>
    api<span>.</span>accessToken<span>.</span><span>setCustomClaim</span><span>(</span><span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/roles</span><span>`</span></span><span>,</span> roles<span>)</span><span>;</span>
    api<span>.</span>idToken<span>.</span><span>setCustomClaim</span><span>(</span><span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/permissions</span><span>`</span></span><span>,</span> permissions<span>)</span><span>;</span>
    api<span>.</span>accessToken<span>.</span><span>setCustomClaim</span><span>(</span><span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/permissions</span><span>`</span></span><span>,</span> permissions<span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>The code is pretty similar to what you have written once before. The first change is that it adds <code>read<span>:</span>roles</code> to the scope. Make sure you have enabled this permission under the M2M application as you have done once for the <code>read<span>:</span>users update<span>:</span>users</code> permissions; otherwise, you will face an ‚Äúunauthorized‚Äù error.</p><p>It then calls <code><span>getUserRoles</span><span>(</span><span>)</span></code> and <code><span>getUserPermissions</span><span>(</span><span>)</span></code>,  passing the user ID. These functions will return user roles and permissions respectively.</p><p>After defining a namespace, the code calls <code><span>setCustomClaim</span><span>(</span><span>)</span></code> to add both roles and permission custom claims to the ID and access tokens.</p><p>üõ† Make sure you deploy and then navigate to <strong>Flows</strong>. You want to add the new custom action to the login flow right before the previous action you created earlier:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5XinnapiJ1AUQN0LiHY5sV/bf95d7da7f1333aafe30f80f0e81f14e/new_login_flow.png" alt="new flow login"/></p><p>So far so good, but you still need to go to the Flutter app and add roles and permissions to the models.</p><h2 id="Read-Roles-and-Permissions-in-Flutter">Read Roles and Permissions in Flutter</h2><p>Now that both roles and permissions are available in the ID and access tokens, you can add them to <code>Auth0IdToken</code> and <code>Auth0UserInfo</code>, respectively.</p><p>üõ† First, create a file named <code>auth0_roles<span>.</span>dart</code> file in the <code><span>/</span>lib<span>/</span>models</code> folder:</p><pre><code><span>// /lib/models/auth0_roles.dart</span>

<span>import</span> <span>&#39;package:json_annotation/json_annotation.dart&#39;</span><span>;</span>

<span>part</span> <span>&#39;auth0_roles.g.dart&#39;</span><span>;</span>

<span>enum</span> Role <span>{</span>
  Employee<span>,</span>
  Admin<span>,</span>
  Customer<span>,</span>
<span>}</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0Role</span> <span>{</span>
  <span>Auth0Role</span><span>(</span><span>{</span>
    required <span>this</span><span>.</span>id<span>,</span>
    required <span>this</span><span>.</span>name<span>,</span>
    required <span>this</span><span>.</span>description<span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>final</span> String id<span>;</span>
  <span>final</span> Role name<span>;</span>
  <span>final</span> String description<span>;</span>

  <span>factory</span> Auth0Role<span>.</span><span>fromJson</span><span>(</span>Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> json<span>)</span> <span>=</span><span>&gt;</span>
      _$<span>Auth0RoleFromJson</span><span>(</span>json<span>)</span><span>;</span>

  Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> <span>toJson</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> _$<span>Auth0RoleToJson</span><span>(</span><span>this</span><span>)</span><span>;</span>

  <span>@override</span>
  String <span>toString</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> <span>&#39;&#39;&#39;$name&#39;&#39;&#39;</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>üõ† Then create <code>auth0_permissions<span>.</span>dart</code> in the same directory, with the code below:</p><pre><code><span>// /lib/models/auth0_permissions.dart</span>

<span>import</span> <span>&#39;package:json_annotation/json_annotation.dart&#39;</span><span>;</span>

<span>part</span> <span>&#39;auth0_permissions.g.dart&#39;</span><span>;</span>

<span>class</span> <span>UserPermissions</span> <span>{</span>
  <span>static</span> <span>const</span> String delete <span>=</span> <span>&#39;delete.user.message&#39;</span><span>;</span>
  <span>static</span> <span>const</span> String edit <span>=</span> <span>&#39;edit.user.message&#39;</span><span>;</span>
  <span>static</span> <span>const</span> String upload <span>=</span> <span>&#39;upload.attachments&#39;</span><span>;</span>
<span>}</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0Permission</span> <span>{</span>
  <span>Auth0Permission</span><span>(</span><span>{</span>
    required <span>this</span><span>.</span>permissionName<span>,</span>
    required <span>this</span><span>.</span>description<span>,</span>
    required <span>this</span><span>.</span>resourceServerName<span>,</span>
    required <span>this</span><span>.</span>resourceServerIdentifier<span>,</span>
    required <span>this</span><span>.</span>sources<span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;permission_name&#39;</span><span>)</span>
  <span>final</span> String permissionName<span>;</span>

  <span>final</span> String description<span>;</span>
  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;resource_server_name&#39;</span><span>)</span>
  <span>final</span> String resourceServerName<span>;</span>
  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;resource_server_identifier&#39;</span><span>)</span>
  <span>final</span> String resourceServerIdentifier<span>;</span>

  <span>final</span> List<span>&lt;</span>Auth0PermissionsSource<span>&gt;</span> sources<span>;</span>

  <span>factory</span> Auth0Permission<span>.</span><span>fromJson</span><span>(</span>Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> json<span>)</span> <span>=</span><span>&gt;</span>
      _$<span>Auth0PermissionFromJson</span><span>(</span>json<span>)</span><span>;</span>

  Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> <span>toJson</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> _$<span>Auth0PermissionToJson</span><span>(</span><span>this</span><span>)</span><span>;</span>

  <span>@override</span>
  String <span>toString</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> <span>&#39;&#39;&#39;$permissionName&#39;&#39;&#39;</span><span>;</span>
  <span>}</span>
<span>}</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0PermissionsSource</span> <span>{</span>
  <span>Auth0PermissionsSource</span><span>(</span><span>{</span>
    required <span>this</span><span>.</span>sourceId<span>,</span>
    required <span>this</span><span>.</span>sourceName<span>,</span>
    required <span>this</span><span>.</span>sourceType<span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;source_id&#39;</span><span>)</span>
  <span>final</span> String sourceId<span>;</span>
  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;source_name&#39;</span><span>)</span>
  <span>final</span> String sourceName<span>;</span>
  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;source_type&#39;</span><span>)</span>
  <span>final</span> String sourceType<span>;</span>

  <span>factory</span> Auth0PermissionsSource<span>.</span><span>fromJson</span><span>(</span>Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> json<span>)</span> <span>=</span><span>&gt;</span>
      _$<span>Auth0PermissionsSourceFromJson</span><span>(</span>json<span>)</span><span>;</span>

  Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> <span>toJson</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> _$<span>Auth0PermissionsSourceToJson</span><span>(</span><span>this</span><span>)</span><span>;</span>

  <span>@override</span>
  String <span>toString</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> <span>&#39;&#39;&#39;
      sourceId: $sourceId,
      sourceName: $sourceName,
      sourceType: $sourceType,
      &#39;&#39;&#39;</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>What you want to achieve here is to serialize and deserialize the roles and permissions for each model.</p><p>üõ† The next step is to update the <code>Auth0IdToken</code> model:</p><pre><code><span>// /lib/models/auth0_id_token.dart</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0IdToken</span> <span>{</span>
  <span>Auth0IdToken</span><span>(</span><span>{</span>
  
<span>.</span><span>.</span><span>.</span>

    required <span>this</span><span>.</span>roles<span>,</span>
    required <span>this</span><span>.</span>permissions<span>,</span>

<span>.</span><span>.</span><span>.</span>

<span>}</span><span>}</span>

<span>.</span><span>.</span><span>.</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://users.mjcoffee.app/roles&#39;</span><span>)</span>
  <span>final</span> List<span>&lt;</span>Auth0Role<span>&gt;</span> roles<span>;</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://users.mjcoffee.app/permissions&#39;</span><span>)</span>
  <span>final</span> List<span>&lt;</span>Auth0Permission<span>&gt;</span> permissions<span>;</span>
  
<span>.</span><span>.</span><span>.</span>

<span>}</span></code></pre><p>üõ† Do the same for the <code>Auth0User</code> model:</p><pre><code><span>// /lib/models/auth0_user.dart</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0User</span> <span>{</span>
  <span>Auth0User</span><span>(</span><span>{</span>
  
<span>.</span><span>.</span><span>.</span>

    required <span>this</span><span>.</span>permissions<span>,</span>
    required <span>this</span><span>.</span>roles<span>,</span>
    
<span>.</span><span>.</span><span>.</span>

<span>}</span><span>)</span>

<span>.</span><span>.</span><span>.</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://users.mjcoffee.app/roles&#39;</span><span>)</span>
  <span>final</span> List<span>&lt;</span>Auth0Role<span>&gt;</span> roles<span>;</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://users.mjcoffee.app/permissions&#39;</span><span>)</span>
  <span>final</span> List<span>&lt;</span>Auth0Permission<span>&gt;</span> permissions<span>;</span>
  
<span>.</span><span>.</span><span>.</span>

<span>}</span></code></pre><p>üõ† Finally, run the <code>build_runner</code> command to ensure that the models are generated properly:</p><pre><code>flutter pub run build_runner build --delete-conflicting-outputs</code></pre><p>You can now restart the <em>MJ Coffee</em> app, and everything should work as expected.</p><h2 id="Role-Based-Screens-in-Flutter">Role-Based Screens in Flutter</h2><p>It‚Äôs finally time to have a loading screen based on the user&#39;s role. If you remember, we wanted to add Support and Community screens for customers and employees, respectively. You created both screens earlier.</p><p>It would be easier to define getter methods in <code>Auth0User</code> to determine whether a user has a particular role or permission.</p><p>üõ† Add code to the <code>Auth0User</code> class as shown below:</p><pre><code><span>// /lib/models/auth0_user.dart</span>

<span>class</span> <span>Auth0User</span> <span>{</span>

<span>.</span><span>.</span><span>.</span>

  bool <span>get</span> hasImage <span>=</span><span>&gt;</span> picture<span>.</span>isNotEmpty<span>;</span>
  bool <span>can</span><span>(</span>String permission<span>)</span> <span>=</span><span>&gt;</span> permissions
      <span>.</span><span>where</span><span>(</span>
        <span>(</span>p<span>)</span> <span>=</span><span>&gt;</span> p<span>.</span>permissionName <span>==</span> permission<span>,</span>
      <span>)</span>
      <span>.</span>isNotEmpty<span>;</span>

  <span>get</span> isAdmin <span>=</span><span>&gt;</span> roles<span>.</span><span>where</span><span>(</span><span>(</span>role<span>)</span> <span>=</span><span>&gt;</span> role<span>.</span>name <span>==</span> Role<span>.</span>Admin<span>)</span><span>.</span>isNotEmpty<span>;</span>
  <span>get</span> isEmployee <span>=</span><span>&gt;</span>
      roles<span>.</span><span>where</span><span>(</span><span>(</span>role<span>)</span> <span>=</span><span>&gt;</span> role<span>.</span>name <span>==</span> Role<span>.</span>Employee<span>)</span><span>.</span>isNotEmpty<span>;</span>
  <span>get</span> isCustomer <span>=</span><span>&gt;</span>
      roles<span>.</span><span>where</span><span>(</span><span>(</span>role<span>)</span> <span>=</span><span>&gt;</span> role<span>.</span>name <span>==</span> Role<span>.</span>Customer<span>)</span><span>.</span>isNotEmpty<span>;</span>
      
<span>.</span><span>.</span><span>.</span>

<span>}</span></code></pre><p>These getters are pretty self-explanatory.</p><p>üõ† Next, open <code><span>/</span>lib<span>/</span>screens<span>/</span>menu<span>.</span>dart</code> and locate the <code>tabs</code> list in the <code>_MenuScreenState</code> class:</p><pre><code><span>// /lib/screens/menu.dart</span>

  <span>.</span><span>.</span><span>.</span>
  
  <span>final</span> List<span>&lt;</span>Widget<span>&gt;</span> tabs <span>=</span> <span>[</span>
      <span>MenuList</span><span>(</span>coffees<span>:</span> coffees<span>)</span><span>,</span>
      <span>if</span> <span>(</span>AuthService<span>.</span>instance<span>.</span>profile<span>?</span><span>.</span>isCustomer<span>)</span>
        <span>SupportChatScreen</span><span>(</span><span>)</span>
      <span>else</span>
        <span>CommunityScreen</span><span>(</span><span>)</span><span>,</span>
      <span>ProfileScreen</span><span>(</span><span>)</span><span>,</span>
    <span>]</span><span>;</span>
    
  <span>.</span><span>.</span><span>.</span></code></pre><p>üõ† In the same file, find <code>BottomNavigationBar</code> and add <code>BottomNavigationBarItem</code> to the second position in the list:</p><pre><code><span>// /lib/screens/menu.dart</span>

<span>.</span><span>.</span><span>.</span>

BottomNavigationBar <span>_bottomNavigationBar</span><span>(</span>Auth0User<span>?</span> user<span>)</span> <span>{</span>
    <span>return</span> <span>BottomNavigationBar</span><span>(</span>
      
      <span>.</span><span>.</span><span>.</span>
      
      items<span>:</span> <span>&lt;</span>BottomNavigationBarItem<span>&gt;</span><span>[</span>
      
        <span>.</span><span>.</span><span>.</span>
      
        <span>BottomNavigationBarItem</span><span>(</span>
          icon<span>:</span> AuthService<span>.</span>instance<span>.</span>profile<span>?</span><span>.</span>isCustomer
              <span>?</span> <span>Icon</span><span>(</span>Icons<span>.</span>support_agent<span>)</span>
              <span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>group<span>)</span><span>,</span>
          label<span>:</span> AuthService<span>.</span>instance<span>.</span>profile<span>?</span><span>.</span>isCustomer
              <span>?</span> <span>&#34;Support&#34;</span>
              <span>:</span> <span>&#34;Community&#34;</span><span>,</span>
        <span>)</span><span>,</span>
        
       <span>.</span><span>.</span><span>.</span>
       
      <span>]</span><span>,</span>
      
     <span>.</span><span>.</span><span>.</span>
     
    <span>)</span><span>;</span>
  <span>}</span>
  
<span>.</span><span>.</span><span>.</span></code></pre><p>üõ† To make the UI look better, you can add the user&#39;s avatar to the <code>appBar</code> so that the complete implementation is as follows:</p><pre><code><span>// /lib/screens/menu.dart</span>

<span>class</span> <span>MenuScreen</span> <span>extends</span> <span>StatefulWidget</span> <span>{</span>
  <span>static</span> String routeName <span>=</span> <span>&#39;menuScreen&#39;</span><span>;</span>
  <span>static</span> Route<span>&lt;</span>MenuScreen<span>&gt;</span> <span>route</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> MaterialPageRoute<span>&lt;</span>MenuScreen<span>&gt;</span><span>(</span>
      settings<span>:</span> <span>RouteSettings</span><span>(</span>name<span>:</span> routeName<span>)</span><span>,</span>
      builder<span>:</span> <span>(</span>BuildContext context<span>)</span> <span>=</span><span>&gt;</span> <span>MenuScreen</span><span>(</span><span>)</span><span>,</span>
    <span>)</span><span>;</span>
  <span>}</span>

  <span>@override</span>
  _MenuScreenState <span>createState</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> <span>_MenuScreenState</span><span>(</span><span>)</span><span>;</span>
<span>}</span>

<span>class</span> <span>_MenuScreenState</span> <span>extends</span> <span>State</span><span>&lt;</span>MenuScreen<span>&gt;</span> <span>{</span>
  int _selectedIndex <span>=</span> <span>0</span><span>;</span>
  Auth0User<span>?</span> profile <span>=</span> AuthService<span>.</span>instance<span>.</span>profile<span>;</span>

  <span>@override</span>
  <span>void</span> <span>initState</span><span>(</span><span>)</span> <span>{</span>
    <span>super</span><span>.</span><span>initState</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>final</span> List<span>&lt;</span>Widget<span>&gt;</span> tabs <span>=</span> <span>[</span>
    <span>MenuList</span><span>(</span>coffees<span>:</span> coffees<span>)</span><span>,</span>
    <span>if</span> <span>(</span>AuthService<span>.</span>instance<span>.</span>profile<span>?</span><span>.</span>isCustomer<span>)</span>
      <span>SupportChatScreen</span><span>(</span><span>)</span>
    <span>else</span>
      <span>CommunityScreen</span><span>(</span><span>)</span><span>,</span>
    <span>ProfileScreen</span><span>(</span><span>)</span><span>,</span>
  <span>]</span><span>;</span>

  <span>void</span> <span>_onItemTapped</span><span>(</span>int index<span>)</span> <span>{</span>
    <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
      _selectedIndex <span>=</span> index<span>;</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>@override</span>
  Widget <span>build</span><span>(</span>BuildContext context<span>)</span> <span>{</span>
    <span>return</span> <span>Scaffold</span><span>(</span>
      backgroundColor<span>:</span> Colors<span>.</span>white<span>,</span>
      appBar<span>:</span> <span>AppBar</span><span>(</span>
        automaticallyImplyLeading<span>:</span> <span>false</span><span>,</span>
        centerTitle<span>:</span> <span>false</span><span>,</span>
        title<span>:</span> <span>Text</span><span>(</span><span>&#34;Welcome ${profile?.name}&#34;</span><span>)</span><span>,</span>
        actions<span>:</span> <span>[</span>
          <span>_avatar</span><span>(</span>profile<span>)</span><span>,</span>
        <span>]</span><span>,</span>
      <span>)</span><span>,</span>
      body<span>:</span> tabs<span>[</span>_selectedIndex<span>]</span><span>,</span>
      bottomNavigationBar<span>:</span> <span>_bottomNavigationBar</span><span>(</span>profile<span>)</span><span>,</span>
    <span>)</span><span>;</span>
  <span>}</span>

  BottomNavigationBar <span>_bottomNavigationBar</span><span>(</span>Auth0User<span>?</span> user<span>)</span> <span>{</span>
    <span>return</span> <span>BottomNavigationBar</span><span>(</span>
      backgroundColor<span>:</span> Colors<span>.</span>white<span>,</span>
      type<span>:</span> BottomNavigationBarType<span>.</span>fixed<span>,</span>
      unselectedItemColor<span>:</span> Colors<span>.</span>brown<span>.</span>shade300<span>,</span>
      items<span>:</span> <span>&lt;</span>BottomNavigationBarItem<span>&gt;</span><span>[</span>
        <span>BottomNavigationBarItem</span><span>(</span>
          icon<span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>list_alt<span>)</span><span>,</span>
          label<span>:</span> <span>&#34;Menu&#34;</span><span>,</span>
        <span>)</span><span>,</span>
        <span>BottomNavigationBarItem</span><span>(</span>
          icon<span>:</span>
              user<span>?</span><span>.</span>isCustomer <span>?</span> <span>Icon</span><span>(</span>Icons<span>.</span>support_agent<span>)</span> <span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>group<span>)</span><span>,</span>
          label<span>:</span> user<span>?</span><span>.</span>isCustomer <span>?</span> <span>&#34;Support&#34;</span> <span>:</span> <span>&#34;Community&#34;</span><span>,</span>
        <span>)</span><span>,</span>
        <span>BottomNavigationBarItem</span><span>(</span>
          icon<span>:</span> <span>Icon</span><span>(</span>Icons<span>.</span>person<span>)</span><span>,</span>
          label<span>:</span> <span>&#34;Profile&#34;</span><span>,</span>
        <span>)</span><span>,</span>
      <span>]</span><span>,</span>
      currentIndex<span>:</span> _selectedIndex<span>,</span>
      selectedItemColor<span>:</span> Colors<span>.</span>brown<span>.</span>shade800<span>,</span>
      onTap<span>:</span> _onItemTapped<span>,</span>
    <span>)</span><span>;</span>
  <span>}</span>

  Padding <span>_avatar</span><span>(</span>Auth0User<span>?</span> profile<span>)</span> <span>{</span>
    <span>return</span> <span>Padding</span><span>(</span>
      padding<span>:</span> <span>const</span> EdgeInsets<span>.</span><span>all</span><span>(</span><span>8.0</span><span>)</span><span>,</span>
      child<span>:</span> <span>FittedBox</span><span>(</span>
        fit<span>:</span> BoxFit<span>.</span>cover<span>,</span>
        child<span>:</span> <span>ClipRRect</span><span>(</span>
          clipBehavior<span>:</span> Clip<span>.</span>antiAlias<span>,</span>
          borderRadius<span>:</span> BorderRadius<span>.</span><span>all</span><span>(</span>Radius<span>.</span><span>circular</span><span>(</span><span>600</span><span>)</span><span>)</span><span>,</span>
          child<span>:</span> <span>Container</span><span>(</span>
            child<span>:</span> <span>_avatarPhoto</span><span>(</span>profile<span>)</span><span>,</span>
          <span>)</span><span>,</span>
        <span>)</span><span>,</span>
      <span>)</span><span>,</span>
    <span>)</span><span>;</span>
  <span>}</span>

  Widget <span>_avatarPhoto</span><span>(</span>Auth0User<span>?</span> profile<span>)</span> <span>{</span>
    <span>return</span> profile <span>!=</span> <span>null</span> <span>&amp;&amp;</span> profile<span>.</span>hasImage
        <span>?</span> Image<span>.</span><span>network</span><span>(</span>
            profile<span>.</span>picture<span>,</span>
            width<span>:</span> <span>20</span><span>,</span>
            height<span>:</span> <span>20</span><span>,</span>
          <span>)</span>
        <span>:</span> <span>Container</span><span>(</span>
            width<span>:</span> <span>20</span><span>,</span>
            height<span>:</span> <span>20</span><span>,</span>
            color<span>:</span> darkBrown<span>,</span>
            child<span>:</span> <span>Center</span><span>(</span>
              child<span>:</span> <span>Text</span><span>(</span><span>&#39;${profile?.name[0].toUpperCase()}&#39;</span><span>)</span><span>,</span>
            <span>)</span><span>,</span>
          <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>You can create a new user and assign it the ‚Äúemployee‚Äù role so that you can also test the Employee role screen.</p><p>Well done! Restart your app, log out, and log in again, and you‚Äôll see the appropriate screen for your role:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4viiFWih2Zdu8FzWeIQYmS/489c1e5a9dda80abbf13e97a3541b945/role_based_screens.png" alt=" role base screen flutter "/></p><p>But that&#39;s not all! You still need an employee ID to create a private channel between the currently signed-in customer and an employee.</p><p>You can define an API that can return available agents to create a channel. However, another strategy that would work for the <em>MJ Coffee</em> app is to retrieve all employees&#39; user IDs via ID tokens‚Äô custom claims and randomly pick one of them.</p><p>You can create other custom actions, similar to the previous steps for permissions and roles. I won‚Äôt walk you through all steps since you‚Äôve already done it twice.</p><p>üõ† Name this action <code>Retrieve Employees User IDs</code> and define its logic as follows:</p><pre><code><span>// Auth0 Action</span>

<span>const</span> ManagementClient <span>=</span> <span>require</span><span>(</span><span>&#39;auth0&#39;</span><span>)</span><span>.</span>ManagementClient<span>;</span>
<span>const</span> AuthenticationClient <span>=</span> <span>require</span><span>(</span><span>&#39;auth0&#39;</span><span>)</span><span>.</span>AuthenticationClient<span>;</span>
exports<span>.</span><span>onExecutePostLogin</span> <span>=</span> <span>async</span> <span>(</span><span>event<span>,</span> api</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>const</span> <span>DOMAIN</span> <span>=</span> <span>&#39;mhadaily.eu.auth0.com&#39;</span><span>;</span>
  <span>const</span> auth0 <span>=</span> <span>new</span> <span>AuthenticationClient</span><span>(</span><span>{</span>
    domain<span>:</span> <span>DOMAIN</span><span>,</span>
    clientId<span>:</span> event<span>.</span>secrets<span>.</span><span>M2M_CLIENT_ID</span><span>,</span>
    clientSecret<span>:</span> event<span>.</span>secrets<span>.</span><span>M2M_CLIENT_SECRET</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
  <span>const</span> response <span>=</span> <span>await</span> auth0<span>.</span><span>clientCredentialsGrant</span><span>(</span><span>{</span>
    audience<span>:</span> <span><span>`</span><span>https://</span><span><span>${</span><span>DOMAIN</span><span>}</span></span><span>/api/v2/</span><span>`</span></span><span>,</span>
    scope<span>:</span> <span>&#39;read:users read:roles&#39;</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
  <span>const</span> <span>API_TOKEN</span> <span>=</span> response<span>.</span>access_token<span>;</span>
  <span>const</span> management <span>=</span> <span>new</span> <span>ManagementClient</span><span>(</span><span>{</span>
    domain<span>:</span> <span>DOMAIN</span><span>,</span>
    token<span>:</span> <span>API_TOKEN</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
  <span>const</span> params <span>=</span> <span>{</span> id<span>:</span> event<span>.</span>secrets<span>.</span><span>EMPLOYEE_ROLE_ID</span><span>,</span> per_page<span>:</span> <span>10</span><span>,</span> page<span>:</span> <span>0</span> <span>}</span><span>;</span>
  <span>const</span> employees <span>=</span> <span>await</span> management<span>.</span><span>getUsersInRole</span><span>(</span>params<span>)</span><span>;</span>
  <span>const</span> employee_ids <span>=</span> employees<span>.</span><span>map</span><span>(</span><span>(</span><span>employee</span><span>)</span> <span>=&gt;</span> employee<span>.</span>user_id<span>)</span><span>;</span>
  <span>const</span> namespace <span>=</span> <span>&#39;https://employees.mjcoffee.app&#39;</span><span>;</span>
  <span>if</span> <span>(</span>event<span>.</span>authorization<span>)</span> <span>{</span>
    api<span>.</span>idToken<span>.</span><span>setCustomClaim</span><span>(</span><span><span>`</span><span><span>${</span>namespace<span>}</span></span><span>/id</span><span>`</span></span><span>,</span> employee_ids<span>)</span><span>;</span>
  <span>}</span>
<span>}</span><span>;</span></code></pre><p>Again, you will use <code>ManagementClient</code> to get the first ten users based on their role by calling <code><span>getUsersInRole</span><span>(</span><span>)</span></code> and passing the role ID that <code><span>EMPLOYEE_ROLE_ID</span></code> identifies from secrets, then define the namespace and set a custom claim on <code>idToken</code>.</p><p>üõ† Lastly, deploy this action and add it to the <strong>Login</strong> flow right after the GetStream User Token action and apply:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3T7JSFv4ogGggqg8ig34hh/d12e912be13cf17ce9f74f0ac73f9ca7/role-actions.png" alt=" role in login flow "/></p><p>Locate the <code>Auth0IdToken</code> and <code>Auth0User</code> classes in the Flutter app and add a new property, <code>availableAgents</code>, to both of them.</p><p>üõ† In <code>Auth0IdToken</code> you should have:</p><pre><code><span>// /lib/models/auth0_id_token.dart</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0IdToken</span> <span>{</span>
  <span>Auth0IdToken</span><span>(</span><span>{</span>
  
  <span>.</span><span>.</span><span>.</span>
  
    required <span>this</span><span>.</span>availableAgents<span>,</span>
    
    <span>.</span><span>.</span><span>.</span>
    
  <span>}</span><span>)</span><span>;</span>
  
<span>.</span><span>.</span><span>.</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://employees.mjcoffee.app/id&#39;</span><span>,</span> defaultValue<span>:</span> <span>[</span><span>]</span><span>)</span>
  <span>final</span> List<span>&lt;</span>String<span>&gt;</span> availableAgents<span>;</span>
  
<span>.</span><span>.</span><span>.</span>

<span>}</span></code></pre><p>üõ† ...and in <code>Auth0User</code> you can do the same:</p><pre><code><span>// /lib/models/auth0_user.dart</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0User</span> <span>{</span>
  <span>Auth0User</span><span>(</span><span>{</span>
  
  <span>.</span><span>.</span><span>.</span>
  
    required <span>this</span><span>.</span>availableAgents<span>,</span>
  
    <span>.</span><span>.</span><span>.</span>
    
  <span>}</span><span>)</span><span>;</span>
  
<span>.</span><span>.</span><span>.</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;https://employees.mjcoffee.app/id&#39;</span><span>,</span> defaultValue<span>:</span> <span>[</span><span>]</span><span>)</span>
  <span>final</span> List<span>&lt;</span>String<span>&gt;</span> availableAgents<span>;</span>

<span>.</span><span>.</span><span>.</span>

<span>}</span></code></pre><p>üõ† Don‚Äôt forget to run this:</p><pre><code>flutter pub run build_runner build --delete-conflicting-outputs</code></pre><p>üõ† It&#39;s perfectly fine if you decide to make this change only to the user class. Locate <code>createSupportChat</code> in <code>ChatService</code> class. You left the employee ID blank, so now you can refactor this to pick an employee ID randomly:</p><pre><code><span>// /lib/services/chat_service.dart</span>

 String<span>?</span> _currentEmployeeId<span>;</span>

Future<span>&lt;</span>Channel<span>&gt;</span> <span>createSupportChat</span><span>(</span>List<span>&lt;</span>String<span>&gt;</span> availableAgents<span>)</span> <span>async</span> <span>{</span>
    <span>// skip if the chat is still open with current employeeId</span>
    <span>if</span> <span>(</span>_currentEmployeeId <span>==</span> <span>null</span><span>)</span> <span>{</span>
      <span>final</span> _random <span>=</span> <span>new</span> <span>Random</span><span>(</span><span>)</span><span>;</span>
      <span>final</span> randomNumber <span>=</span> <span>0</span> <span>+</span> _random<span>.</span><span>nextInt</span><span>(</span>availableAgents<span>.</span>length <span>-</span> <span>0</span><span>)</span><span>;</span>
      <span>final</span> String employeeId <span>=</span> availableAgents<span>[</span>randomNumber<span>]</span><span>.</span><span>split</span><span>(</span><span>&#39;|&#39;</span><span>)</span><span>.</span><span>join</span><span>(</span><span>&#39;&#39;</span><span>)</span><span>;</span>
      _currentEmployeeId <span>=</span> employeeId<span>;</span>
    <span>}</span>

    <span>final</span> channel <span>=</span> client<span>.</span><span>channel</span><span>(</span>
      <span>&#39;support&#39;</span><span>,</span>
      id<span>:</span> _currentChannelId<span>,</span>
      extraData<span>:</span> <span>{</span>
        <span>&#39;name&#39;</span><span>:</span> <span>&#39;MJCoffee Support&#39;</span><span>,</span>
        <span>&#39;members&#39;</span><span>:</span> <span>[</span>
          _currentEmployeeId<span>,</span>
          client<span>.</span>state<span>.</span>user<span>!</span><span>.</span>id<span>,</span>
        <span>]</span>
      <span>}</span><span>,</span>
    <span>)</span><span>;</span>
    <span>await</span> channel<span>.</span><span>watch</span><span>(</span><span>)</span><span>;</span>
    _currentChannelId <span>=</span> channel<span>.</span>id<span>;</span>
    <span>return</span> channel<span>;</span>
  <span>}</span></code></pre><p>Let&#39;s examine this code. First, it passes a list of employee IDs to <code>createSupportChat</code>. Then, it makes sure it is storing the current employee ID that has an open support chat in order to avoid recreating a new channel.</p><p>Finally, it randomly picks an ID from the list and creates a channel with the current customer.</p><p>This solution might not be the best possible one. However, it would work for our small coffee store. Ideally, you would define an API that can return an available employee to a customer on-demand. I may write another article to show you how you can better with other solutions.</p><p>üõ† Lastly, locate the <code><span>createChannel</span><span>(</span><span>)</span></code> method in the <code>_SupportChatScreenState</code> class (it‚Äôs in the <code><span>/</span>lib<span>/</span>screens<span>/</span>support<span>.</span>dart</code> file) and refactor it to pass the <code>availableAgents</code>.</p><pre><code><span>// /lib/screens/support.dart</span>

<span>.</span><span>.</span><span>.</span>

<span>createChannel</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
    <span>if</span> <span>(</span>profile <span>!=</span> <span>null</span><span>)</span> <span>{</span>
      <span>final</span> _channel <span>=</span> <span>await</span> ChatService<span>.</span>instance<span>.</span><span>createSupportChat</span><span>(</span>
        profile<span>!</span><span>.</span>availableAgents<span>,</span>
      <span>)</span><span>;</span>
      <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
        channel <span>=</span> _channel<span>;</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
  
  <span>.</span><span>.</span><span>.</span></code></pre><blockquote><p>It&#39;s very important that you have registered all of your employees‚Äô IDs in Stream chat. Typically, users can log in as employees should log in and everything will work. However, if you still have not registered all of your employees, you might get an error with the message <code>The following users are specified <span>in</span> channel<span>.</span>members but don&#39;t exist</code>. This usually happens if you have created any users before the Login flow and Custom token generation action have been created.</p></blockquote><p>Nicely done! You can restart your app, and this time you can see the support channel screen.</p><h2 id="Permission-Based-Functionalities">Permission-Based Functionalities</h2><p>After applying roles to have specific kinds of access in the app, you can go one step deeper and use functionalities based on the user&#39;s permission inherited from the role.</p><p>You have already defined the <code>can</code> method on <code>Auth0User</code> in the previous section. The purpose of this method is to check if the user has given permission. Let&#39;s use it.</p><p>üõ† Locate <code>MessageInput</code> in the <code>support<span>.</span>dart</code> file, and you can replace it with</p><pre><code><span>// /lib/screens/support.dart</span>

<span>.</span><span>.</span><span>.</span>

<span>MessageInput</span><span>(</span>
  disableAttachments<span>:</span> <span>!</span>profile<span>!</span><span>.</span><span>can</span><span>(</span>UserPermissions<span>.</span>upload<span>)</span><span>,</span>
  sendButtonLocation<span>:</span> SendButtonLocation<span>.</span>inside<span>,</span>
  actionsLocation<span>:</span> ActionsLocation<span>.</span>leftInside<span>,</span>
  showCommandsButton<span>:</span> <span>!</span>profile<span>?</span><span>.</span>isCustomer<span>,</span>
<span>)</span><span>,</span>

<span>.</span><span>.</span><span>.</span></code></pre><p>In the implementation above, <code>disableAttachments</code> is enabled based on the user&#39;s permission, or <code>showCommandsButton</code> is active only for the Customer role.</p><p>Another approach you can take is to limit the delete message functionality and apply <code>UserPermissions<span>.</span>delete</code> to remove the applicable UI.</p><p>Moreover, you may want to apply for these permissions on your back-end or API to perform. I will leave this part as homework.</p><h2 id="Closing-a-Support-Chat-Channel">Closing a Support Chat Channel</h2><p>For the last section of this tutorial, I&#39;d like to show you how to close a support channel chat.</p><p>üõ† First, you need to create a method for the <code>ChatService</code> class to send the command to close a channel.</p><pre><code><span>// /lib/services/chat_service.dart</span>

<span>.</span><span>.</span><span>.</span>

Future<span>&lt;</span><span>void</span><span>&gt;</span> <span>archiveSupportChat</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
   <span>await</span> client<span>.</span><span>hideChannel</span><span>(</span>
      _currentChannelId<span>!</span><span>,</span>
      <span>&#39;support&#39;</span><span>,</span>
      clearHistory<span>:</span> <span>true</span><span>,</span>
    <span>)</span><span>;</span>
  client<span>.</span><span>channel</span><span>(</span><span>&#39;support&#39;</span><span>,</span> id<span>:</span> _currentChannelId<span>)</span><span>.</span><span>dispose</span><span>(</span><span>)</span><span>;</span>
  _currentChannelId <span>=</span> <span>null</span><span>;</span>
  _currentEmployeeId <span>=</span> <span>null</span><span>;</span>
<span>}</span>

<span>.</span><span>.</span><span>.</span></code></pre><p>In this implementation, you can hide a chat with an existing ID and the type <code>support</code> and finally, set both <code>_currentChannelId</code> and <code>_currentEmployeeId</code> to <code><span>null</span></code> so that next time users come to a support screen, they‚Äôll see a new channel created, and it will connect them to another employee.</p><blockquote><p>Hiding a channel makes it invisible to the query channels. It can be retrieved if the user adds a new message to it or calls the <code><span>show</span><span>(</span><span>)</span></code> method to remove the hidden status.</p></blockquote><p>However, there are other possibilities. For example, you can <code>archive</code> or <code><span>delete</span></code> a channel. At the moment, <code>archive</code> is not exposed to the Stream Dart SDK. Therefore, for now, you can hide a channel.</p><p>üõ† Next, locate <code>MessageInput</code> in the <code>support<span>.</span>dart</code> file, and add <code>actions</code>.</p><pre><code><span>// /lib/screens/support.dart</span>
<span>{</span>

<span>.</span><span>.</span><span>.</span>

<span>MessageInput</span><span>(</span>
  actions<span>:</span> <span>[</span><span>_closeChat</span><span>(</span><span>)</span><span>]</span><span>,</span>
  disableAttachments<span>:</span> <span>!</span>profile<span>!</span><span>.</span><span>can</span><span>(</span>UserPermissions<span>.</span>upload<span>)</span><span>,</span>
  sendButtonLocation<span>:</span> SendButtonLocation<span>.</span>inside<span>,</span>
  actionsLocation<span>:</span> ActionsLocation<span>.</span>leftInside<span>,</span>
  showCommandsButton<span>:</span> <span>!</span>profile<span>?</span><span>.</span>isCustomer<span>,</span>
<span>)</span><span>,</span>

<span>.</span><span>.</span><span>.</span>

  <span>/// method in the class</span>
  CommonButton <span>_closeChat</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> <span>CommonButton</span><span>(</span>
      onPressed<span>:</span> <span>(</span><span>)</span> <span>{</span>
        ChatService<span>.</span>instance<span>.</span><span>archiveSupportChat</span><span>(</span><span>)</span><span>;</span>
        CoffeeRouter<span>.</span>instance<span>.</span><span>push</span><span>(</span>MenuScreen<span>.</span><span>route</span><span>(</span><span>)</span><span>)</span><span>;</span>
      <span>}</span><span>,</span>
      child<span>:</span> <span>Icon</span><span>(</span>
        Icons<span>.</span>close<span>,</span>
        color<span>:</span> Colors<span>.</span>white<span>,</span>
      <span>)</span><span>,</span>
    <span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>The <code>actions</code> parameter adds a list of additional actions to the <code>GetStream</code> chat input UI. You can call the <code>archiveSupportChat</code> method <code><span>OnPressed</span><span>(</span><span>)</span></code> and hide the chat, and redirect the user to the menu screen to show a proper message that the discussion is closed. They can reopen by returning to the support screen.</p><h2 id="Conclusion">Conclusion</h2><p>Authentication and authorization are complex but necessary features of most applications, and they can be tricky to implement and manage. Auth0 provides a reliable service that takes on these tasks. You can this service in Flutter applications without having to set up a server or maintain infrastructure. You can also make use of serverless tools such as Auth0 Actions, which you can use to add sophistication to your authentication and authorization process.</p><p>You have seen how you can speed up your development by adding a support chat using <code>GetStreamChat</code> to a Flutter application. You‚Äôve also seen how you can limit the functionality available to users by leveraging roles and permissions received from Auth0 via tokens.</p><p>Congratulations! You‚Äôve come a long way over this tutorial‚Äôs four parts, and I hope that you have learned a lot. This is just the beginning ‚Äî you can still implement and configure a lot, using both Stream and Auth0, and take your apps to the next level.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 04 Oct 2021 17:13:00 +0000</pubDate>
    </item>
    <item>
      <title>Flutter Authentication and Authorization with Auth0, Part 4: Roles and Permissions</title>
      <link>https://auth0.com/blog/flutter-authentication-authorization-with-auth0-part-4-roles-permissions/</link>
      <description>In this tutorial, you‚Äôll learn how to enhance your Flutter apps by enabling authentication, supporting federated identity providers, adding authorization by introducing roles and permissions, all leveraging Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><ul><li><a href="https://twitter.com/auth0" target="_blank" rel="noopener noreferrer"></a></li><li><a href="https://facebook.com/getauth0" target="_blank" rel="noopener noreferrer"></a></li><li><a href="https://linkedin.com/company/auth0" target="_blank" rel="noopener noreferrer"></a></li><li><a href="https://www.instagram.com/weareauth0/" target="_blank" rel="noopener noreferrer"></a></li><li><a href="https://github.com/auth0" target="_blank" rel="noopener noreferrer"></a></li></ul><p>¬© 2013-2021 Auth0 Inc. All Rights Reserved.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 04 Oct 2021 17:13:00 +0000</pubDate>
    </item>
    <item>
      <title>Flutter Authentication and Authorization with Auth0, Part 1: Adding Authentication to an App</title>
      <link>https://auth0.com/blog/flutter-authentication-authorization-with-auth0-part-1-adding-authentication-to-an-app/</link>
      <description>In this tutorial, you‚Äôll learn how to enhance your Flutter apps by enabling authentication, supporting federated identity providers, adding authorization by introducing roles and permissions, all leveraging Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><h2 id="Welcome-">Welcome!</h2><p>In this four-part tutorial, you‚Äôll take a Flutter app and enhance it with Auth0. You‚Äôll start by adding basic username/password authentication to it, followed by social logins, and then enable real-time support chat that makes use of authorization.</p><p>By the end of this tutorial, you‚Äôll have built a fairly complex Flutter app that you can use as the basis for your own creations, and you will also have covered a lot of Auth0‚Äôs features.</p><p>Before we begin, let‚Äôs get our terminology straight...</p><p>Authentication and authorization are two key security components in applications, whether they are mobile apps, web apps, or machine-to-machine connections. Many people are confused by these terms, so here are some simple definitions:</p><ul><li><strong><em>Authentication</em></strong> deals with the question <strong>&#34;Who are you?&#34;</strong>. You‚Äôll implement it in this section with the help of an authentication protocol called <a href="https://auth0.com/docs/protocols/openid-connect-protocol" target="_blank" rel="noreferrer noopener">OpenID Connect</a>, or ‚ÄúOIDC‚Äù for short.</li><li><strong><em>Authorization</em></strong> answers the question <strong>&#34;What are you allowed to do?&#34;</strong>. You‚Äôll implement it in a later section with the help of an authorization protocol called <a href="https://auth0.com/intro-to-iam/what-is-oauth-2/" target="_blank" rel="noreferrer noopener">OAuth 2.0</a>, or ‚ÄúOAuth2‚Äù for short.</li></ul><h2 id="Adding-Authentication-to-a-Flutter-App">Adding Authentication to a Flutter App</h2><p>In this section, you‚Äôll learn how to secure a Flutter app with Auth0. You‚Äôll take a production-ready Flutter app and add a login screen and logout functionality to it, and you‚Äôll do it with only a fraction of the effort required to implement login and logout yourself!</p><p>You‚Äôll be able to follow this tutorial a little more smoothly if you know the basics of Flutter, but it&#39;s not a hard requirement. If you have experience with any modern web framework, you‚Äôll probably be able to understand the code and learn Flutter and Dart (Flutter‚Äôs programming language) as you go.</p><h3 id="What-you-ll-learn-and-build">What you‚Äôll learn and build</h3><p>While you <em>could</em> create a new Flutter project and implement everything you will learn in this tutorial, adding authentication to an existing production-ready app is pretty common. I‚Äôll provide a production-ready app, <strong><em>MJ Coffee</em></strong>, which you‚Äôll secure by adding authentication.</p><p>In later sections, you‚Äôll enable authentication through a social identity provider, such as Google or Apple. You‚Äôll then work on authorization by adding roles and permissions to limit app functionalities based on each user‚Äôs permissions and roles.</p><p>I‚Äôll explain more about what this tutorial will cover in <a href="https://img.youtube.com/vi/bHdSLwWFNJ4/0.jpg" target="_blank" rel="noreferrer noopener">this video overview.</a></p><p>I will provide the source code for both the ‚Äústarter‚Äù and ‚Äúfinal‚Äù versions of the application. I strongly recommend that you use the ‚Äústarter‚Äù version and follow the tutorial step by step in order to better understand the application and your additions to it.</p><p>Additionally, I have recorded videos that support this tutorial. You‚Äôll find them on my <a href="https://www.youtube.com/playlist?list=PLCOnzDflrUceRLfHEkl-u2ipjsre6ZwjV" target="_blank" rel="noreferrer noopener">Youtube channel
playlist</a>.</p><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong></p></blockquote><h2 id="Set-Up-the-Initial-App">Set Up the Initial App</h2><h3 id="Prerequisites">Prerequisites</h3><p>Before getting started, you need to have the following installed on your machine:</p><ul><li><strong><a href="https://flutter.dev/docs/get-started/install" target="_blank" rel="noreferrer noopener">Flutter SDK</a> version 2.0 or later.</strong> I used version <strong>2.2</strong> for building my application.</li><li>If you want to build the app for iOS, you‚Äôll need the following:
  <ul><li><strong>Xcode 11 or later.</strong></li><li><strong>Ruby 2.6.0 or later.</strong> This is required for the next iOS requirement, which is...</li><li><strong><a href="https://cocoapods.org/" target="_blank" rel="noreferrer noopener">CocoaPods</a> 1.10.0 or later.</strong></li></ul></li><li><strong>A basic understanding of <em>null safety</em>.</strong> If you‚Äôve used Kotlin‚Äôs or Swift‚Äôs optional types, you should be fine; if not, please read <a href="https://flutter.dev/docs/null-safety" target="_blank" rel="noreferrer noopener"><em>Null safety in Flutter</em></a>.</li><li><strong>The IDE or an editor of your choice.</strong> I recommend:
<ul><li>Android Studio, or</li><li>IntelliJ, or</li><li>Visual Studio Code (which I will use in this series).</li></ul></li><li><strong>Dart and Flutter plugins</strong> for your IDE.</li><li>A cup of tea or coffee.</li></ul><h3 id="Get-the-project--configure-it--and-run-it">Get the project, configure it, and run it</h3><p>üõ† <a href="https://github.com/mhadaily/serverless-authentication-authorization-flutter" target="_blank" rel="noreferrer noopener">Open the repository for the MJ Coffee app</a> and download the source from the <em>main</em> branch. This contains a fully functioning app that is ready for you to add Auth0 authentication/authorization and chat.</p><p>üõ† If you want to build the app for iOS, you‚Äôll need to specify your own development team for the build process. Open the <code><span>/</span>ios<span>/</span>Runner<span>.</span>xcworkspace<span>/</span></code> file with Xcode, select the <strong>Runner</strong> project, then the <strong>Runner</strong> target, open the <strong>Signing &amp; Capabilities</strong> tab, and select your team in the <strong>Team</strong> drop-down menu:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3URlDK6kyBY0Op3OU1GX02/1701db29ed00c3e364063984981c5efd/select_development_team.png" alt="Screenshot of Xcode. The reader is instructed to select the ‚ÄúRunner‚Äù project and then the ‚ÄúRunner‚Äù target, then select ‚ÄúSigning and Capabilities‚Äù, and finally select their development team."/></p><p>üõ† Confirm that the app works by running it. Open a command-line interface, navigate to the project‚Äôs root directory, and enter  <code>flutter run</code>. </p><p>Flutter will compile the project and run it on any mobile device connected to your computer or any mobile device emulator running on it. If it can‚Äôt find any of those, it will run a mobile device emulation in a browser window.</p><p>You will see the app‚Äôs home screen:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6kebmOTiWF0KJvdk3yRhZv/a564bccc4f49415742375a9a597db8aa/mj_coffee_screen_1.png" alt="The MJ Coffee App‚Äôs home screen"/></p><h3 id="Take-a-quick-tour-of-the-app">Take a quick tour of the app</h3><p>üõ† Tap the <strong>Login | Register</strong> button. Right now, there is no login functionality, so the app immediately takes you to the <strong>Menu</strong> screen:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/26VWlWFGMfEkt3lxzB4Vtl/d76d8e9157544008eb45706196be9e58/mj_coffee_screen_2.png" alt="The MJ Coffee App‚Äôs ‚ÄúMenu‚Äù screen"/></p><p>üõ† Tap the <strong>Support</strong> button located at the bottom center of the screen. It will take you to the screen where you‚Äôll eventually implement that support chat feature:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6kP1psYGYxUYjP2lfmGGSy/cf9f8fe20aeb4dcf6aabfc717706ec45/mj_coffee_screen_3.png" alt="The MJ Coffee App‚Äôs ‚ÄúSupport‚Äù screen, which is currently blank"/></p><p>üõ† Now tap the <strong>Profile</strong> button located at the bottom right of the screen. It will take you to the profile screen, which will eventually display some information about the logged-in user:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/66R156m2DmiVcOy3NDAUrx/768da6f50629ec4084ba0cdfd974045e/mj_coffee_screen_4.png" alt="The MJ Coffee App‚Äôs ‚ÄúProfile‚Äù screen, which currently shows a coffee illustration"/></p><p>üõ† And finally, tap the <strong>Logout</strong> button, which will bring you back to the home screen.</p><p>Now that you‚Äôve had a tour of the app, it‚Äôs time to start implementing the new features!</p><h2 id="Implement-Login">Implement Login</h2><h3 id="Install-Flutter-dependencies">Install Flutter dependencies</h3><p>The first step is to import the required libraries. You‚Äôll do that by specifying three new dependencies:</p><ul><li><a href="https://pub.dartlang.org/packages/http" target="_blank" rel="noreferrer noopener"><strong>http</strong></a>: A composable, Future-based library for making HTTP requests published by the <a href="https://dart.dev/" target="_blank" rel="noreferrer noopener">Dart team</a></li><li><a href="https://pub.dev/packages/flutter_appauth" target="_blank" rel="noreferrer noopener"><strong>flutter_appauth</strong></a> : A well-maintained wrapper package around <a href="https://appauth.io/" target="_blank" rel="noreferrer noopener">AppAuth</a> for Flutter developed by <a href="https://dexterx.dev/about/" target="_blank" rel="noreferrer noopener">Michael Bui</a>. AppAuth authenticates and authorizes users and supports the PKCE extension.</li><li><a href="https://pub.dev/packages/flutter_secure_storage" target="_blank" rel="noreferrer noopener"><strong>fluttersecurestorage</strong></a>: A library for securely persisting data locally; it was developed by <a href="https://github.com/mogol" target="_blank" rel="noreferrer noopener">German Saprykin</a>. You will need this to safely store tokens and other necessary information.</li></ul><p>You‚Äôll install them by adding entries to the project‚Äôs <code><span>/</span>pubspec<span>.</span>yaml</code> file (located in the root directory), where dependencies are specified.</p><p>üõ† Add the following lines to the <code><span>/</span>pubspec<span>.</span>yaml</code>‚Äôs <code>dependencies<span>:</span></code> section, just after the line that starts with <code>json_annotation</code>:</p><pre><code>  <span>http</span><span>:</span> ^0.13.3
  <span>flutter_appauth</span><span>:</span> ^1.1.0
  <span>flutter_secure_storage</span><span>:</span> ^4.2.0</code></pre><p>The <code>dependencies<span>:</span></code> section should end up looking like this:</p><pre><code><span>dependencies</span><span>:</span>
  <span>flutter</span><span>:</span>
    <span>sdk</span><span>:</span> flutter
  <span>font_awesome_flutter</span><span>:</span> ^9.1.0
  <span>flutter_svg</span><span>:</span> ^0.22.0
  <span>google_fonts</span><span>:</span> ^2.1.0
  <span>json_annotation</span><span>:</span> ^4.0.1
  <span>http</span><span>:</span> ^0.13.3
  <span>flutter_appauth</span><span>:</span> ^1.1.0
  <span>flutter_secure_storage</span><span>:</span> ^4.2.0</code></pre><p>üõ† Save the file and then install the dependencies by either:</p><ul><li>Running the <code>flutter pub get</code> command in the root of your project on the command line, or</li><li>Running <code>Pub get</code> in your editor or IDE.</li></ul><h3 id="Configure-the-callback-URL">Configure the callback URL</h3><p>A callback URL is a mechanism that an authorization server such as Auth0 uses to communicate back to your application. It specifies a location where the user should be returned after the user had been authenticated.</p><p>Because unauthorized parties can manipulate callback URLs, Auth0 recognizes only URLs in a list of allowed callback URLs. These are stored in the application‚Äôs Settings page in the Auth0 dashboard.</p><p>For web applications, a callback URL is a valid HTTPS URL. For native apps, your Flutter implementation, you need to create a ‚Äúpseudo-URL‚Äù based on your app‚Äôs unique name (the name is the <em>application ID</em> in Android and the <em>bundle name</em> in iOS). These are similar in format to an URL.</p><p>You will specify that this app‚Äôs name is <code>mj<span>.</span>coffee<span>.</span>app</code>, which means that the callback URL for this application will be <code>mj<span>.</span>coffee<span>.</span>app<span>:</span><span>/</span><span>/</span>login<span>-</span>callback</code>.</p><p><code>flutter_appauth</code> will register your app with an intent filter on that callback URL. If there&#39;s no match, the app will not receive the result.</p><h4 id="Configure-the-callback-URL-for-Android">Configure the callback URL for Android</h4><p>üõ† To configure the Android version of the app, open the <code><span>/</span>android<span>/</span>app<span>/</span>build<span>.</span>gradle</code> file. Update the <code>defaultConfig</code> section of the file by adding a new item: <code>manifestPlaceHolders</code> and its value, <code><span>[</span><span>&#39;appAuthRedirectScheme&#39;</span><span>:</span> <span>&#39;mj.coffee.app&#39;</span><span>]</span></code>. The value of <code>appAuthRedirectScheme</code> must be in lower case letters.</p><p>üõ† You should set the value for <code>minSdkVersion</code> to at least <code><span>18</span></code>, as it&#39;s a requirement for the <code>flutter_secure_storage</code> package. For the MJ Coffee app, I changed the <code>minSdkVersion</code> to <code><span>21</span></code>.</p><p>The result should look like this:</p><pre><code><span>// /android/app/build.gradle</span>

    defaultConfig <span>{</span>
        applicationId <span>&#34;mj.coffee.app&#34;</span>
        minSdkVersion <span>21</span>
        targetSdkVersion <span>29</span>
        versionCode flutterVersionCode<span>.</span><span>toInteger</span><span>(</span><span>)</span>
        versionName flutterVersionName
        multiDexEnabled <span>true</span>
        testInstrumentationRunner <span>&#34;androidx.test.runner.AndroidJUnitRunner&#34;</span>
        manifestPlaceholders <span>=</span> <span>[</span>
            <span>&#39;appAuthRedirectScheme&#39;</span><span>:</span> <span>&#39;mj.coffee.app&#39;</span>
        <span>]</span>
    <span>}</span></code></pre><h4 id="Configure-the-callback-URL-for-iOS">Configure the callback URL for iOS</h4><p>The only change that you need to make in order to configure the iOS version of the app is to add a callback scheme.</p><p>üõ† To do this, open the <code><span>/</span>ios<span>/</span>Runner<span>/</span>Info<span>.</span>plist</code> file. Inside the <code><span>&lt;</span>dict<span>&gt;</span></code> tag, add a new key, <code>CFBundleURLTypes</code> so that the start of the <code><span>&lt;</span>dict<span>&gt;</span></code> tag looks like this:</p><pre><code><span>&lt;!-- /ios/Runner/Info.plist --&gt;</span>

...
<span><span><span>&lt;</span>dict</span><span>&gt;</span></span>
   <span><span><span>&lt;</span>key</span><span>&gt;</span></span>CFBundleURLTypes<span><span><span>&lt;/</span>key</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>array</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>dict</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>key</span><span>&gt;</span></span>CFBundleTypeRole<span><span><span>&lt;/</span>key</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>string</span><span>&gt;</span></span>Editor<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>key</span><span>&gt;</span></span>CFBundleURLSchemes<span><span><span>&lt;/</span>key</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>array</span><span>&gt;</span></span>
                <span><span><span>&lt;</span>string</span><span>&gt;</span></span>mj.coffee.app<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
            <span><span><span>&lt;/</span>array</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>dict</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>array</span><span>&gt;</span></span>
...</code></pre><p>üõ† Run both Android and iOS versions and ensure that the app runs on all devices or emulators/simulators with no error by using the following command:</p><pre><code>flutter run -d all</code></pre><h3 id="Configure-Auth0">Configure Auth0</h3><p>The next step is to register MJ Coffee as an application in the Auth0 dashboard.</p><p><strong>You‚Äôll need an Auth0 account for this step.</strong> If you don‚Äôt already have one, <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">you can sign up for a free account</a>. The free tier is generous enough for many small applications.</p><p>üõ† Log in to into your Auth0 account and follow the steps below to register the application:</p><ul><li>üõ† Go to the <strong>Applications</strong> section of your dashboard:</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/11V2MgaHACXkpzvWYTDrGC/61f2f0b37a0a15b1bfb2dead062f02ad/click_applications.png" alt="The main page of the Auth0 dashboard. The reader is directed to click ‚ÄúApplications‚Äù."/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1mH6wEsUHtZizYdp4Jitu1/8d653eb1249f22347d2c67eb403f2c88/click_applications_2.png" alt="The main page of the Auth0 dashboard. The reader is directed to click the ‚ÄúApplications‚Äù menu item in the ‚ÄúApplications‚Äù menu."/></p><ul><li>üõ† Click the <strong>Create Application</strong> button:</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3uRVLR5qdjjvLBwvNJ4Xpk/40ff5b6358a332453e3062a830a19a37/click_create_application.png" alt="The main page of the Auth0 dashboard‚Äôs ‚ÄúApplications‚Äù page. The reader is directed to click the ‚ÄúCreate Application‚Äù button."/></p><ul><li>üõ† Enter a name for your application (e.g., &#34;MJ Coffee Flutter Application&#34;) and select the <strong>Native</strong> application type:</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3uxWZltP1uokojsifZoGky/61a5b804ecde79755448907169e63ed9/create_application_dialog.png" alt="The ‚ÄúCreate Application‚Äù dialog. The reader is directed to enter a name for the application, select the ‚ÄúNative‚Äù application type, and click the ‚ÄúCreate‚Äù button."/></p><ul><li>üõ† You‚Äôll see the <strong>Quick Start</strong> page of your newly-registered application. Go to the <strong>Connections</strong> page...</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1hGTF4bDiVDLTTtF8cNN7G/b928a2d8737efe5c61fc9629cff8503e/click_connections.png" alt="The ‚ÄúQuick Start‚Äù tab for the ‚ÄúMJ Coffee‚Äù application in the Auth0 dashboard. The user is directed to click the ‚ÄúConnections‚Äù tab."/></p><p>...and ensure that <strong>Username-Password-Authentication</strong>(in the <strong>Database</strong> section of the page) is selected. You can, and you will add a social connection later to this application too:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5MVzC4D9RA4l27SKsnFTH0/f68ea1b0c2bd7215ddb7ae504383ed20/connections_page.png" alt="The ‚ÄúConnections‚Äù tab for the ‚ÄúMJ Coffee‚Äù application in the Auth0 dashboard. The user is directed to click the ‚ÄúConnections‚Äù tab."/></p><ul><li>üõ† Then go to the <strong>Settings</strong> page. You can find all information, including client ID, client secret, domain (Tenant), etc.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1nDE9yyCNNRKhfYcAC348j/61be08ddfab99158d3dff17e3dfd6336/settings_page.png" alt="The ‚ÄúSettings‚Äù tab for the ‚ÄúMJ Coffee‚Äù application in the Auth0 dashboard. The user is directed to copy the values in the ‚ÄúDomain‚Äù and ‚ÄúClient ID‚Äù fields."/></p><ul><li>üõ† You need to add a callback URL for the app to the <strong>Allowed Callback URLs</strong> under <strong>Application URIs</strong>. Use the value <code>mj<span>.</span>coffee<span>.</span>app<span>:</span><span>/</span><span>/</span>login<span>-</span>callback</code>:</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6Fxhp8QMl1sWcijlnP3L6w/9c99382a1d2cd330ebf11b3e47f48e46/add_callback_url.png" alt="The ‚ÄúQuick Start‚Äù tab for the ‚ÄúMJ Coffee‚Äù application in the Auth0 dashboard. The user is directed to add the callback URL for the app to the ‚ÄúAllowed Callback URLs‚Äù list."/></p><ul><li>üõ† Scroll to the bottom of the page and click the <strong>Save Changes</strong> button:</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7KsLW4adJ6PNIPAI12al4g/f2c0e8abf6d7377595cfb7df11493e67/save_changes.png" alt="The ‚ÄúSave Changes‚Äù button. The user is directed to click it."/></p><h3 id="Provide-the-domain-and-client-ID-to-the-app">Provide the domain and client ID to the app</h3><p>You will need to use the domain and client ID that you copied from the <strong>Settings</strong> page in your Flutter application. You can either store these values in constant variables in the app‚Äôs code, or you can pass these values to the app by providing them as <code><span>--</span>dart<span>-</span>define</code> arguments when you run it. </p><p>Rather than store this sensitive information in your code (which is a big security risk), I suggest that you supply the app with these values as <code><span>--</span>dart<span>-</span>define</code> arguments when you run it. </p><p>üõ† To do this in Terminal or PowerShell, use this command:</p><pre><code>flutter run -d all --dart-define<span>=</span>AUTH0_DOMAIN<span>=</span><span>{</span>YOUR DOMAIN<span>}</span> --dart-define<span>=</span>AUTH0_CLIENT_ID<span>=</span><span>{</span>YOUR CLIENT ID<span>}</span></code></pre><p>You can optionally have your editor of choice provide these values. For example, you can have Visual Studio Code pass these additional <code><span>--</span>dart<span>-</span>define</code> values by adding them to the <code>args</code> field of your launch configuration file (<code><span>/</span><span>.</span>vscode<span>/</span>launch<span>.</span>json</code>):</p><pre><code><span>&#34;configurations&#34;</span><span>:</span> <span>[</span>
  <span>{</span>
    <span>&#34;name&#34;</span><span>:</span> <span>&#34;Flutter&#34;</span><span>,</span>
    <span>&#34;request&#34;</span><span>:</span> <span>&#34;launch&#34;</span><span>,</span>
    <span>&#34;flutterMode&#34;</span><span>:</span> <span>&#34;debug&#34;</span><span>,</span>
    <span>&#34;type&#34;</span><span>:</span> <span>&#34;dart&#34;</span><span>,</span>
    <span>&#34;args&#34;</span><span>:</span> <span>[</span>
      <span>&#34;--dart-define&#34;</span><span>,</span>
      <span>&#34;AUTH0_DOMAIN={YOUR DOMAIN}&#34;</span><span>,</span>
      <span>&#34;--dart-define&#34;</span><span>,</span>
      <span>&#34;AUTH0_CLIENT_ID={YOUR CLIENT ID}&#34;</span>
    <span>]</span>
  <span>}</span>
<span>]</span></code></pre><p>üõ† The app should capture the values you pass to it. Do this by defining these constants in the <code>constants<span>.</span>dart</code> file in the <code><span>/</span>lib<span>/</span>helpers<span>/</span></code> directory -- add these just after the <code><span>import</span></code> statements:</p><pre><code><span>// /lib/helpers/constants.dart</span>

<span>const</span> AUTH0_DOMAIN <span>=</span> String<span>.</span><span>fromEnvironment</span><span>(</span><span>&#39;AUTH0_DOMAIN&#39;</span><span>)</span><span>;</span>
<span>const</span> AUTH0_CLIENT_ID <span>=</span> String<span>.</span><span>fromEnvironment</span><span>(</span><span>&#39;AUTH0_CLIENT_ID&#39;</span><span>)</span><span>;</span>
<span>const</span> AUTH0_ISSUER <span>=</span> <span>&#39;https://$AUTH0_DOMAIN&#39;</span><span>;</span>
<span>const</span> BUNDLE_IDENTIFIER <span>=</span> <span>&#39;mj.coffee.app&#39;</span><span>;</span>
<span>const</span> AUTH0_REDIRECT_URI <span>=</span> <span>&#39;$BUNDLE_IDENTIFIER://login-callback&#39;</span><span>;</span></code></pre><p>Notice that you only need the domain and client ID because the Authorization Code Flow with PKCE does not require a client secret. </p><p>The code also defines a top-level domain for your tenant, which is called the issuer.</p><p>As mentioned earlier, you need to create your redirect URI based on your bundle identifier, which you added to the &#34;Allowed Callback URLs&#34; list earlier. However, it would be best to keep in mind that:</p><ul><li>The bundle identifier must match <code>appAuthRedirectScheme</code> on Android, and</li><li>The scheme part of the redirect URL must match and <code>CFBundleURLSchemes</code> on iOS...</li></ul><p>...and that both values must be in all lowercase.</p><h3 id="Integrating-Auth0-with-Flutter">Integrating Auth0 with Flutter</h3><p>Since Auth0 is a standard OAuth 2.0 authorization server, you can utilize any standard OpenID Connect SDK to authenticate against Auth0. One of them is <code>flutter_appauth</code>, a wrapper around the <code>AppAuth</code> SDK for native applications. You will need to integrate it into your application.</p><p>üõ† Open the <code><span>/</span>lib<span>/</span>services<span>/</span>auth_service<span>.</span>dart</code> file and update it to import the necessary libraries as well as instantiate <code>FlutterAppAuth</code> and <code>FlutterSecureStorage</code>:</p><pre><code><span>// /lib/services/auth_service.dart</span>

<span>import</span> <span>&#39;dart:convert&#39;</span><span>;</span>
<span>import</span> <span>&#39;package:http/http.dart&#39;</span> <span>as</span> http<span>;</span>
<span>import</span> <span>&#39;package:flutter/services.dart&#39;</span><span>;</span>
<span>import</span> <span>&#39;package:flutter_appauth/flutter_appauth.dart&#39;</span><span>;</span>
<span>import</span> <span>&#39;package:flutter_secure_storage/flutter_secure_storage.dart&#39;</span><span>;</span>
<span>import</span> <span>&#39;package:mjcoffee/helpers/constants.dart&#39;</span><span>;</span>
<span>import</span> <span>&#39;package:mjcoffee/models/auth0_id_token.dart&#39;</span><span>;</span>
<span>import</span> <span>&#39;package:mjcoffee/models/auth0_user.dart&#39;</span><span>;</span>

<span>class</span> <span>AuthService</span> <span>{</span>

  <span>static</span> <span>final</span> AuthService instance <span>=</span> AuthService<span>.</span><span>_internal</span><span>(</span><span>)</span><span>;</span>
  <span>factory</span> <span>AuthService</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> instance<span>;</span>
  AuthService<span>.</span><span>_internal</span><span>(</span><span>)</span><span>;</span>

  <span>final</span> FlutterAppAuth appAuth <span>=</span> <span>FlutterAppAuth</span><span>(</span><span>)</span><span>;</span>
  <span>final</span> FlutterSecureStorage secureStorage <span>=</span> <span>const</span> <span>FlutterSecureStorage</span><span>(</span><span>)</span><span>;</span>

<span>}</span></code></pre><p>OpenID Connect has a protocol, <a href="https://auth0.com/docs/protocols/oidc/openid-connect-discovery" target="_blank" rel="noreferrer noopener">OpenID Connect Discovery</a>, that provides a standard way to discover authorization server endpoints in JSON documents. </p><p>In Auth0, you can find the discovery document at the <code><span>/</span><span>.</span>well<span>-</span>known<span>/</span>openid<span>-</span>configuration</code> endpoint of your tenant address. For MJ Coffee, this endpoint is <code>https<span>:</span><span>/</span><span><span>/</span><span>YOUR-AUTH0-TENANT-NAME.auth0.com</span><span>/</span></span><span>.</span>well<span>-</span>known<span>/</span>openid<span>-</span>configuration</code>.</p><p>If you watch <a href="https://www.youtube.com/playlist?list=PLCOnzDflrUceRLfHEkl-u2ipjsre6ZwjV" target="_blank" rel="noreferrer noopener">my videos</a>, you will see an example of a discovery URL.</p><p>AppAuth supports <a href="https://pub.dev/packages/flutter_appauth#getting-started" target="_blank" rel="noreferrer noopener">three methods to configure endpoints</a>. Conveniently, you just pass the top-level domain name (i.e., issuer) as a parameter to AppAuth methods. AppAuth then internally fetches the discovery documents from the <code>openid<span>-</span>configuration</code> endpoint and figures out where to send subsequent requests.</p><p>üõ† Let&#39;s create a login method in our <code>AuthService</code> to construct the <code>AuthorizationTokenRequest</code>. Add the following to <code><span>/</span>lib<span>/</span>services<span>/</span>auth_service<span>.</span>dart</code>:</p><pre><code><span>// /lib/services/auth_service.dart</span>

  <span>login</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
      <span>final</span> authorizationTokenRequest <span>=</span> <span>AuthorizationTokenRequest</span><span>(</span>
        AUTH0_CLIENT_ID<span>,</span> AUTH0_REDIRECT_URI<span>,</span>
        issuer<span>:</span> AUTH0_ISSUER<span>,</span>
        scopes<span>:</span> <span>[</span><span>&#39;openid&#39;</span><span>,</span> <span>&#39;profile&#39;</span><span>,</span> <span>&#39;offline_access&#39;</span><span>,</span> <span>&#39;email&#39;</span><span>]</span><span>,</span>
      <span>)</span><span>;</span>
      <span>final</span> AuthorizationTokenResponse<span>?</span> result <span>=</span>
          <span>await</span> appAuth<span>.</span><span>authorizeAndExchangeCode</span><span>(</span>
        authorizationTokenRequest<span>,</span>
      <span>)</span><span>;</span>
      <span>print</span><span>(</span>result<span>)</span><span>;</span>
  <span>}</span></code></pre><p>To construct the request, you can create <code>AuthorizationTokenRequest</code> object bypassing the mandatory <code>clientID</code> and <code>redirectUrl</code> parameters using the values of <code><span>AUTH0_CLIENT_ID</span></code> and <code><span>AUTH0_REDIRECT_URI</span></code> respectively, and the value of <code><span>AUTH0_ISSUER</span></code> as the value for <code>issuer</code> to enable discovery.</p><p>It would be best if you defined <code>scopes</code> so that when the user allows them, you can perform actions on their behalf. Here are the scopes that we have requested in the code above:</p><ul><li><code>openid</code>: Perform an OpenID connect sign-in.</li><li><code>profile</code>: Retrieve the user‚Äôs profile.</li><li><code>offline_access</code>: Retrieve a Refresh Token for <code>offline_access</code> from the application.</li><li><code>email</code>: Retrieve the user‚Äôs email.</li></ul><p>You will add more scopes later in this tutorial.</p><p>Once the request is constructed, calling <code>appAuth<span>.</span><span>authorizeAndExchangeCode</span><span>(</span><span>)</span></code> starts a sign-in transaction. The authentication process will start, and upon completion, the user will return to the application with the <code>AuthorizationTokenResponse</code>, which is shown below and contains an Access Token, ID Token, and Refresh Token:</p><pre><code><span>AuthorizationTokenResponse</span><span>(</span>
    String<span>?</span> accessToken<span>,</span>
    String<span>?</span> refreshToken<span>,</span>
    DateTime<span>?</span> accessTokenExpirationDateTime<span>,</span>
    String<span>?</span> idToken<span>,</span>
    String<span>?</span> tokenType<span>,</span>
    <span>this</span><span>.</span>authorizationAdditionalParameters<span>,</span>
    Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span><span>?</span> tokenAdditionalParameters<span>,</span>
  <span>)</span></code></pre><h3 id="The-Access-Token--Refresh-Token--and-ID-Token">The Access Token, Refresh Token, and ID Token</h3><p>You can use the Access Token to access APIs. Clients can‚Äôt decode this token, which is all right since it only means something to the API‚Äôs authorization server.</p><p>As a security measure, the Access Token usually has a short time to live. There are different methods to keep it alive for a longer period. One way is to use Refresh Tokens, which re-authorize your users. If a Refresh Token is available, the app can use it to silently get a new Access Token. For this reason, the app will store Refresh Tokens, and for security reasons, it will securely store them.</p><p>üõ† I recommend defining a constant key for your Refresh Token. Add this to your <code>constants<span>.</span>dart</code> file:</p><pre><code><span>// /lib/helpers/constants.dart</span>

<span>const</span> REFRESH_TOKEN_KEY <span>=</span> <span>&#39;refresh_token&#39;</span><span>;</span></code></pre><p>While the contents of the Access Token are opaque to the client, the<code>AppAuth</code> SDK validates the ID Token since it‚Äôs part of an OpenID Connect client‚Äôs responsibility. The app should decode the ID Token‚Äôs body to receive its JSON payload.</p><p>üõ† To get the ID Token‚Äôs payload, we‚Äôll need to create a model. We‚Äôll call it <code>Auth0IdToken</code>. Create a new file named <code>auth0_id_token<span>.</span>dart</code> in the <code><span>/</span>lib<span>/</span>models</code> directory, where models go:</p><pre><code><span>// /lib/models/auth0_id_token.dart</span>

<span>import</span> <span>&#39;package:json_annotation/json_annotation.dart&#39;</span><span>;</span>
<span>part</span> <span>&#39;auth0_id_token.g.dart&#39;</span><span>;</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0IdToken</span> <span>{</span>
  <span>Auth0IdToken</span><span>(</span><span>{</span>
    required <span>this</span><span>.</span>nickname<span>,</span>
    required <span>this</span><span>.</span>name<span>,</span>
    required <span>this</span><span>.</span>email<span>,</span>
    required <span>this</span><span>.</span>picture<span>,</span>
    required <span>this</span><span>.</span>updatedAt<span>,</span>
    required <span>this</span><span>.</span>iss<span>,</span>
    required <span>this</span><span>.</span>sub<span>,</span>
    required <span>this</span><span>.</span>aud<span>,</span>
    required <span>this</span><span>.</span>iat<span>,</span>
    required <span>this</span><span>.</span>exp<span>,</span>
    <span>this</span><span>.</span>authTime<span>,</span>
  <span>}</span><span>)</span><span>;</span>

  <span>final</span> String nickname<span>;</span>
  <span>final</span> String name<span>;</span>
  <span>final</span> String picture<span>;</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;updated_at&#39;</span><span>)</span>
  <span>final</span> String updatedAt<span>;</span>

  <span>final</span> String iss<span>;</span>

  <span>// In OIDC, &#34;sub&#34; means &#34;subject identifier&#34;,</span>
  <span>// which for our purposes is the user ID.</span>
  <span>// This getter makes it easier to understand.</span>
  String <span>get</span> userId <span>=</span><span>&gt;</span> sub<span>;</span>
  <span>final</span> String sub<span>;</span>

  <span>final</span> String aud<span>;</span>
  <span>final</span> String email<span>;</span>
  <span>final</span> int iat<span>;</span>
  <span>final</span> int exp<span>;</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;auth_time&#39;</span><span>)</span>
  <span>final</span> int<span>?</span> authTime<span>;</span> <span>// this might be null for the first time login</span>

  <span>factory</span> Auth0IdToken<span>.</span><span>fromJson</span><span>(</span>Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> json<span>)</span> <span>=</span><span>&gt;</span>
      _$<span>Auth0IdTokenFromJson</span><span>(</span>json<span>)</span><span>;</span>

  Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> <span>toJson</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> _$<span>Auth0IdTokenToJson</span><span>(</span><span>this</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>The ID Token is made up of <em>claims</em>, which are name/value pairs that contain either information about the user or meta-information about the Open ID Connect service. The <code>Auth0IdToken</code> model contains fields to contain the token‚Äôs claims, which are:</p><ul><li><code>iss</code>: An identifier for the <strong>iss</strong>uer of the response. Its value is an URL.</li><li><code>sub</code>: An identifier for the <strong>sub</strong>ject. In the case of our app, it‚Äôs the user‚Äôs ID. Since <code>sub</code> is not an often-used term outside of Open ID Connect, we created a getter named <code>userId</code> that simply returns <code>sub</code>‚Äôs value.</li><li><code>aud</code>: An identifier for the <strong>aud</strong>ience ‚Äî that is, whom the ID Token is intended for.</li><li><code>iat</code>: The time when JWT that makes up the token was issued (<code>iat</code> is short for ‚Äú<strong>i</strong>ssued <strong>at</strong>).</li><li><code>exp</code>: The <strong>exp</strong>iration time for the token. After this time, the token cannot be used.</li></ul><p>The other fields ‚Äî¬†<code>nickname</code>, <code>name</code>, <code>email</code>, <code>picture</code>, and <code>updatedAt</code> are for claims that contain specific information about the user.</p><p>The <code>Auth0IdToken</code> class needs methods to convert data from the authentication server into an <code>Auth0IdToken</code> object and an <code>Auth0IdToken</code> object to JSON. You could write them manually, but it‚Äôs easier and less error-prone to generate them instead.</p><p>You may have noticed these two lines at the start of the file:</p><pre><code><span>import</span> <span>&#39;package:json_annotation/json_annotation.dart&#39;</span><span>;</span>
<span>part</span> <span>&#39;auth0_id_token.g.dart&#39;</span><span>;</span></code></pre><ul><li>The <code><span>import</span></code> line brings in the <code>json_annotation</code> library, which you‚Äôll use to generate code to serialize and deserialize an object. The <code>@<span>JsonSerializable</span><span>(</span><span>)</span></code> annotation in the code specifies these are <code>Auth0IdToken</code> objects that are to be serialized and deserialized.</li><li>The <code>part</code> line specifies that the contents of the file <code>auth0_id_token<span>.</span>g<span>.</span>dart</code> belong to this file. The <code>g<span>.</span>dart</code> filename extension indicates that it‚Äôs a generated dart file.</li></ul><p>üõ† Run the following command to generate the JSON conversion methods for <code>Auth0IdToken</code>:</p><pre><code>flutter pub run build_runner build --delete-conflicting-outputs</code></pre><p>üõ† Once you have generated the JSON conversion methods, you can implement the <code><span>parseIdToken</span><span>(</span><span>)</span></code> method in the <code>AuthService</code> class by adding the following:</p><pre><code><span>// /lib/services/auth_service.dart</span>

  Auth0IdToken <span>parseIdToken</span><span>(</span>String idToken<span>)</span> <span>{</span>
    <span>final</span> parts <span>=</span> idToken<span>.</span><span>split</span><span>(</span><span>r&#39;.&#39;</span><span>)</span><span>;</span>
    <span>assert</span><span>(</span>parts<span>.</span>length <span>==</span> <span>3</span><span>)</span><span>;</span>

    <span>final</span> Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> json <span>=</span> <span>jsonDecode</span><span>(</span>
      utf8<span>.</span><span>decode</span><span>(</span>
        base64Url<span>.</span><span>decode</span><span>(</span>
          base64Url<span>.</span><span>normalize</span><span>(</span>parts<span>[</span><span>1</span><span>]</span><span>)</span><span>,</span>
        <span>)</span><span>,</span>
      <span>)</span><span>,</span>
    <span>)</span><span>;</span>

    <span>return</span> Auth0IdToken<span>.</span><span>fromJson</span><span>(</span>json<span>)</span><span>;</span>
  <span>}</span></code></pre><p>Now that you have the ID Token, you can get information about the user from the OpenID Connect endpoint for user details, which is <code>https<span>:</span><span>/</span><span>/</span><span>[</span><span>AUTH0_DOMAIN</span><span>]</span><span>/</span>userinfo</code>. </p><p>Let&#39;s create another model, <code>Auth0User</code>, so that we can deserialize and serialize the data from the <code>userinfo</code> endpoint. </p><p>üõ† Create a file <code>auth0_user<span>.</span>dart</code> in the <code><span>/</span>lib<span>/</span>models<span>/</span></code> directory with the following:</p><pre><code><span>// /lib/models/auth0_user.dart</span>

<span>import</span> <span>&#39;package:json_annotation/json_annotation.dart&#39;</span><span>;</span>
<span>part</span> <span>&#39;auth0_user.g.dart&#39;</span><span>;</span>

<span>@JsonSerializable</span><span>(</span><span>)</span>
<span>class</span> <span>Auth0User</span> <span>{</span>
  <span>Auth0User</span><span>(</span><span>{</span>
    required <span>this</span><span>.</span>nickname<span>,</span>
    required <span>this</span><span>.</span>name<span>,</span>
    required <span>this</span><span>.</span>email<span>,</span>
    required <span>this</span><span>.</span>picture<span>,</span>
    required <span>this</span><span>.</span>updatedAt<span>,</span>
    required <span>this</span><span>.</span>sub<span>,</span>
  <span>}</span><span>)</span><span>;</span>
  <span>final</span> String nickname<span>;</span>
  <span>final</span> String name<span>;</span>
  <span>final</span> String picture<span>;</span>

  <span>@JsonKey</span><span>(</span>name<span>:</span> <span>&#39;updated_at&#39;</span><span>)</span>
  <span>final</span> String updatedAt<span>;</span>

 <span>// userID getter to understand it easier</span>
  String <span>get</span> id <span>=</span><span>&gt;</span> sub<span>;</span>
  <span>final</span> String sub<span>;</span>

  <span>final</span> String email<span>;</span>

  <span>factory</span> Auth0User<span>.</span><span>fromJson</span><span>(</span>Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> json<span>)</span> <span>=</span><span>&gt;</span>
      _$<span>Auth0UserFromJson</span><span>(</span>json<span>)</span><span>;</span>

  Map<span>&lt;</span>String<span>,</span> <span>dynamic</span><span>&gt;</span> <span>toJson</span><span>(</span><span>)</span> <span>=</span><span>&gt;</span> _$<span>Auth0UserToJson</span><span>(</span><span>this</span><span>)</span><span>;</span>
<span>}</span></code></pre><p>üõ† Like <code>Auth0IdToken</code>, <code>Auth0User</code> uses the <code>json_annotation</code> library to generate code to serialize and deserialize its instances. Run the following command to generate that code:</p><pre><code>flutter pub run build_runner build --delete-conflicting-outputs</code></pre><p>üõ† This completes the model for Auth0 users, so let‚Äôs create a <code><span>getUserDetails</span><span>(</span><span>)</span></code> method for the <code>AuthService</code> class as follows:</p><pre><code><span>// /lib/services/auth_service.dart</span>

 Future<span>&lt;</span>Auth0User<span>&gt;</span> <span>getUserDetails</span><span>(</span>String accessToken<span>)</span> <span>async</span> <span>{</span>
    <span>final</span> url <span>=</span> Uri<span>.</span><span>https</span><span>(</span>
      AUTH0_DOMAIN<span>,</span>
      <span>&#39;/userinfo&#39;</span><span>,</span>
    <span>)</span><span>;</span>

    <span>final</span> response <span>=</span> <span>await</span> http<span>.</span><span>get</span><span>(</span>
      url<span>,</span>
      headers<span>:</span> <span>{</span><span>&#39;Authorization&#39;</span><span>:</span> <span>&#39;Bearer $accessToken&#39;</span><span>}</span><span>,</span>
    <span>)</span><span>;</span>

    <span>print</span><span>(</span><span>&#39;getUserDetails ${response.body}&#39;</span><span>)</span><span>;</span>

    <span>if</span> <span>(</span>response<span>.</span>statusCode <span>==</span> <span>200</span><span>)</span> <span>{</span>
      <span>return</span> Auth0User<span>.</span><span>fromJson</span><span>(</span><span>jsonDecode</span><span>(</span>response<span>.</span>body<span>)</span><span>)</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>throw</span> <span>Exception</span><span>(</span><span>&#39;Failed to get user details&#39;</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span></code></pre><p>üõ† <code><span>getUserDetails</span><span>(</span><span>)</span></code> uses Dart‚Äôs <a href="https://pub.dev/packages/http" target="_blank" rel="noreferrer noopener"><code>http</code></a> library, so add this <code><span>import</span></code> statement at the top of the file:</p><pre><code><span>// /lib/services/auth_service.dart</span>

<span>import</span> <span>&#39;package:http/http.dart&#39;</span> <span>as</span> http<span>;</span></code></pre><p>üõ† Since you will need to reuse <code>idToken</code>, <code>profile</code>, and <code>accessToken</code> throughout the application, it would be nice to store their values as members of <code>AuthService</code> to access them easily. Add these instance variables to <code>AuthService</code>:</p><pre><code><span>// /lib/services/auth_service.dart</span>

  Auth0User<span>?</span> profile<span>;</span>
  Auth0IdToken<span>?</span> idToken<span>;</span>
  String<span>?</span> auth0AccessToken<span>;</span></code></pre><p>üõ† You can create a simple method, <code><span>_setLocalVariables</span><span>(</span><span>)</span></code>, to store these local values. Add the following to <code>AuthService</code>:</p><pre><code><span>// /lib/services/auth_service.dart</span>

  Future<span>&lt;</span>String<span>&gt;</span> <span>_setLocalVariables</span><span>(</span>result<span>)</span> <span>async</span> <span>{</span>
    <span>final</span> bool isValidResult <span>=</span>
        result <span>!=</span> <span>null</span> <span>&amp;&amp;</span> result<span>.</span>accessToken <span>!=</span> <span>null</span> <span>&amp;&amp;</span> result<span>.</span>idToken <span>!=</span> <span>null</span><span>;</span>

    <span>if</span> <span>(</span>isValidResult<span>)</span> <span>{</span>
      auth0AccessToken <span>=</span> result<span>.</span>accessToken<span>;</span>
      idToken <span>=</span> <span>parseIdToken</span><span>(</span>result<span>.</span>idToken<span>!</span><span>)</span><span>;</span>
      profile <span>=</span> <span>await</span> <span>getUserDetails</span><span>(</span>result<span>.</span>accessToken<span>!</span><span>)</span><span>;</span>

      <span>if</span> <span>(</span>result<span>.</span>refreshToken <span>!=</span> <span>null</span><span>)</span> <span>{</span>
        <span>await</span> secureStorage<span>.</span><span>write</span><span>(</span>
          key<span>:</span> REFRESH_TOKEN_KEY<span>,</span>
          value<span>:</span> result<span>.</span>refreshToken<span>,</span>
        <span>)</span><span>;</span>
      <span>}</span>

      <span>return</span> <span>&#39;Success&#39;</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>return</span> <span>&#39;Something is Wrong!&#39;</span><span>;</span>
    <span>}</span>
  <span>}</span></code></pre><p>If the Access Token and ID Token are available, it stores their values. If the Refresh Token is also available, it writes its value to secure storage, and that value is retrievable only with the Refresh Token key.</p><p>üõ† With the changes you have made, you can now update <code>AuthService</code>‚Äôs <code><span>login</span><span>(</span><span>)</span></code> method to return the response for a successful login. Update the method so that it looks like this:</p><pre><code><span>// /lib/services/auth_service.dart</span>

Future<span>&lt;</span>String<span>&gt;</span> <span>login</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
    <span>try</span> <span>{</span>
      <span>final</span> authorizationTokenRequest <span>=</span> <span>AuthorizationTokenRequest</span><span>(</span>
        AUTH0_CLIENT_ID<span>,</span>
        AUTH0_REDIRECT_URI<span>,</span>
        issuer<span>:</span> AUTH0_ISSUER<span>,</span>
        scopes<span>:</span> <span>[</span><span>&#39;openid&#39;</span><span>,</span> <span>&#39;profile&#39;</span><span>,</span> <span>&#39;offline_access&#39;</span><span>,</span> <span>&#39;email&#39;</span><span>]</span><span>,</span>
      <span>)</span><span>;</span>

      <span>final</span> AuthorizationTokenResponse<span>?</span> result <span>=</span>
          <span>await</span> appAuth<span>.</span><span>authorizeAndExchangeCode</span><span>(</span>
        authorizationTokenRequest<span>,</span>
      <span>)</span><span>;</span>

      <span>return</span> <span>await</span> <span>_setLocalVariables</span><span>(</span>result<span>)</span><span>;</span>
    <span>}</span> <span>on</span> PlatformException <span>{</span>
      <span>return</span> <span>&#39;User has cancelled or no internet!&#39;</span><span>;</span>
    <span>}</span> <span>catch</span> <span>(</span>e<span>)</span> <span>{</span>
      <span>return</span> <span>&#39;Unkown Error!&#39;</span><span>;</span>
    <span>}</span>
  <span>}</span></code></pre><p>You can catch any exceptions and return a specific response based on their type to handle errors better.</p><h3 id="Handling-the-app-s-initial-state">Handling the app‚Äôs initial state</h3><p>The only thing missing is handling the authentication state when the app is launched. You might want to be able to silently login and retrieve a new Access Token if a Refresh Token is available.</p><p>üõ† Let‚Äôs add a new method, <code><span>init</span><span>(</span><span>)</span></code>, to deal with the app‚Äôs initial state. Implement this method by adding the following to <code>AuthService</code>:</p><pre><code><span>// /lib/services/auth_service.dart</span>

  Future<span>&lt;</span>bool<span>&gt;</span> <span>init</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
    <span>final</span> storedRefreshToken <span>=</span> <span>await</span> secureStorage<span>.</span><span>read</span><span>(</span>key<span>:</span> REFRESH_TOKEN_KEY<span>)</span><span>;</span>

    <span>if</span> <span>(</span>storedRefreshToken <span>==</span> <span>null</span><span>)</span> <span>{</span>
      <span>return</span> <span>false</span><span>;</span>
    <span>}</span>

    <span>try</span> <span>{</span>
      <span>final</span> TokenResponse<span>?</span> result <span>=</span> <span>await</span> appAuth<span>.</span><span>token</span><span>(</span>
        <span>TokenRequest</span><span>(</span>
          AUTH0_CLIENT_ID<span>,</span>
          AUTH0_REDIRECT_URI<span>,</span>
          issuer<span>:</span> AUTH0_ISSUER<span>,</span>
          refreshToken<span>:</span> storedRefreshToken<span>,</span>
        <span>)</span><span>,</span>
      <span>)</span><span>;</span>
      <span>final</span> String setResult <span>=</span> <span>await</span> <span>_setLocalVariables</span><span>(</span>result<span>)</span><span>;</span>
      <span>return</span> setResult <span>==</span> <span>&#39;Success&#39;</span><span>;</span>
    <span>}</span> <span>catch</span> <span>(</span>e<span>,</span> s<span>)</span> <span>{</span>
      <span>print</span><span>(</span><span>&#39;error on Refresh Token: $e - stack: $s&#39;</span><span>)</span><span>;</span>
      <span>// logOut() possibly</span>
      <span>return</span> <span>false</span><span>;</span>
    <span>}</span>
  <span>}</span></code></pre><p><code><span>init</span><span>(</span><span>)</span></code> checks for a Refresh Token in secure storage and immediately returns <code><span>false</span></code> if there isn‚Äôt one. However, if it finds a Refresh Token, <code><span>init</span><span>(</span><span>)</span></code> passes the retrieved request token via a <code>TokenRequest</code> object to <code>appAuth<span>.</span><span>token</span><span>(</span><span>)</span></code> in order to automatically get new access, ID, and Refresh Tokens without requiring the user to log in manually.</p><h3 id="Enabling-login-on-the-home-screen">Enabling login on the home screen</h3><p>Now that you have the underlying methods for login and initial setup, it‚Äôs time to implement similar methods for the app‚Äôs screens, whose code is in the <code><span>/</span>lib<span>/</span>screens<span>/</span></code> directory. </p><p>üõ† The app‚Äôs home screen is implemented in the <code>HomeScreen</code> class, located in <code><span>/</span>lib<span>/</span>screens<span>/</span>home<span>.</span>dart</code>. Open that file and add this line to the other <code><span>import</span></code> statements:</p><pre><code><span>// /lib/screens/home.dart</span>

<span>import</span> <span>&#39;package:mjcoffee/services/auth_service.dart&#39;</span><span>;</span></code></pre><p>Now scroll past the <code>HomeScreen</code> class to the <code>_HomeScreenState</code> class. You‚Äôll need to make some changes to this class.</p><p>üõ† The first set of changes is to the instance variables at the start of <code>_HomeScreenState</code>. Change them to the following:</p><pre><code><span>// /lib/screens/home.dart</span>

    bool isProgressing <span>=</span> <span>false</span><span>;</span>
    bool isLoggedIn <span>=</span> <span>false</span><span>;</span>
    String errorMessage <span>=</span> <span>&#39;&#39;</span><span>;</span>
    String<span>?</span> name<span>;</span></code></pre><p>üõ† The <code><span>initState</span><span>(</span><span>)</span></code> method is just below those variables. Right now, the only thing it does is call its counterpart in the superclass. Replace the <code>implement init action</code> comments with a call to <code><span>initAction</span><span>(</span><span>)</span></code>. The method should look like this:</p><pre><code><span>// /lib/screens/home.dart</span>

  <span>@override</span>
  <span>void</span> <span>initState</span><span>(</span><span>)</span> <span>{</span>
    <span>initAction</span><span>(</span><span>)</span><span>;</span>
    <span>super</span><span>.</span><span>initState</span><span>(</span><span>)</span><span>;</span>
  <span>}</span></code></pre><p>You‚Äôll implement <code><span>initAction</span><span>(</span><span>)</span></code> shortly.</p><p>Finally, look at the <code><span>build</span><span>(</span><span>)</span></code> method, which defines the home screen‚Äôs user interface. Scroll through this method until you find this <code><span>Row</span><span>(</span><span>)</span></code> function call:</p><pre><code><span>Row</span><span>(</span>
  mainAxisAlignment<span>:</span> MainAxisAlignment<span>.</span>center<span>,</span>
  children<span>:</span> <span>&lt;</span>Widget<span>&gt;</span><span>[</span>
    <span>if</span> <span>(</span>isProgressing<span>)</span>
      <span>CircularProgressIndicator</span><span>(</span><span>)</span>
    <span>else</span> <span>if</span> <span>(</span><span>!</span>isLoggedIn<span>)</span>
      <span>CommonButton</span><span>(</span>
        onPressed<span>:</span> <span>(</span><span>)</span> <span>{</span>
            CoffeeRouter<span>.</span>instance<span>.</span><span>pushReplacement</span><span>(</span>MenuScreen<span>.</span><span>route</span><span>(</span><span>)</span><span>)</span><span>;</span>
            <span>/// ----------------------</span>
            <span>/// Implement login action</span>
            <span>/// ----------------------</span>
        <span>}</span><span>,</span>
        text<span>:</span> <span>&#39;Login | Register&#39;</span><span>,</span>
      <span>)</span>
    <span>else</span>
      <span>Text</span><span>(</span><span>&#39;Welcome $name&#39;</span><span>)</span><span>,</span>
  <span>]</span><span>,</span> <span>// &lt;Widget&gt;[]</span>
<span>)</span><span>,</span></code></pre><p>üõ† Replace the <code>Implement login section</code> comments so that the <code><span>Row</span><span>(</span><span>)</span></code> function call in the <code>build</code> looks like this:</p><pre><code><span>Row</span><span>(</span>
  mainAxisAlignment<span>:</span> MainAxisAlignment<span>.</span>center<span>,</span>
  children<span>:</span> <span>&lt;</span>Widget<span>&gt;</span><span>[</span>
    <span>if</span> <span>(</span>isProgressing<span>)</span>
      <span>CircularProgressIndicator</span><span>(</span><span>)</span>
    <span>else</span> <span>if</span> <span>(</span><span>!</span>isLoggedIn<span>)</span>
      <span>CommonButton</span><span>(</span>
        onPressed<span>:</span> loginAction<span>,</span>
        text<span>:</span> <span>&#39;Login | Register&#39;</span><span>,</span>
      <span>)</span>
    <span>else</span>
      <span>Text</span><span>(</span><span>&#39;Welcome $name&#39;</span><span>)</span><span>,</span>
  <span>]</span><span>,</span> <span>// &lt;Widget&gt;[]</span>
<span>)</span><span>,</span></code></pre><p>üõ† Now add these methods to <code>_HomeScreenState</code>, after the <code><span>build</span><span>(</span><span>)</span></code> method:</p><pre><code><span>setSuccessAuthState</span><span>(</span><span>)</span> <span>{</span>
  <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
    isProgressing <span>=</span> <span>false</span><span>;</span>
    isLoggedIn <span>=</span> <span>true</span><span>;</span>
    name <span>=</span> AuthService<span>.</span>instance<span>.</span>idToken<span>?</span><span>.</span>name<span>;</span>
  <span>}</span><span>)</span><span>;</span>

  CoffeeRouter<span>.</span>instance<span>.</span><span>push</span><span>(</span>MenuScreen<span>.</span><span>route</span><span>(</span><span>)</span><span>)</span><span>;</span>
<span>}</span>

<span>setLoadingState</span><span>(</span><span>)</span> <span>{</span>
  <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
    isProgressing <span>=</span> <span>true</span><span>;</span>
    errorMessage <span>=</span> <span>&#39;&#39;</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

Future<span>&lt;</span><span>void</span><span>&gt;</span> <span>loginAction</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
  <span>setLoadingState</span><span>(</span><span>)</span><span>;</span>
  <span>final</span> message <span>=</span> <span>await</span> AuthService<span>.</span>instance<span>.</span><span>login</span><span>(</span><span>)</span><span>;</span>
  <span>if</span> <span>(</span>message <span>==</span> <span>&#39;Success&#39;</span><span>)</span> <span>{</span>
    <span>setSuccessAuthState</span><span>(</span><span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
      isProgressing <span>=</span> <span>false</span><span>;</span>
      errorMessage <span>=</span> message<span>;</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span>

<span>initAction</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
  <span>setLoadingState</span><span>(</span><span>)</span><span>;</span>
  <span>final</span> bool isAuth <span>=</span> <span>await</span> AuthService<span>.</span>instance<span>.</span><span>init</span><span>(</span><span>)</span><span>;</span>
  <span>if</span> <span>(</span>isAuth<span>)</span> <span>{</span>
    <span>setSuccessAuthState</span><span>(</span><span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>setState</span><span>(</span><span>(</span><span>)</span> <span>{</span>
      isProgressing <span>=</span> <span>false</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><p>Some notes about these methods:</p><ul><li><code><span>initAction</span><span>(</span><span>)</span></code> is called when the home screen is initiated and handles the case where the app has a Refresh Token.</li><li>The <code><span>Row</span><span>(</span><span>)</span></code> function call in the <code><span>build</span><span>(</span><span>)</span></code> method determines what the user sees based on their login status. When the user is logged in, the screen shows a welcome message containing the user‚Äôs name. When the user isn‚Äôt logged in, it shows a progress indicator if the login is in progress, or the ‚ÄúLogin | Register‚Äù button otherwise.</li><li>Pressing the ‚ÄúLogin | Register‚Äù button causes the <code><span>loginAction</span><span>(</span><span>)</span></code> method to be called.</li><li>A loading indicator will appear if the login is in progress.</li><li>A number of methods call <code><span>setSuccessAuthState</span><span>(</span><span>)</span></code>, which set the home screen‚Äôs instance variables to the appropriate values and redirects the user to the proper screen. In case some operation fails, you can easily display an error message onscreen.</li></ul><h3 id="Logging-in">Logging in</h3><p>üõ† If you‚Äôve made it this far, you‚Äôve done well, and it‚Äôs now time to see what you‚Äôve achieved so far. Make sure your emulators or devices are active and stop any earlier versions of this app. Once you‚Äôve done that, run the app using this command:</p><pre><code>flutter run -d all --dart-define<span>=</span>AUTH0_DOMAIN<span>=</span><span>[</span>YOUR DOMAIN<span>]</span> --dart-define<span>=</span>AUTH0_CLIENT_ID<span>=</span><span>[</span>YOUR CLIENT ID<span>]</span></code></pre><p>Once the app is loaded, tap on the &#34;Login | Register&#34; button.</p><p>On iOS, when you run the app for the first time, you will see a prompt like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/35URcfKhXm5Mw9H6UCEZMh/f60c8a3bf99f629b5fad6884c1c1d579/ASWebAuthenticationSession.png" alt="Allowed callback URLs"/></p><p>This prompt is a result of iOS‚Äô <a href="https://developer.apple.com/documentation/authenticationservices/aswebauthenticationsession" target="_blank" rel="noreferrer noopener"><code>ASWebAuthenticationSession</code></a>, a session where the user is authenticated through a web service. iOS is notifying the user that the app intends to log the user in using Auth0.</p><p>If you tap ‚ÄúContinue‚Äù and all goes well, you will see the <a href="https://auth0.com/docs/universal-login" target="_blank" rel="noreferrer noopener">Auth0 Universal Login page</a>, shown below (the Android version is on the left, and the iOS version is on the right): </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4XJ2EMjdhToaGmbQfYrSq5/a1273bdef7feacf4bdc82de2d7ef3379/auth0-login.png" alt="Allowed callback URLs"/></p><p>Note that you can style this page or even choose other templates in the Auth0 dashboard. <a href="https://www.youtube.com/playlist?list=PLCOnzDflrUceRLfHEkl-u2ipjsre6ZwjV" target="_blank" rel="noreferrer noopener">Watch this video to learn more about the theming of the login page in Auth0</a>.</p><p>Once you log in, you will be redirected to the application, where you‚Äôll be greeted by name. You‚Äôll then be redirected to the menu screen, as specified by the final line in <code>_HomeScreenState</code>‚Äôs <code><span>setSuccessAuthState</span><span>(</span><span>)</span></code> method:</p><pre><code>CoffeeRouter<span>.</span>instance<span>.</span><span>push</span><span>(</span>MenuScreen<span>.</span><span>route</span><span>(</span><span>)</span><span>)</span><span>;</span></code></pre><blockquote><p>If you signed up for a new account using the app, you might receive a confirmation email from Auth0 for the app.</p></blockquote><p>üõ† To confirm that the Refresh Token works, terminate the app, and run it again. The application will retrieve the Refresh Token from a secure store, get a new Access Token and ID Token, and then take you straight to the menu screen, bypassing the login process and not asking for your credentials.</p><h2 id="Simple-Logout">Simple Logout</h2><h3 id="Layers-of-sessions">Layers of sessions</h3><p>Every login requires logout! It‚Äôs more complicated than it looks  since there are typically three-session layers you need to consider:</p><ul><li><strong>Application Session Layer:</strong> This is the application, which in this case is the MJ Coffee app.</li><li><strong>Auth0 Session Layer:</strong> Auth0 maintains a session for each logged-in user and stores their information inside a cookie or in some other way.</li><li><strong>Identity Provider Session Layer:</strong> This is another service providing identity services, such as Facebook or Google.</li></ul><p>After users log out, you can redirect users to a specific URL. You need to register the redirect URL in your tenant or application settings.</p><p>One of the parameters for OIDC authentication requests is called <code>prompt</code>, which specifies how the user should be prompted for reauthentication and consent. It also makes it easy to clear sessions. </p><p><code>prompt</code> takes a list that can contain any combination of these values:</p><ul><li><strong><code>none</code></strong>: Do not display any authentication or consent user interface pages.</li><li><strong><code>login</code></strong>: Ignore any existing session and require the user to log in.</li><li><strong><code>consent</code></strong>: Ask the user for consent before returning information to the app.</li><li><strong><code>select_account</code></strong>: Show a prompt asking the user to select a user account. Useful in cases where the user has multiple accounts.</li></ul><p>üõ† Luckily, <code>prompt</code> is supported in the <code>AppAuth</code> SDK. In the <code>AuthService</code> class (located in <code><span>/</span>lib<span>/</span>services<span>/</span>auth_service<span>.</span>dart</code>) locate the <code><span>login</span><span>(</span><span>)</span></code> method, where you have constructed <code>AuthorizationTokenRequest</code>. Change your call to the <code>AuthorizationTokenRequest</code> constructor so that it includes <code>login</code> as a <code>prompt</code> value:</p><pre><code><span>// /lib/services/auth_service.dart</span>

<span>final</span> authorizationTokenRequest <span>=</span> <span>AuthorizationTokenRequest</span><span>(</span>
  AUTH0_CLIENT_ID<span>,</span>
  AUTH0_REDIRECT_URI<span>,</span>
  issuer<span>:</span> AUTH0_ISSUER<span>,</span>
  scopes<span>:</span> <span>[</span><span>&#39;openid&#39;</span><span>,</span> <span>&#39;profile&#39;</span><span>,</span> <span>&#39;offline_access&#39;</span><span>,</span> <span>&#39;email&#39;</span><span>]</span><span>,</span>
  promptValues<span>:</span> <span>[</span><span>&#39;login&#39;</span><span>]</span><span>,</span>
<span>)</span><span>;</span></code></pre><h3 id="Remove-the-Refresh-Token">Remove the Refresh Token</h3><p>Thanks to the Refresh Token, the user should be able to switch to another app or even close it and then return to MJ Coffee without having to re-authenticate because they‚Äôre still logged in. Logging out implies that the user is done with the app for now. The next time someone uses the app, they should be required to log in. This is done by removing the Refresh Token.</p><p>üõ† To remove the Refresh Token, we‚Äôll need to remove the Refresh Token key from secure storage. Add this <code><span>logout</span><span>(</span><span>)</span></code> method to <code>AuthService</code>, just after the <code><span>login</span><span>(</span><span>)</span></code> method:</p><pre><code><span>// /lib/services/auth_service.dart</span>

Future<span>&lt;</span><span>void</span><span>&gt;</span> <span>logout</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
  <span>await</span> secureStorage<span>.</span><span>delete</span><span>(</span>key<span>:</span> REFRESH_TOKEN_KEY<span>)</span><span>;</span>
<span>}</span></code></pre><p>The next time the user runs the app, they‚Äôll be sent to the home screen and its login button since the app no longer has a Refresh Token and hence no way to authenticate automatically. </p><p>While this is approach is sufficient for the MJ Coffee app, I would like to mention that you can also manually call logout endpoints and pass necessary parameters, and shown in the example below:</p><pre><code><span>// Example:</span>

Future<span>&lt;</span>bool<span>&gt;</span> <span>logout</span><span>(</span><span>)</span> <span>async</span> <span>{</span>
  <span>await</span> secureStorage<span>.</span><span>delete</span><span>(</span>key<span>:</span> REFRESH_TOKEN_KEY<span>)</span><span>;</span>

  <span>final</span> url <span>=</span> Uri<span>.</span><span>https</span><span>(</span>
      AUTH0_DOMAIN<span>,</span>
      <span>&#39;/v2/logout&#39;</span><span>,</span>
      <span>{</span>
        <span>&#39;client_id&#39;</span><span>:</span> AUTH0_CLIENT_ID<span>,</span>
        <span>&#39;federated&#39;</span><span>:</span> <span>&#39;&#39;</span><span>,</span>
        <span>//&#39;returnTo&#39;: &#39;YOUR_RETURN_LOGOUT_URL&#39;</span>
      <span>}</span><span>,</span>
    <span>)</span><span>;</span>

    <span>final</span> response <span>=</span> <span>await</span> http<span>.</span><span>get</span><span>(</span>
      url<span>,</span>
      headers<span>:</span> <span>{</span><span>&#39;Authorization&#39;</span><span>:</span> <span>&#39;Bearer $auth0AccessToken&#39;</span><span>}</span><span>,</span>
    <span>)</span><span>;</span>

    <span>print</span><span>(</span>
      <span>&#39;logout: ${response.request} ${response.statusCode} ${response.body}&#39;</span><span>,</span>
    <span>)</span><span>;</span>

    <span>return</span> response<span>.</span>statusCode <span>==</span> <span>200</span><span>;</span>
<span>}</span></code></pre><p>For more information, you can read <a href="https://auth0.com/docs/logout" target="_blank" rel="noreferrer noopener">Auth0‚Äôs documentation on logout.</a></p><p>üõ† Let‚Äôs enable the ‚ÄúLogout‚Äù button. It is on the profile screen, which is implemented by the <code>ProfileScreen</code> class (located in <code><span>/</span>lib<span>/</span>screens<span>/</span>profile<span>.</span>dart</code>). In the <code><span>build</span><span>(</span><span>)</span></code> method, locate the   ‚ÄúLogout‚Äù button and its <code>onPressed</code> parameter. Replace the ‚ÄúPerform logout‚Äù comments so that the call to the <code><span>Padding</span><span>(</span><span>)</span></code> function looks like this:</p><pre><code><span>// /lib/screens/profile.dart</span>

<span>Padding</span><span>(</span>
  padding<span>:</span> <span>const</span> EdgeInsets<span>.</span><span>symmetric</span><span>(</span>horizontal<span>:</span> <span>30</span><span>)</span><span>,</span>
  child<span>:</span> <span>CommonButton</span><span>(</span>
    onPressed<span>:</span> <span>(</span><span>)</span> <span>async</span> <span>{</span>
      <span>await</span> AuthService<span>.</span>instance<span>.</span><span>logout</span><span>(</span><span>)</span><span>;</span>
      CoffeeRouter<span>.</span>instance<span>.</span><span>pushReplacement</span><span>(</span>HomeScreen<span>.</span><span>route</span><span>(</span><span>)</span><span>)</span><span>;</span>
    <span>}</span><span>,</span>
    text<span>:</span> <span>&#39;Logout&#39;</span><span>,</span>
  <span>)</span><span>,</span>
<span>)</span><span>;</span></code></pre><p>When the user presses ‚ÄúLogout‚Äù, the <code>AuthService</code> instance‚Äôs <code><span>logout</span><span>(</span><span>)</span></code> is called and the user is redirected to the home screen.</p><p>üõ† Since you‚Äôre making use of <code>AuthService</code>‚Äôs <code><span>logout</span><span>(</span><span>)</span></code> method, you‚Äôll have to import its file. Add the following to the <code><span>import</span></code> statements at the top of <code><span>/</span>lib<span>/</span>screens<span>/</span>profile<span>.</span>dart</code>:</p><pre><code><span>import</span> <span>&#39;package:mjcoffee/services/auth_service.dart&#39;</span><span>;</span></code></pre><p>üõ† Restart your application, go to the <strong>Profile</strong> screen and log out. You‚Äôll be sent back to the home screen. You will have to log in to use the app again.</p><h2 id="Conclusion">Conclusion</h2><p>Congratulations! You have just integrated Auth0-powered login and logout into the MJ Coffee app.</p><p>In an upcoming section, you will continue to add authentication features to the app. You‚Äôll learn more about Refresh Token rotation, managing the branding that appears in the login box, roles and adding social login via Apple and Google accounts.</p></div></div>]]></content:encoded>
      <author>Authentication vs. authorization</author>
      <pubDate>Mon, 04 Oct 2021 17:12:00 +0000</pubDate>
    </item>
    <item>
      <title>Flutter Authentication and Authorization with Auth0, Part 2: Refresh Tokens, Social Logins, and More</title>
      <link>https://auth0.com/blog/flutter-authentication-authorization-with-auth0-part-2-refresh-tokens-social-logins-more/</link>
      <description>In this tutorial, you‚Äôll learn how to enhance your Flutter apps by enabling authentication, supporting federated identity providers, adding authorization by introducing roles and permissions, all leveraging Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the exercise from the previous section, you added Auth0 authentication to an existing Flutter app. This added a username/password authentication flow to the app. You also gave the app the ability to request and submit refresh tokens, which enhance the user experience by not requiring the user to authenticate every time they use the app.</p><p>This section will expand on the app by examining some useful Auth0 features:</p><ul><li>Refresh token rotation</li><li>Social logins</li><li>Managing your Auth0 account</li></ul><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong></p></blockquote><h2 id="Add-Refresh-Token-Rotation">Add Refresh Token Rotation</h2><p>When the app makes an authentication request to Auth0‚Äôs authentication server, it includes the <code>offline_access</code> scope. This causes the authentication server to issue a refresh token, which the app can use to re-authenticate without requiring the user to log in again. The app stores this token in the device‚Äôs secure storage.</p><p>While this enhances the app‚Äôs user experience, it also introduces risk. The refresh token is long-lived, and the app could use it as a ‚Äúlifetime pass‚Äù to endlessly request new access tokens and keep the user logged in forever.</p><p>I highly recommend taking advantage of <em>Refresh Token Rotation</em> and <em>Automatic Reuse Detection</em> to help mitigate this risk. With these features enabled, each refresh token can be used only once. When the app exchanges its refresh token for a new access token, the authentication server also returns a new refresh token and invalidates the old one. </p><p>Let‚Äôs enable these features!</p><p>üõ† Navigate to the <strong>Applications</strong> section of your Auth0 dashboard, select the <strong>MJ Coffee</strong> application, and then select its <strong>Settings</strong> tab. Scroll down the page to the <strong>Refresh Token Rotation</strong> section and turn on the <strong>Rotation</strong> and <strong>Absolute Expiration</strong> options:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6EizPZZnkGjxoAOle1Q8eL/e06c99f4a49413572736bbf0f470436c/rotation_and_absolute_expiration.png" alt="Turn on the ‚ÄúRotation‚Äù and ‚ÄúAbsolute Expiration‚Äù options."/></p><p>It is recommended that you issue a refresh token that expires after a preset lifetime. The refresh token‚Äôs lifetime can be extended each time one is used to get a new access token or access token/refresh token pair.</p><p>There are two options for token lifetimes, and they can be set independently of each other:</p><ul><li><strong>Absolute Lifetime:</strong> Enabling <strong>Absolute Expiration</strong> sets a specified <em>absolute lifetime</em> for the application‚Äôs refresh tokens. Refresh tokens can be exchanged for new access tokens during this lifetime. Once the token‚Äôs age goes past its lifetime, the user will need to re-authenticate in order to get a new access token. If <strong>Absolute Expiration</strong> is disabled, the refresh token has an indefinite absolute lifetime.</li><li><strong>Inactivity Lifetime:</strong> Enabling <strong>Inactivity Expiration</strong> specified <em>inactivity lifetime</em> for the application‚Äôs refresh tokens. Refresh tokens can be exchanged for new access tokens if the user is active in the application during this lifetime. If the user is inactive in the application for a period longer than the inactivity lifetime, they will need to re-authenticate in order to get a new access token.</li></ul><p>üõ† Scroll to the bottom of the page and click the <strong>Save Changes</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7KsLW4adJ6PNIPAI12al4g/f2c0e8abf6d7377595cfb7df11493e67/save_changes.png" alt="The ‚ÄúSave Changes‚Äù button. The user is directed to click it."/></p><p>These days, it&#39;s pretty common to have login methods beyond the standard username/password combination. These include logging in with social media account, which will significantly enhance your users‚Äô experiences.</p><p>Implementing these additional login methods and adding them to your authorization server is time-consuming and will come with many considerations and risks. </p><p>Luckily, Auth0 provides lots of integration with well-known third parties‚Äô authentication systems, and even allows you to write your custom connections. Let&#39;s add connections to both Google‚Äôs and Apple‚Äôs authentication systems.</p><p>üõ† In the Auth0 dashboard, select <strong>Authentication</strong> in the left column menu, then select <strong>Social</strong>. This takes you to the <strong>Social Connections</strong> page, where you should click the <strong>Create Social Connection</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/61w1eXrbY7bGOpNo6ODbaU/da810c63bacd28cabf71e6dee4baa349/create_social_connection.png" alt="The steps to create a new social connection in Auth0"/></p><p>You will be taken to the <strong>New Social Connection</strong> page, which has a list of social login providers that integrate with Auth0. </p><p>üõ† Select <strong>Google</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2YdUxIkwmCTcc9QFlo584q/22f7fd0bf4bc1c93c4ebc555e21009f8/select_google.png" alt="Selecting Google from all the available social connections"/></p><p>You will now be on the  <strong>New Google / Gmail Social Connection</strong> page, which tells you what kind of user information is accessed by Google social login.</p><p>üõ† Click <strong>Continue</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2SQwtF0vqtXJucnGbE3DNS/baf5bd9d7103a6ecbd59b879bbe2aaf4/click_continue.png" alt="Initial page for creating a new Google/Gmail social connection"/></p><p>A new page with a number of fields will appear; this is the connection‚Äôs <strong>Settings</strong> tab. </p><p>As long as you‚Äôre working in a development environment, you only need to fill the <strong>Name</strong> field (which provides a name for this connection) and leave all the other fields empty. You can always use the default value in the <strong>Name</strong> field:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7Jzsn4ryILOOdACN2urlSo/fdaa205ef09352c0b9aba0acbd592977/new_google_gmail_social_connection.png" alt="New Google/Gmail social connection"/></p><p>However, production apps require you to provide a <strong>Client ID</strong> and <strong>Client Secret</strong> (<a href="https://auth0.com/docs/connections/social/google" target="_blank" rel="noreferrer noopener">doc</a>) and specify the <strong>Allowed Mobile Client IDs</strong>. These topics will be covered in another video or article.</p><p>üõ† Create the Google/Gmail connection by scrolling to the bottom of the page and clicking <strong>Create</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4S8AJUaj4xehVwVxhNDt5X/69eb88b8bec557d310d0e9d678fe9b7e/click_create.png" alt="Creating the Google/Gmail connection"/></p><p>This will create the connection, and you‚Äôll be taken to its <strong>Applications</strong> tab. You‚Äôll see a list of your applications, which will allow you to enable the Google/Gmail connection for any of them. Enable the connection for the <em>MJ Coffee</em> application:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/681u1RRcha4ABJJ5GRZivy/c7eea90ca4e19ec5ab3b333caa47e5ba/google-oauth2_applications_tab.png" alt="The Google/OAuth2 applications tab"/></p><p>You may also set more permissions that the end-user will need to approve during authorization. These permissions depend on your application and what you want to do on behalf of the user. The <em>MJ Coffee</em> app doesn‚Äôt need any extra permissions beyond the basic and extended profile.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/13CvLX8tQUTuqU6jpZ6K94/a0eaac13b8fc83fc11b3ca3f6651ebd9/google_permissions.png" alt="Google Permission"/></p><p>üõ† Make sure you sync user profile attributes at each login and hit the <strong>Save</strong> button.</p><p>üõ† Once again in the Auth0 dashboard, select <strong>Authentication</strong> in the left column menu, then select <strong>Social</strong>. This takes you to the <strong>Social Connections</strong> page, where you should click the <strong>Create Social Connection</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1sohaZxDHuq8X8ZvT5nhvE/d2b7a7e2647708327f8fc6971ddb43a9/create_connection.png" alt="The steps to create a new social connection in Auth0"/></p><p>üõ† This time, select <strong>Apple</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3JAgbtDSNOsfYrjxkE1wCI/e51d80f7418706c29cd6e9dc06b93719/select_apple.png" alt="Selecting Apple from all the available social connections"/></p><p>You will now be on the  <strong>New Apple Social Connection</strong> page, which tells you what kind of user information is accessed by Apple social login.</p><p>üõ† Click <strong>Continue</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3zt2ntLwoHwp6bldLmOOsD/8db3e7f5c057d5782c7202b748013420/click_connect_-_apple.png" alt="Continue"/></p><p>As long as you‚Äôre working in a development environment, you can leave the <strong>Client ID</strong> and <strong>Client Secret Signing Key</strong> fields empty. You <em>will</em> need proper keys for those fields when the app goes to production; <a href="https://auth0.com/docs/connections/apple-siwa/set-up-apple" target="_blank" rel="noreferrer noopener">this document covers that topic in more detail</a>.</p><p>The <strong>Apple Team ID</strong> and <strong>Key ID</strong> values are required:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2qNvT5zkxB1TY06ywkH5Re/7c46fa1399743de9e7bb05d1d804fab0/apple_dev.png" alt="Google Permission"/></p><ul><li>To get your Apple Team ID, you need an Apple Developer Account.</li><li>To get a Key ID for your app, you need to register that app using your Apple Developer Account.</li></ul><p>üõ† Sign in to your Apple Developer Account, and go to the <strong>Membership</strong> page and make a note of your Team ID.</p><p>üõ† If you have a registered app, you can skip the following steps and jump to the list of tasks for creating a service ID. Otherwise, follow the steps below:</p><ul><li>In the Apple Developer Portal, go to <strong>Certificates, IDs, &amp; Profiles &gt; Identifiers</strong> and click the blue ‚Äúplus‚Äù icon next to <strong>Identifiers</strong> to create a new App ID.</li><li>Choose <strong>App IDs</strong> as the identifier type and click <strong>Continue</strong>.</li><li>Provide a description and a Bundle ID in reverse-domain name format (e.g.: <code>com<span>.</span>mydomain<span>.</span>mjcoffee</code>).</li><li>Scroll down and check <strong>Sign In with Apple</strong>.</li><li>Click <strong>Continue</strong>, and then click <strong>Register</strong>.</li></ul><p>üõ† Once the app is registered, it‚Äôs time to create a service ID:</p><ul><li>Return to the <strong>Certificates, IDs, &amp; Profiles</strong> section, and click the blue ‚Äúplus‚Äù icon next to <strong>Identifiers</strong>.</li><li>Choose <strong>Service IDs</strong> and select <strong>Continue</strong>. Fill in the description and identifier (e.g.: <code>com<span>.</span>mydomain<span>.</span>mjcoffee</code>).</li><li>After checking <strong>Sign In with Apple</strong>, select <strong>Configure</strong>, and define your Web Domain (e.g.: <code>com<span>.</span>mydomain<span>.</span>mjcoffee</code>) and your &#34;Return URL&#34;. Ensure that your Return URL is your Auth0 domain and that it follows this format: <code>https<span>:</span><span>/</span><span>/</span><span>YOUR_AUTH0_DOMAIN</span><span>/</span>login<span>/</span>callback</code>.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5Wetff0Tutv55UXsYz0gKq/ab19cd3e48604aea314410d22d194982/callback_apple.png" alt="Return URL apple sign in"/></p><p>üõ† Finally: save, continue and then register the service.</p><h4 id="Set-up-your-Client-Secret-Signing-Key">Set up your Client Secret Signing Key</h4><p>üõ† Follow these steps:</p><ul><li>Go to <strong>Keys</strong>, which is located in the <strong>Certificates, Identifiers, &amp; Profiles</strong> section of your Apple developer dashboard.</li><li>Select the blue ‚Äúplus‚Äù icon to add a new key.</li><li>Enter a <strong>Key Name</strong> and check the <strong>Sign In with Apple</strong> option.</li><li>Select <strong>Configure</strong> to make sure the <strong>Choose a Primary App ID</strong> field is filled with the correct App ID.</li><li>Select <strong>Save, Continue</strong>, and then <strong>Register</strong>.</li><li>On the page to which you&#39;re redirected after registering, make a note of the Key ID. Then download the key; it will have a <code><span>.</span>p8</code> filename extension.</li></ul><p>üõ† Go back to your Apple social connection settings and paste the Key ID. Ensure the proper attributes are selected (Name, Email) and sync user profile at each login is enabled. Hit <strong>Save</strong>.</p><p>üõ† Once you have created all your social connections and set them up correctly, go back to your applications. Go to the <strong>Connections</strong> tab and enable your newly-made social connections:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/59SCRbiX055qDcmTSNwPVl/fa175f974ceb43515893f24f7747d549/app_social_connections.png" alt="app social connections"/></p><p>As you can see, adding and removing social connections for your apps is now as simple and flicking a switch.</p><p>On the Flutter side, I have good news: you don‚Äôt need to implement anything there! </p><p>Restart the app, log out, then try to log in. You‚Äôll see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4b6BIaeZ8EHcN1a3MYVOrF/91c9039cf0d56051c99397d1a7524a3e/social_buttons_flutter.png" alt="app social connections"/></p><p>That&#39;s it! The login screen will now display social login buttons, and their login flows will be ready to use.</p><h2 id="Branding">Branding</h2><p>While it‚Äôs fine to use the default branding in development, you want the login page to be customized to your ‚Äúlook and feel‚Äù once the app‚Äôs in production.</p><p>Auth0 allows you to customize your login page through a number of options. You can change the look and feel of the login page by adding colors and logos, and you can customize the user notification part of the process as well: email templates, text messages, and so on. It‚Äôs all in the <strong>Branding</strong> section of the Auth0 dashboard:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7oq6VzFQ3nSUcStZTXvjQu/38d1e272f3bef751d9feaca704d580dc/branding.png" alt="Auth0 branding"/></p><h3 id="Add-Roles">Add Roles</h3><p>You may want to provide certain functionalities to the user based on their roles. This is easy with proper authorization server such as Auth0, which facilitates adding roles and specifying what users in each role are allowed to do. </p><p>In the MJ Coffee app, there are three different roles:</p><ul><li><strong>Admin:</strong> These are administrators, and they will have access to all the app‚Äôs functionality with full permissions.</li><li><strong>Customer:</strong> This is the default role for registered or logged-in users. They are limited to the app‚Äôs customer-facing features. You will automatically assign this role to all users upon registration or login, and you will learn how to do so later on in this tutorial.</li><li><strong>Employee:</strong> These are coffee shop employees. They can access the community screen to answer customer requests in the support chat, as well as other employee-facing features.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7nVdiU86TPCF1tLXrBg6ID/54a078bfe7d2382a6776c26adfc5cba4/roles.png" alt="Auth0 roles"/></p><p>You can add more roles to the app as the need arises.</p><h2 id="User-Management-in-Auth0">User Management in Auth0</h2><p>Auth0 provides the infrastructure to store users and their information on its cloud database.</p><p>For the <em>MJ Coffee</em> app, Auth0‚Äôs cloud database is sufficient. One of Auth0‚Äôs goals is to reduce the cost of extra infrastructure maintenance and cost.</p><p>You can access users by selecting <strong>User Management</strong> in the left column menu of the Auth0 dashboard. The <strong>Users</strong> page allows you to create new users and manage your existing ones by changing their details, adding permissions and roles, or revoking their access.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3O0JDGBqXHmPfrKaEavP2D/260c804cf50a308e696ecd9a446ab4a9/users.png" alt="Auth0 users"/></p><p>When you open a user, you‚Äôll see that Auth0 provides in-depth details about that user, including basic account data, metadata, their devices, and their history, which might be pretty helpful for debugging the application or investigating a particular user‚Äôs access activity, permissions, and roles.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/JcGTMspZ9hKtu9RAi4Oq9/257a692aa9a65cd12e96f645b56aafd1/user_roles.png" alt="Auth0 user roles"/></p><p>Each user account stores some basic information about the user: name, email address, the date and time when the account was created, and so on. </p><p>Additional information can be attached to a user by adding to these metadata stores:  their user metadata, which is a key-value structure for storing information about the user. You can also store information in the user<em>metadata or manipulating `app</em>metadata`, which helps to provide more information to the Flutter application while receiving user details.</p><h2 id="Moving-Forward">Moving Forward</h2><p>In the next section of this tutorial, you will learn how to add real-time chat to the app.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 04 Oct 2021 17:12:00 +0000</pubDate>
    </item>
    <item>
      <title>Let the Hunt Begin: Introducing Auth0‚Äôs First Capture the Flag Event.</title>
      <link>https://auth0.com/blog/introducing-auth0-ctf/</link>
      <description>Auth0‚Äôs first custom CTF with Hack The Box in honor of October Security Awareness Month</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>From companies to consumers, we believe everyone has a responsibility to make technology as secure as possible. For Auth0, this means building secure processes, technology, tools, and a culture of trust that puts people at the center. So this year we want you to join us for our first-ever custom Capture The Flag (CTF) with <a href="https://www.hackthebox.eu/" target="_blank" rel="noreferrer noopener">Hack The Box</a> from October 18th to October 25th.</p><h2 id="But-Wait-a-Minute--What-Is-a-CTF-">But Wait a Minute, What Is a CTF?</h2><p>A CTF or Capture The Flag is a cybersecurity competitive game where you have to solve or hack different types of challenges to gain access to a string -the flag- which looks something like this: <code><span>HTB</span><span>{</span>m1_f1rst_fl4g<span>}</span></code></p><p>You enter that flag into Hack The Box and get points depending on the difficulty of the challenge. The team with the most points wins the game.</p><h2 id="Sounds-Easy--Is-That-It-">Sounds Easy, Is That It?</h2><p>But winning alone is not the goal in our case. We designed our CTF with developers getting started in the security world in mind. </p><p>The benefit of learning cybersecurity principles and hacking techniques through a CTF is that you have certainty that the vulnerability exists in the challenge. When you go hacking in the real world, you don‚Äôt know whether the environment will be vulnerable or not. CTFs can also help you develop an attacker mindset, so the more you practice, the more secure and defensive your code will be.</p><p>Rikaard Hosein, Offensive Security Engineer (i.e hacker) at Auth0, and the mastermind behind this event got started in cybersecurity thanks to CTFs. <em>‚ÄúI solved my first cybersecurity web challenge when I was 15 and I was hooked. I kept on practicing CTFs in my spare time, and thanks to them I was able to transition from a developer role to Auth0‚Äôs offensive security engineering team. I designed the challenge concepts for this CTF to give you a little taste of what the CTF world is like, and to help you learn about cybersecurity‚Äù</em>. </p><p>Our CTF is a Jeopardy-style one, meaning that the team that gets the most points wins. We have different types of challenges:</p><ul><li><strong>Web: </strong>here you‚Äôll find mostly web-based vulnerability and also authentication/authorization issues (of course we had to include that!). Web development knowledge will come in very handy on these.</li><li><strong>Cryptography:</strong> here you can find some improperly implemented encryption schemes, different (and perhaps a bit uncommon üòâ) ciphers, and more.</li><li><strong>Reverse Engineering:</strong> some challenges may include a lower-level programming language like Assembly, decompiling code, debugging by doing step-by-step execution.</li><li><strong>Pwn - Binary Exploitation: </strong>the 0s and 1s! Finding a vulnerability in a binary or executable file.</li><li><strong>Misc:</strong> surprise</li></ul><p>To solve these challenges you can use a wide range of freely available tools and decipher websites. Rikaard recommends a simple tool belt: a great mindset (learn, have fun, keep trying), <a href="https://portswigger.net/burp/communitydownload" target="_blank" rel="noreferrer noopener">burp suite community edition</a>, your favorite scripting language, <a href="https://www.gnu.org/software/gdb/" target="_blank" rel="noreferrer noopener">GDB</a> and <a href="https://hex-rays.com/ida-free/" target="_blank" rel="noreferrer noopener">IDA</a>. You may need other tools but finding those is also part of the challenge üòâ.</p><h2 id="I-m-Excited--How-Can-I-Join-">I‚Äôm Excited. How Can I Join?</h2><ul><li>No prior experience is required.</li><li>You can participate either on your own or with a team of up to five people. We strongly recommend you find a team.</li><li><a href="https://ctf.hackthebox.com/" target="_blank" rel="noreferrer noopener">Create an account in Hack The Box</a> and sign up for the CTF starting now to get ready for October 18th. If you are part of a team, only the team captain needs to join the CTF (but everyone needs to have an account)</li><li>Join Hack The Box‚Äôs <a href="https://discord.gg/hackthebox" target="_blank" rel="noreferrer noopener">discord channel</a></li><li>Get ready to hack your way to the podium.</li></ul><h2 id="Resources-to-Get-Started">Resources to Get Started</h2><ul><li><a href="https://help.hackthebox.eu/en/articles/5200851-gs-introduction-to-ctf" target="_blank" rel="noreferrer noopener">Hack The Box Introduction to CTFs</a></li><li><a href="https://ctf101.org/" target="_blank" rel="noreferrer noopener">CTF 101</a></li><li><a href="https://ctftime.org/writeups" target="_blank" rel="noreferrer noopener">CTF Write ups </a>(solutions to previous worldwide events)</li><li><a href="https://trailofbits.github.io/ctf/" target="_blank" rel="noreferrer noopener">CTF Field Guide by Trailofbits</a></li></ul></div></div>]]></content:encoded>
      <pubDate>Fri, 01 Oct 2021 14:56:00 +0000</pubDate>
    </item>
    <item>
      <title>Spring Boot Logs Aggregation and Monitoring Using ELK Stack</title>
      <link>https://auth0.com/blog/spring-boot-logs-aggregation-and-monitoring-using-elk-stack/</link>
      <description>Learn how you can integrate ELK stack with your Spring Boot application for logs aggregation and monitoring in a centralized way.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> Logs are the most critical way for debugging. They can help us follow the different operations carried out by the various services of our system.</p><p>This article will demonstrate how to integrate ELK Stack with a Spring Boot application for logs aggregation and monitoring in a centralized and scalable way.
You will also learn how to create custom index patterns through a Filebeat configuration and separate logs of different services of the same application by different indexes.
The application&#39;s source code used in this tutorial is available in this <a href="https://github.com/ApoorvTyagi/Spring-ELK" target="_blank" rel="noreferrer noopener">GitHub repository</a>.</p><h2 id="Introduction">Introduction</h2><p>Having a good log monitoring infrastructure is a key feature to have while developing any software. For instance, in a microservices architecture, any single operation triggers a chain of API calls making it challenging to debug the entire application in case an error comes.</p><p>This is where Logs act as essential information that allows us to investigate better and diagnose the errors. They can help sysadmins, support teams, and even developers to follow the different operations carried out by the different services of the system.</p><p>But it becomes very complex to maintain this critical data in a distributed environment where many applications, services, and systems are running. As a solution for this problem, we&#39;re going to look at the <strong>ELK stack</strong>, a useful tool for centralized log aggregation and analysis.</p><p>This article will demonstrate how you can integrate ELK Stack with a Spring Boot application to collect, process, store, and view the logs.</p><p>Apart from this, while working with the ELK stack, the default action is to show all the logs of a particular application at a single place inside Kibana.</p><p>In this article, you will also tackle this problem and learn how you can view the logs of multiple services separately that are running in parallel inside one single application.</p><h2 id="Introducing-ELK-Stack">Introducing ELK Stack</h2><p>ELK is a collection of three open-source applications - <a href="https://www.elastic.co/elasticsearch/" target="_blank" rel="noreferrer noopener">Elasticsearch</a>, <a href="https://www.elastic.co/logstash/" target="_blank" rel="noreferrer noopener">Logstash</a>, and <a href="https://www.elastic.co/kibana/" target="_blank" rel="noreferrer noopener">Kibana</a> from <a href="https://www.elastic.co/" target="_blank" rel="noreferrer noopener">Elastic</a> that accepts data from any source or format, on which you can then perform search, analysis, and visualize that data.</p><ol start="1"><li><strong>Elasticsearch</strong> ‚Äî Elasticsearch stores and indexes the data. It is a NoSQL database based on Lucene&#39;s open-source search engine. Since Elasticsearch is developed using Java, therefore, it can run on different platforms. One particular aspect where it excels is indexing streams of data such as logs.</li><li><strong>Logstash</strong> ‚Äî Logstash is a tool that integrates with a variety of deployments. It is used to collect, parse, transform, and buffer data from a variety of sources. The data collected by Logstash can be shipped to one or more targets like Elasticsearch.</li><li><strong>Kibana</strong> ‚Äî Kibana acts as an analytics and visualization layer on top of Elasticsearch.  Kibana can be used to search, view, and interpret the data stored in Elasticsearch.</li></ol><h2 id="ELK-Installation---Other-Configurations">ELK Installation &amp; Other Configurations</h2><p>Now that you understand what ELK means, let&#39;s learn how to configure all three components to your local development environment:</p><h3 id="Elasticsearch">Elasticsearch</h3><p>Download the Elasticsearch zip file from the <a href="https://www.elastic.co/downloads/elasticsearch" target="_blank" rel="noreferrer noopener">official elastic website</a> and extract the zip file contents.</p><p>Next, you can start the Elasticsearch cluster by running <code>bin<span>/</span>elasticsearch</code> on Linux and macOS or <code>bin\elasticsearch<span>.</span>bat</code> on Windows.</p><p>To make sure the Elasticsearch cluster is up and working fine, open the browser at <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>9200</span></code>. You must see something similar to this:</p><pre><code><span>{</span>
  <span>&#34;name&#34;</span> <span>:</span> <span>&#34;YOUR_PC_NAME&#34;</span><span>,</span>
  <span>&#34;cluster_name&#34;</span> <span>:</span> <span>&#34;elasticsearch&#34;</span><span>,</span>
  <span>&#34;cluster_uuid&#34;</span> <span>:</span> <span>&#34;Qz59cUdbQRuRTVct1h3HiA&#34;</span><span>,</span>
  <span>&#34;version&#34;</span> <span>:</span> <span>{</span>
    <span>&#34;number&#34;</span> <span>:</span> <span>&#34;7.13.2&#34;</span><span>,</span>
    <span>&#34;build_flavor&#34;</span> <span>:</span> <span>&#34;default&#34;</span><span>,</span>
    <span>&#34;build_type&#34;</span> <span>:</span> <span>&#34;zip&#34;</span><span>,</span>
    <span>&#34;build_hash&#34;</span> <span>:</span> <span>&#34;4d960a0733be83dd2543ca018aa4ddc42e956800&#34;</span><span>,</span>
    <span>&#34;build_date&#34;</span> <span>:</span> <span>&#34;2021-06-10T21:01:55.251515791Z&#34;</span><span>,</span>
    <span>&#34;build_snapshot&#34;</span> <span>:</span> <span>false</span><span>,</span>
    <span>&#34;lucene_version&#34;</span> <span>:</span> <span>&#34;8.8.2&#34;</span><span>,</span>
    <span>&#34;minimum_wire_compatibility_version&#34;</span> <span>:</span> <span>&#34;6.8.0&#34;</span><span>,</span>
    <span>&#34;minimum_index_compatibility_version&#34;</span> <span>:</span> <span>&#34;6.0.0-beta1&#34;</span>
  <span>}</span><span>,</span>
  <span>&#34;tagline&#34;</span><span>:</span> <span>&#34;You Know, for Search.&#34;</span>
<span>}</span></code></pre><h3 id="Kibana">Kibana</h3><p>Setting up Kibana is similar to Elasticsearch. Just download the latest version application from the <a href="https://www.elastic.co/downloads/kibana" target="_blank" rel="noreferrer noopener">official website</a>.</p><p>To start Kibana, run <code>bin<span>/</span>kibana</code> on Linux and macOS or <code>bin<span>/</span>kibana<span>.</span>bat</code> on Windows.</p><p>By default, Kibana listens on port 5601. If you go to <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>5601</span></code>, you should be redirected to the Kibana home page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7AHCnDDJCuJoGdIeu9kEme/27f2716e95dc611dbd0f69d79fe9a6e4/elk_01.png" alt="Kibana_Start"/></p><h3 id="Logstash">Logstash</h3><p>Download and extract the latest version of Logstash from <a href="https://www.elastic.co/downloads/logstash" target="_blank" rel="noreferrer noopener">official Logstash downloads</a></p><p>Here, inside the <code>bin</code> folder, you need to create one configuration(.conf) file. For instance, in this case, you will be creating <code>logstash<span>.</span>conf</code>.</p><p>A Logstash configuration consists of 3 components:</p><p><strong>1. Input</strong></p><p>The input section in the configuration file defines the name and the absolute path of the file from where data has to be fetched. In your case, it will be from the log file generated by the spring boot application.</p><p><strong>2. Filter</strong></p><p>The filter section defines what processing you want to apply to the data.</p><p><strong>3. Output</strong></p><p>The output section defines the target where you want to send the data (elasticsearch, for example).</p><p>So your <code>logstash<span>.</span>conf</code> file should look similar to this:</p><pre><code>input <span>{</span>

<span>}</span>

filter <span>{</span>

<span>}</span>
output <span>{</span>

<span>}</span></code></pre><p>In the further section, you will be making the changes in this file to pass the Spring Boot application logs to elasticsearch.</p><blockquote><p>To run the logstash configuration file, use command: <code>logstash <span>-</span>f <span>&lt;</span>file<span>&gt;</span><span>.</span>conf</code></p></blockquote><p>Apart from these, the other prerequisites required to follow this tutorial are:</p><ul><li><a href="https://www.oracle.com/in/java/technologies/javase-jdk11-downloads.html" target="_blank" rel="noreferrer noopener">Java 11</a> or later version</li><li><a href="https://maven.apache.org/download.cgi" target="_blank" rel="noreferrer noopener">Apache Maven</a></li><li><a href="https://www.postman.com/downloads/" target="_blank" rel="noreferrer noopener">Postman App</a></li></ul><p>Also, this tutorial requires you have a basic understanding of how REST APIs work in Spring Boot.</p><h2 id="Creating-a-Spring-Boot-Application">Creating a Spring Boot Application</h2><p>Let&#39;s now begin with creating the microservice. You will be using Spring Boot to create the REST APIs, and then you&#39;ll integrate it with the ELK stack that you saw above.</p><p>To start with Spring Boot, you can create a basic project using the <a href="https://start.spring.io/" target="_blank" rel="noreferrer noopener">Spring Boot Initializr</a>. </p><p>Select Maven project and Java language. For the Spring Boot version, select <code><span>2.5</span><span>.4</span></code>. You will also have to add the <code>spring<span>-</span>boot<span>-</span>starter<span>-</span>web</code> dependency.</p><p>Next, fill in the project metadata. Set group as <code>com<span>.</span>demo</code>, artifact and name as <code><span>ELK</span></code>, package as <code>com<span>.</span>demo<span>.</span><span>ELK</span></code>. Last but not least, enter a short description and click the <code>generate</code> button.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2YRj4WBbKsNyC8w1ebSQdc/5a8d316ff646df959f549f712e3449e8/elk_02.png" alt="Spring"/></p><p>Open the project folder in your favorite IDE and open the <code>pom<span>.</span>xml</code> file.</p><p>Add the following code to the <code>pom<span>.</span>xml</code> to configure the extra dependencies that you are going to use in this Spring Boot project:</p><pre><code><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span><span><span>&lt;</span>project</span> <span>xmlns</span><span><span>=</span><span>&#34;</span>http://maven.apache.org/POM/4.0.0<span>&#34;</span></span> <span><span>xmlns:</span>xsi</span><span><span>=</span><span>&#34;</span>http://www.w3.org/2001/XMLSchema-instance<span>&#34;</span></span>
    <span><span>xsi:</span>schemaLocation</span><span><span>=</span><span>&#34;</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>modelVersion</span><span>&gt;</span></span>4.0.0<span><span><span>&lt;/</span>modelVersion</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>parent</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>spring-boot-starter-parent<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>version</span><span>&gt;</span></span>2.5.3<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>relativePath</span><span>/&gt;</span></span> <span>&lt;!-- lookup parent from repository --&gt;</span>
    <span><span><span>&lt;/</span>parent</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>com.demo<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>ELK<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>version</span><span>&gt;</span></span>0.0.1-SNAPSHOT<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>name</span><span>&gt;</span></span>ELK<span><span><span>&lt;/</span>name</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>description</span><span>&gt;</span></span>Logs monitoring and aggregation using ELK stack<span><span><span>&lt;/</span>description</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>properties</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>java.version</span><span>&gt;</span></span>11<span><span><span>&lt;/</span>java.version</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>properties</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>dependencies</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>spring-boot-starter-web<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>spring-boot-starter-test<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>scope</span><span>&gt;</span></span>test<span><span><span>&lt;/</span>scope</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.json<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>json<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>version</span><span>&gt;</span></span>20180130<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>com.googlecode.json-simple<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>json-simple<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>version</span><span>&gt;</span></span>1.1<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>dependencies</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>build</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>plugins</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>plugin</span><span>&gt;</span></span>
                <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
                <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>spring-boot-maven-plugin<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
            <span><span><span>&lt;/</span>plugin</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>plugins</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>build</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>project</span><span>&gt;</span></span></code></pre><p>Next, create a new package <code>com<span>.</span>demo<span>.</span><span>ELK</span><span>.</span>controller</code>. Inside this, make a new Java file called <code>ELKController<span>.</span>java</code> to define the REST Controller for exposing the API endpoints. </p><p>You will call these APIs to print the content to your log file.</p><pre><code><span>package</span> <span>com<span>.</span>demo<span>.</span></span>ELK<span>.</span>controller<span>;</span>

<span>import</span> <span>com<span>.</span>fasterxml<span>.</span>jackson<span>.</span>databind<span>.</span></span><span>JsonNode</span><span>;</span>
<span>import</span> <span>org<span>.</span>json<span>.</span>simple<span>.</span></span><span>JSONArray</span><span>;</span>
<span>import</span> <span>org<span>.</span>slf4j<span>.</span></span><span>Logger</span><span>;</span>
<span>import</span> <span>org<span>.</span>slf4j<span>.</span></span><span>LoggerFactory</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>beans<span>.</span>factory<span>.</span>annotation<span>.</span></span><span>Autowired</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>GetMapping</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>PathVariable</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>RequestMapping</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>RestController</span><span>;</span>

<span>import</span> <span>java<span>.</span>util<span>.</span></span><span>Date</span><span>;</span>

<span>@RestController</span>
<span>@RequestMapping</span><span>(</span>value <span>=</span> <span>&#34;/api&#34;</span><span>)</span>
<span>public</span> <span>class</span> <span>ELKController</span> <span>{</span>

    <span>// Initializing instance of Logger for Controller</span>
    <span>private</span> <span>static</span> <span>final</span> <span>Logger</span> log <span>=</span> <span>LoggerFactory</span><span>.</span><span>getLogger</span><span>(</span><span>ELKController</span><span>.</span><span>class</span><span>)</span><span>;</span>

    <span>private</span> <span>final</span> <span>ELKService</span> service<span>;</span>

    <span>private</span> <span>final</span> <span>RestService</span> restService<span>;</span>

    <span>public</span> <span>ELKController</span><span>(</span><span>ELKService</span> service<span>,</span> <span>RestService</span> restService<span>)</span> <span>{</span>
        <span>this</span><span>.</span>service <span>=</span> service<span>;</span>
        <span>this</span><span>.</span>restService <span>=</span> restService<span>;</span>
    <span>}</span>

    <span>@GetMapping</span><span>(</span>value <span>=</span> <span>&#34;/hello&#34;</span><span>)</span>
    <span>public</span> <span>String</span> <span>helloWorld</span><span>(</span><span>)</span> <span>{</span>
        log<span>.</span><span>info</span><span>(</span><span>&#34;Inside Hello World Function&#34;</span><span>)</span><span>;</span>
        <span>String</span> response <span>=</span> <span>&#34;Hello World! &#34;</span> <span>+</span> <span>new</span> <span>Date</span><span>(</span><span>)</span><span>;</span>
        log<span>.</span><span>info</span><span>(</span><span>&#34;Response =&gt; {}&#34;</span><span>,</span>response<span>)</span><span>;</span>
        <span>return</span> response<span>;</span>
    <span>}</span>

    <span>@GetMapping</span><span>(</span>value <span>=</span> <span>&#34;/Food-Details&#34;</span><span>)</span>
    <span>public</span> <span>JSONArray</span> <span>foodDetails</span><span>(</span><span>)</span> <span>{</span>
        log<span>.</span><span>info</span><span>(</span><span>&#34;Inside Food Detail Function&#34;</span><span>)</span><span>;</span>
        <span>return</span> service<span>.</span><span>getAllFoodDetails</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Here you are exposing two endpoints which are: </p><ol start="1"><li><code><span>/</span>api<span>/</span>hello</code> ‚Äî It returns the &#34;Hello World!&#34; message with the current timestamp.</li><li><code><span>/</span>api<span>/</span>Food<span>-</span>Details</code> ‚Äî It gives the details of some food data, which is stored inside a JSON file.</li></ol><p>The <code>ELKService</code> class for that is as follows:</p><pre><code><span>package</span> <span>com<span>.</span>demo<span>.</span></span>ELK<span>.</span>services<span>;</span>

<span>import</span> <span>org<span>.</span>json<span>.</span>simple<span>.</span></span><span>JSONArray</span><span>;</span>
<span>import</span> <span>org<span>.</span>json<span>.</span>simple<span>.</span></span><span>JSONObject</span><span>;</span>
<span>import</span> <span>org<span>.</span>json<span>.</span>simple<span>.</span>parser<span>.</span></span><span>JSONParser</span><span>;</span>
<span>import</span> <span>org<span>.</span>json<span>.</span>simple<span>.</span>parser<span>.</span></span><span>ParseException</span><span>;</span>
<span>import</span> <span>org<span>.</span>slf4j<span>.</span></span><span>Logger</span><span>;</span>
<span>import</span> <span>org<span>.</span>slf4j<span>.</span></span><span>LoggerFactory</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>stereotype<span>.</span></span><span>Service</span><span>;</span>

<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>FileReader</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>IOException</span><span>;</span>
<span>import</span> <span>java<span>.</span>nio<span>.</span>charset<span>.</span></span><span>StandardCharsets</span><span>;</span>

<span>@Service</span>
<span>public</span> <span>class</span> <span>ELKService</span> <span>{</span>

    <span>// Initializing instance of Logger for Service</span>
    <span>private</span> <span>static</span> <span>final</span> <span>Logger</span> log <span>=</span> <span>LoggerFactory</span><span>.</span><span>getLogger</span><span>(</span><span>ELKService</span><span>.</span><span>class</span><span>)</span><span>;</span>

    <span>public</span> <span>JSONArray</span> <span>getAllFoodDetails</span><span>(</span><span>)</span><span>{</span>
        log<span>.</span><span>info</span><span>(</span><span>&#34;Fetching ALL food details...&#34;</span><span>)</span><span>;</span>
        <span>JSONArray</span> foodDetail <span>=</span> <span>new</span> <span>JSONArray</span><span>(</span><span>)</span><span>;</span>
        <span>try</span> <span>{</span>
            <span>JSONParser</span> parser <span>=</span> <span>new</span> <span>JSONParser</span><span>(</span><span>)</span><span>;</span>
            <span>Object</span> obj <span>=</span> parser<span>.</span><span>parse</span><span>(</span><span>new</span> <span>FileReader</span><span>(</span><span>&#34;example.json&#34;</span><span>,</span> <span>StandardCharsets</span><span>.</span>UTF_8<span>)</span><span>)</span><span>;</span>
            <span>JSONObject</span> jsonObject <span>=</span> <span>(</span><span>JSONObject</span><span>)</span> obj<span>;</span>
            foodDetail <span>=</span> <span>(</span><span>JSONArray</span><span>)</span> jsonObject<span>.</span><span>get</span><span>(</span><span>&#34;data&#34;</span><span>)</span><span>;</span>

        <span>}</span> <span>catch</span> <span>(</span><span>IOException</span> <span>|</span> <span>ParseException</span> e<span>)</span> <span>{</span>
            log<span>.</span><span>error</span><span>(</span><span>&#34;Error occurred in reading JSON file&#34;</span><span>)</span><span>;</span>
            e<span>.</span><span>printStackTrace</span><span>(</span><span>)</span><span>;</span>
        <span>}</span>
        <span>return</span> foodDetail<span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>And following is the content inside the <code>example<span>.</span>json</code> file which you are reading:</p><pre><code><span>{</span>
    <span>&#34;data&#34;</span><span>:</span> <span>[</span>
    
        <span>{</span>
            <span>&#34;id&#34;</span><span>:</span> <span>0</span><span>,</span>
            <span>&#34;productName&#34;</span><span>:</span> <span>&#34;Fresh Avocados&#34;</span><span>,</span>
            <span>&#34;image&#34;</span><span>:</span> <span>&#34;ü•ë&#34;</span><span>,</span>
            <span>&#34;from&#34;</span><span>:</span> <span>&#34;Spain&#34;</span><span>,</span>
            <span>&#34;nutrients&#34;</span><span>:</span> <span>&#34;Vitamin B, Vitamin K&#34;</span><span>,</span>
            <span>&#34;quantity&#34;</span><span>:</span> <span>&#34;4 ü•ë&#34;</span><span>,</span>
            <span>&#34;price&#34;</span><span>:</span> <span>&#34;6.50&#34;</span><span>,</span>
            <span>&#34;organic&#34;</span><span>:</span> <span>true</span><span>,</span>
            <span>&#34;description&#34;</span><span>:</span> <span>&#34;A ripe avocado yields to gentle pressure when held in the palm and squeezed. &#34;</span>
        <span>}</span><span>,</span>
        <span>{</span>
            <span>&#34;id&#34;</span><span>:</span> <span>1</span><span>,</span>
            <span>&#34;productName&#34;</span><span>:</span> <span>&#34;Cheese&#34;</span><span>,</span>
            <span>&#34;image&#34;</span><span>:</span> <span>&#34;üßÄ&#34;</span><span>,</span>
            <span>&#34;from&#34;</span><span>:</span> <span>&#34;Portugal&#34;</span><span>,</span>
            <span>&#34;nutrients&#34;</span><span>:</span> <span>&#34;Vitamin A, Calcium&#34;</span><span>,</span>
            <span>&#34;quantity&#34;</span><span>:</span> <span>&#34;250g&#34;</span><span>,</span>
            <span>&#34;price&#34;</span><span>:</span> <span>&#34;5.00&#34;</span><span>,</span>
            <span>&#34;organic&#34;</span><span>:</span> <span>false</span><span>,</span>
            <span>&#34;description&#34;</span><span>:</span> <span>&#34;Creamy and distinct in flavor, goat cheese is a dairy product enjoyed around the world.&#34;</span>
        <span>}</span><span>,</span>
        <span>{</span>
            <span>&#34;id&#34;</span><span>:</span> <span>2</span><span>,</span>
            <span>&#34;productName&#34;</span><span>:</span> <span>&#34;Broccoli&#34;</span><span>,</span>
            <span>&#34;image&#34;</span><span>:</span> <span>&#34;ü•¶&#34;</span><span>,</span>
            <span>&#34;from&#34;</span><span>:</span> <span>&#34;Portugal&#34;</span><span>,</span>
            <span>&#34;nutrients&#34;</span><span>:</span> <span>&#34;Vitamin C, Vitamin K&#34;</span><span>,</span>
            <span>&#34;quantity&#34;</span><span>:</span> <span>&#34;3 ü•¶&#34;</span><span>,</span>
            <span>&#34;price&#34;</span><span>:</span> <span>&#34;5.50&#34;</span><span>,</span>
            <span>&#34;organic&#34;</span><span>:</span> <span>true</span><span>,</span>
            <span>&#34;description&#34;</span><span>:</span> <span>&#34;Broccoli is known to be a hearty and tasty vegetable which is rich in dozens of nutrients.&#34;</span>
        <span>}</span>
    <span>]</span>
<span>}</span></code></pre><h3 id="Creating-Logback-Spring-xml">Creating Logback-Spring.xml</h3><p>Next, you also have to configure the <code>logback<span>-</span>spring<span>.</span>xml</code> file inside the <code>resources</code> folder of your project. It will be responsible for printing the logs in the console and to a log file. Logstash will use this log file to feed the data to Elasticsearch.</p><pre><code><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span><span><span>&lt;</span>configuration</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>&#34;</span>STDOUT<span>&#34;</span></span> <span>class</span><span><span>=</span><span>&#34;</span>ch.qos.logback.core.ConsoleAppender<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>encoder</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>pattern</span><span>&gt;</span></span> %d{dd-MM-yyyy HH:mm:ss.SSS} [%thread] %-5level %logger{36}.%M - %msg%n <span><span><span>&lt;/</span>pattern</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>encoder</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>appender</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>&#34;</span>SAVE-TO-FILE<span>&#34;</span></span> <span>class</span><span><span>=</span><span>&#34;</span>ch.qos.logback.core.FileAppender<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>file</span><span>&gt;</span></span>logs/application.log<span><span><span>&lt;/</span>file</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>encoder</span> <span>class</span><span><span>=</span><span>&#34;</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span>&#34;</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>Pattern</span><span>&gt;</span></span> %d{dd-MM-yyyy HH:mm:ss.SSS} [%thread] %-5level %logger{36}.%M - %msg%n <span><span><span>&lt;/</span>Pattern</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>encoder</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>logger</span> <span>name</span><span><span>=</span><span>&#34;</span>com.demo.ELK<span>&#34;</span></span> <span>additivity</span><span><span>=</span><span>&#34;</span>false<span>&#34;</span></span> <span>level</span><span><span>=</span><span>&#34;</span>info<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>&#34;</span>SAVE-TO-FILE<span>&#34;</span></span> <span>/&gt;</span></span>
        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>&#34;</span>STDOUT<span>&#34;</span></span> <span>/&gt;</span></span>
    <span><span><span>&lt;/</span>logger</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>root</span> <span>level</span><span><span>=</span><span>&#34;</span>INFO<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>&#34;</span>STDOUT<span>&#34;</span></span> <span>/&gt;</span></span>
    <span><span><span>&lt;/</span>root</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>configuration</span><span>&gt;</span></span></code></pre><blockquote><p><strong>Loggers</strong> are responsible for capturing events and passing them to the appender. <strong>Appenders</strong> (also known as Handlers in some logging frameworks) are responsible for documenting the log events to a destination.</p></blockquote><p>Here inside appenders, you have defined a custom log pattern - <code><span>%</span>d<span>{</span>dd<span>-</span><span>MM</span><span>-</span>yyyy <span>HH</span><span>:</span>mm<span>:</span>ss<span>.</span><span>SSS</span><span>}</span> <span>[</span><span>%</span>thread<span>]</span> <span>%</span><span>-</span><span>5</span>level <span>%</span>logger<span>{</span><span>36</span><span>}</span><span>.</span><span>%</span><span>M</span> <span>-</span> <span>%</span>msg<span>%</span>n</code>. Let us first understand what each of these terms means:</p><ul><li><strong>%d</strong> ‚Äì Returns the time when the log message occurred.</li><li><strong>%thread</strong> ‚Äì Returns the name of the thread in which the log message occurred.</li><li><strong>%-5level</strong> ‚Äì Returns the logging level of the log message (ERROR, WARN, INFO, DEBUG, and TRACE).</li><li><strong>%logger{64}</strong> ‚Äì Returns the package with the package and class name where the log message occurred. The number 64 inside the brackets represents the maximum length of the package and class name combined. You can change this number as per your need.</li><li><strong>%M</strong> ‚Äì Returns the name of the method where the log message has occurred.</li><li><strong>%msg</strong> ‚Äì Returns the actual log message.</li><li><strong>%n</strong> ‚Äì Line break.</li></ul><p>You have added two appenders here, one for logging in to the console and another one to log to a file.</p><p>With that covered, let&#39;s see how you can start your Spring Boot app server using CLI:</p><ul><li>Since you are using Maven, run the <code>mvn clean install</code> command in a terminal window inside your project root directory. This creates a JAR(Java archive) file that contains a compressed version of .class files, audio files, image files, or other directories.</li><li>This JAR will be created inside the <code>target</code> folder in the root directory. Navigate to that directory and run <code>java <span>-</span>jar <span>&lt;</span><span>JAR_NAME</span><span>&gt;</span><span>.</span>jar <span>&lt;</span><span>MAIN_CLASS_NAME</span><span>&gt;</span></code>. For example - <strong>java -jar ELK-0.0.1-SNAPSHOT.jar com.demo.ELK.ElkApplication</strong></li></ul><p>This will start your Spring Boot application on the default 8080 port:</p><pre><code>  <span>.</span>   ____          _            __ _ _
 <span>/</span>\\ <span>/</span> ___<span>&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | &#39;</span>_ <span>|</span> <span>&#39;_| | &#39;</span>_ \<span>/</span> _` <span>|</span> \ \ \ \
 \\<span>/</span>  ___<span>)</span><span>|</span> <span>|</span>_<span>)</span><span>|</span> <span>|</span> <span>|</span> <span>|</span> <span>|</span> <span>||</span> <span>(</span>_<span>|</span> <span>|</span>  <span>)</span> <span>)</span> <span>)</span> <span>)</span>
  &#39;  <span>|</span>____<span>|</span> <span>.</span>__<span>|</span>_<span>|</span> <span>|</span>_<span>|</span>_<span>|</span> <span>|</span>_\__<span>,</span> <span>|</span> <span>/</span> <span>/</span> <span><span>/</span><span> </span><span>/</span></span>
 <span>===</span><span>===</span><span>===</span><span>|</span>_<span>|=</span><span>===</span><span>===</span><span>===</span><span>===</span><span>=</span><span>|</span>___<span>/=</span><span>/</span>_<span>/</span>_<span>/</span>_<span>/</span>
 <span>:</span><span>:</span> Spring Boot <span>:</span><span>:</span>                <span>(</span>v2<span>.</span><span>5.4</span><span>)</span>


<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>16.090</span> <span>[</span>main<span>]</span> <span>INFO</span>  com<span>.</span>demo<span>.</span><span>ELK</span><span>.</span>ElkApplication<span>.</span>logStarting <span>-</span> Starting ElkApplication using Java <span>11.0</span><span>.1</span> on Vulcan <span>with</span> <span>PID</span> <span>18048</span> <span>(</span><span>D</span><span>:</span>\Git Projects\<span>ELK</span> Logs Monitoring\<span>ELK</span>\target\classes started by ApoorvTyagi <span>in</span> <span>D</span><span>:</span>\Git Projects\<span>ELK</span> Logs Monitoring\<span>ELK</span><span>)</span>
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>16.098</span> <span>[</span>main<span>]</span> <span>INFO</span>  com<span>.</span>demo<span>.</span><span>ELK</span><span>.</span>ElkApplication<span>.</span>logStartupProfileInfo <span>-</span> No active profile set<span>,</span> falling back to <span>default</span> profiles<span>:</span> <span>default</span>
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>17.573</span> <span>[</span>main<span>]</span> <span>INFO</span>  o<span>.</span>s<span>.</span>b<span>.</span>w<span>.</span>e<span>.</span>tomcat<span>.</span>TomcatWebServer<span>.</span>initialize <span>-</span> Tomcat initialized <span>with</span> <span>port</span><span>(</span>s<span>)</span><span>:</span> <span>8080</span> <span>(</span>http<span>)</span>
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>17.589</span> <span>[</span>main<span>]</span> <span>INFO</span>  o<span>.</span>a<span>.</span>coyote<span>.</span>http11<span>.</span>Http11NioProtocol<span>.</span>log <span>-</span> Initializing ProtocolHandler <span>[</span><span>&#34;http-nio-8080&#34;</span><span>]</span>
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>17.589</span> <span>[</span>main<span>]</span> <span>INFO</span>  o<span>.</span>a<span>.</span>catalina<span>.</span>core<span>.</span>StandardService<span>.</span>log <span>-</span> Starting service <span>[</span>Tomcat<span>]</span>
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>17.589</span> <span>[</span>main<span>]</span> <span>INFO</span>  o<span>.</span>a<span>.</span>catalina<span>.</span>core<span>.</span>StandardEngine<span>.</span>log <span>-</span> Starting Servlet engine<span>:</span> <span>[</span>Apache Tomcat<span>/</span><span>9.0</span><span>.50</span><span>]</span>
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>17.679</span> <span>[</span>main<span>]</span> <span>INFO</span>  o<span>.</span>a<span>.</span>c<span>.</span>c<span>.</span><span>C</span><span>.</span><span>[</span>Tomcat<span>]</span><span>.</span><span>[</span>localhost<span>]</span><span>.</span><span>[</span><span>/</span><span>]</span><span>.</span>log <span>-</span> Initializing Spring embedded WebApplicationContext
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>17.679</span> <span>[</span>main<span>]</span> <span>INFO</span>  o<span>.</span>s<span>.</span>b<span>.</span>w<span>.</span>s<span>.</span>c<span>.</span>ServletWebServerApplicationContext<span>.</span>prepareWebApplicationContext <span>-</span> Root WebApplicationContext<span>:</span> initialization completed <span>in</span> <span>1533</span> ms
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>18.143</span> <span>[</span>main<span>]</span> <span>INFO</span>  o<span>.</span>a<span>.</span>coyote<span>.</span>http11<span>.</span>Http11NioProtocol<span>.</span>log <span>-</span> Starting ProtocolHandler <span>[</span><span>&#34;http-nio-8080&#34;</span><span>]</span>
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>18.321</span> <span>[</span>main<span>]</span> <span>INFO</span>  o<span>.</span>s<span>.</span>b<span>.</span>w<span>.</span>e<span>.</span>tomcat<span>.</span>TomcatWebServer<span>.</span>start <span>-</span> Tomcat started on <span>port</span><span>(</span>s<span>)</span><span>:</span> <span>8080</span> <span>(</span>http<span>)</span> <span>with</span> context path <span>&#39;&#39;</span>
<span>05</span><span>-</span><span>09</span><span>-</span><span>2021</span> <span>11</span><span>:</span><span>57</span><span>:</span><span>18.329</span> <span>[</span>main<span>]</span> <span>INFO</span>  com<span>.</span>demo<span>.</span><span>ELK</span><span>.</span>ElkApplication<span>.</span>logStarted <span>-</span> Started ElkApplication <span>in</span> <span>3.131</span> <span>seconds</span> <span>(</span><span>JVM</span> running <span>for</span> <span>3.654</span><span>)</span></code></pre><p>In case you are using an IDE like IntelliJ IDEA, you can run the Spring Boot application by following these instructions:</p><ul><li>Click on <code>Add Configuration</code> from the top menu bar</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2VWREZTi4rbVfGvv2varl/f4bcec85847f6b47b7daacbad03296e5/elk_03.png" alt="IntelliJ_Start"/></p><ul><li>A new dialog box will open, click on <code>Add <span>new</span> <span>run</span> configurations</code> and select <code>Maven</code> from the dropdown</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/gAXnX1CalajGsuEZnNi2n/a45ea122ea20e219d458b9ad2ea13597/elk_04.png" alt="Intellij_2"/></p><ul><li>Give your run configuration a name. The working directory will automatically get picked. You just have to put the command <code>spring<span>-</span>boot<span>:</span>run</code> inside the command line and then click Apply and OK</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6MFpFMhOUDNL4O3CB3ntcL/ed25b8a5c5a584767897ce3ea81bcba5/elk_05.png" alt="IntelliJ_3"/></p><p>Now run the application, and the next thing you have to do is to hit the endpoints via the Postman app to generate the response and logs:</p><ul><li>GET: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>api<span>/</span>get<span>/</span>hello</code></li></ul><pre><code>Hello World<span>!</span> Tue Aug <span>10</span> <span>23</span><span>:</span><span>22</span><span>:</span><span>01</span> <span>IST</span> <span>2021</span></code></pre><ul><li>GET: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>api<span>/</span>get<span>/</span>Food<span>-</span>Details</code></li></ul><pre><code><span>[</span>
    <span>{</span>
        <span>&#34;image&#34;</span><span>:</span> <span>&#34;ü•ë&#34;</span><span>,</span>
        <span>&#34;quantity&#34;</span><span>:</span> <span>&#34;4 ü•ë&#34;</span><span>,</span>
        <span>&#34;price&#34;</span><span>:</span> <span>&#34;6.50&#34;</span><span>,</span>
        <span>&#34;description&#34;</span><span>:</span> <span>&#34;A ripe avocado yields to gentle pressure when held in the palm and squeezed. &#34;</span><span>,</span>
        <span>&#34;from&#34;</span><span>:</span> <span>&#34;Spain&#34;</span><span>,</span>
        <span>&#34;id&#34;</span><span>:</span> <span>0</span><span>,</span>
        <span>&#34;productName&#34;</span><span>:</span> <span>&#34;Fresh Avocados&#34;</span><span>,</span>
        <span>&#34;organic&#34;</span><span>:</span> <span>true</span><span>,</span>
        <span>&#34;nutrients&#34;</span><span>:</span> <span>&#34;Vitamin B, Vitamin K&#34;</span>
    <span>}</span><span>,</span>
    <span>{</span>
        <span>&#34;image&#34;</span><span>:</span> <span>&#34;üßÄ&#34;</span><span>,</span>
        <span>&#34;quantity&#34;</span><span>:</span> <span>&#34;250g&#34;</span><span>,</span>
        <span>&#34;price&#34;</span><span>:</span> <span>&#34;5.00&#34;</span><span>,</span>
        <span>&#34;description&#34;</span><span>:</span> <span>&#34;Creamy and distinct in flavor, goat cheese is a dairy product enjoyed around the world.&#34;</span><span>,</span>
        <span>&#34;from&#34;</span><span>:</span> <span>&#34;Portugal&#34;</span><span>,</span>
        <span>&#34;id&#34;</span><span>:</span> <span>1</span><span>,</span>
        <span>&#34;productName&#34;</span><span>:</span> <span>&#34;Cheese&#34;</span><span>,</span>
        <span>&#34;organic&#34;</span><span>:</span> <span>false</span><span>,</span>
        <span>&#34;nutrients&#34;</span><span>:</span> <span>&#34;Vitamin A, Calcium&#34;</span>
    <span>}</span><span>,</span>
    <span>{</span>
        <span>&#34;image&#34;</span><span>:</span> <span>&#34;ü•¶&#34;</span><span>,</span>
        <span>&#34;quantity&#34;</span><span>:</span> <span>&#34;3 ü•¶&#34;</span><span>,</span>
        <span>&#34;price&#34;</span><span>:</span> <span>&#34;5.50&#34;</span><span>,</span>
        <span>&#34;description&#34;</span><span>:</span> <span>&#34;Broccoli is known to be a hearty and tasty vegetable which is rich in dozens of nutrients.&#34;</span><span>,</span>
        <span>&#34;from&#34;</span><span>:</span> <span>&#34;Portugal&#34;</span><span>,</span>
        <span>&#34;id&#34;</span><span>:</span> <span>2</span><span>,</span>
        <span>&#34;productName&#34;</span><span>:</span> <span>&#34;Broccoli&#34;</span><span>,</span>
        <span>&#34;organic&#34;</span><span>:</span> <span>true</span><span>,</span>
        <span>&#34;nutrients&#34;</span><span>:</span> <span>&#34;Vitamin C, Vitamin K&#34;</span>
    <span>}</span>
<span>]</span></code></pre><p>If you check your IDE console, you can see the logs being printed inside it:</p><ul><li><strong>Console Logs</strong></li></ul><pre><code><span>10</span><span>-</span><span>08</span><span>-</span><span>2021</span> <span>23</span><span>:</span><span>22</span><span>:</span><span>01.368</span> <span>[</span>http<span>-</span>nio<span>-</span><span>8080</span><span>-</span>exec<span>-</span><span>6</span><span>]</span> <span>INFO</span>  c<span>.</span>demo<span>.</span><span>ELK</span><span>.</span>controller<span>.</span>ELKController<span>.</span>helloWorld <span>-</span> Inside Hello World Function
<span>10</span><span>-</span><span>08</span><span>-</span><span>2021</span> <span>23</span><span>:</span><span>22</span><span>:</span><span>01.376</span> <span>[</span>http<span>-</span>nio<span>-</span><span>8080</span><span>-</span>exec<span>-</span><span>6</span><span>]</span> <span>INFO</span>  c<span>.</span>demo<span>.</span><span>ELK</span><span>.</span>controller<span>.</span>ELKController<span>.</span>helloWorld <span>-</span> <span>Response</span> <span>=&gt;</span> Hello World<span>!</span> Sun Aug <span>29</span> <span>09</span><span>:</span><span>34</span><span>:</span><span>56</span> <span>IST</span> <span>2021</span>
<span>10</span><span>-</span><span>08</span><span>-</span><span>2021</span> <span>23</span><span>:</span><span>22</span><span>:</span><span>03.955</span> <span>[</span>http<span>-</span>nio<span>-</span><span>8080</span><span>-</span>exec<span>-</span><span>7</span><span>]</span> <span>INFO</span>  c<span>.</span>demo<span>.</span><span>ELK</span><span>.</span>controller<span>.</span>ELKController<span>.</span>foodDetails <span>-</span> Inside Food Detail Function
<span>10</span><span>-</span><span>08</span><span>-</span><span>2021</span> <span>23</span><span>:</span><span>22</span><span>:</span><span>03.955</span> <span>[</span>http<span>-</span>nio<span>-</span><span>8080</span><span>-</span>exec<span>-</span><span>7</span><span>]</span> <span>INFO</span>  com<span>.</span>demo<span>.</span><span>ELK</span><span>.</span>services<span>.</span>ELKService<span>.</span>getAllFoodDetails <span>-</span> Fetching <span>ALL</span> food details<span>...</span></code></pre><p>Also, a new folder called <code>logs</code> is created inside the project root directory as specified in the <code>logback<span>-</span>spring<span>.</span>xml</code>. Navigate inside this folder, and you will have your <code>application<span>.</span>log</code> file containing all the logs generated after hitting those two API endpoints:</p><ul><li><strong>File Logs</strong></li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4jojUsThftoW86uIMMzW0y/9043727cb170eb1eb8ecd42cbdf02334/elk_06.png" alt="File_Logs_1"/></p><h2 id="Integrating-Logstash-Pipeline">Integrating Logstash Pipeline</h2><p>Let&#39;s go back to where you have your Logstash folder and open the <code>logstash<span>.</span>conf</code> file.</p><p>Add the following content to it:</p><pre><code>input <span>{</span>
  file <span>{</span>
    <span>type</span> <span>=&gt;</span> <span>&#34;log&#34;</span>
    <span>path</span> <span>=&gt;</span> <span>&#34;/ELK/logs/application.log&#34;</span>    # Make sure you provide the absolute path <span>of</span> the file here
  <span>}</span>
<span>}</span>

filter <span>{</span>
  <span>if</span> <span>[</span>message<span>]</span> <span>=</span><span>~</span> <span>&#34;\tat&#34;</span> <span>{</span>
    grok <span>{</span>
      <span>match</span> <span>=&gt;</span> <span>[</span><span>&#34;message&#34;</span><span>,</span> <span>&#34;^(\tat)&#34;</span><span>]</span>
      <span>add_tag</span> <span>=&gt;</span> <span>[</span><span>&#34;stacktrace&#34;</span><span>]</span>
    <span>}</span>
  <span>}</span>
 
<span>}</span>

output <span>{</span>
  stdout <span>{</span>
    <span>codec</span> <span>=&gt;</span> rubydebug
  <span>}</span>
 
  elasticsearch <span>{</span>
    <span>hosts</span> <span>=&gt;</span> <span>[</span><span>&#34;localhost:9200&#34;</span><span>]</span>
  <span>}</span>
<span>}</span></code></pre><p><strong>In the input</strong>, you have specified the type and the complete path of your file. Note that the value of the <code>path</code> must be absolute and cannot be relative.</p><p><strong>In filters</strong>, wherever in the logs you will find a Tab character(\t) followed by &#34;at&#34;, you will tag that entry as a stacktrace of an error. <em>Grok</em> is simply a filter plugin useful to parse and apply queries to unstructured data in Logstash.</p><p><strong>In the output</strong>, you have defined a response that prints to the STDOUT of the console running Logstash using output codecs.</p><p>According to the <a href="https://www.elastic.co/guide/en/logstash/current/plugins-outputs-file.html" target="_blank" rel="noreferrer noopener">official docs</a>:</p><blockquote><p>Output codecs are a convenient method for encoding your data before it leaves the output without needing a separate filter in your Logstash pipeline. Here, <code>rubydebug</code> outputs event data using the ruby &#34;awesome_print&#34; library. This is the default codec for stdout.</p></blockquote><p>And finally, you have defined the <strong>output target</strong>  where these logs have to be sent from logstash, that is, Elasticsearch running locally on port 9200.</p><p>Hit the API endpoints again to generate the logs:</p><ol start="1"><li><code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>api<span>/</span>get<span>/</span>hello</code></li><li><code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>api<span>/</span>get<span>/</span>Food<span>-</span>Details</code></li></ol><p>This time you can see the logs printing in the logstash console as well. It means Logstash is successfully able to pick the Logs generated inside the <code>application<span>.</span>log</code> file: </p><pre><code><span>{</span>
    <span>&#34;@timestamp&#34;</span> <span>=</span><span>&gt;</span> <span>2021</span>-09-05T06:34:11.977Z,
       <span>&#34;message&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;29-08-2021 09:34:56.368 [http-nio-8080-exec-6] INFO  c.demo.ELK.controller.ELKController.helloWorld - Inside Hello World Function<span title="\r">\r</span>&#34;</span>,
          <span>&#34;type&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;log&#34;</span>,
      <span>&#34;@version&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;1&#34;</span>,
          <span>&#34;host&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;Vulcan&#34;</span>,
          <span>&#34;path&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;D:/Git Projects/ELK Logs Monitoring/ELK/logs/application.log&#34;</span>
<span>}</span>
<span>{</span>
    <span>&#34;@timestamp&#34;</span> <span>=</span><span>&gt;</span> <span>2021</span>-09-05T06:34:11.977Z,
       <span>&#34;message&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;29-08-2021 09:34:56.376 [http-nio-8080-exec-6] INFO  c.demo.ELK.controller.ELKController.helloWorld - Response =&gt; Hello World! Sun Aug 29 09:34:56 IST 2021<span title="\r">\r</span>&#34;</span>,
          <span>&#34;type&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;log&#34;</span>,
      <span>&#34;@version&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;1&#34;</span>,
          <span>&#34;host&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;Vulcan&#34;</span>,
          <span>&#34;path&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;D:/Git Projects/ELK Logs Monitoring/ELK/logs/application.log&#34;</span>
<span>}</span>
<span>{</span>
    <span>&#34;@timestamp&#34;</span> <span>=</span><span>&gt;</span> <span>2021</span>-09-05T06:34:11.977Z,
       <span>&#34;message&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;28-08-2021 20:33:24.598 [http-nio-8080-exec-1] INFO  c.demo.ELK.controller.ELKController.foodDetails - Inside Food Detail Function<span title="\r">\r</span>&#34;</span>,
          <span>&#34;type&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;log&#34;</span>,
      <span>&#34;@version&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;1&#34;</span>,
          <span>&#34;host&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;Vulcan&#34;</span>,
          <span>&#34;path&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;D:/Git Projects/ELK Logs Monitoring/ELK/logs/application.log&#34;</span>
<span>}</span>
<span>{</span>
    <span>&#34;@timestamp&#34;</span> <span>=</span><span>&gt;</span> <span>2021</span>-09-05T06:34:11.977Z,
       <span>&#34;message&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;28-08-2021 20:33:24.600 [http-nio-8080-exec-1] INFO  com.demo.ELK.services.ELKService.getAllFoodDetails - Fetching ALL food details...<span title="\r">\r</span>&#34;</span>,
          <span>&#34;type&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;log&#34;</span>,
      <span>&#34;@version&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;1&#34;</span>,
          <span>&#34;host&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;Vulcan&#34;</span>,
          <span>&#34;path&#34;</span> <span>=</span><span>&gt;</span> <span>&#34;D:/Git Projects/ELK Logs Monitoring/ELK/logs/application.log&#34;</span>
<span>}</span></code></pre><h3 id="Creating-Indexes-and-Viewing-Logs-in-Kibana">Creating Indexes and Viewing Logs in Kibana</h3><p>To access data from Elasticsearch, Kibana requires index patterns. As an analogy, in kibana, indexes are like the tables of a SQL database where you can store the data. Therefore, you must create an index pattern first to explore your data.</p><p>But how do you know what index to create?</p><p>For this, navigate to <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>9200</span><span>/</span>_cat<span>/</span>indices</code>; it will display all the indexes that have ever been created inside elasticsearch. Here you will see an index name starting with &#34;logstash-&#34;. This is the index that has been created by Logstash.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4XTKYRUo8MtA57PcHZipQn/cc4b8667e6ea32b9696292b21a8b4f71/elk_07.png" alt="Indexes_Half"/></p><p>Next, go to <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>5601</span><span>/</span>app<span>/</span>management<span>/</span>kibana<span>/</span>indexPatterns</code> and click on <strong>create index pattern</strong> on the top right.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6Tfx0m2k17VGJAdcWa1f8c/78e7c84c9f5082261de82a97b3c2641e/elk_08.png" alt="Create_Index"/></p><p>Type the index name as <code>logstash<span>-</span><span>*</span></code> and then click on next.</p><p>Optionally, in the next step, you can pick a field for filtering the data. You can choose <code>@timestamp</code> and then click on <strong>Create index pattern</strong>.</p><p>After this, head on to the <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>5601</span><span>/</span>app<span>/</span>discover</code>.</p><p>Select the index from the filters that you just created, and you&#39;ll be able to see and analyze the logs.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6NZ3memL5i50CMouUEJOm4/da541dcbd31e093f0e69da9bf95dac62/elk_09.png" alt="Kibana_Logs_1"/></p><blockquote><p>If you don&#39;t see data in Kibana, try changing the time filter to a larger range. By default, Kibana shows data for the last 15 minutes.</p></blockquote><p>Clicking and expanding any one particular Log data and then selecting JSON will show the response in easier to read JSON format:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/wZYP9Z6aoBpOTujAHC2MM/6f8cce8b1094fa3d15e109eb604558d9/elk_10.png" alt="Expand_Logs.png"/></p><p>Here&#39;s how you can integrate the ELK stack with your Spring Boot app to collect, process, and visualize logs at a centralized place.</p><h2 id="Introducing-Beats">Introducing Beats</h2><p>Until now, you have seen how to use the ELK stack for monitoring Spring Boot logs. Here, <strong>Logstash was reading log files</strong>.</p><p>Now, suppose you have to read data from log files from multiple file servers. </p><p>How should you approach this?</p><p>One simple option is adding Logstash on all the servers and passing the data to Elasticsearch. </p><p>But there is one problem, <strong>Logstash consumes a lot of resources</strong>. This can cause performance issues for high-traffic deployments servers. So it is not the best solution to use Logstash on all file servers.</p><p>As a solution to this, <strong>Beats</strong> were introduced. </p><blockquote><p><a href="https://www.elastic.co/guide/en/beats/libbeat/current/beats-reference.html" target="_blank" rel="noreferrer noopener">Beats</a> are open source data shippers that can be installed as agents on servers to send data directly to Elasticsearch or via Logstash, where it can be further processed and enhanced.</p></blockquote><p>There are various Beats for different purposes:</p><ul><li><strong>Filebeat</strong>: For file monitoring</li><li><strong>Metricbeat</strong>: For metrics monitoring</li><li><strong>Packetbeat</strong>: For network data monitoring</li><li><strong>Heartbeat</strong>: For uptime monitoring</li></ul><p>You will be specifically looking at Filebeat for this tutorial.</p><h3 id="When-to-Use-Filebeat-and-When-to-Use-Logstash-">When to Use Filebeat and When to Use Logstash?</h3><p>Filebeat is considered one of the best log shippers as it is lightweight, supports SSL &amp; TLS encryption, and is extremely reliable. However, it cannot transform the logs into easy-to-analyze structured data. That&#39;s the part performed by Logstash.</p><p>So, if you require advanced log enhancement like filtering out unwanted bits of data or transforming data to another format, you have to go for Logstash.</p><p>But if you are only interested in the timestamp and message content, you can choose Filebeat to act as your log aggregator, especially in a distributed environment. </p><p>Filebeat can either ship data directly to Elasticsearch or first to Logstash, and then Logstash can ingest this data to Elasticsearch. If you want to use the benefit of Filebeat and Logstash, you can very well go with the second approach.</p><h3 id="Configuring-Filebeat">Configuring Filebeat</h3><p>You can configure Filebeat similar to how you have done for other ELK stacks.</p><p>Just extract the zip file after downloading it from the <a href="https://www.elastic.co/downloads/beats/filebeat" target="_blank" rel="noreferrer noopener">official Filebeat Downloads</a>.</p><p>In Logstash, you have to modify the <code>logstash<span>.</span>conf</code> file; similarly, here, you have to do the same thing in <code>filebeat<span>.</span>yml</code>.</p><blockquote><p>To run Filebeat, use the command <code>filebeat<span>.</span>exe <span>-</span>c filebeat<span>.</span>yml</code>.</p></blockquote><p>Let&#39;s now look at how you can incorporate it with your already existing Spring Boot project.</p><h3 id="Integrating-Filebeat-with-Spring-Boot">Integrating Filebeat with Spring Boot</h3><p>Open filebeat.yml and add the following content:</p><pre><code>filebeat<span>.</span>inputs<span>:</span>
  <span>-</span> type<span>:</span> log
    enabled<span>:</span> <span>true</span>
    paths<span>:</span>
        <span>-</span> <span>/</span><span>ELK</span><span>/</span>logs<span>/</span>application<span>.</span>log  # Make sure to provide the absolute path <span>of</span> the file

output<span>.</span>elasticsearch<span>:</span>
  hosts<span>:</span> <span>[</span><span>&#34;localhost:9200&#34;</span><span>]</span>
  protocol<span>:</span> <span>&#34;http&#34;</span></code></pre><p><strong>In the input</strong>, you have to specify the complete path of the log file from where Filebeat will read the data. </p><p><strong>In the output</strong>, you have to define the hosts as the Elasticsearch and the port on which it is configured to listen. The protocol takes either HTTP or HTTPS as one of its values. It specifies where Elasticsearch is reachable. In this case, it is <strong>HTTP</strong>.</p><p>Now run the file with the command <code>filebeat<span>.</span>exe <span>-</span>c filebeat<span>.</span>yml</code>.</p><p>Similar to what you have done for logstash, you need to create a filebeat index inside Kibana by getting the index name from the <a href="http://localhost:9200/_cat/indices" target="_blank" rel="noreferrer noopener">Elasticsearch indices list</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6P9fymE1Qm7knKCEGw9d4n/0aa6773c0e8942b652f6903ea8be8b6a/elk_11.png" alt="Filebeat index"/></p><p>Here, you will see a new index name starting with &#34;filebeat-&#34;. This is the index that has been created by Filebeat.</p><p>Next, navigate back to the <a href="http://localhost:5601/app/management/kibana/indexPatterns" target="_blank" rel="noreferrer noopener">index pattern management</a> console in Kibana. </p><p>Click on the <code>Create index pattern</code> and type the index name as <code>filebeat<span>-</span><span>*</span></code>.</p><p>In the next step, pick a field for filtering the data. You can again pick <code>@timestamp</code> and then click on <code>Create index pattern</code>.</p><p>After this, head on to the <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>5601</span><span>/</span>app<span>/</span>discover</code>.</p><p>Select the <code>filebeat</code> index from the filters that you just created, and you&#39;ll be able to see and analyze the logs.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6BPgSritTgGvxxh21mh7PP/25551fe01a44e68c90a422d3f9e484dd/elk_12.png" alt="FilebeatConsole"/></p><h2 id="Combining-Filebeat-with-Logstash">Combining Filebeat with Logstash</h2><p>Let&#39;s say you are using Filebeat as your log shipper, and you want to transform the data which you are getting from the log file before passing it to Elasticsearch. </p><p>Since Filebeat doesn&#39;t allow any transformation to data, therefore, in this case, you have to use Logstash along with Filebeat.</p><p>Let us see how you can do that:</p><ul><li>Change the Filebeat output to Logstash and the port on which it is enabled, instead of Elasticsearch</li></ul><pre><code>filebeat<span>.</span>inputs<span>:</span>
  <span>-</span> type<span>:</span> log
    enabled<span>:</span> <span>true</span>
    paths<span>:</span>
        <span>-</span> <span>/</span><span>ELK</span><span>/</span>logs<span>/</span>application<span>.</span>log  # Absolute path <span>of</span> the log file

 output<span>.</span>logstash<span>:</span>
    hosts<span>:</span> <span>[</span><span>&#34;localhost:5044&#34;</span><span>]</span>  # Output is now pointing to Logstash</code></pre><ul><li>Modify the Logstash&#39;s input to read data from Filebeat instead of picking it from a file</li></ul><pre><code>input <span>{</span>
      beats <span>{</span>  # Notice the input is now being taken <span>from</span> <span>&#39;Beats&#39;</span> instead <span>of</span> a <span>&#39;file&#39;</span>
        <span>type</span> <span>=&gt;</span> <span>&#34;logs&#34;</span>
        <span>port</span> <span>=&gt;</span> <span>&#34;5044&#34;</span> 
      <span>}</span>
<span>}</span>

filter <span>{</span>  # Adding the filters
  <span>if</span> <span>[</span>message<span>]</span> <span>=</span><span>~</span> <span>&#34;\tat&#34;</span> <span>{</span>
    grok <span>{</span>
      <span>match</span> <span>=&gt;</span> <span>[</span><span>&#34;message&#34;</span><span>,</span> <span>&#34;^(\tat)&#34;</span><span>]</span>
      <span>add_tag</span> <span>=&gt;</span> <span>[</span><span>&#34;stacktrace&#34;</span><span>]</span>
    <span>}</span>
  <span>}</span>

 mutate <span>{</span>
    <span>replace</span> <span>=&gt;</span> <span>{</span> <span>&#34;[host]&#34;</span> <span>=&gt;</span> <span>&#34;%{[host][name]}&#34;</span> <span>}</span> 
  <span>}</span>
<span>}</span>

output <span>{</span>  # Output pointing to Elasticsearch
  stdout <span>{</span>
    <span>codec</span> <span>=&gt;</span> rubydebug
  <span>}</span>
 
  elasticsearch <span>{</span>
    <span>hosts</span> <span>=&gt;</span> <span>[</span><span>&#34;localhost:9200&#34;</span><span>]</span>
  <span>}</span>
<span>}</span></code></pre><p>Also, note that you have to add a new plugin(<code>mutate</code>) inside the filters.</p><p>This is because when you&#39;re using Filebeat and Logstash together, Filebeat automatically adds a <code>host</code> field with the type as an object to the logs events. At the same time, Logstash adds another <code>host</code> field of its own to the log events. But this host is of the string type instead of an object.</p><p>Because of these two different types of hosts, Elaticsearch will start throwing an error. To solve this, you need to decide whether you want to have the <code>host</code> as an object or a string.</p><p>In this case, we will go with the more straightforward way to replace the type of the host coming from Filebeat with a string type.</p><p>To do this, you have to use the <code>Mutate</code> filter plugin that allows you to perform general mutations on any field. You can replace and modify fields in your log events, as shown in the configuration above.</p><h3 id="Verifying-the-Configurations">Verifying the Configurations</h3><p>The next thing you have to do is to verify if the provided configurations are correct or not. The process for that remains the same as you did earlier. The Only difference is that this time you need to run both the <code>filebeat<span>.</span>yml</code> &amp; <code>logstash<span>.</span>conf</code> together. </p><p>The complete process for that is mentioned below:</p><ul><li>Start your <code>filebeat<span>.</span>yml</code> and <code>logstash<span>.</span>conf</code> files. Also, make sure the predefined <code>logsatsh<span>-</span><span>*</span></code> index pattern is selected inside Kibana.</li><li>Next, just hit any one of the API endpoints again, and you will see the new logs coming in the Logstash console:</li></ul><pre><code><span>{</span>
    <span>&#34;@timestamp&#34;</span> <span>=&gt;</span> <span>2021</span><span>-</span><span>09</span><span>-</span><span>09</span>T16<span>:</span><span>55</span><span>:</span><span>40.112</span>Z<span>,</span>
    <span>&#34;message&#34;</span> <span>=&gt;</span> <span>&#34;09-09-2021 22:25:36.174 [http-nio-8080-exec-3] INFO  c.demo.ELK.controller.ELKController.helloWorld - Inside Hello World Function&#34;</span><span>,</span>
    <span>&#34;input&#34;</span> <span>=&gt;</span> <span>{</span>
        <span>&#34;type&#34;</span> <span>=&gt;</span> <span>&#34;log&#34;</span>
    <span>}</span><span>,</span>
    <span>&#34;type&#34;</span> <span>=&gt;</span> <span>&#34;logs&#34;</span><span>,</span>
    <span>&#34;tags&#34;</span> <span>=&gt;</span> <span>[</span>
       <span>[</span><span>0</span><span>]</span> <span>&#34;beats_input_codec_plain_applied&#34;</span>
    <span>]</span><span>,</span>
    <span>&#34;@version&#34;</span> <span>=&gt;</span> <span>&#34;1&#34;</span><span>,</span>
    <span>&#34;ecs&#34;</span> <span>=&gt;</span> <span>{</span>
        <span>&#34;version&#34;</span> <span>=&gt;</span> <span>&#34;1.8.0&#34;</span>
    <span>}</span><span>,</span>
    <span>&#34;host&#34;</span> <span>=&gt;</span> <span>&#34;Vulcan&#34;</span><span>,</span>
    <span>&#34;agent&#34;</span> <span>=&gt;</span> <span>{</span>
        <span>&#34;version&#34;</span> <span>=&gt;</span> <span>&#34;7.13.2&#34;</span><span>,</span>
        <span>&#34;name&#34;</span> <span>=&gt;</span> <span>&#34;Vulcan&#34;</span><span>,</span>
        <span>&#34;type&#34;</span> <span>=&gt;</span> <span>&#34;filebeat&#34;</span><span>,</span>
        <span>&#34;ephemeral_id&#34;</span> <span>=&gt;</span> <span>&#34;94a3a0f3-165f-4308-8333-c1afbef0e016&#34;</span><span>,</span>
        <span>&#34;hostname&#34;</span> <span>=&gt;</span> <span>&#34;Vulcan&#34;</span><span>,</span>
        <span>&#34;id&#34;</span> <span>=&gt;</span> <span>&#34;f1b9d79a-9cf0-4a51-b12f-29c41ed05f60&#34;</span>
    <span>}</span>
<span>}</span><span>,</span>
<span>{</span>
    <span>&#34;@timestamp&#34;</span> <span>=&gt;</span> <span>2021</span><span>-</span><span>09</span><span>-</span><span>09</span>T16<span>:</span><span>55</span><span>:</span><span>40.112</span>Z<span>,</span>
    <span>&#34;message&#34;</span> <span>=&gt;</span> <span>&#34;09-09-2021 22:25:36.177 [http-nio-8080-exec-3] INFO  c.demo.ELK.controller.ELKController.helloWorld - Response =&gt; Hello World! Thu Sep 09 22:25:36 IST 2021&#34;</span><span>,</span>
    <span>&#34;input&#34;</span> <span>=&gt;</span> <span>{</span>
        <span>&#34;type&#34;</span> <span>=&gt;</span> <span>&#34;log&#34;</span>
    <span>}</span><span>,</span>
    <span>&#34;type&#34;</span> <span>=&gt;</span> <span>&#34;logs&#34;</span><span>,</span>
    <span>&#34;tags&#34;</span> <span>=&gt;</span> <span>[</span>
        <span>[</span><span>0</span><span>]</span> <span>&#34;beats_input_codec_plain_applied&#34;</span>
    <span>]</span><span>,</span>
    <span>&#34;@version&#34;</span> <span>=&gt;</span> <span>&#34;1&#34;</span><span>,</span>
    <span>&#34;ecs&#34;</span> <span>=&gt;</span> <span>{</span>
        <span>&#34;version&#34;</span> <span>=&gt;</span> <span>&#34;1.8.0&#34;</span>
    <span>}</span><span>,</span>
    <span>&#34;agent&#34;</span> <span>=&gt;</span> <span>{</span>
        <span>&#34;version&#34;</span> <span>=&gt;</span> <span>&#34;7.13.2&#34;</span><span>,</span>
        <span>&#34;name&#34;</span> <span>=&gt;</span> <span>&#34;Vulcan&#34;</span><span>,</span>
        <span>&#34;type&#34;</span> <span>=&gt;</span> <span>&#34;filebeat&#34;</span><span>,</span>
        <span>&#34;hostname&#34;</span> <span>=&gt;</span> <span>&#34;Vulcan&#34;</span><span>,</span>
        <span>&#34;ephemeral_id&#34;</span> <span>=&gt;</span> <span>&#34;94a3a0f3-165f-4308-8333-c1afbef0e016&#34;</span><span>,</span>
        <span>&#34;id&#34;</span> <span>=&gt;</span> <span>&#34;f1b9d79a-9cf0-4a51-b12f-29c41ed05f60&#34;</span>
    <span>}</span><span>,</span>
    <span>&#34;host&#34;</span> <span>=&gt;</span> <span>&#34;Vulcan&#34;</span>
<span>}</span></code></pre><ul><li>Finally, navigate to the <a href="http://localhost:5601/app/discover#" target="_blank" rel="noreferrer noopener">Kibana console</a>, and you will see the logs coming under the Logstash index:</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4zsSRslO3w8pF9M7MqKCNT/00d2235fa3de83250371feabb58ae1eb/elk_13.png" alt="Combined"/></p><h2 id="Separating-Logs-in-Kibana">Separating Logs in Kibana</h2><p>In a large-scale distributed environment, there are high chances that you would have to run multiple interlinked applications. To visualize logs of all of them under a single index can sometimes become very cumbersome.</p><p>To solve this, you can simply separate the logs of each application by different indexes depending on your use cases.</p><p>For doing this, you have to differentiate between multiple log files using the property <code>file<span>.</span>type</code> inside the <code>filebeat<span>.</span>yml</code>.</p><p>Let&#39;s look at that with an example - Suppose in your application you have a service that asynchronously calls a third-party API to fetch some data.</p><p>It makes sense if you want to monitor the logs for this process in a separate index because it is independent of your application, and any failure occurring in this service should not be accounted inside the rest of the application&#39;s failure.</p><p>To achieve this, you will have to process the logs of this new service in a separate log file. So let&#39;s first add another logger and appender inside the <code>logback<span>-</span>spring<span>.</span>xml</code> file.</p><pre><code><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span><span><span>&lt;</span>configuration</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>&#34;</span>STDOUT<span>&#34;</span></span> <span>class</span><span><span>=</span><span>&#34;</span>ch.qos.logback.core.ConsoleAppender<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>encoder</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>pattern</span><span>&gt;</span></span>%d{dd-MM-yyyy HH:mm:ss.SSS} %magenta([%thread]) %highlight(%-5level) %logger{36}.%M - %msg%n<span><span><span>&lt;/</span>pattern</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>encoder</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>appender</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>&#34;</span>SAVE-TO-FILE<span>&#34;</span></span> <span>class</span><span><span>=</span><span>&#34;</span>ch.qos.logback.core.FileAppender<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>file</span><span>&gt;</span></span>logs/application.log<span><span><span>&lt;/</span>file</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>encoder</span> <span>class</span><span><span>=</span><span>&#34;</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span>&#34;</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>Pattern</span><span>&gt;</span></span>%d{dd-MM-yyyy HH:mm:ss.SSS} [%thread] %-5level %logger{36}.%M - %msg%n<span><span><span>&lt;/</span>Pattern</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>encoder</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>appender</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>appender</span> <span>name</span><span><span>=</span><span>&#34;</span>OUTBOUND_LOGS<span>&#34;</span></span> <span>class</span><span><span>=</span><span>&#34;</span>ch.qos.logback.core.FileAppender<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>file</span><span>&gt;</span></span>logs/application-outbound.log<span><span><span>&lt;/</span>file</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>encoder</span> <span>class</span><span><span>=</span><span>&#34;</span>ch.qos.logback.classic.encoder.PatternLayoutEncoder<span>&#34;</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>Pattern</span><span>&gt;</span></span>%d{dd-MM-yyyy HH:mm:ss.SSS} [%thread] %-5level %logger{36}.%M - %msg%n<span><span><span>&lt;/</span>Pattern</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>encoder</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>appender</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>logger</span> <span>name</span><span><span>=</span><span>&#34;</span>com.demo.ELK<span>&#34;</span></span> <span>additivity</span><span><span>=</span><span>&#34;</span>false<span>&#34;</span></span> <span>level</span><span><span>=</span><span>&#34;</span>info<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>&#34;</span>SAVE-TO-FILE<span>&#34;</span></span> <span>/&gt;</span></span>
        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>&#34;</span>STDOUT<span>&#34;</span></span> <span>/&gt;</span></span>
    <span><span><span>&lt;/</span>logger</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>logger</span> <span>name</span><span><span>=</span><span>&#34;</span>outbound-logs<span>&#34;</span></span> <span>additivity</span><span><span>=</span><span>&#34;</span>false<span>&#34;</span></span> <span>level</span><span><span>=</span><span>&#34;</span>info<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>&#34;</span>OUTBOUND_LOGS<span>&#34;</span></span> <span>/&gt;</span></span>
        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>&#34;</span>STDOUT<span>&#34;</span></span> <span>/&gt;</span></span>
    <span><span><span>&lt;/</span>logger</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>root</span> <span>level</span><span><span>=</span><span>&#34;</span>INFO<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>appender-ref</span> <span>ref</span><span><span>=</span><span>&#34;</span>STDOUT<span>&#34;</span></span> <span>/&gt;</span></span>
    <span><span><span>&lt;/</span>root</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>configuration</span><span>&gt;</span></span></code></pre><p>Here you have added another appender and logger by the name <code>outbound<span>-</span>logs</code> and have specified a different file name to print your logs in.</p><p>To use this inside your application, you have to initialize the logger object like this: 
<code>Logger log <span>=</span> LoggerFactory<span>.</span><span>getLogger</span><span>(</span><span>&#34;outbound-logs&#34;</span><span>)</span></code></p><p>Now let&#39;s apply it inside one of your services:</p><pre><code><span>package</span> <span>com<span>.</span>demo<span>.</span></span>ELK<span>.</span>services<span>;</span>

<span>import</span> <span>com<span>.</span>fasterxml<span>.</span>jackson<span>.</span>databind<span>.</span></span><span>JsonNode</span><span>;</span>
<span>import</span> <span>com<span>.</span>fasterxml<span>.</span>jackson<span>.</span>databind<span>.</span></span><span>ObjectMapper</span><span>;</span>
<span>import</span> <span>org<span>.</span>slf4j<span>.</span></span><span>Logger</span><span>;</span>
<span>import</span> <span>org<span>.</span>slf4j<span>.</span></span><span>LoggerFactory</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>boot<span>.</span>web<span>.</span>client<span>.</span></span><span>RestTemplateBuilder</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>stereotype<span>.</span></span><span>Service</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>client<span>.</span></span><span>RestTemplate</span><span>;</span>

<span>@Service</span>
<span>public</span> <span>class</span> <span>RestService</span> <span>{</span>
    
    <span>// Initializing logger with new appender</span>
    <span>private</span> <span>static</span> <span>final</span> <span>Logger</span> log <span>=</span> <span>LoggerFactory</span><span>.</span><span>getLogger</span><span>(</span><span>&#34;outbound-logs&#34;</span><span>)</span><span>;</span>
    
    <span>private</span> <span>final</span> <span>RestTemplate</span> restTemplate<span>;</span>
    <span>private</span> <span>final</span> <span>String</span> BASE_URL <span>=</span> <span>&#34;https://goweather.herokuapp.com/weather/&#34;</span><span>;</span>

    <span>public</span> <span>RestService</span><span>(</span><span>RestTemplateBuilder</span> restTemplateBuilder<span>)</span> <span>{</span>
        <span>this</span><span>.</span>restTemplate <span>=</span> restTemplateBuilder<span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>JsonNode</span> <span>getPostsPlainJSON</span><span>(</span><span>String</span> city<span>)</span> <span>{</span>
        log<span>.</span><span>info</span><span>(</span><span>&#34;Getting Weather Information for {}&#34;</span><span>,</span>city<span>)</span><span>;</span>
        <span>String</span> url <span>=</span> BASE_URL <span>+</span> city<span>;</span>
        log<span>.</span><span>info</span><span>(</span><span>&#34;Final URL =&gt; {}&#34;</span><span>,</span>url<span>)</span><span>;</span>
        <span>try</span> <span>{</span>
            <span>String</span> response <span>=</span> <span>this</span><span>.</span>restTemplate<span>.</span><span>getForObject</span><span>(</span>url<span>,</span> <span>String</span><span>.</span><span>class</span><span>)</span><span>;</span>
            <span>ObjectMapper</span> mapper <span>=</span> <span>new</span> <span>ObjectMapper</span><span>(</span><span>)</span><span>;</span>
            log<span>.</span><span>info</span><span>(</span><span>&#34;Response =&gt; {}&#34;</span><span>,</span>response<span>)</span><span>;</span>
            <span>return</span> mapper<span>.</span><span>readTree</span><span>(</span>response<span>)</span><span>;</span>
        <span>}</span> <span>catch</span> <span>(</span><span>Exception</span> e<span>)</span> <span>{</span>
            log<span>.</span><span>info</span><span>(</span><span>&#34;Error occurred in Outbound Request... =&gt; {}&#34;</span><span>,</span>e<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>}</span>
        <span>return</span> <span>null</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Everything that you log in to this service will go to the <code>application<span>-</span>outbound<span>.</span>log</code> file.</p><p>Let&#39;s create another endpoint in your controller class to test it:</p><pre><code><span>@GetMapping</span><span>(</span>value <span>=</span> <span>&#34;/weather/{city}&#34;</span><span>)</span>
<span>public</span> <span>JsonNode</span> <span>getWeatherInformation</span><span>(</span><span>@PathVariable</span> <span>String</span> city<span>)</span><span>{</span>
   <span>return</span> restService<span>.</span><span>getPostsPlainJSON</span><span>(</span>city<span>)</span><span>;</span>
<span>}</span></code></pre><p>Finally, let&#39;s invoke it using HTTP GET method, e.g.: <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>api<span>/</span>weather<span>/</span>ohio</code></p><pre><code><span>{</span>
    <span>&#34;temperature&#34;</span><span>:</span> <span>&#34;+33 ¬∞C&#34;</span><span>,</span>
    <span>&#34;wind&#34;</span><span>:</span> <span>&#34;14 km/h&#34;</span><span>,</span>
    <span>&#34;description&#34;</span><span>:</span> <span>&#34;Partly cloudy&#34;</span><span>,</span>
    <span>&#34;forecast&#34;</span><span>:</span> <span>[</span>
        <span>{</span>
            <span>&#34;day&#34;</span><span>:</span> <span>&#34;1&#34;</span><span>,</span>
            <span>&#34;temperature&#34;</span><span>:</span> <span>&#34;+38 ¬∞C&#34;</span><span>,</span>
            <span>&#34;wind&#34;</span><span>:</span> <span>&#34;17 km/h&#34;</span>
        <span>}</span><span>,</span>
        <span>{</span>
            <span>&#34;day&#34;</span><span>:</span> <span>&#34;2&#34;</span><span>,</span>
            <span>&#34;temperature&#34;</span><span>:</span> <span>&#34;37 ¬∞C&#34;</span><span>,</span>
            <span>&#34;wind&#34;</span><span>:</span> <span>&#34;14 km/h&#34;</span>
        <span>}</span><span>,</span>
        <span>{</span>
            <span>&#34;day&#34;</span><span>:</span> <span>&#34;3&#34;</span><span>,</span>
            <span>&#34;temperature&#34;</span><span>:</span> <span>&#34;+39 ¬∞C&#34;</span><span>,</span>
            <span>&#34;wind&#34;</span><span>:</span> <span>&#34;22 km/h&#34;</span>
        <span>}</span>
    <span>]</span>
<span>}</span></code></pre><p>With this, you should see the new logs being printed inside the <code>application<span>-</span>outbound<span>.</span>log</code> file in your logs folder:</p><pre><code><span>22</span><span>-</span><span>08</span><span>-</span><span>2021</span> <span>22</span><span>:</span><span>03</span><span>:</span><span>38.328</span> <span>[</span>http<span>-</span>nio<span>-</span><span>8080</span><span>-</span>exec<span>-</span><span>6</span><span>]</span> <span>INFO</span>  outbound<span>-</span>logs<span>.</span>getPostsPlainJSON <span>-</span> Getting Weather Information <span>for</span> ohio
<span>22</span><span>-</span><span>08</span><span>-</span><span>2021</span> <span>22</span><span>:</span><span>03</span><span>:</span><span>38.330</span> <span>[</span>http<span>-</span>nio<span>-</span><span>8080</span><span>-</span>exec<span>-</span><span>6</span><span>]</span> <span>INFO</span>  outbound<span>-</span>logs<span>.</span>getPostsPlainJSON <span>-</span> Final <span><span>URL</span></span> <span>=&gt;</span> https<span>:</span><span>/</span><span>/</span>goweather<span>.</span>herokuapp<span>.</span>com<span>/</span>weather<span>/</span>ohio
<span>22</span><span>-</span><span>08</span><span>-</span><span>2021</span> <span>22</span><span>:</span><span>03</span><span>:</span><span>39.912</span> <span>[</span>http<span>-</span>nio<span>-</span><span>8080</span><span>-</span>exec<span>-</span><span>6</span><span>]</span> <span>INFO</span>  outbound<span>-</span>logs<span>.</span>getPostsPlainJSON <span>-</span> <span>Response</span> <span>=&gt;</span> <span>{</span><span>&#34;temperature&#34;</span><span>:</span><span>&#34;+33 ¬∞C&#34;</span><span>,</span><span>&#34;wind&#34;</span><span>:</span><span>&#34;14 km/h&#34;</span><span>,</span><span>&#34;description&#34;</span><span>:</span><span>&#34;Partly cloudy&#34;</span><span>,</span><span>&#34;forecast&#34;</span><span>:</span><span>[</span><span>{</span><span>&#34;day&#34;</span><span>:</span><span>&#34;1&#34;</span><span>,</span><span>&#34;temperature&#34;</span><span>:</span><span>&#34;+38 ¬∞C&#34;</span><span>,</span><span>&#34;wind&#34;</span><span>:</span><span>&#34;17 km/h&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;day&#34;</span><span>:</span><span>&#34;2&#34;</span><span>,</span><span>&#34;temperature&#34;</span><span>:</span><span>&#34;37 ¬∞C&#34;</span><span>,</span><span>&#34;wind&#34;</span><span>:</span><span>&#34;14 km/h&#34;</span><span>}</span><span>,</span><span>{</span><span>&#34;day&#34;</span><span>:</span><span>&#34;3&#34;</span><span>,</span><span>&#34;temperature&#34;</span><span>:</span><span>&#34;+39 ¬∞C&#34;</span><span>,</span><span>&#34;wind&#34;</span><span>:</span><span>&#34;22 km/h&#34;</span><span>}</span><span>]</span><span>}</span></code></pre><h3 id="Modifying-Filebeat-and-Creating-Custom-Index-Pattern">Modifying Filebeat and Creating Custom Index Pattern</h3><p>Next, you also have to change your <code>filebeat<span>.</span>yml</code> to fetch the data from two different locations. </p><p>This is an important section where you will also learn how to create custom indexes instead of using the default ones that Filebeat generates.</p><p>An <strong>IMPORTANT</strong> thing to note here is that you have to disable ILM(Index Lifecycle Management) for using the custom indexes. (This is not mentioned in any elastic documentation but is a very important step)</p><p>ILM is nothing but the policy to manage indices according to the performance requirements. If this is enabled (which is true by default), you&#39;ll not be able to give any custom name to the index.</p><p>You also have to set the value for <code>setup<span>.</span>template<span>.</span>name</code> and <code>setup<span>.</span>template<span>.</span>pattern</code> to modify the index name.</p><p>By default, Filebeat creates index in pattern: ‚Äúfilebeat-%{[version]}-%{+yyyy.MM.dd}‚Äù. </p><p>To change this format, inside <code>setup<span>.</span>template<span>.</span>name</code> you have to set your custom index name like &#34;myapp&#34; and inside <code>setup<span>.</span>template<span>.</span>pattern</code> you have to put the same custom index name that you provided, followed by a hyphen(-) and asterisk (*), e.g., myapp-*</p><pre><code>filebeat<span>.</span>inputs<span>:</span>
  <span>-</span> type<span>:</span> log
    enabled<span>:</span> <span>true</span>
    fields<span>:</span>
        type<span>:</span> <span>&#34;service_logs&#34;</span>
    paths<span>:</span>
        <span>-</span> <span>/</span><span>ELK</span><span>/</span>logs<span>/</span>application<span>.</span>log  # Absolute path <span>of</span> application<span>.</span>log file
  <span>-</span> type<span>:</span> log
    enabled<span>:</span> <span>true</span>
    fields<span>:</span>
        type<span>:</span> <span>&#34;outbound_logs&#34;</span>
    paths<span>:</span>
        <span>-</span> <span>/</span><span>ELK</span><span>/</span>logs<span>/</span>application<span>-</span>outbound<span>.</span>log  # Absolute path <span>of</span> application<span>-</span>outbound<span>.</span>log file

setup<span>.</span>ilm<span>.</span>enabled<span>:</span> <span>false</span>
setup<span>.</span>template<span>.</span>name<span>:</span> <span>&#34;myapp-%{[fields.type]:other}&#34;</span>
setup<span>.</span>template<span>.</span>pattern<span>:</span> <span>&#34;myapp-%{[fields.type]:other}-*&#34;</span>

output<span>.</span>elasticsearch<span>:</span>
  hosts<span>:</span> <span>[</span><span>&#34;localhost:9200&#34;</span><span>]</span>
  protocol<span>:</span> <span>&#34;http&#34;</span>
  index<span>:</span> <span>&#34;myapp-%{[fields.type]:other}-%{+yyyy.MM.dd}&#34;</span></code></pre><p>In Filebeat configuration, you have to use <code>fields<span>.</span>type</code> to distinguish among the different inputs from where you&#39;re fetching the data in case of multiple inputs.</p><p>Now go to the <a href="http://localhost:9200/_cat/indices" target="_blank" rel="noreferrer noopener">Elasticsearch indices</a>, and you&#39;ll see two new additional indexes starting with the name &#34;myapp&#34; followed by their respective values of <code>fields<span>.</span>type</code>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/34wU3NOVwfT7iovbKF2AvK/98a5d87a72c016b4ce252ded9f900f97/elk_14.png" alt="Indexes_myapp"/></p><p>Create these two new patterns inside your <a href="http://localhost:5601/app/management/kibana/indexPatterns" target="_blank" rel="noreferrer noopener">Kibana index pattern management</a> console by the name <code>myapp<span>-</span>outbound_logs<span>-</span><span>*</span></code> and <code>myapp<span>-</span>service_logs<span>-</span><span>*</span></code>.</p><p>Next, hit the REST APIs again, and you should be able to view the logs of your applications in separate indexes depending on the API you are hitting.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2IE0qGNm79KxHRpt2U5dnI/1501124e0a2be6307c630973ae13c827/elk_15.png" alt="Myapp_Logs"/></p><h2 id="Summary">Summary</h2><p>For any developer, logs are the most critical way for debugging. ELK Stack simplifies the delivery of logs in a centralized and scalable way. This article was an introduction to how it all works. </p><ul><li>You have gone through the step-by-step process of sending out Spring Boot application logs to the Elastic Stack(ELK).</li><li>You got introduced to Filebeat and learned about the advantages and disadvantages of Filebeat and Logstash as log shippers.</li><li>You learned how to create custom index patterns through a Filebeat configuration.</li><li>You also got the hang of how you can manage logs of different services of the same applications by putting them in separate indexes.</li></ul><p><em>The complete code used in this tutorial is available on this <a href="https://github.com/ApoorvTyagi/Spring-ELK" target="_blank" rel="noreferrer noopener">GitHub repository</a></em>.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 30 Sep 2021 14:53:00 +0000</pubDate>
    </item>
    <item>
      <title>Create an API in Swift and Deploy It to AWS Lambda</title>
      <link>https://auth0.com/blog/create-an-api-in-swift-and-deploy-it-to-aws-lambda/</link>
      <description>Learn how to create and deploy a serverless HTTP API using Swift and AWS Lambda.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In almost every real mobile application, we are probably going to need a backend side where our business logic will be handled. In most cases, there will be two different teams, one for mobile and one for the backend side of the project. But, what if we, as iOS developers, could write our own backend in our preferred language? Let&#39;s explore in this article how we can achieve this using Swift AWS Lambda Runtime together with AWS Lambda.</p><h2 id="What-is-AWS-Lambda-">What is AWS Lambda?</h2><p>In simple terms, it is a service provider by AWS in which we can run our code without the need to configure and manage a server. We just upload our code as a zip file, and AWS automatically does all the configurations needed in the server to make our software available.</p><p>One of the main differences between this approach and having a dedicated server, in addition to simpler administration, is that if at some point we need to increase our processing power to scale up our application, AWS Lambda does that automatically for us if we design the application correctly.</p><p>You can check out more at this <a href="https://aws.amazon.com/lambda/" target="_blank" rel="noreferrer noopener">link</a>.</p><h2 id="Swift-AWS-Lambda-Runtime">Swift AWS Lambda Runtime</h2><p>A custom AWS Lambda runtime is basically a library that is in charge of managing and executing the Lambda function&#39;s code when it is called. With <a href="https://swift.org/blog/aws-lambda-runtime/" target="_blank" rel="noreferrer noopener">Swift AWS Lambda Runtime</a>, we can now write serverless code in Swift and make it ready for use with AWS Lambda service.</p><h2 id="Creating-Our-HTTP-API">Creating Our HTTP API</h2><p>For this tutorial, we will create a simple HTTP API in Swift and expose it through <a href="https://aws.amazon.com/api-gateway/" target="_blank" rel="noreferrer noopener">API Gateway</a>, which is another service available in AWS suite that allows us to expose our Lambda function as HTTP endpoints.</p><h3 id="Prerequisites">Prerequisites</h3><ul><li>Have XCode installed</li><li>Have an AWS account.</li><li>Have an Auth0 account.</li><li>Have Docker installed in your machine to compile the code that we will upload to AWS.</li></ul><h3 id="Step-1--Defining-the-API">Step 1: Defining the API</h3><p>We&#39;re going to create a simple API to handle a simple todo list with three operations:</p><ul><li><code><span>POST</span> <span>/</span>todoitem</code> Create a new todo item.</li><li><code><span>GET</span> <span>/</span>todoitems</code> Return all the items in the list.</li><li><code><span>GET</span> <span>/</span>todoitems<span>/</span><span>:</span>id</code> Return a specific item in the list.</li></ul><p>Just to simplify things, our TodoItem will only have an id and a description.</p><pre><code><span>struct</span> <span>ToDoItem</span> <span>{</span>
    <span>var</span> id<span>:</span> <span>Int</span>
    <span>let</span> description<span>:</span> <span>String</span>
<span>}</span></code></pre><h3 id="Step-2--Setup-the-project">Step 2: Setup the project</h3><p>The next thing we need to do is create our project. In this case, we need to create a new <a href="https://swift.org/package-manager/" target="_blank" rel="noreferrer noopener">Swift Package</a>. To do this, we can open Xcode and go to <strong>File ‚Üí New ‚Üí Swift Package</strong> option and name it <strong>ToDoList-API</strong>. We can also create it from the console by running the following command: <code>$ swift <span>package</span> init <span>--</span>type executable</code>.</p><p>Once that we have our project created, let&#39;s open and modify our <strong>Package.swift</strong> file with all the information needed.</p><pre><code><span>// swift-tools-version:5.3</span>
<span>// The swift-tools-version declares the minimum version of Swift required to build this package.</span>

<span>import</span> <span>PackageDescription</span>

<span>let</span> package <span>=</span> <span>Package</span><span>(</span>
    name<span>:</span> <span>&#34;ToDoList-API&#34;</span><span>,</span>
    platforms<span>:</span> <span>[</span>
        <span>.</span><span>macOS</span><span>(</span><span>.</span>v10_15<span>)</span>
    <span>]</span><span>,</span>
    products<span>:</span> <span>[</span>
        <span>.</span><span>executable</span><span>(</span>name<span>:</span> <span>&#34;ToDoList-API&#34;</span><span>,</span> targets<span>:</span> <span>[</span><span>&#34;ToDoList-API&#34;</span><span>]</span><span>)</span><span>,</span>
    <span>]</span><span>,</span>
    dependencies<span>:</span> <span>[</span>
        <span>.</span><span>package</span><span>(</span>url<span>:</span> <span>&#34;https://github.com/swift-server/swift-aws-lambda-runtime.git&#34;</span><span>,</span> <span>.</span><span>upToNextMajor</span><span>(</span>from<span>:</span><span>&#34;0.3.0&#34;</span><span>)</span><span>)</span><span>,</span>
    <span>]</span><span>,</span>
    targets<span>:</span> <span>[</span>
        <span>.</span><span>target</span><span>(</span>
            name<span>:</span> <span>&#34;ToDoList-API&#34;</span><span>,</span>
            dependencies<span>:</span> <span>[</span>
                <span>.</span><span>product</span><span>(</span>name<span>:</span> <span>&#34;AWSLambdaRuntime&#34;</span><span>,</span> package<span>:</span> <span>&#34;swift-aws-lambda-runtime&#34;</span><span>)</span><span>,</span>
                <span>.</span><span>product</span><span>(</span>name<span>:</span> <span>&#34;AWSLambdaEvents&#34;</span><span>,</span> package<span>:</span> <span>&#34;swift-aws-lambda-runtime&#34;</span><span>)</span><span>,</span>
            <span>]</span><span>,</span>
            resources<span>:</span> <span>[</span>
                <span>.</span><span>process</span><span>(</span><span>&#34;Config.plist&#34;</span><span>)</span>
            <span>]</span>
        <span>)</span><span>,</span>
    <span>]</span>
<span>)</span></code></pre><p>Once you save the file, Xcode will start downloading all the needed resources and dependencies. For this example, we&#39;re going to use two dependencies:</p><ul><li><strong>AWSLambdaRuntime</strong> to handle the communications with <a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-api.html" target="_blank" rel="noreferrer noopener">AWS Lambda runtime API</a>.</li><li><strong>AWSLambdaEvents</strong> to handle the events with API Gateway in our code.</li></ul><h3 id="Step-3--Create-our-first-Lambda-function">Step 3: Create our first Lambda function</h3><p>We now have to develop our Lambda function. To do so, we must create a new file inside the <code><span>/</span>Source</code> directory and name it <strong>main.swift</strong>. Inside this file, we&#39;ll use the Swift Lambda Runtime by calling <code>Lambda<span>.</span>run</code> function. This function takes an input and a callback as parameters. We can use the callback to return whatever we want if the operation is successful or an error otherwise.</p><p>For every invocation that Lambada receives, our Runtime will execute whatever we put inside the <code>Lambda<span>.</span>run</code> function. In this case, we are going to take just a string as input and return a greeting message.</p><pre><code><span>import</span> <span>AWSLambdaRuntime</span>

<span>struct</span> <span>Input</span><span>:</span> <span>Codable</span> <span>{</span>
  <span>let</span> name<span>:</span> <span>String</span>
<span>}</span>

<span>struct</span> <span>Output</span><span>:</span> <span>Codable</span> <span>{</span>
  <span>let</span> greeting<span>:</span> <span>String</span>
<span>}</span>

<span>Lambda</span><span>.</span>run <span>{</span> <span>(</span>context<span>,</span> input<span>:</span> <span>Input</span><span>,</span> callback<span>:</span> @escaping <span>(</span><span>Result</span><span>&lt;</span><span>Output</span><span>,</span> <span>Error</span><span>&gt;</span><span>)</span> <span>-</span><span>&gt;</span> <span>Void</span><span>)</span> <span>in</span>
  <span>callback</span><span>(</span><span>.</span><span>success</span><span>(</span><span>Output</span><span>(</span>greeting<span>:</span> <span>&#34;Hello <span><span>\(</span>input<span>.</span>name<span>)</span></span>&#34;</span><span>)</span><span>)</span><span>)</span>
<span>}</span></code></pre><p>In order to run our lambda in our machine, we need to add a custom environment variable (<code><span>LOCAL_LAMBDA_SERVER_ENABLED</span><span>=</span><span>true</span></code>) to our scheme&#39;s run settings. This will simulate the Lambda server in our local environment. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/42lm5qsyLdzZ9sVnvs6Ipn/c177634055ba4886f3863e6a4232d4fb/swift_lambda_01.png" alt="Enable AWS Lambda local"/></p><p>Now, if we run the target, we will get something like this in the console:</p><pre><code><span>2021</span><span>-</span><span>08</span><span>-</span>14T23<span>:</span><span>36</span><span>:</span><span>50</span><span>-</span><span>0300</span> info <span>LocalLambdaServer</span> <span>:</span> <span>LocalLambdaServer</span> started and listening on <span>127.0</span><span>.</span><span>0.1</span><span>:</span><span>7000</span><span>,</span> receiving events on <span>/</span>invoke
<span>2021</span><span>-</span><span>08</span><span>-</span>14T23<span>:</span><span>36</span><span>:</span><span>50</span><span>-</span><span>0300</span> info <span>Lambda</span> <span>:</span> lambda lifecycle starting with <span>Configuration</span>
  <span>General</span><span>(</span>logLevel<span>:</span> info<span>)</span><span>)</span>
  <span>Lifecycle</span><span>(</span>id<span>:</span> <span>9908899204653</span><span>,</span> maxTimes<span>:</span> <span>0</span><span>,</span> stopSignal<span>:</span> <span>TERM</span><span>)</span>
  <span>RuntimeEngine</span><span>(</span>ip<span>:</span> <span>127.0</span><span>.</span><span>0.1</span><span>,</span> port<span>:</span> <span>7000</span><span>,</span> requestTimeout<span>:</span> <span>nil</span></code></pre><p>This means that our Lambda function is running on port <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>700</span><span>/</span>invoke</code>. So let&#39;s go ahead and make our first request to the function.</p><pre><code>$ curl \
    <span>--</span>header <span>&#34;Content-Type: application/json&#34;</span> \
  <span>--</span>request <span>POST</span> \
  <span>--</span>data <span>&#39;{&#34;name&#34;: &#34;Bruno&#34;}&#39;</span> \
  http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7000</span><span>/</span>invoke</code></pre><p>If we are getting something like this: <code>$ <span>{</span><span>&#34;greeting&#34;</span><span>:</span><span>&#34;Hello Bruno&#34;</span><span>}</span></code>, it means that we did everything right so far!.</p><p>We have our first function up and running, so we are in a pretty good spot to move on and create our HTTP API.</p><h3 id="Step-4--Create-HTTP-API">Step 4: Create HTTP API</h3><p>Let&#39;s start by creating the model that we are going to deal with. Since we&#39;re going to return static data, we&#39;ll create some helpers functions as well. Go ahead and create a new file  <strong>TodoItem.swift</strong> inside <strong>Sources/ToDoList-API</strong>.</p><pre><code><span>struct</span> <span>ToDoItem</span><span>:</span> <span>Codable</span> <span>{</span>
    <span>let</span> id<span>:</span> <span>Int</span>
    <span>let</span> description<span>:</span> <span>String</span>
<span>}</span>

<span>// MARK: - Static helpers</span>

<span>extension</span> <span>ToDoItem</span> <span>{</span>
    <span>static</span> <span>func</span> <span>getToDoList</span><span>(</span><span>)</span> <span>-</span><span>&gt;</span> <span>[</span><span>ToDoItem</span><span>]</span> <span>{</span>
        <span>var</span> list <span>=</span> <span>[</span><span>ToDoItem</span><span>]</span><span>(</span><span>)</span>
        list<span>.</span><span>append</span><span>(</span><span>.</span><span>init</span><span>(</span>id<span>:</span> <span>1</span><span>,</span> description<span>:</span> <span>&#34;Pay credit card&#34;</span><span>)</span><span>)</span>
        list<span>.</span><span>append</span><span>(</span><span>.</span><span>init</span><span>(</span>id<span>:</span> <span>2</span><span>,</span> description<span>:</span> <span>&#34;Clean apartment&#34;</span><span>)</span><span>)</span>
        list<span>.</span><span>append</span><span>(</span><span>.</span><span>init</span><span>(</span>id<span>:</span> <span>3</span><span>,</span> description<span>:</span> <span>&#34;Call John&#34;</span><span>)</span><span>)</span>

        <span>return</span> list
    <span>}</span>

    <span>static</span> <span>func</span> <span>getItem</span><span>(</span>with id<span>:</span> <span>Int</span><span>)</span> <span>-</span><span>&gt;</span> <span>ToDoItem</span><span>?</span> <span>{</span>
        <span>return</span> <span>getToDoList</span><span>(</span><span>)</span><span>.</span><span>filter</span><span>{</span> $<span>0</span><span>.</span>id <span>==</span> id <span>}</span><span>.</span><span>first</span>
    <span>}</span>
<span>}</span></code></pre><p>The next thing we need to do is adjust our Lambda function to interact with APIGateway. For this, we are going to use two types included in <strong>AWSLambdaEvents</strong> for our function&#39;s input and output:</p><ul><li>APIGateway.V2.Request</li><li>APIGateway.V2.Response</li></ul><p>Make the following changes inside our <strong>main.swift</strong> file.</p><pre><code><span>typealias</span> <span>In</span> <span>=</span> <span>APIGateway</span><span>.</span><span>V2</span><span>.</span><span>Request</span>
<span>typealias</span> <span>Out</span> <span>=</span> <span>APIGateway</span><span>.</span><span>V2</span><span>.</span><span>Response</span>

<span>Lambda</span><span>.</span>run <span>{</span> <span>(</span>context<span>,</span> 
              request<span>:</span> <span>In</span><span>,</span> 
              callback<span>:</span> @escaping <span>(</span><span>Result</span><span>&lt;</span><span>Out</span><span>,</span> <span>Error</span><span>&gt;</span><span>)</span> <span>-</span><span>&gt;</span> <span>Void</span><span>)</span> <span>in</span>
    <span>// Implementation... </span>
<span>}</span></code></pre><p>So we receive an <strong>APIGateway.V2.Request</strong> type as an input, and we must return an <strong>APIGateway.V2.Response</strong> type as an output. However, we want to obtain a <strong>ToDoItem</strong> type when we receive a <code><span>POST</span></code>, and we want to return a <strong>TodoItem</strong> type if we receive a <code><span>GET</span></code>.</p><p>Both types, <strong>APIGateway.V2.Request</strong> and <strong>APIGateway.V2.Response,</strong> have a body property in which we will receive and send the payload from our endpoints. This property is a String type, so we must do some transformation using an <a href="https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types" target="_blank" rel="noreferrer noopener">encoder</a> (or decoder in the case we want to return something) in order to use our Swift type before sending it back or before start processing it. </p><p>The only missing part in our code design is how we distinguish between different routes and methods. We can access the endpoint path from our request type. In our example, we are only going to have one path: <code><span>/</span>todoitems</code>. If we get another path, we should return a 404 error.</p><p>Let&#39;s put all the pieces together and modify our lambda function.</p><pre><code><span>import</span> <span>Foundation</span>
<span>import</span> <span>AWSLambdaRuntime</span>
<span>import</span> <span>AWSLambdaEvents</span>

<span>typealias</span> <span>In</span> <span>=</span> <span>APIGateway</span><span>.</span><span>V2</span><span>.</span><span>Request</span>
<span>typealias</span> <span>Out</span> <span>=</span> <span>APIGateway</span><span>.</span><span>V2</span><span>.</span><span>Response</span>

<span>Lambda</span><span>.</span>run <span>{</span> <span>(</span>context<span>,</span>
              request<span>:</span> <span>In</span><span>,</span>
              callback<span>:</span> @escaping <span>(</span><span>Result</span><span>&lt;</span><span>Out</span><span>,</span> <span>Error</span><span>&gt;</span><span>)</span> <span>-</span><span>&gt;</span> <span>Void</span><span>)</span> <span>in</span>
    
    <span>let</span> routeKey <span>=</span> request<span>.</span>routeKey
    
    <span>switch</span> routeKey <span>{</span>
    
    <span>case</span> <span>&#34;GET /todoitems&#34;</span><span>:</span>
        <span>let</span> items <span>=</span> <span>ToDoItem</span><span>.</span><span>getToDoList</span><span>(</span><span>)</span>
        <span>let</span> bodyOutput <span>=</span> <span>try</span><span>!</span> <span>JSONEncoder</span><span>(</span><span>)</span><span>.</span><span>encodeAsString</span><span>(</span>items<span>)</span>
        <span>let</span> output <span>=</span> <span>Out</span><span>(</span>statusCode<span>:</span> <span>.</span>ok<span>,</span> headers<span>:</span> <span>[</span><span>&#34;content-type&#34;</span><span>:</span> <span>&#34;application/json&#34;</span><span>]</span><span>,</span> body<span>:</span> bodyOutput<span>)</span>
        <span>callback</span><span>(</span><span>.</span><span>success</span><span>(</span>output<span>)</span><span>)</span>
        
    <span>case</span> <span>&#34;GET /todoitems/{id}&#34;</span><span>:</span>
        <span>if</span> <span>let</span> idString <span>=</span> request<span>.</span>pathParameters<span>?</span><span>[</span><span>&#34;id&#34;</span><span>]</span><span>,</span> <span>let</span> id <span>=</span> <span>Int</span><span>(</span>idString<span>)</span><span>,</span>
           <span>let</span> item <span>=</span> <span>ToDoItem</span><span>.</span><span>getItem</span><span>(</span>with<span>:</span> id<span>)</span> <span>{</span>
            
            <span>let</span> bodyOutput <span>=</span> <span>try</span><span>!</span> <span>JSONEncoder</span><span>(</span><span>)</span><span>.</span><span>encodeAsString</span><span>(</span>item<span>)</span>
            <span>let</span> output <span>=</span> <span>Out</span><span>(</span>statusCode<span>:</span> <span>.</span>ok<span>,</span> headers<span>:</span> <span>[</span><span>&#34;content-type&#34;</span><span>:</span> <span>&#34;application/json&#34;</span><span>]</span><span>,</span> body<span>:</span> bodyOutput<span>)</span>
            <span>callback</span><span>(</span><span>.</span><span>success</span><span>(</span>output<span>)</span><span>)</span>
        <span>}</span> <span>else</span> <span>{</span>
            <span>callback</span><span>(</span><span>.</span><span>success</span><span>(</span><span>Out</span><span>(</span>statusCode<span>:</span> <span>.</span>notFound<span>)</span><span>)</span><span>)</span>
        <span>}</span>
        
    <span>case</span> <span>&#34;POST /todoitems&#34;</span><span>:</span>
        <span>do</span> <span>{</span>
            <span>let</span> input <span>=</span> <span>try</span> <span>JSONDecoder</span><span>(</span><span>)</span><span>.</span><span>decode</span><span>(</span><span>ToDoItem</span><span>.</span><span>self</span><span>,</span> from<span>:</span> request<span>.</span>body <span>?</span><span>?</span> <span>&#34;&#34;</span><span>)</span>
            <span>let</span> bodyOutput <span>=</span> <span>try</span> <span>JSONEncoder</span><span>(</span><span>)</span><span>.</span><span>encodeAsString</span><span>(</span>input<span>)</span>
            <span>let</span> output <span>=</span> <span>Out</span><span>(</span>statusCode<span>:</span> <span>.</span>ok<span>,</span> headers<span>:</span> <span>[</span><span>&#34;content-type&#34;</span><span>:</span> <span>&#34;application/json&#34;</span><span>]</span><span>,</span> body<span>:</span> bodyOutput<span>)</span>
            <span>callback</span><span>(</span><span>.</span><span>success</span><span>(</span>output<span>)</span><span>)</span>
        <span>}</span> <span>catch</span> <span>{</span>
            <span>callback</span><span>(</span><span>.</span><span>success</span><span>(</span><span>Out</span><span>(</span>statusCode<span>:</span> <span>.</span>badRequest<span>)</span><span>)</span><span>)</span>
        <span>}</span>
        
    <span>default</span><span>:</span>
        <span>callback</span><span>(</span><span>.</span><span>success</span><span>(</span><span>Out</span><span>(</span>statusCode<span>:</span> <span>.</span>notFound<span>)</span><span>)</span><span>)</span>
    <span>}</span>
<span>}</span>

<span>// ---------------</span>

<span>extension</span> <span>JSONEncoder</span> <span>{</span>
    <span>func</span> encodeAsString<span>&lt;</span>T<span>:</span> <span>Encodable</span><span>&gt;</span><span>(</span><span>_</span> value<span>:</span> T<span>)</span> <span>throws</span> <span>-</span><span>&gt;</span> <span>String</span> <span>{</span>
        <span>try</span> <span>String</span><span>(</span>decoding<span>:</span> <span>self</span><span>.</span><span>encode</span><span>(</span>value<span>)</span><span>,</span> <span>as</span><span>:</span> <span>Unicode</span><span>.</span><span>UTF8</span><span>.</span><span>self</span><span>)</span>
    <span>}</span>
<span>}</span>

<span>extension</span> <span>JSONDecoder</span> <span>{</span>
    <span>func</span> decode<span>&lt;</span>T<span>:</span> <span>Decodable</span><span>&gt;</span><span>(</span><span>_</span> type<span>:</span> T<span>.</span><span>Type</span><span>,</span> from string<span>:</span> <span>String</span><span>)</span> <span>throws</span> <span>-</span><span>&gt;</span> T <span>{</span>
        <span>try</span> <span>self</span><span>.</span><span>decode</span><span>(</span>type<span>,</span> from<span>:</span> <span>Data</span><span>(</span>string<span>.</span>utf8<span>)</span><span>)</span>
    <span>}</span>
<span>}</span></code></pre><h2 id="Test-the-API-Locally">Test the API Locally</h2><p>We now have everything in place to start testing our API before deploying it to AWS. Let&#39;s try to get all the items.</p><pre><code>$ <span>curl</span> <span>\</span>
    --header <span>&#34;Content-Type: application/json&#34;</span> <span>\</span>
  --request GET <span>\</span>
  http://localhost:7000/invoke/todoitems</code></pre><p>We will get a <code><span>404</span> <span>-</span> Not found</code> error, which is weird because we have configured that endpoint in the right way inside our Lambda function. Well, this is because our local Runtime is only listening for requests at <code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>7000</span><span>/</span>invoke</code>. </p><p>In addition, we are using Amazon API Gateway to expose our Lambda function as an HTTP API. This means that all incoming HTTP requests will get transformed into JSON data by the API Gateway and provide the Lambda function with that payload already transformed. Then, our function will process that JSON payload and respond with another JSON payload itself, which the API Gateway will transform back into an HTTP response. </p><p>So, if we want to simulate this interaction, we must provide an HTTP request (in JSON format) in which we need to include all the relevant information like the method we want to call, the route path, the body, and so on.</p><p>This is a standard HTTP request after the API Gateway makes its transformations:</p><pre><code><span>{</span>
    <span>&#34;routeKey&#34;</span><span>:</span><span>&#34;GET /todoitems&#34;</span><span>,</span>
    <span>&#34;version&#34;</span><span>:</span><span>&#34;2.0&#34;</span><span>,</span>
    <span>&#34;rawPath&#34;</span><span>:</span><span>&#34;/todoitems&#34;</span><span>,</span>
    <span>&#34;requestContext&#34;</span><span>:</span><span>{</span>
        <span>&#34;accountId&#34;</span><span>:</span><span>&#34;&#34;</span><span>,</span>
        <span>&#34;apiId&#34;</span><span>:</span><span>&#34;&#34;</span><span>,</span>
        <span>&#34;domainName&#34;</span><span>:</span><span>&#34;&#34;</span><span>,</span>
        <span>&#34;domainPrefix&#34;</span><span>:</span><span>&#34;&#34;</span><span>,</span>
        <span>&#34;stage&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span>
        <span>&#34;requestId&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span>
        <span>&#34;http&#34;</span><span>:</span><span>{</span>
            <span>&#34;path&#34;</span><span>:</span><span>&#34;/todoitems&#34;</span><span>,</span>
            <span>&#34;method&#34;</span><span>:</span><span>&#34;GET&#34;</span><span>,</span>
            <span>&#34;protocol&#34;</span><span>:</span><span>&#34;HTTP/1.1&#34;</span><span>,</span>
            <span>&#34;sourceIp&#34;</span><span>:</span><span>&#34;&#34;</span><span>,</span>
            <span>&#34;userAgent&#34;</span><span>:</span><span>&#34;&#34;</span>
        <span>}</span><span>,</span>
        <span>&#34;time&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span>
        <span>&#34;timeEpoch&#34;</span><span>:</span><span>0</span>
    <span>}</span><span>,</span>
    <span>&#34;isBase64Encoded&#34;</span><span>:</span><span>false</span><span>,</span>
    <span>&#34;rawQueryString&#34;</span><span>:</span><span>&#34;&#34;</span><span>,</span>
    <span>&#34;headers&#34;</span><span>:</span><span>{</span><span>}</span>
<span>}</span></code></pre><p>We don&#39;t have to provide all the values, but all the keys must be present. Otherwise, we&#39;ll get a decoding error from the Lambda function.</p><p>With this in mind, let&#39;s make a request again. We can do it using the terminal like before or an API client tool like <a href="https://www.postman.com" target="_blank" rel="noreferrer noopener">Postman</a>. </p><pre><code>$ <span>curl</span> --header <span>&#34;Content-Type: application/json&#34;</span> <span>\</span>
  --request POST <span>\</span>
  --data <span>&#39;{
    &#34;routeKey&#34;:&#34;GET /todoitems&#34;,
    &#34;version&#34;:&#34;2.0&#34;,
    &#34;rawPath&#34;:&#34;/todoitems&#34;,
    &#34;requestContext&#34;:{
        &#34;accountId&#34;:&#34;&#34;,
        &#34;apiId&#34;:&#34;&#34;,
        &#34;domainName&#34;:&#34;&#34;,
        &#34;domainPrefix&#34;:&#34;&#34;,
        &#34;stage&#34;: &#34;&#34;,
        &#34;requestId&#34;: &#34;&#34;,
        &#34;http&#34;:{
            &#34;path&#34;:&#34;/todoitems&#34;,
            &#34;method&#34;:&#34;GET&#34;,
            &#34;protocol&#34;:&#34;HTTP/1.1&#34;,
            &#34;sourceIp&#34;:&#34;&#34;,
            &#34;userAgent&#34;:&#34;&#34;
        },
        &#34;time&#34;: &#34;&#34;,
        &#34;timeEpoch&#34;:0
    },
    &#34;isBase64Encoded&#34;:false,
    &#34;rawQueryString&#34;:&#34;&#34;,
    &#34;headers&#34;:{}
}&#39;</span> <span>\</span>
http://localhost:7000/invoke</code></pre><p>If we want to retrieve only one item, we need to add an entry into our data JSON. </p><pre><code><span>&#34;pathParameters&#34;</span><span>:</span> <span>{</span><span>&#34;id&#34;</span><span>:</span> <span>&#34;1&#34;</span><span>}</span></code></pre><p>Last, if we want to test the <code><span>POST</span></code> method, we must add the following entry to our data JSON. </p><pre><code><span>&#34;body&#34;</span><span>:</span> <span>&#34;{\&#34;id\&#34;:1, \&#34;description\&#34;: \&#34;Test\&#34;}&#34;</span></code></pre><p>And, other than that, we also need to modify the <strong>routeKey</strong> to <code><span>GET</span> <span>/</span>todoitems<span>/</span><span>{</span>id<span>}</span></code> and the <strong>http.method</strong> property to <strong>POST</strong> instead of <strong>GET</strong>.</p><h2 id="Deploy-to-AWS">Deploy to AWS</h2><h3 id="Compile---Package">Compile &amp; Package</h3><p>We will execute our Lambda function on <strong>Amazon Linux 2</strong> OS, so we need to compile our function for this particular OS. For convenience, we&#39;ll use <a href="https://www.docker.com" target="_blank" rel="noreferrer noopener">Docker</a> to do this. Create a new folder named <strong>Scripts</strong> in your root project folder. Inside this folder, create a new <strong>build.sh</strong> file with the following code</p><pre><code>docker run <span>\</span>
    --rm <span>\</span>
    --volume <span>&#34;<span><span>$(</span><span>pwd</span><span>)</span></span>/:/src&#34;</span> <span>\</span>
    --workdir <span>&#34;/src/&#34;</span> <span>\</span>
    swift:5.3.1-amazonlinux2 <span>\</span>
    swift build --product ToDoList-API -c release -Xswiftc -static-stdlib</code></pre><p>Understanding Docker commands is beyond the scope of this article, but what this code does is compiles our code for a container. If you&#39;d like to learn more about using Docker and its available commands, check out the <a href="https://docs.docker.com/engine/reference/commandline/cli/" target="_blank" rel="noreferrer noopener">oficial documentation</a>.</p><p>Now go ahead and create another file inside the <strong>Scripts</strong> folder: <strong>package.sh</strong></p><pre><code><span>#!/bin/bash</span>

<span>set</span> -eu

<span>executable</span><span>=</span><span>$1</span>

<span>target</span><span>=</span>.build/lambda/<span>$executable</span>
<span>rm</span> -rf <span>&#34;<span>$target</span>&#34;</span>
<span>mkdir</span> -p <span>&#34;<span>$target</span>&#34;</span>
<span>cp</span> <span>&#34;.build/release/<span>$executable</span>&#34;</span> <span>&#34;<span>$target</span>/&#34;</span>
<span>cd</span> <span>&#34;<span>$target</span>&#34;</span>
<span>ln</span> -s <span>&#34;<span>$executable</span>&#34;</span> <span>&#34;bootstrap&#34;</span>
<span>zip</span> --symlinks lambda.zip *</code></pre><p>This will create a new zip file with the right structure ready for us to upload to AWS.</p><p>We only need to follow these simple steps to build and package our code:</p><ol start="1"><li><code>$ sh <span>.</span><span>/</span>Scripts<span>/</span>build<span>.</span>sh</code></li><li><code>$ sh <span>.</span><span>/</span>Scripts<span>/</span><span>package</span><span>.</span>sh ToDoList<span>-</span><span>API</span></code></li></ol><p>In many environments, we may get privilege errors upon executing these scripts. If that happens, we just need to mark the file as executable by running the following commands:</p><pre><code>$ <span>chmod</span> +x Scripts/build.sh
$ <span>chmod</span> +x Scripts/package.sh</code></pre><h3 id="Upload-Lambda-file">Upload Lambda file</h3><p>The next step is to create our Lambda function and upload the zip file that we&#39;ve just generated. Login into your AWS account, go to AWS Lambda, and click on <strong>Create function</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5pfB1jTuOtVriJgoushAI5/0998fd7778997150dd2b85d01d80564a/swift_lambda_02.png" alt="Crate AWS Lambda function - Step 1"/></p><p>Click on the <strong>Create function</strong> button after entering a function name and the runtime option. You will be redirected to the next screen to upload the file.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/67bsSmxRcFkaROyOYicx2o/59a3679578ae60617f795065e5f3546b/swift_lambda_03.png" alt="Crate AWS Lambda function - Step 2"/></p><p>Click on the .zip file and locate your <strong>lambda.zip</strong> file on your computer. It should be available on <code>$ your<span>-</span>project<span>-</span>path<span>/</span><span>.</span>build<span>/</span>lambda<span>/</span>ToDoList<span>-</span><span>API</span><span>/</span>lambda<span>.</span>zip</code></p><h3 id="Connect-the-API-Gateway">Connect the API Gateway</h3><p>The last thing we need to do is connect our function to the API Gateway. Go to the API Gateway dashboard from your AWS console and click on <strong>Create API.</strong> Then choose the <strong>HTTP API</strong> option by clicking on the <strong>Build</strong> button.</p><p><strong>Step 1</strong></p><ul><li>Click on <strong>Add Integration</strong> and select the Lambda option
  <ul><li>Search for the Lambda function we just created in the previous section.</li><li>Make sure that the version is <strong>2.0</strong></li></ul></li><li>Chose a name for the API.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3O9bqK0RSD2116B4akcjJ5/a8dff34110d14a5065c6058e7823c73e/swift_lambda_04.png" alt="API Gateway - Step 1"/></p><p><strong>Step 2</strong></p><p>Here we must configure our routes. If we don&#39;t want to restrict the routing, we can use <strong>$default</strong> in the <strong>Resource path</strong> field. This will map all the requests to our Lambda. </p><p>For this tutorial, we&#39;re going to set the three endpoints that we defined at the beginning.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1ttSD1ozz3vM1IJ4ERKX8H/93a7c3d609759f6138c338e09c721f7a/swift_lambda_05.png" alt="API Gateway - Step 2"/></p><p><strong>Step 3</strong></p><p>In this step, we can configure different environments for our API, like development and production. In our case, we can leave <strong>$default</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/515U5zI0IewKQpHvK5vTeC/4a0772d20ce1fd9f1778edecfefa928b/swift_lambda_06.png" alt="API Gateway - Step 3"/></p><p><strong>Step 4</strong></p><p>Review all the information and click on <strong>Create</strong>. </p><p>And that&#39;s it! We now have our API deployed to AWS. The invoke url should be something like this: <code>https<span>:</span><span>/</span><span>/</span><span>{</span>your<span>-</span>gateway<span>-</span>id<span>}</span><span>.</span>execute<span>-</span>api<span>.</span>us<span>-</span>east<span>-</span><span>1.</span>amazonaws<span>.</span>com</code></p><h3 id="Test-it-">Test it!</h3><p>We&#39;re using Postman for this part, but you can use whatever other tool you want.</p><p><strong>Get all items</strong></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/iz0F35N6VrbMOJfBSU58p/5bf838ddda1dbb529c2a4973d1f626a3/swift_lambda_07.png" alt="Get all items reques"/></p><p><strong>Get one item</strong></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/OF1HGO3P1B51ioF5JdfdR/1af20c65c0addbc106f7a974312bd74d/swift_lambda_08.png" alt="Get one item request"/></p><p><strong>Create new item</strong></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7yuttuwCtspW5xxmy0ug0r/ab7e81aa859b84948a304c7a3abed3c6/swift_lambda_09.png" alt="Create new item request"/></p><h2 id="Secure-the-API-Using-Auth0">Secure the API Using Auth0</h2><p>Of course, you&#39;d never want to leave an unauthenticated API up - you&#39;ll be responsible for paying for every call made to it!. To demonstrate how we can secure our endpoints, let&#39;s make the <code><span>GET</span> <span>/</span>todoitems<span>/</span><span>{</span>id<span>}</span></code> endpoint only be accessible by authenticated users (in a real application, we&#39;d protect all of these endpoints). </p><p>To accomplish this, we are going to create a custom <a href="https://es.wikipedia.org/wiki/JSON_Web_Token" target="_blank" rel="noreferrer noopener">JSON Web Tokens (JWTs)</a> authorizer with <strong>Auth0</strong> and attach it to our API Gateway endpoint.</p><h3 id="Create-a-new-Auth0-API">Create a new Auth0 API</h3><p>First thing first, login into your Auth0 account and go to <strong>Applications ‚Üí APIs</strong> in the left menu, and click on + <strong>Create API</strong> button.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3GZG3baxHOc6e2CaNEv0iu/12d2dc752a4753bdd7b9cba95c72f91e/swift_lambda_10.png" alt="New Auth0 API"/></p><ul><li><strong>Name</strong>: This will be the internal name for the API</li><li><strong>Identifier</strong>: <a href="https://auth0-jwt-authorizer/" target="_blank" rel="noreferrer noopener">https://auth0-jwt-authorizer</a></li><li><strong>Signing Algorithm</strong>: Just leave the default here</li></ul><p>Go back to your API Gateway Dashboard and click the <strong>Authorization</strong> option on the left panel below the <strong>Develop</strong> section.</p><p>Select the endpoints that you want to restrict access to; in our case, it will be <code><span>GET</span> <span>/</span>todoitems<span>/</span><span>{</span>id<span>}</span></code>, and click on <strong>Create and attach an authorizer</strong></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2muFgeJURgJInk8TGe7UgA/bfe4a098b1b9912f319879ee4356bb9a/swift_lambda_11.png" alt="Authorizer"/></p><p>Select <strong>JWT</strong> type and fill in the required information:</p><ul><li><strong>Name</strong>: The name that you want to call the authorizer</li><li><strong>Identity source</strong>: <code>$request<span>.</span>header<span>.</span>Authorization</code> This means that the authorizer can access the access token in the Authorization header.</li><li><strong>Issuer URL</strong>: <code>https<span>:</span><span>/</span><span>/</span><span>{</span>tenant<span>-</span>name<span>}</span><span>.</span>auth0<span>.</span>com</code>. The authorizer uses this to validate the <strong>iss</strong> field inside the JWT. You can find your Auth0 tenant-name in <strong>Applications ‚Üí Default App ‚Üí Domain</strong>.</li><li><strong>Audience</strong>: <code>https<span>:</span><span>/</span><span>/</span>auth0<span>-</span>jwt<span>-</span>authorizer</code>. This will be used by the authorizer to validate the <strong>aud</strong> field inside the JWT. This needs to match with the identifier that we configured our Auth0 API before.</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6CBOYYxuepwvH5GuJBy4Sa/a2fa0221485d3351bbb3b789b26276fa/swift_lambda_12.png" alt="Add AWS Lambda authorizer"/></p><h3 id="Test-it-Again">Test it Again</h3><p>If we now try to call <code><span>GET</span> <span>/</span>todoitems<span>/</span><span>{</span>id<span>}</span></code>, we will get an unauthorized error.</p><pre><code><span>{</span>
    <span>&#34;message&#34;</span><span>:</span> <span>&#34;Unauthorized&#34;</span>
<span>}</span></code></pre><p>This is because if we want to use this endpoint, we must provide an authentication header. In a real app, we will return a valid token after the user was authenticated by our app, but just for testing purposes, we can get a token from Auth0.</p><p>Go again to your Auth0 dashboard, and on the left panel, click on <strong>Applications ‚Üí APIs ‚Üí AWS JWT Authorizer</strong> <strong>‚Üí</strong> <strong>Test</strong>. Find the response section and copy the bearer token provided.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6rxP91y2vKpJLm2sJ72nb7/ac0c048e856f3e8fedbecbf097317d53/swift_lambda_13.png" alt="Auth0 dashboard"/></p><p>Now go back to Postman, add an Authorization header with this token, and send the request. </p><p>Because our request has an authentication token, we get a response!</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1QIhmYdn0hGKDGqAhKcuSJ/170a0ef548ff64bc57770f9aa9ae72a7/swift_lambda_14.png" alt="Authentication Token Response"/></p><h2 id="Conclusion">Conclusion</h2><p>With this type of solution, we, as iOS developers, are in a position to start shifting to a mobile full-stack role, where we don&#39;t need a separate team for the backend side. Of course, every team and project is different. However, for small projects or proof of concepts, this solution should work like a charm. Understanding backend technologies will increase your understanding of software and make you more of an asset to any iOS team.</p><p>The Swift AWS Lambda Runtime has room for improvement (like everything in the tech industry), but it gives us a start point to write backend code without the need of learning a new development language. </p><p>If you want a more detailed example with a database (DynamoDB) connection, you can check the full project <a href="https://github.com/blorenzo10/lambda-swift" target="_blank" rel="noreferrer noopener">here</a>.</p></div></div>]]></content:encoded>
      <author>Attach new Authorizer</author>
      <pubDate>Wed, 29 Sep 2021 16:28:00 +0000</pubDate>
    </item>
    <item>
      <title>Get Started with Custom Error Handling in Spring Boot (Java)</title>
      <link>https://auth0.com/blog/get-started-with-custom-error-handling-in-spring-boot-java/</link>
      <description>Learn how to implement custom error handling logic in Spring Boot. You will see two approaches based on the @ControllerAdvice annotation. Similarly, you will learn how to deal with authentication and access denied errors in Spring Security.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL/DR:</strong> Let‚Äôs take a look at everything required to build custom error handling logic in both Spring Boot Web and Spring Boot Security</p><p>REST applications developed in Spring Boot automatically take advantage of its default error handling logic. Specifically, whenever an error occurs, a default response containing some information is returned. The problem is that this information may be poor or insufficient for the API callers to deal with the error properly. This is why implementing custom error handling logic is such a common and desirable task. Achieving it requires more effort than you might think, and you need to delve into a few essential Spring Boot notions. Let&#39;s see everything required to get started with custom error handling in Spring Boot and Java.</p><h2 id="Prerequisites">Prerequisites</h2><p>This is the list of all the prerequisites for following the article:</p><ul><li>Java &gt;= 1.8 (Java &gt;= 13 recommended)</li><li>Spring Boot &gt;= 2.5</li><li><a href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web" target="_blank" rel="noreferrer noopener">Spring Boot Starter Web</a> &gt;= 2.5</li><li><a href="https://mvnrepository.com/artifact/org.springframework.security/spring-security-core" target="_blank" rel="noreferrer noopener">Spring Security</a> &gt;= 5.5</li><li><a href="https://mvnrepository.com/artifact/org.projectlombok/lombok" target="_blank" rel="noreferrer noopener">Project Lombok</a> &gt;= 1.18</li><li>Gradle &gt;= 4.x or Maven 3.6.x</li></ul><h2 id="Default-Error-Handling-in-Spring-Boot">Default Error Handling in Spring Boot</h2><p>By default, Spring Boot offers a fallback error-handling page, as well as an error-handling response in case of REST requests. Particularly, Spring Boot looks for a mapping for the <code><span>/</span>error</code> endpoint during the start-up. This mapping depends on what is set on a <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/ViewResolver.html" target="_blank" rel="noreferrer noopener"><code>ViewResolver</code></a> class. When no valid mappings can be found, Spring Boot automatically configures a default fallback error page. This so-called <em>Whitelabel Error Page</em> is nothing more than a white HTML page containing the HTTP status code and a vague error message. This is what such a page looks like:</p><pre><code><span><span><span>&lt;</span>html</span><span>&gt;</span></span>
   <span><span><span>&lt;</span>head</span><span>&gt;</span></span><span><span><span>&lt;/</span>head</span><span>&gt;</span></span>
   <span><span><span>&lt;</span>body</span> <span>data-new-gr-c-s-check-loaded</span><span><span>=</span><span>&#34;</span>14.1026.0<span>&#34;</span></span> <span>data-gr-ext-installed</span><span><span>=</span><span>&#34;</span><span>&#34;</span></span><span>&gt;</span></span>
      <span><span><span>&lt;</span>h1</span><span>&gt;</span></span>Whitelabel Error Page<span><span><span>&lt;/</span>h1</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>p</span><span>&gt;</span></span>This application has no explicit mapping for /error, so you are seeing this as a fallback.<span><span><span>&lt;/</span>p</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>div</span> <span>id</span><span><span>=</span><span>&#34;</span>created<span>&#34;</span></span><span>&gt;</span></span>Sun Aug 15 14:32:17 UTC 2021<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>div</span><span>&gt;</span></span>There was an unexpected error (type=Internal Server Error, status=500).<span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>div</span><span>&gt;</span></span><span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
   <span><span><span>&lt;/</span>body</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>html</span><span>&gt;</span></span></code></pre><p>This is what the <em>Whitelabel</em> HTML page looks like in your browser:
<img src="https://images.ctfassets.net/23aumh6u8s0i/3uDV4oIkM9VkBKdc37xA9n/647cc2fc212b61a1aa3ff4d52a99c032/whitelabel-error-page.jpg" alt="The Spring Boot Whitelabel HTML Error Page" title="The Spring Boot Whitelabel HTML Error Page"/>
</p><p><i>The Spring Boot Whitelabel HTML Error Page</i></p><p>Similarly, when dealing with REST requests, Spring Boot automatically returns a default JSON response in case of errors. This contains the same information as the aforementioned <em>Whitelabel</em> HTML error page and looks as follows:</p><pre><code><span>{</span>
  <span>&#34;timestamp&#34;</span><span>:</span> <span>&#34;2021-15-08T14:32:17.947+0000&#34;</span><span>,</span>
  <span>&#34;status&#34;</span><span>:</span> <span>500</span><span>,</span>
  <span>&#34;error&#34;</span><span>:</span> <span>&#34;Internal Server Error&#34;</span><span>,</span>
  <span>&#34;path&#34;</span><span>:</span> <span>&#34;/test&#34;</span>
<span>}</span></code></pre><p>As you can see, the default Spring Boot error handling responses for REST does not provide much information. This can quickly become a problem, especially when trying to debug. It is also problematic for front-end developers, who need detailed information coming from API error response messages to be able to explain to the end users what happened properly. </p><p>Let‚Äôs see how to replace this default response with custom-defined messages. While this may appear like an easy task, this is actually a tricky one. To achieve it, you first need to know a few Spring Boot fundamentals. Let&#39;s learn more about them.</p><h2 id="Custom-Error-Handling-in-Spring-Boot">Custom Error Handling in Spring Boot</h2><p>You are about to see two different approaches to custom error handling in Spring Boot REST applications. Both are based on a <code>@ControllerAdvice</code> annotated class handling all exceptions that may occur. So, let‚Äôs first see what a <code>@ControllerAdvice</code> annotated class is, why to use it, how, and when. Then, you will learn how to implement the two different approaches in detail. Finally, the pros and cons of each method will be explained.</p><h2 id="Handling-Exceptions-with---ControllerAdvice-">Handling Exceptions with <code>@ControllerAdvice</code></h2><p>The <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ControllerAdvice.html" target="_blank" rel="noreferrer noopener"><code>@ControllerAdvice</code></a> annotation was introduced in <a href="https://docs.spring.io/spring-framework/docs/3.2.8.RELEASE/changelog.txt" target="_blank" rel="noreferrer noopener">Spring 3.2</a> to make exception handling logic easier and entirely definable in one place. In fact, <code>@ControllerAdvice</code> allows you to address exception handling across the whole application. In other words, a single <code>@ControllerAdvice</code> annotated class can handle exceptions thrown from any place in your application. Thus, classes annotated with <code>@ControllerAdvice</code> are powerful and flexible tools. Not only do they allow you to centralize exception-handling logic into a global component, but also give you control over the body response, as well as the HTTP status code. This is especially important when trying to achieve custom error handling. Let‚Äôs see <code>@ControllerAdvice</code> in action.</p><p>Now, you are about to see everything required to implement two custom error handling approaches based on <code>@ControllerAdvice</code>. First, you should clone <a href="https://github.com/Tonel/spring-boot-custom-error-handling" target="_blank" rel="noreferrer noopener">the GitHub repository</a> supporting this article. By analyzing the codebase, going through this article will become easier. Also, you will be able to immediately see the two approaches in action.</p><p>So, clone the repository with the following command:</p><pre><code><span>git</span> clone https://github.com/Tonel/spring-boot-custom-error-handling</code></pre><p>Then, run the <code>DemoApplication</code> main class by following <a href="https://docs.spring.io/spring-boot/docs/2.0.x/reference/html/using-boot-running-your-application.html" target="_blank" rel="noreferrer noopener">this guide from the Spring Boot official documentation</a>, and reach one of the following 4 endpoints to see the custom error handling responses:</p><ol start="1"><li><code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>test<span>-</span>custom<span>-</span>data<span>-</span>not<span>-</span>found<span>-</span>exception</code></li><li><code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>test<span>-</span>custom<span>-</span>parameter<span>-</span>constraint<span>-</span>exception<span>?</span>value<span>=</span><span>12</span></code></li><li><code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>test<span>-</span>custom<span>-</span>error<span>-</span>exception</code></li><li><code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>test<span>-</span>generic<span>-</span>exception</code></li></ol><p>The first two APIs apply the first approach to error handling you are about to see, while the third API uses the second approach. The fourth and last API shows the fallback error handling logic presented above in action. Now, let&#39;s delve into implementing these two approaches to custom error handling in Spring Boot.</p><p>Both of them rely on an <code>ErrorMessage</code> class representing the custom error body placed in an <code>error</code> package, containing everything needed to deal with custom error handling logic. This can be implemented as follows:</p><pre><code><span>// src/main/java/com/customerrorhandling/demo/errors/ErrorResponse.java</span>

<span>package</span> <span>com<span>.</span>customerrorhandling<span>.</span>demo<span>.</span>errors</span><span>;</span>

<span>import</span> <span>com<span>.</span>fasterxml<span>.</span>jackson<span>.</span>annotation<span>.</span></span><span>JsonFormat</span><span>;</span>
<span>import</span> <span>lombok<span>.</span></span><span>Getter</span><span>;</span>
<span>import</span> <span>lombok<span>.</span></span><span>Setter</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpStatus</span><span>;</span>
<span>import</span> <span>java<span>.</span>util<span>.</span></span><span>Date</span><span>;</span>

<span>@Getter</span>
<span>@Setter</span>
<span>public</span> <span>class</span> <span>ErrorResponse</span> <span>{</span>
    <span>// customizing timestamp serialization format</span>
    <span>@JsonFormat</span><span>(</span>shape <span>=</span> <span>JsonFormat<span>.</span>Shape</span><span>.</span>STRING<span>,</span> pattern <span>=</span> <span>&#34;dd-MM-yyyy hh:mm:ss&#34;</span><span>)</span>
    <span>private</span> <span>Date</span> timestamp<span>;</span>

    <span>private</span> <span>int</span> code<span>;</span>

    <span>private</span> <span>String</span> status<span>;</span>

    <span>private</span> <span>String</span> message<span>;</span>

    <span>private</span> <span>String</span> stackTrace<span>;</span>

    <span>private</span> <span>Object</span> data<span>;</span>

    <span>public</span> <span>ErrorResponse</span><span>(</span><span>)</span> <span>{</span>
        timestamp <span>=</span> <span>new</span> <span>Date</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>ErrorResponse</span><span>(</span>
            <span>HttpStatus</span> httpStatus<span>,</span>
            <span>String</span> message
    <span>)</span> <span>{</span>
        <span>this</span><span>(</span><span>)</span><span>;</span>
    
        <span>this</span><span>.</span>code <span>=</span> httpStatus<span>.</span><span>value</span><span>(</span><span>)</span><span>;</span>
        <span>this</span><span>.</span>status <span>=</span> httpStatus<span>.</span><span>name</span><span>(</span><span>)</span><span>;</span>
        <span>this</span><span>.</span>message <span>=</span> message<span>;</span>
    <span>}</span>

    <span>public</span> <span>ErrorResponse</span><span>(</span>
            <span>HttpStatus</span> httpStatus<span>,</span>
            <span>String</span> message<span>,</span>
            <span>String</span> stackTrace
    <span>)</span> <span>{</span>
        <span>this</span><span>(</span>
                httpStatus<span>,</span>
                message        
        <span>)</span><span>;</span>

        <span>this</span><span>.</span>stackTrace <span>=</span> stackTrace<span>;</span>
    <span>}</span>

    <span>public</span> <span>ErrorResponse</span><span>(</span>
            <span>HttpStatus</span> httpStatus<span>,</span>
            <span>String</span> message<span>,</span>
        <span>String</span> stackTrace<span>,</span>
            <span>Object</span> data
    <span>)</span> <span>{</span>
        <span>this</span><span>(</span>
                httpStatus<span>,</span>
                message<span>,</span>
        stackTrace
        <span>)</span><span>;</span>

        <span>this</span><span>.</span>data <span>=</span> data<span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>The <a href="https://projectlombok.org/features/GetterSetter" target="_blank" rel="noreferrer noopener"><code>@Getter</code></a> and <a href="https://projectlombok.org/features/GetterSetter" target="_blank" rel="noreferrer noopener"><code>@Setter</code></a> annotations used in the code examples above are part of the <a href="https://projectlombok.org/" target="_blank" rel="noreferrer noopener"><code>Project Lombok</code></a>. They are used to automatically generate getters and setters. This is not mandatory and is just an additional way to avoid boilerplate code. Read <a href="https://auth0.com/blog/a-complete-guide-to-lombok/" target="_blank" rel="noreferrer noopener">this</a> article to find out more about Lombok.</p><p><code>ErrorResponse</code> carries information such as an HTTP status <code>code</code> and <code>name</code>, a <code>timestamp</code> indicating when the error occurred, an optional error <code>message</code>, an optional <a href="https://en.wikibooks.org/wiki/Java_Programming/Stack_trace" target="_blank" rel="noreferrer noopener"><code>exception stacktrace</code></a>, and an optional object containing any kind of <code>data</code>. You should try to provide values to the first three fields, while the latter should be used only when required. In particular, the <code>stackTrace</code> field should be valorized only in staging or development environments, as explained <a href="https://betterprogramming.pub/environment-based-error-handling-with-spring-boot-and-kotlin-b36b901135ad" target="_blank" rel="noreferrer noopener">here</a>. Similarly, the data field should be used only when additional data is required. Specifically, to explain in detail what happened or let the front-end better handle the error.</p><p>This class can be used to achieve a custom response when handling exceptions with <code>@ControllerAdvice</code> as below:</p><pre><code><span>// src/main/java/com/customerrorhandling/demo/errors/CustomControllerAdvice.java</span>

<span>package</span> <span>com<span>.</span>customerrorhandling<span>.</span>demo<span>.</span>errors</span><span>;</span>

<span>import</span> <span>exceptions<span>.</span></span><span>CustomDataNotFoundException</span><span>;</span>
<span>import</span> <span>exceptions<span>.</span></span><span>CustomErrorException</span><span>;</span>
<span>import</span> <span>exceptions<span>.</span></span><span>CustomParameterConstraintException</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpStatus</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>ResponseEntity</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>ControllerAdvice</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>ExceptionHandler</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>PrintWriter</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>StringWriter</span><span>;</span>

<span>@ControllerAdvice</span>
<span>class</span> <span>CustomControllerAdvice</span> <span>{</span>
    <span>@ExceptionHandler</span><span>(</span><span>NullPointerException</span><span>.</span><span>class</span><span>)</span> <span>// exception handled</span>
    <span>public</span> <span>ResponseEntity</span><span><span>&lt;</span><span>ErrorResponse</span><span>&gt;</span></span> <span>handleNullPointerExceptions</span><span>(</span>
        <span>Exception</span> e
    <span>)</span> <span>{</span>
        <span>// ... potential custom logic</span>

        <span>HttpStatus</span> status <span>=</span> <span>HttpStatus</span><span>.</span>NOT_FOUND<span>;</span> <span>// 404</span>

        <span>return</span> <span>new</span> <span>ResponseEntity</span><span><span>&lt;</span><span>&gt;</span></span><span>(</span>
            <span>new</span> <span>ErrorResponse</span><span>(</span>
              status<span>,</span> 
              e<span>.</span><span>getMessage</span><span>(</span><span>)</span>
            <span>)</span><span>,</span>
            status
        <span>)</span><span>;</span>
    <span>}</span>

    <span>// fallback method</span>
    <span>@ExceptionHandler</span><span>(</span><span>Exception</span><span>.</span><span>class</span><span>)</span> <span>// exception handled</span>
    <span>public</span> <span>ResponseEntity</span><span><span>&lt;</span><span>ErrorResponse</span><span>&gt;</span></span> <span>handleExceptions</span><span>(</span>
        <span>Exception</span> e
    <span>)</span> <span>{</span>
        <span>// ... potential custom logic</span>

        <span>HttpStatus</span> status <span>=</span> <span>HttpStatus</span><span>.</span>INTERNAL_SERVER_ERROR<span>;</span> <span>// 500</span>

    <span>// converting the stack trace to String</span>
    <span>StringWriter</span> stringWriter <span>=</span> <span>new</span> <span>StringWriter</span><span>(</span><span>)</span><span>;</span>
    <span>PrintWriter</span> printWriter <span>=</span> <span>new</span> <span>PrintWriter</span><span>(</span>stringWriter<span>)</span><span>;</span>
    e<span>.</span><span>printStackTrace</span><span>(</span>printWriter<span>)</span><span>;</span>
    <span>String</span> stackTrace <span>=</span> stringWriter<span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>

        <span>return</span> <span>new</span> <span>ResponseEntity</span><span><span>&lt;</span><span>&gt;</span></span><span>(</span>
            <span>new</span> <span>ErrorResponse</span><span>(</span>
              status<span>,</span> 
              e<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>,</span> 
              stackTrace <span>// specifying the stack trace in case of 500s</span>
            <span>)</span><span>,</span>
            status
        <span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>As you can see, <code>@ControllerAdvice</code> works by employing the <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ExceptionHandler.html" target="_blank" rel="noreferrer noopener"><code>@ExceptionHandler</code></a> method-level annotation. This annotation allows you to define which method should be called in case of an error. Specifically, the exception thrown is compared to the exceptions passed as parameters to <code>@ExceptionHandler</code> based on type. The first method where there is a match is called. If none matched, then the exception&#39;s parent class is tested, and so on. This is also why you should implement a fallback method to cover all remaining cases. You can achieve this by passing the <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/Exception.html" target="_blank" rel="noreferrer noopener"><code>Exception</code></a> class to the <code>@ExceptionHandler</code> annotation, just like in the <code>handleExceptions</code> method. In fact, any exception in Java must have <code>Exception</code> as one of its ancestors in their inheritance chain. So, they all extend directly ‚Äî or as subclasses ‚Äî the <code>Exception</code> <a href="https://docs.oracle.com/javase/tutorial/java/IandI/subclasses.html" target="_blank" rel="noreferrer noopener">superclass</a>.</p><p>Then, each method handles the error and might even implement custom logic, such as logging. In this example, each exception is handled by returning a <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/ResponseEntity.html" target="_blank" rel="noreferrer noopener"><code>ResponseEntity</code></a> having the desired <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/http/HttpStatus.html" target="_blank" rel="noreferrer noopener"><code>HttpStatus</code></a>. This will be used as an HTTP status code associated with the error response. Similarly, the <code>ErrorResponse</code> instance passed to the <code>ResponseEntity</code> constructor will be automatically serialized in JSON and used as the message body. This way, custom error handling has just been achieved.</p><p>Now, you will dive into how to use <code>@ConfrollerAdvice</code> to implement two different approaches to custom error handling for REST in Spring Boot Web. The first one involves boilerplate code, but it is clean and best-practice based. In contrast, the second represents a good solution in terms of convenience, although it is a bit dirty.</p><h3 id="Defining-Many-Custom-Exceptions">Defining Many Custom Exceptions</h3><p>This approach involves having as many methods in your <code>@ControllerAdvice</code> as many HTTP error status codes you want to handle. These methods will be related to one or more exceptions and return an error message with a particular HTTP status code. Implementing such an approach required three steps. First, you have to think about all the HTTP error status codes you want your application to return. Then, you have to define a method for each of them in your <code>@ControllerAdvice</code> annotated class. Lastly, you have to associate these methods with their exceptions with the <code>@ExceptionHandler</code> annotation.</p><p>This means that all exceptions of a particular type will be traced back to their relative method in the <code>@ControllerAdvice</code> annotated class. This may represent a problem, especially considering some exceptions are more common than others, such as <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/NullPointerException.html" target="_blank" rel="noreferrer noopener"><code>NullPointerException</code></a>. Since these exceptions can be thrown in many parts of your logic, they might have different meanings. Thus, they represent various errors and, therefore, other HTTP status codes.</p><p>The solution is to introduce new custom exceptions wrapping these frequent exceptions. For example, a <code>NullPointerException</code> can become a <code>CustomParameterConstraintException</code> exception at the controller layer, and a <code>CustomDataNotFoundException</code> at the DAO  (<a href="https://it.wikipedia.org/wiki/Data_Access_Object" target="_blank" rel="noreferrer noopener">Data Access Object</a>) layer. In this case, the first one can be associated with a <em>400 Bad Request</em>, and the second with a <em>404 Not Found</em> HTTP status. The idea behind these exceptions is to give the error that occurred a more specific meaning. This better characterizes the error and makes it more handleable in the <code>@ControllerAdvice</code> annotated class accordingly. So, you should define a custom exception for each particular error you want to handle. Also, using custom exception classes represents undoubtedly a clean code principle. Thus, by adopting it, you are going to have more than one benefit.</p><p>So, let‚Äôs see this approach in action through an example. Firstly, you have to define custom exceptions, as shown here:</p><pre><code><span>// src/main/java/exceptions/CustomParameterConstraintException.java</span>

<span>package</span> <span>exceptions</span><span>;</span>

<span>public</span> <span>class</span> <span>CustomParameterConstraintException</span> <span>extends</span> <span>RuntimeException</span> <span>{</span>  
    <span>public</span> <span>CustomParameterConstraintException</span><span>(</span><span>)</span> <span>{</span>
        <span>super</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>CustomParameterConstraintException</span><span>(</span><span>String</span> message<span>)</span> <span>{</span>
        <span>super</span><span>(</span>message<span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><pre><code><span>// src/main/java/exceptions/CustomDataNotFoundException.java</span>

<span>package</span> <span>exceptions</span><span>;</span>

<span>public</span> <span>class</span> <span>CustomDataNotFoundException</span> <span>extends</span> <span>RuntimeException</span> <span>{</span>  
    <span>public</span> <span>CustomDataNotFoundException</span><span>(</span><span>)</span> <span>{</span>
        <span>super</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>public</span> <span>CustomDataNotFoundException</span><span>(</span><span>String</span> message<span>)</span> <span>{</span>
        <span>super</span><span>(</span>message<span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Then, use them to wrap frequent exceptions, or to throw them in case of particular circumstances representing errors in your business logic. Let‚Äôs see how with two examples:</p><pre><code><span>// DAO-level method</span>
<span>public</span> <span>Foo</span> <span>retrieveFooById</span><span>(</span>
    <span>int</span> id
<span>)</span> <span>{</span>
    <span>try</span> <span>{</span>
        <span>// data retrieving logic</span>
    <span>}</span> <span>catch</span> <span>(</span><span>NullPointerException</span> e<span>)</span> <span>{</span>
        <span>throw</span> <span>new</span> <span>CustomDataNotFoundException</span><span>(</span>e<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>As shown above, a generic <code>NullPointerException</code> is turned into a more meaningful <code>CustomDataNotFoundException</code>.</p><pre><code><span>// controller-level method method</span>
<span>public</span> <span>ResponseEntity</span><span><span>&lt;</span><span>Void</span><span>&gt;</span></span> <span>performOperation</span><span>(</span>
    <span>int</span> numberOfAttempts
<span>)</span> <span>{</span>
    <span>if</span> <span>(</span>numberOfAttempts <span>&lt;=</span> <span>0</span> <span>||</span> numberOfAttempts <span>&gt;=</span> <span>5</span><span>)</span>
        <span>throw</span> <span>new</span> <span>CustomParameterConstraintException</span><span>(</span><span>&#34;numberOfAttempts must be &gt;= 0 and &lt;= 5!&#34;</span><span>)</span><span>;</span>
        
    <span>// business logic</span>
<span>}</span></code></pre><p>Here, a particular behavior that should not happen is intercepted. Then, the custom <code>CustomParameterConstraintException</code> exception describing it is thrown.</p><p>Finally, all you have to do is add two particular methods to your <code>@ControllerAdvice</code> annotated class, one for each specific error.</p><pre><code><span>// src/main/java/com/customerrorhandling/demo/errors/CustomControllerAdvice.java</span>

<span>package</span> <span>com<span>.</span>customerrorhandling<span>.</span>demo<span>.</span>errors</span><span>;</span>

<span>import</span> <span>exceptions<span>.</span></span><span>CustomDataNotFoundException</span><span>;</span>
<span>import</span> <span>exceptions<span>.</span></span><span>CustomErrorException</span><span>;</span>
<span>import</span> <span>exceptions<span>.</span></span><span>CustomParameterConstraintException</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpStatus</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>ResponseEntity</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>ControllerAdvice</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>ExceptionHandler</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>PrintWriter</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>StringWriter</span><span>;</span>

<span>@ControllerAdvice</span>
<span>class</span> <span>CustomControllerAdvice</span> <span>{</span>
    <span>// ...</span>

    <span>@ExceptionHandler</span><span>(</span><span>CustomDataNotFoundException</span><span>.</span><span>class</span><span>)</span>
    <span>public</span> <span>ResponseEntity</span><span><span>&lt;</span><span>ErrorResponse</span><span>&gt;</span></span> <span>handleCustomDataNotFoundExceptions</span><span>(</span>
        <span>Exception</span> e
    <span>)</span> <span>{</span>
        <span>HttpStatus</span> status <span>=</span> <span>HttpStatus</span><span>.</span>NOT_FOUND<span>;</span> <span>// 404</span>

    <span>// converting the stack trace to String</span>
    <span>StringWriter</span> stringWriter <span>=</span> <span>new</span> <span>StringWriter</span><span>(</span><span>)</span><span>;</span>
    <span>PrintWriter</span> printWriter <span>=</span> <span>new</span> <span>PrintWriter</span><span>(</span>stringWriter<span>)</span><span>;</span>
    e<span>.</span><span>printStackTrace</span><span>(</span>printWriter<span>)</span><span>;</span>
    <span>String</span> stackTrace <span>=</span> stringWriter<span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>

        <span>return</span> <span>new</span> <span>ResponseEntity</span><span><span>&lt;</span><span>&gt;</span></span><span>(</span>
            <span>new</span> <span>ErrorResponse</span><span>(</span>
              status<span>,</span> 
              e<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>,</span>
          stackTrace<span>,</span> <span>// assuming to be in staging environment, otherwise stackTrace should not be valorized</span>
            <span>)</span><span>,</span>
            status
        <span>)</span><span>;</span>
    <span>}</span>

    <span>@ExceptionHandler</span><span>(</span><span>CustomParameterConstraintException</span><span>.</span><span>class</span><span>)</span>
    <span>public</span> <span>ResponseEntity</span><span><span>&lt;</span><span>ErrorResponse</span><span>&gt;</span></span> <span>handleCustomParameterConstraintExceptions</span><span>(</span>
        <span>Exception</span> e
    <span>)</span> <span>{</span>
        <span>HttpStatus</span> status <span>=</span> <span>HttpStatus</span><span>.</span>BAD_REQUEST<span>;</span> <span>// 400</span>

        <span>return</span> <span>new</span> <span>ResponseEntity</span><span><span>&lt;</span><span>&gt;</span></span><span>(</span>
            <span>new</span> <span>ErrorResponse</span><span>(</span>
              status<span>,</span> 
              e<span>.</span><span>getMessage</span><span>(</span><span>)</span>
            <span>)</span><span>,</span>
            status
        <span>)</span><span>;</span>
    <span>}</span>

    <span>// ...</span>
<span>}</span></code></pre><p>Et voil√†! Both errors originally related to the same exception were first characterized and then handled accordingly.</p><p>Now, let&#39;s see the difference. This is what the default error response would look like on a 404 error:</p><pre><code><span>{</span>
  <span>&#34;timestamp&#34;</span><span>:</span> <span>&#34;2021-15-08T14:32:17.947+0000&#34;</span><span>,</span>
  <span>&#34;status&#34;</span><span>:</span> <span>404</span><span>,</span>
  <span>&#34;error&#34;</span><span>:</span> <span>&#34;Not Found&#34;</span><span>,</span>
  <span>&#34;path&#34;</span><span>:</span> <span>&#34;/test404&#34;</span>
<span>}</span></code></pre><p>And this is what the custom error response just implemented looks like:</p><pre><code><span>{</span>
  <span>&#34;timestamp&#34;</span><span>:</span> <span>&#34;2021-15-08 14:32:17&#34;</span><span>,</span>
  <span>&#34;code&#34;</span><span>:</span> <span>404</span><span>,</span>
  <span>&#34;status&#34;</span><span>:</span> <span>&#34;NOT_FOUND&#34;</span><span>,</span>
  <span>&#34;message&#34;</span><span>:</span> <span>&#34;Resource not found&#34;</span><span>,</span>
  <span>&#34;stackTrace&#34;</span><span>:</span> &#34;Exception in thread \&#34;main\&#34; com.example.demo.exceptions.CustomDataNotFoundException
        at com.example.demo.AuthorController.getAuthor(AuthorController.java<span>:</span><span>16</span>)
        at com.example.demo.AuthorService.getAuthor(AuthorService.java<span>:</span><span>37</span>)
        at com.example.demo.AuthorDao.getById(AuthorDao.java<span>:</span><span>24</span>)&#34;
<span>}</span></code></pre><h3 id="Defining-a-Single-Custom-Exception-Carrying-All-Data">Defining a Single Custom Exception Carrying All Data</h3><p>This approach involves defining a custom exception carrying the HTTP status to use, and all the data required to describe the error that occurred. The idea is to turn every exception you want to handle, or you would like to throw under special circumstances, into an instance of this particular exception. This way, you are spreading the error characterization logic into all your code. So, you will only have to add a new method in your <code>@ControllerAdvice</code> annotated class to handle this custom exception accordingly.</p><p>First, you have to define a custom error handling exception. This can be achieved as follows:</p><pre><code><span>// src/main/java/exceptions/CustomErrorException.java</span>

<span>package</span> <span>exceptions</span><span>;</span>

<span>import</span> <span>lombok<span>.</span></span><span>Getter</span><span>;</span>
<span>import</span> <span>lombok<span>.</span></span><span>Setter</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpStatus</span><span>;</span>

<span>@Getter</span>
<span>@Setter</span>
<span>public</span> <span>class</span> <span>CustomErrorException</span> <span>extends</span> <span>RuntimeException</span> <span>{</span>
    <span>private</span> <span>HttpStatus</span> status <span>=</span> <span>null</span><span>;</span>

    <span>private</span> <span>Object</span> data <span>=</span> <span>null</span><span>;</span>

    <span>public</span> <span>CustomErrorException</span><span>(</span><span>)</span> <span>{</span>
      <span>super</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

   <span>public</span> <span>CustomErrorException</span><span>(</span>
      <span>String</span> message
   <span>)</span> <span>{</span> 
      <span>super</span><span>(</span>message<span>)</span><span>;</span>
   <span>}</span>

    <span>public</span> <span>CustomErrorException</span><span>(</span>
        <span>HttpStatus</span> status<span>,</span>
        <span>String</span> message
    <span>)</span> <span>{</span>
        <span>this</span><span>(</span>message<span>)</span><span>;</span>
        <span>this</span><span>.</span>status <span>=</span> status<span>;</span>
    <span>}</span>

    <span>public</span> <span>CustomErrorException</span><span>(</span>
        <span>HttpStatus</span> status<span>,</span>
        <span>String</span> message<span>,</span>
        <span>Object</span> data
    <span>)</span> <span>{</span>
        <span>this</span><span>(</span>
          status<span>,</span>
      message
        <span>)</span><span>;</span>
        <span>this</span><span>.</span>data <span>=</span> data<span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Again, the <a href="https://projectlombok.org/features/GetterSetter" target="_blank" rel="noreferrer noopener"><code>@Getter</code></a> and <a href="https://projectlombok.org/features/GetterSetter" target="_blank" rel="noreferrer noopener"><code>@Setter</code></a> annotations were used to avoid boilerplate code and are not mandatory. As you can see, the <code>CustomErrorException</code> class carries the same data used in the <code>ErrorResponse</code> class to better describe what happened and present the errors to the end-users.</p><p>So, you can use this exception to wrap other exceptions, or you can throw it in case of particular circumstances constituting errors in your business logic. Now, let‚Äôs see how with two examples:</p><pre><code><span>// DAO-level method</span>
<span>public</span> <span>Foo</span> <span>retrieveFooById</span><span>(</span>
    <span>int</span> id
<span>)</span> <span>{</span>
    <span>try</span> <span>{</span>
        <span>// data retrieving logic</span>
    <span>}</span> <span>catch</span> <span>(</span><span>NullPointerException</span> e<span>)</span> <span>{</span>
        <span>throw</span> <span>new</span> <span>CustomErrorException</span><span>(</span>
          <span>HttpStatus</span><span>.</span>NOT_FOUND<span>,</span>
          e<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>,</span>
          <span>(</span><span>Integer</span><span>)</span> id
        <span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Here, an insufficiently significant <code>NullPointerException</code> is turned into a more detailed <code>CustomErrorException</code> containing all the data to describe why the error occurred.</p><pre><code><span>// controller-level method method</span>
<span>public</span> <span>ResponseEntity</span><span><span>&lt;</span><span>Void</span><span>&gt;</span></span> <span>performOperation</span><span>(</span>
    <span>int</span> numberOfAttempts
<span>)</span> <span>{</span>
    <span>if</span> <span>(</span>numberOfAttempts <span>&lt;=</span> <span>0</span> <span>||</span> numberOfAttempts <span>&gt;=</span> <span>5</span><span>)</span> <span>{</span>
        <span>throw</span> <span>new</span> <span>CustomErrorException</span><span>(</span>
          <span>HttpStatus</span><span>.</span>BAD_REQUEST<span>,</span>
          <span>&#34;numberOfAttempts must be &gt;= 0 and &lt;= 5!&#34;</span><span>,</span>
          <span>(</span><span>Integer</span><span>)</span> numberOfAttempts
        <span>)</span><span>;</span>
    <span>}</span>
        
    <span>// business logic</span>
<span>}</span></code></pre><p>Similarly, a particular behavior that is not supposed to happen is intercepted. Consequently, a <code>CustomErrorException</code> exception containing all the useful data to represent the error is thrown.</p><p>Lastly, add one method to handle <code>CustomErrorException</code> exception instances to your <code>@ControllerAdvice</code> annotated class, as below:</p><pre><code><span>// src/main/java/com/customerrorhandling/demo/errors/CustomControllerAdvice.java</span>

<span>package</span> <span>com<span>.</span>customerrorhandling<span>.</span>demo<span>.</span>errors</span><span>;</span>

<span>import</span> <span>exceptions<span>.</span></span><span>CustomDataNotFoundException</span><span>;</span>
<span>import</span> <span>exceptions<span>.</span></span><span>CustomErrorException</span><span>;</span>
<span>import</span> <span>exceptions<span>.</span></span><span>CustomParameterConstraintException</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpStatus</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>ResponseEntity</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>ControllerAdvice</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span></span><span>ExceptionHandler</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>PrintWriter</span><span>;</span>
<span>import</span> <span>java<span>.</span>io<span>.</span></span><span>StringWriter</span><span>;</span>

<span>@ControllerAdvice</span>
<span>class</span> <span>CustomControllerAdvice</span> <span>{</span>
    <span>// ...</span>

    <span>@ExceptionHandler</span><span>(</span><span>CustomErrorException</span><span>.</span><span>class</span><span>)</span>
    <span>public</span> <span>ResponseEntity</span><span><span>&lt;</span><span>ErrorResponse</span><span>&gt;</span></span> <span>handleCustomErrorExceptions</span><span>(</span>
            <span>Exception</span> e
    <span>)</span> <span>{</span>
        <span>// casting the generic Exception e to CustomErrorException</span>
        <span>CustomErrorException</span> customErrorException <span>=</span> <span>(</span><span>CustomErrorException</span><span>)</span> e<span>;</span>

        <span>HttpStatus</span> status <span>=</span> customErrorException<span>.</span><span>getStatus</span><span>(</span><span>)</span><span>;</span>

        <span>// converting the stack trace to String</span>
        <span>StringWriter</span> stringWriter <span>=</span> <span>new</span> <span>StringWriter</span><span>(</span><span>)</span><span>;</span>
        <span>PrintWriter</span> printWriter <span>=</span> <span>new</span> <span>PrintWriter</span><span>(</span>stringWriter<span>)</span><span>;</span>
        customErrorException<span>.</span><span>printStackTrace</span><span>(</span>printWriter<span>)</span><span>;</span>
        <span>String</span> stackTrace <span>=</span> stringWriter<span>.</span><span>toString</span><span>(</span><span>)</span><span>;</span>

        <span>return</span> <span>new</span> <span>ResponseEntity</span><span><span>&lt;</span><span>&gt;</span></span><span>(</span>
                <span>new</span> <span>ErrorResponse</span><span>(</span>
                        status<span>,</span>
                        customErrorException<span>.</span><span>getMessage</span><span>(</span><span>)</span><span>,</span>
                        stackTrace<span>,</span>
                        customErrorException<span>.</span><span>getData</span><span>(</span><span>)</span>
                <span>)</span><span>,</span>
                status
        <span>)</span><span>;</span>
    <span>}</span>

    <span>// ...</span>
<span>}</span></code></pre><p>Note that <code>@ExceptionHandler</code> can accept more than one exception type. This means that the parameter of the method representing the exception must be downcasted. Otherwise, a <a href="https://docs.oracle.com/en/java/javase/13/docs/api/java.base/java/lang/ClassCastException.html" target="_blank" rel="noreferrer noopener"><code>ClassCastException</code></a> will be throw. So, upcast the exception <code>e</code> to <code>CustomErrorException</code> inside the method. Then, you will be able to access its particular fields and define a valid <code>ErrorResponse</code> instance.</p><p>Done! This way each error that occurs is encapsulated into an exception containing everything required to describe it.</p><p>Now, let&#39;s see the difference. This is what the default error response on a 404 error would look like:</p><pre><code><span>{</span>
  <span>&#34;timestamp&#34;</span><span>:</span> <span>&#34;2021-15-08T14:32:17.947+0000&#34;</span><span>,</span>
  <span>&#34;status&#34;</span><span>:</span> <span>404</span><span>,</span>
  <span>&#34;error&#34;</span><span>:</span> <span>&#34;Not Found&#34;</span><span>,</span>
  <span>&#34;message&#34;</span><span>:</span> <span>&#34;&#34;</span><span>,</span>
  <span>&#34;path&#34;</span><span>:</span> <span>&#34;/test404&#34;</span>
<span>}</span></code></pre><p>And this is what the custom error response just implemented looks like:</p><pre><code><span>{</span>
  <span>&#34;timestamp&#34;</span><span>:</span> <span>&#34;2021-15-08 14:32:17&#34;</span><span>,</span>
  <span>&#34;code&#34;</span><span>:</span> <span>404</span><span>,</span>
  <span>&#34;status&#34;</span><span>:</span> <span>&#34;NOT_FOUND&#34;</span><span>,</span>
  <span>&#34;message&#34;</span><span>:</span> <span>&#34;Resource not found&#34;</span><span>,</span>
  <span>&#34;stackTrace&#34;</span><span>:</span> &#34;Exception in thread \&#34;main\&#34; com.example.demo.exceptions.CustomErrorException
        at com.example.demo.AuthorController.getAuthor(AuthorController.java<span>:</span><span>16</span>)
        at com.example.demo.AuthorService.getAuthor(AuthorService.java<span>:</span><span>37</span>)
        at com.example.demo.AuthorDao.getById(AuthorDao.java<span>:</span><span>24</span>)&#34;
<span>}</span></code></pre><h3 id="Pros-and-Cons-of-Each-Approach">Pros and Cons of Each Approach</h3><p>The first approach should be used when you do not want to spread error handling logic all over your codebase. In fact, the HTTP status code is only associated with errors in your <code>@ControllerAdvice</code> annotated class. This means that no layer knows how the error will be handled and presented to users. Although this should be the desired behavior because it respects the <a href="https://en.wikipedia.org/wiki/Principle_of_least_privilege" target="_blank" rel="noreferrer noopener">principle of least privilege</a>, it does involve boilerplate code. In fact, you may easily end up with dozens of custom exceptions, and define them is a tedious and not-scalable approach.</p><p>So, you may want a less restricting approach, and this is why the second approach was presented. Unfortunately, this one is definitely dirtier. In fact, it requires you to spread detail about error handling logic in many different points of your code. In contrast, it is scalable and quicker to be implemented. So, despite not being the cleanest approach, it allows you to achieve the desired result with little effort. Plus, it is more maintainable than the first approach because it involves only a custom exception.</p><h2 id="Custom-Error-Handling-in-Spring-Security">Custom Error Handling in Spring Security</h2><p><a href="https://spring.io/projects/spring-security" target="_blank" rel="noreferrer noopener">Spring Security</a> is a powerful and highly customizable framework that provides both authentication and authorization. It is one of the most widely used Spring dependencies and represents the de-facto standard for securing a Spring Boot application.</p><p>In case of authentication and authorization failures, <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/core/AuthenticationException.html" target="_blank" rel="noreferrer noopener"><code>AuthenticationException</code></a> and <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/access/AccessDeniedException.html" target="_blank" rel="noreferrer noopener"><code>AccessDeniedException</code></a> are thrown respectively. Then, Spring Security takes care of encapsulating them in default error handling responses. If you want to customize them, the two approaches presented above are of no use. This is because <code>@ControllerAdvice</code> can handle only exceptions thrown by controllers, but <code>AuthenticationException</code> and <code>AccessDeniedException</code> are thrown by the Spring Security <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/access/intercept/AbstractSecurityInterceptor.html" target="_blank" rel="noreferrer noopener"><code>AbstractSecurityInterceptor</code></a> component - which is not a controller. In other words, a <code>@ControllerAdvice</code> annotated class cannot catch them. Achieving this requires custom logic. </p><h3 id="Implementing-Custom-Error-Handling-Logic-in-Spring-Security">Implementing Custom Error Handling Logic in Spring Security</h3><p>Let‚Äôs take a look at how to implement custom error handling in Spring Security. Luckily, this is not too complex since you can easily provide Spring Security with two components to handle authentication and authorization errors, respectively. What you need to do is to provide the <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/web/authentication/AuthenticationFailureHandler.html" target="_blank" rel="noreferrer noopener"><code>AuthenticationFailureHandler</code></a> interface with implementation, as follows:</p><pre><code><span>// src/main/java/com/auth0/hotsauces/security/CustomAuthenticationFailureHandler.java</span>

<span>package</span> <span>com<span>.</span>auth0<span>.</span>hotsauces<span>.</span>security</span><span>;</span>

<span>import</span> <span>com<span>.</span>fasterxml<span>.</span>jackson<span>.</span>annotation<span>.</span></span><span>JsonFormat</span><span>;</span>
<span>import</span> <span>com<span>.</span>fasterxml<span>.</span>jackson<span>.</span>databind<span>.</span></span><span>ObjectMapper</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpStatus</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>core<span>.</span></span><span>AuthenticationException</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>web<span>.</span>authentication<span>.</span></span><span>AuthenticationFailureHandler</span><span>;</span>
<span>import</span> <span>java<span>.</span>util<span>.</span></span><span>*</span><span>;</span>
<span>import</span> <span>javax<span>.</span>servlet<span>.</span>http<span>.</span></span><span>HttpServletRequest</span><span>;</span>
<span>import</span> <span>javax<span>.</span>servlet<span>.</span>http<span>.</span></span><span>HttpServletResponse</span><span>;</span>
<span>import</span> <span>java<span>.</span>util<span>.</span></span><span>HashMap</span><span>;</span>

<span>public</span> <span>class</span> <span>CustomAuthenticationFailureHandler</span> <span>implements</span> <span>AuthenticationFailureHandler</span> <span>{</span>
    <span>// Jackson JSON serializer instance</span>
    <span>private</span> <span>ObjectMapper</span> objectMapper <span>=</span> <span>new</span> <span>ObjectMapper</span><span>(</span><span>)</span><span>;</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>onAuthenticationFailure</span><span>(</span>
      <span>HttpServletRequest</span> request<span>,</span>
      <span>HttpServletResponse</span> response<span>,</span>
      <span>AuthenticationException</span> exception
    <span>)</span> <span>throws</span> <span>IOException</span><span>,</span> <span>ServletException</span> <span>{</span> 
        <span>HttpStatus</span> httpStatus <span>=</span> <span>HttpStatus</span><span>.</span>UNAUTHORIZED<span>;</span> <span>// 401        </span>

        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>&gt;</span></span> data <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
        data<span>.</span><span>put</span><span>(</span>
          <span>&#34;timestamp&#34;</span><span>,</span> 
          <span>new</span> <span>Date</span><span>(</span><span>)</span>
        <span>)</span><span>;</span>
        data<span>.</span><span>put</span><span>(</span>
          <span>&#34;code&#34;</span><span>,</span> 
          httpStatus<span>.</span><span>value</span><span>(</span><span>)</span><span>;</span>
        <span>)</span><span>;</span>
        data<span>.</span><span>put</span><span>(</span>
          <span>&#34;status&#34;</span><span>,</span> 
          httpStatus<span>.</span><span>name</span><span>(</span><span>)</span><span>;</span>
        <span>)</span><span>;</span>
        data<span>.</span><span>put</span><span>(</span>
          <span>&#34;message&#34;</span><span>,</span> 
          exception<span>.</span><span>getMessage</span><span>(</span><span>)</span>
        <span>)</span><span>;</span>
        
        <span>// setting the response HTTP status code</span>
        response<span>.</span><span>setStatus</span><span>(</span>httpStatus<span>.</span><span>value</span><span>(</span><span>)</span><span>)</span><span>;</span>
        
        <span>// serializing the response body in JSON</span>
        response
          <span>.</span><span>getOutputStream</span><span>(</span><span>)</span>
          <span>.</span><span>println</span><span>(</span>
              objectMapper<span>.</span><span>writeValueAsString</span><span>(</span>data<span>)</span>
          <span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>This will be used to handle <code>AuthenticationExceptions</code>.</p><p>Similarly, you can provide the <a href="https://docs.spring.io/spring-security/site/docs/current/api/org/springframework/security/web/access/AccessDeniedHandler.html" target="_blank" rel="noreferrer noopener"><code>AccessDeniedHandler</code></a> interface with implementation to handle <code>AccessDeniedExceptions</code>.</p><pre><code><span>// src/main/java/com/auth0/hotsauces/security/CustomAccessDeniedHandler.java</span>

<span>package</span> <span>com<span>.</span>auth0<span>.</span>hotsauces<span>.</span>security</span><span>;</span>

<span>import</span> <span>com<span>.</span>fasterxml<span>.</span>jackson<span>.</span>annotation<span>.</span></span><span>JsonFormat</span><span>;</span>
<span>import</span> <span>com<span>.</span>fasterxml<span>.</span>jackson<span>.</span>databind<span>.</span></span><span>ObjectMapper</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>http<span>.</span></span><span>HttpStatus</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>core<span>.</span></span><span>AuthenticationException</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>web<span>.</span>authentication<span>.</span></span><span>AuthenticationFailureHandler</span><span>;</span>
<span>import</span> <span>java<span>.</span>util<span>.</span></span><span>*</span><span>;</span>
<span>import</span> <span>javax<span>.</span>servlet<span>.</span>http<span>.</span></span><span>HttpServletRequest</span><span>;</span>
<span>import</span> <span>javax<span>.</span>servlet<span>.</span>http<span>.</span></span><span>HttpServletResponse</span><span>;</span>
<span>import</span> <span>java<span>.</span>util<span>.</span></span><span>HashMap</span><span>;</span>

<span>public</span> <span>class</span> <span>CustomAccessDeniedHandler</span> <span>implements</span> <span>AccessDeniedHandler</span> <span>{</span>
    <span>// Jackson JSON serializer instance</span>
    <span>private</span> <span>ObjectMapper</span> objectMapper <span>=</span> <span>new</span> <span>ObjectMapper</span><span>(</span><span>)</span><span>;</span>

    <span>@Override</span>
    <span>public</span> <span>void</span> <span>handle</span><span>(</span>
      <span>HttpServletRequest</span> request<span>,</span>
      <span>HttpServletResponse</span> response<span>,</span>
      <span>AccessDeniedException</span> exception
    <span>)</span> <span>throws</span> <span>IOException</span><span>,</span> <span>ServletException</span> <span>{</span> 
        <span>HttpStatus</span> httpStatus <span>=</span> <span>HttpStatus</span><span>.</span>FORBIDDEN<span>;</span> <span>// 403        </span>

        <span>Map</span><span><span>&lt;</span><span>String</span><span>,</span> <span>Object</span><span>&gt;</span></span> data <span>=</span> <span>new</span> <span>HashMap</span><span><span>&lt;</span><span>&gt;</span></span><span>(</span><span>)</span><span>;</span>
        data<span>.</span><span>put</span><span>(</span>
          <span>&#34;timestamp&#34;</span><span>,</span> 
          <span>new</span> <span>Date</span><span>(</span><span>)</span>
        <span>)</span><span>;</span>
        data<span>.</span><span>put</span><span>(</span>
          <span>&#34;code&#34;</span><span>,</span> 
          httpStatus<span>.</span><span>value</span><span>(</span><span>)</span><span>;</span>
        <span>)</span><span>;</span>
        data<span>.</span><span>put</span><span>(</span>
          <span>&#34;status&#34;</span><span>,</span> 
          httpStatus<span>.</span><span>name</span><span>(</span><span>)</span><span>;</span>
        <span>)</span><span>;</span>
        data<span>.</span><span>put</span><span>(</span>
          <span>&#34;message&#34;</span><span>,</span> 
          exception<span>.</span><span>getMessage</span><span>(</span><span>)</span>
        <span>)</span><span>;</span>
        
        <span>// setting the response HTTP status code</span>
        response<span>.</span><span>setStatus</span><span>(</span>httpStatus<span>.</span><span>value</span><span>(</span><span>)</span><span>)</span><span>;</span>
        
        <span>// serializing the response body in JSON</span>
        response
          <span>.</span><span>getOutputStream</span><span>(</span><span>)</span>
          <span>.</span><span>println</span><span>(</span>
              objectMapper<span>.</span><span>writeValueAsString</span><span>(</span>data<span>)</span>
          <span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Now, you just need to register these two custom implementations as authentication and authorization error handlers. You can do this as below:</p><pre><code><span>// src/main/java/com/auth0/hotsauces/security/SecurityConfig.java</span>

<span>package</span> <span>com<span>.</span>auth0<span>.</span>hotsauces<span>.</span>security</span><span>;</span>

<span>import</span> <span>org<span>.</span>springframework<span>.</span>beans<span>.</span>factory<span>.</span>annotation<span>.</span></span><span>Value</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Bean</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>config<span>.</span>annotation<span>.</span>web<span>.</span>builders<span>.</span></span><span>HttpSecurity</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>config<span>.</span>annotation<span>.</span>web<span>.</span>configuration<span>.</span></span><span>EnableWebSecurity</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>config<span>.</span>annotation<span>.</span>web<span>.</span>configuration<span>.</span></span><span>WebSecurityConfigurerAdapter</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>core<span>.</span></span><span>DelegatingOAuth2TokenValidator</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>core<span>.</span></span><span>OAuth2TokenValidator</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>jwt<span>.</span></span><span>*</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>server<span>.</span>resource<span>.</span>web<span>.</span></span><span>BearerTokenAuthenticationFilter</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>web<span>.</span>access<span>.</span></span><span>AccessDeniedHandler</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>security<span>.</span>web<span>.</span>authentication<span>.</span></span><span>AuthenticationFailureHandler</span><span>;</span>

<span>@EnableWebSecurity</span>
<span>public</span> <span>class</span> <span>SecurityConfig</span> <span>extends</span> <span>WebSecurityConfigurerAdapter</span> <span>{</span>
    <span>// ...</span>

    <span>@Override</span>
    <span>protected</span> <span>void</span> <span>configure</span><span>(</span><span>HttpSecurity</span> http<span>)</span> 
      <span>throws</span> <span>Exception</span> <span>{</span>
        http
          <span>.</span><span>authorizeRequests</span><span>(</span><span>)</span>
          <span>.</span><span>anyRequest</span><span>(</span><span>)</span>
          <span>.</span><span>authenticated</span><span>(</span><span>)</span>
          <span>.</span><span>and</span><span>(</span><span>)</span>
          <span>.</span><span>formLogin</span><span>(</span><span>)</span>
          <span>.</span><span>failureHandler</span><span>(</span><span>authenticationFailureHandler</span><span>(</span><span>)</span><span>)</span> 
          <span>.</span><span>and</span><span>(</span><span>)</span>
          <span>.</span><span>exceptionHandling</span><span>(</span><span>)</span>
          <span>.</span><span>accessDeniedHandler</span><span>(</span><span>accessDeniedHandler</span><span>(</span><span>)</span><span>)</span><span>;</span>
    <span>}</span>

    <span>@Bean</span>
    <span>public</span> <span>AuthenticationFailureHandler</span> <span>authenticationFailureHandler</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> <span>new</span> <span>CustomAuthenticationFailureHandler</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>@Bean</span>
    <span>public</span> <span>AccessDeniedHandler</span> <span>accessDeniedHandler</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> <span>new</span> <span>CustomAccessDeniedHandler</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Et voil√†! Custom error handling in Spring Boot has just been achieved thanks to the <code>failureHandler</code> and <code>accessDeniedHandler</code> methods, which allows you to register a custom authentication error handler and a custom authorization error handler.</p><h3 id="Spring-Security-Custom-Error-Handling-in-Action">Spring Security Custom Error Handling in Action</h3><p>Now, let‚Äôs see how to implement it in a real-world example. First, read <a href="https://auth0.com/blog/build-and-secure-an-api-with-spring-boot/" target="_blank" rel="noreferrer noopener">this</a> article on how to protect APIs with Spring Security and Auth0. In the demo application produced in that article, no custom error handling is implemented. So, by making a request to a protected API including a wrong access token, the default Spring Boot error handling logic is applied. Let‚Äôs test it out.</p><p>If you are a macOS or Linux user, enter this command into the terminal:</p><pre><code>curl <span>-</span>i <span>--</span>request <span>GET</span> \
     <span>--</span>url http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>api<span>/</span>hotsauces<span>/</span> \
     <span>-</span><span>H</span> <span>&#34;Content-Type: application/json&#34;</span> \
     <span>-</span><span>H</span> <span>&#34;authorization: Bearer wrong-token&#34;</span></code></pre><p>Otherwise, if you are a Windows user, enter this command into PowerShell:</p><pre><code>$accessToken <span>=</span> <span>&#34;wrong-token&#34;</span>
$headers <span>=</span> @<span>{</span>
    Authorization <span>=</span> <span>&#34;Bearer $accessToken&#34;</span>
<span>}</span>
$response <span>=</span> Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces/&#34;</span> `
    <span>-</span>Headers $headers
$response <span>|</span> ConvertTo<span>-</span>Json</code></pre><p>Then, the following response will be returned:</p><pre><code>Invoke<span>-</span>WebRequest<span>:</span> The remote server returned an error<span>:</span> <span>(</span><span>401</span><span>)</span> Unauthorized<span>.</span>
At line<span>:</span><span>1</span> char<span>:</span><span>1</span>
<span>+</span> Invoke<span>-</span>WebRequest <span>&#34;http://localhost:8080/api/hotsauces/&#34;</span>
<span>+</span> <span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span>
<span>+</span> CategoryInfo          <span>:</span> InvalidOperation<span>:</span> <span>(</span>System<span>.</span>Net<span>.</span>HttpWebRequest<span>:</span>HttpWebRequest<span>)</span> <span>[</span>Invoke<span>-</span>WebRequest<span>]</span><span>,</span> WebExc
   eption
<span>+</span> FullyQualifiedErrorId <span>:</span> WebCmdletWebResponseException<span>,</span>Microsoft<span>.</span>PowerShell<span>.</span>Commands<span>.</span>InvokeWebRequestCommand</code></pre><p>As you can see, a 401 error status code is returned, but with no details on what happened.</p><p>Now, let‚Äôs test the demo application extended with custom error handling logic. You can find it in <a href="https://github.com/Tonel/HotSauces" target="_blank" rel="noreferrer noopener">this GitHub repository</a>. The application is exactly the same as the previous one, except for the error handling logic. In particular, the aforementioned presented logic was implemented. </p><p>In this case, by launching the commands above, this message will be returned:</p><pre><code>Invoke<span>-</span>RestMethod <span>:</span> <span>{</span><span>&#34;code&#34;</span><span>:</span><span>401</span><span>,</span><span>&#34;message&#34;</span><span>:</span><span>&#34;An error occurred while attempting to decode the Jwt: Invalid JWT serialization: Missing dot delimiter(s)&#34;</span><span>,</span><span>&#34;timestamp&#34;</span><span>:</span><span>1629880611013</span><span>,</span><span>&#34;status&#34;</span><span>:</span><span>&#34;UNAUTHORIZED&#34;</span><span>}</span>
At line<span>:</span><span>1</span> char<span>:</span><span>1</span>
<span>+</span> $response <span>=</span> Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces/&#34;</span>  <span>...</span>
<span>+</span> <span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span>
<span>+</span> CategoryInfo          <span>:</span> InvalidOperation<span>:</span> <span>(</span>System<span>.</span>Net<span>.</span>HttpWebRequest<span>:</span>HttpWebRequest<span>)</span> <span>[</span>Invoke<span>-</span>WebRequest<span>]</span><span>,</span> WebExc
   eption
<span>+</span> FullyQualifiedErrorId <span>:</span> WebCmdletWebResponseException<span>,</span>Microsoft<span>.</span>PowerShell<span>.</span>Commands<span>.</span>InvokeWebRequestCommand</code></pre><p>As you can see, a JSON message representing the custom error handling logic was returned as expected. This contains the status code, the exception message, a timestamp, and the HTTP status code name, as follows:</p><pre><code><span>{</span>
  <span>&#34;code&#34;</span><span>:</span> <span>401</span><span>,</span>
  <span>&#34;message&#34;</span><span>:</span> <span>&#34;An error occurred while attempting to decode the Jwt: Invalid JWT serialization: Missing dot delimiter(s)&#34;</span><span>,</span>
  <span>&#34;timestamp&#34;</span><span>:</span> <span>1629880611013</span><span>,</span>
  <span>&#34;status&#34;</span><span>:</span> <span>&#34;UNAUTHORIZED&#34;</span>
<span>}</span></code></pre><h2 id="Conclusion">Conclusion</h2><p>In this article, we looked at how to implement custom error handling logic when dealing with REST applications in Spring Boot. This is not as easy a task as it may seem, and it requires knowing a few Spring Boot fundamentals. First, we delved into default error handling in Spring Boot and saw how poor the responses are. Then, we looked at <code>@ControllerAdvice</code> and learn everything required to implement custom error handling logic. In particular, two different approaches were shown. Both allow you to define custom error handling responses but have specific pros and cons. Finally, we learned how to achieve the same result when dealing with Spring Boot Security errors, which requires specific logic. As shown, achieving custom error handling in Spring Boot is not easy but definitely possible, and explaining when, why, and how to do it was what this article was aimed at.</p><p>Thanks for reading! I hope that you found this article helpful. Feel free to reach out to me with any questions, comments, or suggestions.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 27 Sep 2021 15:29:00 +0000</pubDate>
    </item>
    <item>
      <title>ID Token and Access Token: What Is the Difference?</title>
      <link>https://auth0.com/blog/id-token-access-token-what-is-the-difference/</link>
      <description>Learn what ID and access tokens are and how to correctly use them in the OpenID Connect and OAuth context.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>&#34;Let‚Äôs use a token to secure this API call. Should I use the ID token or the access token? ü§î The ID token looks nicer to me. After all, if I know who the user is, I can make better authorization decisions, right?&#34;</p><p>How many times have you found yourself making similar arguments? Choices based on your intuition may sound good, however, what looks intuitive not always is correct. In the case of ID and access tokens, they have clear and well-defined purposes, so you should use them based on that, not on your intuition.</p><p>&#34;What changes after all? They are just tokens. I can use them as I see fit. What can happen?&#34;</p><p>Let‚Äôs take a closer look at these two security tokens to better understand their role in authentication and authorization processes.</p><p>If you prefer, you can also watch this video on the same topic:</p><p><iframe src="https://www.youtube.com/embed/M4JIvUIE17c" frameborder="0" allowfullscreen=""></iframe></p><h2 id="What-Is-an-ID-Token-">What Is an ID Token?</h2><p>An ID token is an artifact that proves that <strong>the user has been authenticated</strong>. <a href="https://openid.net/connect/" target="_blank" rel="noreferrer noopener">OpenID Connect</a> provides you with it as the result of the user authentication process. By the way, OpenID Connect is an open standard for decentralized authentication used by many Identity providers such as Google, Facebook, Twitter, and, of course, Auth0. Check out <a href="https://auth0.com/docs/protocols/openid-connect-protocol" target="_blank" rel="noreferrer noopener">this document for more details on OpenID Connect</a>.</p><p>Well, this is a very basic definition of what an ID token is. Let‚Äôs see some other details.</p><p>An ID token is <strong>encoded as a JSON Web Token</strong> (JWT), a standard format that allows your application to easily inspect its content and make sure it comes from the expected issuer and no one else changed it. If you want to learn more on JWTs, check out <a href="https://auth0.com/resources/ebooks/jwt-handbook" target="_blank" rel="noreferrer noopener">The JWT Handbook</a>.</p><p>To put it simply, an example of ID token looks like this:</p><pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<span>.</span>eyJpc3MiOiJodHRwOi8vbXktZG9tYWluLmF1dGgwLmNvbSIsInN1YiI6ImF1dGgwfDEyMzQ1NiIsImF1ZCI6IjEyMzRhYmNkZWYiLCJleHAiOjEzMTEyODE5NzAsImlhdCI6MTMxMTI4MDk3MCwibmFtZSI6IkphbmUgRG9lIiwiZ2l2ZW5fbmFtZSI6IkphbmUiLCJmYW1pbHlfbmFtZSI6IkRvZSJ9<span>.</span>bql<span>-</span>jxlG9B_bielkqOnjTY9Di9FillFb6IMQINXoYsw</code></pre><p>Of course, this isn&#39;t readable to the human eye, so you have to decode it to see what content the JWT holds. You can use one of the <a href="https://jwt.io/#libraries-io" target="_blank" rel="noreferrer noopener">many available libraries</a> to decode it or you can examine it yourself with the <a href="https://jwt.io/?id_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwOi8vbXktZG9tYWluLmF1dGgwLmNvbSIsInN1YiI6ImF1dGgwfDEyMzQ1NiIsImF1ZCI6IjEyMzRhYmNkZWYiLCJleHAiOjEzMTEyODE5NzAsImlhdCI6MTMxMTI4MDk3MCwibmFtZSI6IkphbmUgRG9lIiwiZ2l2ZW5fbmFtZSI6IkphbmUiLCJmYW1pbHlfbmFtZSI6IkRvZSJ9.bql-jxlG9B_bielkqOnjTY9Di9FillFb6IMQINXoYsw" target="_blank" rel="noreferrer noopener">jwt.io</a> debugger.</p><p>Without going deeper into the details, the relevant information carried by the ID token above looks like the following:</p><pre><code><span>{</span> 
  <span>&#34;iss&#34;</span><span>:</span> <span>&#34;http://my-domain.auth0.com&#34;</span><span>,</span> 
  <span>&#34;sub&#34;</span><span>:</span> <span>&#34;auth0|123456&#34;</span><span>,</span> 
  <span>&#34;aud&#34;</span><span>:</span> <span>&#34;1234abcdef&#34;</span><span>,</span> 
  <span>&#34;exp&#34;</span><span>:</span> <span>1311281970</span><span>,</span> 
  <span>&#34;iat&#34;</span><span>:</span> <span>1311280970</span><span>,</span> 
  <span>&#34;name&#34;</span><span>:</span> <span>&#34;Jane Doe&#34;</span><span>,</span> 
  <span>&#34;given_name&#34;</span><span>:</span> <span>&#34;Jane&#34;</span><span>,</span> 
  <span>&#34;family_name&#34;</span><span>:</span> <span>&#34;Doe&#34;</span>
<span>}</span></code></pre><p>These JSON properties are called <strong>claims</strong>, and they are <strong>declarations about the user</strong> and the token itself. The claims about the user define the user‚Äôs identity. Hence the name &#34;ID token&#34;.</p><p>One of the claims that is usually underrated is the <code>aud</code> claim. This claim defines the <strong>audience</strong> of the token, i.e., the application that is meant as <strong>the final recipient of the token</strong>. Its value is the client ID of the application that should use the token.</p><blockquote><p>Remember this small detail about the audience claim because it will help you better understand what its correct use is later on.</p></blockquote><p>Optionally, the ID token may have additional information about the user, such as their email address, picture, birthday, and so on.</p><p>Cool! Now you know what an ID token is. But, what can you do with an ID token?</p><p>First, it demonstrates that the user has been authenticated and so <strong>you can trust their identity</strong>.</p><p>Also, your application can <strong>personalize the user‚Äôs experience</strong> by using the claims about the user included in the ID token. For example, you can show their name on the UI, or display a wish message on their birthday. The fun part is that you don‚Äôt need to make additional requests, so you may get <strong>a little gain in performance</strong> for your application.</p><h2 id="What-Is-an-Access-Token-">What Is an Access Token?</h2><p>Now that you know what an ID token is, let‚Äôs try to understand what an access token is.</p><p>As the name says, an access token is an artifact that <strong>allows you to access a resource</strong>. That resource can be a file, an API, a database, or anything else which is protected from unauthorized access. The authorization server issues the access token.</p><p>In the <a href="https://auth0.com/docs/protocols/protocol-oauth2" target="_blank" rel="noreferrer noopener">OAuth 2</a> context, the access token <strong>allows an application to access a specific resource on behalf of the user</strong>. That means, for example, that you can authorize your LinkedIn app to access Twitter‚Äôs API on your behalf to cross-post on both social platforms.</p><p><a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_blank" rel="noreferrer noopener">OAuth 2 specifications</a> say nothing about the access token format. It <strong>can be a string in any format</strong>. A common format used for access tokens is JWT, and <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-access-token-jwt" target="_blank" rel="noreferrer noopener">a standard is along the way</a> at the time of writing. However, this doesn‚Äôt mean that access tokens should be in that format. Keep the following in mind: <strong>your client application should treat access tokens as opaque strings</strong>, that is, a string with no specific meaning such as <code>ab5<span>?</span><span>2</span>Gtse9ITg</code> or <code><span>1234</span></code> and so on.</p><p>Only the intended recipient of the access token can (and must) make assumptions on the access token‚Äôs format. Wait! Who is the intended recipient of an access token? ü§î <strong>The intended recipient is the resource server</strong>, that is, the server that protects the resource your application is trying to access.</p><p>Last but not least, an access token is not bound to a specific client. It can be used by any application that presents it: <strong>it grants authorization to its bearer</strong>. This is extremely important since you need to take care of it and avoid it falling into the wrong hands.</p><p>Alright! Now you know what an ID token and an access token are. üéâ So you are ready to use them without any fear of making mistakes. But, wait. I do not see you convinced. ü§î Maybe you need some other information. Ok. So, let‚Äôs see what these tokens are <em>not</em> suitable for.</p><h2 id="What-Is-an-ID-Token-NOT-Suitable-For-">What Is an ID Token NOT Suitable For?</h2><p>One of the most common mistakes developers make with an ID token is to use it for authorization. As said above, an ID token has to do with authentication. It <strong>is not meant for authorization</strong>.</p><p>If your API accepts an ID token as an authorization token, to begin with, you are ignoring the intended recipient stated by the audience claim. That claim says that it is meant for your client application, not for the resource server (i.e., the API).</p><p>You may think this is just a formality, but <strong>there are security implications</strong> here.</p><p>First of all, your API shouldn‚Äôt accept a token that is not meant for it. If it does so, its security is at risk. In fact, if your API doesn&#39;t care if a token is meant for it, an ID token stolen from any client application can be used to access your API.</p><p>In addition, your ID token will not have granted <a href="https://auth0.com/docs/scopes" target="_blank" rel="noreferrer noopener">scopes</a> (I know, this is another pain point). To briefly explain, OAuth has a specific process to allow the user to grant the minimum permissions (scopes) to the application. Those scopes are associated with the access token so that your API knows what the client application can do and what it can&#39;t do. If you use an ID token, you ignore this feature and potentially allow the application to do actions that the user has not authorized.</p><p>Another mistake you can make with ID tokens is to use them for user session management. An ID token <strong>isn‚Äôt an appropriate choice for session management</strong>. In fact, ID tokens have a few specific drawbacks. First, they are larger than a typical session cookie. You need to validate them on the server side just to check if the session is still alive. You also cannot remove them from the client application at the end of a session, e.g., at logout. It requires the active collaboration of the client, but this is not something you can rely on.</p><h2 id="What-Is-an-Access-Token-NOT-Suitable-For-">What Is an Access Token NOT Suitable For?</h2><p>As you guess, on the access token side, you can‚Äôt use it for authentication. I mean, <strong>you can‚Äôt make any assumption about the user‚Äôs identity</strong> based on the access token. The access token can‚Äôt tell you if the user has authenticated. <strong>You can‚Äôt ever deduce that the user is currently logged in</strong> to your application. Based on the OAuth specifications, the access token authorizes the client application to operate on behalf of the user. Once the application is authorized, the user can log out with no issue and the access token will continue to work.</p><p>In addition, the access token <strong>has nothing to tell the client application</strong>. It is intended for the resource server. Even if you know the access token format, you shouldn‚Äôt try to interpret the access token content in your client application. The access token format is an agreement between the authorization server and the resource server. Period! The client application should not intrude.</p><h2 id="A-Quick-Recap">A Quick Recap</h2><p>The confusion over the use of ID and access tokens is very common, and it can be difficult to wrap your head around the differences. And maybe it mostly derives from the difference between authentication and authorization that also confuses many developers. Nevertheless, I hope this topic is a little more clear now.</p><p>To recap, here is a quick summary of what you learned about what you can and can‚Äôt do with ID and access tokens:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6OoxJnwLaEumCzNxa53J1f/473d3e0483e8a06b2318175ca1b03f16/id-token-vs-access-token.jpg" alt="ID token vs access token"/></p><p>If you want to see ID and access tokens in action, <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free Auth0 account</a> and start to add authentication and authorization to your applications in minutes with <a href="https://auth0.com/docs/libraries" target="_blank" rel="noreferrer noopener">your preferred programming language and framework</a>.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 23 Sep 2021 14:31:00 +0000</pubDate>
    </item>
    <item>
      <title>How to Explain Public-Key Cryptography and Digital Signatures to Anyone</title>
      <link>https://auth0.com/blog/how-to-explain-public-key-cryptography-digital-signatures-to-anyone/</link>
      <description>Here‚Äôs an easy-to-understand analogy to help your non-technical friends and customers understand public keys and private keys, and how they relate to cryptography and digital signatures.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>If you work in cybersecurity or any computer-related field, sooner or later, you‚Äôll have to explain public-key cryptography and digital signatures to non-technical people.</strong> With the recent rise of remote work and stories about system breaches, computer security has become a topic of discussion even among laypeople.</p><p>After trying to explain public-key cryptography and digital signatures to some clients with varying degrees of success, I wanted to develop an analogy that explained them and was easy to remember. I‚Äôve found that even techies get confused by the formal definitions, and many non-technical explanations just seem unsatisfying.</p><p>That‚Äôs when I stumbled upon <a href="https://twitter.com/vrypan" target="_blank" rel="noreferrer noopener">Panayotis Vryonis‚Äô</a> article, <a href="https://blog.vrypan.net/2013/08/28/public-key-cryptography-for-non-geeks/" target="_blank" rel="noreferrer noopener"><em>Public-key cryptography for non-geeks</em></a>. It became my go-to analogy until my computer science professor, <a href="http://research.cs.queensu.ca/home/dawes/" target="_blank" rel="noreferrer noopener">Dr. Robin Dawes</a> pointed out a flaw. I refined it with his help, and a suggestion from Matthew Ernest, and the result is below. I hope you find it helpful when trying to explain these concepts to anyone!</p><h2 id="The-Box">The Box</h2><p>Imagine a box with a special lock, as pictured below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4nm7EvXpqVqMxfOPkjUlXe/bca6b7d8d0a00658045dd4f3fd0a5c7f/the_box_has_a_lock_with_three_positions.png" alt="Photo of a box with a lock. There is a key inserted into the lock. Caption: &#34;The box has a lock with three positions: Locked (at the 9:00 position), unlocked (at the 12:00 position), and locked (at the 3:00 position).&#34;"/></p><p>The lock has three positions:</p><ol start="1"><li>When the lock is at the ‚Äú9:00‚Äù position, the box is locked, and its contents are inaccessible.</li><li>When the lock is at the ‚Äú12:00‚Äù position, the box is unlocked, which means you can open it and view its contents.</li><li>When the lock is at the ‚Äú3:00‚Äù position, the box is locked, and its contents are inaccessible.</li></ol><p>In order to avoid wandering into endless ‚ÄúWhat if...?‚Äù tangents, assume that it‚Äôs prohibitively costly to pick the lock or break the box.</p><h2 id="The-Keys">The Keys</h2><p>There are two kinds of keys that work with the box‚Äôs lock.</p><h3 id="The-private-key">The private key</h3><p>The first kind of key belongs to you, and only you. You don‚Äôt share it with anyone else, which is why it‚Äôs called the <strong>private key</strong>. You might make a backup copy in case of emergencies, but you keep it in a safe place that only you know.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2PJXCaqzggdgTpN4FSm8Qj/4a1228e2e8a6a46ad103c01ffd197e58/you_keep_the_private_key_to_yourself.png" alt="Photo of a single key. Caption: &#34;You keep the private key to yourself.&#34;"/></p><p>The private key fits the lock, but it has a particular limitation: it can only turn <em>clockwise</em>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/qqPVi6JTc2HOW4SuE4sEj/8fcd841021e55b659a3c5b92ad9b2da2/the_private_key_only_turns_clockwise.png" alt="Photo of the box with lock and key. An arrow indicates that the key is being turned clockwise. Caption: &#34;The private key only turns clockwise.&#34;"/></p><h3 id="The-public-key">The public key</h3><p>You treat the second kind of key very differently. Unlike the first key, you‚Äôve made many, many copies of these keys. You‚Äôve given them to everyone you know, and even people you don‚Äôt know. You‚Äôve left them in as many public places as you could reach: restaurants, stores, busy streets, dark alleys, and any place you happened to pass through. You‚Äôve even left them in other towns, and even other countries! Because of the way you treat this key, it‚Äôs called the <strong>public key</strong>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2LTNf9JxfjDuB4rMZyM7K6/4a3a6264b81bf2b90efaffe469d3406c/you_hand_out_copies_of_the_public_key_freely.png" alt="Photo of hundreds of keys hanging on hooks on a wall. Caption: &#34;You hand out copies of the public key freely.&#34;"/></p><p>Like the private key, public keys also fit the lock, and they also have a particular limitation ‚Äî but in the opposite direction. They can only turn <em>counterclockwise</em>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6QVsGSSoLuNdRgpfHznh6H/b5f42c68a9d5aa9e322e898cac14aeb3/the_public_key_only_turns_counterclockwise.png" alt="Photo of the box with lock and key. An arrow indicates that the key is being turned counterclockwise. Caption: &#34;The public key only turns counterclockwise.&#34;"/></p><h2 id="How-They-Work-Together">How They Work Together</h2><p>The lock, private key, and public keys work together to produce these interesting outcomes:</p><ul><li>If the box is locked with a public key, only the private key can unlock it.</li><li>If the box is locked with the private key, only a public key can unlock it.</li></ul><p>The keys are designed so that you can‚Äôt use one key to figure out how to make the other key.</p><p>We can use the box and keys to create two useful kinds of secure communication:</p><ol start="1"><li>I can send you a secret message.</li><li>You can send me a message with proof that you (and not some impostor) sent it and that it wasn‚Äôt altered <em>en route</em>.</li></ol><p>Let‚Äôs take a closer look at each of these kinds of secure communication.</p><h2 id="Sending-Secret-Messages">Sending Secret Messages</h2><p>Suppose I wanted to send you a message that I wanted only you to read. We have enemies in common who‚Äôd love nothing more than to know what‚Äôs in the messages I send you.</p><p>We each have a cadre of minions to deliver our messages. We trust them... to a limited extent. It would be all too easy for our foes to intercept our messages through force or bribery. </p><p>There must be a way to send messages to you secretly, and that‚Äôs where the box comes in. I can use the box to send the message so that no one but you can read it. </p><p>You have the only private key. Everyone else has at least one of the public keys because you‚Äôve been giving them away like candy. </p><p>I put my message in the open box. Since it‚Äôs open, it‚Äôs unlocked, which means the lock is at the ‚Äú12:00‚Äù position. </p><p>I use one of the many copies of the public key that I own to lock it, turning it counterclockwise from the unlocked ‚Äú12:00‚Äù position to the locked ‚Äú9:00‚Äù position.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3WnNKlXN7MC0BfDdEU8GyX/2bcc1521f829c80ff548cf7234078bba/i_lock_the_message_with_public_key.png" alt="Photo of the box with lock and key. An arrow indicates that the key is being turned counterclockwise. Caption: &#34;I lock the message in the box with the public key...&#34;"/></p><p>The message is now ready for a minion to deliver to you.</p><p>I‚Äôm not worried that my minion or anyone other than you will be able to read the message while it‚Äôs in transit. Even though anyone can easily find the public key, they can‚Äôt use it to unlock the box. Only the private key can unlock the box if it‚Äôs been locked with the public key.</p><p>When you receive the box, you use the private key to unlock it, turning the key clockwise from the ‚Äú3:00‚Äù position to the ‚Äú12:00‚Äù position.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2kwG5ogtYDYCkDtjC0MqgN/75f2cb365ea0014a0af58a7dbc90c481/you_unlock_it_with_the_private_key.png" alt="Photo of the box with lock and key. An arrow indicates that the key is being turned clockwise. Caption: &#34;...and you unlock it with the private key.&#34;"/></p><p>In summary: to send you a secret message, I use a public key to lock the message so nobody can read it, and you use a private key to unlock the message so that you can read it.</p><p>This is the general idea behind public-key encryption: <strong>encrypt with the public key, decrypt with the private key.</strong></p><h2 id="Signing-Messages">Signing Messages</h2><p>The ‚Äúsecret messages‚Äù use case for the box and private and public keys is intuitive: anyone with a public key can lock a message, but only the holder of the private key can unlock it.</p><p>There‚Äôs another way to use the box and keys: you can lock a message with the private key, which anyone with the public key can unlock. What could a possible use case there be for a system where anyone can unlock the box?</p><p>Suppose one of our common enemies has been trying to break up our alliance and that I‚Äôve been receiving very hurtful messages that appear to have come from you. (I‚Äôll leave the content of those messages to your imagination.)</p><p>That enemy has either been sending fake messages or has been intercepting and altering your real ones. There has to be a way to package a message in order to prove that it‚Äôs actually from you!</p><p>There <em>is</em> a way: the box!</p><p>In this scenario, you put your message in the open box. Since it‚Äôs open, it‚Äôs unlocked, which means the lock is at the ‚Äú12:00‚Äù position. </p><p>Using the private key, you ‚Äúsign‚Äù the message by locking it, turning the key counterclockwise from the ‚Äú12:00‚Äù position to the ‚Äú9:00‚Äù position.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1U2aOr7mKgMtGdZM8lPLWT/82ff89d7160d93b04fff8ac635fd41d7/you_sign_the_message_with_the_private_key.png" alt="Photo of the box with lock and key. An arrow indicates that the key is being turned clockwise. Caption: &#34;You &#39;sign&#39; the message with the private key...&#34;"/></p><p>One of your minions delivers the box to me.</p><p>Since you locked the box with the private key, anyone can unlock it with any one of the many public keys you have distributed. Our common enemy, knowing that this message is in transit, could intercept it and replace your invitation to tea with a ‚Äútop ten‚Äù list of very cutting insults that would surely dissolve our alliance.</p><p>The problem with the enemy‚Äôs plan is that it won‚Äôt work. Intercepting and altering the message means that they would have to do one of two things before forwarding the box to me.</p><ol start="1"><li>They could leave the box unlocked. Since the box is supposed to arrive locked, this is an obvious sign that the message may have been tampered with.</li><li>They could lock the box. They would have to do it with a public key, which means that only the private key can unlock it. I wouldn‚Äôt be able to unlock the box with the only key I had ‚Äî the public key ‚Äî which would lead me to conclude that someone had unlocked the box before I did.</li></ol><p>If the box arrives at my doorstep and...</p><ul><li>It‚Äôs locked</li><li>I can unlock it with the public key</li></ul><p>...then, I can be assured that the message came from you and wasn‚Äôt changed <em>en route</em>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4Fax8BanX5Qts7KJzW7166/b4dc34b169f6eca961c8d8f3c7452af4/i_verify_your_signature_with_the_public_key.png" alt="Photo of the box with lock and key. An arrow indicates that the key is being turned counterclockwise. Caption: &#34;...and I verify your &#39;signature&#39; with the public key.&#34;"/></p><p>In summary: to send me a message with proof that you are the sender, you use the private key to lock the message. You‚Äôre the only person with the private key, and only a public key can unlock messages locked with the private key. If one of the public keys can unlock that message, I know that it came from you.</p><p>This is the general idea behind digital signatures: <strong>sign with the private key, verify with a public key.</strong></p><h2 id="How-About-Sending-a-Message-That-s-Both-Secret--and--Signed-">How About Sending a Message That‚Äôs Both Secret <em>and</em> Signed?</h2><p>You might think that sending a message that is both secret and signed is paranoid. I would answer by saying, ‚ÄúParanoia is the <strong><em>mistaken</em></strong> impression that people are out to get you.‚Äù</p><p>Suppose I wanted to send you a secret signed message. I could do it with two boxes:</p><ol start="1"><li>A smaller box, which I own. It will prove that I sent the message. I have the private key for this box, and you have one of its public keys.</li><li>A larger box, which you own. It will keep the message secret. You have the private key for this box, and I have one of its public keys.</li></ol><p>I would lock the message in my smaller box using my private key and then lock it in your larger box using your public key.</p><p>When you receive the delivery, you will unlock your larger box first, using your private key. This would reveal my smaller box inside, which you would unlock with my public key.</p><h2 id="It-s-Not-Keys-and-Boxes--but-Numbers-and-Algorithms">It‚Äôs Not Keys and Boxes, but Numbers and Algorithms</h2><p>Of course, we‚Äôre not really dealing with boxes, keys (at least the kind that goes into locks), or minions. Here‚Äôs a list of elements in these stories and their real-world equivalents:</p><ul><li><strong>The message</strong>: Anything that you‚Äôd want to send that can you can view or edit with a computer. It could be text, one or more pictures, an audio or video recording, a database, or even an application. As far as the computer is concerned, messages are just a long series of numbers.</li><li><strong>The private and public keys</strong>: Very large numbers that are used in a lengthy math process to encrypt, decrypt, sign, and verify messages.</li><li><strong>The box</strong>: An algorithm that takes the message and keys and performs the math process to encrypt, decrypt, sign, and verify messages.</li><li><strong>Minions</strong>: The way in which the message is sent. This could be the internet but could just as easily be an actual minion, such as an unsuspecting summer intern with a USB key.</li></ul><p>In the alternate universe where messages are sent with boxes and keys, everyone would have their own set of boxes with their own private keys, as well as copies of other people‚Äôs public keys. In the real world, we run applications that run public-key encryption and digital signature algorithms to secure our messages. We still use public and private keys in the real world; they‚Äôre just digital.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 22 Sep 2021 14:53:00 +0000</pubDate>
    </item>
    <item>
      <title>Dependency Injection with Kotlin and Koin</title>
      <link>https://auth0.com/blog/dependency-injection-with-kotlin-and-koin/</link>
      <description>Learn how to implement common dependency injection scenarios with Koin and Kotlin</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Inversion of Control (IoC) is a broad term to describe how responsibility for some aspect of a system is lifted out of the custom code written by the end developer and into a framework. <a href="https://martinfowler.com/bliki/InversionOfControl.html" target="_blank" rel="noreferrer noopener">Martin Fowler describes a framework in terms of IoC</a>:</p><blockquote><p>Inversion of Control is a key part of what makes a framework different from a library. A library is essentially a set of functions that you can call, these days usually organized into classes. Each call does some work and returns control to the client.</p></blockquote><p>A framework embodies some abstract design, with more behavior built-in. In order to use it, you need to insert your behavior into various places in the framework, either by subclassing or by plugging in your own classes. The framework&#39;s code then calls your code at these points.</p><p>Dependency injection (DI) is one specific example of IoC where classes no longer directly instantiate member properties by creating new objects but instead declare their dependencies and allow an external system, in this case, a dependency injection framework to satisfy those dependencies.</p><p><a href="https://insert-koin.io/" target="_blank" rel="noreferrer noopener">Koin</a> is a dependency injection framework for Kotlin. It is lightweight, can be used in Android applications, is implemented via a concise DSL, and takes advantage of Kotlin features like delegate properties rather than relying on annotations. </p><p>In this post, we&#39;ll look at a simple application taking advantage of Koin to inject dependencies into our custom classes.</p><h2 id="Prerequisites">Prerequisites</h2><p>To build the sample application, you&#39;ll need to have JDK 11 or above, which is available from many sources, including <a href="https://openjdk.java.net/install/" target="_blank" rel="noreferrer noopener">OpenJDK</a>, <a href="https://adoptopenjdk.net/" target="_blank" rel="noreferrer noopener">AdoptOpenJDK</a>, <a href="https://www.azul.com/downloads/" target="_blank" rel="noreferrer noopener">Azul</a>, or <a href="https://www.oracle.com/au/java/technologies/javase-jdk11-downloads.html" target="_blank" rel="noreferrer noopener">Oracle</a>.</p><p>The code for the sample Koin application can be found <a href="https://github.com/mcasperson/KotlinKoinExample" target="_blank" rel="noreferrer noopener">here</a>.</p><h2 id="The-Gradle-Project-Definition">The Gradle Project Definition</h2><p>We start with the Gradle build file, which includes dependencies for Kotlin and Koin, and makes use of the <a href="https://github.com/johnrengelman/shadow" target="_blank" rel="noreferrer noopener">shadow plugin</a> to create self-contained uberjars:</p><pre><code>buildscript <span>{</span>
    repositories <span>{</span>
        maven <span>{</span>
            url <span>&#34;https://plugins.gradle.org/m2/&#34;</span>
        <span>}</span>
    <span>}</span>
    dependencies <span>{</span>
        classpath <span>&#39;com.github.jengelman.gradle.plugins:shadow:6.1.0&#39;</span>
    <span>}</span>
<span>}</span>

plugins <span>{</span>
    id <span>&#34;org.jetbrains.kotlin.jvm&#34;</span> version <span>&#34;1.5.21&#34;</span>
<span>}</span>

apply plugin<span>:</span> <span>&#39;kotlin&#39;</span>
apply plugin<span>:</span> <span>&#39;com.github.johnrengelman.shadow&#39;</span>

repositories <span>{</span>
    <span>mavenLocal</span><span>(</span><span>)</span>
    <span>mavenCentral</span><span>(</span><span>)</span>
<span>}</span>

dependencies <span>{</span>
    implementation <span>&#34;org.jetbrains.kotlin:kotlin-stdlib:1.5.21&#34;</span>
    implementation <span>&#34;io.insert-koin:koin-core:3.1.2&#34;</span>
<span>}</span></code></pre><p>To build the uberjar, run this command from Bash or PowerShell:</p><pre><code>./gradlew shadowJar</code></pre><h2 id="Registering-Singletons">Registering Singletons</h2><p>The first demonstration of Koin will register a class as a singleton, ensuring each time we request a new instance of the class, we are returned a single, shared object. Here is the code from the file <code>single<span>.</span>kt</code>:</p><pre><code><span>// src/main/kotlin/com/matthewcasperson/single.kt</span>

<span>package</span> com<span>.</span>matthewcasperson

<span>import</span> org<span>.</span>koin<span>.</span>core<span>.</span>context<span>.</span>GlobalContext<span>.</span>startKoin
<span>import</span> org<span>.</span>koin<span>.</span>dsl<span>.</span>module

<span>class</span> SingleInstance <span>{</span>
    <span>companion</span> <span>object</span> <span>{</span>
        <span>var</span> count<span>:</span> Int <span>=</span> <span>0</span>
    <span>}</span>

    <span>init</span> <span>{</span>
        <span>++</span>count
    <span>}</span>

    <span>fun</span> <span>hello</span><span>(</span><span>)</span> <span>=</span> <span>&#34;I am instance number <span>$count</span>&#34;</span>
<span>}</span>

<span>fun</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
    <span>val</span> singleModule <span>=</span> module <span>{</span>
        single <span>{</span> <span>SingleInstance</span><span>(</span><span>)</span> <span>}</span>
    <span>}</span>

    <span>var</span> app <span>=</span> startKoin <span>{</span>
        <span>modules</span><span>(</span>singleModule<span>)</span>
    <span>}</span>

    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>SingleInstance<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>SingleInstance<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>SingleInstance<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
<span>}</span></code></pre><p>This class is run with the command:</p><pre><code>java -cp ./build/libs/KotlinKoinExample-all.jar com.matthewcasperson.SingleKt</code></pre><p>We start by defining a typical class, but with a companion object containing a variable called <code>count</code>. The <code>count</code> variable is incremented by 1 each time we create a new <code>SingleInstance</code> object, which we will use to track how many new <code>SingleInstance</code> objects have been created:</p><pre><code><span>class</span> SingleInstance <span>{</span>
    <span>companion</span> <span>object</span> <span>{</span>
        <span>var</span> count<span>:</span> Int <span>=</span> <span>0</span>
    <span>}</span>

    <span>init</span> <span>{</span>
        <span>++</span>count
    <span>}</span>

    <span>fun</span> <span>hello</span><span>(</span><span>)</span> <span>=</span> <span>&#34;I am instance number <span>$count</span>&#34;</span>
<span>}</span></code></pre><p>Inside the <code>main</code> function we create a <a href="https://insert-koin.io/docs/reference/koin-core/modules/" target="_blank" rel="noreferrer noopener">Koin module</a>. Modules are used to group related Koin definitions, and here we use the <code>single</code> definition to instruct Koin to create a single instance of the supplied object:</p><pre><code><span>fun</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
    <span>val</span> singleModule <span>=</span> module <span>{</span>
        single <span>{</span> <span>SingleInstance</span><span>(</span><span>)</span> <span>}</span>
    <span>}</span></code></pre><p>Next we call the <code>startKoin</code> function, which is part of the <code>GlobalContext</code> object. <code>GlobalContext</code> is a singleton (defined as an <a href="https://kotlinlang.org/docs/object-declarations.html#object-declarations-overview" target="_blank" rel="noreferrer noopener">object declaration</a>), and is typically used as the default context for applications. Here we register our module into the global context:</p><pre><code>    <span>var</span> app <span>=</span> startKoin <span>{</span>
        <span>modules</span><span>(</span>singleModule<span>)</span>
    <span>}</span></code></pre><p>We&#39;re now able to request instances of any of our registered objects with <code>app<span>.</span>koin<span>.</span>get</code>. To demonstrate that our <code>single</code> definitions are working as expected, we get an instance of the <code>SingleInstance</code> class three times and print the message containing the instance count to the console: </p><pre><code>    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>SingleInstance<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>SingleInstance<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>SingleInstance<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
<span>}</span></code></pre><p>The output shows we have been given the same <code>SingleInstance</code> object each time:</p><pre><code>I am instance number <span>1</span>
I am instance number <span>1</span>
I am instance number <span>1</span></code></pre><h2 id="Registering-a-Factory">Registering a Factory</h2><p>There are times when you want a new instance each time you request a dependency from Koin. To support this, Koin has a <code>factory</code> definition. This is demonstrated in the file <code>factory<span>.</span>kt</code>:</p><pre><code><span>// src/main/kotlin/com/matthewcasperson/factory.kt</span>

<span>package</span> com<span>.</span>matthewcasperson

<span>import</span> org<span>.</span>koin<span>.</span>core<span>.</span>context<span>.</span>GlobalContext<span>.</span>startKoin
<span>import</span> org<span>.</span>koin<span>.</span>dsl<span>.</span>module

<span>class</span> FactoryInstance <span>{</span>
    <span>companion</span> <span>object</span> <span>{</span>
        <span>var</span> count<span>:</span> Int <span>=</span> <span>0</span>
    <span>}</span>

    <span>init</span> <span>{</span>
        <span>++</span>count
    <span>}</span>

    <span>fun</span> <span>hello</span><span>(</span><span>)</span> <span>=</span> <span>&#34;I am instance number <span>$count</span>&#34;</span>
<span>}</span>

<span>fun</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
    <span>val</span> factoryModule <span>=</span> module <span>{</span>
        factory <span>{</span> <span>FactoryInstance</span><span>(</span><span>)</span> <span>}</span>
    <span>}</span>

    <span>var</span> app <span>=</span> startKoin <span>{</span>
        <span>modules</span><span>(</span>factoryModule<span>)</span>
    <span>}</span>

    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>FactoryInstance<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>FactoryInstance<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>FactoryInstance<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
<span>}</span></code></pre><p>This class is run with the command:</p><pre><code>java -cp ./build/libs/KotlinKoinExample-all.jar com.matthewcasperson.FactoryKt</code></pre><p>This code is almost a line for line copy of the previous example, with some different class and variable names. The most significant difference is how the module is built, where we use the <code>factory</code> definition:</p><pre><code>    <span>val</span> factoryModule <span>=</span> module <span>{</span>
        factory <span>{</span> <span>FactoryInstance</span><span>(</span><span>)</span> <span>}</span>
    <span>}</span></code></pre><p>Whereas the <code>single</code> definition registered a singleton dependency, the <code>factory</code> definition calls the supplied lambda every time a dependency is requested.</p><p>This is reflected in the console output, which shows that we have indeed constructed three instances, one for each call to <code>app<span>.</span>koin<span>.</span>get</code>:</p><pre><code>I am instance number <span>1</span>
I am instance number <span>2</span>
I am instance number <span>3</span></code></pre><h2 id="Registering-Interfaces">Registering Interfaces</h2><p>The previous two examples registered concrete classes with Koin, but good object-oriented practice is to work with interfaces rather than classes. The example below from the file <code>interfaces<span>.</span>kt</code> shows how to register a class via its base interface with Koin:</p><pre><code><span>// src/main/kotlin/com/matthewcasperson/interfaces.kt</span>

<span>package</span> com<span>.</span>matthewcasperson

<span>import</span> org<span>.</span>koin<span>.</span>core<span>.</span>context<span>.</span>GlobalContext<span>.</span>startKoin
<span>import</span> org<span>.</span>koin<span>.</span>dsl<span>.</span>module

<span>interface</span> HelloService <span>{</span>
    <span>fun</span> <span>hello</span><span>(</span><span>)</span><span>:</span> String
<span>}</span>

<span>class</span> HelloServiceImpl <span>:</span> HelloService <span>{</span>
    <span>override</span> <span>fun</span> <span>hello</span><span>(</span><span>)</span> <span>=</span> <span>&#34;Hello!&#34;</span>
<span>}</span>

<span>fun</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
    <span>val</span> helloService <span>=</span> module <span>{</span>
        single <span>{</span> <span>HelloServiceImpl</span><span>(</span><span>)</span> <span>as</span> HelloService <span>}</span>
    <span>}</span>

    <span>var</span> app <span>=</span> startKoin <span>{</span>
        <span>modules</span><span>(</span>helloService<span>)</span>
    <span>}</span>

    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>HelloService<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
<span>}</span></code></pre><p>This class is run with the command:</p><pre><code>java -cp ./build/libs/KotlinKoinExample-all.jar com.matthewcasperson.InterfacesKt</code></pre><p>We start with a basic interface:</p><pre><code><span>interface</span> HelloService <span>{</span>
    <span>fun</span> <span>hello</span><span>(</span><span>)</span><span>:</span> String
<span>}</span></code></pre><p>We then implement the interface in a class:</p><pre><code><span>class</span> HelloServiceImpl <span>:</span> HelloService <span>{</span>
    <span>override</span> <span>fun</span> <span>hello</span><span>(</span><span>)</span> <span>=</span> <span>&#34;Hello!&#34;</span>
<span>}</span></code></pre><p>To make the class available to Koin via its interface, we cast the new object back to the interface with the <code><span>as</span></code> operator while building the module:</p><pre><code>    <span>val</span> helloService <span>=</span> module <span>{</span>
        single <span>{</span> <span>HelloServiceImpl</span><span>(</span><span>)</span> <span>as</span> HelloService <span>}</span>
    <span>}</span></code></pre><p>We then retrieve a dependency from its interface:</p><pre><code>    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>HelloService<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span></code></pre><h2 id="Resolving-Nested-Dependencies">Resolving Nested Dependencies</h2><p>All the previous examples have resolved objects with no additional dependencies. A more typical scenario is where Koin is used to resolve classes that themselves have additional dependencies. This is demonstrated in the file called <code>nested<span>.</span>kt</code>:</p><pre><code><span>// src/main/kotlin/com/matthewcasperson/nested.kt</span>

<span>package</span> com<span>.</span>matthewcasperson

<span>import</span> org<span>.</span>koin<span>.</span>core<span>.</span>context<span>.</span>GlobalContext<span>.</span>startKoin
<span>import</span> org<span>.</span>koin<span>.</span>dsl<span>.</span>module

<span>data</span> <span>class</span> <span>HelloMessageData</span><span>(</span><span>val</span> message <span>:</span> String <span>=</span> <span>&#34;Hello from wrapped class!&#34;</span><span>)</span>

<span>interface</span> HelloServiceWrapper <span>{</span>
    <span>fun</span> <span>hello</span><span>(</span><span>)</span><span>:</span> String
<span>}</span>

<span>class</span> <span>HelloServiceWrapperImpl</span><span>(</span><span>private</span> <span>val</span> helloMessageData<span>:</span>HelloMessageData<span>)</span> <span>:</span> HelloServiceWrapper <span>{</span>
    <span>override</span> <span>fun</span> <span>hello</span><span>(</span><span>)</span> <span>=</span> helloMessageData<span>.</span>message
<span>}</span>

<span>fun</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
    <span>val</span> helloService <span>=</span> module <span>{</span>
        single <span>{</span> <span>HelloMessageData</span><span>(</span><span>)</span> <span>}</span>
        single <span>{</span> <span>HelloServiceWrapperImpl</span><span>(</span><span>get</span><span>(</span><span>)</span><span>)</span> <span>as</span> HelloServiceWrapper <span>}</span>
    <span>}</span>

    <span>var</span> app <span>=</span> startKoin <span>{</span>
        <span>modules</span><span>(</span>helloService<span>)</span>
    <span>}</span>

    <span>println</span><span>(</span>app<span>.</span>koin<span>.</span>get<span>&lt;</span>HelloServiceWrapper<span>&gt;</span><span>(</span><span>)</span><span>.</span><span>hello</span><span>(</span><span>)</span><span>)</span>
<span>}</span></code></pre><p>This class is run with the command:</p><pre><code>java -cp ./build/libs/KotlinKoinExample-all.jar com.matthewcasperson.NestedKt</code></pre><p>We start with a data class defining a string property:</p><pre><code><span>data</span> <span>class</span> <span>HelloMessageData</span><span>(</span><span>val</span> message <span>:</span> String <span>=</span> <span>&#34;Hello from wrapped class!&#34;</span><span>)</span></code></pre><p>As with the previous example, we define an interface and then implement the interface with a class. This time, however, the class has a constructor that takes an instance of <code>HelloMessageData</code>:</p><pre><code><span>interface</span> HelloServiceWrapper <span>{</span>
    <span>fun</span> <span>hello</span><span>(</span><span>)</span><span>:</span> String
<span>}</span>

<span>class</span> <span>HelloServiceWrapperImpl</span><span>(</span><span>private</span> <span>val</span> helloMessageData<span>:</span>HelloMessageData<span>)</span> <span>:</span> HelloServiceWrapper <span>{</span>
    <span>override</span> <span>fun</span> <span>hello</span><span>(</span><span>)</span> <span>=</span> helloMessageData<span>.</span>message
<span>}</span></code></pre><p>When defining the module, we register an instance of the <code>HelloMessageData</code> class, and then resolve that class in the <code>HelloServiceWrapperImpl</code> constructor with a call to <code>get</code>, which will return the appropriate dependency for us. Note the order is not important here, and <code>HelloServiceWrapperImpl</code> could have been defined in the module first:</p><pre><code>    <span>val</span> helloService <span>=</span> module <span>{</span>
        single <span>{</span> <span>HelloMessageData</span><span>(</span><span>)</span> <span>}</span>
        single <span>{</span> <span>HelloServiceWrapperImpl</span><span>(</span><span>get</span><span>(</span><span>)</span><span>)</span> <span>as</span> HelloServiceWrapper <span>}</span>
    <span>}</span></code></pre><h2 id="Creating-a-KoinComponent">Creating a KoinComponent</h2><p>We noted earlier that Koin creates a default global context that our dependencies are registered with. Koin uses this global context, in conjunction with Kotlin <a href="https://kotlinlang.org/docs/delegated-properties.html" target="_blank" rel="noreferrer noopener">delegated properties</a>, through the <code>KoinComponent</code> interface to allow classes to resolve their own dependencies without an explicit reference to the <code>KoinApplication</code> returned by <code>startKoin</code>. An example of this is shown in the file <code>koinComponent<span>.</span>kt</code>:</p><pre><code><span>// src/main/kotlin/com/matthewcasperson/koinComponent.kt</span>

<span>package</span> com<span>.</span>matthewcasperson

<span>import</span> org<span>.</span>koin<span>.</span>core<span>.</span>component<span>.</span>KoinComponent
<span>import</span> org<span>.</span>koin<span>.</span>core<span>.</span>component<span>.</span>inject
<span>import</span> org<span>.</span>koin<span>.</span>core<span>.</span>context<span>.</span>GlobalContext<span>.</span>startKoin
<span>import</span> org<span>.</span>koin<span>.</span>dsl<span>.</span>module

<span>data</span> <span>class</span> <span>GoodbyeMessageData</span><span>(</span><span>val</span> message <span>:</span> String <span>=</span> <span>&#34;Goodbye!&#34;</span><span>)</span>

<span>interface</span> GoodbyeService <span>{</span>
    <span>fun</span> <span>goodbye</span><span>(</span><span>)</span><span>:</span> String
<span>}</span>

<span>class</span> <span>GoodbyeServiceImpl</span><span>(</span><span>private</span> <span>val</span> goodbyeMessageData<span>:</span> GoodbyeMessageData<span>)</span> <span>:</span> GoodbyeService <span>{</span>
    <span>override</span> <span>fun</span> <span>goodbye</span><span>(</span><span>)</span> <span>=</span> <span>&#34;GoodbyeServiceImpl says: <span><span>${</span>goodbyeMessageData<span>.</span>message<span>}</span></span>&#34;</span>
<span>}</span>

<span>class</span> GoodbyeApplication <span>:</span> KoinComponent <span>{</span>
    <span>val</span> goodbyeService <span>by</span> inject<span>&lt;</span>GoodbyeService<span>&gt;</span><span>(</span><span>)</span>
    <span>fun</span> <span>sayGoodbye</span><span>(</span><span>)</span> <span>=</span> <span>println</span><span>(</span>goodbyeService<span>.</span><span>goodbye</span><span>(</span><span>)</span><span>)</span>
<span>}</span>

<span>fun</span> <span>main</span><span>(</span><span>)</span> <span>{</span>
    <span>val</span> goodbyeModule <span>=</span> module <span>{</span>
        single <span>{</span> <span>GoodbyeMessageData</span><span>(</span><span>)</span> <span>}</span>
        single <span>{</span> <span>GoodbyeServiceImpl</span><span>(</span><span>get</span><span>(</span><span>)</span><span>)</span> <span>as</span> GoodbyeService <span>}</span>
    <span>}</span>

    startKoin <span>{</span>
        <span>modules</span><span>(</span>goodbyeModule<span>)</span>
    <span>}</span>

    <span>GoodbyeApplication</span><span>(</span><span>)</span><span>.</span><span>sayGoodbye</span><span>(</span><span>)</span>
<span>}</span></code></pre><p>This class is run with the command:</p><pre><code>java -cp ./build/libs/KotlinKoinExample-all.jar com.matthewcasperson.KoinComponentKt</code></pre><p>This example draws from the features demonstrated in previous sections to define a class called <code>GoodbyeServiceImpl</code>, with a nested dependency on the data class called <code>GoodbyeMessageData</code>, and which implements an interface called <code>GoodbyeService</code>:</p><pre><code><span>data</span> <span>class</span> <span>GoodbyeMessageData</span><span>(</span><span>val</span> message <span>:</span> String <span>=</span> <span>&#34;Goodbye!&#34;</span><span>)</span>

<span>interface</span> GoodbyeService <span>{</span>
    <span>fun</span> <span>goodbye</span><span>(</span><span>)</span><span>:</span> String
<span>}</span>

<span>class</span> <span>GoodbyeServiceImpl</span><span>(</span><span>private</span> <span>val</span> goodbyeMessageData<span>:</span> GoodbyeMessageData<span>)</span> <span>:</span> GoodbyeService <span>{</span>
    <span>override</span> <span>fun</span> <span>goodbye</span><span>(</span><span>)</span> <span>=</span> <span>&#34;GoodbyeServiceImpl says: <span><span>${</span>goodbyeMessageData<span>.</span>message<span>}</span></span>&#34;</span>
<span>}</span></code></pre><p>We then define a class called <code>GoodbyeApplication</code> implementing the <code>KoinComponent</code> interface. This class has a delegate property called <code>goodbyService</code> initialized by the <code>inject</code> function made available through the <code>KoinComponent</code> interface:</p><pre><code><span>class</span> GoodbyeApplication <span>:</span> KoinComponent <span>{</span>
    <span>val</span> goodbyeService <span>by</span> inject<span>&lt;</span>GoodbyeService<span>&gt;</span><span>(</span><span>)</span>
    <span>fun</span> <span>sayGoodbye</span><span>(</span><span>)</span> <span>=</span> <span>println</span><span>(</span>goodbyeService<span>.</span><span>goodbye</span><span>(</span><span>)</span><span>)</span>
<span>}</span></code></pre><p>The module is defined in much the same way as it has been in previous examples. Note however that the <code>GoodbyeApplication</code> class is not defined in the module:</p><pre><code>    <span>val</span> goodbyeModule <span>=</span> module <span>{</span>
        single <span>{</span> <span>GoodbyeMessageData</span><span>(</span><span>)</span> <span>}</span>
        single <span>{</span> <span>GoodbyeServiceImpl</span><span>(</span><span>get</span><span>(</span><span>)</span><span>)</span> <span>as</span> GoodbyeService <span>}</span>
    <span>}</span></code></pre><p>In this example, we don&#39;t assign the result of the <code>startKoin</code> function to any variable; registering the module with the global context is enough here:</p><pre><code>    startKoin <span>{</span>
        <span>modules</span><span>(</span>goodbyeModule<span>)</span>
    <span>}</span></code></pre><p>We then create a new instance of the <code>GoodbyeApplication</code> class and call its <code>sayGoodbye</code> function. By implementing the <code>KoinComponent</code> interface, the <code>GoodbyeApplication</code> class can resolve its own dependencies from the global context and will resolve its <code>GoodbyeService</code> dependency in order to print a message to the console:</p><pre><code>    <span>GoodbyeApplication</span><span>(</span><span>)</span><span>.</span><span>sayGoodbye</span><span>(</span><span>)</span></code></pre><p>The <code>KoinComponent</code> interface is convenient, but be aware that it means your classes are now dependant on the Koin framework. Constructor-based injection is recommended when you wish to share code without any explicit dependency on Koin. </p><h2 id="Conclusion">Conclusion</h2><p>Koin is a lightweight dependency injection framework with a concise DSL taking advantage of Kotlin&#39;s modern syntax and features. In this post, we looked at how Koin creates singletons and factories, registers dependencies against their interfaces, and allows classes to resolve their own dependencies with delegated properties.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 21 Sep 2021 17:05:00 +0000</pubDate>
    </item>
    <item>
      <title>Get Started with Android Authentication Using Kotlin: Part 1</title>
      <link>https://auth0.com/blog/get-started-with-android-authentication-using-kotlin-part-1/</link>
      <description>Learn how to implement login, logout, and user profiles in Android apps using Kotlin and Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>If you‚Äôre planning to build a native Android app that requires users to log in, you should use Auth0. </p><p>Implementing user login/logout often turns into its own project. Just implementing the many ways users want to log in can easily take a lot of time. You‚Äôd also have to deal with issues such as user management, scaling, and security, each of which could have its own article.</p><p>With Auth0 and a few lines of code, your app can have a full-featured system that supports logging in with a basic username/password combination, single sign-on and social accounts, passwordless login, biometrics, and more. You won‚Äôt have to handle the ‚Äúbehind the scenes‚Äù issues, either!</p><p><strong>This tutorial covers the basics of using Auth0 to implement login/logout in an Android app written in Kotlin.</strong> It also provides an introduction to reading and writing information into user profiles so that your app can customize itself for each user. Along the way, you‚Äôll become familiar with the Auth0 dashboard and learn how to use it to register applications and users.</p><blockquote><p><strong>Look for the üõ† emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong> </p></blockquote><h2 id="What-you-ll-build">What you‚Äôll build</h2><p>You‚Äôll build a simple, single-screen Android app that will allow the user to log in and log out using Auth0. While logged in, the user will be able to see the following information from their user profile, namely:</p><ul><li>Information that is part and parcel of the user account, namely:
  <ul><li>The user‚Äôs name</li><li>The user‚Äôs email address</li></ul></li><li>Metadata attached to the user account, namely:
  <ul><li>The user‚Äôs country</li></ul></li></ul><p>The user will also be able to edit their country, and the result of that edit will be stored in the user account.</p><p>When you launch the completed app, you‚Äôll see a greeting, a <strong>Log in</strong> button, and a disabled <strong>Log out</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7FSXqzXczgaNUC5NnY9q1F/d72b55833d1bf446c70d60488f7f4ae0/welcome_screen.png" alt="The finished app‚Äôs screen when launched. The greeting ‚ÄúWelcome to the app!‚Äù appears above the ‚ÄúLog in‚Äù and ‚ÄúLog out‚Äù buttons."/></p><p>Tapping the <strong>Log in</strong> button takes the user to the login screen, which appears in a custom Chrome tab:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/53TEQjPR0HhmvGIC8BXW7a/e7b6205b7c401883c61b162c498a00f7/universal_login.png" alt="The default Auth0 login web page. It lets the user enter username and password or log in using a Google account."/></p><p>When you use Auth0 in your apps, you delegate authentication to a centralized login page in the same way that Google properties such as Gmail and YouTube redirect you to <strong>accounts.google.com</strong> when you log in. In this exercise, you‚Äôll use the default ‚Äúlook and feel‚Äù for the login page, but <a href="https://auth0.com/docs/universal-login/new-experience/universal-login-page-templates" target="_blank" rel="noreferrer noopener">you can customize it to match your app or organization‚Äôs branding</a>.</p><p>Logging in successfully returns you to the app, where you‚Äôll see the following changes:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6D4JdPU0s5tGuplX9gEE4g/cfb0e2c57ead91059a2d6a26d6efdf44/main_screen_1.png" alt="The finished app‚Äôs screen when the user is logged in. It displays information about the logged-in user."/></p><ul><li>The greeting will have changed to a notification telling you that you‚Äôre now logged into the app.</li><li>The <strong>Log in</strong> button will now be disabled, and the <strong>Log out</strong> button will now be enabled.</li><li>The name and email address for the user account that you used to log in will be displayed.</li><li>There will now be a section for metadata, complete with an editable text box (an <code>EditText</code> in Android parlance) and <strong>Get</strong> and <strong>Set</strong> buttons that will allow you to read and write to the <code>country</code> field of the metadata for the user account.</li></ul><p>As you might expect, logging out is done by tapping the <strong>Log out</strong> button. Once logged out, you see the following changes onscreen:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2JqJGGpuuMVwdXSPyHH0iT/8c4153360bd7aa656dccc8170af42e4d/logout_screen.png" alt="The finished app‚Äôs screen when the user is logged out. The title bar reads ‚ÄúYou‚Äôre logged out‚Äù."/></p><ul><li>The notification at the top of the screen will now inform you that you‚Äôre logged out of the app.</li><li>Logging out enables the <strong>Log in</strong> button and disables the <strong>Log out</strong> button.</li><li>The other controls that were visible when you were logged in will no longer be visible.</li></ul><h2 id="Prerequisites">Prerequisites</h2><p>You‚Äôll need the following for this coding exercise:</p><h3 id="What-you-ll-need">What you‚Äôll need</h3><ul><li><strong>An Android development setup.</strong> Make sure you have the following, in the order given below:
  <ul><li><a href="https://www.oracle.com/java/technologies/javase-jdk16-downloads.html" target="_blank" rel="noreferrer noopener"><strong>Java SE Developer Kit (JDK), version 11 or later.</strong></a> You can find out which version is on your computer by opening a command-line interface and entering <code>java <span>--</span>version</code>.</li><li><a href="https://developer.android.com/studio" target="_blank" rel="noreferrer noopener"><strong>Android Studio,</strong></a> version 3.6 (February 2020) or later. I used the current stable version of Android Studio when writing this article: version 2020.3.1, also known as ‚ÄúArctic Fox‚Äù.</li><li><strong>At least one Android SDK (Software Development Kit) platform.</strong> You can confirm that you have one (and install one if you don‚Äôt) in Android Studio. Open <strong>Tools</strong> ‚Üí <strong>SDK Manager</strong>. You‚Äôll see a list of Android SDK platforms. Make sure that the current SDK (<strong>Android 11.0 (R)</strong> at the time of writing) is checked; if it isn‚Äôt, check it, click the <strong>Apply</strong> button, and click the <strong>OK</strong>  button in the confirmation dialog that appears. Wait for the SDK platform to install and click the <strong>Finish</strong> button when installation is complete.</li></ul></li><li><strong>An Android device, real or virtual:</strong>
  <ul><li><strong>Using a real device:</strong> Connect the device to your computer with a USB cable. <a href="https://developer.android.com/studio/debug/dev-options" target="_blank" rel="noreferrer noopener">Make sure that your device has Developer Options and USB debugging enabled.</a></li><li><strong>Using a virtual device:</strong> Using Android Studio, you can build a virtual device (emulator) that runs on your computer. Here‚Äôs my recipe for a virtual device that simulates a current-model inexpensive Android phone:
  <ol start="1"><li>Open <strong>Tools</strong> ‚Üí <strong>AVD Manager</strong> (AVD is short for ‚ÄúAndroid Virtual Device‚Äù). The <strong>Your Virtual Devices</strong> window will appear. Click the <strong>Create Virtual Device...</strong> button.</li><li>The <strong>Select Hardware</strong> window will appear. In the <strong>Phone</strong> category, select <strong>Pixel 3a</strong> and click the <strong>Next</strong> button.</li><li>The <strong>System Image</strong> window will appear, and you‚Äôll see a list of Android versions. Select <strong>R</strong> (API 30, also known as Android 11.0). If you see a <strong>Download</strong> link beside R, click it, wait for the OS to download, then click the <strong>Finish</strong> button. Then click the <strong>Next</strong> button.</li><li>The <strong>Android Virtual Device (AVD)</strong> window will appear. The <strong>AVD Name</strong> field should contain <strong>Pixel 3a API 30</strong>, the two rows below it should have the titles <strong>Pixel 3a</strong> and <strong>R</strong>, and in the <strong>Startup orientation</strong> section, <strong>Portrait</strong> should be selected. Click the <strong>Finish</strong> button.</li><li>You will be back at the <strong>Your Virtual Devices</strong> window. The list will now contain <strong>Pixel 3a API 30</strong>, and that device will be available to you when you run the app.</li></ol></li></ul></li><li><strong>An Auth0 account.</strong> <a href="https://auth0.com/sign-up?tr=1" target="_blank" rel="noreferrer noopener">You can sign up for a free one now</a>, or later on in the article.</li></ul><h3 id="What-might-be-useful">What might be useful</h3><ul><li><strong>A little familiarity with Android development.</strong> If you‚Äôre new to Android development or the Kotlin programming language, you might find Android Developers‚Äô site, <a href="https://developer.android.com/courses/android-basics-kotlin/course" target="_blank" rel="noreferrer noopener"><em>Android Basics in Kotlin</em></a>, a good introduction.</li></ul><h2 id="Set-Up-the-Project-on-Android-Studio">Set Up the Project on Android Studio</h2><p>üõ† Open Android Studio. Close any open project windows, which will cause the <strong>Welcome to Android Studio</strong> window to appear. Create a new project by clicking the <strong>New project</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/515JGjc8Gu0kPUC9nSmABB/04464174cda6dd059c734157cf68de21/click_new_project.png" alt="Android Studio‚Äôs ‚ÄúWelcome to Android Studio‚Äù screen. An arrow directs the reader to click the ‚ÄúNew Project‚Äù button."/></p><p>üõ† Make sure that <strong>Phone and Tablet</strong> is selected in the menu of the left side of the window that appears, then select <strong>Empty Activity</strong> from the selection of templates. Click the <strong>Next</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3C7qUdfN39HAixbVPi7cMs/0d6f2fe941ddf1f25c7ac1b56bd46344/select_empty_activity.png" alt="Android Studio‚Äôs template screen for new projects. The reader is told to select the ‚ÄúEmpty Activity‚Äù and click the ‚ÄúNext‚Äù button."/></p><p>üõ† In the next window, enter a name for the app, such as <strong>Login</strong>. Make a note of the value that Android Studio generates in the <strong>Package Name</strong> field ‚Äî you‚Äôll need it when registering the app with Auth0.</p><blockquote><p>If you used <strong>Login</strong> as the name for the app, Android Studio will automatically generate the package name <strong>com.example.login</strong>.</p></blockquote><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2ke5fQE1zyH9OljmWbarEG/5715fffa863c2f193930679aadbd66da/new_project_name.png" alt="The template screen for new project details: project name is ‚ÄúLogin‚Äù, package name is ‚Äúcom.example.login‚Äù, language is Kotlin, minimum SDK is set to API 21."/></p><p>üõ† Ensure that the selected <strong>Language</strong> is <strong>Kotlin</strong> and that the <strong>Minimum SDK</strong> is set to <strong>API 21: Android 5.0 (Lollipop)</strong> or later.</p><blockquote><p>API 21, which dates back to November 2014, is the oldest version of Android supported by Auth0. By targeting API 21 or later, you can write an app that will run on almost 95% of the active Android devices that are connected to the Play Store.</p></blockquote><p>üõ† Click the <strong>Finish</strong> button. Android Studio will spend a few moments setting up your project. </p><p>üõ† Once Android Studio has finished setting up the project, run the app to confirm that it works. You should see the default ‚ÄúHello, World!‚Äù app:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6PQgEXywNwmp7eKD50RSU6/ffe69b079f53c0d059264c541c3d5623/hello_world.png" alt="The newly-created app‚Äôs screen when launched. Title bar reads ‚ÄúLogin‚Äù; body reads ‚ÄúHello World!‚Äù."/></p><p>With the app project set up on Android Studio, it‚Äôs time to turn your attention to the Auth0 side.</p><h2 id="Register-the-App-with-Auth0">Register the App with Auth0</h2><p><strong>To continue beyond this point, you‚Äôll need an Auth0 account.</strong> That‚Äôs because your app will delegate the heavy lifting of the login/logout process to Auth0 so that you can focus your effort, energy, and time on what your app actually does, instead of worrying about authenticating users and all the edges cases that come with it.</p><h3 id="If-you-already-have-an-Auth0-account---">If you already have an Auth0 account...</h3><p>üõ† ...log in, skip the next section, and proceed to the part titled <strong><em>Register your app with Auth0</em></strong>.</p><h3 id="If-you-don-t-have-an-Auth0-account-yet---">If you don‚Äôt have an Auth0 account yet...</h3><p>üõ† <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener"><strong>...go ahead and sign up for one!</strong></a> It‚Äôs free, and we‚Äôve taken great care to make the process as painless as possible.</p><p>Auth0 will ask you to fill just <em>two</em> fields: your email address and a password. We <em> won‚Äôt</em> ask for a credit card number or any other information. If <em>that</em> seems like too much work, you can sign up with a single click by doing so using your GitHub, Google, or Microsoft account:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/Pk0WorUwp6mW9iJKj4Ar7/9d8c9e515765f118b5fdc06d3793b6ef/sign_up.png" alt="Auth0‚Äôs ‚ÄúSign Up‚Äù form, which has ‚ÄúEmail‚Äù and ‚ÄúPassword‚Äù fields, and links to sign up with a GitHub, Google, and Microsoft account."/></p><p>Once you‚Äôve provided an email address and password, you‚Äôll see the ‚ÄúLet‚Äôs set you up for success‚Äù page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4M6OV4hlEWk5J9kI2Vzs5p/fa8c33783e7255757f7710e219caeac0/set_up_auth0_account.png" alt="The ‚ÄúLet‚Äôs set you up for success‚Äù page. The reader is directed to select the ‚ÄúPersonal‚Äù account type and click the ‚ÄúNext‚Äù button."/></p><p>Just select <strong>Personal</strong> for your account type and click the <strong>Next</strong> button. Your sign-up process will be complete, and you‚Äôll see the Auth0 dashboard page.</p><h3 id="Register-your-app-with-Auth0">Register your app with Auth0</h3><p>üõ† In the menu on the left side of the <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 dashboard</a>, click on <strong>Applications</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2PsBUajhnnXWJR7QS8PUfg/e9c6bd92175335286aa03224e1646e91/expand_applications_menu.png" alt="The main page of the Auth0 dashboard. The reader is directed to expand the ‚ÄúApplications‚Äù menu."/></p><p>üõ† This will expand the <strong>Applications</strong> menu. Select the first item in that menu, which also has the name <strong>Applications</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2UNcUhGNq16RFBJkokz7KS/854f3e92fbe58943bf05f0f4a761d177/select_applications_menu_item.png" alt="The main page of the Auth0 dashboard, with the ‚ÄúApplications‚Äù menu expanded. The reader is directed to select the ‚ÄúApplications‚Äù menu item."/></p><p>You will now be on the <strong>Applications</strong> page. It lists all the applications that you have registered so that Auth0 can handle their login/logout processes.</p><p>üõ† Let‚Äôs create a new registration for your app. Do this by clicking the <strong>Create application</strong> button near the top right of the page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4aOFH6mt7xs9CspYNkuU7Q/1cff580b803c09236ad959b18614119a/create_application.png" alt="The ‚ÄúApplications‚Äù page. The reader is directed to click the ‚ÄúCreate Application‚Äù button."/></p><p>You‚Äôll see this dialog appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/lAiEqcCsTt5CcwrdA3IGb/8eda117f82ca08f55f120d058587443d/create_application.png" alt="The ‚ÄúCreate application‚Äù dialog. The application‚Äôs name is set to ‚ÄúLogin‚Äù, and the selected application type is ‚ÄúNative‚Äù."/></p><p>üõ† You‚Äôll need to provide two pieces of information to continue:</p><ul><li>Enter a name for your app in the name field. It might be simplest to use the same name as your Android Studio project (if you‚Äôve been following my example, use the name <strong>Login</strong>).</li><li>Specify the application type, which in this case is <strong>Native</strong>.</li></ul><p>Click <strong>Create</strong>. The <strong>Quick Start</strong> page for your app will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5yXXeZfsMDWTPUcWi49Jj6/73176affc85927351badee8172b831e8/quick_start_tab.png" alt="The ‚ÄúQuick Start‚Äù page. It contains several icons, each one representing an operating system or platform."/></p><p>This page provides you with ready-made projects for several different platforms that you can use as the basis for an application that delegates login/logout to Auth0. You won‚Äôt be using any of them in this exercise; instead, you‚Äôll make use of a couple of Auth0 libraries and write the code yourself. It‚Äôs more educational ‚Äî and more importantly, <em>fun</em> ‚Äî that way.</p><p>üõ† Click the <strong>Settings</strong> tab, which will take you to this page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6uxBjXmnlf1uD7hocTif0p/b3701340069e48b6f8dfe1e151a9d7cb/settings_page.png" alt="The ‚ÄúApplication‚Äù page‚Äôs ‚ÄúSettings‚Äù tab."/></p><p>You‚Äôre going to do two critical things on this page:</p><ol start="1"><li>Get information that your app needs to know about Auth0, and</li><li>Provide information that Auth0 needs to know about your app.</li></ol><p>Let‚Äôs take care of the first one: Getting the information that your app needs, namely:</p><ul><li>The <strong>domain</strong>, which is the URL that your app will use to contact Auth0. It uniquely identifies your Auth0 <em>tenant</em>, which is a collection of applications, users, and other information that you have registered with your Auth0 account.</li><li>The <strong>client ID</strong>, which is the identifier that Auth0 assigned to your app. It‚Äôs how Auth0 knows which app of yours it‚Äôs working with.</li></ul><p>üõ† Get this information by copying the contents of the <strong>Domain</strong> and <strong>Client ID</strong> fields for later reference:  </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7m7XUrzgnR5A1OZIJdzPkd/b4c421d8f0a2c15d94fd685bea0e3b3e/settings_-_get_info.png" alt="The ‚ÄúApplication‚Äù page‚Äôs ‚ÄúSettings‚Äù tab. The reader is directed to copy the values of the ‚ÄúDomain‚Äù and ‚ÄúClient ID‚Äù text fields, then to scroll down the page."/></p><p>You‚Äôll enter them into your Android Studio project as string resources soon.</p><p>üõ† Scroll down to the <strong>Applications URIs</strong> section. This is where you provide two pieces of information that Auth0 needs to know about your app, which are:</p><ol start="1"><li>A <strong>callback URL:</strong> the URL that Auth0 will redirect to after the user successfully logs in. There can be more than one of these.</li><li>A <strong>logout URL:</strong> the URL that Auth0 will redirect to after the user logs out. There can be more than one of these.</li></ol><p>At this point, you‚Äôre probably thinking: ‚ÄúWait a minute ‚Äî I‚Äôm writing an <em>Android app</em>. It doesn‚Äôt have <em>web pages</em> that you navigate to using URLs, but <em>activities</em> that you navigate to using <em>intents</em>!‚Äù</p><p>You‚Äôre absolutely right. In the case of native applications, the callback and logout URLs are the same string, and Auth0 sends that string to your app to inform it that a user has logged in or logged out.</p><p>The string that Android native apps use for both the callback URL and the logout URL use this format:</p><pre><code><span>{</span><span>SCHEME</span><span>}</span><span>:</span><span>/</span><span>/</span><span>{</span><span>YOUR_DOMAIN</span><span>}</span><span>/</span>android<span>/</span><span>{</span><span>YOUR_APP_PACKAGE_NAME</span><span>}</span><span>/</span>callback</code></pre><p>üõ† To construct the string, do the following:</p><ul><li>Replace <code><span>{</span><span>SCHEME</span><span>}</span></code> with <code>app</code>. <code><span>{</span><span>SCHEME</span><span>}</span></code> is the URL‚Äôs protocol, and if you were writing a web app, this value would be <code>http</code>, or better, <code>https</code>. Since this is an Android native app, you can pick any string for this value. I like to use <code>app</code>.</li><li>Replace <code><span>{</span><span>YOUR_DOMAIN</span><span>}</span></code> with the value from the <strong>Domain</strong> field that you saw earlier on this page.</li><li>Replace <code><span>{</span><span>YOUR_APP_PACKAGE_NAME</span><span>}</span></code> with the package name of your Android app. If you‚Äôve been following the example in this article, your app‚Äôs package name is <code>com<span>.</span>example<span>.</span>login</code>.</li></ul><p>üõ† Enter this string into both the <strong>Allowed Callback URLs</strong> and <strong>Allowed Login URLs</strong> fields. Remember, it‚Äôs the same string going into both fields.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2OXT7ElyikvL8JNCO3RzFk/658591a0c5a67dc7e8499bb0ea02b7e5/settings_-_put_info.png" alt="The ‚ÄúApplication URIs‚Äù section of the page. The reader is directed to enter the callback URL into ‚ÄúAllowed Callback URLs‚Äù and ‚ÄúAllowed Logout URLs‚Äù."/></p><p>üõ† You‚Äôve done everything you need to do on this page. Scroll down to the bottom of the page and click the <strong>Save changes</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3w6HT6fNOjiJPOjA5uduzt/bb290473a3ae601b70d7ce6456ac7fc4/settings_-_save_changes.png" alt="The bottom of the page, which features the ‚ÄúSave Changes‚Äù button. An arrow directs the reader to click the button."/></p><h3 id="Create-a-user-if-your-tenant-doesn-t-have-any">Create a user if your tenant doesn‚Äôt have any</h3><p>If your tenant is brand new, it won‚Äôt have any user accounts, which means that there won‚Äôt be any way to log in to your app. If this is the case, follow these steps to create a user.</p><p>üõ† In the menu on the left side of the Auth0 dashboard, click on <strong>User Management</strong>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/13qs824Uauwv78ewd682EO/6898da1b68642b10cb9c31413f358a95/user_management_menu.png" alt="The bottom of the page. An arrow directs the reader to expand the ‚ÄúUser Management‚Äù menu."/></p><p>üõ† This will expand the <strong>User Management</strong> menu. Select the <strong>Users</strong> item in that menu:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1tivj870qehY6oIaeDolj1/31b0544fab715b7fbded29fb63802a45/select_users_menu_item.png" alt="The bottom of the page now featuring an expanded ‚ÄúUser Management‚Äù menu. An arrow directs the reader to expand the ‚ÄúUsers‚Äù menu item."/></p><p>The <strong>Users</strong> page will appear. It lists all the users registered to your tenant. If there are no users, you‚Äôll see the ‚ÄúYou don‚Äôt have any users yet‚Äù message.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1wCORw3pqSOLt65n48Qr56/7421164d02cfb112350882a4cccb4cca/click_create_user.png" alt="The ‚ÄúUsers‚Äù page. The page says, ‚ÄúYou don‚Äôt have any users yet‚Äù. An arrow directs the reader to click the ‚ÄúCreate User‚Äù button."/></p><p>üõ† Click the <strong>Create User</strong> button to create a new user, which will make this dialog box appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2s3GfTHNKRgts8lcXQJ0SH/6d6d0ca397684be75030d40bb6b94fb5/create_user_dialog.png" alt="The ‚ÄúCreate User‚Äù dialog. It has fields for email and password, as well as a drop-down menu displaying ‚ÄúUsername-Password-Authentication‚Äù."/></p><p>üõ† Enter an email address and password for the user. The only option for the <strong>Connection</strong> will be <strong>Username-Password-Authentication</strong>, so leave it as it is. Make a note of that email address and password ‚Äî you‚Äôll be using them to log in to the app.</p><p>üõ† Click the <strong>Create</strong> button to create the user. The user‚Äôs <strong>Details</strong> page will appear:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3TbGcAFo4e4N1coNCtHYdV/fa830264079fc661cbc683590729e4b1/user_details_page.png" alt="The user‚Äôs ‚ÄúDetails‚Äù page."/></p><p>That takes care of all the setup you need to do within the Auth0 dashboard. It‚Äôs time to build the app!</p><h2 id="Set-Up-the-App">Set Up the App</h2><h3 id="Install-the-Auth0-SDK">Install the Auth0 SDK</h3><p>The <a href="https://github.com/auth0/Auth0.Android" target="_blank" rel="noreferrer noopener">Auth0 Android SDK</a> enables Android apps to use Auth0‚Äôs APIs, including the <a href="https://auth0.com/docs/api/authentication" target="_blank" rel="noreferrer noopener">Authentication API</a>, which you‚Äôll use to implement login and logout in your app.</p><p>To install the SDK, you‚Äôll need to perform two tasks:</p><ol start="1"><li>Make changes to the app‚Äôs Gradle file to integrate Auth0. While you‚Äôre editing that file, you‚Äôll also enable view binding.</li><li>Give the app permission to access the internet in the project‚Äôs manifest.</li></ol><h4 id="Add-the-Auth0-SDK-as-a-project-dependency">Add the Auth0 SDK as a project dependency</h4><p>üõ† Open <code>build<span>.</span>gradle</code> for the <em>app</em> ‚Äî it‚Äôs the file in the Project Structure menu that has the words <strong>Module</strong> and <strong>app</strong> in its name:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5tUS9ilXyP4KIxNqwSJZkg/bcb5c65a4d483149367211f0cbb9f63b/open_the_app_build.gradle_file.png" alt="The project tree in Android Studio. An arrow points to the ‚Äúbuild.gradle‚Äù file and instructs the reader to open it."/></p><p>üõ† Add the following line to the <code>defaultConfig</code> block of the file:</p><pre><code>manifestPlaceholders <span>=</span> <span>[</span>auth0Domain<span>:</span> <span>&#34;@string/com_auth0_domain&#34;</span><span>,</span> auth0Scheme<span>:</span> <span>&#34;@string/com_auth0_scheme&#34;</span><span>]</span></code></pre><p>Here‚Äôs what the <code>defaultConfig</code> block should look like once you‚Äôve added the line: </p><pre><code>defaultConfig <span>{</span>
    applicationId <span>{</span><span>APPLICATION_ID_GOES_HERE</span><span>}</span>
    minSdk <span>21</span>
    targetSdk <span>31</span>
    versionCode <span>1</span>
    versionName <span>&#34;1.0&#34;</span>
    manifestPlaceholders <span>=</span> <span>[</span>auth0Domain<span>:</span> <span>&#34;@string/com_auth0_domain&#34;</span><span>,</span> auth0Scheme<span>:</span> <span>&#34;@string/com_auth0_scheme&#34;</span><span>]</span>

    testInstrumentationRunner <span>&#34;androidx.test.runner.AndroidJUnitRunner&#34;</span>
<span>}</span></code></pre><p>üõ† Add this line to the <code>dependencies</code> block, after all the other lines that begin with the keyword <code>implementation</code>:</p><pre><code>implementation <span>&#39;com.auth0.android:auth0:2.0.0&#39;</span></code></pre><p>This line tells Gradle to include version 2.0.0 of Auth0‚Äôs Android library in the application.</p><p>Here‚Äôs what the <code>dependencies</code> block should look like once you‚Äôve added the line:</p><pre><code>dependencies <span>{</span>
    implementation <span>&#39;androidx.core:core-ktx:1.6.0&#39;</span>
    implementation <span>&#39;androidx.appcompat:appcompat:1.3.1&#39;</span>
    implementation <span>&#39;com.google.android.material:material:1.4.0&#39;</span>
    implementation <span>&#39;androidx.constraintlayout:constraintlayout:2.1.0&#39;</span>
    implementation <span>&#39;com.auth0.android:auth0:2.0.0&#39;</span>
    testImplementation <span>&#39;junit:junit:4.+&#39;</span>
    androidTestImplementation <span>&#39;androidx.test.ext:junit:1.1.3&#39;</span>
    androidTestImplementation <span>&#39;androidx.test.espresso:espresso-core:3.4.0&#39;</span>
<span>}</span></code></pre><h4 id="Enable-view-binding">Enable view binding</h4><p>Before Android Studio 3.6, if you wanted to refer to a view or widget in the user interface, you‚Äôd have to <a href="https://www.tutorialkart.com/kotlin-android/access-a-view-programmatically-using-findviewbyid/" target="_blank" rel="noreferrer noopener">create a new variable for every view or widget using <code><span>findViewById</span><span>(</span><span>)</span></code></a>.</p><p>Suppose you had an <code>Activity</code> whose layout file contains these views:</p><ul><li>A <code>TextView</code> whose <code>id</code> is <code>textview_instructions</code></li><li>An <code>EditText</code> whose <code>id</code> is <code>edittext_input</code></li><li>A <code>Button</code> whose <code>id</code> is <code>button_submit</code></li></ul><p>Here‚Äôs how you would create references to those views in code and set their <code>text</code> properties:</p><pre><code><span>// A quick example of findViewById() binding</span>

<span>// Set this activity‚Äôs content to the layout specified</span>
<span>// by activity_main.xml</span>
<span>setContentView</span><span>(</span>R<span>.</span>layout<span>.</span>activity_main<span>)</span>

<span>// Get references to the TextView, EditText, and Button:</span>
<span>val</span> textviewInstructions <span>=</span> <span>findViewById</span><span>(</span>R<span>.</span>id<span>.</span> textview_instructions<span>)</span> <span>as</span> TextView
<span>val</span> edittextInput <span>=</span> <span>findViewById</span><span>(</span>R<span>.</span>id<span>.</span> edittext_input<span>)</span> <span>as</span> EditText
<span>val</span> buttonSubmit <span>=</span> <span>findViewById</span><span>(</span>R<span>.</span>id<span>.</span>button_submit<span>)</span> <span>as</span> Button

<span>// Set the widgets&#39; text</span>
textviewInstructions<span>.</span>text <span>=</span> <span>&#34;Here are your instructions.&#34;</span>
edittextInput <span>=</span> <span>&#34;Edit this text.&#34;</span>
buttonSubmit <span>=</span> <span>&#34;Tap me!&#34;</span></code></pre><p>Android 3.6 introduced <a href="https://medium.com/androiddevelopers/use-view-binding-to-replace-findviewbyid-c83942471fc" target="_blank" rel="noreferrer noopener"><strong><em>view binding</em></strong>, which generates a binding object that holds all the views in the activity</a>. You no longer have to declare a variable for each view or widget because all the views and widgets in the activity are now properties of the binding object.</p><pre><code><span>// A quick example of view binding</span>

<span>// Bind this activity to the layout and create a binding object</span>
<span>// that gives us access to all its views</span>
binding <span>=</span> ActivityMainBinding<span>.</span><span>inflate</span><span>(</span>layoutInflater<span>)</span>
<span>setContentView</span><span>(</span>binding<span>.</span>root<span>)</span>

<span>// Set the widgets&#39; text</span>
binding<span>.</span>textviewInstructions<span>.</span>text <span>=</span> <span>&#34;Here are your instructions.&#34;</span>
binding<span>.</span>edittextInput <span>=</span> <span>&#34;Edit this text.&#34;</span>
binding<span>.</span>buttonSubmit <span>=</span> <span>&#34;Tap me!&#34;</span></code></pre><p>Note that the system automatically converts the names of controls in the layout file, which use <code>snake_case</code>, into <code>binding</code> property names, which use <code>camelCase</code>. For example, the control whose <code>id</code> is <code>button_submit</code> in the layout file has a corresponding <code>binding</code> property named <code>buttonSubmit</code>.</p><p>Now that you‚Äôve been introduced to view binding let‚Äôs enable it.</p><p>üõ† Add this <code>buildFeatures</code> block to the <code>android</code> block in the app‚Äôs <code>build<span>.</span>gradle</code> file:</p><pre><code>buildFeatures <span>{</span>
    viewBinding <span>true</span>
<span>}</span></code></pre><p>Here‚Äôs what the <code>android</code> block should look like once you‚Äôve added the <code>buildFeatures</code> block:</p><pre><code>android <span>{</span>
    compileSdk <span>31</span>

    defaultConfig <span>{</span>
        applicationId <span>&#34;com.example.myapplicationx&#34;</span>
        minSdk <span>21</span>
        targetSdk <span>31</span>
        versionCode <span>1</span>
        versionName <span>&#34;1.0&#34;</span>
        manifestPlaceholders <span>=</span> <span>[</span>auth0Domain<span>:</span> <span>&#34;@string/com_auth0_domain&#34;</span><span>,</span> auth0Scheme<span>:</span> <span>&#34;@string/com_auth0_scheme&#34;</span><span>]</span>

        testInstrumentationRunner <span>&#34;androidx.test.runner.AndroidJUnitRunner&#34;</span>
    <span>}</span>

    buildTypes <span>{</span>
        release <span>{</span>
            minifyEnabled <span>false</span>
            proguardFiles <span>getDefaultProguardFile</span><span>(</span><span>&#39;proguard-android-optimize.txt&#39;</span><span>)</span><span>,</span> <span>&#39;proguard-rules.pro&#39;</span>
        <span>}</span>
    <span>}</span>
    compileOptions <span>{</span>
        sourceCompatibility JavaVersion<span>.</span><span>VERSION_1_8</span>
        targetCompatibility JavaVersion<span>.</span><span>VERSION_1_8</span>
    <span>}</span>
    kotlinOptions <span>{</span>
        jvmTarget <span>=</span> <span>&#39;1.8&#39;</span>
    <span>}</span>
    buildFeatures <span>{</span>
        viewBinding <span>true</span>
    <span>}</span>
<span>}</span></code></pre><h4 id="Synchronize-the-project-with-the-updated-Gradle-file">Synchronize the project with the updated Gradle file</h4><p>After making these changes to the Gradle file, you‚Äôll need to synchronize the project with the new build configuration you defined. Android Studio will notify you that it detected the changes to the Gradle file and present you with the option to synchronize the project with the updated file.</p><p>üõ† Click the <strong>Sync Now</strong> link that appears in the notification near the top of the Android Studio window:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7MfBWjCw726wDkiyg4PVyO/986c835490dbebb3fb26fd67dd5ac6ec/click_sync_now.png" alt="The code window for the ‚Äúbuild.gradle‚Äù file. A notification bar at the top of the window says, ‚ÄúGradle files have changed since last project sync."/></p><h4 id="Give-the-app-permission-to-access-the-internet">Give the app permission to access the internet</h4><p>üõ† Open the Android manifest file, <code>AndroidManifest<span>.</span>xml</code>, located in the <code>app<span>/</span>manifests</code> folder, and add the XML element below as a child of the <code><span>&lt;</span>manifest<span>&gt;</span></code> element:</p><pre><code><span>&lt;</span>uses<span>-</span>permission android<span>:</span>name<span>=</span><span>&#34;android.permission.INTERNET&#34;</span> <span>/</span><span>&gt;</span></code></pre><p>This line grants your app the permission to perform network operations, which will allow it to contact Auth0 and make use of its Authentication API.</p><p>Here‚Äôs what <code>AndroidManifest<span>.</span>xml</code> should look like once you‚Äôve added the XML element:</p><pre><code><span>&lt;!-- AndroidManifest.xml --&gt;</span>

<span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span><span><span>&lt;</span>manifest</span> <span><span>xmlns:</span>android</span><span><span>=</span><span>&#34;</span>http://schemas.android.com/apk/res/android<span>&#34;</span></span>
    <span>package</span><span><span>=</span><span>&#34;</span>com.example.login<span>&#34;</span></span><span>&gt;</span></span>
    
    <span><span><span>&lt;</span>uses-permission</span> <span><span>android:</span>name</span><span><span>=</span><span>&#34;</span>android.permission.INTERNET<span>&#34;</span></span> <span>/&gt;</span></span>

    <span><span><span>&lt;</span>application</span>
        <span><span>android:</span>allowBackup</span><span><span>=</span><span>&#34;</span>true<span>&#34;</span></span>
        <span><span>android:</span>icon</span><span><span>=</span><span>&#34;</span>@mipmap/ic_launcher<span>&#34;</span></span>
        <span><span>android:</span>label</span><span><span>=</span><span>&#34;</span>@string/app_name<span>&#34;</span></span>
        <span><span>android:</span>roundIcon</span><span><span>=</span><span>&#34;</span>@mipmap/ic_launcher_round<span>&#34;</span></span>
        <span><span>android:</span>supportsRtl</span><span><span>=</span><span>&#34;</span>true<span>&#34;</span></span>
        <span><span>android:</span>theme</span><span><span>=</span><span>&#34;</span>@style/Theme.Login<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>activity</span>
            <span><span>android:</span>name</span><span><span>=</span><span>&#34;</span>.MainActivity<span>&#34;</span></span>
            <span><span>android:</span>exported</span><span><span>=</span><span>&#34;</span>true<span>&#34;</span></span><span>&gt;</span></span>
            <span><span><span>&lt;</span>intent-filter</span><span>&gt;</span></span>
                <span><span><span>&lt;</span>action</span> <span><span>android:</span>name</span><span><span>=</span><span>&#34;</span>android.intent.action.MAIN<span>&#34;</span></span> <span>/&gt;</span></span>

                <span><span><span>&lt;</span>category</span> <span><span>android:</span>name</span><span><span>=</span><span>&#34;</span>android.intent.category.LAUNCHER<span>&#34;</span></span> <span>/&gt;</span></span>
            <span><span><span>&lt;/</span>intent-filter</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>activity</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>application</span><span>&gt;</span></span>

<span><span><span>&lt;/</span>manifest</span><span>&gt;</span></span></code></pre><h3 id="Update-the-project-s-string-resource-file">Update the project‚Äôs string resource file</h3><p>We‚Äôre going to follow the Android recommended practice and put all the string literals used by the app in <a href="https://developer.android.com/guide/topics/resources/string-resource" target="_blank" rel="noreferrer noopener">string resource</a> files.</p><p>By default, new Android projects come with a file located in <code><span>/</span>app<span>/</span>res<span>/</span>values<span>/</span></code> named <code>strings<span>.</span>xml</code>. While resource files can contain resouces of any type, the convention is to use <code>strings<span>.</span>xml</code> for strings only. Let‚Äôs put the non-sensitive strings into that file.</p><p>üõ† Open <code>strings<span>.</span>xml</code>. It should contain the following:</p><pre><code><span>&lt;!-- strings.xml --&gt;</span>

<span><span><span>&lt;</span>resources</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>app_name<span>&#34;</span></span><span>&gt;</span></span>{APP_NAME}<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>resources</span><span>&gt;</span></span></code></pre><p>Instead of <code><span>{</span><span>APP_NAME</span><span>}</span></code>, you‚Äôll see the name that you assigned to your app when you first created the project.</p><p>üõ† Replace the contents of <code>strings<span>.</span>xml</code> with the following:</p><pre><code><span>&lt;!-- strings.xml --&gt;</span>

<span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span><span><span>&lt;</span>resources</span><span>&gt;</span></span>

    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>app_name<span>&#34;</span></span><span>&gt;</span></span>{APP_NAME}<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

    <span>&lt;!--
    Auth0 identifiers and settings
    ==============================
    --&gt;</span>

    <span>&lt;!-- Identifiers --&gt;</span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>com_auth0_scheme<span>&#34;</span></span><span>&gt;</span></span>app<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

    <span>&lt;!-- Settings --&gt;</span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>login_scopes<span>&#34;</span></span><span>&gt;</span></span>openid profile email read:current_user update:current_user_metadata<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>login_audience<span>&#34;</span></span><span>&gt;</span></span>https://%1$s/api/v2/<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>


    <span>&lt;!--
    Main activity
    =============
    --&gt;</span>

    <span>&lt;!-- Title --&gt;</span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>initial_title<span>&#34;</span></span><span>&gt;</span></span>Welcome to the app!<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>logged_in_title<span>&#34;</span></span><span>&gt;</span></span>You\&#39;re logged in.<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>logged_out_title<span>&#34;</span></span><span>&gt;</span></span>You\&#39;re logged out.<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

    <span>&lt;!-- &#34;Log in&#34; and &#34;Log out&#34; buttons --&gt;</span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>button_login<span>&#34;</span></span><span>&gt;</span></span>Log in<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>button_logout<span>&#34;</span></span><span>&gt;</span></span>Log out<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

    <span>&lt;!-- User profile --&gt;</span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>user_profile<span>&#34;</span></span><span>&gt;</span></span>
        Name: %1$s\n
        Email: %2$s
    <span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

    <span>&lt;!-- Metadata --&gt;</span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>textview_metadata_heading<span>&#34;</span></span><span>&gt;</span></span>Metadata<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>textview_metadata_info<span>&#34;</span></span><span>&gt;</span></span>Use the text box and buttons below to get and set the \&#39;country\&#39; field in the user\&#39;s metadata.<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

    <span>&lt;!-- &#34;Get&#34; and &#34;Set&#34; buttons --&gt;</span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>button_get<span>&#34;</span></span><span>&gt;</span></span>Get<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>button_set<span>&#34;</span></span><span>&gt;</span></span>Set<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

    <span>&lt;!-- SnackBar messages--&gt;</span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>login_success_message<span>&#34;</span></span><span>&gt;</span></span>Successfully logged in! %1$s<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>login_failure_message<span>&#34;</span></span><span>&gt;</span></span>Failed to log in. %1$s<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>general_failure_with_exception_code<span>&#34;</span></span><span>&gt;</span></span>Failed - exception code: %1$s<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>general_success_message<span>&#34;</span></span><span>&gt;</span></span>Success!<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

<span><span><span>&lt;/</span>resources</span><span>&gt;</span></span></code></pre><p>üõ† Make the following replacements in the XML above:</p><ul><li>Replace <code><span>{</span><span>APP_NAME</span><span>}</span></code> with the name of your app.</li></ul><h3 id="Create-a-separate-string-resource-file-for-Auth0-credentials">Create a separate string resource file for Auth0 credentials</h3><p>There are still two strings that we need to store in a resource file: the Auth0 domain and client ID that the app will use. </p><p>Unlike the values you‚Äôre storing in <code>strings<span>.</span>xml</code>, these are values that you want to keep secret and don‚Äôt want ‚Äúleaked‚Äù. A common approach to dealing with is issue is to store ‚Äúsecret‚Äù values like these in a separate resource file so that you can limit access to them. Let‚Äôs create a new string resource file for our ‚Äúsecret‚Äù Auth0 values.</p><p>üõ† In Android Studio‚Äôs <strong>Project</strong> pane, right-click on the <code>values</code> folder. In the menu that appears, select <strong>New</strong>, which will cause a sub-menu to appear. Select <strong>Values Resource File</strong> from that sub-menu:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6g58ZVxykAAuh7hvHwtqlU/4c6289c47d6275c04df0257ffd2b78d8/creating_a_new_resource_file_1.png"/></p><p>üõ† The <strong>New Resource File</strong> window will appear. Enter <code>auth0<span>.</span>xml</code> into the <strong>File name:</strong> field and click the <strong>OK</strong> button to create a new resource file with that name:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3bfkNBq7tfwSYbPNTJ6zSR/627c9fd1aec651382fc44bc035555625/creating_a_new_resource_file_2.png"/></p><p>üõ† Open the newly-created <code>auth0<span>.</span>xml</code> file and enter the following into it:</p><pre><code><span>&lt;!-- auth0.xml --&gt;</span>

<span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span><span><span>&lt;</span>resources</span><span>&gt;</span></span>

    <span>&lt;!--
    Secret Auth0 identifiers and settings
    =====================================
    These values are required to connect to Auth0 for authorization,
    which is why we&#39;re storing them in their own string resource file.

    DO NOT CHECK THIS FILE INTO A PUBLIC REPOSITORY!
    --&gt;</span>

    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>com_auth0_domain<span>&#34;</span></span><span>&gt;</span></span>{DOMAIN}<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>com_auth0_client_id<span>&#34;</span></span><span>&gt;</span></span>{CLIENT_ID}<span><span><span>&lt;/</span>string</span><span>&gt;</span></span>

<span><span><span>&lt;/</span>resources</span><span>&gt;</span></span></code></pre><p>üõ† Make the following replacements in the XML above:</p><ul><li>Replace <code><span>{</span><span>DOMAIN</span><span>}</span></code> with the domain of your app, which you copied from the <strong>Settings</strong> page of the Auth0 dashboard.</li><li>Replace <code><span>{</span><span>CLIENT_ID</span><span>}</span></code> with the client ID of your app, which you copied from the <strong>Settings</strong> page of the Auth0 dashboard.</li></ul><h3 id="Define-the-app-s-user-interface">Define the app‚Äôs user interface</h3><p>It‚Äôs time to define the app‚Äôs user interface. This is a single-screen app, so everything takes place in the Main Activity file, whose layout is defined in the <code>activity_main<span>.</span>xml</code> file located in the <code>app<span>/</span>res<span>/</span>layout</code> folder.</p><p>üõ† Open <code>activity_main<span>.</span>xml</code>, switch to the code view and replace the children of the <code><span>&lt;</span>androidx<span>.</span>constraintlayout<span>.</span>widget<span>.</span>ConstraintLayout<span>&gt;</span></code> tag with the following:</p><pre><code><span>&lt;!-- activity_main.xml --&gt;</span>

<span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span><span><span>&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span><span>xmlns:</span>android</span><span><span>=</span><span>&#34;</span>http://schemas.android.com/apk/res/android<span>&#34;</span></span>
    <span><span>xmlns:</span>app</span><span><span>=</span><span>&#34;</span>http://schemas.android.com/apk/res-auto<span>&#34;</span></span>
    <span><span>xmlns:</span>tools</span><span><span>=</span><span>&#34;</span>http://schemas.android.com/tools<span>&#34;</span></span>
    <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>match_parent<span>&#34;</span></span>
    <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>match_parent<span>&#34;</span></span>
    <span><span>tools:</span>context</span><span><span>=</span><span>&#34;</span>.MainActivity<span>&#34;</span></span><span>&gt;</span></span>

    <span><span><span>&lt;</span>ScrollView</span> <span><span>xmlns:</span>android</span><span><span>=</span><span>&#34;</span>http://schemas.android.com/apk/res/android<span>&#34;</span></span>
        <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>fill_parent<span>&#34;</span></span>
        <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>fill_parent<span>&#34;</span></span>
        <span><span>tools:</span>ignore</span><span><span>=</span><span>&#34;</span>MissingConstraints<span>&#34;</span></span><span>&gt;</span></span>

        <span><span><span>&lt;</span>LinearLayout</span> <span><span>xmlns:</span>android</span><span><span>=</span><span>&#34;</span>http://schemas.android.com/apk/res/android<span>&#34;</span></span>
            <span><span>android:</span>orientation</span><span><span>=</span><span>&#34;</span>vertical<span>&#34;</span></span>
            <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>match_parent<span>&#34;</span></span>
            <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>match_parent<span>&#34;</span></span>
            <span><span>android:</span>gravity</span><span><span>=</span><span>&#34;</span>center<span>&#34;</span></span><span>&gt;</span></span>

            <span><span><span>&lt;</span>TextView</span>
                <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/textview_title<span>&#34;</span></span>
                <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&#34;</span>100dp<span>&#34;</span></span>
                <span><span>android:</span>text</span><span><span>=</span><span>&#34;</span>@string/initial_title<span>&#34;</span></span>
                <span><span>android:</span>textSize</span><span><span>=</span><span>&#34;</span>26sp<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintEnd_toEndOf</span><span><span>=</span><span>&#34;</span>parent<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintStart_toStartOf</span><span><span>=</span><span>&#34;</span>parent<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintTop_toTopOf</span><span><span>=</span><span>&#34;</span>parent<span>&#34;</span></span> <span>/&gt;</span></span>

            <span><span><span>&lt;</span>Button</span>
                <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/button_login<span>&#34;</span></span>
                <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>200dp<span>&#34;</span></span>
                <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&#34;</span>36dp<span>&#34;</span></span>
                <span><span>android:</span>text</span><span><span>=</span><span>&#34;</span>@string/button_login<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintEnd_toEndOf</span><span><span>=</span><span>&#34;</span>@+id/textview_title<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintStart_toStartOf</span><span><span>=</span><span>&#34;</span>@+id/textview_title<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintTop_toBottomOf</span><span><span>=</span><span>&#34;</span>@+id/textview_title<span>&#34;</span></span> <span>/&gt;</span></span>

            <span><span><span>&lt;</span>Button</span>
                <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/button_logout<span>&#34;</span></span>
                <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>200dp<span>&#34;</span></span>
                <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                <span><span>android:</span>text</span><span><span>=</span><span>&#34;</span>@string/button_logout<span>&#34;</span></span>
                <span><span>android:</span>enabled</span><span><span>=</span><span>&#34;</span>false<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintEnd_toEndOf</span><span><span>=</span><span>&#34;</span>@+id/textview_title<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintStart_toStartOf</span><span><span>=</span><span>&#34;</span>@+id/textview_title<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintTop_toBottomOf</span><span><span>=</span><span>&#34;</span>@+id/button_login<span>&#34;</span></span> <span>/&gt;</span></span>

            <span><span><span>&lt;</span>TextView</span>
                <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/textview_user_profile<span>&#34;</span></span>
                <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintEnd_toEndOf</span><span><span>=</span><span>&#34;</span>parent<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintStart_toStartOf</span><span><span>=</span><span>&#34;</span>parent<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintTop_toBottomOf</span><span><span>=</span><span>&#34;</span>@id/button_logout<span>&#34;</span></span>
                <span><span>android:</span>layout_margin</span><span><span>=</span><span>&#34;</span>18dp<span>&#34;</span></span><span>/&gt;</span></span>

            <span><span><span>&lt;</span>LinearLayout</span>
                <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/linearlayout_metadata<span>&#34;</span></span>
                <span><span>android:</span>visibility</span><span><span>=</span><span>&#34;</span>invisible<span>&#34;</span></span>
                <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                <span><span>android:</span>orientation</span><span><span>=</span><span>&#34;</span>vertical<span>&#34;</span></span>
                <span><span>android:</span>gravity</span><span><span>=</span><span>&#34;</span>center<span>&#34;</span></span>
                <span><span>android:</span>layout_marginTop</span><span><span>=</span><span>&#34;</span>16dp<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintEnd_toEndOf</span><span><span>=</span><span>&#34;</span>parent<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintStart_toStartOf</span><span><span>=</span><span>&#34;</span>parent<span>&#34;</span></span>
                <span><span>app:</span>layout_constraintTop_toBottomOf</span><span><span>=</span><span>&#34;</span>@id/textview_user_profile<span>&#34;</span></span><span>&gt;</span></span>

                <span><span><span>&lt;</span>TextView</span>
                    <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/textview_metadata_heading<span>&#34;</span></span>
                    <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                    <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                    <span><span>android:</span>textStyle</span><span><span>=</span><span>&#34;</span>bold<span>&#34;</span></span>
                    <span><span>android:</span>text</span><span><span>=</span><span>&#34;</span>@string/textview_metadata_heading<span>&#34;</span></span><span>/&gt;</span></span>

                <span><span><span>&lt;</span>TextView</span>
                    <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/textview_metadata_info<span>&#34;</span></span>
                    <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>match_parent<span>&#34;</span></span>
                    <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>50dp<span>&#34;</span></span>
                    <span><span>android:</span>layout_margin</span><span><span>=</span><span>&#34;</span>8dp<span>&#34;</span></span>
                    <span><span>android:</span>textAlignment</span><span><span>=</span><span>&#34;</span>center<span>&#34;</span></span>
                    <span><span>android:</span>text</span><span><span>=</span><span>&#34;</span>@string/textview_metadata_info<span>&#34;</span></span>
                    <span><span>android:</span>textSize</span><span><span>=</span><span>&#34;</span>12sp<span>&#34;</span></span> <span>/&gt;</span></span>

                <span><span><span>&lt;</span>EditText</span>
                    <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/edittext_country<span>&#34;</span></span>
                    <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>match_parent<span>&#34;</span></span>
                    <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                    <span><span>android:</span>hint</span><span><span>=</span><span>&#34;</span>Enter country<span>&#34;</span></span> <span>/&gt;</span></span>

                <span><span><span>&lt;</span>LinearLayout</span>
                    <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                    <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                    <span><span>android:</span>orientation</span><span><span>=</span><span>&#34;</span>horizontal<span>&#34;</span></span>
                    <span><span>android:</span>gravity</span><span><span>=</span><span>&#34;</span>center<span>&#34;</span></span><span>&gt;</span></span>

                    <span><span><span>&lt;</span>Button</span>
                        <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/button_get<span>&#34;</span></span>
                        <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>100dp<span>&#34;</span></span>
                        <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                        <span><span>android:</span>text</span><span><span>=</span><span>&#34;</span>@string/button_get<span>&#34;</span></span>
                        <span><span>android:</span>layout_marginRight</span><span><span>=</span><span>&#34;</span>8dp<span>&#34;</span></span><span>/&gt;</span></span>

                    <span><span><span>&lt;</span>Button</span>
                        <span><span>android:</span>id</span><span><span>=</span><span>&#34;</span>@+id/button_set<span>&#34;</span></span>
                        <span><span>android:</span>layout_width</span><span><span>=</span><span>&#34;</span>100dp<span>&#34;</span></span>
                        <span><span>android:</span>layout_height</span><span><span>=</span><span>&#34;</span>wrap_content<span>&#34;</span></span>
                        <span><span>android:</span>text</span><span><span>=</span><span>&#34;</span>@string/button_set<span>&#34;</span></span>
                        <span><span>android:</span>layout_marginLeft</span><span><span>=</span><span>&#34;</span>8dp<span>&#34;</span></span><span>/&gt;</span></span>

                <span><span><span>&lt;/</span>LinearLayout</span><span>&gt;</span></span>

            <span><span><span>&lt;/</span>LinearLayout</span><span>&gt;</span></span>

        <span><span><span>&lt;/</span>LinearLayout</span><span>&gt;</span></span>

    <span><span><span>&lt;/</span>ScrollView</span><span>&gt;</span></span>

<span><span><span>&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span>&gt;</span></span></code></pre><p>This XML above defines:</p><ul><li>A <a href="https://developer.android.com/reference/android/widget/ScrollView" target="_blank" rel="noreferrer noopener"><code>ScrollView</code></a> that encapsulates the entire user interface. It allows the user to scroll up and down when the device screen isn‚Äôt tall enough to display the entire activity at once.</li><li>A <a href="https://developer.android.com/reference/android/widget/LinearLayout" target="_blank" rel="noreferrer noopener"><code>LinearLayout</code></a> contained within the <code>ScrollView</code>. A <code>ScrollView</code> can contain only one child, so we‚Äôre using the <code>LinearLayout</code> to encapsulate all the views in the <code>ScrollView</code>.</li><li><code>textview_title</code>: A <a href="https://developer.android.com/reference/android/widget/TextView" target="_blank" rel="noreferrer noopener"><code>TextView</code></a> that displays a greeting message when the app launches and the user‚Äôs logged-in/out status afterward.</li><li><code>button_login</code> and <code>button_logout</code>: The <a href="https://developer.android.com/reference/android/widget/Button" target="_blank" rel="noreferrer noopener"><code>Button</code></a>s that the user taps to log in and out.</li><li><code>textview_user_profile</code>: A <code>TextView</code> that displays the name and email of the logged-in user.</li><li><code>layout_metadata</code>: A <code>LinearLayout</code> that encapsulates all the metadata-related controls.</li><li><code>textview_metadata_heading</code>: A <code>TextView</code> that displays the heading of the metadata section.</li><li><code>textview_metadata_country</code>: A <code>TextView</code> that instructions for editing the user‚Äôs country.</li><li><code>edittext_country</code>: An <a href="https://developer.android.com/reference/android/widget/EditText" target="_blank" rel="noreferrer noopener"><code>EditText</code></a> for displaying and editing the user‚Äôs country.</li><li><code>button_get</code> and <code>button_set</code>: The <code>Button</code>s to get and set the user‚Äôs country.</li></ul><p>Here‚Äôs the ‚Äúblueprint view‚Äù of the resulting layout. I‚Äôve labeled the controls in the layout with their <code>id</code>s:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4DF79VdhoNlyAKOKkmQOsa/f280540a8f0d8484ab55a08ac83c3c5a/app_layout.png" alt="‚ÄúBlueprint view‚Äù of the app‚Äôs main activity layout showing the ids of its controls."/></p><p>At this point in the exercise, you‚Äôve completed all the setup. You‚Äôve registered the app with Auth0 and set up the app‚Äôs build files and user interface. In the next step, you‚Äôll write the app‚Äôs code!</p><p><a href="https://auth0.com/blog/get-started-with-android-authentication-using-kotlin-part-2" target="_blank" rel="noopener referrer">Next Step: Read the second part here</a></p><p><a href="https://community.auth0.com/t/developing-a-secure-api-with-nestjs/33026" target="_blank" rel="noopener noreferrer">I ran into an issue</a></p></div></div>]]></content:encoded>
      <pubDate>Mon, 20 Sep 2021 18:29:00 +0000</pubDate>
    </item>
    <item>
      <title>Get Started with Android Authentication Using Kotlin: Part 2</title>
      <link>https://auth0.com/blog/get-started-with-android-authentication-using-kotlin-part-2/</link>
      <description>Learn how to implement login, logout, and user profiles in Android apps using Kotlin and Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the previous section, you started an Android project that uses Auth0 for user login, logout, and reading and updating user metadata. You set up the project on both the Auth0 and app sides. In this section, you‚Äôll complete the project and update it to ensure that it works in both portrait and landscape orientations.</p><h2 id="Write-the-code">Write the code</h2><p>Everything you‚Äôve done so far in this exercise is just a preamble. It‚Äôs now time to write the actual code! This is the biggest task in the exercise, so let‚Äôs do it in small steps.‚Äã</p><p>üõ† Move to the <code>app<span>/</span>java<span>/</span>com<span>.</span>example<span>.</span>login</code> folder and open the main activity‚Äôs file, <code>MainActivity<span>.</span>kt</code>. Its contents should look like this:</p><pre><code><span>package</span> com<span>.</span>example<span>.</span>myapplication

<span>import</span> androidx<span>.</span>appcompat<span>.</span>app<span>.</span>AppCompatActivity
<span>import</span> android<span>.</span>os<span>.</span>Bundle

<span>class</span> MainActivity <span>:</span> <span>AppCompatActivity</span><span>(</span><span>)</span> <span>{</span>
    <span>override</span> <span>fun</span> <span>onCreate</span><span>(</span>savedInstanceState<span>:</span> Bundle<span>?</span><span>)</span> <span>{</span>
        <span>super</span><span>.</span><span>onCreate</span><span>(</span>savedInstanceState<span>)</span>
        <span>setContentView</span><span>(</span>R<span>.</span>layout<span>.</span>activity_main<span>)</span>
    <span>}</span>
<span>}</span></code></pre><h3 id="Import-the-necessary-libraries">Import the necessary libraries</h3><p>üõ† Add the following <code><span>import</span></code> statements to the ones already in the file:</p><pre><code><span>import</span> androidx<span>.</span>core<span>.</span>view<span>.</span>isVisible
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>Auth0
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>authentication<span>.</span>AuthenticationAPIClient
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>authentication<span>.</span>AuthenticationException
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>callback<span>.</span>Callback
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>management<span>.</span>ManagementException
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>management<span>.</span>UsersAPIClient
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>provider<span>.</span>WebAuthProvider
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>result<span>.</span>Credentials
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>result<span>.</span>UserProfile
<span>import</span> com<span>.</span>google<span>.</span>android<span>.</span>material<span>.</span>snackbar<span>.</span>Snackbar</code></pre><p>Most of these <code><span>import</span></code> statements import classes from Auth0‚Äôs libraries. Here‚Äôs what those classes do:</p><ul><li><code>AuthenticationAPIClient</code>: Accesses the Auth0 Authentication API. The app uses this to retrieve the user‚Äôs profile information.</li><li><code>AuthenticationException</code>: Defines errors and exceptions that may arise during authentication.</li><li><code>Callback</code>: Defines an object containing ‚Äúsuccess‚Äù and ‚Äúfailure‚Äù callback functions that Auth0 should call after completing an API function.</li><li><code>ManagementException</code>: Defines errors and exceptions that <code>Callback</code> objects may have to handle.</li><li><code>UsersAPIClient</code>: Manages user information. The app uses this to retrieve the user‚Äôs profile information.</li><li><code>WebAuthProvider</code>: Provides Auth0‚Äôs web page-based login to the app. The app uses this to log the user in via a login page in a web browser and log the user out.</li><li><code>Credentials</code>: Stores the user‚Äôs credentials, including ID, access, and refresh tokens.</li><li><code>UserProfile</code>: Stores the user‚Äôs profile information, including their user ID, names, email address, and metadata.</li></ul><p>üõ† You‚Äôll also need to import the <code>Activity</code> ‚Äôs auto-generated view binding library, which will make it possible for your code to reference views in the layout (or, to put it more simply: access the onscreen widgets). Do this by adding the following <code><span>import</span></code> statement, replacing <code><span>{</span><span>YOUR_PACKAGE_NAME_HERE</span><span>}</span></code> with the name of your app‚Äôs package, which you‚Äôll find on the first line of the file:</p><pre><code><span>import</span> <span>{</span>YOUR_PACKAGE_NAME_HERE<span>}</span><span>.</span>databinding<span>.</span>ActivityMainBinding</code></pre><p>The package name for my app is <code>com<span>.</span>example<span>.</span>login</code>, so my <code><span>import</span></code> statement looks like this:</p><pre><code><span>import</span> com<span>.</span>example<span>.</span>login<span>.</span>databinding<span>.</span>ActivityMainBinding</code></pre><h3 id="Add-class-properties">Add class properties</h3><p>üõ† Add the following properties to <code>MainActivity</code> so that the start of the class looks like this:</p><pre><code><span>class</span> MainActivity <span>:</span> <span>AppCompatActivity</span><span>(</span><span>)</span> <span>{</span>

    <span>private</span> <span>lateinit</span> <span>var</span> binding<span>:</span> ActivityMainBinding

    <span>// Login/logout-related properties</span>
    <span>private</span> <span>lateinit</span> <span>var</span> account<span>:</span> Auth0
    <span>private</span> <span>var</span> cachedCredentials<span>:</span> Credentials<span>?</span> <span>=</span> <span>null</span>
    <span>private</span> <span>var</span> cachedUserProfile<span>:</span> UserProfile<span>?</span> <span>=</span> <span>null</span>


    <span>override</span> <span>fun</span> <span>onCreate</span><span>(</span>savedInstanceState<span>:</span> Bundle<span>?</span><span>)</span> <span>{</span>
    
    <span>..</span><span>.</span></code></pre><p>You‚Äôll use the first property, <code>binding</code>, to access the widgets on the screen. The other three properties are related to logging in and out and are described in more detail below:</p><ul><li><code>account</code>: represents the app‚Äôs Auth0 account and is instantiated using the app‚Äôs client ID and the domain for the app‚Äôs Auth0 tenant. Let me make this clear: this isn‚Äôt the account of the user trying to log in, but the account of the developer or organization who is delegating the login/logout process to Auth0. In the case of this example, it‚Äôs <em>your</em> Auth0 developer account. <code>account</code>‚Äôs value is set in <code><span>onCreate</span><span>(</span><span>)</span></code> when the activity is instantiated.</li><li><code>cachedCredentials</code>: contains the user‚Äôs credentials that are returned from Auth0 after a successful login. Its value should be <code><span>null</span></code> when the user is <em>not</em> logged in. When the user is logged in, it should reference an instance of <code>Credentials</code>. A <code>Credentials</code> instance has the following properties:
  <ul><li><code>idToken</code>: The <a href="https://auth0.com/docs/tokens/id-tokens" target="_blank" rel="noreferrer noopener">ID token</a>, which contains user information that the app can use to customize the user‚Äôs experience.</li><li><code>accessToken</code>: The <a href="https://auth0.com/docs/tokens/access-tokens" target="_blank" rel="noreferrer noopener">access token</a>, which is a credential that allows the app to access the Auth0 API.</li><li><code>refreshToken</code>: The <a href="https://auth0.com/docs/tokens/refresh-tokens" target="_blank" rel="noreferrer noopener">refresh token</a>, which can be used to request a new access token when the original access token expires, without requiring the user to re-authenticate.</li><li><code>type</code>: The type of the received access token.</li><li><code>expiresAt</code>: The date/time when the received access token expires.</li><li><code>scope</code>: The scopes granted to the access token. I‚Äôll explain what scopes are in the next section, <em>The login method</em>.</li></ul></li><li><code>cachedUserProfile</code>: holds the user‚Äôs profile information. Its value should be <code><span>null</span></code> when the user is <em>not</em> logged in. When the user is logged in, it should reference an instance of <code>UserProfile</code>. A <code>UserProfile</code> instance has the following properties:
<ul><li><code>email</code>: The email address corresponding to the user account.</li><li><code>isEmailVerified</code>: <code><span>true</span></code> if the user responded to the verification email sent by Auth0 after they registered themselves as a user.</li><li><code>name</code>: The user‚Äôs full name.</li><li><code>givenName</code>: The user‚Äôs given name, often referred to as their ‚Äúfirst name‚Äù or ‚Äúforename‚Äù.</li><li><code>familyName</code>: The user‚Äôs family name, often referred to as their ‚Äúlast name‚Äù or ‚Äúsurname‚Äù.</li><li><code>nickname</code>: The user‚Äôs nickname, sometimes referred to as thier ‚Äúfamiliar name‚Äù or ‚Äúmoniker‚Äù.</li><li><code>PictureURL</code>: The URL where the user‚Äôs picture can be retrieved.</li><li><code>createdAt</code>: The creation date and time of the user‚Äôs account.</li></ul></li></ul><h3 id="Update-the--onCreate----method">Update the <code><span>onCreate</span><span>(</span><span>)</span></code> method</h3><p>First, let‚Äôs fill out the <code><span>onCreate</span><span>(</span><span>)</span></code> method that was automatically generated for the project and use it to initialize everything in the activity.</p><p>üõ† Update the <code><span>onCreate</span><span>(</span><span>)</span></code> method so that it looks like this:</p><pre><code><span>override</span> <span>fun</span> <span>onCreate</span><span>(</span>savedInstanceState<span>:</span> Bundle<span>?</span><span>)</span> <span>{</span>
    <span>super</span><span>.</span><span>onCreate</span><span>(</span>savedInstanceState<span>)</span>

    account <span>=</span> <span>Auth0</span><span>(</span>
        <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_client_id<span>)</span><span>,</span>
        <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_domain<span>)</span>
    <span>)</span>

    binding <span>=</span> ActivityMainBinding<span>.</span><span>inflate</span><span>(</span>layoutInflater<span>)</span>
    <span>setContentView</span><span>(</span>binding<span>.</span>root<span>)</span>

    binding<span>.</span>buttonLogin<span>.</span><span>setOnClickListener</span> <span>{</span> <span>login</span><span>(</span><span>)</span> <span>}</span>
    binding<span>.</span>buttonLogout<span>.</span><span>setOnClickListener</span> <span>{</span> <span>logout</span><span>(</span><span>)</span> <span>}</span>
    binding<span>.</span>buttonGet<span>.</span><span>setOnClickListener</span> <span>{</span> <span>getUserMetadata</span><span>(</span><span>)</span> <span>}</span>
    binding<span>.</span>buttonSet<span>.</span><span>setOnClickListener</span> <span>{</span> <span>setUserMetadata</span><span>(</span><span>)</span> <span>}</span>
<span>}</span></code></pre><p>This method:</p><ul><li>Defines the account object, which contains the necessary credentials to connect to your Auth0 account.</li><li>Creates a view binding object, which you‚Äôll use to access the onscreen widgets.</li><li>Connects the <strong>Log in</strong>, <strong>Log out</strong>, <strong>Get</strong>, and <strong>Set</strong> buttons to the methods they should call when tapped.</li></ul><h3 id="Add-the--login----method">Add the <code><span>login</span><span>(</span><span>)</span></code> method</h3><p>The next step is to implement the method that gets called when the user taps the <strong>Log In</strong> button.</p><p>üõ† Add this to the class after <code><span>onCreate</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
    WebAuthProvider
        <span>.</span><span>login</span><span>(</span>account<span>)</span>
        <span>.</span><span>withScheme</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_scheme<span>)</span><span>)</span>
        <span>.</span><span>withScope</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_scopes<span>)</span><span>)</span>
        <span>.</span><span>withAudience</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_audience<span>,</span> <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_domain<span>)</span><span>)</span><span>)</span>
        <span>.</span><span>start</span><span>(</span><span>this</span><span>,</span> <span>object</span> <span>:</span> Callback<span>&lt;</span>Credentials<span>,</span> AuthenticationException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> AuthenticationException<span>)</span> <span>{</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_failure_message<span>,</span> exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>credentials<span>:</span> Credentials<span>)</span> <span>{</span>
                cachedCredentials <span>=</span> credentials
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_success_message<span>,</span> credentials<span>.</span>accessToken<span>)</span><span>)</span>
                <span>updateUI</span><span>(</span><span>)</span>
                <span>showUserProfile</span><span>(</span><span>)</span>
            <span>}</span>
        <span>}</span><span>)</span>
<span>}</span></code></pre><p><code><span>login</span><span>(</span><span>)</span></code> uses the Auth0 SDK‚Äôs <code>WebAuthProvider</code> class, which gives the app the ability to use Auth0‚Äôs authentication service. The <code>WebAuthProvider</code> methods that you‚Äôll use most often are its <code><span>login</span><span>(</span><span>)</span></code> and <code><span>logout</span><span>(</span><span>)</span></code> methods.</p><p>Although this method is formatted to span several lines, it‚Äôs just a single line of code. The single line is made of a call to a chain of <code>WebAuthProvider</code> ‚Äôs methods starting with <code><span>login</span><span>(</span><span>)</span></code>. If you ignore all the comments and parameters, the method chain looks like this:</p><pre><code>WebAuthProvider
    <span>.</span><span>login</span><span>(</span><span>)</span>
    <span>.</span><span>withScheme</span><span>(</span><span>)</span>
    <span>.</span><span>withScope</span><span>(</span><span>)</span>
    <span>.</span><span>withAudience</span><span>(</span><span>)</span>
    <span>.</span><span>start</span><span>(</span><span>)</span></code></pre><p>This is the <a href="https://www.baeldung.com/kotlin/builder-pattern" target="_blank" rel="noreferrer noopener">Builder design pattern</a> in action. From <code><span>login</span><span>(</span><span>)</span></code> to <code><span>withAudience</span><span>(</span><span>)</span></code>, each method in the chain takes an argument that provides additional information about the login, using that information to creates a <code>WebAuthProvider</code> object that it passes to the next method in the chain. The final method in the chain, <code><span>start</span><span>(</span><span>)</span></code>, takes the resulting <code>WebAuthProvider</code> object as its argument and uses it to display the login page and define what should happen when the login succeeds and when it fails.</p><p>Let‚Äôs take a look at what each of the methods in the chain does.</p><p><code><span>login</span><span>(</span><span>)</span></code> initiates the login process and specifies the Auth0 account used by the application.</p><p><code><span>withScheme</span><span>(</span><span>)</span></code> specifies the scheme to use for the URL that Auth0 redirects to after a successful login. For web apps, the scheme is <code>http</code> or <code>https</code>. This value is arbitrary for native mobile apps, so we use <code>app</code> to make it clear to other developers and other people who may use the Auth0 settings for this app that the redirect is <em>not</em> to a web page.</p><p><code><span>withScope</span><span>(</span><span>)</span></code> specifies which sets of user data the app is authorized to use if the user logs in successfully. The OpenID Connect and OAuth frameworks, on which Auth0‚Äôs authentication and authorization are based, use the term <a href="https://auth0.com/docs/scopes/openid-connect-scopes" target="_blank" rel="noreferrer noopener"><em>scope</em></a> to represent the authorization to access user‚Äôs data and resources. The method takes a space-delimited string as its argument, where each ‚Äúword‚Äù in the string specifies a different scope. The string used in this app contains these scopes:</p><ul><li><code>openid</code>: Indicates that application that uses OpenID Connect for authentication. This is the only required scope; all other scopes are optional.</li><li><code>profile</code>: Authorizes the application to access basic user profile information, including first name, surname, nickname, their photo or avatar, and so on.</li><li><code>email</code>: Authorizes the application to access the user‚Äôs email address.</li><li><code>read<span>:</span>current_user</code>: Authorizes the application with read-only access to the <code>current_user</code> claim.</li><li><code>update<span>:</span>current_user_metadata</code>: Authorizes the application with read and write  access to the <code>current_user_metadata</code> claim. This scope allows us to get and set the <code>country</code> value in the user‚Äôs metadata.</li></ul><p><code><span>withAudience</span><span>(</span><span>)</span></code> specifies the URL that the app will use to connect to Auth0‚Äôs login service. This URL is constructed using the domain of the Auth0 tenant used by the app and the endpoint for the Auth0 authentication API.</p><p><code><span>start</span><span>(</span><span>)</span></code> takes the <code>WebAuthProvider</code> object constructed by all the previous methods in the chain and opens the browser window to display the login page. It takes two parameters: a context (a reference to the <code>Activity</code> that‚Äôs initiating the browser window) and an anonymous object with two callback methods:</p><ul><li><code><span>onFailure</span><span>(</span><span>)</span></code>: Defines what should happen if the user returns from the browser login screen without successfully logging in. This typically happens when the user closes the browser login screen or taps the ‚Äúback‚Äù button while on that screen. The app displays a <code>SnackBar</code> that notifies the user that login failed, followed by an error code.</li><li><code><span>onSuccess</span><span>(</span><span>)</span></code>: Defines what should happen if the user returns from the browser login screen after successfully logging in. The app processes the successful response, displays a <code>SnackBar</code> notifying the user that login was successful, and updates the UI to its ‚Äúlogged in‚Äù state.</li></ul><h3 id="Add-the--logout----method">Add the <code><span>logout</span><span>(</span><span>)</span></code> method</h3><p>You‚Äôve probably guessed that if there‚Äôs a <code><span>login</span><span>(</span><span>)</span></code> method that‚Äôs called when the user presses the <strong>Log In</strong> button, there must also be a <code><span>logout</span><span>(</span><span>)</span></code> method that‚Äôs called when the user presses the <strong>Log Out</strong> button.</p><p>üõ† Add this method to the class after <code><span>login</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>logout</span><span>(</span><span>)</span> <span>{</span>
    WebAuthProvider
        <span>.</span><span>logout</span><span>(</span>account<span>)</span>
        <span>.</span><span>withScheme</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_scheme<span>)</span><span>)</span>
        <span>.</span><span>start</span><span>(</span><span>this</span><span>,</span> <span>object</span> <span>:</span> Callback<span>&lt;</span>Void<span>?</span><span>,</span> AuthenticationException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> AuthenticationException<span>)</span> <span>{</span>
                <span>updateUI</span><span>(</span><span>)</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
                    exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>payload<span>:</span> Void<span>?</span><span>)</span> <span>{</span>
                cachedCredentials <span>=</span> <span>null</span>
                cachedUserProfile <span>=</span> <span>null</span>
                <span>updateUI</span><span>(</span><span>)</span>
            <span>}</span>

        <span>}</span><span>)</span>
<span>}</span></code></pre><p>As with <code><span>login</span><span>(</span><span>)</span></code>, <code><span>logout</span><span>(</span><span>)</span></code> also uses the Auth0 SDK‚Äôs <code>WebAuthProvider</code> class and is a one-liner that uses the Builder pattern. This time, that one line calls a shorter chain of <code>WebAuthProvider</code> ‚Äôs methods starting with <code><span>logout</span><span>(</span><span>)</span></code>. If you ignore all the parameters, the method chain looks like this:</p><pre><code>WebAuthProvider
    <span>.</span><span>logout</span><span>(</span><span>)</span>
    <span>.</span><span>withScheme</span><span>(</span><span>)</span>
    <span>.</span><span>start</span><span>(</span><span>)</span></code></pre><p><code><span>logout</span><span>(</span><span>)</span></code> initiates the logout process and specifies the Auth0 account used by the application, which should be the same account as the one used to log in.</p><p><code><span>withScheme</span><span>(</span><span>)</span></code> specifies the scheme to use for the URL that Auth0 redirects to after successful logout. This should be the same scheme as the one used to log in.</p><p><code><span>start</span><span>(</span><span>)</span></code> takes the <code>WebAuthProvider</code> object constructed by all the previous methods in the chain to log the user out. It takes two parameters: a context (a reference to the <code>Activity</code> that‚Äôs initiating the logout process) and an anonymous object with two callback methods:</p><ul><li><code><span>onFailure</span><span>(</span><span>)</span></code>: Defines what should happen when the logout process fails. This rarely happens and usually indicates a network or server issue. In this example, the app updates the UI (which remains in the ‚Äúlogged in‚Äù state) and displays a <code>SnackBar</code> that notifies the user that logout failed, followed by an error code.</li><li><code><span>onSuccess</span><span>(</span><span>)</span></code>: Defines what should happen when the logout process succeeds. In this example, the app destroys its local copies of the user‚Äôs credentials and profile and updates the UI to its ‚Äúlogged out‚Äù state.</li></ul><h3 id="Add-the--showUserProfile----method">Add the <code><span>showUserProfile</span><span>(</span><span>)</span></code> method</h3><p>Every Auth0 user has a <em>user profile</em> associated with their account. The user profile contains the following basic information about the user:</p><ul><li>Names: The user‚Äôs full name, given name, surname, and nickname</li><li>Email info: The user‚Äôs email address, and whether it was verified</li><li>Picture: The location of an image that identifies the user</li><li>Creation date: The date and time when the user‚Äôs account was created</li></ul><p>When the user successfully logs in, the app should display their name and email onscreen. It does so by calling <code><span>showUserProfile</span><span>(</span><span>)</span></code> immediately after a successful login.</p><p>üõ† Add this method to the class after <code><span>logout</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>showUserProfile</span><span>(</span><span>)</span> <span>{</span>
    <span>// Guard against showing the profile when no user is logged in</span>
    <span>if</span> <span>(</span>cachedCredentials <span>==</span> <span>null</span><span>)</span> <span>{</span>
        <span>return</span>
    <span>}</span>

    <span>val</span> client <span>=</span> <span>AuthenticationAPIClient</span><span>(</span>account<span>)</span>
    client
        <span>.</span><span>userInfo</span><span>(</span>cachedCredentials<span>!!</span><span>.</span>accessToken<span>!!</span><span>)</span>
        <span>.</span><span>start</span><span>(</span><span>object</span> <span>:</span> Callback<span>&lt;</span>UserProfile<span>,</span> AuthenticationException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> AuthenticationException<span>)</span> <span>{</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
                    exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>profile<span>:</span> UserProfile<span>)</span> <span>{</span>
                cachedUserProfile <span>=</span> profile
                <span>updateUI</span><span>(</span><span>)</span>
            <span>}</span>

        <span>}</span><span>)</span>
<span>}</span></code></pre><p>This method is the final task performed by the <code><span>onSuccess</span><span>(</span><span>)</span></code> callback method in  <code><span>loginWithBrowser</span><span>(</span><span>)</span></code>. It initializes the <code>cachedUserProfile</code> property, which contains the user‚Äôs profile information.</p><p>As a precaution, it returns immediately if the <code>cachedCredentials</code> property is <code><span>null</span></code>, which implies that no user is logged in, and therefore there isn‚Äôt any user profile to show.</p><p>In order to get this information, it does the following:</p><ul><li>It creates an instance of <code>AuthenticationAPIClient</code>, which retrieves Auth0 account information. Like the login and logout methods, this also uses the Builder pattern.</li><li>It uses <code>AuthenticationAPIClient</code> ‚Äôs <code><span>userInfo</span><span>(</span><span>)</span></code> method to specify that we want to retrieve user profile information from Auth0. This method requires a valid access token, which it extracts from the <code>cachedCredentials</code> property.</li><li>Finally, it defines callback methods for the cases where it failed and succeeded in retrieving the user profile information from Auth0. If the retrieval was successful, the profile information is stored in <code>cachedUserProfile</code>, and the UI is updated to display the user‚Äôs name and email address.</li></ul><h3 id="Add-the--getUserMetadata----and--setUserMetadata----methods">Add the <code><span>getUserMetadata</span><span>(</span><span>)</span></code> and <code><span>setUserMetadata</span><span>(</span><span>)</span></code> methods</h3><p>The user profile contains information that generally applies to <em>every</em> user account regardless of the type of application it‚Äôs being used for ‚Äî name, email, photo, and date/time created. While this is necessary information, it‚Äôs probably not <em>all</em> the user information that you want to store in their profile.</p><p>That what the <em>user metadata</em> is for. Think of it as a key-value store where you can place additional user information that isn‚Äôt covered by the user profile. In this app, the user metadata will store just one additional piece of user information ‚Äî their country ‚Äî and it will allow the user to retrieve and update this information.</p><p>üõ† Add the following to the class after <code><span>showUserProfile</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>getUserMetadata</span><span>(</span><span>)</span> <span>{</span>
    <span>// Guard against getting the metadata when no user is logged in</span>
    <span>if</span> <span>(</span>cachedCredentials <span>==</span> <span>null</span><span>)</span> <span>{</span>
        <span>return</span>
    <span>}</span>

    <span>val</span> usersClient <span>=</span> <span>UsersAPIClient</span><span>(</span>account<span>,</span> cachedCredentials<span>!!</span><span>.</span>accessToken<span>!!</span><span>)</span>

    usersClient
        <span>.</span><span>getProfile</span><span>(</span>cachedUserProfile<span>!!</span><span>.</span><span>getId</span><span>(</span><span>)</span><span>!!</span><span>)</span>
        <span>.</span><span>start</span><span>(</span><span>object</span> <span>:</span> Callback<span>&lt;</span>UserProfile<span>,</span> ManagementException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> ManagementException<span>)</span> <span>{</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
                    exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>userProfile<span>:</span> UserProfile<span>)</span> <span>{</span>
                cachedUserProfile <span>=</span> userProfile
                <span>updateUI</span><span>(</span><span>)</span>

                <span>val</span> country <span>=</span> userProfile<span>.</span><span>getUserMetadata</span><span>(</span><span>)</span><span>[</span><span>&#34;country&#34;</span><span>]</span> <span>as</span> String<span>?</span>
                binding<span>.</span>edittextCountry<span>.</span><span>setText</span><span>(</span>country<span>)</span>
            <span>}</span>

        <span>}</span><span>)</span>
<span>}</span>

<span>private</span> <span>fun</span> <span>setUserMetadata</span><span>(</span><span>)</span> <span>{</span>
    <span>// Guard against getting the metadata when no user is logged in</span>
    <span>if</span> <span>(</span>cachedCredentials <span>==</span> <span>null</span><span>)</span> <span>{</span>
        <span>return</span>
    <span>}</span>

    <span>val</span> usersClient <span>=</span> <span>UsersAPIClient</span><span>(</span>account<span>,</span> cachedCredentials<span>!!</span><span>.</span>accessToken<span>!!</span><span>)</span>
    <span>val</span> metadata <span>=</span> <span>mapOf</span><span>(</span><span>&#34;country&#34;</span> <span>to</span> binding<span>.</span>edittextCountry<span>.</span>text<span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span>

    usersClient
        <span>.</span><span>updateMetadata</span><span>(</span>cachedUserProfile<span>!!</span><span>.</span><span>getId</span><span>(</span><span>)</span><span>!!</span><span>,</span> metadata<span>)</span>
        <span>.</span><span>start</span><span>(</span><span>object</span> <span>:</span> Callback<span>&lt;</span>UserProfile<span>,</span> ManagementException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> ManagementException<span>)</span> <span>{</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
                    exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>profile<span>:</span> UserProfile<span>)</span> <span>{</span>
                cachedUserProfile <span>=</span> profile
                <span>updateUI</span><span>(</span><span>)</span>

                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_success_message<span>)</span><span>)</span>
            <span>}</span>

        <span>}</span><span>)</span>
<span>}</span></code></pre><p>While <code><span>showUserProfile</span><span>(</span><span>)</span></code> uses an instance of <code>AuthenticationAPIClient</code> to get the user profile information, <code><span>getUserMetadata</span><span>(</span><span>)</span></code> and <code><span>setUserMetadata</span><span>(</span><span>)</span></code> use a different object type: <code>UsersAPIClient</code>.</p><p>Unlike <code>AuthenticationAPIClient</code>, which needs only an <code>Auth0</code> account object to be instantiated, you need both an <code>Auth0</code> account object and an access token to instantiate a <code>UsersAPIClient</code> object.</p><p><code><span>getUserMetadata</span><span>(</span><span>)</span></code> specifies the user profile using <code>UsersAPIClient</code> ‚Äôs <code><span>getProfile</span><span>(</span><span>)</span></code> method and the ID of the user, followed by the <code><span>start</span><span>(</span><span>)</span></code> method to attempt to get the user profile and define callback methods for failure and success.</p><p><code><span>getUserMetadata</span><span>(</span><span>)</span></code>‚Äôs <code><span>onSuccess</span><span>(</span><span>)</span></code> callback is almost the same as <code><span>showUserProfile</span><span>(</span><span>)</span></code>‚Äôs ‚Äî it just has these two additional lines that extract the <code>country</code> value from the user‚Äôs metadata and display it onscreen:</p><pre><code><span>val</span> country <span>=</span> userProfile<span>.</span><span>getUserMetadata</span><span>(</span><span>)</span><span>[</span><span>&#34;country&#34;</span><span>]</span> <span>as</span> String<span>?</span>
binding<span>.</span>edittextCountry<span>.</span><span>setText</span><span>(</span>country<span>)</span></code></pre><p><code><span>setUserMetadata</span><span>(</span><span>)</span></code> defines a <code>Map</code> with a single key-value pair, where the key is the string <code>country</code> and the corresponding value is the contents of the <code>EditText</code> where the user enters the name of their country. It then passes that <code>Map</code> along with the user‚Äôs ID to <code>UsersAPIClient</code> ‚Äôs <code><span>updateMetadata</span><span>(</span><span>)</span></code> method to specify the change to be made, followed by the <code><span>start</span><span>(</span><span>)</span></code> method to initiate the update and define callback methods for failure and success.</p><p><code><span>setUserMetadata</span><span>(</span><span>)</span></code>‚Äôs <code><span>onSuccess</span><span>(</span><span>)</span></code> callback is almost the same as <code><span>getUserMetadata</span><span>(</span><span>)</span></code>‚Äôs ‚Äî but instead of updating the <code>EditText</code> where the user enters the name of their country, it simply displays a <code>SnackBar</code> notifying the user that it was successful in updating the metadata.</p><h3 id="Add-the-UI-methods">Add the UI methods</h3><p>The final step is to add the methods that present information to the user.</p><p>üõ† Add the following to the class after <code><span>getUserMetadata</span><span>(</span><span>)</span></code> and <code><span>setUserMetadata</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>updateUI</span><span>(</span><span>)</span> <span>{</span>
    <span>val</span> isLoggedIn <span>=</span> cachedCredentials <span>!=</span> <span>null</span>

    binding<span>.</span>textviewTitle<span>.</span>text <span>=</span> <span>if</span> <span>(</span>isLoggedIn<span>)</span> <span>{</span>
        <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>logged_in_title<span>)</span>
    <span>}</span> <span>else</span> <span>{</span>
        <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>logged_out_title<span>)</span>
    <span>}</span>
    binding<span>.</span>buttonLogin<span>.</span>isEnabled <span>=</span> <span>!</span>isLoggedIn
    binding<span>.</span>buttonLogout<span>.</span>isEnabled <span>=</span> isLoggedIn
    binding<span>.</span>linearlayoutMetadata<span>.</span>isVisible <span>=</span> isLoggedIn

    binding<span>.</span>textviewUserProfile<span>.</span>isVisible <span>=</span> isLoggedIn

    <span>val</span> userName <span>=</span> cachedUserProfile<span>?</span><span>.</span>name <span>?:</span> <span>&#34;&#34;</span>
    <span>val</span> userEmail <span>=</span> cachedUserProfile<span>?</span><span>.</span>email <span>?:</span> <span>&#34;&#34;</span>
    binding<span>.</span>textviewUserProfile<span>.</span>text <span>=</span> <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>user_profile<span>,</span> userName<span>,</span> userEmail<span>)</span>

    <span>if</span> <span>(</span><span>!</span>isLoggedIn<span>)</span> <span>{</span>
        binding<span>.</span>edittextCountry<span>.</span><span>setText</span><span>(</span><span>&#34;&#34;</span><span>)</span>
    <span>}</span>
<span>}</span>

<span>private</span> <span>fun</span> <span>showSnackBar</span><span>(</span>text<span>:</span> String<span>)</span> <span>{</span>
    Snackbar
        <span>.</span><span>make</span><span>(</span>
        binding<span>.</span>root<span>,</span>
        text<span>,</span>
        Snackbar<span>.</span>LENGTH_LONG
    <span>)</span><span>.</span><span>show</span><span>(</span><span>)</span>
<span>}</span></code></pre><p>If you‚Äôve made it this far, I have great news for you: you‚Äôve written all the code for the app!</p><h2 id="See-the-App-in-Action">See the App in Action</h2><p>Run the app. You‚Äôll see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7FSXqzXczgaNUC5NnY9q1F/d72b55833d1bf446c70d60488f7f4ae0/welcome_screen.png" alt="The app‚Äôs screen when launched."/></p><p>Tap the <strong>Log in</strong> button. The app will open a browser window that will display the login web page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/53TEQjPR0HhmvGIC8BXW7a/e7b6205b7c401883c61b162c498a00f7/universal_login.png" alt="The Auth0 login web page."/></p><p>Log in using the email address and password of the user account you created earlier. Since this is the first time the account has logged into the app, the <strong>Authorize App</strong> page will appear in the browser window:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4AkDSwWeHROplHJV3KOFcg/98376afd920b0af2a2e732a06c7fb622/authorize_app.png" alt="The ‚ÄúAuthorize App‚Äù screen. It says that the app is requesting access to your user account, particularly the ‚Äúprofile‚Äù, ‚Äúcurrent_user‚Äù, and ‚Äúcurrent_user_metadata‚Äù information."/></p><p>This page is asking you to authorize the app to access the following information in your user account:</p><ul><li>Profile: access to your profile and email</li><li>Current_user: read your current_user</li><li>Current_user_metadata: update your current_user_metadata</li></ul><p>If these items sound familiar, it‚Äôs because you‚Äôve seen them recently. They‚Äôre the names of the scopes in the <code>login_scopes</code> string in the <code>strings<span>.</span>xml</code> resource...</p><pre><code><span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>login_scopes<span>&#34;</span></span><span>&gt;</span></span>
    openid profile email read:current_user update:current_user_metadata
<span><span><span>&lt;/</span>string</span><span>&gt;</span></span></code></pre><p>...which the call to <code><span>withScope</span><span>(</span><span>)</span></code> in the <code><span>login</span><span>(</span><span>)</span></code> method uses to specify which sets of user data the app is authorized to use. This additional step informs the user of this use of their data and gives them a choice to approve or decline.</p><p>Tap the <strong>Approve</strong> button. The browser will disappear, and you will return to the app, which will now look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6D4JdPU0s5tGuplX9gEE4g/cfb0e2c57ead91059a2d6a26d6efdf44/main_screen_1.png" alt="The app‚Äôs screen when the user is logged in."/></p><p>Tap the <strong>Get</strong> button. If you‚Äôve never edited the value of the <code>country</code> field in the user‚Äôs metadata, the metadata text box will display the hint text ‚ÄúEnter country‚Äù.</p><p>Enter a country‚Äôs name (or any other text if you like) into the text box and tap the <strong>Set</strong> button. You‚Äôll see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5NE22T6w25nAVecqCIZ7x7/3c913e712052570af8908e860da37d2a/main_screen_3.png" alt="The app‚Äôs screen, with the word ‚ÄúMorocco‚Äù, entered into the text field."/></p><p>Two things just happened:</p><ol start="1"><li>If the user‚Äôs metadata already had a <code>country</code> field, its value changed to whatever text you entered. If the user‚Äôs metadata didn‚Äôt have a <code>country</code> field, a <code>country</code> field was added to the metadata, and its value was set to whatever text you entered.</li><li>An Android pop-up message called a <a href="https://developer.android.com/reference/com/google/android/material/snackbar/Snackbar" target="_blank" rel="noreferrer noopener"><code>Snackbar</code></a> appeared at the bottom of the screen with the message ‚ÄúSuccess!‚Äù</li></ol><p>Log out of the app, then log in again. Tap the <strong>Get</strong> button. The app should fill the metadata text box with the value of the <code>country</code> metadata field.</p><p>Let‚Äôs look at the updated user metadata from the Auth0 side. In the Auth0 dashboard, go to the list of users. Do this by clicking <strong>User Management</strong> in the menu on the left side of the page, followed by clicking on <strong>Users</strong>. Select the user that is currently logged in on the app. You‚Äôll be taken to that user‚Äôs <strong>Details</strong> page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5nnVqPm4l6vVtgyvZpeYwI/db98ccbfb8b945ebde7ec7c8143724c5/user_details_page.png" alt="The Auth0 dashboard displaying the user‚Äôs ‚ÄúUser Details‚Äù page. In the ‚Äúuser_metadata‚Äù field, a JSON object contains a single key-value pair with the key ‚Äúcountry‚Äù and the value ‚ÄúMorocco‚Äù."/></p><p>Scroll down to the <strong>Metadata</strong> section of the page. You‚Äôll see an area labeled <strong>user_metadata</strong>. If you filled out the <code>EditText</code> in the app, you‚Äôll see it in the JSON object there:</p><pre><code><span>{</span>
    <span>&#34;country&#34;</span><span>:</span> <span>{</span><span>WHATEVER_TEXT_YOU_ENTERED</span><span>}</span>
<span>}</span></code></pre><p>Each Auth0 user account can store two kinds of metadata:</p><ul><li><strong>User metadata,</strong> which is meant for data intentionally provided by and controlled by the user. It‚Äôs typically used for storing information that the user wants to share with the app, such as their address, contact information, preferences, and similar data. Only data that the user can read and edit should be stored here.</li><li><strong>App metadata,</strong> which is meant for data provided by and controlled by the app. It‚Äôs typically used for storing information about the user that is primarily for the app‚Äôs use, such as the user‚Äôs roles, permissions, status, and similar data. There may be cases where the user can read this data, but you should not use app metadata to store data provided directly by the user.</li></ul><p>While a detailed look at the user account pages is beyond the scope of this article, you should explore them to see the kinds of data and functionality that are associated with user accounts.</p><h2 id="When-Things-Go-Sideways">When Things Go Sideways</h2><p>The expression ‚Äúto go sideways‚Äù means ‚Äúto go wrong‚Äù or ‚Äúto not go according to plan.‚Äù In this section, I‚Äôll show you what can go wrong when you‚Äôre writing an Android app and fail to account for what happens when the user turns their phone on its side. </p><h3 id="Inducing-app-amnesia">Inducing app amnesia</h3><p>Run the app and log in. You should see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6D4JdPU0s5tGuplX9gEE4g/cfb0e2c57ead91059a2d6a26d6efdf44/main_screen_1.png" alt="The app‚Äôs screen when the user is logged in, in portrait orientation."/></p><p>Rotate your device to landscape orientation:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/48FY3obLHoGHnHfugbSn7I/8bc142a3e3e69bde3deed3223e6d02d7/orientation_change.png" alt="The app screen viewed in landscape orientation. It has taken on the appearance of just having been launched."/></p><p>Notice what happened: </p><ul><li>The greeting text changed from ‚ÄúYou‚Äôre logged in.‚Äù to ‚ÄúWelcome to the app!‚Äù, which is its state when the app is launched.</li><li>The buttons have also been returned to their initial state:  <strong>Log in</strong> is enabled, and <strong>Log out</strong> is disabled.</li></ul><p>It appears as if turning your device on its side has given your app amnesia and returned it to its initial state. What happened?</p><h3 id="Configuration-changes-and-reloading">Configuration changes and reloading</h3><p>To use a developer clich√©: this isn‚Äôt a bug, but a feature.</p><p>Whenever it detects a configuration change, Android‚Äôs default response is to reload the current activity. There are many configuration changes, such as language, keyboard availability, or the change you made just now: screen orientation. Reloading an activity when a configuration change happens makes it run its initialization methods again and reload resources, allowing it to set itself up for the new configuration.</p><p>This behavior was designed for applications that present different interfaces in different orientations. YouTube is an example of such an app, which has different portrait and landscape UI setups:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4jHUrVT9Ekh5252HZc3T95/706f6ddb57bb1b6be1a37c82b1201297/youtube_portrait_and_landscape.png" alt="The YouTube app, shown in both orientations. In portrait orientation, it shows the video, ratings, and comments. In landscape orientation, the video takes up the entire screen."/></p><p>Changing the screen orientation reloaded the activity and restored the app to its initial state, but it <em>did not</em> change your ‚Äúlogged in‚Äù status. The <code><span>logout</span><span>(</span><span>)</span></code> method was not called when you turned your device on its side. You‚Äôre still logged in!</p><p>You can confirm your ‚Äúlogged in‚Äù status by tapping the <strong>Log in</strong> button. Note that there wasn‚Äôt an intermediate step where you had to enter your email address and password ‚Äî you were taken straight to the app:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/01B8CQAD7K9uDYwkT7D1c7/08a21f19cdacc4ecdb065132cd2cf590/logged_in_sideways.png" alt="The app screen, viewed in landscape orientation, showing the user logged in. The bottom portion of the screen is not in sight."/></p><p>Note that that app never presented the login page. That‚Äôs because there wasn‚Äôt any need ‚Äî you were still logged in. Let‚Äôs solve this problem.</p><h3 id="Curing-your-app-s-amnesia">Curing your app‚Äôs amnesia</h3><p>You can instruct Android <em>not</em> to reload Activities in the event of specified configuration changes in the app‚Äôs manifest. </p><p>üõ† Open <code>AndroidManifest<span>.</span>xml</code> and change the <code><span>&lt;</span>activity<span>&gt;</span></code> tag to the following:</p><pre><code><span><span><span>&lt;</span>activity</span>
    <span><span>android:</span>name</span><span><span>=</span><span>&#34;</span>.MainActivity<span>&#34;</span></span>
    <span><span>android:</span>exported</span><span><span>=</span><span>&#34;</span>true<span>&#34;</span></span>
    <span><span>android:</span>configChanges</span><span><span>=</span><span>&#34;</span>orientation|screenSize<span>&#34;</span></span> <span>&gt;</span></span></code></pre><p>This change adds the attribute <code>android<span>:</span>configChanges<span>=</span> ‚Äúorientation<span>|</span>screenSize‚Äù</code> to <code>MainActivity</code>, which tells Android that the activity should <em>not</em> reload if the device orientation or screen size changes. Instead of reloading the activity, Android uses a callback method to notify the app of the change. The assumption is that you‚Äôll handle those configuration changes yourself. Since we‚Äôll ignore this callback, the configuration change has no effect.</p><p>Run the app and log in. Change the screen orientation, going from portrait to landscape and back. It no longer causes the activity to reload.</p><h2 id="Conclusion">Conclusion</h2><p>You‚Äôve just built a simple app that features basic username/password <em>authentication</em> ‚Äî the ability to identify a known user. In addition to log a user in and out, you can also retrieve the information in their profile, and read and update their metadata.</p><p>You can find the code for the complete project for this article in <a href="https://github.com/auth0-blog/get-started-android-authentication-kotlin" target="_blank" rel="noreferrer noopener">this repository on the <em>Auth0 Blog Samples</em> GitHub account</a>. The only change that you‚Äôll need to make in order to run it is to enter your app‚Äôs client ID and tenant‚Äôs domain in the <code>auth0<span>.</span>xml</code> resource file.</p><p>This is the first in a new series of articles on Android development with Auth0. Future articles will cover new developments in Android 12 and Android Studio, as well as deeper dives into authentication and authorization with Android and Auth0 and alternatives to the standard username-and-password approach. Watch this space!</p><p><a href="https://auth0.com/blog/get-started-with-android-authentication-using-kotlin-part-1" target="_blank" rel="noopener referrer">Next Step: Read the preview part here</a></p><p><a href="https://community.auth0.com/t/developing-a-secure-api-with-nestjs/33026" target="_blank" rel="noopener noreferrer">I ran into an issue</a></p></div></div>]]></content:encoded>
      <pubDate>Mon, 20 Sep 2021 18:29:00 +0000</pubDate>
    </item>
    <item>
      <title>Get Started with Android Authentication Using Kotlin: Part 2</title>
      <link>https://auth0.com/blog/get-started-with-android-authentication-using-kotlin-part-2/</link>
      <description>Learn how to implement login, logout, and user profiles in Android apps using Kotlin and Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the previous section, you started an Android project that uses Auth0 for user login, logout, and reading and updating user metadata. You set up the project on both the Auth0 and app sides. In this section, you‚Äôll complete the project and update it to ensure that it works in both portrait and landscape orientations.</p><h2 id="Write-the-code">Write the code</h2><p>Everything you‚Äôve done so far in this exercise is just a preamble. It‚Äôs now time to write the actual code! This is the biggest task in the exercise, so let‚Äôs do it in small steps.‚Äã</p><p>üõ† Move to the <code>app<span>/</span>java<span>/</span>com<span>.</span>example<span>.</span>login</code> folder and open the main activity‚Äôs file, <code>MainActivity<span>.</span>kt</code>. Its contents should look like this:</p><pre><code><span>package</span> com<span>.</span>example<span>.</span>myapplication

<span>import</span> androidx<span>.</span>appcompat<span>.</span>app<span>.</span>AppCompatActivity
<span>import</span> android<span>.</span>os<span>.</span>Bundle

<span>class</span> MainActivity <span>:</span> <span>AppCompatActivity</span><span>(</span><span>)</span> <span>{</span>
    <span>override</span> <span>fun</span> <span>onCreate</span><span>(</span>savedInstanceState<span>:</span> Bundle<span>?</span><span>)</span> <span>{</span>
        <span>super</span><span>.</span><span>onCreate</span><span>(</span>savedInstanceState<span>)</span>
        <span>setContentView</span><span>(</span>R<span>.</span>layout<span>.</span>activity_main<span>)</span>
    <span>}</span>
<span>}</span></code></pre><h3 id="Import-the-necessary-libraries">Import the necessary libraries</h3><p>üõ† Add the following <code><span>import</span></code> statements to the ones already in the file:</p><pre><code><span>import</span> androidx<span>.</span>core<span>.</span>view<span>.</span>isVisible
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>Auth0
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>authentication<span>.</span>AuthenticationAPIClient
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>authentication<span>.</span>AuthenticationException
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>callback<span>.</span>Callback
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>management<span>.</span>ManagementException
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>management<span>.</span>UsersAPIClient
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>provider<span>.</span>WebAuthProvider
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>result<span>.</span>Credentials
<span>import</span> com<span>.</span>auth0<span>.</span>android<span>.</span>result<span>.</span>UserProfile
<span>import</span> com<span>.</span>google<span>.</span>android<span>.</span>material<span>.</span>snackbar<span>.</span>Snackbar</code></pre><p>Most of these <code><span>import</span></code> statements import classes from Auth0‚Äôs libraries. Here‚Äôs what those classes do:</p><ul><li><code>AuthenticationAPIClient</code>: Accesses the Auth0 Authentication API. The app uses this to retrieve the user‚Äôs profile information.</li><li><code>AuthenticationException</code>: Defines errors and exceptions that may arise during authentication.</li><li><code>Callback</code>: Defines an object containing ‚Äúsuccess‚Äù and ‚Äúfailure‚Äù callback functions that Auth0 should call after completing an API function.</li><li><code>ManagementException</code>: Defines errors and exceptions that <code>Callback</code> objects may have to handle.</li><li><code>UsersAPIClient</code>: Manages user information. The app uses this to retrieve the user‚Äôs profile information.</li><li><code>WebAuthProvider</code>: Provides Auth0‚Äôs web page-based login to the app. The app uses this to log the user in via a login page in a web browser and log the user out.</li><li><code>Credentials</code>: Stores the user‚Äôs credentials, including ID, access, and refresh tokens.</li><li><code>UserProfile</code>: Stores the user‚Äôs profile information, including their user ID, names, email address, and metadata.</li></ul><p>üõ† You‚Äôll also need to import the <code>Activity</code> ‚Äôs auto-generated view binding library, which will make it possible for your code to reference views in the layout (or, to put it more simply: access the onscreen widgets). Do this by adding the following <code><span>import</span></code> statement, replacing <code><span>{</span><span>YOUR_PACKAGE_NAME_HERE</span><span>}</span></code> with the name of your app‚Äôs package, which you‚Äôll find on the first line of the file:</p><pre><code><span>import</span> <span>{</span>YOUR_PACKAGE_NAME_HERE<span>}</span><span>.</span>databinding<span>.</span>ActivityMainBinding</code></pre><p>The package name for my app is <code>com<span>.</span>example<span>.</span>login</code>, so my <code><span>import</span></code> statement looks like this:</p><pre><code><span>import</span> com<span>.</span>example<span>.</span>login<span>.</span>databinding<span>.</span>ActivityMainBinding</code></pre><h3 id="Add-class-properties">Add class properties</h3><p>üõ† Add the following properties to <code>MainActivity</code> so that the start of the class looks like this:</p><pre><code><span>class</span> MainActivity <span>:</span> <span>AppCompatActivity</span><span>(</span><span>)</span> <span>{</span>

    <span>private</span> <span>lateinit</span> <span>var</span> binding<span>:</span> ActivityMainBinding

    <span>// Login/logout-related properties</span>
    <span>private</span> <span>lateinit</span> <span>var</span> account<span>:</span> Auth0
    <span>private</span> <span>var</span> cachedCredentials<span>:</span> Credentials<span>?</span> <span>=</span> <span>null</span>
    <span>private</span> <span>var</span> cachedUserProfile<span>:</span> UserProfile<span>?</span> <span>=</span> <span>null</span>


    <span>override</span> <span>fun</span> <span>onCreate</span><span>(</span>savedInstanceState<span>:</span> Bundle<span>?</span><span>)</span> <span>{</span>
    
    <span>..</span><span>.</span></code></pre><p>You‚Äôll use the first property, <code>binding</code>, to access the widgets on the screen. The other three properties are related to logging in and out and are described in more detail below:</p><ul><li><code>account</code>: represents the app‚Äôs Auth0 account and is instantiated using the app‚Äôs client ID and the domain for the app‚Äôs Auth0 tenant. Let me make this clear: this isn‚Äôt the account of the user trying to log in, but the account of the developer or organization who is delegating the login/logout process to Auth0. In the case of this example, it‚Äôs <em>your</em> Auth0 developer account. <code>account</code>‚Äôs value is set in <code><span>onCreate</span><span>(</span><span>)</span></code> when the activity is instantiated.</li><li><code>cachedCredentials</code>: contains the user‚Äôs credentials that are returned from Auth0 after a successful login. Its value should be <code><span>null</span></code> when the user is <em>not</em> logged in. When the user is logged in, it should reference an instance of <code>Credentials</code>. A <code>Credentials</code> instance has the following properties:
  <ul><li><code>idToken</code>: The <a href="https://auth0.com/docs/tokens/id-tokens" target="_blank" rel="noreferrer noopener">ID token</a>, which contains user information that the app can use to customize the user‚Äôs experience.</li><li><code>accessToken</code>: The <a href="https://auth0.com/docs/tokens/access-tokens" target="_blank" rel="noreferrer noopener">access token</a>, which is a credential that allows the app to access the Auth0 API.</li><li><code>refreshToken</code>: The <a href="https://auth0.com/docs/tokens/refresh-tokens" target="_blank" rel="noreferrer noopener">refresh token</a>, which can be used to request a new access token when the original access token expires, without requiring the user to re-authenticate.</li><li><code>type</code>: The type of the received access token.</li><li><code>expiresAt</code>: The date/time when the received access token expires.</li><li><code>scope</code>: The scopes granted to the access token. I‚Äôll explain what scopes are in the next section, <em>The login method</em>.</li></ul></li><li><code>cachedUserProfile</code>: holds the user‚Äôs profile information. Its value should be <code><span>null</span></code> when the user is <em>not</em> logged in. When the user is logged in, it should reference an instance of <code>UserProfile</code>. A <code>UserProfile</code> instance has the following properties:
<ul><li><code>email</code>: The email address corresponding to the user account.</li><li><code>isEmailVerified</code>: <code><span>true</span></code> if the user responded to the verification email sent by Auth0 after they registered themselves as a user.</li><li><code>name</code>: The user‚Äôs full name.</li><li><code>givenName</code>: The user‚Äôs given name, often referred to as their ‚Äúfirst name‚Äù or ‚Äúforename‚Äù.</li><li><code>familyName</code>: The user‚Äôs family name, often referred to as their ‚Äúlast name‚Äù or ‚Äúsurname‚Äù.</li><li><code>nickname</code>: The user‚Äôs nickname, sometimes referred to as thier ‚Äúfamiliar name‚Äù or ‚Äúmoniker‚Äù.</li><li><code>PictureURL</code>: The URL where the user‚Äôs picture can be retrieved.</li><li><code>createdAt</code>: The creation date and time of the user‚Äôs account.</li></ul></li></ul><h3 id="Update-the--onCreate----method">Update the <code><span>onCreate</span><span>(</span><span>)</span></code> method</h3><p>First, let‚Äôs fill out the <code><span>onCreate</span><span>(</span><span>)</span></code> method that was automatically generated for the project and use it to initialize everything in the activity.</p><p>üõ† Update the <code><span>onCreate</span><span>(</span><span>)</span></code> method so that it looks like this:</p><pre><code><span>override</span> <span>fun</span> <span>onCreate</span><span>(</span>savedInstanceState<span>:</span> Bundle<span>?</span><span>)</span> <span>{</span>
    <span>super</span><span>.</span><span>onCreate</span><span>(</span>savedInstanceState<span>)</span>

    account <span>=</span> <span>Auth0</span><span>(</span>
        <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_client_id<span>)</span><span>,</span>
        <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_domain<span>)</span>
    <span>)</span>

    binding <span>=</span> ActivityMainBinding<span>.</span><span>inflate</span><span>(</span>layoutInflater<span>)</span>
    <span>setContentView</span><span>(</span>binding<span>.</span>root<span>)</span>

    binding<span>.</span>buttonLogin<span>.</span><span>setOnClickListener</span> <span>{</span> <span>login</span><span>(</span><span>)</span> <span>}</span>
    binding<span>.</span>buttonLogout<span>.</span><span>setOnClickListener</span> <span>{</span> <span>logout</span><span>(</span><span>)</span> <span>}</span>
    binding<span>.</span>buttonGet<span>.</span><span>setOnClickListener</span> <span>{</span> <span>getUserMetadata</span><span>(</span><span>)</span> <span>}</span>
    binding<span>.</span>buttonSet<span>.</span><span>setOnClickListener</span> <span>{</span> <span>setUserMetadata</span><span>(</span><span>)</span> <span>}</span>
<span>}</span></code></pre><p>This method:</p><ul><li>Defines the account object, which contains the necessary credentials to connect to your Auth0 account.</li><li>Creates a view binding object, which you‚Äôll use to access the onscreen widgets.</li><li>Connects the <strong>Log in</strong>, <strong>Log out</strong>, <strong>Get</strong>, and <strong>Set</strong> buttons to the methods they should call when tapped.</li></ul><h3 id="Add-the--login----method">Add the <code><span>login</span><span>(</span><span>)</span></code> method</h3><p>The next step is to implement the method that gets called when the user taps the <strong>Log In</strong> button.</p><p>üõ† Add this to the class after <code><span>onCreate</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>login</span><span>(</span><span>)</span> <span>{</span>
    WebAuthProvider
        <span>.</span><span>login</span><span>(</span>account<span>)</span>
        <span>.</span><span>withScheme</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_scheme<span>)</span><span>)</span>
        <span>.</span><span>withScope</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_scopes<span>)</span><span>)</span>
        <span>.</span><span>withAudience</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_audience<span>,</span> <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_domain<span>)</span><span>)</span><span>)</span>
        <span>.</span><span>start</span><span>(</span><span>this</span><span>,</span> <span>object</span> <span>:</span> Callback<span>&lt;</span>Credentials<span>,</span> AuthenticationException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> AuthenticationException<span>)</span> <span>{</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_failure_message<span>,</span> exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>credentials<span>:</span> Credentials<span>)</span> <span>{</span>
                cachedCredentials <span>=</span> credentials
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>login_success_message<span>,</span> credentials<span>.</span>accessToken<span>)</span><span>)</span>
                <span>updateUI</span><span>(</span><span>)</span>
                <span>showUserProfile</span><span>(</span><span>)</span>
            <span>}</span>
        <span>}</span><span>)</span>
<span>}</span></code></pre><p><code><span>login</span><span>(</span><span>)</span></code> uses the Auth0 SDK‚Äôs <code>WebAuthProvider</code> class, which gives the app the ability to use Auth0‚Äôs authentication service. The <code>WebAuthProvider</code> methods that you‚Äôll use most often are its <code><span>login</span><span>(</span><span>)</span></code> and <code><span>logout</span><span>(</span><span>)</span></code> methods.</p><p>Although this method is formatted to span several lines, it‚Äôs just a single line of code. The single line is made of a call to a chain of <code>WebAuthProvider</code> ‚Äôs methods starting with <code><span>login</span><span>(</span><span>)</span></code>. If you ignore all the comments and parameters, the method chain looks like this:</p><pre><code>WebAuthProvider
    <span>.</span><span>login</span><span>(</span><span>)</span>
    <span>.</span><span>withScheme</span><span>(</span><span>)</span>
    <span>.</span><span>withScope</span><span>(</span><span>)</span>
    <span>.</span><span>withAudience</span><span>(</span><span>)</span>
    <span>.</span><span>start</span><span>(</span><span>)</span></code></pre><p>This is the <a href="https://www.baeldung.com/kotlin/builder-pattern" target="_blank" rel="noreferrer noopener">Builder design pattern</a> in action. From <code><span>login</span><span>(</span><span>)</span></code> to <code><span>withAudience</span><span>(</span><span>)</span></code>, each method in the chain takes an argument that provides additional information about the login, using that information to creates a <code>WebAuthProvider</code> object that it passes to the next method in the chain. The final method in the chain, <code><span>start</span><span>(</span><span>)</span></code>, takes the resulting <code>WebAuthProvider</code> object as its argument and uses it to display the login page and define what should happen when the login succeeds and when it fails.</p><p>Let‚Äôs take a look at what each of the methods in the chain does.</p><p><code><span>login</span><span>(</span><span>)</span></code> initiates the login process and specifies the Auth0 account used by the application.</p><p><code><span>withScheme</span><span>(</span><span>)</span></code> specifies the scheme to use for the URL that Auth0 redirects to after a successful login. For web apps, the scheme is <code>http</code> or <code>https</code>. This value is arbitrary for native mobile apps, so we use <code>app</code> to make it clear to other developers and other people who may use the Auth0 settings for this app that the redirect is <em>not</em> to a web page.</p><p><code><span>withScope</span><span>(</span><span>)</span></code> specifies which sets of user data the app is authorized to use if the user logs in successfully. The OpenID Connect and OAuth frameworks, on which Auth0‚Äôs authentication and authorization are based, use the term <a href="https://auth0.com/docs/scopes/openid-connect-scopes" target="_blank" rel="noreferrer noopener"><em>scope</em></a> to represent the authorization to access user‚Äôs data and resources. The method takes a space-delimited string as its argument, where each ‚Äúword‚Äù in the string specifies a different scope. The string used in this app contains these scopes:</p><ul><li><code>openid</code>: Indicates that application that uses OpenID Connect for authentication. This is the only required scope; all other scopes are optional.</li><li><code>profile</code>: Authorizes the application to access basic user profile information, including first name, surname, nickname, their photo or avatar, and so on.</li><li><code>email</code>: Authorizes the application to access the user‚Äôs email address.</li><li><code>read<span>:</span>current_user</code>: Authorizes the application with read-only access to the <code>current_user</code> claim.</li><li><code>update<span>:</span>current_user_metadata</code>: Authorizes the application with read and write  access to the <code>current_user_metadata</code> claim. This scope allows us to get and set the <code>country</code> value in the user‚Äôs metadata.</li></ul><p><code><span>withAudience</span><span>(</span><span>)</span></code> specifies the URL that the app will use to connect to Auth0‚Äôs login service. This URL is constructed using the domain of the Auth0 tenant used by the app and the endpoint for the Auth0 authentication API.</p><p><code><span>start</span><span>(</span><span>)</span></code> takes the <code>WebAuthProvider</code> object constructed by all the previous methods in the chain and opens the browser window to display the login page. It takes two parameters: a context (a reference to the <code>Activity</code> that‚Äôs initiating the browser window) and an anonymous object with two callback methods:</p><ul><li><code><span>onFailure</span><span>(</span><span>)</span></code>: Defines what should happen if the user returns from the browser login screen without successfully logging in. This typically happens when the user closes the browser login screen or taps the ‚Äúback‚Äù button while on that screen. The app displays a <code>SnackBar</code> that notifies the user that login failed, followed by an error code.</li><li><code><span>onSuccess</span><span>(</span><span>)</span></code>: Defines what should happen if the user returns from the browser login screen after successfully logging in. The app processes the successful response, displays a <code>SnackBar</code> notifying the user that login was successful, and updates the UI to its ‚Äúlogged in‚Äù state.</li></ul><h3 id="Add-the--logout----method">Add the <code><span>logout</span><span>(</span><span>)</span></code> method</h3><p>You‚Äôve probably guessed that if there‚Äôs a <code><span>login</span><span>(</span><span>)</span></code> method that‚Äôs called when the user presses the <strong>Log In</strong> button, there must also be a <code><span>logout</span><span>(</span><span>)</span></code> method that‚Äôs called when the user presses the <strong>Log Out</strong> button.</p><p>üõ† Add this method to the class after <code><span>login</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>logout</span><span>(</span><span>)</span> <span>{</span>
    WebAuthProvider
        <span>.</span><span>logout</span><span>(</span>account<span>)</span>
        <span>.</span><span>withScheme</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>com_auth0_scheme<span>)</span><span>)</span>
        <span>.</span><span>start</span><span>(</span><span>this</span><span>,</span> <span>object</span> <span>:</span> Callback<span>&lt;</span>Void<span>?</span><span>,</span> AuthenticationException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> AuthenticationException<span>)</span> <span>{</span>
                <span>updateUI</span><span>(</span><span>)</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
                    exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>payload<span>:</span> Void<span>?</span><span>)</span> <span>{</span>
                cachedCredentials <span>=</span> <span>null</span>
                cachedUserProfile <span>=</span> <span>null</span>
                <span>updateUI</span><span>(</span><span>)</span>
            <span>}</span>

        <span>}</span><span>)</span>
<span>}</span></code></pre><p>As with <code><span>login</span><span>(</span><span>)</span></code>, <code><span>logout</span><span>(</span><span>)</span></code> also uses the Auth0 SDK‚Äôs <code>WebAuthProvider</code> class and is a one-liner that uses the Builder pattern. This time, that one line calls a shorter chain of <code>WebAuthProvider</code> ‚Äôs methods starting with <code><span>logout</span><span>(</span><span>)</span></code>. If you ignore all the parameters, the method chain looks like this:</p><pre><code>WebAuthProvider
    <span>.</span><span>logout</span><span>(</span><span>)</span>
    <span>.</span><span>withScheme</span><span>(</span><span>)</span>
    <span>.</span><span>start</span><span>(</span><span>)</span></code></pre><p><code><span>logout</span><span>(</span><span>)</span></code> initiates the logout process and specifies the Auth0 account used by the application, which should be the same account as the one used to log in.</p><p><code><span>withScheme</span><span>(</span><span>)</span></code> specifies the scheme to use for the URL that Auth0 redirects to after successful logout. This should be the same scheme as the one used to log in.</p><p><code><span>start</span><span>(</span><span>)</span></code> takes the <code>WebAuthProvider</code> object constructed by all the previous methods in the chain to log the user out. It takes two parameters: a context (a reference to the <code>Activity</code> that‚Äôs initiating the logout process) and an anonymous object with two callback methods:</p><ul><li><code><span>onFailure</span><span>(</span><span>)</span></code>: Defines what should happen when the logout process fails. This rarely happens and usually indicates a network or server issue. In this example, the app updates the UI (which remains in the ‚Äúlogged in‚Äù state) and displays a <code>SnackBar</code> that notifies the user that logout failed, followed by an error code.</li><li><code><span>onSuccess</span><span>(</span><span>)</span></code>: Defines what should happen when the logout process succeeds. In this example, the app destroys its local copies of the user‚Äôs credentials and profile and updates the UI to its ‚Äúlogged out‚Äù state.</li></ul><h3 id="Add-the--showUserProfile----method">Add the <code><span>showUserProfile</span><span>(</span><span>)</span></code> method</h3><p>Every Auth0 user has a <em>user profile</em> associated with their account. The user profile contains the following basic information about the user:</p><ul><li>Names: The user‚Äôs full name, given name, surname, and nickname</li><li>Email info: The user‚Äôs email address, and whether it was verified</li><li>Picture: The location of an image that identifies the user</li><li>Creation date: The date and time when the user‚Äôs account was created</li></ul><p>When the user successfully logs in, the app should display their name and email onscreen. It does so by calling <code><span>showUserProfile</span><span>(</span><span>)</span></code> immediately after a successful login.</p><p>üõ† Add this method to the class after <code><span>logout</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>showUserProfile</span><span>(</span><span>)</span> <span>{</span>
    <span>// Guard against showing the profile when no user is logged in</span>
    <span>if</span> <span>(</span>cachedCredentials <span>==</span> <span>null</span><span>)</span> <span>{</span>
        <span>return</span>
    <span>}</span>

    <span>val</span> client <span>=</span> <span>AuthenticationAPIClient</span><span>(</span>account<span>)</span>
    client
        <span>.</span><span>userInfo</span><span>(</span>cachedCredentials<span>!!</span><span>.</span>accessToken<span>!!</span><span>)</span>
        <span>.</span><span>start</span><span>(</span><span>object</span> <span>:</span> Callback<span>&lt;</span>UserProfile<span>,</span> AuthenticationException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> AuthenticationException<span>)</span> <span>{</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
                    exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>profile<span>:</span> UserProfile<span>)</span> <span>{</span>
                cachedUserProfile <span>=</span> profile
                <span>updateUI</span><span>(</span><span>)</span>
            <span>}</span>

        <span>}</span><span>)</span>
<span>}</span></code></pre><p>This method is the final task performed by the <code><span>onSuccess</span><span>(</span><span>)</span></code> callback method in  <code><span>loginWithBrowser</span><span>(</span><span>)</span></code>. It initializes the <code>cachedUserProfile</code> property, which contains the user‚Äôs profile information.</p><p>As a precaution, it returns immediately if the <code>cachedCredentials</code> property is <code><span>null</span></code>, which implies that no user is logged in, and therefore there isn‚Äôt any user profile to show.</p><p>In order to get this information, it does the following:</p><ul><li>It creates an instance of <code>AuthenticationAPIClient</code>, which retrieves Auth0 account information. Like the login and logout methods, this also uses the Builder pattern.</li><li>It uses <code>AuthenticationAPIClient</code> ‚Äôs <code><span>userInfo</span><span>(</span><span>)</span></code> method to specify that we want to retrieve user profile information from Auth0. This method requires a valid access token, which it extracts from the <code>cachedCredentials</code> property.</li><li>Finally, it defines callback methods for the cases where it failed and succeeded in retrieving the user profile information from Auth0. If the retrieval was successful, the profile information is stored in <code>cachedUserProfile</code>, and the UI is updated to display the user‚Äôs name and email address.</li></ul><h3 id="Add-the--getUserMetadata----and--setUserMetadata----methods">Add the <code><span>getUserMetadata</span><span>(</span><span>)</span></code> and <code><span>setUserMetadata</span><span>(</span><span>)</span></code> methods</h3><p>The user profile contains information that generally applies to <em>every</em> user account regardless of the type of application it‚Äôs being used for ‚Äî name, email, photo, and date/time created. While this is necessary information, it‚Äôs probably not <em>all</em> the user information that you want to store in their profile.</p><p>That what the <em>user metadata</em> is for. Think of it as a key-value store where you can place additional user information that isn‚Äôt covered by the user profile. In this app, the user metadata will store just one additional piece of user information ‚Äî their country ‚Äî and it will allow the user to retrieve and update this information.</p><p>üõ† Add the following to the class after <code><span>showUserProfile</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>getUserMetadata</span><span>(</span><span>)</span> <span>{</span>
    <span>// Guard against getting the metadata when no user is logged in</span>
    <span>if</span> <span>(</span>cachedCredentials <span>==</span> <span>null</span><span>)</span> <span>{</span>
        <span>return</span>
    <span>}</span>

    <span>val</span> usersClient <span>=</span> <span>UsersAPIClient</span><span>(</span>account<span>,</span> cachedCredentials<span>!!</span><span>.</span>accessToken<span>!!</span><span>)</span>

    usersClient
        <span>.</span><span>getProfile</span><span>(</span>cachedUserProfile<span>!!</span><span>.</span><span>getId</span><span>(</span><span>)</span><span>!!</span><span>)</span>
        <span>.</span><span>start</span><span>(</span><span>object</span> <span>:</span> Callback<span>&lt;</span>UserProfile<span>,</span> ManagementException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> ManagementException<span>)</span> <span>{</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
                    exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>userProfile<span>:</span> UserProfile<span>)</span> <span>{</span>
                cachedUserProfile <span>=</span> userProfile
                <span>updateUI</span><span>(</span><span>)</span>

                <span>val</span> country <span>=</span> userProfile<span>.</span><span>getUserMetadata</span><span>(</span><span>)</span><span>[</span><span>&#34;country&#34;</span><span>]</span> <span>as</span> String<span>?</span>
                binding<span>.</span>edittextCountry<span>.</span><span>setText</span><span>(</span>country<span>)</span>
            <span>}</span>

        <span>}</span><span>)</span>
<span>}</span>

<span>private</span> <span>fun</span> <span>setUserMetadata</span><span>(</span><span>)</span> <span>{</span>
    <span>// Guard against getting the metadata when no user is logged in</span>
    <span>if</span> <span>(</span>cachedCredentials <span>==</span> <span>null</span><span>)</span> <span>{</span>
        <span>return</span>
    <span>}</span>

    <span>val</span> usersClient <span>=</span> <span>UsersAPIClient</span><span>(</span>account<span>,</span> cachedCredentials<span>!!</span><span>.</span>accessToken<span>!!</span><span>)</span>
    <span>val</span> metadata <span>=</span> <span>mapOf</span><span>(</span><span>&#34;country&#34;</span> <span>to</span> binding<span>.</span>edittextCountry<span>.</span>text<span>.</span><span>toString</span><span>(</span><span>)</span><span>)</span>

    usersClient
        <span>.</span><span>updateMetadata</span><span>(</span>cachedUserProfile<span>!!</span><span>.</span><span>getId</span><span>(</span><span>)</span><span>!!</span><span>,</span> metadata<span>)</span>
        <span>.</span><span>start</span><span>(</span><span>object</span> <span>:</span> Callback<span>&lt;</span>UserProfile<span>,</span> ManagementException<span>&gt;</span> <span>{</span>

            <span>override</span> <span>fun</span> <span>onFailure</span><span>(</span>exception<span>:</span> ManagementException<span>)</span> <span>{</span>
                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_failure_with_exception_code<span>,</span>
                    exception<span>.</span><span>getCode</span><span>(</span><span>)</span><span>)</span><span>)</span>
            <span>}</span>

            <span>override</span> <span>fun</span> <span>onSuccess</span><span>(</span>profile<span>:</span> UserProfile<span>)</span> <span>{</span>
                cachedUserProfile <span>=</span> profile
                <span>updateUI</span><span>(</span><span>)</span>

                <span>showSnackBar</span><span>(</span><span>getString</span><span>(</span>R<span>.</span>string<span>.</span>general_success_message<span>)</span><span>)</span>
            <span>}</span>

        <span>}</span><span>)</span>
<span>}</span></code></pre><p>While <code><span>showUserProfile</span><span>(</span><span>)</span></code> uses an instance of <code>AuthenticationAPIClient</code> to get the user profile information, <code><span>getUserMetadata</span><span>(</span><span>)</span></code> and <code><span>setUserMetadata</span><span>(</span><span>)</span></code> use a different object type: <code>UsersAPIClient</code>.</p><p>Unlike <code>AuthenticationAPIClient</code>, which needs only an <code>Auth0</code> account object to be instantiated, you need both an <code>Auth0</code> account object and an access token to instantiate a <code>UsersAPIClient</code> object.</p><p><code><span>getUserMetadata</span><span>(</span><span>)</span></code> specifies the user profile using <code>UsersAPIClient</code> ‚Äôs <code><span>getProfile</span><span>(</span><span>)</span></code> method and the ID of the user, followed by the <code><span>start</span><span>(</span><span>)</span></code> method to attempt to get the user profile and define callback methods for failure and success.</p><p><code><span>getUserMetadata</span><span>(</span><span>)</span></code>‚Äôs <code><span>onSuccess</span><span>(</span><span>)</span></code> callback is almost the same as <code><span>showUserProfile</span><span>(</span><span>)</span></code>‚Äôs ‚Äî it just has these two additional lines that extract the <code>country</code> value from the user‚Äôs metadata and display it onscreen:</p><pre><code><span>val</span> country <span>=</span> userProfile<span>.</span><span>getUserMetadata</span><span>(</span><span>)</span><span>[</span><span>&#34;country&#34;</span><span>]</span> <span>as</span> String<span>?</span>
binding<span>.</span>edittextCountry<span>.</span><span>setText</span><span>(</span>country<span>)</span></code></pre><p><code><span>setUserMetadata</span><span>(</span><span>)</span></code> defines a <code>Map</code> with a single key-value pair, where the key is the string <code>country</code> and the corresponding value is the contents of the <code>EditText</code> where the user enters the name of their country. It then passes that <code>Map</code> along with the user‚Äôs ID to <code>UsersAPIClient</code> ‚Äôs <code><span>updateMetadata</span><span>(</span><span>)</span></code> method to specify the change to be made, followed by the <code><span>start</span><span>(</span><span>)</span></code> method to initiate the update and define callback methods for failure and success.</p><p><code><span>setUserMetadata</span><span>(</span><span>)</span></code>‚Äôs <code><span>onSuccess</span><span>(</span><span>)</span></code> callback is almost the same as <code><span>getUserMetadata</span><span>(</span><span>)</span></code>‚Äôs ‚Äî but instead of updating the <code>EditText</code> where the user enters the name of their country, it simply displays a <code>SnackBar</code> notifying the user that it was successful in updating the metadata.</p><h3 id="Add-the-UI-methods">Add the UI methods</h3><p>The final step is to add the methods that present information to the user.</p><p>üõ† Add the following to the class after <code><span>getUserMetadata</span><span>(</span><span>)</span></code> and <code><span>setUserMetadata</span><span>(</span><span>)</span></code>:</p><pre><code><span>private</span> <span>fun</span> <span>updateUI</span><span>(</span><span>)</span> <span>{</span>
    <span>val</span> isLoggedIn <span>=</span> cachedCredentials <span>!=</span> <span>null</span>

    binding<span>.</span>textviewTitle<span>.</span>text <span>=</span> <span>if</span> <span>(</span>isLoggedIn<span>)</span> <span>{</span>
        <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>logged_in_title<span>)</span>
    <span>}</span> <span>else</span> <span>{</span>
        <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>logged_out_title<span>)</span>
    <span>}</span>
    binding<span>.</span>buttonLogin<span>.</span>isEnabled <span>=</span> <span>!</span>isLoggedIn
    binding<span>.</span>buttonLogout<span>.</span>isEnabled <span>=</span> isLoggedIn
    binding<span>.</span>linearlayoutMetadata<span>.</span>isVisible <span>=</span> isLoggedIn

    binding<span>.</span>textviewUserProfile<span>.</span>isVisible <span>=</span> isLoggedIn

    <span>val</span> userName <span>=</span> cachedUserProfile<span>?</span><span>.</span>name <span>?:</span> <span>&#34;&#34;</span>
    <span>val</span> userEmail <span>=</span> cachedUserProfile<span>?</span><span>.</span>email <span>?:</span> <span>&#34;&#34;</span>
    binding<span>.</span>textviewUserProfile<span>.</span>text <span>=</span> <span>getString</span><span>(</span>R<span>.</span>string<span>.</span>user_profile<span>,</span> userName<span>,</span> userEmail<span>)</span>

    <span>if</span> <span>(</span><span>!</span>isLoggedIn<span>)</span> <span>{</span>
        binding<span>.</span>edittextCountry<span>.</span><span>setText</span><span>(</span><span>&#34;&#34;</span><span>)</span>
    <span>}</span>
<span>}</span>

<span>private</span> <span>fun</span> <span>showSnackBar</span><span>(</span>text<span>:</span> String<span>)</span> <span>{</span>
    Snackbar
        <span>.</span><span>make</span><span>(</span>
        binding<span>.</span>root<span>,</span>
        text<span>,</span>
        Snackbar<span>.</span>LENGTH_LONG
    <span>)</span><span>.</span><span>show</span><span>(</span><span>)</span>
<span>}</span></code></pre><p>If you‚Äôve made it this far, I have great news for you: you‚Äôve written all the code for the app!</p><h2 id="See-the-App-in-Action">See the App in Action</h2><p>Run the app. You‚Äôll see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7FSXqzXczgaNUC5NnY9q1F/d72b55833d1bf446c70d60488f7f4ae0/welcome_screen.png" alt="The app‚Äôs screen when launched."/></p><p>Tap the <strong>Log in</strong> button. The app will open a browser window that will display the login web page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/53TEQjPR0HhmvGIC8BXW7a/e7b6205b7c401883c61b162c498a00f7/universal_login.png" alt="The Auth0 login web page."/></p><p>Log in using the email address and password of the user account you created earlier. Since this is the first time the account has logged into the app, the <strong>Authorize App</strong> page will appear in the browser window:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4AkDSwWeHROplHJV3KOFcg/98376afd920b0af2a2e732a06c7fb622/authorize_app.png" alt="The ‚ÄúAuthorize App‚Äù screen. It says that the app is requesting access to your user account, particularly the ‚Äúprofile‚Äù, ‚Äúcurrent_user‚Äù, and ‚Äúcurrent_user_metadata‚Äù information."/></p><p>This page is asking you to authorize the app to access the following information in your user account:</p><ul><li>Profile: access to your profile and email</li><li>Current_user: read your current_user</li><li>Current_user_metadata: update your current_user_metadata</li></ul><p>If these items sound familiar, it‚Äôs because you‚Äôve seen them recently. They‚Äôre the names of the scopes in the <code>login_scopes</code> string in the <code>strings<span>.</span>xml</code> resource...</p><pre><code><span><span><span>&lt;</span>string</span> <span>name</span><span><span>=</span><span>&#34;</span>login_scopes<span>&#34;</span></span><span>&gt;</span></span>
    openid profile email read:current_user update:current_user_metadata
<span><span><span>&lt;/</span>string</span><span>&gt;</span></span></code></pre><p>...which the call to <code><span>withScope</span><span>(</span><span>)</span></code> in the <code><span>login</span><span>(</span><span>)</span></code> method uses to specify which sets of user data the app is authorized to use. This additional step informs the user of this use of their data and gives them a choice to approve or decline.</p><p>Tap the <strong>Approve</strong> button. The browser will disappear, and you will return to the app, which will now look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6D4JdPU0s5tGuplX9gEE4g/cfb0e2c57ead91059a2d6a26d6efdf44/main_screen_1.png" alt="The app‚Äôs screen when the user is logged in."/></p><p>Tap the <strong>Get</strong> button. If you‚Äôve never edited the value of the <code>country</code> field in the user‚Äôs metadata, the metadata text box will display the hint text ‚ÄúEnter country‚Äù.</p><p>Enter a country‚Äôs name (or any other text if you like) into the text box and tap the <strong>Set</strong> button. You‚Äôll see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5NE22T6w25nAVecqCIZ7x7/3c913e712052570af8908e860da37d2a/main_screen_3.png" alt="The app‚Äôs screen, with the word ‚ÄúMorocco‚Äù, entered into the text field."/></p><p>Two things just happened:</p><ol start="1"><li>If the user‚Äôs metadata already had a <code>country</code> field, its value changed to whatever text you entered. If the user‚Äôs metadata didn‚Äôt have a <code>country</code> field, a <code>country</code> field was added to the metadata, and its value was set to whatever text you entered.</li><li>An Android pop-up message called a <a href="https://developer.android.com/reference/com/google/android/material/snackbar/Snackbar" target="_blank" rel="noreferrer noopener"><code>Snackbar</code></a> appeared at the bottom of the screen with the message ‚ÄúSuccess!‚Äù</li></ol><p>Log out of the app, then log in again. Tap the <strong>Get</strong> button. The app should fill the metadata text box with the value of the <code>country</code> metadata field.</p><p>Let‚Äôs look at the updated user metadata from the Auth0 side. In the Auth0 dashboard, go to the list of users. Do this by clicking <strong>User Management</strong> in the menu on the left side of the page, followed by clicking on <strong>Users</strong>. Select the user that is currently logged in on the app. You‚Äôll be taken to that user‚Äôs <strong>Details</strong> page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5nnVqPm4l6vVtgyvZpeYwI/db98ccbfb8b945ebde7ec7c8143724c5/user_details_page.png" alt="The Auth0 dashboard displaying the user‚Äôs ‚ÄúUser Details‚Äù page. In the ‚Äúuser_metadata‚Äù field, a JSON object contains a single key-value pair with the key ‚Äúcountry‚Äù and the value ‚ÄúMorocco‚Äù."/></p><p>Scroll down to the <strong>Metadata</strong> section of the page. You‚Äôll see an area labeled <strong>user_metadata</strong>. If you filled out the <code>EditText</code> in the app, you‚Äôll see it in the JSON object there:</p><pre><code><span>{</span>
    <span>&#34;country&#34;</span><span>:</span> <span>{</span><span>WHATEVER_TEXT_YOU_ENTERED</span><span>}</span>
<span>}</span></code></pre><p>Each Auth0 user account can store two kinds of metadata:</p><ul><li><strong>User metadata,</strong> which is meant for data intentionally provided by and controlled by the user. It‚Äôs typically used for storing information that the user wants to share with the app, such as their address, contact information, preferences, and similar data. Only data that the user can read and edit should be stored here.</li><li><strong>App metadata,</strong> which is meant for data provided by and controlled by the app. It‚Äôs typically used for storing information about the user that is primarily for the app‚Äôs use, such as the user‚Äôs roles, permissions, status, and similar data. There may be cases where the user can read this data, but you should not use app metadata to store data provided directly by the user.</li></ul><p>While a detailed look at the user account pages is beyond the scope of this article, you should explore them to see the kinds of data and functionality that are associated with user accounts.</p><h2 id="When-Things-Go-Sideways">When Things Go Sideways</h2><p>The expression ‚Äúto go sideways‚Äù means ‚Äúto go wrong‚Äù or ‚Äúto not go according to plan.‚Äù In this section, I‚Äôll show you what can go wrong when you‚Äôre writing an Android app and fail to account for what happens when the user turns their phone on its side. </p><h3 id="Inducing-app-amnesia">Inducing app amnesia</h3><p>Run the app and log in. You should see this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6D4JdPU0s5tGuplX9gEE4g/cfb0e2c57ead91059a2d6a26d6efdf44/main_screen_1.png" alt="The app‚Äôs screen when the user is logged in, in portrait orientation."/></p><p>Rotate your device to landscape orientation:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/48FY3obLHoGHnHfugbSn7I/8bc142a3e3e69bde3deed3223e6d02d7/orientation_change.png" alt="The app screen viewed in landscape orientation. It has taken on the appearance of just having been launched."/></p><p>Notice what happened: </p><ul><li>The greeting text changed from ‚ÄúYou‚Äôre logged in.‚Äù to ‚ÄúWelcome to the app!‚Äù, which is its state when the app is launched.</li><li>The buttons have also been returned to their initial state:  <strong>Log in</strong> is enabled, and <strong>Log out</strong> is disabled.</li></ul><p>It appears as if turning your device on its side has given your app amnesia and returned it to its initial state. What happened?</p><h3 id="Configuration-changes-and-reloading">Configuration changes and reloading</h3><p>To use a developer clich√©: this isn‚Äôt a bug, but a feature.</p><p>Whenever it detects a configuration change, Android‚Äôs default response is to reload the current activity. There are many configuration changes, such as language, keyboard availability, or the change you made just now: screen orientation. Reloading an activity when a configuration change happens makes it run its initialization methods again and reload resources, allowing it to set itself up for the new configuration.</p><p>This behavior was designed for applications that present different interfaces in different orientations. YouTube is an example of such an app, which has different portrait and landscape UI setups:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4jHUrVT9Ekh5252HZc3T95/706f6ddb57bb1b6be1a37c82b1201297/youtube_portrait_and_landscape.png" alt="The YouTube app, shown in both orientations. In portrait orientation, it shows the video, ratings, and comments. In landscape orientation, the video takes up the entire screen."/></p><p>Changing the screen orientation reloaded the activity and restored the app to its initial state, but it <em>did not</em> change your ‚Äúlogged in‚Äù status. The <code><span>logout</span><span>(</span><span>)</span></code> method was not called when you turned your device on its side. You‚Äôre still logged in!</p><p>You can confirm your ‚Äúlogged in‚Äù status by tapping the <strong>Log in</strong> button. Note that there wasn‚Äôt an intermediate step where you had to enter your email address and password ‚Äî you were taken straight to the app:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/01B8CQAD7K9uDYwkT7D1c7/08a21f19cdacc4ecdb065132cd2cf590/logged_in_sideways.png" alt="The app screen, viewed in landscape orientation, showing the user logged in. The bottom portion of the screen is not in sight."/></p><p>Note that that app never presented the login page. That‚Äôs because there wasn‚Äôt any need ‚Äî you were still logged in. Let‚Äôs solve this problem.</p><h3 id="Curing-your-app-s-amnesia">Curing your app‚Äôs amnesia</h3><p>You can instruct Android <em>not</em> to reload Activities in the event of specified configuration changes in the app‚Äôs manifest. </p><p>üõ† Open <code>AndroidManifest<span>.</span>xml</code> and change the <code><span>&lt;</span>activity<span>&gt;</span></code> tag to the following:</p><pre><code><span><span><span>&lt;</span>activity</span>
    <span><span>android:</span>name</span><span><span>=</span><span>&#34;</span>.MainActivity<span>&#34;</span></span>
    <span><span>android:</span>exported</span><span><span>=</span><span>&#34;</span>true<span>&#34;</span></span>
    <span><span>android:</span>configChanges</span><span><span>=</span><span>&#34;</span>orientation|screenSize<span>&#34;</span></span> <span>&gt;</span></span></code></pre><p>This change adds the attribute <code>android<span>:</span>configChanges<span>=</span> ‚Äúorientation<span>|</span>screenSize‚Äù</code> to <code>MainActivity</code>, which tells Android that the activity should <em>not</em> reload if the device orientation or screen size changes. Instead of reloading the activity, Android uses a callback method to notify the app of the change. The assumption is that you‚Äôll handle those configuration changes yourself. Since we‚Äôll ignore this callback, the configuration change has no effect.</p><p>Run the app and log in. Change the screen orientation, going from portrait to landscape and back. It no longer causes the activity to reload.</p><h2 id="Conclusion">Conclusion</h2><p>You‚Äôve just built a simple app that features basic username/password <em>authentication</em> ‚Äî the ability to identify a known user. In addition to log a user in and out, you can also retrieve the information in their profile, and read and update their metadata.</p><p>You can find the code for the complete project for this article in <a href="https://github.com/auth0-blog/get-started-android-authentication-kotlin" target="_blank" rel="noreferrer noopener">this repository on the <em>Auth0 Blog Samples</em> GitHub account</a>. The only change that you‚Äôll need to make in order to run it is to enter your app‚Äôs client ID and tenant‚Äôs domain in the <code>auth0<span>.</span>xml</code> resource file.</p><p>This is the first in a new series of articles on Android development with Auth0. Future articles will cover new developments in Android 12 and Android Studio, as well as deeper dives into authentication and authorization with Android and Auth0 and alternatives to the standard username-and-password approach. Watch this space!</p><p><a href="https://auth0.com/blog/get-started-with-android-authentication-using-kotlin-part-1" target="_blank" rel="noopener referrer">Next Step: Read the preview part here</a></p><p><a href="https://community.auth0.com/t/developing-a-secure-api-with-nestjs/33026" target="_blank" rel="noopener noreferrer">I ran into an issue</a></p></div></div>]]></content:encoded>
      <pubDate>Mon, 20 Sep 2021 18:29:00 +0000</pubDate>
    </item>
    <item>
      <title>Streamlining a React Monorepo</title>
      <link>https://auth0.com/blog/streamlining-a-react-monorepo/</link>
      <description>Whether you have a single application or a suite of applications, code reuse, standards around structure, process, and feature development help to ensure your codebase remains healthy in the long term.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><a href="https://nx.dev" target="_blank" rel="noreferrer noopener">Nx is a build framework for monorepos</a> with first-class React support. It helps accelerate the adoption of proven development practices across projects of many sizes and scopes. Nx provides additional tooling for React projects to help scale and develop features at a faster pace. </p><p>This guide walks through some of the tooling provided by Nx, the creation, and structure of an Nx workspace, with an example to follow along with.</p><p><iframe src="https://www.youtube.com/embed/IMWk0P6EeRc" frameborder="0" allowfullscreen=""></iframe></p><h2 id="What-are-Monorepos">What are Monorepos</h2><p>A monorepo is a single collection of all your source code that spans multiple applications, libraries, and languages. Everything in the monorepo is not deployed at the same time but is all located in a central repository. Many companies use monorepos for different organizations and projects. Some even use a single monorepo to house all the source code for projects across their entire company.</p><p>Here are some of the benefits of a monorepo:</p><ul><li><strong>Shared code</strong> ‚Äî Promotes reuse of validation code, UI components, and types across the code base, including code between the backend and the frontend.</li><li><strong>Atomic changes</strong> ‚Äî Make changes to a server API and modify the clients that consume that API in the same commit. No more coordinating commits across different repositories.</li><li><strong>Developer mobility</strong> ‚Äî Provides consistency between building and testing applications written using different tools and technologies. Developers can confidently contribute to other teams‚Äô applications and verify that their changes are safe.</li><li><strong>A single set of dependencies</strong> ‚Äî Use a single version of third-party dependencies for all your apps. Less frequently used applications don‚Äôt get left behind with a 3-year-old version of a framework library or an old version of a build tool.</li></ul><p>There are also a few common misconceptions with monorepos:</p><ul><li>Strictly co-locating your code just by placing all your code in the same repository.</li><li>Running all the builds, tests, and quality checks on all applications for each PR or commit.</li><li>Deploying every application on every commit to the main branch.</li><li>Setting up multiple scripts across applications to handle common tasks.</li></ul><p>Just because you have all your code in a monorepo, that does not mean you have run all the tests and checks on your monorepo for every single commit. This doesn&#39;t scale well and leads to bottlenecks in your development and Continuous Integration (CI) and Continuous Deployment (CD) pipelines. Nx provides integrated tooling to intelligently determine what needs to be run through code analysis, affected commands, and computation caching. </p><h3 id="Affected-commands">Affected commands</h3><p>Nx uses code analysis to build a dependency graph of all projects in the workspace. It then uses the dependency graph to determine what projects are impacted based on your changes between your Git branches and the main branch. <a href="https://nx.dev/latest/react/core-concepts/mental-model#affected-commands" target="_blank" rel="noreferrer noopener">Nx‚Äôs Affected Commands</a> use this code analysis to perform the minimum set of tasks based on what&#39;s changed. Let‚Äôs look at two applications that depend on a library as an example.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Msqcbm3M7zreqA7s3Yga/fa9a14ab5dd0970d45ff8603494a2530/Uploaded_from_Streamlining_a_React_Monorepo"/></p><p>To see what applications are affected, use the <strong><a href="https://nx.dev/latest/angular/cli/affected-apps" target="_blank" rel="noreferrer noopener">nx affected:apps command</a></strong>. Nx analyzes the nature of the changes and determines which projects, including applications and libraries, are impacted. In the example above, changing app1 doesn‚Äôt cause app2 to be impacted, so you don‚Äôt need to run all the pre-merge steps for app2. Alternatively, changing the lib, or packages that both apps depend on does impact both applications.</p><h3 id="Computation-caching">Computation caching</h3><p>Nx is smart in that it also knows the context in which you ran particular commands, the current hash of the files, and other environmental information. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1gsO5lGTZaluzgHVc3H3xr/f931ae116060c2def80962a764b4888b/Uploaded_from_Streamlining_a_React_Monorepo"/></p><p>The image above displays an example of the information collected to build a unique hash used to identify the computation. With this information, Nx caches and stores these computations and can replay them if it seems the same computation is being run again.</p><p>This isn‚Äôt done through rebuilding source code. Only the artifacts produced from a given command are stored and replayed when possible. If Nx doesn‚Äôt find this computation, Nx runs the task, and after it completes, it takes the outputs and the terminal output and stores it locally (and if configured remotely). All of this happens transparently, so you don‚Äôt have to worry about it.</p><h2 id="Creating-an-Nx-Workspace-Using-a-React-Preset">Creating an Nx Workspace Using a React Preset</h2><p>Now that you know how Nx works, let‚Äôs try it out by building a small application that lists Star Wars characters.</p><p>Start with creating the Nx workspace with a React application using the <code>react</code> preset. </p><pre><code>npx create-nx-workspace sw-org --preset react --appName myapp</code></pre><p>After running this command, you‚Äôll be asked to select a stylesheet format. You can choose the default for this demo. You also have the option to connect your workspace to <a href="https://nx.app/" target="_blank" rel="noreferrer noopener">Nx Cloud</a> if you‚Äôd like.</p><p>After you make your selections, this command does the following:</p><ul><li>Generates a new Nx workspace</li><li>Scaffolds out a new React application with modern tooling, including <a href="https://jestjs.io/" target="_blank" rel="noreferrer noopener">Jest for unit tests</a>, and <a href="https://www.cypress.io/" target="_blank" rel="noreferrer noopener">Cypress for E2E tests</a>.</li></ul><p>There are other presets available, such as <code>next</code> for <a href="https://nextjs.org/" target="_blank" rel="noreferrer noopener">Next.js</a> projects, and <code>react<span>-</span>express</code> for a workspace with React and Express pre-configured.</p><p>Every Nx workspace has a file structure similar to this:</p><pre><code>myorg/
‚îú‚îÄ‚îÄ apps/
‚îú‚îÄ‚îÄ libs/
‚îú‚îÄ‚îÄ tools/
‚îú‚îÄ‚îÄ workspace.json
‚îú‚îÄ‚îÄ nx.json
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ tsconfig.base.json</code></pre><ul><li><code><span><span>/</span><span>apps</span><span>/</span></span></code> contains the application projects. This is the main entry point for each runnable application.</li><li><code><span><span>/</span><span>libs</span><span>/</span></span></code> contains the library projects. Each library defines its external API so that boundaries between libraries remain clear.</li><li><code><span><span>/</span><span>tools</span><span>/</span></span></code> contains scripts that act on your codebase.</li><li><code><span>/</span>workspace<span>.</span>json</code> contains the configuration for each project in your workspace.</li><li><code><span>/</span>nx<span>.</span>json</code> adds extra information about projects, including implicit dependencies and tags that can be used to restrict the ways projects are allowed to depend on each other.</li><li><code><span>/</span>tsconfig<span>.</span>base<span>.</span>json</code> sets up the global TypeScript settings and aliases.</li></ul><p>To serve up the application, enter into the <code>sw<span>-</span>org</code> directory and run the <code>serve</code> command using the Nx CLI:</p><pre><code>nx serve</code></pre><blockquote><p>Note: If you don&#39;t want to install Nx globally, you can use <code>npx nx serve</code> instead.</p></blockquote><p>The initial application page is displayed.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2EUaKnrpRkLehJempAp06f/a99c92b3282e79e42b16877c98cac1c9/Uploaded_from_Streamlining_a_React_Monorepo"/></p><h2 id="Generating-a-Feature-Library">Generating a Feature Library</h2><p><a href="https://nx.dev/latest/react/structure/library-types#feature-libraries" target="_blank" rel="noreferrer noopener">Generating libraries</a> in an Nx workspace is done by using the <code>generate</code> command with the Nx CLI. Feature libraries are used to display UI to the user, which could including routing information, and could use other libraries such as shared components.</p><p>Create one now by running:</p><pre><code>nx generate lib people</code></pre><p><strong>NOTE</strong> <a href="https://nx.dev/latest/angular/getting-started/console" target="_blank" rel="noreferrer noopener">Nx Console</a> also provides a full l GUI to run Nx CLI commands in your editor with native VSCode and WebStorm support.</p><h2 id="Generating-a-Data-Access-Library">Generating a Data Access Library</h2><p>A &#34;data access&#34; library is where functionality for fetching and storing data for a feature exists. So any services necessary to manage the quotes are placed in this library. Throughout building applications, there will be data access libraries across multiple features.</p><p>Create the data access library by running:</p><pre><code>nx generate lib data-access</code></pre><p><strong>NOTE</strong> You can also create your custom generators similar to the <code>library</code> generator inside an Nx workspace. This provides more flexibility to create more standards around your development processes and guidelines. Read more about workspace generators in our <a href="https://nx.dev/latest/angular/generators/workspace-generators" target="_blank" rel="noreferrer noopener">Workspace Generators</a> guide.</p><p>Update the data-access library to fetch the characters from the Star Wars API.</p><p>Open up <code>data<span>-</span>access<span>.</span>tsx</code> and replace it with the following:</p><pre><code><span>import</span> <span>{</span> useEffect<span>,</span> useState <span>}</span> <span>from</span> <span>&#34;react&#34;</span><span>;</span>

<span>export</span> <span>interface</span> <span>IPerson</span> <span>{</span>
 birth_year<span>:</span> string<span>;</span>
 eye_color<span>:</span> string<span>;</span>
 films<span>:</span> string<span>[</span><span>]</span><span>;</span>
 gender<span>:</span> string<span>;</span>
 hair_color<span>:</span> string<span>;</span>
 height<span>:</span> string<span>;</span>
 homeworld<span>:</span> string<span>;</span>
 mass<span>:</span> string<span>;</span>
 name<span>:</span> string<span>;</span>
 skin_color<span>:</span> string<span>;</span>
 created<span>:</span> Date<span>;</span>
 edited<span>:</span> Date<span>;</span>
 species<span>:</span> string<span>[</span><span>]</span><span>;</span>
 starships<span>:</span> string<span>[</span><span>]</span><span>;</span>
 url<span>:</span> string<span>;</span>
 vehicles<span>:</span> string<span>[</span><span>]</span><span>;</span>
<span>}</span>

<span>export</span> <span>interface</span> <span>Response</span><span>&lt;</span><span>T</span><span>&gt;</span> <span>{</span>
 count<span>:</span> number<span>;</span>
 next<span>:</span> <span>null</span> <span>|</span> string<span>;</span>
 previous<span>:</span> <span>null</span> <span>|</span> string<span>;</span>
 results<span>:</span> <span>T</span><span>[</span><span>]</span><span>;</span>
<span>}</span>

<span>export</span> <span>function</span> <span>usePeople</span><span>(</span><span>page<span>:</span> number</span><span>)</span> <span>{</span>
 <span>const</span> <span>[</span>people<span>,</span> setPeople<span>]</span> <span>=</span> useState<span>&lt;</span>IPerson<span>[</span><span>]</span><span>&gt;</span><span>(</span><span>[</span><span>]</span><span>)</span><span>;</span>

 <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
   <span>fetch</span><span>(</span><span><span>`</span><span>https://swapi.dev/api/people/?page=</span><span><span>${</span>page<span>}</span></span><span>`</span></span><span>)</span><span>.</span><span>then</span><span>(</span><span>(</span><span>r</span><span>)</span> <span>=&gt;</span>
   r<span>.</span><span>json</span><span>(</span><span>)</span><span>.</span><span>then</span><span>(</span><span>data</span> <span>=&gt;</span> data<span>.</span>results<span>)</span>
 <span>)</span><span>.</span><span>then</span><span>(</span><span>data</span> <span>=&gt;</span> <span>{</span>
     <span>setPeople</span><span>(</span>data<span>)</span><span>;</span>
   <span>}</span><span>)</span><span>;</span>
 <span>}</span><span>,</span> <span>[</span><span>]</span><span>)</span><span>;</span>

 <span>return</span> people<span>;</span>
<span>}</span></code></pre><p>Now update the people feature at <code>people<span>.</span>tsx</code> to list out the characters:</p><pre><code><span>import</span> <span>{</span> usePeople <span>}</span> <span>from</span> <span>&#39;@sw-org/data-access&#39;</span><span>;</span>
<span>import</span> <span>&#39;./people.module.css&#39;</span><span>;</span>

<span>export</span> <span>function</span> <span>People</span><span>(</span><span>)</span> <span>{</span>
 <span>const</span> people <span>=</span> <span>usePeople</span><span>(</span><span>1</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
   <span>&lt;</span>div<span>&gt;</span>
     <span>&lt;</span>h1<span>&gt;</span>Star Wars People<span>&lt;</span><span>/</span>h1<span>&gt;</span>

     <span>&lt;</span>ul<span>&gt;</span>
       <span>{</span>
         people<span>.</span><span>map</span><span>(</span><span>person</span> <span>=&gt;</span> <span>(</span>
           <span>&lt;</span>li key<span>=</span><span>{</span>person<span>.</span>name<span>}</span><span>&gt;</span>
             <span>{</span>person<span>.</span>name<span>}</span>
           <span>&lt;</span><span>/</span>li<span>&gt;</span>
         <span>)</span><span>)</span>
       <span>}</span>
     <span>&lt;</span><span>/</span>ul<span>&gt;</span>
   <span>&lt;</span><span>/</span>div<span>&gt;</span>
 <span>)</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> People<span>;</span></code></pre><p>Replace the <code>App</code> template with the <code>People</code> component</p><pre><code><span>import</span> styles <span>from</span> <span>&#39;./app.module.css&#39;</span><span>;</span>

<span>import</span> <span>{</span> People <span>}</span> <span>from</span> <span>&#39;@sw-org/people&#39;</span><span>;</span>

<span>export</span> <span>function</span> <span>App</span><span>(</span><span>)</span> <span>{</span>
 <span>return</span> <span>(</span>
   <span>&lt;</span>div className<span>=</span><span>{</span>styles<span>.</span>app<span>}</span><span>&gt;</span>
     <span>&lt;</span>People<span>/</span><span>&gt;</span>
   <span>&lt;</span><span>/</span>div<span>&gt;</span>
 <span>)</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> App<span>;</span></code></pre><p>Refreshing the application shows a list of characters.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3wmVIH8Sqz1ejavorzIzsI/99c44e96e4e44149da2e72e5e328baad/Uploaded_from_Streamlining_a_React_Monorepo"/></p><p>The list of characters is simple. The business and data logic is kept in libraries. As your applications grow, the number of libraries grows along with it, but the applications remain relatively small and are only used for integrating core functionality for the app to run.</p><h2 id="Dependency-Graph">Dependency Graph</h2><p>Nx knows the dependencies between projects in your workspace and can generate your dependency graph visually at any point in time. </p><p>Run the <strong>nx dep-graph</strong> command to see the current state of the workspace.</p><pre><code>nx dep-graph</code></pre><p>This displays the application, E2E project, and the two libraries. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4oiIpWdF5wIpz6y5qJkGA4/9a8802092e0de9c1a0e5c9e25d9828d7/Uploaded_from_Streamlining_a_React_Monorepo"/></p><p><strong>NOTE</strong>: You can also have the dependency graph auto-refresh with the <code><span>--</span>watch</code> flag.</p><p>You can also see what projects are impacted by a given change. Make a change to the App.tsx, such as removing the <code>className</code>, save, and run the <strong>nx affected:dep-graph</strong> command.</p><pre><code>nx affected:dep-graph</code></pre><p>This displays the <strong>myapp</strong> and <strong>myapp-e2e</strong> highlighted in red as affected projects.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2S5DueXJUNdbbguneKUjGJ/cc397167e5dc78a1835ab2db57b6dacb/Uploaded_from_Streamlining_a_React_Monorepo"/></p><p><strong>NOTE:</strong> The <strong>myapp-e2e</strong> application is directly tied to mapp, but is implicitly linked through the <strong>nx.json</strong> file. Read more about Nx configuration here.</p><h3 id="Using-Affected-Commands">Using Affected Commands</h3><p>Nx provides affected commands to run certain tasks against affected projects. For example, make a change to the <code>data<span>-</span>access</code> library, and run <strong>nx affected:build</strong>. </p><pre><code>nx affected:build</code></pre><p>Nx finds the affected applications impacted by changing the <strong>data-access </strong>library and runs the <strong>build</strong> target for each one of them. That way, <strong>only</strong> the affected projects are built for the given change, and not every project in the monorepo. The same commands work for <strong>test</strong>, <strong>lint</strong>, and <strong>e2e</strong>, and others.</p><p>There is also the <strong>nx affected</strong> command that works with any defined target. The alias for <strong>nx affected:build</strong> is:</p><pre><code>nx affected --target<span>=</span>build</code></pre><p>This allows you to run any target based on the affected projects.</p><h3 id="Using-Computation-Caching">Using Computation Caching</h3><p>Along with affected commands, Nx supports<a href="https://nx.dev/latest/angular/core-extended/computation-caching" target="_blank" rel="noreferrer noopener"> computation caching</a> to never execute the same computation twice. This computation cache is pluggable and can be distributed. Taking <code><span>**</span>myapp</code><em></em> as an example, run the build for <code>myapp</code> twice.</p><pre><code>nx build myapp</code></pre><p>When running the same command the second time without changes, you immediately get the cached results from the previous computation. The computation cache is done locally, but can also be distributed and extended to the rest of your team and organization. </p><p><a href="https://nx.app" target="_blank" rel="noreferrer noopener">Nx Cloud</a> is one such option to distribute your computation cache. It includes a free tier with 5 hours of saved time per month, enterprise options, and is free for open-source projects.</p><h2 id="Summary">Summary</h2><p>Nx provides modern tooling including code analysis, code generation, code analysis, affected commands, and computation caching to scale your application development using a monorepo.</p><p>What did we cover?</p><ul><li>Monorepos and why you should use one</li><li>Nx workspace structure and standardization</li><li>Smarter tooling with code analysis, affected commands, dependency visualization, and computation caching.</li></ul><p>Find out more with the following resources:</p><ul><li>Documentation at <a href="https://nx.dev" target="_blank" rel="noreferrer noopener">https://nx.dev</a></li><li>Free <a href="https://egghead.io/playlists/scale-react-development-with-nx-4038" target="_blank" rel="noreferrer noopener">Egghead course</a> on Scaling React Development</li></ul></div></div>]]></content:encoded>
      <pubDate>Thu, 16 Sep 2021 15:47:00 +0000</pubDate>
    </item>
    <item>
      <title>4 Authentication Tools That Increase Retail Conversion Rates</title>
      <link>https://auth0.com/blog/four-authentication-tools-that-increase-retail-conversion-rates/</link>
      <description>How to decrease abandoned carts by improving the simplicity and security of your user login process.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>When consumers create e-commerce accounts, retailers can use their purchasing history to offer a more personalized shopping experience, which can boost <a href="https://www.mckinsey.com/industries/retail/our-insights/personalizing-the-customer-experience-driving-differentiation-in-retail" target="_blank" rel="noreferrer noopener">retail conversion rates</a> by up to 15%. However, it is tough for retailers to convince people to actually sign up ‚Äî case in point, <a href="https://baymard.com/lists/cart-abandonment-rate" target="_blank" rel="noreferrer noopener">a 2021 DMI survey</a> found that 24% of U.S. shoppers abandoned an order just because they were asked to make an account.</p><p>We <a href="https://images.ctfassets.net/2ntc334xpx65/7o4UAUaHOMHJeV5fmgK9S1/b4c300762c64becf6cef5989046aaf8f/Infograph_2_2x.jpg" target="_blank" rel="noreferrer noopener">surveyed</a> over 8,000 consumers across six global markets (the UK, France, Germany, Australia, Singapore, and Japan) to learn about the login experience they preferred and discovered widespread frustration with standard username/password (UP) login methods and businesses that fail to meet their ease-of-login expectations.</p><p>Our survey found five problems that stop consumers from signing up for an online account:</p><ol start="1"><li>Completing long login or sign-up forms (49%)</li><li>Meeting minimum password requirements (47%)</li><li>Entering private information (46%)</li><li>Creating a new ID and password for every app or online service (43%)</li><li>Verifying their account with one-time passwords (OTP) (23%)</li></ol><p>Such frustrations lead to some of the worst security hygiene offenses, in particular, reuse of passwords across multiple accounts. Our survey found that 85% of international consumers reuse passwords, with 41% of them doing so ‚Äúfrequently or all the time‚Äù and 29% ‚Äúsometimes‚Äù.</p><p>We asked consumers about the kind of login experience that would increase their chances of signing up for an account and found that adding certain authentication features would actually encourage them to do so. Our survey results indicated that, when available, consumers are more likely to complete the signup process if given more secure and easy-to-use login experiences.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/24uCeR7yhZbNmMpbFE7v3v/c2245aa707cc9d83b5242357ed06ac39/Passwordless-Authentication-sep1.jpg" alt="Authentication 01"/></p><p>Below are four authentication tools that can improve your retail conversion rate by creating a more streamlined, secure login experience that satisfies users.</p><h2 id="1--Multi-factor-Authentication--MFA-">1. Multi-factor Authentication (MFA)</h2><p><a href="https://auth0.com/learn/get-started-with-mfa/" target="_blank" rel="noreferrer noopener">MFA</a> requires users to verify their identity in more than one way, which helps reduce the potential for unauthorized access to their data. For instance, a user may submit a password and then have to additionally verify a secondary account or device they own using a link sent to their email address or phone.</p><p>Consumers want to know that companies are protecting their data. In a 2020 survey with 1,000 North American consumers asked about privacy and data collection, management consulting firm McKinsey &amp; Company found that <a href="https://www.mckinsey.com/business-functions/risk-and-resilience/our-insights/the-consumer-data-opportunity-and-the-privacy-imperative" target="_blank" rel="noreferrer noopener">87% of respondents said</a> they ‚Äúwould not do business with a company if they had concerns about its security practices.‚Äù MFA helps retailers provide consumers with greater confidence their data is protected because it blocks <a href="https://www.microsoft.com/security/blog/2019/08/20/one-simple-action-you-can-take-to-prevent-99-9-percent-of-account-attacks/" target="_blank" rel="noreferrer noopener">99.9% of attacks</a>.</p><p>While 49% of our surveyed consumers noted they were more likely to sign up for an online account if a business offered MFA, only 28% of surveyed businesses currently offered it as part of their login process. This discrepancy arises from the perception that the multiple steps in MFA mean extra hassle for both users and the business.</p><p>However, MFA is actually fairly easy to implement ‚Äî many companies <a href="https://www.brighttalk.com/webcast/15793/483340/451-research-report-remote-work-during-covid-19-drives-mfa-adoption" target="_blank" rel="noreferrer noopener">quickly adopted it</a> when COVID-19 forced them to pivot to a remote workforce in 2020.</p><p><strong>Company use example</strong>: According to <a href="https://auth0.com/case-studies/ecobee/" target="_blank" rel="noreferrer noopener">Jordan Christensen</a>, VP of Technology at <a href="https://www.ecobee.com/en-us/" target="_blank" rel="noreferrer noopener">ecobee</a>, the smart device retailer wanted to protect consumers using ecobee‚Äôs home monitoring products, so they outsourced MFA implementation. His team was thrilled they were able to bring MFA to customers ‚Äúwithout needing to reinvent the wheel.‚Äù</p><h2 id="2--Biometrics">2. Biometrics</h2><p><a href="https://auth0.com/blog/what-are-biometrics-the-proscons-of-biometric-security/" target="_blank" rel="noreferrer noopener">Biometrics</a> uses measurable human traits, characteristics, or behaviors to confirm user identity. Fingerprint scans and facial recognition are two of the most common forms of biometrics, but there‚Äôs a growing list that includes options like voice, gait, and even DNA recognition.</p><p>Biometric traits are harder for hackers to fake than usernames and passwords, so they can help mitigate security concerns that could keep consumers from signing up. <a href="https://usa.visa.com/visa-everywhere/security/how-fingerprint-authentication-works.html" target="_blank" rel="noreferrer noopener">Consumers</a> also like it because it‚Äôs faster than username/password authentication, and they don‚Äôt have to struggle with remembering login credentials.</p><p>While 46% of our surveyed consumers responded that they‚Äôd be more likely to log in if they could use biometrics, only 21% of the businesses we surveyed currently offered it ‚Äî the biggest consumer-business gap we found in the study. Taking steps to close the gap between consumer expectations and current business practices will result in a better customer experience and better retail conversion rates.</p><p>Steven Rees-Pullman, SVP, International at Auth0, explains that it can be a <a href="https://auth0.com/blog/businesses-fall-short-of-consumer-expectations-for-login-experiences-auth0-survey-reveals/" target="_blank" rel="noreferrer noopener">‚Äúheavy lift‚Äù</a> for businesses to develop biometric authentication in-house due to factors like limited bandwidth of IT employees or a lack of expertise with the process. To prevent diverting company resources and adding additional stress on already busy IT teams, some companies are instead choosing to outsource implementation to third-party providers that specialize in identity management and already have <a href="https://auth0.com/docs/mfa/configure-webauthn-device-biometrics-for-mfa" target="_blank" rel="noreferrer noopener">experience with biometrics</a>.</p><p><strong>Company use example</strong>: Consumer use of <a href="https://www.microsoft.com/" target="_blank" rel="noreferrer noopener">Microsoft‚Äôs</a> biometric authentication tool Windows Hello, which lets users log in with a face, iris, or fingerprint scan instead of a password, jumped from <a href="https://www.microsoft.com/security/blog/2020/12/17/a-breakthrough-year-for-passwordless-technology/" target="_blank" rel="noreferrer noopener">69.4% to 84.7%</a> in 2019 alone. Additionally, <a href="https://www.disney.com/" target="_blank" rel="noreferrer noopener">Disney</a> started experimenting with a <a href="https://insidethemagic.net/2021/04/disney-world-facial-recognition-ks1/" target="_blank" rel="noreferrer noopener">facial recognition system</a> at Walt Disney World‚Äôs Magic Kingdom theme park this year and was using <a href="https://insidethemagic.net/2020/10/disney-fingerprint-scanning-kj1/" target="_blank" rel="noreferrer noopener">fingerprint scanning</a> to prevent ticket fraud before COVID-19 hit.</p><p><a href="https://auth0.com/learn/social-login/" target="_blank" rel="noreferrer noopener">Social logins</a> use existing login information from a social network provider that allows consumers to access a third-party website account without having to create another one. While the number of social providers <a href="https://www.theverge.com/2021/5/7/22422980/tiktok-log-in-sound-kit-app-integration-developers" target="_blank" rel="noreferrer noopener">keeps growing</a>, staple networks include Facebook, Google, and Twitter.</p><p>Consumers prefer social logins to traditional UP authentication because they typically allow them to create and log in to accounts with just one click. As a result, social logins generally <a href="https://auth0.com/blog/how-to-use-social-login-to-drive-your-apps-growth/" target="_blank" rel="noreferrer noopener">boost conversion rates</a> by up to 20% ‚Äî though some companies report seeing <a href="https://www.quora.com/What-impact-does-social-login-have-on-conversion-rates" target="_blank" rel="noreferrer noopener">as high as 40%</a>. Social logins also provide access to rich user data, allowing you to use more customized, targeted marketing with individual consumers.</p><p>Our survey found there wasn‚Äôt a huge gap between consumers and businesses with social logins, with 37% of consumers noting they were more likely to sign up with it and 31% of businesses currently offering it.</p><p>Social logins are typically connected to larger companies with established data privacy measures, but security can be compromised if users are reusing passwords. Martin Gontovnikas, former VP of Marketing at Auth0, says consumers using social logins should <a href="https://auth0.com/blog/social-login-on-the-rise/" target="_blank" rel="noreferrer noopener">vary their passwords across platforms</a>, and you can choose to boost the security strength of social logins by combining it with MFA.</p><p><strong>Company use example:</strong> Kevin Ho, VP of Marketing for marketing agency <a href="https://www.wishpond.com/" target="_blank" rel="noreferrer noopener">WishPond</a>, found that after featuring a social login option more prominently than UP authentication, the company saw an <a href="https://blog.wishpond.com/post/115675436270/how-we-improved-sign-up-rates-by-8-5-with-this-simple-test" target="_blank" rel="noreferrer noopener">8.5% increase</a> in their conversions.</p><h2 id="4--Passwordless">4. Passwordless</h2><p><a href="https://assets.ctfassets.net/2ntc334xpx65/3Ew2LXo2UJDQdlSukeQxwq/de57802e6a5da4a58de15ee68b42ccf5/Passwordless-Whitepaper-Auth0.pdf" target="_blank" rel="noreferrer noopener">Passwordless</a> authentication is exactly what it sounds like: confirming a consumer‚Äôs identity with something different from a password. Outside of biometrics, typical passwordless options include magic links, where a user is sent a link to log in after submitting their email, one-time codes, and push notifications.</p><p>With the average consumer having <a href="https://tech.co/news/average-person-100-passwords#:~:text=According%20to%20new%20research%20from,has%20100%20passwords%20to%20remember!" target="_blank" rel="noreferrer noopener">approximately 100 passwords</a>, passwordless authentication reduces potential user frustration with logins. Not having traditional UP authentication also means increased data security, with Verizon noting in its <a href="https://www.verizon.com/business/resources/reports/dbir/" target="_blank" rel="noreferrer noopener">2021 Data Breach Investigations Report</a> that stolen login credentials are the main way organizations get hacked. Next Move Strategy Consulting published a report <a href="https://www.nextmsc.com/report/passwordless-authentication-market" target="_blank" rel="noreferrer noopener">this month</a> predicting that the global passwordless authentication market will grow by 29.1% by 2030.</p><p>Even so, passwordless authentication came in last in our survey in terms of both consumer likelihood to sign up with it (34%) and business use (20%). Traditionally, <a href="https://www.forbes.com/sites/forbestechcouncil/2021/04/20/why-is-passwordless-authentication-met-with-reluctance/?sh=5a946c366d06" target="_blank" rel="noreferrer noopener">IT infrastructure</a> at large companies has been set up for UP authentication, so it can be a complex process for businesses to implement passwordless tech on a wide scale.</p><p>According to Cybersecurity Insiders‚Äô 2021 <a href="https://media.fidoalliance.org/wp-content/uploads/2021/03/The_State_Of_Passwordless_Authentication_2021_Report.pdf" target="_blank" rel="noreferrer noopener">‚ÄúThe State of Passwordless Authentication‚Äù</a> report, many organizations that have chosen to implement passwordless authentication have done so because of its proven security, ease of use, and ability to ‚Äúhelp consumer-facing businesses increase revenue.‚Äù Microsoft also reported that <a href="https://www.microsoft.com/security/blog/2020/12/17/a-breakthrough-year-for-passwordless-technology/" target="_blank" rel="noreferrer noopener">more than 150 million users</a> were using passwordless authentication on Windows in May 2020.</p><p><strong>Company use example:</strong> Kunal Chakraborty, Global Vice President for Customer Experience and Digital at <a href="https://www.grandvision.com/" target="_blank" rel="noreferrer noopener">GrandVision</a>, the optical retailer, said the company made <a href="https://auth0.com/case-studies/grandvision/" target="_blank" rel="noreferrer noopener">‚Äúthe checkout process as customer-friendly as possible‚Äù</a> by having a third-party provider implement passwordless authentication ‚Äî accounts are created just by clicking a box. As a result, GrandVision saw a <a href="https://techbeacon.com/security/your-passwordless-future-make-it-sooner-rather-later" target="_blank" rel="noreferrer noopener">boost in their conversions by up to 54%</a>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3DuYOoznWG10geDOeYwBVm/02b5dbc23075eebf4d984f22dbaaec76/Passwordless-Authentication-sep2.jpg" alt="Authentication 02"/></p><h2 id="Authentication-Technologies-Enhance-User-Experience">Authentication Technologies Enhance User Experience</h2><p>While it may seem like adding a new element to your login box would drive consumers away, it‚Äôs actually the opposite. By using one of the authentication tools above to provide consumers with a simple, secure login experience, you can satisfy users and continue to strengthen their ties to your brand with personalized marketing ‚Äî strengthening your retail conversion rate in the process.</p><p>Auth0 makes implementing the authentication technologies above simple ‚Äî learn more <a href="https://auth0.com/authentication" target="_blank" rel="noreferrer noopener">about Auth0‚Äôs platform</a> here.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 15 Sep 2021 15:03:00 +0000</pubDate>
    </item>
    <item>
      <title>Backend For Frontend Authentication Pattern with Auth0 and ASP.NET Core</title>
      <link>https://auth0.com/blog/backend-for-frontend-pattern-with-auth0-and-dotnet/</link>
      <description>Understand the Backend For Frontend authentication pattern and how it can be implemented in ASP.NET with Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> This article discusses the Backend For Frontend authentication pattern and how it can be used in practice in SPAs implemented with React that use ASP.NET Core 5 as backend. Basic knowledge of the OAuth 2.0 and OpenID Connect is desirable but not required.</p><h2 id="What-Is-the-Backend-For-Frontend-Authentication-Pattern-">What Is the Backend For Frontend Authentication Pattern?</h2><p>As you start looking into the different <a href="https://auth0.com/docs/flows" target="_blank" rel="noreferrer noopener">OAuth flows</a> and the scenarios they cover, client type is one of those relevant aspects mentioned everywhere. The <a href="https://datatracker.ietf.org/doc/html/rfc6749" target="_blank" rel="noreferrer noopener">OAuth 2.0 specification</a> defines two different client types, public and confidential clients, under <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-2.1" target="_blank" rel="noreferrer noopener">section #2.1</a>.</p><p>Public clients are those that run in places where secrets could be exposed as part of the source code or if the binaries are decompiled. These usually are single-page apps running in a browser or native apps running in user devices such as mobile phones or smart TVs. </p><p>On the other hand, confidential clients are the ones that can keep secrets in a private store, like, for example, a web application running in a web server, which can store secrets on the backend. </p><p>The client type will determine one or more OAuth flows suitable for the application implementation. By sticking to one of those flows, you can also lower the risks of getting the application compromised from an authentication and authorization standpoint.</p><p>The <strong>Backend For Frontend</strong> (a.k.a BFF) pattern for authentication emerged to mitigate any risk that may occur from negotiating and handling access tokens from public clients running in a browser.  The name also implies that a dedicated backend must be available for performing all the authorization code exchange and handling of the access and refresh tokens. This pattern relies on <a href="https://openid.net/connect/" target="_blank" rel="noreferrer noopener">OpenID Connect</a>, which is an authentication layer that runs on top of OAuth to request and receive identity information about authenticated users.</p><blockquote><p>This pattern does not work for a pure SPA that relies on calling external APIs directly from javascript or a serverless backend (e.g., AWS Lamba or Azure Functions).</p></blockquote><p>The following diagram illustrates how this pattern works in detail:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7b2OEjgWLrP5EBOnPNK4MH/b9970c5cce10ee594477493785b17efb/BFF-Sequence.png" alt="BFF sequence diagram"/></p><ol start="1"><li>When the frontend needs to authenticate the user, it calls an API endpoint (<code><span>/</span>api<span>/</span>login</code>) on the backend to start the login handshake.</li><li>The backend uses OpenID connect with Auth0 to authenticate the user and getting the id, access, and refresh tokens.</li><li>The backend stores the user&#39;s tokens in a cache.</li><li>An encrypted cookie is issued for the frontend representing the user authentication session.</li><li>When the frontend needs to call an external API, it passes the encrypted cookie to the backend together with the URL and data to invoke the API.</li><li>The backend retrieves the access token from the cache and makes a call to the external API including that token on the authorization header.</li><li>When the external API returns a response to the backend, this one forwards that response back to the frontend.</li></ol><h2 id="Backend-For-FrontEnd-in-ASP-NET-Core">Backend For FrontEnd in ASP.NET Core</h2><p>Visual Studio ships with three templates for SPAs with an ASP.NET Core backend. As shown in the following picture, those templates are ASP.NET Core with Angular, ASP.NET Core with React.js, and ASP.NET Core with React.js and Redux, which includes all the necessary plumbing for using Redux.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4m19OOAccdvvxPsriVyior/9062c17f8c3a39820932ab0ff2789185/visualstudio-aspnet-templates.png" alt="Available templates for SPA and ASP.NET Core"/></p><p>As part of this article, we will be discussing how to implement this pattern with the ASP.NET Core with React.js template.</p><p>You can use <a href="https://github.com/auth0-blog/bff-auth0-dotnet" target="_blank" rel="noreferrer noopener">this GitHub repository</a> as a reference for the project you are about to build. </p><h3 id="The-structure-of-the-project">The structure of the project</h3><p>Projects created with that template from Visual Studio will have the following folder structure.</p><ul><li><code>ClientApp</code>, this folder contains a sample SPA implemented with React.js. This is the app that we will modify to support the BFF pattern.</li><li><code>Controllers</code>, this folder contains the controllers implemented with ASP.NET Core for the API consumed from the SPA. In other words, it&#39;s the backend.</li><li><code>Pages</code>, this folder contains server-side pages, which are mostly used for rendering errors on the backend.</li><li><code>Startups<span>.</span>cs</code>, this is the file containing the main class where the ASP.NET Core middleware classes are configured as well as the dependency injection container.</li></ul><p>Before modifying any code, we will proceed to configure first our application in Auth0. That configuration will give us access to the keys and authentication endpoints for the OpenID middleware in .NET Core.</p><h2 id="Auth0-Configuration">Auth0 Configuration</h2><p>To start, you need to access your <a href="https://manage.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Dashboard</a>. If you don&#39;t have an Auth0 account, you can <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free one</a> right now!</p><h3 id="Create-an-application-in-the-Auth0-Dashboard">Create an application in the Auth0 Dashboard</h3><p>The first thing we will do is to create a new brand application in the Auth0 Dashboard. An Auth0 application is an entry point for getting the keys and endpoints we will need in our web application.
Go to your dashboard, click on the <em>Applications</em> menu on the left, and then <em>Create Application</em>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/MTviQ3xdr6MFQQtkMFQ0n/123341f4c3cafaa17da2a8bac62e775e/auth0-dashboard-applications.png" alt="Applications section in the Auth0 Dashboard"/></p><p>The <em>Create Application</em> button will start a wizard to define the configuration of our application. Pick a name for your web application, and select the option <em>Regular Web Applications</em>. Do not confuse your application with a Single Page Web Application. Even if we are going to implement a SPA with React, we will rely on the .NET Core backend to negotiate the ID tokens. When choosing <em>Regular Web Applications</em>, we are telling Auth0 that our application will use the <a href="https://auth0.com/docs/flows/authorization-code-flow" target="_blank" rel="noreferrer noopener">Authorization Code Flow</a>, which requires a backend channel to receive the ID token for OpenID Connect, and that is exactly what we need to get that magic happening in our ASP.NET Core backend.</p><p> <img src="https://images.ctfassets.net/23aumh6u8s0i/34sDIegR1jupeg8G8tJyjE/8bcef77e2d95415396876b996d8547c6/auth0-dashboard-create-application.png" alt="Creating applications in the Auth0 Dashboard"/></p><p>Once the application is created, go to the <em>Settings</em> tab and take note of the following settings:</p><ul><li>Domain</li><li>Client ID</li><li>Client Secret</li></ul><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2YsEWLtSCwuUKt8ba2kRSx/e5d403296c36a4c506d87ce7b5dd711f/auth0-app-configuration-settings.png" alt="Auth0 app configuration settings"/></p><p>Those are the ones you will need to configure the OpenID middleware in the web application.</p><h3 id="Configure-the-Callback-URL">Configure the Callback URL</h3><p>The next thing is to configure the Callback URL for our web application. This is the URL where Auth0 will post the authorization code and ID token for OpenID Connect. 
This URL can be added in the Allowed URLs field for our application. For our sample, we will use <a href="https://localhost:5001/callback" target="_blank" rel="noreferrer noopener">https://localhost:5001/callback</a>. If you are planning to deploy the application to a different URL, you will also need to ensure it is listed here.</p><h3 id="Configure-the-Logout-URL">Configure the Logout URL</h3><p>The logout URL is where Auth0 will redirect the user after the logout process has been completed. Our web application will pass this URL to Auth0 as part of <a href="https://auth0.com/docs/logout/redirect-users-after-logout" target="_blank" rel="noreferrer noopener">the <code>returnTo</code> query string parameter</a>. The logout URL for your app must be added to the <em>Allowed Logout URLs</em> field under the application settings, or Auth0 will return an error otherwise when the user tries to do a logout. For our sample, we will use <a href="https://localhost:5001" target="_blank" rel="noreferrer noopener">https://localhost:5001</a>.</p><h3 id="Create-an-API-in-the-Auth0-Dashboard">Create an API in the Auth0 Dashboard</h3><p>We also need to create an Auth0 API in the Auth0 Dashboard. So, go to the APIs section and click on <em>Create API</em>, as shown in the following picture:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/41FoW31W6boGVYrtkfnyhK/2efc80b19495ecb27699ccc62052f14d/auth0-dashboard-create-api.png" alt="Creating an API in the Auth0 Dashboard"/></p><p>This will open a new window for configuring the API. Configure the following fields under the settings tab in that window.</p><ul><li><strong>Name</strong>, a friendly name or description for the API. Enter <strong>Weather Forecast API</strong> for this sample.</li><li><strong>Identifier</strong> or <strong>Audience</strong>, which is an identifier that the client application uses to request access tokens for the API. Enter the string <code>https<span>:</span><span>/</span><span>/</span>weatherforecast</code>.</li></ul><p>Under the permissions tab, add a new permission <code>read<span>:</span>weather</code> with the description <em>It allows getting the weather forecast</em>. This is the scope that Auth0 will inject in the access token if the user approves it in the consent screen. </p><p>Finally, click on the Save button to save the changes. At this point, our API is ready to be used from .NET Core.</p><h2 id="Configuring-the-ASP-NET-Core-Application">Configuring the ASP.NET Core Application</h2><p>Our application will use two middleware: </p><ul><li>The OpenID Connect middleware for handling all the authentication handshake with Auth0.</li><li>The Authentication Cookie middleware for persisting the authentication session in a cookie also sharing it with the frontend running React.</li></ul><p>Open the Package Manager Console for NuGet in Visual Studio and run the following command:</p><pre><code>Install-Package Microsoft.AspNetCore.Authentication.Cookies
Install-Package Microsoft.AspNetCore.Authentication.OpenIdConnect</code></pre><p>Once the Nuget packages are installed in our project, we can go ahead and configure the middleware in the <code>Startup<span>.</span>cs</code> class under the root folder of the ASP.NET Core project.</p><p>Modify the <code>ConfigureServices</code> method in that class to include the following code.</p><pre><code><span>// BFF/Startup.cs</span>

<span>// ...existing code...</span>

<span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
  services<span>.</span><span>AddAuthentication</span><span>(</span>options <span>=&gt;</span>
    <span>{</span>
        options<span>.</span>DefaultAuthenticateScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
        options<span>.</span>DefaultSignInScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
        options<span>.</span>DefaultChallengeScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
    <span>}</span><span>)</span>
    <span>.</span><span>AddCookie</span><span>(</span>o <span>=&gt;</span>
    <span>{</span>
        o<span>.</span>Cookie<span>.</span>SecurePolicy <span>=</span> CookieSecurePolicy<span>.</span>Always<span>;</span>
        o<span>.</span>Cookie<span>.</span>SameSite <span>=</span> SameSiteMode<span>.</span>Strict<span>;</span>
        o<span>.</span>Cookie<span>.</span>HttpOnly <span>=</span> <span>true</span><span>;</span>
    <span>}</span><span>)</span>
    <span>.</span><span>AddOpenIdConnect</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> options <span>=&gt;</span> <span>ConfigureOpenIdConnect</span><span>(</span>options<span>)</span><span>)</span><span>;</span>
  
    services<span>.</span><span>AddHttpClient</span><span>(</span><span>)</span><span>;</span>

   <span>// ...existing code...</span>
 <span>}</span>

<span>private</span> <span><span>void</span></span> <span>ConfigureOpenIdConnect</span><span>(</span><span>OpenIdConnectOptions</span> options<span>)</span>
<span>{</span>
    <span>// Set the authority to your Auth0 domain</span>
    options<span>.</span>Authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>

    <span>// Configure the Auth0 Client ID and Client Secret</span>
    options<span>.</span>ClientId <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span><span>;</span>
    options<span>.</span>ClientSecret <span>=</span> Configuration<span>[</span><span>&#34;Auth0:ClientSecret&#34;</span><span>]</span><span>;</span>

    <span>// Set response type to code</span>
    options<span>.</span>ResponseType <span>=</span> OpenIdConnectResponseType<span>.</span>CodeIdToken<span>;</span>

    options<span>.</span>ResponseMode <span>=</span> OpenIdConnectResponseMode<span>.</span>FormPost<span>;</span>

    <span>// Configure the scope</span>
    options<span>.</span>Scope<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
    options<span>.</span>Scope<span>.</span><span>Add</span><span>(</span><span>&#34;openid&#34;</span><span>)</span><span>;</span>
    options<span>.</span>Scope<span>.</span><span>Add</span><span>(</span><span>&#34;offline_access&#34;</span><span>)</span><span>;</span>
    options<span>.</span>Scope<span>.</span><span>Add</span><span>(</span><span>&#34;read:weather&#34;</span><span>)</span><span>;</span>
    
    <span>// Set the callback path, so Auth0 will call back to http://localhost:3000/callback</span>
    <span>// Also ensure that you have added the URL as an Allowed Callback URL in your Auth0 dashboard</span>
    options<span>.</span>CallbackPath <span>=</span> <span>new</span> <span>PathString</span><span>(</span><span>&#34;/callback&#34;</span><span>)</span><span>;</span>

    <span>// Configure the Claims Issuer to be Auth0</span>
    options<span>.</span>ClaimsIssuer <span>=</span> <span>&#34;Auth0&#34;</span><span>;</span>

    <span>// This saves the tokens in the session cookie</span>
    options<span>.</span>SaveTokens <span>=</span> <span>true</span><span>;</span>
    
    options<span>.</span>Events <span>=</span> <span>new</span> <span>OpenIdConnectEvents</span>
    <span>{</span>
        <span>// handle the logout redirection</span>
        OnRedirectToIdentityProviderForSignOut <span>=</span> <span>(</span>context<span>)</span> <span>=&gt;</span>
        <span>{</span>
            <span><span>var</span></span> logoutUri <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>/v2/logout?client_id=</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:ClientId&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>

            <span><span>var</span></span> postLogoutUri <span>=</span> context<span>.</span>Properties<span>.</span>RedirectUri<span>;</span>
            <span>if</span> <span>(</span><span>!</span><span>string</span><span>.</span><span>IsNullOrEmpty</span><span>(</span>postLogoutUri<span>)</span><span>)</span>
            <span>{</span>
                <span>if</span> <span>(</span>postLogoutUri<span>.</span><span>StartsWith</span><span>(</span><span>&#34;/&#34;</span><span>)</span><span>)</span>
                <span>{</span>
                    <span>// transform to absolute</span>
                    <span><span>var</span></span> request <span>=</span> context<span>.</span>Request<span>;</span>
                    postLogoutUri <span>=</span> request<span>.</span>Scheme <span>+</span> <span>&#34;://&#34;</span> <span>+</span> request<span>.</span>Host <span>+</span> request<span>.</span>PathBase <span>+</span> postLogoutUri<span>;</span>
                <span>}</span>
                logoutUri <span>+=</span> <span><span>$&#34;&amp;returnTo=</span><span><span>{</span><span> Uri<span>.</span><span>EscapeDataString</span><span>(</span>postLogoutUri<span>)</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>
            <span>}</span>
            context<span>.</span>Response<span>.</span><span>Redirect</span><span>(</span>logoutUri<span>)</span><span>;</span>
            context<span>.</span><span>HandleResponse</span><span>(</span><span>)</span><span>;</span>

            <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
        <span>}</span><span>,</span>
        OnRedirectToIdentityProvider <span>=</span> context <span>=&gt;</span> <span>{</span>
            context<span>.</span>ProtocolMessage<span>.</span><span>SetParameter</span><span>(</span><span>&#34;audience&#34;</span><span>,</span> Configuration<span>[</span><span>&#34;Auth0:ApiAudience&#34;</span><span>]</span><span>)</span><span>;</span>
            <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
        <span>}</span>
    <span>}</span><span>;</span>
<span>}</span>

<span>// ...existing code...</span></code></pre><p>This code configures the OpenID Connect middleware to point to Auth0 for authentication and the Cookie middleware for persisting the authentication session in cookies. Let&#39;s discuss different parts of this code more in detail so you can understand what it does.</p><pre><code>services<span>.</span><span>AddAuthentication</span><span>(</span>options <span>=&gt;</span>
    <span>{</span>
        options<span>.</span>DefaultAuthenticateScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
        options<span>.</span>DefaultSignInScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
        options<span>.</span>DefaultChallengeScheme <span>=</span> CookieAuthenticationDefaults<span>.</span>AuthenticationScheme<span>;</span>
    <span>}</span><span>)</span>
    <span>.</span><span>AddCookie</span><span>(</span>o <span>=&gt;</span>
    <span>{</span>
        o<span>.</span>Cookie<span>.</span>SecurePolicy <span>=</span> CookieSecurePolicy<span>.</span>Always<span>;</span>
        o<span>.</span>Cookie<span>.</span>SameSite <span>=</span> SameSiteMode<span>.</span>Strict<span>;</span>
        o<span>.</span>Cookie<span>.</span>HttpOnly <span>=</span> <span>true</span><span>;</span>
    <span>}</span><span>)</span></code></pre><p>It configures authentication to rely on the session cookie as the primary authentication mechanism if no other is specified in one of the web application&#39;s controllers. It also injects the cookie middleware with a few settings that restrict how the cookie can be used on the browsers. In our case, the cookie can only be used under HTTPS (<code>CookieSecurePolicy<span>.</span>Always</code>), it&#39;s not available on the client side (<code>HttpOnly <span>=</span> <span>true</span></code>), and uses a site policy equals to strict (<code>SameSiteMode<span>.</span>Strict</code>). This last one implies the cookie will only be sent if the domain for the cookie matches exactly the domain in the browser&#39;s URL. All these settings help to prevent potential attacks with scripting on the client side.</p><pre><code>options<span>.</span>ResponseType <span>=</span> OpenIdConnectResponseType<span>.</span>CodeIdToken<span>;</span>
options<span>.</span>ResponseMode <span>=</span> OpenIdConnectResponseMode<span>.</span>FormPost<span>;</span></code></pre><p>The OpenID Connect middleware is configured to use <code>ResponseType</code> equals to <code>CodeIdToken</code> (<a href="https://auth0.com/docs/flows/hybrid-flow" target="_blank" rel="noreferrer noopener">Hybrid flow</a>), which means our web application will receive an authorization code and ID token directly from the authorization endpoint right after the user is authenticated. We will use the authorization code in exchange for an access token for calling a backend API hosted on a different site. </p><pre><code><span>// Configure the scope</span>
options<span>.</span>Scope<span>.</span><span>Clear</span><span>(</span><span>)</span><span>;</span>
options<span>.</span>Scope<span>.</span><span>Add</span><span>(</span><span>&#34;openid&#34;</span><span>)</span><span>;</span>
options<span>.</span>Scope<span>.</span><span>Add</span><span>(</span><span>&#34;offline_access&#34;</span><span>)</span><span>;</span>
options<span>.</span>Scope<span>.</span><span>Add</span><span>(</span><span>&#34;read:weather&#34;</span><span>)</span><span>;</span></code></pre><p>The <code>openid</code> scope is required as part of the OpenID Connect authentication flow. The <code>offline_access</code> is for requesting a <a href="https://auth0.com/docs/tokens/refresh-tokens" target="_blank" rel="noreferrer noopener">refresh token</a> and <code>read<span>:</span>weather</code> is specific to the API we will call later as part of this sample.</p><pre><code>options<span>.</span>SaveTokens <span>=</span> <span>true</span><span>;</span></code></pre><p>The <code>SaveTokens</code> option tells the OpenID Connect middleware that all the tokens (id token, refresh token, and access token) received from the authorization endpoint during the initial handshake must be persisted for later use. By default, the middleware persists those tokens in the encrypted session cookie, and we will use that for our sample.</p><pre><code>OnRedirectToIdentityProvider <span>=</span> context <span>=&gt;</span> <span>{</span>
    context<span>.</span>ProtocolMessage<span>.</span><span>SetParameter</span><span>(</span><span>&#34;audience&#34;</span><span>,</span> Configuration<span>[</span><span>&#34;Auth0:ApiAudience&#34;</span><span>]</span><span>)</span><span>;</span>
    <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
<span>}</span><span>,</span></code></pre><p>The OpenID Connect middleware does not have any property to configure the <code>audience</code> parameter that Auth0 requires for returning an authorization code for an API. We are attaching some code to the <code>OnRedirectToIdentityProvider</code> event for setting that parameter before the user is redirected to Auth0 for authentication.</p><pre><code>services<span>.</span><span>AddHttpClient</span><span>(</span><span>)</span><span>;</span></code></pre><p>The extension method <code>AddHttpClient</code> injects an <code>IHttpClientFactory</code> with default settings to create instances of the class <code>HttpClient</code>. We will use it to make calls to the external API.</p><p>The next step is to modify the <code>Configure</code> method to tell ASP.NET Core that we want to use the authentication and authorization middleware. Those middleware will integrate automatically with the authentication session cookies.</p><p>Insert the following code as it is shown below:</p><pre><code><span>// Startup.cs</span>

<span>// ...existing code...</span>

<span>public</span> <span><span>void</span></span> <span>Configure</span><span>(</span><span>IApplicationBuilder</span> app<span>,</span> <span>IWebHostEnvironment</span> env<span>)</span>
<span>{</span>
    <span>// ...existing code...</span>
    app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>

    <span>// Code goes here</span>
    app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span>
    app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>

    app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=&gt;</span>
    <span>{</span>
      endpoints<span>.</span><span>MapControllerRoute</span><span>(</span>
        <span>name</span><span>:</span> <span>&#34;default&#34;</span><span>,</span>
        <span>pattern</span><span>:</span> <span>&#34;{controller}/{action=Index}/{id?}&#34;</span><span>)</span><span>;</span>
     <span>}</span><span>)</span><span>;</span>
  
    <span>// ...existing code...</span>
<span>}</span></code></pre><p>Update the existing <code>appSettings<span>.</span>json</code> file and include the settings we got from the Auth0 Dashboard before. Those are <em>Domain</em>, <em>Client ID</em>, <em>Client Secret</em>, and <em>ApiAudience</em>.</p><pre><code><span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
      <span>&#34;LogLevel&#34;</span><span>:</span> <span>{</span>
      <span>&#34;Default&#34;</span><span>:</span> <span>&#34;Information&#34;</span><span>,</span>
      <span>&#34;Microsoft&#34;</span><span>:</span> <span>&#34;Warning&#34;</span><span>,</span>
      <span>&#34;Microsoft.Hosting.Lifetime&#34;</span><span>:</span> <span>&#34;Information&#34;</span>
      <span>}</span>
    <span>}</span><span>,</span>
  <span>&#34;AllowedHosts&#34;</span><span>:</span> <span>&#34;*&#34;</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;&lt;domain&gt;&#34;</span><span>,</span>
    <span>&#34;ClientId&#34;</span><span>:</span> <span>&#34;&lt;client id&gt;&#34;</span><span>,</span>
    <span>&#34;ClientSecret&#34;</span><span>:</span> <span>&#34;&lt;client secret&gt;&#34;</span><span>,</span>
    <span>&#34;ApiAudience&#34;</span><span>:</span> <span>&#34;https://weatherforecast&#34;</span>
  <span>}</span>
<span>}</span></code></pre><h3 id="Add-the-ASP-NET-Core-Controllers-for-handling-authentication">Add the ASP.NET Core Controllers for handling authentication</h3><p>Create a new ASP.NET controller in the <code>Controllers</code> folder and call it <code>AuthController</code>. This controller has three actions.</p><ul><li><code>Login</code> for initiating the OpenID Connect login handshake with Auth0.</li><li><code>Logout</code> for logging out from the web application and also from Auth0.</li><li><code>GetUser</code> for getting data about the authenticated user in the current session. This is an API that the React application will invoke to get the authentication context for the user.</li></ul><p>This is the code for the <code>Login</code> action:</p><pre><code><span>// BFF/Controllers/AuthController.cs</span>

<span>// ...existing code...</span>

<span>public</span> <span>ActionResult</span> <span>Login</span><span>(</span><span><span>string</span></span> returnUrl <span>=</span> <span>&#34;/&#34;</span><span>)</span>
<span>{</span>
  <span>return</span> <span>new</span> <span>ChallengeResult</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> <span>new</span> <span>AuthenticationProperties</span><span>(</span><span>)</span> <span>{</span> RedirectUri <span>=</span> returnUrl <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>// ...existing code...</span></code></pre><p>It is an action that returns a <code>ChallengeResult</code> with the authentication schema to be used. In this case, it is Auth0, which is the schema we associated with our OpenID Connect middleware in the <code>Startup</code> class. This result is a built-in class shipped with ASP.NET Core to initiate an authentication handshake from the authentication middleware.</p><p>The logout action looks as follows:</p><pre><code><span>// BFF/Controllers/AuthController.cs</span>

<span>// ...existing code...</span>

<span>[</span><span><span>Authorize</span></span><span>]</span>
<span>public</span> <span>ActionResult</span> <span>Logout</span><span>(</span><span>)</span>
<span>{</span>
  <span>return</span> <span>new</span> <span>SignOutResult</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> <span>new</span> <span>AuthenticationProperties</span>
  <span>{</span>
    RedirectUri <span>=</span> Url<span>.</span><span>Action</span><span>(</span><span>&#34;Index&#34;</span><span>,</span> <span>&#34;Home&#34;</span><span>)</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>// ...existing code...</span></code></pre><p>It returns a <code>SignOutResult</code> that will log the user out of the application and also initiate the sign-out process with Auth0. As it happened with the <code>ChallengeResult</code>, this <code>SignOutResult</code> is also a built-in result that the authentication middleware will process. We also decorated the action with the <code><span>[</span>Authorize<span>]</span></code> attribute as it should only be invoked if the user is authenticated.</p><p>Finally, the <code>GetUser</code> API code is the following:</p><pre><code><span>// BFF/Controllers/AuthController.cs</span>

<span>// ...existing code...</span>

<span>public</span> <span>ActionResult</span> <span>GetUser</span><span>(</span><span>)</span>
<span>{</span>
  <span>if</span> <span>(</span>User<span>.</span>Identity<span>.</span>IsAuthenticated<span>)</span>
  <span>{</span>
    <span><span>var</span></span> claims <span>=</span> <span>(</span><span>(</span>ClaimsIdentity<span>)</span><span>this</span><span>.</span>User<span>.</span>Identity<span>)</span><span>.</span>Claims<span>.</span><span>Select</span><span>(</span>c <span>=&gt;</span>
                    <span>new</span> <span>{</span> type <span>=</span> c<span>.</span>Type<span>,</span> <span>value</span> <span>=</span> c<span>.</span>Value <span>}</span><span>)</span>
                    <span>.</span><span>ToArray</span><span>(</span><span>)</span><span>;</span>

    <span>return</span> <span>Json</span><span>(</span><span>new</span> <span>{</span> isAuthenticated <span>=</span> <span>true</span><span>,</span> claims <span>=</span> claims <span>}</span><span>)</span><span>;</span>
 <span>}</span>

 <span>return</span> <span>Json</span><span>(</span><span>new</span> <span>{</span> isAuthenticated <span>=</span> <span>false</span> <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>// ...existing code...</span></code></pre><p>If the user is authenticated, it returns the user identity as a set of claims serialized as JSON. Otherwise, it just returns a flag indicating the user is not authenticated.</p><h3 id="Require-authentication-in-other-controllers">Require authentication in other controllers</h3><p>The <code>WeatherForecast</code> controller included in the template allows anonymous calls. To make it more interesting in our sample, we will convert it to require authenticated calls. Fortunately, that is as simple as adding a top-level <code>Authorize</code> attribute in the class definition.</p><pre><code><span>// BFF/Controllers/WeatherForecastController.cs</span>

<span>// ...existing code...</span>

<span>[</span><span><span>ApiController</span></span><span>]</span>
<span>[</span><span><span>Authorize</span></span><span>]</span>
<span>[</span><span><span>Route</span><span><span>(</span><span>&#34;[controller]&#34;</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>class</span> <span>WeatherForecastController</span> <span>:</span> <span><span>ControllerBase</span></span>
<span>{</span>

<span>// ...existing code...</span></code></pre><h3 id="Negotiate-an-Access-Token-and-call-a-remote-API">Negotiate an Access Token and call a remote API</h3><p>We will convert the <code>WeatherForecast</code> controller in our web application to act as a reverse proxy and call the equivalent API hosted remotely on a different site. This API will require an access token, so the controller will have to negotiate first the authorization code that is persisted in the session cookie.</p><pre><code> <span>public</span> <span>WeatherForecastController</span><span>(</span>
            <span>IHttpClientFactory</span> httpClientFactory<span>,</span>
            <span>IConfiguration</span> configuration<span>)</span>
<span>{</span>
    _httpClientFactory <span>=</span> httpClientFactory<span>;</span>

    <span>if</span> <span>(</span>configuration<span>[</span><span>&#34;WeatherApiEndpoint&#34;</span><span>]</span> <span>==</span> <span>null</span><span>)</span>
        <span>throw</span> <span>new</span> <span>ArgumentNullException</span><span>(</span><span>&#34;The Weather Api Endpoint is missing from the configuration&#34;</span><span>)</span><span>;</span>

    _apiEndpoint <span>=</span> <span>new</span> <span>Uri</span><span>(</span>configuration<span>[</span><span>&#34;WeatherApiEndpoint&#34;</span><span>]</span><span>,</span> UriKind<span>.</span>Absolute<span>)</span><span>;</span>
<span>}</span></code></pre><p>The constructor on this controller receives an instance of an <code>IHttpClientFactory</code> that we previously registered in the <code>Startup<span>.</span>cs</code> file for creating <code>HttpClient</code> instances and an instance of <code>IConfiguration</code> to retrieve settings from the configuration file. The endpoint for the Weather API is retrieved from the configuration using the <code>WeatherApiEndpoint</code> key. That key in the <code>appSettings<span>.</span>json</code> only references the URL for the remote API as it is shown below:</p><pre><code><span>// appSettings.json</span>
<span>{</span>
  <span>// ... other settings ...</span>
  <span>&#34;WeatherApiEndpoint&#34;</span><span>:</span> <span>&#34;https://localhost:44385/&#34;</span>
<span>}</span></code></pre><p>The following code shows the implementation of the <code>Get</code> method. This is the actual remote API invoked by passing the expected authorization headers:</p><pre><code><span>// BFF/Controllers/WeatherForecastController.cs</span>

<span>// ...existing code...</span>

<span>[</span><span><span>HttpGet</span></span><span>]</span>
<span>public</span> <span>async</span> <span>Task</span> <span>Get</span><span>(</span><span>)</span>
<span>{</span>
    <span><span>var</span></span> accessToken <span>=</span> <span>await</span> HttpContext<span>.</span><span>GetTokenAsync</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> <span>&#34;access_token&#34;</span><span>)</span><span>;</span>

    <span><span>var</span></span> httpClient <span>=</span> _httpClientFactory<span>.</span><span>CreateClient</span><span>(</span><span>)</span><span>;</span>

    <span><span>var</span></span> request <span>=</span> <span>new</span> <span>HttpRequestMessage</span><span>(</span>HttpMethod<span>.</span>Get<span>,</span> <span>new</span> <span>Uri</span><span>(</span>_apiEndpoint<span>,</span> <span>&#34;WeatherForecast&#34;</span><span>)</span><span>)</span><span>;</span>
    request<span>.</span>Headers<span>.</span>Authorization <span>=</span> <span>new</span> <span>AuthenticationHeaderValue</span><span>(</span><span>&#34;Bearer&#34;</span><span>,</span> accessToken<span>)</span><span>;</span>

    <span><span>var</span></span> response <span>=</span> <span>await</span> httpClient<span>.</span><span>SendAsync</span><span>(</span>request<span>)</span><span>;</span>

    response<span>.</span><span>EnsureSuccessStatusCode</span><span>(</span><span>)</span><span>;</span>

    <span>await</span> response<span>.</span>Content<span>.</span><span>CopyToAsync</span><span>(</span>HttpContext<span>.</span>Response<span>.</span>Body<span>)</span><span>;</span>
<span>}</span>

<span>// ...existing code...</span></code></pre><p>The trick for getting the access token is in the following line,</p><pre><code><span><span>var</span></span> accessToken <span>=</span> <span>await</span> HttpContext<span>.</span><span>GetTokenAsync</span><span>(</span><span>&#34;Auth0&#34;</span><span>,</span> <span>&#34;access_token&#34;</span><span>)</span><span>;</span></code></pre><p><code>GetTokenAsync</code> is an extension method available as part of the authentication middleware in ASP.NET Core. The first argument specifies the authentication schema to be used to get the token, which is our OpenID Connect middleware configured with the name &#34;Auth0&#34;. The second argument is the token to be used. In the case of OpenID Connect, the possible values are &#34;access_token&#34; or &#34;id_token&#34;. If the access token is not available or already expired, the middleware will use the refresh token and authorization code to get one. Since our middleware was pointing to the <code>WeatherForecast</code> API with the audience attribute and the scope we previously configured, Auth0 will return an access token for that API.</p><pre><code><span><span>var</span></span> httpClient <span>=</span> _httpClientFactory<span>.</span><span>CreateClient</span><span>(</span><span>)</span><span>;</span>

<span><span>var</span></span> request <span>=</span> <span>new</span> <span>HttpRequestMessage</span><span>(</span>HttpMethod<span>.</span>Get<span>,</span> <span>new</span> <span>Uri</span><span>(</span>_apiEndpoint<span>,</span> <span>&#34;WeatherForecast&#34;</span><span>)</span><span>)</span><span>;</span>
request<span>.</span>Headers<span>.</span>Authorization <span>=</span> <span>new</span> <span>AuthenticationHeaderValue</span><span>(</span><span>&#34;Bearer&#34;</span><span>,</span> accessToken<span>)</span><span>;</span>

<span><span>var</span></span> response <span>=</span> <span>await</span> httpClient<span>.</span><span>SendAsync</span><span>(</span>request<span>)</span><span>;</span>

response<span>.</span><span>EnsureSuccessStatusCode</span><span>(</span><span>)</span><span>;</span>

<span>await</span> response<span>.</span>Content<span>.</span><span>CopyToAsync</span><span>(</span>HttpContext<span>.</span>Response<span>.</span>Body<span>)</span><span>;</span></code></pre><p>The code above forwards the request to the remote API using a new instance of <code>HttpClient</code> created with the <code>IHttpClientFactory</code> injected in the constructor. The access token is passed as a <em>Bearer</em> token in the authorization header.</p><h2 id="Configuring-the-Remote-API">Configuring the Remote API</h2><p>As the remote API, we will use the one provided with Visual Studio&#39;s ASP.NET Web API template that returns the weather forecast data.</p><h3 id="Create-the-ASP-NET-Core-API-in-Visual-Studio">Create the ASP.NET Core API in Visual Studio</h3><p>Visual Studio ships with a single template for .NET Core APIs. That is <em>ASP.NET Core Web API</em>, as it is shown in the image below.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2BaHhqSQTjwbHWK9jjcP9X/31a204c719db633e53220a2563d68208/aspnet-visual-studio-template.png" alt="ASP.NET template in Visual Studio"/></p><h3 id="The-structure-of-the-project">The structure of the project</h3><p>Projects created with that template from Visual Studio will have the following structure:</p><ul><li><code>Controllers</code>, this folder contains the controllers for the API implementation.</li><li><code>Startup<span>.</span>cs</code>, this is the main class where the ASP.NET Core middleware classes and the dependency injection container are configured.</li></ul><h3 id="Configuring-the-project">Configuring the project</h3><p>Our application will only use the middleware for supporting authentication with JWT as bearer tokens.</p><p>Open the Package Manager Console for NuGet in Visual Studio and run the following command:</p><pre><code>Install-Package Microsoft.AspNetCore.Authentication.JwtBearer</code></pre><p>Once the NuGet packages are installed in our project, we can go ahead and configure them in the <code>Startup<span>.</span>cs</code> class file.</p><p>Modify the <code>ConfigureServices</code> method in that class to include the following code:</p><pre><code><span>// Api/Startup.cs</span>

<span>// ...existing code...</span>

<span>public</span> <span><span>void</span></span> <span>ConfigureServices</span><span>(</span><span>IServiceCollection</span> services<span>)</span>
<span>{</span>
    <span><span>var</span></span> authentication <span>=</span> services
        <span>.</span><span>AddAuthentication</span><span>(</span>JwtBearerDefaults<span>.</span>AuthenticationScheme<span>)</span>
        <span>.</span><span>AddJwtBearer</span><span>(</span><span>&#34;Bearer&#34;</span><span>,</span> c <span>=&gt;</span>
        <span>{</span>
        c<span>.</span>Authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>
        c<span>.</span>TokenValidationParameters <span>=</span> <span>new</span> <span>TokenValidationParameters</span>
        <span>{</span>
            ValidateAudience <span>=</span> <span>true</span><span>,</span>
            ValidAudiences <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>.</span><span>Split</span><span>(</span><span>&#34;;&#34;</span><span>)</span><span>,</span>
            ValidateIssuer <span>=</span> <span>true</span><span>,</span>
            ValidIssuer <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>&#34;</span></span><span>;</span>
        <span>}</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>

    services<span>.</span><span>AddControllers</span><span>(</span><span>)</span><span>;</span>
            
    services<span>.</span><span>AddSwaggerGen</span><span>(</span>c <span>=&gt;</span>
    <span>{</span>
        c<span>.</span><span>SwaggerDoc</span><span>(</span><span>&#34;v1&#34;</span><span>,</span> <span>new</span> <span>OpenApiInfo</span> <span>{</span> Title <span>=</span> <span>&#34;Api&#34;</span><span>,</span> Version <span>=</span> <span>&#34;v1&#34;</span> <span>}</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>

    services<span>.</span><span>AddAuthorization</span><span>(</span>o <span>=&gt;</span>
    <span>{</span>
        o<span>.</span><span>AddPolicy</span><span>(</span><span>&#34;read:weather&#34;</span><span>,</span> p <span>=&gt;</span> p<span>.</span>
            <span>RequireAuthenticatedUser</span><span>(</span><span>)</span><span>.</span>
            <span>RequireScope</span><span>(</span><span>&#34;read:weather&#34;</span><span>)</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>// ...existing code...</span></code></pre><p>This code performs two things. It configures the JWT middleware to accept access tokens issued by Auth0 and defines an authorization policy for checking the scope set on the token. 
The policy checks for a claim or attribute called <em>scope</em> with a value <code>read<span>:</span>weather</code>, which is the scope we previously configured for our API in the Auth0 dashboard. 
<code>RequireScope</code> is a custom extension we will write as part of this sample to check for the scope present in the JWT access token.</p><p>The next step is to modify the <code>Configure</code> method to tell ASP.NET Core that we want to use the authentication and authorization middleware. That middleware will integrate automatically with the authentication session cookies.</p><p>Insert the new code as shown below in the <code>Startup<span>.</span>cs</code> file:</p><pre><code><span>// Api/Startup.cs</span>

<span>// ...existing code...</span>

<span>public</span> <span><span>void</span></span> <span>Configure</span><span>(</span><span>IApplicationBuilder</span> app<span>,</span> <span>IWebHostEnvironment</span> env<span>)</span>
<span>{</span>
  <span>// ...existing code...</span>
  
  app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>
            
  app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span>
  app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>

  app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=&gt;</span>
  <span>{</span>
    endpoints<span>.</span><span>MapControllers</span><span>(</span><span>)</span><span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>// ...existing code...</span></code></pre><p>Update the existing <code>appSettings<span>.</span>json</code> file and include the settings we got from the Auth0 dashboard before. Those are <em>Domain</em> and API&#39;s <em>Audience</em>.</p><pre><code><span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
      <span>&#34;LogLevel&#34;</span><span>:</span> <span>{</span>
      <span>&#34;Default&#34;</span><span>:</span> <span>&#34;Information&#34;</span><span>,</span>
      <span>&#34;Microsoft&#34;</span><span>:</span> <span>&#34;Warning&#34;</span><span>,</span>
      <span>&#34;Microsoft.Hosting.Lifetime&#34;</span><span>:</span> <span>&#34;Information&#34;</span>
      <span>}</span>
    <span>}</span><span>,</span>
  <span>&#34;AllowedHosts&#34;</span><span>:</span> <span>&#34;*&#34;</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;&lt;domain&gt;&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;https://weatherforecast&#34;</span>
  <span>}</span>
<span>}</span></code></pre><h3 id="RequireScope-policy">RequireScope policy</h3><p>ASP.NET Core does not include any policy out of the box for checking an individual scope in a JWT access token. To overcome this shortcoming, we will create a custom policy. For this purpose, create a new <code>Authorization</code> folder. Then add three new files on it, <code>ScopeHandler<span>.</span>cs</code>, <code>ScopeRequirement<span>.</span>cs</code>, and  <code>AuthorizationPolicyBuilderExtensions<span>.</span>cs</code>. We will discuss the purpose of each one next. </p><p>Add a new file <code>ScopeHandler<span>.</span>cs</code> to the <code>Authorization</code> folder with the following content:</p><pre><code><span>// Api/Authorization/ScopeHandler.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Linq</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>namespace</span> <span>Api<span>.</span>Authorization</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>ScopeHandler</span> <span>:</span>
             <span><span>AuthorizationHandler<span>&lt;</span>ScopeRequirement<span>&gt;</span></span></span>
    <span>{</span>
        <span>protected</span> <span>override</span> <span>Task</span> <span>HandleRequirementAsync</span><span>(</span>
          <span>AuthorizationHandlerContext</span> context<span>,</span>
          <span>ScopeRequirement</span> requirement<span>)</span>
        <span>{</span>
            <span>if</span> <span>(</span>context <span>is</span> <span>null</span><span>)</span>
            <span>{</span>
                <span>throw</span> <span>new</span> <span>ArgumentNullException</span><span>(</span><span>nameof</span><span>(</span>context<span>)</span><span>)</span><span>;</span>
            <span>}</span>

            <span><span>var</span></span> success <span>=</span> context<span>.</span>User<span>.</span>Claims<span>.</span><span>Any</span><span>(</span>c <span>=&gt;</span> c<span>.</span>Type <span>==</span> <span>&#34;scope&#34;</span> <span>&amp;&amp;</span> 
                c<span>.</span>Value<span>.</span><span>Contains</span><span>(</span>requirement<span>.</span>Scope<span>)</span><span>)</span><span>;</span>

            <span>if</span> <span>(</span>success<span>)</span>
                context<span>.</span><span>Succeed</span><span>(</span>requirement<span>)</span><span>;</span>
            
            <span>return</span> Task<span>.</span>CompletedTask<span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><p>The authentication middleware parses the JWT access token and converts each attribute in the token as a claim attached to the current user in context. Our policy handler uses the claim associated with the scope for checking that the expected scope is there (<code>read<span>:</span>weather</code>).</p><p>Every implementation of <code>AuthorizationHandler</code> must be associated with an implementation of <code>IAuthorizationRequirement</code> that describes the authorization requirements for the handler. In our case, the implementation looks as it is described in the following.</p><p>Add the following content in the <code>ScopeRequirement<span>.</span>cs</code> file,</p><pre><code><span>// Api/Authorization/ScopeRequirement.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Linq</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>namespace</span> <span>Api<span>.</span>Authorization</span>
<span>{</span>
    <span>public</span> <span>class</span> <span>ScopeRequirement</span> <span>:</span> <span><span>IAuthorizationRequirement</span></span>
    <span>{</span>
        <span>public</span> <span><span>string</span></span> Scope <span>{</span> <span>get</span><span>;</span> <span>private</span> <span>set</span><span>;</span> <span>}</span>

        <span>public</span> <span>ScopeRequirement</span><span>(</span><span><span>string</span></span> scope<span>)</span>
        <span>{</span>
            Scope <span>=</span> scope<span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><p>It&#39;s a very simple implementation that describes a requirement in terms of a scope. That&#39;s the expected scope in the JWT Access Token.</p><p>Finally, the class <code>AuthorizationPolicyBuilderExtensions<span>.</span>cs</code> includes the <code>RequireScope</code> extension method for injecting the <code>ScopeHandler</code> instance in the <code>Startup<span>.</span>cs</code> class when the policy is configured.</p><pre><code><span>// Api/Authorization/AuthorizationPolicyBuilderExtensions.cs</span>

<span>using</span> <span>Microsoft<span>.</span>AspNetCore<span>.</span>Authorization</span><span>;</span>
<span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>Collections<span>.</span>Generic</span><span>;</span>
<span>using</span> <span>System<span>.</span>Linq</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>namespace</span> <span>Api<span>.</span>Authorization</span>
<span>{</span>
    <span>public</span> <span>static</span> <span>class</span> <span>AuthorizationPolicyBuilderExtensions</span>
    <span>{</span>
        <span>public</span> <span>static</span> <span>AuthorizationPolicyBuilder</span> <span>RequireScope</span><span>(</span><span>this</span> <span>AuthorizationPolicyBuilder</span> builder<span>,</span> <span><span>string</span></span> scope<span>)</span>
        <span>{</span>
            <span>return</span> builder<span>.</span><span>AddRequirements</span><span>(</span><span>new</span> <span>ScopeRequirement</span><span>(</span>scope<span>)</span><span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><h3 id="Require-authentication-in-the-API-controller">Require authentication in the API controller</h3><p>The <code>WeatherForecast</code> controller included in the template allows anonymous calls. We will convert it to require authenticated calls using the <code>Authorize</code> attribute. That attribute will also reference the policy we previously defined in the <code>Startup<span>.</span>cs</code> file.</p><pre><code><span>// Api/Controllers/WeatherForecastController.cs</span>

<span>// ...existing code...</span>

<span>[</span><span><span>ApiController</span></span><span>]</span>
<span>[</span><span><span>Route</span><span><span>(</span><span>&#34;[controller]&#34;</span><span>)</span></span></span><span>]</span>
<span>public</span> <span>class</span> <span>WeatherForecastController</span> <span>:</span> <span><span>ControllerBase</span></span>
<span>{</span>
  <span>[</span><span><span>HttpGet</span></span><span>]</span>
  <span>[</span><span><span>Authorize</span><span><span>(</span><span>&#34;read:weather&#34;</span><span>)</span></span></span><span>]</span>
  <span>public</span> <span>IEnumerable<span>&lt;</span>WeatherForecast<span>&gt;</span></span> <span>Get</span><span>(</span><span>)</span>
  <span>{</span>
    
<span>// ...existing code...</span></code></pre><p>This attribute will do two things,</p><ul><li>It will activate the authorization middleware that will check if the call was authenticated and there is one user identity set in the current execution context.</li><li>It will run the <code>read<span>:</span>weather</code> policy to make sure the user identity contains the required permissions. In our case, it will check the access token includes a scope called <code>read<span>:</span>weather</code>.</li></ul><p>Once we run this project in Visual Studio, the API will only accept authenticated calls with access tokens coming from Auth0.</p><h2 id="Securing-the-React-Application">Securing the React Application</h2><p>So far, we have added all the plumbing code on the backend to enable authentication with Auth0 using OpenID Connect. The backend handles user authentication and configures a cookie that we can share with the React app. We also added a <code>GetUser</code> API that can be used to determine whether the user is authenticated and get basic identity information about them. Let&#39;s now see the needed changes for the React client application.</p><h3 id="React-Context-for-Authentication">React Context for Authentication</h3><p>As authentication is a core concern that we will use across all the components in the React application, it makes sense to make it available as a global context using <a href="https://reactjs.org/docs/context.html" target="_blank" rel="noreferrer noopener">the context pattern</a>. 
Move into <code><span>BFF</span><span>/</span>ClientApp<span>/</span>src</code> folder and create a <code>context</code> folder. Then add a file <code>AuthContext<span>.</span>js</code> to the newly created folder. Paste the following code on the file:</p><pre><code><span>// BFF/ClientApp/src/context/AuthContext.js</span>

<span>import</span> React<span>,</span> <span>{</span> useState<span>,</span> useEffect<span>,</span> useContext <span>}</span> <span>from</span> <span>&#34;react&#34;</span><span>;</span>

<span>export</span> <span>const</span> AuthContext <span>=</span> React<span>.</span><span>createContext</span><span>(</span><span>)</span><span>;</span>
<span>export</span> <span>const</span> <span>useAuth</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>useContext</span><span>(</span>AuthContext<span>)</span><span>;</span>
<span>export</span> <span>const</span> <span>AuthProvider</span> <span>=</span> <span>(</span><span><span>{</span>
    children
<span>}</span></span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>[</span>isAuthenticated<span>,</span> setIsAuthenticated<span>]</span> <span>=</span> <span>useState</span><span>(</span><span>)</span><span>;</span>
    <span>const</span> <span>[</span>user<span>,</span> setUser<span>]</span> <span>=</span> <span>useState</span><span>(</span><span>)</span><span>;</span>
    <span>const</span> <span>[</span>isLoading<span>,</span> setIsLoading<span>]</span> <span>=</span> <span>useState</span><span>(</span><span>false</span><span>)</span><span>;</span>

    <span>const</span> <span>getUser</span> <span>=</span> <span>async</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>const</span> response <span>=</span> <span>await</span> <span>fetch</span><span>(</span><span>&#39;/auth/getUser&#39;</span><span>)</span><span>;</span>
        <span>const</span> json <span>=</span> <span>await</span> response<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>

        <span>setIsAuthenticated</span><span>(</span>json<span>.</span>isAuthenticated<span>)</span><span>;</span>
        <span>setIsLoading</span><span>(</span><span>false</span><span>)</span><span>;</span>
        <span>if</span> <span>(</span>json<span>.</span>isAuthenticated<span>)</span> <span>setUser</span><span>(</span>json<span>.</span>claims<span>)</span><span>;</span>
    <span>}</span>

    <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>getUser</span><span>(</span><span>)</span><span>;</span>
    <span>}</span><span>,</span> <span>[</span><span>]</span><span>)</span><span>;</span>

    <span>const</span> <span>login</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        window<span>.</span>location<span>.</span>href <span>=</span> <span>&#39;/auth/login&#39;</span><span>;</span>
    <span>}</span>

    <span>const</span> <span>logout</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
        window<span>.</span>location<span>.</span>href <span>=</span> <span>&#39;/auth/logout&#39;</span><span>;</span>
    <span>}</span>

    <span>return</span> <span>(</span>
        <span>&lt;</span>AuthContext<span>.</span>Provider
            value<span>=</span><span>{</span><span>{</span>
                isAuthenticated<span>,</span>
                user<span>,</span>
                isLoading<span>,</span>
                login<span>,</span>
                logout
            <span>}</span><span>}</span>
        <span>&gt;</span>
            <span>{</span>children<span>}</span>
        <span>&lt;</span><span>/</span>AuthContext<span>.</span>Provider<span>&gt;</span>
    <span>)</span><span>;</span>
<span>}</span><span>;</span></code></pre><p>This context object provides methods for starting the login and logout handshake with the backend and getting the authenticated user.</p><p>Modify the <code>index<span>.</span>js</code> file to reference this context provider.</p><pre><code><span>// BFF/ClientApp/src/index.js</span>

<span>// ...existing code...</span>

ReactDOM<span>.</span><span>render</span><span>(</span>
    <span>&lt;</span>AuthProvider<span>&gt;</span>
        <span>&lt;</span>BrowserRouter basename<span>=</span><span>{</span>baseUrl<span>}</span><span>&gt;</span>
            <span>&lt;</span>App <span>/</span><span>&gt;</span>
        <span>&lt;</span><span>/</span>BrowserRouter<span>&gt;</span>
    <span>&lt;</span><span>/</span>AuthProvider<span>&gt;</span><span>,</span>
    rootElement<span>)</span><span>;</span>

<span>// ...existing code...</span></code></pre><h3 id="Add-the-login-and-logout-routes">Add the login and logout routes</h3><p>The React Router configuration uses the authentication context to redirect the user to login and logout URLs on the backend. It also forces the user authentication for routes that are protected, such as the one for fetching the weather data. </p><p>To add these protected routes, modify the <code>App<span>.</span>js</code> file to include this code:</p><pre><code><span>// BFF/ClientApp/src/App.js</span>

<span>import</span> <span>{</span> Redirect<span>,</span> Route <span>}</span> <span>from</span> <span>&#39;react-router&#39;</span><span>;</span>
<span>import</span> <span>{</span> Layout <span>}</span> <span>from</span> <span>&#39;./components/Layout&#39;</span><span>;</span>
<span>import</span> <span>{</span> Home <span>}</span> <span>from</span> <span>&#39;./components/Home&#39;</span><span>;</span>
<span>import</span> <span>{</span> FetchData <span>}</span> <span>from</span> <span>&#39;./components/FetchData&#39;</span><span>;</span>
<span>import</span> <span>{</span> useAuth <span>}</span> <span>from</span> <span>&#39;./context/AuthContext&#39;</span><span>;</span>

<span>import</span> <span>&#39;./custom.css&#39;</span>

<span>const</span> <span>App</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>

    <span>const</span> <span>{</span> isAuthenticated<span>,</span> login<span>,</span> logout <span>}</span> <span>=</span> <span>useAuth</span><span>(</span><span>)</span><span>;</span>

    <span>return</span> <span>(</span>
        <span>&lt;</span>Layout<span>&gt;</span>
            <span>&lt;</span>Route exact path<span>=</span><span>&#39;/&#39;</span> component<span>=</span><span>{</span>Home<span>}</span> <span>/</span><span>&gt;</span>
            <span>&lt;</span>Route path<span>=</span><span>&#39;/fetch-data&#39;</span> component<span>=</span><span>{</span>isAuthenticated <span>?</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span> <span>return</span> <span>&lt;</span>FetchData <span>/</span><span>&gt;</span> <span>}</span> <span>:</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span> <span>login</span><span>(</span><span>)</span><span>;</span> <span>return</span> <span>null</span><span>;</span> <span>}</span><span>}</span><span>/</span><span>&gt;</span>
            <span>&lt;</span>Route path<span>=</span><span>&#39;/login&#39;</span> component<span>=</span><span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span> <span>login</span><span>(</span><span>)</span><span>;</span> <span>return</span> <span>null</span> <span>}</span><span>}</span> <span>/</span><span>&gt;</span>
            <span>&lt;</span>Route path<span>=</span><span>&#39;/logout&#39;</span> component<span>=</span><span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span> <span>logout</span><span>(</span><span>)</span><span>;</span> <span>return</span> <span>null</span> <span>}</span><span>}</span><span>&gt;</span><span>&lt;</span><span>/</span>Route<span>&gt;</span>
        <span>&lt;</span><span>/</span>Layout<span>&gt;</span>
    <span>)</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> App<span>;</span></code></pre><p>The <code>fetch<span>-</span>data</code> route, for example, checks if the user is authenticated before returning the <code>FetchData</code> component. If the user is not authenticated, it calls the <code>login</code> function in the authentication context, which ultimately redirects the user to the <code>Login</code> endpoint in the backend.</p><p>Another very common feature in web applications is to make menu options visible or not, depending on the user authentication status.
As we did in the React Router, the same thing can be accomplished for the menu options using the <code>isAuthenticated</code> function from the authentication context.</p><p>So, move to the <code>ClientApp<span>/</span>src<span>/</span>components</code> folder. Then modify the <code>NavMenu<span>.</span>js</code> file to check the authentication status as it is shown below.</p><pre><code><span>// BFF/ClientApp/src/components/NavMenu.js</span>

<span>// ...existing code...</span>

<span>return</span> <span>(</span>
        <span>&lt;</span>header<span>&gt;</span>
            <span>&lt;</span>Navbar className<span>=</span><span>&#34;navbar-expand-sm navbar-toggleable-sm ng-white border-bottom box-shadow mb-3&#34;</span> light<span>&gt;</span>
                <span>&lt;</span>Container<span>&gt;</span>
                    <span>&lt;</span>NavbarBrand tag<span>=</span><span>{</span>Link<span>}</span> to<span>=</span><span>&#34;/&#34;</span><span>&gt;</span>Auth0 Backend For FrontEnd Authentication<span>&lt;</span><span>/</span>NavbarBrand<span>&gt;</span>
                    <span>&lt;</span>NavbarToggler onClick<span>=</span><span>{</span>toggleNavbar<span>}</span> className<span>=</span><span>&#34;mr-2&#34;</span> <span>/</span><span>&gt;</span>
                    <span>&lt;</span>Collapse className<span>=</span><span>&#34;d-sm-inline-flex flex-sm-row-reverse&#34;</span> isOpen<span>=</span><span>{</span><span>!</span>collapsed<span>}</span> navbar<span>&gt;</span>
                        <span>&lt;</span>ul className<span>=</span><span>&#34;navbar-nav flex-grow&#34;</span><span>&gt;</span>
                            <span>&lt;</span>NavItem<span>&gt;</span>
                                <span>&lt;</span>NavLink tag<span>=</span><span>{</span>Link<span>}</span> className<span>=</span><span>&#34;text-dark&#34;</span> to<span>=</span><span>&#34;/&#34;</span><span>&gt;</span>Home<span>&lt;</span><span>/</span>NavLink<span>&gt;</span>
                            <span>&lt;</span><span>/</span>NavItem<span>&gt;</span>
                            <span>&lt;</span>NavItem<span>&gt;</span>
                                <span>&lt;</span>NavLink tag<span>=</span><span>{</span>Link<span>}</span> className<span>=</span><span>&#34;text-dark&#34;</span> to<span>=</span><span>&#34;/fetch-data&#34;</span><span>&gt;</span>Fetch data<span>&lt;</span><span>/</span>NavLink<span>&gt;</span>
                            <span>&lt;</span><span>/</span>NavItem<span>&gt;</span>
                            <span>&lt;</span>NavItem<span>&gt;</span>
                            <span>{</span><span>!</span>isAuthenticated <span>&amp;&amp;</span> <span>&lt;</span>NavItem<span>&gt;</span>
                                <span>&lt;</span>NavLink tag<span>=</span><span>{</span>Link<span>}</span> className<span>=</span><span>&#34;text-dark&#34;</span> to<span>=</span><span>&#34;/login&#34;</span><span>&gt;</span>Login<span>&lt;</span><span>/</span>NavLink<span>&gt;</span>
                            <span>&lt;</span><span>/</span>NavItem<span>&gt;</span><span>}</span>
                            <span>{</span>isAuthenticated <span>&amp;&amp;</span> <span>&lt;</span>NavItem<span>&gt;</span>
                                <span>&lt;</span>NavLink tag<span>=</span><span>{</span>Link<span>}</span> className<span>=</span><span>&#34;text-dark&#34;</span> to<span>=</span><span>&#34;/logout&#34;</span><span>&gt;</span>Logout<span>&lt;</span><span>/</span>NavLink<span>&gt;</span>
                            <span>&lt;</span><span>/</span>NavItem<span>&gt;</span><span>}</span>
                        <span>&lt;</span><span>/</span>ul<span>&gt;</span>
                    <span>&lt;</span><span>/</span>Collapse<span>&gt;</span>
                <span>&lt;</span><span>/</span>Container<span>&gt;</span>
            <span>&lt;</span><span>/</span>Navbar<span>&gt;</span>
        <span>&lt;</span><span>/</span>header<span>&gt;</span>
 <span>)</span><span>;</span>
                             
<span>// ...existing code...</span></code></pre><h3 id="Add-a-component-to-show-user-data">Add a component to show user data</h3><p>The authentication context provides a <code>getUser</code> function in case you want to show the user&#39;s basic data coming from Auth0 on the React application. That function returns a collection of claims about the user&#39;s identity coming from the backend API <code>GetUser</code>. </p><p>The following code shows a component that enumerates those claims.</p><pre><code><span>// BFF/ClientApp/src/components/User.js</span>

<span>import</span> React<span>,</span> <span>{</span> useEffect<span>,</span> useState <span>}</span> <span>from</span> <span>&#39;react&#39;</span><span>;</span>
<span>import</span> <span>{</span> useAuth <span>}</span> <span>from</span> <span>&#39;../context/AuthContext&#39;</span><span>;</span>

<span>export</span> <span>const</span> <span>User</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>

    <span>const</span> <span>{</span> user <span>}</span> <span>=</span> <span>useAuth</span><span>(</span><span>)</span><span>;</span>

    <span>const</span> <span>renderClaimsTable</span> <span>=</span> <span>function</span> <span>(</span><span>claims</span><span>)</span> <span>{</span>
        <span>return</span> <span>(</span>
            <span>&lt;</span>table className<span>=</span><span>&#39;table table-striped&#39;</span> aria<span>-</span>labelledby<span>=</span><span>&#34;tabelLabel&#34;</span><span>&gt;</span>
                <span>&lt;</span>thead<span>&gt;</span>
                    <span>&lt;</span>tr<span>&gt;</span>
                        <span>&lt;</span>th<span>&gt;</span>Type<span>&lt;</span><span>/</span>th<span>&gt;</span>
                        <span>&lt;</span>th<span>&gt;</span>Value<span>&lt;</span><span>/</span>th<span>&gt;</span>
                    <span>&lt;</span><span>/</span>tr<span>&gt;</span>
                <span>&lt;</span><span>/</span>thead<span>&gt;</span>
                <span>&lt;</span>tbody<span>&gt;</span>
                    <span>{</span>claims<span>.</span><span>map</span><span>(</span><span>claim</span> <span>=&gt;</span>
                        <span>&lt;</span>tr key<span>=</span><span>{</span>claim<span>.</span>type<span>}</span><span>&gt;</span>
                            <span>&lt;</span>td<span>&gt;</span><span>{</span>claim<span>.</span>type<span>}</span><span>&lt;</span><span>/</span>td<span>&gt;</span>
                            <span>&lt;</span>td<span>&gt;</span><span>{</span>claim<span>.</span>value<span>}</span><span>&lt;</span><span>/</span>td<span>&gt;</span>
                        <span>&lt;</span><span>/</span>tr<span>&gt;</span>
                    <span>)</span><span>}</span>
                <span>&lt;</span><span>/</span>tbody<span>&gt;</span>
            <span>&lt;</span><span>/</span>table<span>&gt;</span>
        <span>)</span><span>;</span>
    <span>}</span>

    <span>return</span> <span>(</span>
        <span>&lt;</span>div<span>&gt;</span>
            <span>&lt;</span>h1 id<span>=</span><span>&#34;tabelLabel&#34;</span> <span>&gt;</span>User claims<span>&lt;</span><span>/</span>h1<span>&gt;</span>
            <span>&lt;</span>p<span>&gt;</span>This component demonstrates fetching user identity claims <span>from</span> the server<span>.</span><span>&lt;</span><span>/</span>p<span>&gt;</span>
            <span>{</span><span>renderClaimsTable</span><span>(</span>user<span>)</span><span>}</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>)</span><span>;</span>

<span>}</span></code></pre><h2 id="Run-the-Web-Application">Run the Web Application</h2><p>From Visual Studio, click on the Run button but select your project name from the dropdown option instead of &#34;IIS Express&#34;. That will run the application using the Kestrel, the built-in web server included in .NET Core. Kestrel runs on &#34;<a href="https://localhost:5001" target="_blank" rel="noreferrer noopener">https://localhost:5001</a>&#34;, which is the URL we previously configured in Auth0.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1VJBYyC1Z9GUCS5VQRA1dT/4b16fd875e261f2aa17cb968f1f01187/run-bff-application.png" alt="Running your application"/></p><h2 id="About-the-Login-Flow">About the Login Flow</h2><p>Here is what happens when the user authenticates with the application we have built:</p><ul><li>The user clicks on the <em>Log In</em> button and is directed to the <code>Login</code> route.</li><li>The <code>ChallengeResult</code> response tells the ASP.NET authentication middleware to issue a challenge to the authentication handler registered with the Auth0 authentication scheme parameter. The parameter uses the &#34;Auth0&#34; value you passed in the call to <code>AddOpenIdConnect</code> in the <code>Startup</code> class.</li><li>The OIDC handler redirects the user to the Auth0&#39;s <code><span>/</span>authorize</code> endpoint, which displays the <a href="https://auth0.com/docs/universal-login" target="_blank" rel="noreferrer noopener">Universal Login page</a>. The user can log in with their username and password, social provider, or any other identity provider.</li><li>Once the user has logged in, Auth0 calls back to the <code><span>/</span>callback</code> endpoint in your application and passes along an authorization code.</li><li>The OIDC handler intercepts requests made to the <code><span>/</span>callback</code> path.</li><li>The handler looks for the authorization code, which Auth0 sent in the query string.</li><li>The OIDC handler calls the Auth0&#39;s <code><span>/</span>oauth<span>/</span>token</code> endpoint to exchange the authorization code for the user&#39;s ID and access token.</li><li>The OIDC middleware extracts the user information from the claims in the ID token.</li><li>The OIDC middleware returns a successful authentication response and sets a cookie that indicates that the user is authenticated. The cookie contains the claims with the user&#39;s information. The cookie is stored so that the cookie middleware will automatically authenticate the user on any future requests. The OIDC middleware receives no more requests unless it is explicitly challenged.</li><li>The React application uses the authentication context to issue an API call to the <code>GetUser</code> API. This API returns the user claims from the authentication cookie.</li><li>The React application renders the UI Component using the authenticated user&#39;s identity.</li></ul><h2 id="Conclusion">Conclusion</h2><p>The BFF pattern is an ideal solution for authentication if you can afford to pay extra money for a dedicated backend. It will help you avoid headaches when dealing with access tokens and how to keep them safe on your client-side application. The backend will do all the heavy lifting, so that you can focus only on UI/UX concerns in the frontend.</p><p>You can download from <a href="https://github.com/auth0-blog/bff-auth0-dotnet" target="_blank" rel="noreferrer noopener">this GitHub repository</a> the full source code of the sample project built in this article.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 14 Sep 2021 15:04:00 +0000</pubDate>
    </item>
    <item>
      <title>What SMART on FHIR Means for the Future of Healthcare</title>
      <link>https://auth0.com/blog/what-smart-on-fhir-means-for-the-future-of-healthcare/</link>
      <description>SMART on FHIR is poised to transform data interoperability ‚Äî here&#39;s how it will improve healthcare.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Most health systems know that seamless omnichannel customer engagement (a ‚Äúdigital front door‚Äù) is essential in order to deliver the personalized, value-based <a href="https://www2.deloitte.com/us/en/insights/industry/health-care/consumer-health-trends.html" target="_blank" rel="noreferrer noopener">healthcare today‚Äôs consumers expect</a>. In practice, however, implementing this digital front door strategy is challenging for <a href="https://www.healthit.gov/sites/default/files/page/2021-02/Use-of-Certified-Health-IT-and-Methods-to-Enable-Interoperability-by-U.S.-Non-Federal-Acute-Care-Hospitals-2019.pdf" target="_blank" rel="noreferrer noopener">most healthcare systems</a>, due to the <a href="https://www.chiefhealthcareexecutive.com/view/consequences-of-fragmented-healthcare-information-systems" target="_blank" rel="noreferrer noopener">fragmented nature</a> of healthcare information.</p><p>The Substitutable Medical Applications and Reusable Technologies (SMART) platform promises to solve these data fragmentation challenges by standardizing how patient data is accessed and shared. And given SMART‚Äôs inclusion in the <a href="https://www.federalregister.gov/documents/2020/05/01/2020-07419/21st-century-cures-act-interoperability-information-blocking-and-the-onc-health-it-certification" target="_blank" rel="noreferrer noopener">21st Century Cures Act</a>, the platform will become the standard protocol for accessing electronic health records (EHRs) in the near future.</p><p>Below, we explain what SMART means for the healthcare ecosystem and how it will improve both health data interoperability and the value of healthcare technology as a whole.</p><h2 id="What-is-SMART-on-FHIR-">What is SMART on FHIR?</h2><p><a href="https://smarthealthit.org/" target="_blank" rel="noreferrer noopener">SMART</a> is an open-source, standards-based <a href="https://auth0.com/blog/what-is-an-api-how-apis-work-for-non-developers/" target="_blank" rel="noreferrer noopener">API</a> that leverages the <a href="https://auth0.com/intro-to-iam/what-is-oauth-2/" target="_blank" rel="noreferrer noopener">OAuth 2.0</a> standard to provide secure, universal access to EHRs. The SMART platform builds on the existing Fast Health Interoperability Resources (hence the name &#34;SMART on FHIR&#34;).</p><p>Together, these two standards contain everything developers need to build applications that will work anywhere within the healthcare ecosystem:</p><ol start="1"><li><strong>Open standards</strong> for protocols for authentication, authorization, and UI integration that define how to build applications with universal access to EHRs</li><li><strong>Open-source tools and libraries</strong> for developers that make it easier to use SMART standards during application development. The platform also offers a free sandbox that helps developers test their apps before deployment</li><li><strong>An application gallery</strong> that highlights all of the existing healthcare applications and software that currently uses SMART on FHIR&#39;s platform</li></ol><p>The original idea behind SMART was first introduced in <a href="https://www.nejm.org/doi/full/10.1056/NEJMp0900411" target="_blank" rel="noreferrer noopener">an article</a> in the New England Journal of Medicine back in 2009. With the help of federal funding in 2010, SMART developed into the platform it is today, which is currently used by both <a href="https://azure.microsoft.com/en-us/blog/azure-api-for-fhir-moves-to-general-availability/" target="_blank" rel="noreferrer noopener">Microsoft Azure</a> and <a href="https://www.apple.com/ios/health/" target="_blank" rel="noreferrer noopener">Apple</a>.</p><h2 id="How-SMART-Improves-Healthcare-Interoperability-and-Delivery">How SMART Improves Healthcare Interoperability and Delivery</h2><p>SMART improves healthcare interoperability in the same way standard electrical sockets and plugs simplify the process of powering different devices in your home.</p><p>Today, most EHR databases use a proprietary API (their own unique plug and socket configuration). As a result, tech companies have to build a custom connection to each database in order to access medical data. Not only is this costly, but it also hinders the ability of healthcare providers and patients to access their data with the technology that works best for them.</p><p>SMART, on the other hand, provides a standard, universal API for accessing EHRs. Any technology built with SMART works with any EHR database that uses SMART as well. As a result, healthcare technology becomes interchangeable, allowing health systems and patients to access medical data on the applications that best suit their needs, rather than only the ones that work with the EHR database they use.</p><h2 id="How-Improved-Interoperability-Improves-The-Value-of-Healthcare-Technology">How Improved Interoperability Improves The Value of Healthcare Technology</h2><p>Interoperability is valuable for healthcare tech companies because it &#34;ensures [their] innovations can be broadly understood and developed,&#34; as Dave Pickles, Founder and CTO of The Trade Desk, tells <a href="https://www.forbes.com/sites/forbestechcouncil/2019/08/08/interoperability-and-the-future-of-software-development/?sh=2b59504d4767" target="_blank" rel="noreferrer noopener">Forbes</a>. And since SMART improves interoperability, it also encourages healthcare technology innovation.</p><p>For example, SMART decouples the protocols for accessing EHRs from a piece of software itself. So it allows healthcare technology companies to improve their products and services without worrying about how it will impact the way patients and providers access their data. The result is faster development of healthcare applications, which improves the quality of the entire marketplace (and care for consumers) as a whole.</p><p>SMART also simplifies app development for tech companies. Developers no longer need to build custom connections to each EHR database ‚Äî they can develop their apps once using SMART, and those apps will work with any EHR databases built with SMART. As a result, their apps become more useful to a broader audience of health organizations and consumers.</p><h2 id="What-SMART-s-Inclusion-in-the-21st-Century-Cures-Act-Means">What SMART&#39;s Inclusion in the 21st Century Cures Act Means</h2><p>The 21st Century Cures Act (passed in 2016) called for the adoption of a universal API that would &#34;allow individuals to securely and easily access structured electronic health information using smartphone applications.&#34; The Office of the National Coordinator for Health Information Technology‚Äôs (ONC‚Äôs) <a href="https://www.healthit.gov/curesrule/" target="_blank" rel="noreferrer noopener">Final Rule on Interoperability</a> (published in 2020) later named SMART as that universal API.</p><p>For <a href="https://www.healthit.gov/topic/certification-ehrs/about-onc-health-it-certification-program" target="_blank" rel="noreferrer noopener">ONC-certified health IT</a> (primarily government applications), this means SMART&#39;s API is now a requirement. However, since the ONC certification program is voluntary for the private sector, SMART&#39;s API isn&#39;t legally required for companies whose technologies are not used in government applications.</p><p>The Centers For Medicare and Medicaid Services (CMS) also includes policies in their regulations ‚Äúwhich require or encourage payers to implement Application Programming Interfaces (APIs) to improve the electronic exchange of health care data.‚Äù SMART on FHIR is <a href="https://www.cms.gov/Regulations-and-Guidance/Guidance/Interoperability/index" target="_blank" rel="noreferrer noopener">named as the preferred technical standard</a> for doing so, meaning any health system that accepts Medicare or Medicaid must also adopt SMART.</p><h2 id="SMART-on-FHIR-is-a-Must-For-Healthcare-Providers">SMART on FHIR is a Must For Healthcare Providers</h2><p>Given the benefits, as well as its inclusion in the Cures Act, adopting SMART is practically a necessity for any health system. For this reason, major EHR players like <a href="https://smarthealthit.org/an-app-platform-for-healthcare/who-is-using-smart/" target="_blank" rel="noreferrer noopener">Epic, Cerner, and Allscripts</a> are already using SMART.</p><p>However, there are only 58 apps listed on <a href="https://apps.smarthealthit.org/apps/featured" target="_blank" rel="noreferrer noopener">SMART&#39;s App Gallery</a> as of the writing of this article, meaning few companies have incorporated the standard into their tech at this time. As a result, SMART adoption could be a sales advantage for some tech companies.</p><p>Outside of mandates, early adoption of SMART could also help healthcare tech companies ensure their applications become more widely adopted in the long run. Learn more about utilizing SMART on FHIR&#39;s platform, tools, and API <a href="https://smarthealthit.org/developer-resources/" target="_blank" rel="noreferrer noopener">here</a>.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 07 Sep 2021 15:00:00 +0000</pubDate>
    </item>
    <item>
      <title>Testing AWS Chalice Applications</title>
      <link>https://auth0.com/blog/testing-aws-chalice-applications/</link>
      <description>A tutorial to learn how to write unit tests and integration tests for REST APIs in AWS Chalice. Additionally, we will see how to measure test coverage.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> In this tutorial, we will learn how to write unit tests and integration tests with Pytest in AWS Chalice applications. We will also learn how to measure test coverage.</p><h2 id="Introduction">Introduction</h2><p><a href="https://aws.github.io/chalice/" target="_blank" rel="noreferrer noopener">AWS Chalice</a> is a Python-based web micro-framework that leverages on the <a href="https://aws.amazon.com/lambda/" target="_blank" rel="noreferrer noopener">AWS Lambda</a> and <a href="https://aws.amazon.com/api-gateway/" target="_blank" rel="noreferrer noopener">API Gateway</a> services. It is used to create serverless applications. The Chalice experience is <a href="https://flask.palletsprojects.com/en/2.0.x/" target="_blank" rel="noreferrer noopener">Flask</a>-like by way of features like semantics and syntax. For more details on creating and deploying Chalice applications, you can go through the article on <a href="https://auth0.com/blog/how-to-create-crud-rest-api-with-aws-chalice/" target="_blank" rel="noreferrer noopener">how to create CRUD REST API with AWS Chalice</a>.</p><p>When building applications, there is a need to <a href="https://en.wikipedia.org/wiki/Software_testing" target="_blank" rel="noreferrer noopener">test</a> the code to avoid shipping bugs and unstable code. It also saves one a lot of debugging hours and makes deployments less stressful.</p><p>Common forms of tests in software development include:</p><ol start="1"><li><a href="https://en.wikipedia.org/wiki/Unit_testing" target="_blank" rel="noreferrer noopener">Unit test</a>: This tests a particular function, component, or logic in the code. This way, edge cases can easily be identified, isolated, and fixed. Unit tests usually involve inspecting the output of a function against a known or expected output.</li><li><a href="https://en.wikipedia.org/wiki/Integration_testing" target="_blank" rel="noreferrer noopener">Integration Test</a>: examines multiple parts or the entire application in an end-to-end manner. It considers how each function or component works with the other.</li></ol><p>However, Chalice currently provides a test client for just unit tests. Therefore, the integration tests are written in a manner similar to unit tests with no major difference other than the fact that integration tests consist of multiple unit tests.</p><h2 id="Where-to-Write-Tests">Where to Write Tests</h2><p>In Python-based applications, tests are usually housed in <code>test<span>.</span>py</code> files. These are the test files that will import the application logic to be tested.</p><p>Let&#39;s assume we have a simple Chalice application with a folder structure that looks like the following:</p><pre><code>‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ .chalice
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ test.py</code></pre><p>However, as the application becomes bigger, a single <code>test<span>.</span>py</code> file would become bulky and can become difficult to work with. Hence, it is necessary to create a folder of tests called <code>tests</code> and then split the tests into multiple test files inside the test folder.</p><p>Now, we&#39;ll need to create a new folder called <code>tests</code> and an empty <code>__init__<span>.</span>py</code> file inside the folder. The <code>__init__<span>.</span>py</code> will allow Python to recognize the test directory as a package that could be run:</p><pre><code><span>mkdir</span> tests <span>&amp;&amp;</span> <span>cd</span> tests
<span>touch</span> __init__.py</code></pre><p>Now, let&#39;s create a test file for our application inside the test folder:</p><pre><code><span>touch</span> test_unit.py</code></pre><p>Then, the folder structure will look like this:</p><pre><code>‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ .chalice
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ tests
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îî‚îÄ‚îÄ test_unit.py</code></pre><p>We can then create as many test files as we need in the <code>tests</code> folder.</p><h2 id="How-to-Do-Unit-Tests">How to Do Unit Tests</h2><p>Since the release of v.1.17.0, AWS Chalice has shipped with a test client that serves as a test runner to write tests in Chalice applications. We no longer need to set up boilerplates and logic for testing. We only need to import the test client into our test file.</p><p>Let&#39;s assume we have our Chalice application has an <code>app<span>.</span>py</code> file that looks like the following:</p><pre><code><span>from</span> chalice <span>import</span> Chalice

app <span>=</span> Chalice<span>(</span>app_name<span>=</span><span>&#39;chalice-api-sample&#39;</span><span>)</span>


<span>@app<span>.</span>route</span><span>(</span><span>&#39;/&#39;</span><span>)</span>
<span>def</span> <span>index</span><span>(</span><span>)</span><span>:</span>
    <span>return</span> <span>{</span><span>&#39;hello&#39;</span><span>:</span> <span>&#39;world&#39;</span><span>}</span></code></pre><p>Now, we&#39;ll modify the <code>test_unit<span>.</span>py</code> file as follows:</p><pre><code><span>import</span> app
<span>from</span> chalice<span>.</span>test <span>import</span> Client</code></pre><p>In the above code, we have just imported the <code>app<span>.</span>py</code> and the chalice test Client. Let&#39;s add the following test code:</p><pre><code><span>.</span><span>.</span><span>.</span>

<span>def</span> <span>test_index</span><span>(</span><span>)</span><span>:</span>
    <span>with</span> Client<span>(</span>app<span>.</span>app<span>)</span> <span>as</span> client<span>:</span>
        response <span>=</span> client<span>.</span>http<span>.</span>get<span>(</span><span>&#39;/&#39;</span><span>)</span>
        <span>assert</span> response<span>.</span>status_code <span>==</span> <span>200</span>
        <span>assert</span> response<span>.</span>json_body <span>==</span> <span>{</span><span>&#39;hello&#39;</span><span>:</span> <span>&#39;world&#39;</span><span>}</span></code></pre><p>In the above test code:</p><ol start="1"><li>we instantiated the test Client to be used within the context of the particular test function. That implies that whenever we run the test, a test environment with resources and environment variables will be set up and then cleaned up after running the test.</li><li>We made a <code><span>GET</span></code> request via HTTP using the <code>client<span>.</span>http</code> attribute.</li><li>We assert that a <code><span>200</span></code> status code is returned in the response with a JSON response body‚Äî<code><span>{</span><span>&#39;hello&#39;</span><span>:</span> <span>&#39;world&#39;</span><span>}</span></code>.</li></ol><p>We will install <a href="https://docs.pytest.org/en/6.2.x/getting-started.html" target="_blank" rel="noreferrer noopener">Pytest</a> runner to run our test:</p><pre><code>pip <span>install</span> pytest</code></pre><p>Then, we will run with the following command:</p><pre><code>py.test tests/test_unit.py</code></pre><p>We should get a response that looks like the following:</p><pre><code><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span> <span>test</span> session starts <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span>
platform win32 -- Python <span>3.7</span>.7, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: C:<span>\</span>aws-chalice-api-sample
collected <span>1</span> item

tests<span>\</span>test_unit.py <span>.</span>                                                                           <span>[</span><span>100</span>%<span>]</span>

<span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span> <span>1</span> passed <span>in</span> <span>0</span>.11s <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span></code></pre><h3 id="Creating-mocks">Creating mocks</h3><p>We can try to <a href="https://en.wikipedia.org/wiki/Mock_object" target="_blank" rel="noreferrer noopener">mock</a> an external API in order to learn how to <a href="https://docs.python.org/3/library/unittest.mock.html" target="_blank" rel="noreferrer noopener">test with mock variables</a>. We will test a request from our app to an endpoint of <a href="https://jsonplaceholder.typicode.com/" target="_blank" rel="noreferrer noopener">JSONPlaceholder</a> API data service to get a list of dummy posts. Firstly, let us install the Python requests module:</p><pre><code>pip <span>install</span> requests</code></pre><p>Then, let&#39;s add a function inside <code>app<span>.</span>py</code> file to make a <code><span>GET</span></code> request to the <code><span>/</span>post</code> endpoint of JSONPlaceholder and return a list of posts:</p><pre><code><span>.</span><span>.</span><span>.</span>
<span>import</span> requests

<span>@app<span>.</span>route</span><span>(</span><span>&#39;/post&#39;</span><span>)</span>
<span>def</span> <span>get_post</span><span>(</span><span>)</span><span>:</span>
    response <span>=</span> requests<span>.</span>get<span>(</span><span>&#34;https://jsonplaceholder.typicode.com/posts/1&#34;</span><span>)</span>
    <span>if</span> response<span>.</span>ok<span>:</span>
        <span>return</span> response<span>.</span>json<span>(</span><span>)</span>
    <span>else</span><span>:</span>
        <span>return</span> <span>None</span>
<span>.</span><span>.</span><span>.</span></code></pre><p>In the above code, we wrote a function called <code>get_post</code> that makes an HTTP request to the DummyAPI server and returns the response of the request in JSON form.</p><p>So, we&#39;ll add a mock inside the <code>test_unit<span>.</span>py</code> file:</p><pre><code><span>.</span><span>.</span><span>.</span>
<span>from</span> unittest<span>.</span>mock <span>import</span> patch

<span>.</span><span>.</span><span>.</span>

<span>@patch</span><span>(</span><span>&#39;app.requests.get&#39;</span><span>)</span>
<span>def</span> <span>test_get_post</span><span>(</span>mock_get<span>)</span><span>:</span>
    <span>&#34;&#34;&#34;Mocking with the patch decorator to get a post from an External API&#34;&#34;&#34;</span>
    mock_get<span>.</span>return_value<span>.</span>ok <span>=</span> <span>True</span>
    response <span>=</span> app<span>.</span>get_post<span>(</span><span>)</span>
    <span>assert</span> response<span>.</span>ok</code></pre><p>In the above code, we imported the patch function of the mock module. Then, we defined the patch function as a decorator with reference to the project&#39;s <code>request<span>.</span>get</code>. Then, we created a function called <code>test_get_post</code> with a parameter called <code>mock_get</code> to test the <code>get_post</code> function inside the <code>app<span>.</span>py</code> file. If the returned status of <code>mock_get</code> is <code>ok</code>, then a fake request to the JSONPlaceholder is made, after which an assertion of the status code of the response to the request is made. We ensured that the mock acts like it is making a real <code>request<span>.</span>get</code> request to the JSONPlaceholder server, whereas it is a fake request. This allows us to test our code without dependence on the JSONPlaceholder external API server. </p><p>If we run our test again with the following bash command:</p><pre><code>py.test tests/test_unit.py</code></pre><p>We should get an output similar to the following:</p><pre><code><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span> <span>test</span> session starts <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span>
platform win32 -- Python <span>3.7</span>.7, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: C:<span>\</span>aws-chalice-api-sample
plugins: cov-2.12.1
collected <span>2</span> items

tests<span>\</span>unit<span>\</span>test_unit.py <span>..</span>                                                                     <span>[</span><span>100</span>%<span>]</span>

<span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span> <span>2</span> passed <span>in</span> <span>0</span>.85s <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span></code></pre><p>How can we test when the desired response is not returned? That&#39;s why we have an <code><span>else</span></code> statement in the <code><span>get_post</span><span>(</span><span>)</span></code> function inside the <code>app<span>.</span>py</code> file, right? To accommodate situations when no post is returned when we request for a post from JSONPlaceholder. Therefore, we will add a test that will check when no post is returned. Let&#39;s add the following code in the <code>test_unit<span>.</span>py</code> file:</p><pre><code><span>.</span><span>.</span><span>.</span>
<span>@patch</span><span>(</span><span>&#39;app.requests.get&#39;</span><span>)</span>
<span>def</span> <span>test_no_get_post</span><span>(</span>mock_get<span>)</span><span>:</span>
    <span>&#34;&#34;&#34;Mock testing to check when no post is returned&#34;&#34;&#34;</span>
    mock_get<span>.</span>return_value<span>.</span>ok <span>=</span> <span>False</span>
    response <span>=</span> app<span>.</span>get_post<span>(</span><span>)</span>
    <span>assert</span> response <span>==</span> <span>None</span></code></pre><p>In the above file, we asked the test to check if the returned value of the mock <code><span>GET</span></code> request is not <code>ok</code> in the line <code>mock_get<span>.</span>return_value<span>.</span>ok <span>=</span> False</code>. We also asserted that a <code>None</code> response is returned. So, we have been able to handle situations where a post is not returned.</p><p>We can then run the <code>test_unit<span>.</span>py</code> file again as thus:</p><pre><code>py.test tests/test_unit.py</code></pre><p>We will get the following output:</p><pre><code><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span> <span>test</span> session starts <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span> 
platform win32 -- Python <span>3.7</span>.7, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: <span>\</span>aws-chalice-api-sample
plugins: cov-2.12.1
collected <span>3</span> items

tests<span>\</span>unit<span>\</span>test_unit.py <span>..</span>.                                                                    <span>[</span><span>100</span>%<span>]</span> 

<span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span> <span>3</span> passed <span>in</span> <span>0</span>.17s <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span></code></pre><p>Cool!</p><p>The full code of the <code>test_unit<span>.</span>py</code> file is thus:</p><pre><code><span>from</span> unittest<span>.</span>mock <span>import</span> patch
<span>import</span> app
<span>from</span> chalice<span>.</span>test <span>import</span> Client
<span>import</span> json


<span>def</span> <span>test_index</span><span>(</span><span>)</span><span>:</span>
    <span>with</span> Client<span>(</span>app<span>.</span>app<span>)</span> <span>as</span> client<span>:</span>
        response <span>=</span> client<span>.</span>http<span>.</span>get<span>(</span><span>&#39;/&#39;</span><span>)</span>
        <span>assert</span> response<span>.</span>status_code <span>==</span> <span>200</span>
        <span>assert</span> response<span>.</span>json_body <span>==</span> <span>{</span><span>&#39;hello&#39;</span><span>:</span> <span>&#39;world&#39;</span><span>}</span>

<span>@patch</span><span>(</span><span>&#39;app.requests.get&#39;</span><span>)</span>
<span>def</span> <span>test_get_post</span><span>(</span>mock_get<span>)</span><span>:</span>
    <span>&#34;&#34;&#34;Mocking with the patch decorator to get a post from an External API&#34;&#34;&#34;</span>
    mock_get<span>.</span>return_value<span>.</span>ok <span>=</span> <span>True</span>
    response <span>=</span> app<span>.</span>get_post<span>(</span><span>)</span>
    <span>assert</span> response<span>.</span>ok

<span>@patch</span><span>(</span><span>&#39;app.requests.get&#39;</span><span>)</span>
<span>def</span> <span>test_no_get_post</span><span>(</span>mock_get<span>)</span><span>:</span>
    <span>&#34;&#34;&#34;Mock testing to check when no post is returned&#34;&#34;&#34;</span>
    mock_get<span>.</span>return_value<span>.</span>ok <span>=</span> <span>False</span>
    response <span>=</span> app<span>.</span>get_post<span>(</span><span>)</span>
    <span>assert</span> response <span>==</span> <span>None</span></code></pre><h2 id="How-to-Write-Integration-Tests">How to Write Integration Tests</h2><p>Integration tests check multiple components to see if they work together. These tests are usually written like unit tests, but they involve verifying multiple parts of the application at once. An integration test might require establishing a network connection, setting up a database, etc. These can be configured as fixtures. Fixtures are functions that set up the initial states/environment that you can create in your tests once and use multiple times.</p><p>It is a good habit to separate unit tests from integration tests by putting them in separate folders. Hence, we will create two folders inside the <code>test</code> directory and call them <code>unit</code> and <code>integration</code>, respectively. Then,</p><ul><li>we will move the <code>test_unit<span>.</span>py</code> file into the <code>unit</code> folder.</li><li>also, we will create a new <code>test_integration<span>.</span>py</code> file in the <code>integration</code> folder</li><li>next, we will create a <code>conftest<span>.</span>py</code> file in the <code>test</code> folder to house our fixtures.</li></ul><p>So, the folder structure will look like the following:</p><pre><code>‚îú‚îÄ‚îÄ app.py
‚îú‚îÄ‚îÄ .chalice
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ tests
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ conftest.py
    ‚îú‚îÄ‚îÄ unit/
    ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
    ‚îÇ   ‚îî‚îÄ‚îÄ test_unit.py
    ‚îÇ
    ‚îî‚îÄ‚îÄ integration/
        ‚îú‚îÄ‚îÄ __init__.py
        ‚îî‚îÄ‚îÄ test_integration.py</code></pre><p>To start with, we will create a fixture called <code>app</code>. This fixture will be the instance of our Chalice application. Let&#39;s go to the <code>conftest<span>.</span>py</code> file and change it thus:</p><pre><code><span>import</span> pytest
<span>from</span> chalice <span>import</span> Chalice
<span>import</span> app <span>as</span> chalice_app
<span>from</span> chalice<span>.</span>test <span>import</span> Client


<span>@pytest<span>.</span>fixture</span>
<span>def</span> <span>app</span><span>(</span><span>)</span> <span>-</span><span>&gt;</span> Chalice<span>:</span>
    <span>return</span> chalice_app


<span>@pytest<span>.</span>fixture</span>
<span>def</span> <span>test_client</span><span>(</span><span>)</span><span>:</span>
    <span>with</span> Client<span>(</span>chalice_app<span>.</span>app<span>)</span> <span>as</span> client<span>:</span>
        <span>yield</span> client</code></pre><p>In the code above, we&#39;ve abstracted an instance of our Chalice application as a fixture. We also created a fixture for our test client.</p><p>Going forward, let&#39;s assume that we have set up a REST API for a bookshelf application in the <code>app<span>.</span>py</code> with CRUD endpoints like the following:</p><pre><code><span>.</span><span>.</span><span>.</span>

<span># POST endpoint to add books to the bookshelf</span>

<span>@app<span>.</span>route</span><span>(</span><span>&#39;/book&#39;</span><span>,</span> methods<span>=</span><span>[</span><span>&#39;POST&#39;</span><span>]</span><span>)</span>
<span>def</span> <span>create_book</span><span>(</span><span>)</span><span>:</span>
    book_as_json <span>=</span> app<span>.</span>current_request<span>.</span>json_body
    <span>try</span><span>:</span>
        Item <span>=</span> <span>{</span>
            <span>&#39;id&#39;</span><span>:</span> book_as_json<span>[</span><span>&#39;id&#39;</span><span>]</span><span>,</span>
            <span>&#34;title&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;title&#39;</span><span>]</span><span>,</span>
            <span>&#34;author&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;author&#39;</span><span>]</span>
        <span>}</span>
        <span>return</span> <span>{</span><span>&#34;id&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;id&#39;</span><span>]</span><span>,</span> <span>&#34;title&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;title&#39;</span><span>]</span><span>,</span> <span>&#34;author&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;author&#39;</span><span>]</span><span>}</span>
    <span>except</span> Exception <span>as</span> e<span>:</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>str</span><span>(</span>e<span>)</span><span>}</span>


<span># PUT endpoint to update a book item based on the given ID</span>

<span>@app<span>.</span>route</span><span>(</span><span>&#39;/book/{id}&#39;</span><span>,</span> methods<span>=</span><span>[</span><span>&#39;PUT&#39;</span><span>]</span><span>)</span>
<span>def</span> <span>update_book</span><span>(</span><span>id</span><span>)</span><span>:</span>
    book_as_json <span>=</span> app<span>.</span>current_request<span>.</span>json_body
    <span>try</span><span>:</span>
        Item <span>=</span> <span>{</span>
            <span>&#34;id&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;id&#39;</span><span>]</span><span>,</span>
            <span>&#34;title&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;title&#39;</span><span>]</span><span>,</span>
        <span>}</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>&#39;ok - UPDATED&#39;</span><span>,</span> <span>&#39;status&#39;</span><span>:</span> <span>201</span><span>}</span>
    <span>except</span> Exception <span>as</span> e<span>:</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>str</span><span>(</span>e<span>)</span><span>}</span>


<span># DELETE endpoint to delete a particular book based on the given ID</span>

<span>@app<span>.</span>route</span><span>(</span><span>&#39;/book/{id}&#39;</span><span>,</span> methods<span>=</span><span>[</span><span>&#39;DELETE&#39;</span><span>]</span><span>)</span>
<span>def</span> <span>delete_book</span><span>(</span><span>id</span><span>)</span><span>:</span>
    book_as_json <span>=</span> app<span>.</span>current_request<span>.</span>json_body
    <span>try</span><span>:</span>
        Item <span>=</span> <span>{</span>
            <span>&#34;id&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;id&#39;</span><span>]</span><span>,</span>
            <span>&#34;author&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;author&#39;</span><span>]</span>
        <span>}</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>&#39;ok - DELETED&#39;</span><span>,</span> <span>&#39;status&#39;</span><span>:</span> <span>201</span><span>}</span>
    <span>except</span> Exception <span>as</span> e<span>:</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>str</span><span>(</span>e<span>)</span><span>}</span></code></pre><p>The code above consists of:</p><ul><li><code><span>add_book</span><span>(</span><span>)</span></code>: function for <code><span>POST</span></code> method to add books to the catalog</li><li><code><span>update_book</span><span>(</span>id</code>: uses the <code><span>UPDATE</span></code> method to update a specified book entry with a new title</li><li><code><span>delete_book</span><span>(</span>id<span>)</span></code>: deletes a particular book entry from the catalog</li></ul><p>Now, we can write tests for them using the Chalice <a href="https://aws.github.io/chalice/api.html#Client.http" target="_blank" rel="noreferrer noopener">TestHTTPClient class</a> inside the <code>test_integration<span>.</span>py</code> file like the following:</p><pre><code><span>import</span> json

<span>#  test for the create_book endpoint</span>
<span>def</span> <span>test_add_book</span><span>(</span>test_client<span>)</span><span>:</span>
    response <span>=</span> test_client<span>.</span>http<span>.</span>post<span>(</span>
        <span>&#39;/book&#39;</span><span>,</span>
        headers<span>=</span><span>{</span><span>&#39;Content-Type&#39;</span><span>:</span> <span>&#39;application/json&#39;</span><span>}</span><span>,</span>
        body<span>=</span>json<span>.</span>dumps<span>(</span>
            <span>{</span>
                <span>&#34;id&#34;</span><span>:</span> <span>&#34;123&#34;</span><span>,</span>
                <span>&#34;title&#34;</span><span>:</span> <span>&#34;Javascript Know It All&#34;</span><span>,</span>
                <span>&#34;author&#34;</span><span>:</span> <span>&#34;Chukwuma Obinna&#34;</span><span>,</span>
            <span>}</span><span>)</span>
    <span>)</span>
    <span>assert</span> response<span>.</span>json_body <span>==</span> <span>{</span>
        <span>&#34;id&#34;</span><span>:</span> <span>&#34;123&#34;</span><span>,</span>
        <span>&#34;title&#34;</span><span>:</span> <span>&#34;Javascript Know It All&#34;</span><span>,</span>
        <span>&#34;author&#34;</span><span>:</span> <span>&#34;Chukwuma Obinna&#34;</span>
    <span>}</span>


<span>#  test for the update_book endpoint</span>
<span>def</span> <span>test_update_book</span><span>(</span>test_client<span>)</span><span>:</span>
    response <span>=</span> test_client<span>.</span>http<span>.</span>put<span>(</span>
        <span>&#39;/book/{id}&#39;</span><span>,</span>
        headers<span>=</span><span>{</span><span>&#39;Content-Type&#39;</span><span>:</span> <span>&#39;application/json&#39;</span><span>}</span><span>,</span>
        body<span>=</span>json<span>.</span>dumps<span>(</span>
            <span>{</span>
                <span>&#34;id&#34;</span><span>:</span> <span>&#34;123&#34;</span><span>,</span>
                <span>&#34;title&#34;</span><span>:</span> <span>&#34;Chalice Book&#34;</span><span>,</span>
            <span>}</span><span>)</span>
    <span>)</span>
    <span>assert</span> response<span>.</span>json_body <span>==</span> <span>{</span>
        <span>&#34;message&#34;</span><span>:</span> <span>&#34;ok - UPDATED&#34;</span><span>,</span>
        <span>&#34;status&#34;</span><span>:</span> <span>201</span>
    <span>}</span>


<span>#  test for the delete_book endpoint</span>
<span>def</span> <span>test_delete_book</span><span>(</span>test_client<span>)</span><span>:</span>
    response <span>=</span> test_client<span>.</span>http<span>.</span>delete<span>(</span><span>&#39;/book/{id}&#39;</span><span>,</span>
         headers<span>=</span><span>{</span><span>&#39;Content-Type&#39;</span><span>:</span> <span>&#39;application/json&#39;</span><span>}</span><span>,</span>
         body<span>=</span>json<span>.</span>dumps<span>(</span>
              <span>{</span>
                    <span>&#34;id&#34;</span><span>:</span> <span>&#34;123&#34;</span><span>,</span>
                    <span>&#34;author&#34;</span><span>:</span> <span>&#34;Chukwuma Obinna&#34;</span><span>,</span>
              <span>}</span><span>)</span>
    <span>)</span>
    <span>assert</span> response<span>.</span>json_body <span>==</span> <span>{</span>
        <span>&#34;message&#34;</span><span>:</span> <span>&#34;ok - DELETED&#34;</span><span>,</span>
        <span>&#34;status&#34;</span><span>:</span> <span>201</span>
    <span>}</span></code></pre><p>In the above code:</p><ul><li>We wrote the tests for each of our CRUD endpoints.</li><li>In each test function, we used the <code>test_client</code> that we defined as a fixture earlier on in the <code>conftest<span>.</span>py</code> file.</li><li>defined the header and body to be passed in each test request</li><li>We asserted known responses to the test requests</li></ul><p>Note: the database functionality is not included in the API used in order to simplify the example. Otherwise, we would have to write a fixture to setup a mock database for the integration test.</p><p>To run the above test, we&#39;d use the following command:</p><pre><code>py.test tests/test_integration.py</code></pre><p>We should get a response that looks like the following:</p><pre><code><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span> <span>test</span> session starts <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span>
platform win32 -- Python <span>3.7</span>.7, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
cachedir: .pytest_cache
rootdir: C:<span>\</span>aws-chalice-api-sample
collected <span>4</span> items

tests/integration/test_integration.py::test_index PASSED                                     <span>[</span> <span>25</span>%<span>]</span>
tests/integration/test_integration.py::test_add_book PASSED                                  <span>[</span> <span>50</span>%<span>]</span>
tests/integration/test_integration.py::test_update_book PASSED                               <span>[</span> <span>75</span>%<span>]</span>
tests/integration/test_integration.py::test_delete_book PASSED                               <span>[</span><span>100</span>%<span>]</span>

<span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span> <span>4</span> passed <span>in</span> <span>1</span>.01s <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span></code></pre><p>Generally, integration tests usually take a longer time to run than unit tests. Therefore, it is advisable to not run them every time but whenever one needs to deploy.</p><p>The full code of the <code>app<span>.</span>py</code> file is thus:</p><pre><code><span>from</span> requests<span>.</span>models <span>import</span> Response
<span>from</span> chalice <span>import</span> Chalice
<span>import</span> requests
<span>import</span> json

app <span>=</span> Chalice<span>(</span>app_name<span>=</span><span>&#39;aws-chalice-api-sample&#39;</span><span>)</span>


<span>@app<span>.</span>route</span><span>(</span><span>&#39;/&#39;</span><span>)</span>
<span>def</span> <span>index</span><span>(</span><span>)</span><span>:</span>
    <span>return</span> <span>{</span><span>&#39;hello&#39;</span><span>:</span> <span>&#39;world&#39;</span><span>}</span>

<span># Function to make External API Call</span>
<span>@app<span>.</span>route</span><span>(</span><span>&#39;/post&#39;</span><span>)</span>
<span>def</span> <span>get_post</span><span>(</span><span>)</span><span>:</span>
    response <span>=</span> requests<span>.</span>get<span>(</span><span>&#34;https://jsonplaceholder.typicode.com/posts/1&#34;</span><span>)</span>
    <span>if</span> response<span>.</span>ok<span>:</span>
        <span>return</span> response<span>.</span>json<span>(</span><span>)</span>
    <span>else</span><span>:</span>
        <span>return</span> <span>None</span>

<span># Function to make POST request to create a book</span>
@ app<span>.</span>route<span>(</span><span>&#39;/book&#39;</span><span>,</span> methods<span>=</span><span>[</span><span>&#39;POST&#39;</span><span>]</span><span>)</span>
<span>def</span> <span>create_book</span><span>(</span><span>)</span><span>:</span>

    book_as_json <span>=</span> app<span>.</span>current_request<span>.</span>json_body
    <span>try</span><span>:</span>
        Item <span>=</span> <span>{</span>
            <span>&#39;id&#39;</span><span>:</span> book_as_json<span>[</span><span>&#39;id&#39;</span><span>]</span><span>,</span>
            <span>&#34;title&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;title&#39;</span><span>]</span><span>,</span>
            <span>&#34;author&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;author&#39;</span><span>]</span>
        <span>}</span>
        <span>return</span> <span>{</span><span>&#34;id&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;id&#39;</span><span>]</span><span>,</span> <span>&#34;title&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;title&#39;</span><span>]</span><span>,</span> <span>&#34;author&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;author&#39;</span><span>]</span><span>}</span>
    <span>except</span> Exception <span>as</span> e<span>:</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>str</span><span>(</span>e<span>)</span><span>}</span>

<span># Function to make POST request to update a book</span>
<span>@app<span>.</span>route</span><span>(</span><span>&#39;/book/{id}&#39;</span><span>,</span> methods<span>=</span><span>[</span><span>&#39;PUT&#39;</span><span>]</span><span>)</span>
<span>def</span> <span>update_book</span><span>(</span><span>id</span><span>)</span><span>:</span>
    book_as_json <span>=</span> app<span>.</span>current_request<span>.</span>json_body
    <span>try</span><span>:</span>
        Item <span>=</span> <span>{</span>
            <span>&#34;id&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;id&#39;</span><span>]</span><span>,</span>
            <span>&#34;title&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;title&#39;</span><span>]</span><span>,</span>
        <span>}</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>&#39;ok - UPDATED&#39;</span><span>,</span> <span>&#39;status&#39;</span><span>:</span> <span>201</span><span>}</span>
    <span>except</span> Exception <span>as</span> e<span>:</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>str</span><span>(</span>e<span>)</span><span>}</span>

<span># Function to make POST request to delete a particular book a book</span>
<span>@app<span>.</span>route</span><span>(</span><span>&#39;/book/{id}&#39;</span><span>,</span> methods<span>=</span><span>[</span><span>&#39;DELETE&#39;</span><span>]</span><span>)</span>
<span>def</span> <span>delete_book</span><span>(</span><span>id</span><span>)</span><span>:</span>
    book_as_json <span>=</span> app<span>.</span>current_request<span>.</span>json_body
    <span>try</span><span>:</span>
        Item <span>=</span> <span>{</span>
            <span>&#34;id&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;id&#39;</span><span>]</span><span>,</span>
            <span>&#34;author&#34;</span><span>:</span> book_as_json<span>[</span><span>&#39;author&#39;</span><span>]</span>
        <span>}</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>&#39;ok - DELETED&#39;</span><span>,</span> <span>&#39;status&#39;</span><span>:</span> <span>201</span><span>}</span>
    <span>except</span> Exception <span>as</span> e<span>:</span>
        <span>return</span> <span>{</span><span>&#39;message&#39;</span><span>:</span> <span>str</span><span>(</span>e<span>)</span><span>}</span></code></pre><h2 id="Measuring-Code-Coverage">Measuring Code Coverage</h2><p><a href="https://en.wikipedia.org/wiki/Code_coverage" target="_blank" rel="noreferrer noopener">Code coverage</a> is simply a means of quantifying how much of our code is being tested. We will use <a href="https://pypi.org/project/pytest-cov/" target="_blank" rel="noreferrer noopener">pytest-cov</a> package to measure test coverage in this tutorial. It is a tool built off the <a href="https://coverage.readthedocs.io/en/coverage-5.5/" target="_blank" rel="noreferrer noopener">coverage.py</a> tool used in measuring coverage in Python code. Fortunately, pytest-cov works well with pytest.</p><p>Let&#39;s install pytest-cov:</p><pre><code>pip <span>install</span> pytest-cov</code></pre><p>Let&#39;s measure the test coverage by using the <code><span>-</span>cov</code> argument with pytest. We will measure the coverage over our source code in the <code>app<span>.</span>py</code> file:</p><pre><code>pytest --cov<span>=</span>app  --cov-report term-missing</code></pre><p>We used the <code><span>--</span>cov<span>-</span>report</code> <code>term<span>-</span>missing</code> command to specify that we want our coverage report to indicate the lines of code that are not covered by our tests.</p><p>We will get a terminal output that looks like this:</p><pre><code><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span> <span>test</span> session starts <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>=</span>
platform win32 -- Python <span>3.7</span>.7, pytest-6.2.4, py-1.10.0, pluggy-0.13.1
rootdir: <span>\</span>aws-chalice-api-sample
plugins: cov-2.12.1
collected <span>7</span> items

tests<span>\</span>integration<span>\</span>test_integration.py <span>..</span><span>..</span>                                                    <span>[</span> <span>57</span>%<span>]</span> 
tests<span>\</span>unit<span>\</span>test_unit.py <span>..</span>.                                                                   <span>[</span><span>100</span>%<span>]</span> 

----------- coverage: platform win32, python <span>3.7</span>.7-final-0 -----------
Name     Stmts   Miss  Cover   Missing
--------------------------------------
app.py      <span>33</span>      <span>6</span>    <span>82</span>%   <span>46</span>-47, <span>59</span>-60, <span>72</span>-73
--------------------------------------
TOTAL       <span>33</span>      <span>6</span>    <span>82</span>%

<span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span> <span>7</span> passed <span>in</span> <span>2</span>.16s <span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span><span>==</span></code></pre><p>Note: The 6 missed exception statements in lines 46-47, 59-60, and 72-73 above are in the <code>app<span>.</span>py</code> file. The missing seemed to occur while running as a result of a pytest <a href="https://github.com/nedbat/coveragepy/issues/605" target="_blank" rel="noreferrer noopener">error</a>.</p><h2 id="Conclusion">Conclusion</h2><p>In this article, we have considered how to run unit and integration tests in Chalice applications and APIs. We also learned how to use Pytest for testing and Pytest-cov for measuring code coverage. We can now go ahead and build <a href="https://developer.ibm.com/devpractices/software-development/articles/5-steps-of-test-driven-development/" target="_blank" rel="noreferrer noopener">test-driven</a> Chalice applications with the knowledge gained.
Thanks for following through. We&#39;d be glad to have your thoughts and suggestions in the comment section. Thanks.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 06 Sep 2021 14:48:00 +0000</pubDate>
    </item>
    <item>
      <title>Welcome to the New Auth0 Careers Hub</title>
      <link>https://auth0.com/blog/welcome-to-the-new-auth0-careers-hub/</link>
      <description>Our redefined destination for exploring what makes Auth0 a great place to work.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>At Auth0, our core philosophy is based on the principles of collaboration, experimentation, learning, transparency, and passion. Our culture revolves around our core values, and we want to recruit others who share the same beliefs and passion for what we do. In that spirit, we are excited to present our new Auth0 Careers Hub.</p><p>More than just a refresh, our team set out to create new pages to reflect our brand, include a larger emphasis on diversity and inclusion, and share real stories from our employees. Our message with this new launch is that here at Auth0, we invest in a culture of inclusion where every Auziro can show up as their authentic self.</p><h2 id="Real-Stories-from-Real-Employees">Real Stories from Real Employees</h2><p>What better way to showcase our culture authentically than through stories from Auziros themselves? With a new page dedicated to Life at Auth0, highlighting our Employee Resource Groups, global, remote-friendly culture, and more, we showcase more than 60 stories from employees that highlight how we live and breathe our values. Hear from our teams on how we make remote work really work for our Auziros ‚Äî from team meetings to performance reviews.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2iKl8xMHCzupRhjLbiujWz/a438b6f175a642b99c198cf2011a88d6/careers_blogpost_02.jpg" alt="Real Stories from Real Employees"/></p><h2 id="A-Transparent-Recruiting-Process">A Transparent Recruiting Process</h2><p>Throughout the design process, we kept all candidate personas in mind when crafting the new content flow and structures. No matter which position a candidate may be looking for, we strive to provide clarity into our process and programs for those interested in learning more before embarking on this journey ‚Äî so there are no surprises along the way.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Sg9MZoRU09PtJAw6DKZxt/86593684a762e53ca71938c1c3d6c09e/careers_blogpost_03.png" alt="A Transparent Recruiting Process"/></p><h2 id="One-Team--One-Score">One Team, One Score</h2><p>Like everything we do, this refresh was truly an embodiment of our core values in the amazing collaboration that was crucial in bringing this to life. And as we <a href="https://auth0.com/blog/okta-acquisition-announcement/" target="_blank" rel="noreferrer noopener">heard from Eugenio</a> on the recent Okta acquisition, the Auth0 brand and product will continue to be part of the larger strategy, and hiring will always be an important focus. We hope this will resonate with all future Auziros that have yet to join our amazing team. </p><p>If this sounds like you, <a href="https://auth0.com/careers" target="_blank" rel="noreferrer noopener">check out our careers hub</a> and help us make the internet safer.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 02 Sep 2021 21:02:00 +0000</pubDate>
    </item>
    <item>
      <title>State Pattern in Python</title>
      <link>https://auth0.com/blog/state-pattern-in-python/</link>
      <description>Learn to implement state pattern and finite state machines using Python.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><a href="https://en.wikipedia.org/wiki/Software_design_pattern" target="_blank" rel="noreferrer noopener">Design patterns</a> are conventional solutions to common challenges in software development using <a href="https://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank" rel="noreferrer noopener">Object-oriented programming</a>. One of the famous design patterns for developing scalable and flexible software is the state pattern. You&#39;ll learn about the state pattern and how to apply it to improve your software project in this article.</p><h2 id="Finite-State-Machine">Finite State Machine</h2><p>Let&#39;s define a <a href="https://en.wikipedia.org/wiki/Finite-state_machine" target="_blank" rel="noreferrer noopener">finite state machine</a> (FSM) before moving on to the state design pattern. It is well known that the concepts of state patterns and finite-state machines have a close relationship. An FSM is something that behaves differently depending on its internal state. In computer programming, the behavior of an object in an application varies depending on its state. A switch and a lightbulb are simple examples of FSM. &#34;ON&#34; and &#34;OFF&#34; are the two possible states of the light bulb. To change the state of the bulb &#39;ON&#39; or &#39;OFF&#39;, simply flip the switch. Transition is the process of moving from one state to another. Transition is affected by several factors. In the case of the light bulb, it is dependent on the input from the switch. The state diagram, which is shown below, graphically depicts the states and transitions.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6Y4Ljm8KBa45GF54np9a8i/b5bff5c1cf9b5a8ead644a110f9db059/01_bulb_state_diagram.png" alt="light bulb state diagram"/></p><p>We can implement the state machine using any programming language. Depending on a few factors, our code behaves differently. You can implement the preceding light bulb example as follows:</p><pre><code><span>class</span> <span>LightBulb</span><span>:</span>
  _state <span>=</span> <span>&#39;OFF&#39;</span>    <span># initial state of bulb</span>
  
  <span>def</span> <span>onOff</span><span>(</span>self<span>,</span> switch<span>)</span><span>:</span>
    <span>if</span> switch <span>==</span> <span>&#39;ON&#39;</span><span>:</span>
        self<span>.</span>_state <span>=</span> <span>&#39;ON&#39;</span>
    <span>elif</span> switch <span>==</span> <span>&#39;OFF&#39;</span><span>:</span>
        self<span>.</span>_state <span>=</span> <span>&#39;OFF&#39;</span>
    <span>else</span><span>:</span>
        <span>continue</span>          <span># if we get wrong input</span></code></pre><p>For small systems, such as the one described above, the code appears to be straightforward and simple. However, if there are many states and transitions, our code will get flabby with conditional statements. The code becomes more extensive, and it won&#39;t be easy to maintain the application. If you want to add additional states or transitions to the program, you&#39;ll have to change the entire code base. You can use the <strong>State Design Pattern</strong> in these cases.</p><h2 id="State-Pattern">State Pattern</h2><p>It is a behavioral design pattern. You can use the state pattern to implement state-specific behavior in which objects can change their functionality at runtime. You can use it to avoid using conditional statements when changing an object&#39;s behavior based on its state. In the state pattern, you should <a href="https://en.wikipedia.org/wiki/Encapsulation_(computer_programming" target="_blank" rel="noreferrer noopener">encapsulate</a>) different states in separate <code>State</code> classes. The original class keeps a reference to a state object based on its current state rather than using conditional statements to implement state-dependent functionality.</p><h2 id="UML-Diagram">UML Diagram</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7EXrJIISe60aDo65BUFXgW/caabc74e7fe1d13bc1150ce6baa98edb/02_UML_state_class.png" alt="UML class diagram of state pattern"/></p><p>1) <strong>Context</strong> - it is the original class of our application. It maintains a reference to one of the concrete states on which its behavior depends. It also has a method to modify the internal state.</p><p>2) <strong>State interface</strong> - All supported states share the same state interface. Only the state interface allows <em>Context</em> to communicate with state objects. <em>Context</em> can only communicate with state objects via the state interface.</p><p>3) <strong>Concrete states</strong> - For each state, these objects implement the &#39;State&#39; interface. These are the main objects which contain the state-specific methods.</p><h2 id="How-does-it-work-">How does it work?</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/9jQ2UH5r4b4amneAHwIxG/fa3b9affd7c467bc6513b64cd1362114/03_UML_state_sequence.png" alt="UML sequence diagram of state pattern"/></p><p>Assume the <em>Context</em> is configured with an initial state, <code>concreteStateA</code>.  It behaves according to its initial state. The <em>Context</em> now implements the <code>doSomething</code> method according to <code>concreteStateA</code>. The concrete states should contain a back reference to call back and change <em>Context&#39;s</em> current state object. If a state transition occurs, the <em>Context&#39;s</em> <code>setSate</code> method is invoked, referencing the new state, <code>concreteStateB</code>. The <em>Context</em> changed its internal state and behavior. Now, it uses the <code>concreteStateB</code> to implement the <code>doSomething</code> method. The basic idea is that the states can change the context&#39;s state automatically. As a developer, you can modify the states by using any number of instances of <code>setState</code>.</p><p>If you want to add another state, simply create a new concrete state object without changing the <em>Context</em> of the application.</p><h2 id="Implementation">Implementation</h2><p>Let&#39;s take a step-by-step look at implementing the state pattern.</p><p>1) Find an existing class that contains state-dependent code, or create a suitable context class. It should include a reference to a specific state as well as a method for switching between states.</p><pre><code><span>from</span> __future__ <span>import</span> annotations
<span>from</span> abc <span>import</span> ABC<span>,</span> abstractmethod

<span># the context class contains a _state that references the concrete state and setState method to change between states.</span>
<span>class</span> <span>Context</span><span>:</span>

    _state <span>=</span> <span>None</span>

    <span>def</span> <span>__init__</span><span>(</span>self<span>,</span> state<span>:</span> State<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        self<span>.</span>setState<span>(</span>state<span>)</span>

    <span>def</span> <span>setState</span><span>(</span>self<span>,</span> state<span>:</span> State<span>)</span><span>:</span>

        <span>print</span><span>(</span><span><span>f&#34;Context: Transitioning to </span><span><span>{</span><span>type</span><span>(</span>state<span>)</span><span>.</span>__name__<span>}</span></span><span>&#34;</span></span><span>)</span>
        self<span>.</span>_state <span>=</span> state
        self<span>.</span>_state<span>.</span>context <span>=</span> self

    <span>def</span> <span>doSomething</span><span>(</span>self<span>)</span><span>:</span>
        self<span>.</span>_state<span>.</span>doSomething<span>(</span><span>)</span></code></pre><p>2) Create a common State interface for all concrete states. The State interface specifies all of the methods that all Concrete States must implement and a backreference to the <em>Context</em> object. States can change the <em>Context</em> to another state by using this backreference.</p><pre><code><span>class</span> <span>State</span><span>(</span>ABC<span>)</span><span>:</span>
    <span>@property</span>
    <span>def</span> <span>context</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> Context<span>:</span>
        <span>return</span> self<span>.</span>_context

    <span>@context<span>.</span>setter</span>
    <span>def</span> <span>context</span><span>(</span>self<span>,</span> context<span>:</span> Context<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        self<span>.</span>_context <span>=</span> context

    <span>@abstractmethod</span>
    <span>def</span> <span>doSomething</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>pass</span></code></pre><p>You should define the <em>Context</em> as a <a href="https://www.geeksforgeeks.org/protected-variable-in-python/" target="_blank" rel="noreferrer noopener">protected parameter</a>. Above, <a href="https://www.programiz.com/python-programming/property" target="_blank" rel="noreferrer noopener"><code>@property</code></a> decorator is used to make the <code><span>context</span><span>(</span><span>)</span></code> method as property and <code>@context<span>.</span>setter</code> decorator to another overload of the <code><span>context</span><span>(</span><span>)</span></code> method as property setter method. Now, <code>_context</code> is protected.</p><p>3) You can define the concrete states in the classes that implement the state interface. After the <code>doSomething</code> method is called, the state of the <em>Context</em> changes. You can also change the state by defining a specific method. The state transitions use the <code>setState</code> method of the <em>Context</em>.</p><pre><code><span>class</span> <span>ConcreteStateA</span><span>(</span>State<span>)</span><span>:</span>
    <span>def</span> <span>doSomething</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>print</span><span>(</span><span>&#34;The context is in the state of ConcreteStateA.&#34;</span><span>)</span>
        <span>print</span><span>(</span><span>&#34;ConcreteStateA now changes the state of the context.&#34;</span><span>)</span>
        self<span>.</span>context<span>.</span>setState<span>(</span>ConcreteStateB<span>(</span><span>)</span><span>)</span>


<span>class</span> <span>ConcreteStateB</span><span>(</span>State<span>)</span><span>:</span>
    <span>def</span> <span>doSomething</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>print</span><span>(</span><span>&#34;The context is in the state of ConcreteStateB.&#34;</span><span>)</span>
        <span>print</span><span>(</span><span>&#34;ConcreteStateB wants to change the state of the context.&#34;</span><span>)</span>
        self<span>.</span>context<span>.</span>setState<span>(</span>ConcreteStateA<span>(</span><span>)</span><span>)</span></code></pre><p>4) You can now initiate your application with an initial state and execute the methods.</p><pre><code><span># sample application</span>
app <span>=</span> Context<span>(</span>ConcreteStateA<span>(</span><span>)</span><span>)</span>
app<span>.</span>doSomething<span>(</span><span>)</span>    <span># this method is executed as in state 1</span>
app<span>.</span>doSomething<span>(</span><span>)</span>    <span># this method is executed as in state 2</span></code></pre><p>The output of the above code looks something like this:</p><pre><code>Context<span>:</span> Transitioning to ConcreteStateA
The context is <span>in</span> the state <span>of</span> ConcreteStateA<span>.</span>
ConcreteStateA now changes the state <span>of</span> the context<span>.</span>
Context<span>:</span> Transitioning to ConcreteStateB
The context is <span>in</span> the state <span>of</span> ConcreteStateB<span>.</span>
ConcreteStateB wants to change the state <span>of</span> the context<span>.</span>
Context<span>:</span> Transitioning to ConcreteStateA</code></pre><h2 id="Example">Example</h2><p>Let&#39;s create a simple state machine that represents a real-world scenario. Consider an elevator system with buttons in the elevator cabin that allow you to go up or down. Consider that this lift only travels between two floors to keep things simple. There are primarily two possible states for the elevator: <code><span>1</span>st floor</code> and <code><span>2</span>nd floor</code>. The input from the two buttons determines the transition between states. The elevator performs different actions based on its state.</p><p>The following code is the implementation of the elevator example. Follow along with the comments for more descriptions about each method.</p><pre><code><span>from</span> __future__ <span>import</span> annotations
<span>from</span> abc <span>import</span> ABC<span>,</span> abstractmethod

<span># The Elevator class is the context. It should be initiated with a default state.</span>
<span>class</span> <span>Elevator</span><span>:</span>

    _state <span>=</span> <span>None</span>

    <span>def</span> <span>__init__</span><span>(</span>self<span>,</span> state<span>:</span> State<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        self<span>.</span>setElevator<span>(</span>state<span>)</span>

    <span># method to change the state of the object</span>
    <span>def</span> <span>setElevator</span><span>(</span>self<span>,</span> state<span>:</span> State<span>)</span><span>:</span>

        self<span>.</span>_state <span>=</span> state
        self<span>.</span>_state<span>.</span>elevator <span>=</span> self

    <span>def</span> <span>presentState</span><span>(</span>self<span>)</span><span>:</span>
        <span>print</span><span>(</span><span><span>f&#34;Elevator is in </span><span><span>{</span><span>type</span><span>(</span>self<span>.</span>_state<span>)</span><span>.</span>__name__<span>}</span></span><span>&#34;</span></span><span>)</span>

    <span># the methods for executing the elevator functionality. These depends on the current state of the object.</span>
    <span>def</span> <span>pushDownBtn</span><span>(</span>self<span>)</span><span>:</span>
        self<span>.</span>_state<span>.</span>pushDownBtn<span>(</span><span>)</span>

    <span>def</span> <span>pushUpBtn</span><span>(</span>self<span>)</span><span>:</span>
        self<span>.</span>_state<span>.</span>pushUpBtn<span>(</span><span>)</span>

    <span># if both the buttons are pushed at a time, nothing should happen</span>
    <span>def</span> <span>pushUpAndDownBtns</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>print</span><span>(</span><span>&#34;Oops.. you should press one button at a time&#34;</span><span>)</span>

    <span># if no button was pushed, it should just wait open for guests</span>
    <span>def</span> <span>noBtnPushed</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>print</span><span>(</span><span>&#34;Press any button. Up or Down&#34;</span><span>)</span>


<span># The common state interface for all the states</span>
<span>class</span> <span>State</span><span>(</span>ABC<span>)</span><span>:</span>
    <span>@property</span>
    <span>def</span> <span>elevator</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> Elevator<span>:</span>
        <span>return</span> self<span>.</span>_elevator

    <span>@elevator<span>.</span>setter</span>
    <span>def</span> <span>elevator</span><span>(</span>self<span>,</span> elevator<span>:</span> Elevator<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        self<span>.</span>_elevator <span>=</span> elevator

    <span>@abstractmethod</span>
    <span>def</span> <span>pushDownBtn</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>pass</span>

    <span>@abstractmethod</span>
    <span>def</span> <span>pushUpBtn</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>pass</span>


<span># The concrete states</span>
<span># We have two states of the elevator: when it is on the First floor and the Second floor</span>
<span>class</span> <span>firstFloor</span><span>(</span>State<span>)</span><span>:</span>

    <span># If the down button is pushed when it is already on the first floor, nothing should happen</span>
    <span>def</span> <span>pushDownBtn</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>print</span><span>(</span><span>&#34;Already in the bottom floor&#34;</span><span>)</span>

    <span># if up button is pushed, move upwards then it changes its state to second floor.</span>
    <span>def</span> <span>pushUpBtn</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>print</span><span>(</span><span>&#34;Elevator moving upward one floor.&#34;</span><span>)</span>
        self<span>.</span>elevator<span>.</span>setElevator<span>(</span>secondFloor<span>(</span><span>)</span><span>)</span>


<span>class</span> <span>secondFloor</span><span>(</span>State<span>)</span><span>:</span>

    <span># if down button is pushed it should move one floor down and open the door</span>
    <span>def</span> <span>pushDownBtn</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>print</span><span>(</span><span>&#34;Elevator moving down a floor...&#34;</span><span>)</span>
        self<span>.</span>elevator<span>.</span>setElevator<span>(</span>firstFloor<span>(</span><span>)</span><span>)</span>

    <span># if up button is pushed nothing should happen</span>
    <span>def</span> <span>pushUpBtn</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>print</span><span>(</span><span>&#34;Already in the top floor&#34;</span><span>)</span>


<span>if</span> __name__ <span>==</span> <span>&#34;__main__&#34;</span><span>:</span>
    <span># The client code.</span>

    myElevator <span>=</span> Elevator<span>(</span>firstFloor<span>(</span><span>)</span><span>)</span>
    myElevator<span>.</span>presentState<span>(</span><span>)</span>

    <span># Up button is pushed</span>
    myElevator<span>.</span>pushUpBtn<span>(</span><span>)</span>

    myElevator<span>.</span>presentState<span>(</span><span>)</span></code></pre><p>The output of the above code looks like this:</p><pre><code>Elevator is <span>in</span> firstFloor
Elevator moving upward one floor<span>.</span>
Elevator is <span>in</span> secondFloor</code></pre><p>You can implement many buttons and states elevator like in real-life one for the floor. Try using the state pattern to implement the light bulb example from the Finite state machine.</p><h2 id="Advantages-and-Disadvantages">Advantages and Disadvantages</h2><p>The state pattern, like any other programming concept, has a number of benefits as well as some drawbacks. You can avoid writing massive conditional blocks for switching between states by using the state pattern instead of hard-coding state-specific behavior. It allows you to develop a flexible and maintainable application. You can add new states and transitions to the <em>Context</em> without changing it.</p><p>It&#39;s a good idea to use the state pattern if the logic of each state is complex and the states change frequently. Otherwise, it complicates simple things by bringing a plethora of classes and objects. The state pattern adds another level of indirection by imposing clients to rely on a State object, and it extends the context class to allow State objects to change the state of the <em>Context</em>.</p><h2 id="Conclusion">Conclusion</h2><p>In this article, you learned how to use the state pattern in Python programming to design state machines. Without using larger conditional blocks to implement state-specific behavior, the state pattern makes the development process a lot easier. You can also add new states that are not dependent on other states, giving your application more flexibility. The state pattern is very similar to the <a href="https://en.wikipedia.org/wiki/Strategy_pattern" target="_blank" rel="noreferrer noopener">strategy pattern</a>, which alters strategies based on user choices. The main distinction is that concrete states are aware of other states, whereas the strategies do not. Why do we say that states are aware of other states? because each state has to know to which state they should move. For example, the first-floor state knows that they should change to the second-floor state. Another important difference with strategy pattern is that in the case of Strategy pattern, it&#39;s the client, which provides a different strategy to Context, on State pattern, the state transition is managed by Context or State itself. Try to make use of the state pattern in your software to make the development process go more smoothly.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 02 Sep 2021 15:02:00 +0000</pubDate>
    </item>
    <item>
      <title>TinyGo: Good Things Come in Small Packages</title>
      <link>https://auth0.com/blog/tinygo-good-things-come-in-small-packages/</link>
      <description>A beginners guide into the world of IoT with TinyGo.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> The concept of coding for IoT devices, CLIs and WebAssembly is not a new concept. However, what if I told you that it is possible to use Golang for all three. <a href="https://tinygo.org/" target="_blank" rel="noreferrer noopener">TinyGo</a> is a specialized project specifically designed and used for development in small places. This article explains the benefits of TinyGo, what it is, and how you can use it. It also provides you with a Golang IoT code example for you to see TinyGo in action.</p><h2 id="What-Is-TinyGo-">What Is TinyGo?</h2><p>TinyGo is Golang&#39;s baby brother. It is a compiler that allows a user to write the Golang code they are familiar with and run it in places people wouldn&#39;t have thought were possible. What this means is that the barriers to entry into some tech spaces are being gradually lowered. I say this because I am writing through experience.</p><h2 id="How-Is-TinyGo-Different-from-Golang-">How Is TinyGo Different from Golang?</h2><p>Out of the box, Golang is a feature-rich, highly-performant, compiled language, which means that Golang is compiled to machine-readable code (those funky <code><span>1</span></code> &#39;s and <code><span>0</span></code> &#39;s everyone talks about).</p><p>In turn, being compiled to machine code allows it to run directly on the hardware ‚Äî all that CPU/RAM power! Another really cool feature of Golang is that when building a binary of the written program, it includes extensive cross-compatibility for a wide from of different system architectures.</p><p>Once a binary has been built, it can be run on any compatible distribution/architecture, providing it has been specified during the build process. To find the list of supported architectures (after installing Go on your machine), run this command into your terminal: <code>go tool dist list</code>.</p><p>The output will look something like this:</p><pre><code>aix/ppc64
android/386
android/amd64
android/arm
android/arm64
darwin/amd64
darwin/arm64
dragonfly/amd64
freebsd/386
<span>..</span>.</code></pre><p>So, how is TinyGo different? Well, it&#39;s the same Golang you know and love, but TinyGo is a smaller compiler based on <a href="https://llvm.org/" target="_blank" rel="noreferrer noopener">LLVM</a> technologies. It has essentially cherry-picked a number of important and available libraries and trimmed a lot of the fat from the core language.</p><p>By doing that, TinyGo becomes an even more powerful and efficient language that you can run in unexpected places. As an example of fat that&#39;s been trimmed, the library <code>html<span>/</span>template</code> cannot be imported by TinyGo as it relies upon other dependencies, which in turn are not able to be imported.</p><blockquote><p>To read up on the packages supported by TinyGo, visit the <a href="https://tinygo.org/docs/reference/lang-support/stdlib/" target="_blank" rel="noreferrer noopener">documentation pages</a>.</p></blockquote><h2 id="Where-Can-You-Use-TinyGo-">Where Can You Use TinyGo?</h2><h3 id="Use-TinyGo-with-WebAssembly">Use TinyGo with WebAssembly</h3><h4 id="What-is-WebAssembly-">What is WebAssembly?</h4><p>Web development might usually be associated with JavaScript, but this isn&#39;t always the case. WebAssembly is an official W3C standard and allows people to develop applications for the web without using JavaScript.</p><p>I first must stress, WebAssembly is not a replacement for JavaScript but can be an excellent complement. The two technologies can work well together to deliver web content. In one small sentence, WebAssembly is a format for writing code for the web. WebAssembly is designed to be highly performant, which is why a language with a small overhead is preferable.</p><p>WebAssembly allows developers to write code in a familiar language and run it through a web browser for end-users. Through this method, near-native performance is achieved, and the required support is already in your modern browser.</p><p>In essence, you can write your code in TinyGo and pass it through the WASM compiler, which turns that Golang code into machine-readable code. Then, you can run the application through a web browser easily.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/A4oW5u3cr5j5St4Z1bA0o/7714e2411c109a2e74347557be305cc1/01_tiny.png" alt="WebAssembly diagram"/></p><h3 id="Use-TinyGo-to-build-a-CLI">Use TinyGo to build a CLI</h3><h4 id="What-is-a-CLI-">What is a CLI?</h4><p>A Command Line Interface (CLI) is a standardized way for a user to interact textually with a system or application. The first primary use cases of CLIs were back in the 1960&#39;s where users could use a terminal to interact with the operating system. This was a continuous trend throughout the following decades which enabled systems to become more complex and give users more freedom on the computer they are using.</p><h4 id="Why-does-a-CLI-need-to-be-small-">Why does a CLI need to be small?</h4><p>Some CLIs interact with the operating system directly, which in turn means they will need some low-level permissions and a secure library set. Initially, people might think of a C language or Python to accomplish that task. They are established, low-level languages that have been used in some high-profile CLIs in the past.</p><p><em>Golang enters the room</em>.</p><p>However, for those that don&#39;t know, Go is derived from C. In fact, it&#39;s so close that you can call C code from within a Go program ‚Äî it&#39;s called Cgo.</p><p>In recent years, Go has been the go-to language to create CLIs. Some of the most popular and most used CLIs are written in Go: Docker CLI, Kubernetes CLI (<code>kubectl</code>), GitHub CLI, just to name a few. This has been made possible by the creation of third-party libraries and imports that take care of the complex tasks developers would otherwise have to take care of themselves. </p><p>Second to this is the power hidden under the hood of the language. Go has concurrency in the form of go-routines making asynchronous programming simplistic and a garbage collector helping with memory management. All of these features (and more) help reduce the size and space taken up by an integral program, all working towards keeping programs as performant as possible.</p><p>However, if a small project needs a CLI to be written for it or the CLI is only performing some basic tasks, sometimes these large libraries and imports can be overkill. Unless the end goal is to write a complex, multi-functional CLI like the ones mentioned before, a great number of the available libraries may not even be used, resulting in overhead the project could do without. To keep a CLI small and precise, reducing waste is a top priority. This makes TinyGo a great choice for small CLIs.</p><h3 id="TinyGo-can-power-microcontrollers">TinyGo can power microcontrollers</h3><h4 id="What-is-a-microcontroller-">What is a microcontroller?</h4><p>A microcontroller is usually a single chip on a small circuit board that allows input and output (I/O). A common and well-known example is an Arduino, which is fantastic for home automation and other smaller projects around the house.</p><p>With the IoT boom in recent years, Arduinos have also seen a rise in popularity. The trouble with this is that Arduinos are usually coded in C++. To some, this can be seen as a barrier to entry as it is a complex language, and not everyone wants to learn or use it when alternatives are available.</p><p>When I began to play with IoT, I purchased a bunch of Arduinos, thinking I could do some cool projects. Then I was personally struck with the C++ barrier. Most of my work is either in Node.js or Golang. With this being the case, I took a seat and thought about how I could write the code I know and love to create these cool projects I had in mind. This is where I came across TinyGo.</p><h4 id="How-many-boards-does-TinyGo-support-">How many boards does TinyGo support?</h4><p>TinyGo is a growing project. At the time of writing, TinyGo supports over 60 microcontroller boards. These range from <a href="https://www.espressif.com/" target="_blank" rel="noreferrer noopener">Espressif boards (ESP&#39;s)</a> to <a href="https://www.adafruit.com/category/851" target="_blank" rel="noreferrer noopener">Adafruits</a> and as previously mentioned, Arduinos, opening so many doors for people to begin their journey into IoT whilst coding in a familiar language.</p><blockquote><p>Check the <a href="https://tinygo.org/docs/reference/microcontrollers/" target="_blank" rel="noreferrer noopener">documentation for each microcontroller board supported by TinyGo</a> for more details.</p></blockquote><h2 id="Why-Is-TinyGo-a-Great-Alternative-to-C---and-MicroPython-">Why Is TinyGo a Great Alternative to C++ and MicroPython?</h2><p>I am not going to the language bash. C, Python, and Go are all great languages in their own way. With that being said, there is plenty of room for this project to grow and come to fruition with the right support.</p><p>Golang has significantly grown in popularity over the past few years. It is quickly becoming the de facto choice of language for cloud-native development due to its &#34;first-class&#34; support. In the <a href="https://insights.stackoverflow.com/survey/2017#most-popular-technologies" target="_blank" rel="noreferrer noopener">Stack Overflow Developer Survey 2017 for Most popular technologies</a>, Go entered the list for the first time and only scored 4.4%. In contrast to 2020, only 3 years later, it scored <a href="https://insights.stackoverflow.com/survey/2020#technology-programming-scripting-and-markup-languages-all-respondents" target="_blank" rel="noreferrer noopener">8.8%</a>. Let&#39;s the couple that with Golang being associated with some of the most sought-after skills and top paying salaries worldwide. It is only right to assume this growth will continue.</p><p>In addition, looking at the IoT market, we can see yet another upwards trend. In 2017, Garner forecasted 8.4 billion IoT devices to be connected. Fast-track to 2025, and there is a prediction of up to 30 billion devices being connected. This is a huge leap! The growth of Golang and its baby sibling, TinyGo, can help fuel the IoT fire.</p><h2 id="TinyGo-in-Action">TinyGo in Action</h2><p>Let&#39;s look at how Golang IoT shapes up with some code!</p><p>For this blog post, I have created a small program for you to create that turns 4 LEDs on when a phototransistor detects no light. This is essentially how outdoor night lights work.</p><p>To do this, I have used:</p><ul><li>Visual Studio Code + TinyGo plugin</li><li>TinyGo version <code><span>0.18</span><span>.0</span> darwin<span>/</span>amd64</code> (using Golang version <code><span>1.16</span></code> and LLVM version <code><span>11.0</span><span>.0</span></code>)</li><li>1 x Arduino Uno R3</li><li>1 x  Breadboard</li><li>8 x Male-Male wires</li><li>5 x Resistors (1 x 10kŒ© / 4 x 220Œ©)</li><li>1 x Phototransistor</li><li>4 LEDs</li></ul><h3 id="Step-1-">Step 1:</h3><p>If you haven&#39;t already, <a href="https://golang.org/doc/install" target="_blank" rel="noreferrer noopener">install Go</a> and then download and <a href="https://tinygo.org/getting-started/install/" target="_blank" rel="noreferrer noopener">install TinyGo</a> on your machine.</p><p>To check if Go is installed, run the following command:</p><pre><code>go version</code></pre><p>To check if TinyGo is installed, run the following command:</p><pre><code>tinygo version</code></pre><p>Next, install the TinyGo Visual Studio Code Plugin.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/TPJESp0S9pdn3L8uAvDKn/820fe16c173b0ba789be43ad7a7be94c/02_tiny.png" alt="install tinygo vscode editor plugin"/></p><h3 id="Step-2-">Step 2:</h3><p>Plugin the board with a USB cable (in this example, I am using an Arduino R3) and target it with the editor. Once targeted, the editor will prompt a reload of the window.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3fruuXSiUdJFWW9F3vvqAh/149c1725df6a52ae2e91546e74cc1b18/03_tiny.png" alt="tinygo select the target board"/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6QR634B8bipgZAIBUJvdoT/8e89bc62d7c9a858b1995ad732e78e58/04_tiny.png" alt="reload the vscode editor"/></p><blockquote><p><strong>üö® Warning üö®:</strong> The editor might prompt you to update the <code>go dev</code> tools within the editor. If you execute the update, you may get an error due to a known bug. Until this is fixed, it is advised to not update the tools.</p></blockquote><p><img src="https://images.ctfassets.net/23aumh6u8s0i/UgrMtLf7UmXwLxhenjy6X/a6e66e3910ca85f98752fe33234b8c5b/05_tiny.png" alt="vscode update tools notification"/></p><h3 id="Step-3-">Step 3:</h3><ol start="1"><li>Create a project in the directory <code>$<span>HOME</span><span>/</span>go<span>/</span>src<span>/</span>github<span>.</span>com<span>/</span>tinygo</code></li></ol><pre><code>$ <span>mkdir</span> light-sensor</code></pre><ol start="2"><li>Change into the newly created project directory</li></ol><pre><code>$ <span>cd</span> light-sensor</code></pre><ol start="3"><li>Create a new <code><span>.</span>go</code> file for the application within the project directory</li></ol><pre><code>$ <span>touch</span> light-sensor.go</code></pre><ol start="4"><li>Create a go mod file if you are using go modules</li></ol><pre><code>$ go mod init</code></pre><ol start="5"><li>Finally, open the project in Visual Studio Code</li></ol><h3 id="Step-4-">Step 4:</h3><p>First, read the code and comments below, and then secondly, write it out. Don&#39;t copy and paste!</p><pre><code><span>package</span> main

<span>import</span> <span>(</span>
    <span>&#34;machine&#34;</span>
    <span>&#34;time&#34;</span>
<span>)</span>

<span>func</span> <span>main</span><span>(</span><span>)</span> <span>{</span>

    <span>// Initialise Analog pins</span>
    machine<span>.</span><span>InitADC</span><span>(</span><span>)</span>

    <span>// Set the light sensor to Analog pin 0</span>
    lightSensor <span>:=</span> machine<span>.</span>ADC<span>{</span>Pin<span>:</span> machine<span>.</span>ADC0<span>}</span>
    lightSensor<span>.</span><span>Configure</span><span>(</span>machine<span>.</span>ADCConfig<span>{</span><span>}</span><span>)</span>
    <span>// Set the LEDs to the corresponding pins</span>
    leds <span>:=</span> <span>[</span><span>]</span>machine<span>.</span>Pin<span>{</span>
        machine<span>.</span>D7<span>,</span>
        machine<span>.</span>D8<span>,</span>
        machine<span>.</span>D9<span>,</span>
        machine<span>.</span>D10<span>,</span>
    <span>}</span>

    <span>// Configure each LED as an output</span>
    <span>for</span> <span>_</span><span>,</span> led <span>:=</span> <span>range</span> leds <span>{</span>
        led<span>.</span><span>Configure</span><span>(</span>machine<span>.</span>PinConfig<span>{</span>Mode<span>:</span> machine<span>.</span>PinOutput<span>}</span><span>)</span>
    <span>}</span>

    <span>// Constantly loop to get the light sensor reading every 0.1 seconds</span>
    <span>for</span> <span>{</span>
        <span>// 30000 is the lighting threshold for my environment</span>
        <span>if</span> lightSensor<span>.</span><span>Get</span><span>(</span><span>)</span> <span>&gt;</span> <span>30000</span> <span>{</span>
            <span>// Turn the LEDs off</span>
            <span>for</span> <span>_</span><span>,</span> led <span>:=</span> <span>range</span> leds <span>{</span>
                led<span>.</span><span>Set</span><span>(</span><span>false</span><span>)</span>
            <span>}</span>
        <span>}</span> <span>else</span> <span>{</span>
            <span>// Turn the LEDs on</span>
            <span>for</span> <span>_</span><span>,</span> led <span>:=</span> <span>range</span> leds <span>{</span>
                led<span>.</span><span>Set</span><span>(</span><span>true</span><span>)</span>
            <span>}</span>
        <span>}</span>

        <span>// Time to wait before next light sensor reading is collected</span>
        time<span>.</span><span>Sleep</span><span>(</span>time<span>.</span>Millisecond <span>*</span> <span>100</span><span>)</span>
    <span>}</span>
<span>}</span></code></pre><h3 id="Step-5-">Step 5:</h3><p>Connect the components, so they resemble the circuit board shown below.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2DfJWFFXVvp38jclNPNH0m/21c2eae0341fc09b98f8daff298063ed/06_tiny.png" alt="circuit board diagram"/></p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5CWIRVVG7BAMXeryu8d1EU/1be865f5accd679cd8ba55ca33576d12/07_tiny_pic.jpg" alt="circuit board"/></p><h3 id="Step-6-">Step 6:</h3><p>Next, find what port the connected device is running on. To do that, enter the following command into a terminal or navigate to the device manager.</p><p><strong>Mac:</strong></p><pre><code>$ <span>ls</span> /dev/cu*</code></pre><p><strong>Linux:</strong></p><pre><code>$ <span>ls</span> /dev/tty*</code></pre><p><strong>Windows:</strong></p><p>Open Device Manager and expand the Ports (COM &amp; LPT) list. Find your connected device and make a note of the port number. You will need this to flash the device in the next step.</p><p>Alternatively, visit <a href="https://www.mathworks.com/help/supportpkg/arduinoio/ug/find-arduino-port-on-windows-mac-and-linux.html" target="_blank" rel="noreferrer noopener">MathWorks</a> website for more information on how to find the port number of your connected device.</p><h3 id="Step-7-">Step 7:</h3><p>Now you have the port number, the device is connected and targeted through the editor, and you have written the code. The next step is to flash the board. To do this, enter the command below into a terminal.</p><pre><code>tinygo flash -target<span>=</span><span>&lt;</span>board-you-are-targeting<span>&gt;</span> -port<span>=</span><span>&lt;</span>device-port-from-step-<span><span>6</span>&gt;</span> <span>&lt;</span>name-of-file<span>&gt;</span></code></pre><p>Example command:</p><pre><code>tinygo flash -target<span>=</span>Arduino -port<span>=</span>/dev/cu.usbmodem143201 light-sensor.go</code></pre><p>Once you have completed the device flash, it should look like this:</p><p><img src="https://imgur.com/srh5UM1.gif"/></p><h2 id="Takeaways">Takeaways</h2><ol start="1"><li>TinyGo is an excellent alternative for embedded systems and WebAssembly development.</li><li>Being a smaller compiler for the Go language, existing Go developers can enter the IoT space with their current skills.</li><li>Adoption is continuously growing, and TinyGo is supported by the most common microcontroller boards already, reducing the barriers to entry for newcomers and hobbyists.</li></ol><p>TinyGo is still a very experimental project which has come on leaps and bounds over a short period of time. With Go&#39;s impact in the software world continuing to grow, TinyGo could be a project to keep an eye on. Having multiple lightweight alternatives to the main language is needed for IoT and edge computing since there is often limited compute power available and overall needs exploding. TinyGo is just another example of a great slimmed-down alternative to the dominant languages for microcontrollers. I, for one, will certainly be keeping an eye out for a linear adoption pattern and continue to monitor and research exciting projects like this.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 31 Aug 2021 14:10:00 +0000</pubDate>
    </item>
    <item>
      <title>Best Practices for Flask API Development</title>
      <link>https://auth0.com/blog/best-practices-for-flask-api-development/</link>
      <description>Learn how to design and build REST APIs with Python and Flask following best practices.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Python is my favorite programming language. Its adaptability, readability, and coding speed are unique and make <a href="https://livecodestream.dev/post/what-is-python-best-for/" target="_blank" rel="noreferrer noopener">python a powerful choice in various projects</a>, from data science projects to scripting and, of course, APIs.</p><p>Python is a popular choice for API development, not only because it is one of the <a href="https://insights.stackoverflow.com/survey/2020#technology-most-loved-dreaded-and-wanted-languages" target="_blank" rel="noreferrer noopener">most loved programming languages</a>, but also because of its rich ecosystem of libraries and frameworks that serve that goal, libraries with immense popularity such as <a href="https://www.djangoproject.com/" target="_blank" rel="noreferrer noopener">Django</a>, <a href="https://flask.palletsprojects.com/" target="_blank" rel="noreferrer noopener">Flask</a>, and <a href="https://fastapi.tiangolo.com/" target="_blank" rel="noreferrer noopener">FastAPI</a>.</p><p>But which framework should you use to build your APIs with Python? It‚Äôs 100% up to you, but there are important considerations to keep in mind. After all, some of these frameworks are different, even from the ideology.</p><ul><li>Django is an all-inclusive framework. It provides tools and modules for handling API requests, serialization, database connections, automatic admin UI generation, and so much more.</li><li>Flask, on the contrary, is a minimalist framework, it provides only the necessary tools, but it extends its functionality with additional libraries and frameworks. The great part is, you decide exactly what you need for your project, nothing more.</li><li>FastAPI is a relatively new framework. It makes use of newer python features such as type-hints, concurrency handling (with async), and it‚Äôs super fast.</li></ul><p>I work a lot with Flask and FastAPI, and I love both. I love the flexibility and adaptability of these frameworks, and for today&#39;s article, we will be focusing on Flask.</p><p>The following tips and practices are the result of research and more than eight years of experience building and shipping production-grade APIs with Python:</p><ul><li>Design your API endpoints with proper names and HTTP verbs</li><li>How to properly structure your application</li><li>Build your documentation from the code</li><li>Testing</li></ul><p><strong>Let‚Äôs get started!</strong> üöÄ</p><h2 id="Design-Your-API-Endpoints-with-Proper-Names-and-HTTP-Verbs">Design Your API Endpoints with Proper Names and HTTP Verbs</h2><p>An adequately designed API is easy and straightforward for developers to understand. By reading the <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Identifier" target="_blank" rel="noreferrer noopener">URI</a> and HTTP verb (more on this later), a developer can pretty much have a good understanding of what to expect to happen when calling a particular method.</p><p>But how does that work? Let‚Äôs start with naming URIs. In REST, we called <code>Resource</code> to a first-level data representation. Naming these resources <strong>consistently</strong> throughout your API will turn out to be one of the best decisions for the long term.</p><p>Note that I highlighted consistently in the previous sentence, as it‚Äôs a key factor. Sure, there are particular ways to name your resources, and we will cover them, but being consistent is more important to the actual convention you choose.</p><p>Let‚Äôs start getting practical by modeling a simple eCommerce website with customers, orders, and a checkout process.</p><p>Our primary resource is <code>customers</code>, which is a collection of the instance <code>customer</code>. With this information, we can identify the collection resource by the URI <code><span>/</span>customers</code> or a single resource by using the URI <code><span>/</span>customers<span>/</span><span>{</span>customerId<span>}</span></code>. Subsequently, we can identify sub-resources such as <code>orders</code>, and we can identify them as <code><span>/</span>customers<span>/</span><span>{</span>customerId<span>}</span><span>/</span>orders</code>, or a single order resource by <code><span>/</span>customers<span>/</span><span>{</span>customerId<span>}</span><span>/</span>orders<span>/</span><span>{</span>orderId<span>}</span></code>.</p><h3 id="Best-practices-naming-resources">Best practices naming resources</h3><ol start="1"><li>Use nouns in their plural form to represent resources, eg:
 <ul><li>‚úÖ Users of a system: <code><span>/</span>users</code>, <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span></code></li><li>‚úÖ User‚Äôs playlists: <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>playlists</code>, <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>playlists<span>/</span><span>{</span>playlistId<span>}</span></code></li></ul></li><li>Use hyphens ‚Äú-‚Äù to separate words and improve redeability
 <ul><li>‚úÖ <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span><span>-</span>mobile<span>-</span>devices</code></li><li>‚ùå <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>mobileDevices</code></li><li>‚ùå <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>mobile_devices</code></li></ul></li><li>Use forward slashes ‚Äú/‚Äô to indicate hierarchy
 <ul><li>‚úÖ <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>mobile<span>-</span>devices</code></li><li>‚ùå <code><span>/</span>users<span>-</span>mobile<span>-</span>devices<span>/</span><span>{</span>userId<span>}</span></code></li><li>‚ùå <code><span>/</span>users<span>-</span>mobile<span>-</span>devices<span>/</span><span>?</span>userId<span>=</span><span>{</span>userId<span>}</span></code></li></ul></li><li>Use only lowercase letters in URIs
 <ul><li>‚úÖ <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>mobile<span>-</span>devices</code></li><li>‚ùå <code><span>/</span>Users<span>/</span><span>{</span>userId<span>}</span><span>/</span>Mobile<span>-</span>Devices</code></li></ul></li></ol><p>Now that we understand how to name resources, we need to think about actions. There are methods in our APIs that are procedural by nature and are not related to a specific resource, e.g., checkout, run, play, etc.</p><h3 id="Best-practices-naming-actions">Best practices naming actions</h3><ol start="1"><li>Use verbs to represent actions, e.g.:
 <ul><li>‚úÖ Execute a checkout action: <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>cart<span>/</span>checkout</code></li></ul></li><li>Same as resources, use hyphens, forward slashes, and lowercase letters.</li></ol><p>One crucial point here is to differentiate between CRUD functions and actions, as both are actions. In REST, CRUD operations, such as Create, Read, Update and Delete, are handled through HTTP verbs and not by the URI.</p><h3 id="But-what-are-HTTP-verbs-or-HTTP-request-methods-">But what are HTTP verbs or HTTP request methods?</h3><p>HTTP defines a set of request methods to indicate an action to be performed for a resource (sounds familiar?). The list includes several, but we will be focusing on 5:</p><ul><li><strong>GET</strong>: should be for data retrieval.</li><li><strong>POST</strong>: should be used to create a new resource.</li><li><strong>PUT</strong>: should be used to update information about a specific resource.</li><li><strong>DELETE</strong>: should be used to delete a particular resource.</li><li><strong>PATCH</strong>: should be used to update partial information about a particular resource.</li></ul><h3 id="Example-for-our-eCommerce-website">Example for our eCommerce website</h3><ul><li>‚úÖ <strong>GET</strong> <code><span>/</span>users</code>: lists of all users.</li><li>‚úÖ <strong>POST</strong> <code><span>/</span>users</code>: creates a new user.</li><li>‚úÖ <strong>PUT</strong> <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span></code>: updates a user.</li><li>‚úÖ <strong>DELETE</strong> <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span></code>: deletes a specific user.</li><li>‚úÖ <strong>PATCH</strong> <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span></code>: partially updates a user.</li><li>‚úÖ <strong>GET</strong> <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>orders</code>: lists of all orders for a particular user.</li><li>‚úÖ <strong>POST</strong> <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>cart<span>/</span>checkout</code>: runs the checkout process.</li></ul><p>What you shouldn&#39;t do:</p><ul><li>‚ùå <code><span>/</span>users<span>/</span>get<span>-</span>all</code></li><li>‚ùå <code><span>/</span>users<span>/</span>create</code></li><li>‚ùå <code><span>/</span>users<span>/</span><span>{</span>userId<span>}</span><span>/</span>list<span>-</span>orders</code></li></ul><p>In any form of GET, POST, or another verb.</p><h2 id="How-to-Properly-Structure-Your-Application">How to Properly Structure Your Application</h2><p>I‚Äôd like to start this section by saying that there‚Äôs no one correct way to structure your application depending on application size, modules, requirements, or even personal preferences. This could vary. However, I‚Äôd like to introduce you to how my team structures Flask applications, and we used this setup for multiple production projects.</p><p>You can follow the explanation of the structure in the article, and you can also find this structure ready to use in the <a href="https://github.com/bajcmartinez/flask-api-starter-kit" target="_blank" rel="noreferrer noopener">Flask API starter kit on github</a>.</p><pre><code>project/
    api/
        model/
            __init__.py
            welcome.py
        route/
            home.py
        schema/
            __init__.py
            welcome.py
        service
            __init__.py
            welcome.py

    test/
        route/
            __init__.py
            test_home.py
        __init.py

    .gitignore
    app.py
    Pipfile
    Pipfile.lock</code></pre><p>Let‚Äôs now break it down and explain each module.</p><p>All the application magic happens inside the API module (<code><span>/</span>api</code>), there, we split the code into 4 main parts:</p><ul><li>The <code>models</code> are the data descriptor of our application, in many cases related to the database model. How each model is defined will heavily depend on the library you use to connect to your database.</li><li>The <code>routes</code> are the URIs to our application, where we define our resources and actions.</li><li>The <code>schemas</code> are the definitions for inputs and outputs of our API, what parameters are allowed, what information we will output. They correlate to our resources, but they are not necessarily the same as our models.</li><li>The <code>services</code> are modules that define application logic or interact with other services or the db layer. Routes should be as simple as possible and delegate all logic to the services.</li></ul><p>Each endpoint in Flask can be defined on its own or by groups called <a href="https://flask.palletsprojects.com/en/2.0.x/blueprints/" target="_blank" rel="noreferrer noopener">blueprints</a>. In my case, I like the grouping Blueprints provide, and I use them for each resource. Let‚Äôs take a look at what an example of our welcome route (<code><span>.</span><span>/</span>api<span>/</span>route<span>/</span>home<span>.</span>py</code>) would look like:</p><pre><code><span>from</span> http <span>import</span> HTTPStatus
<span>from</span> flask <span>import</span> Blueprint
<span>from</span> flasgger <span>import</span> swag_from
<span>from</span> api<span>.</span>model<span>.</span>welcome <span>import</span> WelcomeModel
<span>from</span> api<span>.</span>schema<span>.</span>welcome <span>import</span> WelcomeSchema

home_api <span>=</span> Blueprint<span>(</span><span>&#39;api&#39;</span><span>,</span> __name__<span>)</span>


<span>@home_api<span>.</span>route</span><span>(</span><span>&#39;/&#39;</span><span>)</span>
<span>@swag_from</span><span>(</span><span>{</span>
    <span>&#39;responses&#39;</span><span>:</span> <span>{</span>
        HTTPStatus<span>.</span>OK<span>.</span>value<span>:</span> <span>{</span>
            <span>&#39;description&#39;</span><span>:</span> <span>&#39;Welcome to the Flask Starter Kit&#39;</span><span>,</span>
            <span>&#39;schema&#39;</span><span>:</span> WelcomeSchema
        <span>}</span>
    <span>}</span>
<span>}</span><span>)</span>
<span>def</span> <span>welcome</span><span>(</span><span>)</span><span>:</span>
    <span>&#34;&#34;&#34;
    1 liner about the route
    A more detailed description of the endpoint
    ---
    &#34;&#34;&#34;</span>
    result <span>=</span> WelcomeModel<span>(</span><span>)</span>
    <span>return</span> WelcomeSchema<span>(</span><span>)</span><span>.</span>dump<span>(</span>result<span>)</span><span>,</span> <span>200</span></code></pre><p>Let‚Äôs break all of it into 3 pieces:</p><pre><code>home_api <span>=</span> Blueprint<span>(</span><span>&#39;api&#39;</span><span>,</span> __name__<span>)</span></code></pre><p>Here is where we declared our Blueprint, which we can consequently use to declare our endpoints or routes. In this case, our grouping is pretty basic, but we can do much more with grouping, like defining prefixes, resource folders, and more.</p><p>For example if we would like to have our <code>home</code> blueprint always as a nested route of <code><span>/</span>home<span>-</span>service</code>, we could do:</p><pre><code>home_api <span>=</span> Blueprint<span>(</span><span>&#39;api&#39;</span><span>,</span> __name__<span>,</span> url_prefix<span>=</span><span>&#39;/home-service&#39;</span><span>)</span></code></pre><p>Next we declare one route, but we split it in 2 parts:</p><pre><code><span>@home_api<span>.</span>route</span><span>(</span><span>&#39;/&#39;</span><span>)</span>
<span>@swag_from</span><span>(</span><span>{</span>
    <span>&#39;responses&#39;</span><span>:</span> <span>{</span>
        HTTPStatus<span>.</span>OK<span>.</span>value<span>:</span> <span>{</span>
            <span>&#39;description&#39;</span><span>:</span> <span>&#39;Welcome to the Flask Starter Kit&#39;</span><span>,</span>
            <span>&#39;schema&#39;</span><span>:</span> WelcomeSchema
        <span>}</span>
    <span>}</span>
<span>}</span><span>)</span></code></pre><p>We use annotations on top of functions to convert them into endpoints and provide additional information, e.g., documentation information, more on that in the next section.</p><p>And finally, our route code, which is just a Python function.</p><pre><code><span>def</span> <span>welcome</span><span>(</span><span>)</span><span>:</span>
    <span>&#34;&#34;&#34;
    1 liner about the route
    A more detailed description of the endpoint
    ---
    &#34;&#34;&#34;</span>
    result <span>=</span> WelcomeModel<span>(</span><span>)</span>
    <span>return</span> WelcomeSchema<span>(</span><span>)</span><span>.</span>dump<span>(</span>result<span>)</span><span>,</span> <span>200</span></code></pre><p>Note that we don‚Äôt simply return a string or JSON object directly, but we use our schemas instead. In our example, I‚Äôm using <a href="https://flask-marshmallow.readthedocs.io/en/latest/" target="_blank" rel="noreferrer noopener">flask-marshmallow</a> serialization library for its purposes.</p><h2 id="Build-Your-Documentation-from-the-Code">Build Your Documentation from the Code</h2><p>You build your API, you shipped to production, and developers are eager to consume it, but how would they know what endpoints are available and how to use them? The simple answer is by reading the documentation.</p><p>The documentation can be built in 2 ways, you can open up an editor and write it ‚Äúmanually‚Äù, or you can use the code to generate your documentation. If you like the idea of automatic documentation, you will love <a href="https://swagger.io/" target="_blank" rel="noreferrer noopener">swagger</a>.</p><p>Swagger is an open-source specification that allows you to describe each element of your API so that any machine or system can interpret it and interact with it. Thanks to this specification, many tools have been developed to provide rich interfaces to make our documentation dynamic and interactive, but also to provide developers with tools to easily generate these swagger files.</p><p>For Flask, there are multiple libraries for automatic Swagger generation, but my favorite is <a href="https://github.com/flasgger/flasgger" target="_blank" rel="noreferrer noopener">flasgger</a>. Flassger provides annotations and other tools to generate your documentation, and it also provides a pretty web interface where you can see each endpoint, its inputs, and outputs and even run the endpoints directly from the docs.</p><p>Here is an image of it in action:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3Dz9nOtHkd2JlQxbcCKKKQ/b65d997f2bf20418a7143279e096940b/swagger_demo.png" alt="Swagger demo page"/></p><p>It‚Äôs highly configurable and compatible with our serialization library by using an additional library called <a href="https://apispec.readthedocs.io/en/latest/" target="_blank" rel="noreferrer noopener">apispec</a>. It‚Äôs all pretty easy to set up, but you can also make use of the <a href="https://github.com/bajcmartinez/flask-api-starter-kit" target="_blank" rel="noreferrer noopener">Flask starter kit</a>, and you will have it all done for you.</p><p>But once you have it up and running, where is the information taken for the docs? From 2 places:</p><ul><li><p>Remember our swag_from function annotation? There we can provide detailed information about the inputs and outputs</p><pre><code>  <span>@swag_from</span><span>(</span><span>{</span>
      <span>&#39;responses&#39;</span><span>:</span> <span>{</span>
          HTTPStatus<span>.</span>OK<span>.</span>value<span>:</span> <span>{</span>
              <span>&#39;description&#39;</span><span>:</span> <span>&#39;Welcome to the Flask Starter Kit&#39;</span><span>,</span>
              <span>&#39;schema&#39;</span><span>:</span> WelcomeSchema
          <span>}</span>
      <span>}</span>
  <span>}</span><span>)</span></code></pre></li><li><p>We can also use string literals in functions to provide a description for the endpoint, similar to what we did here:</p><pre><code>  <span>def</span> <span>welcome</span><span>(</span><span>)</span><span>:</span>
      <span>&#34;&#34;&#34;
      1 liner about the route
      A more detailed description of the endpoint
      ---
      &#34;&#34;&#34;</span></code></pre></li></ul><p>There are many more options and customizations; it‚Äôs all well documented on their <a href="https://github.com/flasgger/flasgger" target="_blank" rel="noreferrer noopener">official docs</a>.</p><h2 id="Testing">Testing</h2><p>If you are like me, perhaps you hate writing tests, but if you are like me, you know it‚Äôs worth it. Testing, when done properly, increases efficiency and quality in the long run. They also reassure developers when making changes, refactoring, or building new features on existing systems.</p><p>Building tests shouldn‚Äôt be too hard, and it should happen naturally during development. I struggled a lot with it in the past because I‚Äôd always first develop the feature, the endpoint, or the function and then write the tests, just to get it done.</p><p>I‚Äôm not saying that approach is wrong, but there‚Äôs a better way. TDD, or test-driven development, it‚Äôs a concept idea where you write tests first, and just then you write the actual code we want to test.</p><p>How does it work? Let‚Äôs suppose we need to write a function that will add 2 numbers and return the result; exciting, right?</p><p>With TDD, our approach would be first to write the tests.</p><pre><code><span>def</span> <span>test_answer</span><span>(</span><span>)</span><span>:</span>
    <span>assert</span> sum_two_numbers<span>(</span><span>3</span><span>,</span> <span>5</span><span>)</span> <span>==</span> <span>8</span></code></pre><p>Next, we run the tests, and it fails because our function doesn‚Äôt even exist yet. So next, we write our function:</p><pre><code><span>def</span> <span>sum_two_numbers</span><span>(</span>num1<span>,</span> num2<span>)</span><span>:</span>
    <span>return</span> num1 <span>*</span> num2</code></pre><p>Next, we rerun our tests, and they still fail. Our assertion fails, but why? It turns out that I made a simple mistake. As clumsy as I am, I put a * instead of a +; this would have been very hard to notice without our tests, but thanks god, we have them.</p><p>We fix our function, and now everything runs perfectly.</p><pre><code><span>def</span> <span>sum_two_numbers</span><span>(</span>num1<span>,</span> num2<span>)</span><span>:</span>
    <span>return</span> num1 <span>+</span> num2</code></pre><p>In the exercise we did, it sounds kind of silly, but with more complex functions and code mistakes happen, and having tests first will help a lot; I say that from experience.</p><h2 id="Conclusion">Conclusion</h2><p>Best practices can be different for different frameworks, problems to solve, or even people, there‚Äôs no one way of doing things right, and that‚Äôs something I love about programming. However, having basic principles to rely on when designing and developing APIs can help your team, and other developers consume your API products.</p><p>Being consistent in naming, separating concepts in modules or folders in your project, documenting directly from your code, and properly testing are just examples of things that can make your life easier, more productive, and take you to the next level.</p><p>I hope you enjoyed reading this article!</p></div></div>]]></content:encoded>
      <pubDate>Mon, 30 Aug 2021 14:56:00 +0000</pubDate>
    </item>
    <item>
      <title>Introduction to Async Programming in C#</title>
      <link>https://auth0.com/blog/introduction-to-async-programming-in-csharp/</link>
      <description>Most languages and frameworks support asynchronous programming. But, what is it exactly? Learn about async programming and how to implement it in C#.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>You probably already read about asynchronous programming. <code><span>async</span></code> and <code><span>await</span></code> words are used everywhere, no matter which programming language we choose. Talking about .NET framework, and C# in particular, we have some native functions, classes, and reserved words that we can use to implement asynchronous tasks and workflows in our projects.</p><p>In this article, we will talk about synchronism, parallelism, concurrency, and how to implement asynchronous algorithms in our C# applications.</p><h2 id="Synchronous-and-Asynchronous-Tasks">Synchronous and Asynchronous Tasks</h2><p>As a developer, you surely faced scenarios where certain actions or operations took a considerable amount of time to execute. We regularly have to do long-running tasks such as reading a file, calling an API, or downloading a big file. We could wait for one of these tasks to be finished before executing another task. If that&#39;s the case, we say we are working in a &#34;synchronous&#34; way. By doing this, the whole application gets blocked and stops responding until the whole task is completed, and we can move on to a new one.</p><p>In some cases, we don&#39;t have any alternative. If we have Task1 and Task2 that depend on the result of the first action, we will have to wait until Task1 finishes executing to start Task2. But we could have the scenario where the subsequent tasks (or some of them) don&#39;t depend on the result of the previous long-running task. If that&#39;s the case, we have different strategies and approaches that we could take to make our application faster and in a more performant way.</p><p>For example, we could have an application that runs concurrent tasks internally. There is a button and a task executed when it is clicked. Right after the user clicks on the button, the application can trigger a separate thread to run the requested task. In the meantime, the main thread becomes available to execute other actions while the button&#39;s task is executed in the background. Doing this, we keep the UI responsive in case the user wants to interact with it.</p><p>Another scenario would be needing to run multiple copies of a certain group of actions or instructions. An example of this would be uploading many files at the same time. In this case, our application could trigger one thread per file and execute the necessary code inside of them. Doing this, we would be processing the files in a &#34;parallel&#34; way. In a nutshell, here is the difference between the two concepts: concurrency means the application is making progress on more than one task at the same time, while parallelism is about running multiple tasks simultaneously.</p><p>But let&#39;s say we have to read a big file, call an API, and do some complex calculations. There is no dependency between the three tasks, but we need the result of all of them to continue the execution of our application and update the UI. In this case, we could execute our tasks &#34;asynchronously&#34; with the three ones running simultaneously and wait for their result to do the subsequent tasks.</p><h2 id="What-Is-Asynchronous-Programming-">What Is Asynchronous Programming?</h2><p>We could define asynchronous programming as the way of executing programming code in a thread without having to wait for an I/O-bound or CPU-bound task to finish. I/O-bound operations could be file-system accesses, HTTP requests, API calls, or database queries. And CPU-bound operations would be actions like encrypting data, complex calculations, image or document management.</p><p>One of the ideas of asynchronous programming is to divide our logic into <em>awaitable</em> tasks so that we don&#39;t block the execution of our application. We can call an async method and get a task object that represents it. In the meantime, we can do some not related and not dependant work. After we execute those operations, we await the async task, which may already be finished or not. If the execution is finished, we will get the resulting value from the task and use it in the next dependant operations.</p><h3 id="Benefits">Benefits</h3><p>Some of the benefits we have working with asynchronous tasks are:</p><ul><li>We keep the UI of our app responsive.</li><li>We improve the performance of our application.</li><li>We avoid <a href="https://medium.com/criteo-engineering/net-threadpool-starvation-and-how-queuing-makes-it-worse-512c8d570527" target="_blank" rel="noreferrer noopener">thread pool starvation</a>.</li></ul><h3 id="Drawbacks">Drawbacks</h3><p>Although, there are some drawbacks when working with async programming:</p><ul><li>Code gets more complex and harder to maintain.</li><li>There is increased memory allocation, as some objects have to stay alive longer while awaiting other code to be executed.</li><li>It can get hard to find bugs occurring in asynchronous tasks.</li><li>When we&#39;re writing an asynchronous piece of code, all our application code tends to become asynchronous.</li></ul><h2 id="Asynchronous-Programming-Patterns">Asynchronous Programming Patterns</h2><p>To perform asynchronous operations in .NET, we can follow three different patterns:</p><p><strong>Asynchronous Programming Model (APM)</strong>: Let&#39;s say we have two methods, and we name them <code>BeginOperation</code> and <code>EndOperation</code>. After calling <code>BeginOperation</code>, our application can continue executing tasks on the calling thread while the async task is executed on a different thread. For each call to <code>BeginOperation</code>, our app should also call <code>EndOperation</code> method to get the results. In .NET, it can be implemented using <code>IAsyncResult</code>. Let&#39;s see an example of this model:</p><pre><code><span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>IO</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading</span><span>;</span>
<span>public</span> <span>sealed</span> <span>class</span> <span>Program</span>
<span>{</span>
    <span>public</span> <span>static</span> <span><span>void</span></span> <span>Main</span><span>(</span><span>)</span>
    <span>{</span>
        <span><span>var</span></span> buffer <span>=</span> <span>new</span> <span><span>byte</span></span><span>[</span><span>100</span><span>]</span><span>;</span>
        <span><span>var</span></span> fs <span>=</span> <span>new</span> <span>FileStream</span><span>(</span><span>&#34;bigFile.txt&#34;</span><span>,</span> FileMode<span>.</span>Open<span>,</span> FileAccess<span>.</span>Read<span>,</span> FileShare<span>.</span>Read<span>,</span> <span>1024</span><span>,</span> FileOptions<span>.</span>Asynchronous<span>)</span><span>;</span>

        <span>IAsyncResult</span> result <span>=</span> fs<span>.</span><span>BeginRead</span><span>(</span>buffer<span>,</span> <span>0</span><span>,</span> buffer<span>.</span>Length<span>,</span> <span>null</span><span>,</span> <span>null</span><span>)</span><span>;</span>

        <span>// Do other things...</span>

        <span><span>int</span></span> numBytes <span>=</span> fs<span>.</span><span>EndRead</span><span>(</span>result<span>)</span><span>;</span>
        fs<span>.</span><span>Close</span><span>(</span><span>)</span><span>;</span>

        Console<span>.</span><span>WriteLine</span><span>(</span><span>&#34;Read {0}  Bytes:&#34;</span><span>,</span> numBytes<span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p><strong>Event-based Asynchronous Pattern (EAP)</strong>: We start an async method that will trigger a <code>Completed</code> event when the task is completed, making the result available to our application. This would be an example of this model:</p><pre><code><span>public</span> <span>class</span> <span>ExampleHandler</span>
<span>{</span>
    <span>public</span> <span>event</span> <span>EventHandler</span> OnTriggerCompleted<span>;</span>

    <span>public</span> <span><span>void</span></span> <span>Start</span><span>(</span><span><span>int</span></span> timeout<span>)</span>
    <span>{</span>
        <span><span>var</span></span> timer <span>=</span> <span>new</span> <span>Timer</span><span>(</span><span>new</span> <span>TimerCallback</span><span>(</span><span>(</span>state<span>)</span> <span>=&gt;</span>
        <span>{</span>
            OnTriggerCompleted<span>?.</span><span>Invoke</span><span>(</span><span>null</span><span>,</span> <span>null</span><span>)</span><span>;</span>
        <span>}</span><span>)</span><span>)</span><span>;</span>

        timer<span>.</span><span>Change</span><span>(</span>timeout<span>,</span> <span>0</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span>

<span>class</span> <span>Program</span>
<span>{</span>
    <span>private</span> <span>static</span> <span><span>void</span></span> <span>Main</span><span>(</span><span>)</span>
    <span>{</span>
        <span><span>var</span></span> handler <span>=</span> <span>new</span> <span>ExampleHandler</span><span>(</span><span>)</span><span>;</span>

        handler<span>.</span>OnTriggerCompleted <span>+=</span> <span>(</span>sender<span>,</span> e<span>)</span> <span>=&gt;</span>
        <span>{</span>
            Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$&#34;Triggered at: </span><span><span>{</span><span> DateTime<span>.</span>Now<span>.</span><span>ToLongTimeString</span><span>(</span><span>)</span></span><span>}</span></span><span>&#34;</span></span><span>)</span><span>;</span>
        <span>}</span><span>;</span>

        handler<span>.</span><span>Start</span><span>(</span><span>3000</span><span>)</span><span>;</span>

        Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$&#34;Start waiting at </span><span><span>{</span><span>DateTime<span>.</span>Now<span>.</span><span>ToLongTimeString</span><span>(</span><span>)</span></span><span>}</span></span><span>&#34;</span></span><span>)</span><span>;</span>
        Console<span>.</span><span>WriteLine</span><span>(</span><span><span>$&#34;Processing...&#34;</span></span><span>)</span><span>;</span>
        Console<span>.</span><span>ReadLine</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p><strong>Task-based Asynchronous Pattern (TAP)</strong>: We have an <code>OperationAsync</code> method that returns a <code>Task</code> object, as in the following example:</p><pre><code><span>class</span> <span>ClassName</span>
<span>{</span>
    <span>public</span> <span>Task</span> <span>OperationAsync</span><span>(</span><span><span>byte</span> <span>[</span><span>]</span></span> buffer<span>,</span> <span><span>int</span></span> offset<span>,</span> <span><span>int</span></span> count<span>)</span><span>;</span>
<span>}</span></code></pre><p>We can await that method, using <code><span>async</span></code> and <code><span>await</span></code> keywords. We will go deeper into this approach in a while.</p><blockquote><p>Keep in mind that <strong>the APM and EAP approaches are legacy models and they are no longer recommended</strong>. Microsoft recommends using the <em>Task-based Asynchronous Pattern</em> to implement async programming in our applications.</p></blockquote><h2 id="Asynchronous-Programming-in-C-">Asynchronous Programming in C#</h2><p>As we mentioned, async programming in C# can be accomplished by implementing the <em>Task-based Asynchronous Pattern</em>. We will have methods that return a <code>Task</code> or <code>Task<span>&lt;</span><span>T</span><span>&gt;</span></code> object. Defining those methods as async operations will enable us to await them and keep using the same execution thread to run other operations that are not linked to the awaited task.</p><p>C# provides us two keywords to handle <code>Task</code> objects in an easier way: <code><span>async</span></code> and <code><span>await</span></code>. Adding the keyword <code><span>async</span></code> to a method signature allows us to use the <code><span>await</span></code> keyword inside the method while instructs the compiler to create a state machine to handle the asynchronicity. On the other hand, the <code><span>await</span></code> keyword is used to pause the execution of a method and asynchronously wait for a <code>Task</code> to finish, while the current thread is sent back to the thread pool instead of keeping it in a blocked state. Everything happens in the background, avoiding us to implement and maintain the complexity of thread management and the state of the calls.</p><p>Let&#39;s analyze this piece of code:</p><pre><code><span>public</span> <span>async</span> <span>Task<span>&lt;</span>User<span>&gt;</span></span> <span>GetLoggedUserEmailAsync</span><span>(</span><span>)</span>
<span>{</span>
  <span><span>int</span></span> userId <span>=</span> <span>GetId</span><span>(</span><span>)</span><span>;</span>
  <span><span>string</span></span> email <span>=</span> <span>await</span> <span>GetEmailAsync</span><span>(</span>userId<span>)</span><span>;</span>
  <span>User</span> user <span>=</span> <span>GetUserByEmail</span><span>(</span>email<span>)</span><span>;</span>
  <span>return</span> user<span>;</span>
<span>}</span>

<span>public</span> <span>async</span> <span>Task<span>&lt;</span><span>string</span><span>&gt;</span></span> <span>GetEmailAsync</span><span>(</span><span><span>int</span></span> userId<span>)</span>
<span>{</span>
  <span>// Do something</span>
<span>}</span></code></pre><p>An async method should return <code><span>void</span></code>, <code>Task</code>, or <code>Task<span>&lt;</span><span>T</span><span>&gt;</span></code>, where <code><span>T</span></code> is the return data type that we need. Returning <code><span>void</span></code> is normally used for event handlers. The keyword <code><span>async</span></code> enables us to use the command <code><span>await</span></code> within the method so that we can wait for the asynchronous method processing as expected.</p><p>Notice that the methods end with &#34;Async&#34;. Although it is not mandatory, there is a naming convention that an asynchronous method name should end with the word &#34;Async&#34;. This convention aims to make it clear to the consumer of the functionality that the method won&#39;t complete all of its work synchronously.</p><p>In our previous example, <code><span>GetId</span><span>(</span><span>)</span></code> is called synchronously. When the execution thread encounters the <code><span>await</span></code> keyword on <code><span>await</span> <span>GetEmailAsync</span><span>(</span>userId<span>)</span></code>, it creates a <code>Task<span>&lt;</span>User<span>&gt;</span></code> that contains the remainder of the <code>GetLoggedUserEmailAsync</code> method. This task is executed asynchronously after the <code>Task<span>&lt;</span>string<span>&gt;</span></code> returned by <code>GetEmailAsync</code>. So, the <code>User</code> object is returned from the <code>Task<span>&lt;</span>User<span>&gt;</span></code> created by the <code><span>await</span></code> keyword.</p><h2 id="Asynchronous-Code-in-Action">Asynchronous Code in Action</h2><p>Let&#39;s see a short example to review the concepts previously explained. Having the following console application:</p><pre><code><span>using</span> <span>System</span><span>;</span>
<span>using</span> <span>System<span>.</span>IO</span><span>;</span>
<span>using</span> <span>System<span>.</span>Threading<span>.</span>Tasks</span><span>;</span>

<span>class</span> <span>Program</span>
<span>{</span>
   <span>static</span> <span>async</span> <span>Task</span> <span>Main</span><span>(</span><span><span>string</span><span>[</span><span>]</span></span> args<span>)</span>
   <span>{</span>
       <span><span>string</span></span> filePath <span>=</span> <span>&#34;bigFile.txt&#34;</span><span>;</span>

       <span>// Create a big file</span>
       <span>FileStream</span> fs <span>=</span> <span>new</span> <span>FileStream</span><span>(</span>filePath<span>,</span> FileMode<span>.</span>CreateNew<span>)</span><span>;</span>
       fs<span>.</span><span>Seek</span><span>(</span><span>1024</span> <span>*</span> <span>1024</span><span>,</span> SeekOrigin<span>.</span>Begin<span>)</span><span>;</span>
       fs<span>.</span><span>WriteByte</span><span>(</span><span>0</span><span>)</span><span>;</span>
       fs<span>.</span><span>Close</span><span>(</span><span>)</span><span>;</span>

       <span><span>var</span></span> task <span>=</span> <span>ReadFileAsync</span><span>(</span>filePath<span>)</span><span>;</span>

       Console<span>.</span><span>WriteLine</span><span>(</span><span>&#34;A synchronous message&#34;</span><span>)</span><span>;</span>

       <span><span>int</span></span> length <span>=</span> <span>await</span> task<span>;</span>

       Console<span>.</span><span>WriteLine</span><span>(</span><span>&#34;Total file length: &#34;</span> <span>+</span> length<span>)</span><span>;</span>
       Console<span>.</span><span>WriteLine</span><span>(</span><span>&#34;After reading message&#34;</span><span>)</span><span>;</span>
       Console<span>.</span><span>ReadLine</span><span>(</span><span>)</span><span>;</span>
   <span>}</span>

   <span>static</span> <span>async</span> <span>Task<span>&lt;</span><span>int</span><span>&gt;</span></span> <span>ReadFileAsync</span><span>(</span><span><span>string</span></span> file<span>)</span>
   <span>{</span>
       Console<span>.</span><span>WriteLine</span><span>(</span><span>&#34;Start reading file&#34;</span><span>)</span><span>;</span>

       <span><span>int</span></span> length <span>=</span> <span>0</span><span>;</span>

       <span>using</span><span>(</span><span>StreamReader</span> reader <span>=</span> <span>new</span> <span>StreamReader</span><span>(</span>file<span>)</span><span>)</span>
       <span>{</span>
           <span><span>string</span></span> fileContent <span>=</span> <span>await</span> reader<span>.</span><span>ReadToEndAsync</span><span>(</span><span>)</span><span>;</span>
           length <span>=</span> fileContent<span>.</span>Length<span>;</span>
       <span>}</span>

       Console<span>.</span><span>WriteLine</span><span>(</span><span>&#34;Finished reading file&#34;</span><span>)</span><span>;</span>

       <span>return</span> length<span>;</span>
   <span>}</span>
<span>}</span></code></pre><p>In this application, we read a big file, count the number of characters it has, and print different messages in the console. The method that triggers the file reading operation is defined as asynchronous, and it&#39;s the one that starts the asynchronous thread reading the text. While the message &#34;A synchronous message&#34; is printed, the reading of the file continues. If we execute the application, we can see how the execution thread behaves based on the output messages:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6QF3i0BPAoDOSdF0T1jm07/269b11a895d0f74b415d49aa5b23d106/async-program-console.png" alt="Asynchronous sample application output"/></p><h2 id="Summary">Summary</h2><p>In this article, we talked about how we can manage and organize the tasks in our application based on the dependency and order of execution. We talked about synchronism, parallelism, concurrency, and asynchronism. We described async programming, its benefits, and how we can implement it in our C# applications. You can find the code shown in this article in <a href="https://github.com/auth0-blog/c-sharp-async-intro" target="_blank" rel="noreferrer noopener">this GitHub repository</a>.</p><p>If you want to learn more about asynchronous programming in C# and what advanced features we have available, you can go to:</p><ul><li><a href="https://docs.microsoft.com/en-us/dotnet/standard/async-in-depth" target="_blank" rel="noreferrer noopener">Async in depth</a> by Microsoft.</li><li><a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/" target="_blank" rel="noreferrer noopener">Asynchronous programming with async and await</a> by Microsoft.</li><li><a href="https://github.com/davidfowl/AspNetCoreDiagnosticScenarios/blob/master/AsyncGuidance.md" target="_blank" rel="noreferrer noopener">Asynchronous Programming Guidance</a> by David Fowler.</li><li><a href="https://docs.microsoft.com/en-us/archive/msdn-magazine/2013/march/async-await-best-practices-in-asynchronous-programming" target="_blank" rel="noreferrer noopener">Async/Await - Best Practices in Asynchronous Programming</a> by Microsoft.</li></ul><div><h2 id="Aside--Securing-ASP-NET-Core-with-Auth0">Aside: Securing ASP.NET Core with Auth0</h2><p>Securing ASP.NET Core applications with Auth0 is easy and brings a lot of great features to the table. With <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>, you only have to write a few lines of code to get a solid <a href="https://auth0.com/user-management" target="_blank" rel="noreferrer noopener">identity management solution</a>, <a href="https://auth0.com/docs/sso/single-sign-on" target="_blank" rel="noreferrer noopener">single sign-on</a>, support for <a href="https://auth0.com/docs/identityproviders" target="_blank" rel="noreferrer noopener">social identity providers (like Facebook, GitHub, Twitter, etc.)</a>, and support for <a href="https://auth0.com/enterprise" target="_blank" rel="noreferrer noopener">enterprise identity providers (like Active Directory, LDAP, SAML, custom, etc.)</a>.</p><p>On ASP.NET Core, you need <a href="https://auth0.com/docs/apis" target="_blank" rel="noreferrer noopener">to create an API in your Auth0 Management Dashboard</a> and change a few things on your code. To create an API, you need to <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free Auth0 account</a>. After that, you need to go to <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">the API section of the dashboard</a> and click on &#34;Create API&#34;. On the dialog shown, you can set the <em>Name</em> of your API as &#34;Books&#34;, the <em>Identifier</em> as &#34;<a href="http://books.mycompany.com" target="_blank" rel="noreferrer noopener">http://books.mycompany.com</a>&#34;, and leave the <em>Signing Algorithm</em> as &#34;RS256&#34;.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6HrObJ2eGY7YehLzbBM0sH/066be814a124d98f03224d9b177caa22/net-core-2_creating-api-on-auth0.png" alt="Creating API on Auth0"/></p><p>After that, you have to add the call to <code>services<span>.</span><span>AddAuthentication</span><span>(</span><span>)</span></code> in the <code><span>ConfigureServices</span><span>(</span><span>)</span></code> method of the <code>Startup</code> class as follows:</p><pre><code><span><span>string</span></span> authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>/&#34;</span></span><span>;</span>
<span><span>string</span></span> audience <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>;</span>

services<span>.</span><span>AddAuthentication</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  options<span>.</span>DefaultAuthenticateScheme <span>=</span> JwtBearerDefaults<span>.</span>AuthenticationScheme<span>;</span>
  options<span>.</span>DefaultChallengeScheme <span>=</span> JwtBearerDefaults<span>.</span>AuthenticationScheme<span>;</span>
<span>}</span><span>)</span><span>.</span><span>AddJwtBearer</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  options<span>.</span>Authority <span>=</span> authority<span>;</span>
  options<span>.</span>Audience <span>=</span> audience<span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>In the body of the <code><span>Configure</span><span>(</span><span>)</span></code> method of the <code>Startup</code> class, you also need to add an invocation to <code>app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span></code> and <code>app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span></code> as shown below:</p><pre><code>app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=&gt;</span>
<span>{</span>
    endpoints<span>.</span><span>MapControllers</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><blockquote><p>Make sure you invoke these methods in the order shown above. It is essential so that everything works properly.</p></blockquote><p>Finally, add the following element to the <code>appsettings<span>.</span>json</code> configuration file:</p><pre><code><span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
    <span>// ...</span>
  <span>}</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;YOUR_DOMAIN&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;YOUR_AUDIENCE&#34;</span>
  <span>}</span>
<span>}</span></code></pre><blockquote><p><strong>Note</strong>: Replace the placeholders <code><span>YOUR_DOMAIN</span></code> and <code><span>YOUR_AUDIENCE</span></code> with the actual values for the domain that you specified when creating your Auth0 account and the <em>Identifier</em> you assigned to your API.</p></blockquote></div></div></div>]]></content:encoded>
      <pubDate>Thu, 26 Aug 2021 14:55:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 No-Code Actions Integrations Now Available in Beta</title>
      <link>https://auth0.com/blog/auth0-no-code-actions-integrations-now-available-in-beta/</link>
      <description>Actions Integrations reduce the amount of custom code you need to write, maintain, and update.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><a href="https://auth0.com/blog/actions-now-generally-available/" target="_blank" rel="noreferrer noopener">Actions launched recently</a> as the next evolution of extensibility with Auth0, picking up where our legacy extensibility tools Rules and Hooks leave off. Actions unifies the Auth0 extensibility experience in one place. With it, we took the power of Rules and Hooks and created a greatly improved developer experience with features such as an industry-standard VS Code style editor, typescript, draft mode, version control, improved secret management, and an expanded library of NPM modules. Actions gives developers the ability to customize Auth0 using the full spectrum of coding options from pro-code to <a href="https://auth0.com/blog/what-is-low-code-how-low-code-can-speed-digital-transformation/" target="_blank" rel="noreferrer noopener">low-code</a>, with the addition of no-code Actions Integrations.</p><p>Actions Integrations, as our new zero-code layer, offers an easy experience to extend Auth0 with partner-built innovations with no coding required. Now you can implement key integrations such as Identity Verification or Consent Management to your workflow without writing or maintaining a single line of code, the provider of the integration takes care of that. To use Actions Integrations, simply install an integration from the Auth0 Marketplace and drag-and-drop it into your Actions workflow. Then with only a few configuration settings, the integration is part of your tenant.</p><p>Actions Integrations, currently in Beta, are now available through the <a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a> and in Actions in the Auth0 Dashboard. This marks an essential milestone in how you can leverage innovations from Marketplace Partners into your Customer Identity Access Management (CIAM) workflows. Through Actions and Marketplace, we are creating an ecosystem of sustainable, and ever-growing plug-and-play partner integrations that allows developers to solve many identity extensibility scenarios faster and without extra code.</p><p>Pro-Code custom Actions will continue to be a core feature of Auth0, with all the support you‚Äôve come to expect. By adding Actions Integrations to our offerings, we give you the option to replace the custom code for common solutions with no-code integrations and leave the custom code layer for unique use cases to you. This reduces your overall maintenance and risks associated with custom code.</p><h2 id="Plug---Play-Extensibility">Plug &amp; Play Extensibility</h2><h3 id="Endless-innovation--centrally-maintained">Endless innovation, centrally maintained</h3><p>Satisfy your identity requirements right out-of-the-box without having to write custom code. Actions Integrations are reusable modules that are centrally maintained by a vetted Marketplace Partner. Integrations are designed to be maintained by the Partners with updates propagating automatically to all instances.This results in faster time-to-market while greatly reducing maintenance costs and resource drain associated with code updates that can result in having to rebuild Rules and Hooks.</p><h3 id="Common-use-cases">Common use cases</h3><p>Actions Integrations exist for the most common use cases of custom extensibility. These currently include:</p><ul><li><strong>ID DataWeb:</strong> Real time and self service global identity verification</li><li><strong>Eva:</strong> Second-factor voice biometric</li><li><strong>Scaled Access:</strong> Delegated user access management</li><li><strong>One Trust:</strong> Consent and user preferences management</li><li><strong>Incognia:</strong> Mobile identity proofing with address verification</li><li><strong>Incognia:</strong> Mobile login with location behavioral biometrics</li><li><strong>SecZetta:</strong> Real-time, risk-based authentication</li><li><strong>Yoonik:</strong> Second-factor facial biometric</li><li><strong>Infobip:</strong> Global SMS messaging</li><li><strong>Amazon:</strong> Simple Notification Service (SNS) for microservices and serverless applications by Amazon</li><li><strong>ClickSend:</strong> Global SMS messaging</li><li><strong>Cumul.io:</strong> Self-service data visualization platform</li><li><strong>DataGuard:</strong> Consent and user preference management</li><li><em></em>Esendex: SMS authentication</li><li><strong>Mitto:</strong> Global SMS messaging</li><li><strong>Plivo:</strong> SMS authentication</li><li><strong>Telesign:</strong> Global SMS messaging</li><li><strong>Vonage:</strong> Global SMS messaging</li></ul><p>With Marketplace, we are building partnerships to deliver innovations that further reduce your need to code features from scratch. After the public launch of Actions Integrations, we will continue to grow our Marketplace catalog, adding more services and modules to help you expand and customize your CIAM implementation.</p><p>We encourage you to start using Actions integrations to satisfy any of the common use cases that apply to you. And of course, if you encounter any questions or have any comments, please direct them to our team of identity specialists.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 25 Aug 2021 16:57:00 +0000</pubDate>
    </item>
    <item>
      <title>Secure Software Supply Chain with GitHub Security Features</title>
      <link>https://auth0.com/blog/secure-software-supply-chain-with-github-security-features/</link>
      <description>Learn what software supply chain is and how to improve security with GitHub security features.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> 
One of the most critical aspects of modern software delivery is security. In the era of open-source projects, it is challenging and not easy to control every vulnerability and make sure that our solution does not use a package with serious vulnerabilities.  Today&#39;s threat to supply chain security is unpatched software. In this article, we will learn how to improve code security with GitHub security features.</p><h2 id="Security-Role-in-the-Software-Supply-Chain">Security Role in the Software Supply Chain</h2><p>Application implementation nowadays looks slightly different than a few years ago. Open-source software has become a standard. Using open-source libraries in different kinds of projects is something normal nowadays, and we do not have to write every part of our application from scratch.</p><p>When using some open-source code or a library, it is worth not forgetting about security aspects. Industry data suggests that 99 percent of codebases contain open-source code. This is a lot! With this fact, we have to remember about dangers related to vulnerabilities and bugs that can lead to bad consequences. Many examples can be provided where an open-source library was used, but then serious vulnerability was discovered, and in the end, there were problems with keeping security at the right level.</p><p>Before we discuss the role of security in the software supply chain, we have to find out what it is. <strong>Software supply chain</strong> is anything that goes into or affects the source code from development through Continuous Integration and Delivery pipelines until it gets deployed into production and used broadly. Any examples? The software supply chain includes information about who wrote a specific fragment of code, which tools were used to apply security scanning, what is the infrastructure used to host our solution, or what dependencies are used.</p><p>When a solution is being developed, often security part is missed or left as the last step in the whole process of the software supply chain. One of the biggest threats to supply chain security nowadays is unpatched software. This is why we should not include security assessment as the last step of our software supply chain. Security should be an ongoing part of software development to make sure that any potential vulnerabilities can be quickly mitigated.</p><p>Keeping an eye on every security aspect can be challenging, especially for developers who are focused on the code implementation rather than scanning and searching for vulnerabilities. Also, it is important to provide security feedback to developers right away so that any potential vulnerabilities are eliminated as quickly as possible.</p><p>In the following, we will focus on the security features available on GitHub to make sure that our software supply chain is more secure.</p><h2 id="The-Sample-Application">The Sample Application</h2><p>To present some of the security features in action, you can use the sample application that is available on <a href="https://github.com/auth0-blog/Globomantics-Games" target="_blank" rel="noreferrer noopener">this GitHub repository</a>. This repository contains a simple web game written as an ASP .NET Core MVC application in .NET 5. We will not focus on the implementation details in this article. Our goal is to discover and understand different security features available on GitHub and see security scanning in action. With this repository, you can try security features on your own. Use the <a href="https://github.com/auth0-blog/Globomantics-Games/tree/for-security-features-testing" target="_blank" rel="noreferrer noopener"><code><span>for</span><span>-</span>security<span>-</span>features<span>-</span>testing</code></a> branch as a starting point by running the following command on your machine:</p><pre><code><span>git</span> clone -b for-security-features-testing https://github.com/auth0-blog/Globomantics-Games.git</code></pre><h2 id="GitHub-Security-Features-to-Keep-Secure-Your-Repository">GitHub Security Features to Keep Secure Your Repository</h2><p>GitHub provides a few built-in tools to keep our source code security at the right level. However, we can also integrate third-party tools. Let&#39;s start by discussing GitHub&#39;s built-in security features first.</p><h3 id="Repository-dependency-graph">Repository dependency graph</h3><p>When using open-source libraries in our project, it is sometimes hard to track all dependencies. Of course, we can open our package managers (like NuGet) and see all the open-source packages added to the project. But what about a deeper knowledge about other packages used by the packages we referenced? Confusing and challenging, right? This is where the GitHub repository dependency graph can be helpful. With a dependency graph, we can recursively track all of the dependencies used in the project. </p><p>We can find the dependency graph by opening our repository&#39;s main page on GitHub, under the <em>Insights</em> tab as in the picture below.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7s3HZp8ib6ApzkU5U6rJg7/80b3b277a0789dce93b8457d2a2b9b14/github-dependency-graph-example.png" alt="GitHub dependency graph"/></p><p>The dependency graph is enabled by default for each repository hosted on GitHub. It can scan common package manifests like:</p><ul><li><code><span>package</span><span>.</span>json</code></li><li><code>requirements<span>.</span>txt</code></li><li><code>packages<span>.</span>config</code></li><li><code><span>.</span>csproj</code> files</li></ul><h3 id="Automated-dependency-scanning">Automated dependency scanning</h3><p>Once we know what dependencies are used in our project, it would be nice to scan them automatically and detect potential vulnerabilities. This is where automated dependency scanning can help. GitHub provides automated dependency alerts (using <a href="https://dependabot.com/" target="_blank" rel="noreferrer noopener">Dependabot</a>) that watch dependency graphs. It cross-references the target versions of your project&#39;s dependencies with the versions on known vulnerability lists aggregated in the <a href="https://github.com/advisories" target="_blank" rel="noreferrer noopener">GitHub Advisory Database</a>.</p><p>When a risk is detected, the project is alerted as presented in the picture below.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4W7rjQeVo8dH6lH51bfRdn/ea2f3f83ebd48ff46c4af4326ae0e1fb/dependency-scanning-example.png" alt="GitHub dependency scanning"/></p><p>This is not enough. To make it easier for developers, once a vulnerability is detected in one of the libraries used, an automatic pull request is created, which contains the upgraded version of that library.</p><p>We can enable the <em>Dependabot alerts</em> and the <em>Dependabot security updates</em> features accessing the <em>Security &amp; analysis</em> section under the <em>Settings</em> tab on GitHub, as in the picture below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/bwJP4ppPL73UEvIp1r9cD/b9a3883afba99ca0aa4e225c3fb53d1c/dependabot-alerts-configuration.png" alt="GitHub security updates"/></p><h3 id="Secret-scanning">Secret scanning</h3><p>Storing secrets and credentials in any source code repository is a bad practice. When a push is done to a public repository, GitHub scans the content of the commits for secrets and credentials.</p><p>What is more, GitHub detects known types of secrets from different providers like Adobe, Microsoft Azure, Atlassian, Dropbox, and so on.</p><p>When a secret is detected, the repository owner is alerted. The below picture presents the scanning flow.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3r4yctOqQmbX9K7TEyfKyS/e0697600af24c0de9c62e62cf2f49edd/secret-scanning-example-flow.png" alt="GitHub secret scanning"/></p><p>[<a href="https://docs.github.com/en/developers/overview/secret-scanning-partner-program#how-secret-scanning-works-in-a-public-repository" target="_blank" rel="noreferrer noopener"><em>Source: GitHub</em></a>]</p><p>Once a new push with a secret embedded in the source code is done, GitHub applies regex scanning to verify if there is any secret with a known pattern. If a secret is detected, GitHub sends the found secret value to a service provider&#39;s verify endpoint. If verification is successful, the secret is revoked and an email alert is sent to the source code repository owner.</p><p>Secret scanning is available for all public repositories and for private repositories owned by organizations where <em>GitHub Advanced Security</em> is enabled. You can read more about <a href="https://docs.github.com/en/developers/overview/secret-scanning-partner-program" target="_blank" rel="noreferrer noopener">the secret scanning partner program here</a>.</p><h3 id="Security-policy">Security policy</h3><p>Automated scanning is helpful, but it is also important to provide a way for other developers and people who use/contribute to our project, in general, to report found vulnerabilities. We can facilitate reporting security issues by providing a <code><span>SECURITY</span><span>.</span>md</code> file in the repository&#39;s <code>root</code>, <code>docs</code>, or <code><span>.</span>github</code> folders. This file provides guidance on how to report vulnerability and contact the repository owner or which versions are supported with security updates. Providing guidance through this file can speed up the resolution of critical issues. When someone creates an issue in our repository, they will see a link to our project&#39;s security policy.</p><p>The following picture shows the document you can find in our sample project:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/37g2XyZ40VmAOoxWCaoSob/ed480113688b023108dcf774e14e9aaa/security-policy-document.png" alt="GitHub security policy"/></p><p>By convention, the <code><span>SECURITY</span><span>.</span>md</code> file lives in the root of our GitHub repository. There is no default template for security policy. However, we should try to put at least our contact information and explain how reported security issues can be verified. The security policy file is part of <a href="https://docs.github.com/en/communities/setting-up-your-project-for-healthy-contributions/creating-a-default-community-health-file" target="_blank" rel="noreferrer noopener">default community health files</a> on GitHub, so it means that we have to name it exactly in this way: <code><span>SECURITY</span><span>.</span>md</code>.</p><h3 id="Automated-code-scanning">Automated code scanning</h3><p>With <a href="https://github.com/features/actions" target="_blank" rel="noreferrer noopener">GitHub Actions</a>, we can enable automated code scanning so that each time a new merge is done, our code will be scanned. With code scanning enabled, we can analyze and find security vulnerabilities and errors in the code hosted in our GitHub repository.</p><p>GitHub provides a built-in code scanning tool called CodeQL, but we can integrate other third-party tools, of course. Adding code scanning is useful to help prevent developers from introducing any new security problems into the source code. Code scanning can also help improve our code quality.</p><p>At a high level, CodeQL is an analysis engine used by developers to automate security checks, and by security researchers to perform variant analysis. In the following section, we will discover how to enable code scanning with CodeQL and what configuration options are available. To learn more about CodeQL, <a href="https://codeql.github.com" target="_blank" rel="noreferrer noopener">check out the official documentation</a>. </p><h2 id="Repository-Code-Scanning-with-CodeQL">Repository Code Scanning with CodeQL</h2><p>When using CodeQL, our source code is treated as data. Security vulnerabilities, bugs, and other errors are modeled as queries that can be executed against databases extracted from source code. There are three main steps in CodeQL analysis:</p><ol start="1"><li><em>Preparation</em>, preparing the code by creating a CodeQL database.</li><li><em>Analysis</em>, running CodeQL queries against the database.</li><li><em>Interpretation</em>, interpreting the query results to check if any vulnerabilities or code bugs were found.</li></ol><p>CodeQL can be used to scan many different languages like C++, C#, Java, or Phyton. We can use multiple queries when CodeQL scanning is done. To make it easier, we can use <a href="https://codeql.github.com/docs/codeql-cli/creating-codeql-query-suites/" target="_blank" rel="noreferrer noopener">query suites</a>. CodeQL query suites are <code><span>.</span>qls</code> files that allow us to pass multiple queries to CodeQL without having to specify the path to each query file individually.</p><p>In the following, we are going to see how to use the <em>Security and Quality</em> query suite to detect bugs and security issues in the source code.</p><p>To enable CodeQL scanning, we open the <em>Security</em> section and select <em>Code scanning alerts</em>. Then we click the <em>Setup this workflow</em> button within the <em>CodeQL Analysis</em> item.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2dyxIKUmdQ8IfK0SZlxEST/fc4fd8563df833edb5c862731cb0bd32/codeql-setup.png" alt="GitHub security policy"/></p><p>Now, replace the default code of the workflow with the following.</p><pre><code><span>name</span><span>:</span> <span>&#34;Build and scan project with CodeQL&#34;</span>

<span>on</span><span>:</span>
  <span>pull_request</span><span>:</span>
    <span>branches</span><span>:</span> <span>[</span> main <span>]</span>

<span>jobs</span><span>:</span>
  <span>analyze</span><span>:</span>
    <span>name</span><span>:</span> analyze
    <span>runs-on</span><span>:</span> ubuntu<span>-</span>latest
    <span>permissions</span><span>:</span>
      <span>actions</span><span>:</span> read
      <span>contents</span><span>:</span> read
      <span>security-events</span><span>:</span> write

    <span>strategy</span><span>:</span>
      <span>fail-fast</span><span>:</span> <span>false</span>
      <span>matrix</span><span>:</span>
        <span>language</span><span>:</span> <span>[</span> <span>&#39;csharp&#39;</span> <span>]</span>

    <span>steps</span><span>:</span>
    <span>-</span> <span>name</span><span>:</span> Checkout repository
      <span>uses</span><span>:</span> actions/checkout@v2

    <span>-</span> <span>name</span><span>:</span> Initialize CodeQL
      <span>uses</span><span>:</span> github/codeql<span>-</span>action/init@v1
      <span>with</span><span>:</span>
        <span>languages</span><span>:</span> $<span>{</span><span>{</span> matrix.language <span>}</span><span>}</span>
        <span>config-file</span><span>:</span> .github/workflows/codeql/codeql<span>-</span>config.yml

    <span>-</span> <span>name</span><span>:</span> Autobuild
      <span>uses</span><span>:</span> github/codeql<span>-</span>action/autobuild@v1

    <span>-</span> <span>name</span><span>:</span> Perform CodeQL Analysis
      <span>uses</span><span>:</span> github/codeql<span>-</span>action/analyze@v1</code></pre><p>Once replacing the existing code, we can commit the <a href="https://github.com/Daniel-Krzyczkowski/Globomantics-Games/blob/main/.github/workflows/codeql-analysis.yml" target="_blank" rel="noreferrer noopener"><code>codeql<span>-</span>analysis<span>.</span>yml</code></a> generated file. Now, let&#39;s discuss its structure.</p><p>First of all, we can decide when to run the scanning. In our case, the scanning is executed once a pull request is created to merge changes into the <code>main</code> branch. In the <code>jobs</code> section, we declare a runner environment specified by <code>runs<span>-</span>on</code>. By specifying the permission within a job definition, you can configure a different set of permissions for the <a href="https://docs.github.com/en/actions/reference/authentication-in-a-workflow#about-the-github_token-secret" target="_blank" rel="noreferrer noopener"><code><span>GITHUB_TOKEN</span></code></a> for each job, if required. You can read more about job permissions in the <a href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions" target="_blank" rel="noreferrer noopener">official documentation</a>.</p><p>In the <code>strategy</code> section, we can declare the languages for which scanning should be applied in the project. In our case, we want to scan for the C# language. We declare the languages in the <code>matrix</code> section. With <code>fail<span>-</span>fast</code> set to <code><span>false</span></code>, we avoid breaking the whole workflow if scanning fails for one of the declared languages.</p><p>In the <code>steps</code> section, there are the steps of the full process:</p><ol start="1"><li><em>Checkout repository</em>, to checkout project&#39;s code for scanning.</li><li><em>Initialize CodeQL</em>, to initialize CodeQL scanning for the languages declared in the <code>matrix</code> section. In the <a href="https://github.com/auth0-blog/Globomantics-Games/tree/main/.github/workflows/codeql" target="_blank" rel="noreferrer noopener"><code>config<span>-</span>file</code></a> section, we can provide a path to the <code>codeql<span>-</span>config<span>.</span>yml</code> file where we declare the query suites which to use during the scanning. In this case, we use the <code>security<span>-</span>and<span>-</span>quality</code> query suite. The <code>codeql<span>-</span>config<span>.</span>yml</code> file is not mandatory, but it helps to keep the CodeQL scanning script more readable. We can also use this file to disable the default queries and to specify which directories to scan during the analysis.</li><li><em>Autobuild</em>, to build source code.</li><li><em>Perform CodeQL Analysis</em>, to perform the analysis and publish the report.</li></ol><p>Here is the content of the <code>codeql<span>-</span>config<span>.</span>yml</code> file:</p><pre><code><span>name</span><span>:</span> <span>&#34;Security and Quality&#34;</span>

<span>queries</span><span>:</span>
  <span>-</span> <span>name</span><span>:</span> Security and Quality
    <span>uses</span><span>:</span> security<span>-</span>and<span>-</span>quality</code></pre><p>Once the scanning is completed, we can check the report under the <em>Security</em> tab in the <em>Code scanning alerts</em> section:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4vrcomaZxQHXWWRAxL0evU/bf5028ce02c9da560b855c108f28eca8/codeql-analysis-result-example.png" alt="CodeQL Analysis result"/></p><p>In the report above, we can see a recommendation to check if the variable is null first and then try to access it instead of catching a <code>NullReferenceException</code>. With CodeQL, we can discover many different security issues and get hints on how to improve our code quality and eliminate potential bugs. I recommend learning more about CodeQL analysis by reading the <a href="https://docs.github.com/en/code-security/secure-coding/automatically-scanning-your-code-for-vulnerabilities-and-errors/about-code-scanning" target="_blank" rel="noreferrer noopener">official documentation</a>.</p><h2 id="License-Compliance-Management">License Compliance Management</h2><p>When talking about open-source software, it is important to remember about license compliance. There are many different types of licenses, and we have to carefully verify them before we use an open-source library in one of our projects. The most commonly used open-source licenses are:</p><ul><li>GNU General Public License (GPL)</li><li>The Apache License</li><li>MIT License</li><li>GNU Less General Public License (LGPL)</li></ul><p>For instance, GPL is a copyleft license. Using a copyleft license means that software products containing an open source copyleft license must be released with the same copyleft license. So, if we use a GPL-licensed library in our software, we cannot distribute it with an MIT license, for example.</p><p>MIT is a permissive license. Software licensed under the MIT license can be used and modified without limits ‚Äî  as long as a copy of the original MIT license and a copyright notice are added to it.</p><p>So, we have to be careful in this case because this can be problematic when we want to commercialize our software product.</p><p>GitHub does not provide a license scanning feature by default. Third-party tools can be used to set up license scanning. For example, <a href="https://snyk.io/" target="_blank" rel="noreferrer noopener">Snyk</a> is one of these third-party tools. With <a href="https://snyk.io/product/open-source-license-compliance/" target="_blank" rel="noreferrer noopener">Snyk Open Source License Compliance Management</a>, we can scan our project and verify what licenses are used in the libraries we use.</p><p>Snyk license scanning is available in the paid plan, but a 14 days trial version is also available. Once we sign in to <a href="https://app.snyk.io/login" target="_blank" rel="noreferrer noopener">app.snyk.io</a> using a GitHub account, we can select which project we would like to scan. In our case, let&#39;s continue using Snyk without granting direct permissions to the repository on GitHub. We will see how to connect GitHub to the Snyk API in a while. So, let&#39;s click <em>Continue without permissions</em> as presented below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2A2DFxw6sExHnkNarFmWhf/6a976312ba2f07f2ad55de49ad18b73e/snyk-setup-page.png" alt="Snyk setup"/></p><p>In the next section, we provide the URL to our public repository on GitHub. In our case, it is <a href="https://github.com/Daniel-Krzyczkowski/Globomantics-Games" target="_blank" rel="noreferrer noopener">https://github.com/auth0-blog/Globomantics-Games)</a>. Then, let&#39;s click the <em>Import 1 repository</em> button. Once we are signed in, we can activate the 14 days trial by clicking the <em>Start free trial</em> button. </p><p>At this point, let&#39;s click the gear icon in the right top corner of the Snyk website. From the left bar, we have to switch to <em>Licenses</em>. This is where we can see the list of all available licenses discovered in our project once the Snyk license scanning is applied.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/57l8aP1R9XKBS0omyVJZje/55e437274f187016d4a2b6d227adf2ee/snyk-detected-licenses.png" alt="Snyk license scanning"/></p><p>As we can see in the picture above, we can assign different levels of severity to specific license types (<code>None</code>, <code>Low</code>, <code>Medium</code>, or <code>High</code>). Let&#39;s select the <code>Apache<span>-</span><span>2.0</span></code> license from the list. We can add instructions on what should be exactly verified when this type of license is found in our project. Notice that <em>Severity</em> is set to <code>Medium</code>.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5PgRmN2iL2QbATBMRD0iN/4ad13bdd82078dc048ad688b95a81c16/apache-license-snyk.png" alt="Apache license in Snyk"/></p><p>Now, to enable Snyk scanning on our code, we need to obtain an access token from Synk and store it under the <em>Secrets</em> section on GitHub. So, let&#39;s click the avatar in the right top corner, and from the list, select <em>Account settings</em>. Under the <em>Auth Token</em> section, let&#39;s click <code>Click to show</code> to display the token. Finally, let&#39;s copy the token so that we can use it in the GitHub Actions workflow responsible for the license scanning.</p><p>Back on GitHub, we click the <em>Secrets</em> tab and select <em>Secrets</em>. We paste the token obtained from Snyk by using  the <em>New repository secret</em> button. Once the secret is saved, it should be displayed on the list.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/DOmT8mdLi0bfEPL06C5ei/3be9cc44abfd0909589e16fc95f49196/snyk-token-secret-on-github.png" alt="Snyk token configuration on GitHub"/></p><p>Now it is time to add the Snyk scanning workflow using GitHub Actions. Under the <code><span>.</span>github<span>/</span>workflows</code> folder (the same where we put <code>codeql<span>-</span>analysis<span>.</span>yml</code> file for CodeQL scanning), we have to place the <a href="https://github.com/auth0-blog/Globomantics-Games/blob/main/.github/workflows/snyk-license-scanning.yml" target="_blank" rel="noreferrer noopener"><code>snyk<span>-</span>license<span>-</span>scanning<span>.</span>yml</code></a> file with the following content:</p><pre><code><span>name</span><span>:</span> <span>&#34;Build and scan project with Snyk&#34;</span>

<span>on</span><span>:</span>
  <span>push</span><span>:</span>
    <span>branches</span><span>:</span> <span>[</span> main <span>]</span>

<span>jobs</span><span>:</span>
  <span>build-and-scan</span><span>:</span>
    <span>runs-on</span><span>:</span> ubuntu<span>-</span>latest

    <span>steps</span><span>:</span>
    <span>-</span> <span>uses</span><span>:</span> actions/checkout@v2

    <span>-</span> <span>name</span><span>:</span> Setup .NET
      <span>uses</span><span>:</span> actions/setup<span>-</span>dotnet@v1
      <span>with</span><span>:</span>
        <span>dotnet-version</span><span>:</span> 5.0.x
    <span>-</span> <span>name</span><span>:</span> Restore dependencies
      <span>run</span><span>:</span> dotnet restore ./src/web<span>-</span>game/Globomantics.sln
    <span>-</span> <span>name</span><span>:</span> Build
      <span>run</span><span>:</span> dotnet build ./src/web<span>-</span>game/Globomantics.sln <span>-</span><span>-</span>no<span>-</span>restore
    <span>-</span> <span>name</span><span>:</span> Test
      <span>run</span><span>:</span> dotnet test ./src/web<span>-</span>game/Globomantics.sln <span>-</span><span>-</span>no<span>-</span>build <span>-</span><span>-</span>verbosity normal


    <span>-</span> <span>name</span><span>:</span> Run Snyk to check for vulnerabilities
      <span>uses</span><span>:</span> snyk/actions/dotnet@master
      <span>continue-on-error</span><span>:</span> <span>true</span> <span># To make sure that SARIF upload gets called</span>
      <span>env</span><span>:</span>
        <span>SNYK_TOKEN</span><span>:</span> $<span>{</span><span>{</span> secrets.SNYK_TOKEN <span>}</span><span>}</span>
      <span>with</span><span>:</span>
        <span>args</span><span>:</span> <span>-</span><span>-</span>sarif<span>-</span>file<span>-</span>output=snyk.sarif <span>-</span><span>-</span>file=./src/web<span>-</span>game/Globomantics.sln <span>-</span><span>-</span>severity<span>-</span>threshold=medium


    <span>-</span> <span>name</span><span>:</span> Upload result to GitHub Code Scanning
      <span>uses</span><span>:</span> github/codeql<span>-</span>action/upload<span>-</span>sarif@v1
      <span>with</span><span>:</span>
        <span>sarif_file</span><span>:</span> snyk.sarif</code></pre><p>Let&#39;s discuss its structure. We want to execute the scanning when a push to the <code>main</code> branch occurs. In the <code>jobs</code> section, we declare a runner environment specified by <code>runs<span>-</span>on</code>. In the <code>steps</code> section, there are a few required steps:</p><ol start="1"><li><em>Checkout repository</em>, to checkout project&#39;s code for scanning.</li><li><em>Setup .NET</em>, which includes restoring dependencies with the <code>dotnet restore</code> command, then <code>dotnet build</code> to build project, and <code>dotnet test</code> to run tests if they exist in the solution.</li><li><em>Run Snyk to check for vulnerabilities</em>, which communicates with the Snyk API to apply the code scanning. Notice that we have to fill <code><span>SNYK_TOKEN</span></code> with the value we put in the <code>Secrets</code> section. There are also a few arguments: 
<ul><li>The <code><span>--</span>sarif<span>-</span>file<span>-</span>output<span>=</span>snyk<span>.</span>sarif</code> argument provides the name of the file which contains the scanning report.</li><li>The <code><span>--</span>file<span>=</span><span>.</span><span>/</span>src<span>/</span>web<span>-</span>game<span>/</span>Globomantics<span>.</span>sln</code> argument provides the path to the project/solution.</li><li>The <code><span>--</span>severity<span>-</span>threshold<span>=</span>medium</code>- parameter is used to report alerts with severity <code>Medium</code> and above.</li></ul></li><li><em>Upload result to GitHub Code Scanning</em>, which is responsible for uploading the scanning result so that we can see it under the <em>Security</em> tab.</li></ol><p>Once we push any changes to the <code>main</code> branch, the scanning will be triggered. Let&#39;s check the scanning report shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2lM81Cue8ALxnT6u9sFDUs/48b9c563e78651709486ce66c97d5b43/snyk-license-scanning-result.png" alt="License scanning report"/></p><p>As we can see above, the <code>Apache<span>-</span><span>2.0</span></code> license was found in one of the libraries we use: <code>Serilog</code>. Once we click on the alert, we can see the details shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7MCT0ERLSfTmqB3ztLalum/0a3209ecfbeb15549b351938e2e5b10e/snyk-license-scanning-details.png" alt="License scanning details"/></p><p>We can see that the <code>Serilog</code> library uses <code>Apache<span>-</span><span>2.0</span></code> license, and we included this package in the <code>Globomantics<span>.</span>CloudGame</code> project using the NuGet package manager. The reason why we see this alert is the fact that we set the <code><span>--</span>severity<span>-</span>threshold</code> parameter to <code>Medium</code>. In this case, we will be alerted whenever there is a library used in our project with the license for which we set the severity to <code>Medium</code> in the Snyk configuration.</p><h2 id="Conclusion">Conclusion</h2><p>In this article, we discovered how to enable and use GitHub security features to improve code security and software supply chain. We learned how to enable automated dependency scanning and updates, enable scanning with CodeQL, and verify license compliance using Snyk.</p><p>If you want to know more about what learned in this article, please check out the following documentation:</p><ul><li><a href="https://www.youtube.com/watch?v=hln5v7odguE" target="_blank" rel="noreferrer noopener">Achieving DevSecOps with GitHub Advanced Security</a></li><li><a href="https://docs.github.com/en/code-security/secure-coding/using-codeql-code-scanning-with-your-existing-ci-system/configuring-codeql-runner-in-your-ci-system" target="_blank" rel="noreferrer noopener">Configuring CodeQL runner in your CI system</a></li><li><a href="https://docs.microsoft.com/en-us/azure/architecture/solution-ideas/articles/devsecops-in-github" target="_blank" rel="noreferrer noopener">DevSecOps in GitHub</a></li><li><a href="https://docs.microsoft.com/en-us/learn/modules/maintain-secure-repository-github/" target="_blank" rel="noreferrer noopener">Maintain a secure repository by using GitHub best practices</a></li></ul><div><h2 id="Aside--Securing-ASP-NET-Core-with-Auth0">Aside: Securing ASP.NET Core with Auth0</h2><p>Securing ASP.NET Core applications with Auth0 is easy and brings a lot of great features to the table. With <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>, you only have to write a few lines of code to get a solid <a href="https://auth0.com/user-management" target="_blank" rel="noreferrer noopener">identity management solution</a>, <a href="https://auth0.com/docs/sso/single-sign-on" target="_blank" rel="noreferrer noopener">single sign-on</a>, support for <a href="https://auth0.com/docs/identityproviders" target="_blank" rel="noreferrer noopener">social identity providers (like Facebook, GitHub, Twitter, etc.)</a>, and support for <a href="https://auth0.com/enterprise" target="_blank" rel="noreferrer noopener">enterprise identity providers (like Active Directory, LDAP, SAML, custom, etc.)</a>.</p><p>On ASP.NET Core, you need <a href="https://auth0.com/docs/apis" target="_blank" rel="noreferrer noopener">to create an API in your Auth0 Management Dashboard</a> and change a few things on your code. To create an API, you need to <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free Auth0 account</a>. After that, you need to go to <a href="https://manage.auth0.com/#/apis" target="_blank" rel="noreferrer noopener">the API section of the dashboard</a> and click on &#34;Create API&#34;. On the dialog shown, you can set the <em>Name</em> of your API as &#34;Books&#34;, the <em>Identifier</em> as &#34;<a href="http://books.mycompany.com" target="_blank" rel="noreferrer noopener">http://books.mycompany.com</a>&#34;, and leave the <em>Signing Algorithm</em> as &#34;RS256&#34;.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6HrObJ2eGY7YehLzbBM0sH/066be814a124d98f03224d9b177caa22/net-core-2_creating-api-on-auth0.png" alt="Creating API on Auth0"/></p><p>After that, you have to add the call to <code>services<span>.</span><span>AddAuthentication</span><span>(</span><span>)</span></code> in the <code><span>ConfigureServices</span><span>(</span><span>)</span></code> method of the <code>Startup</code> class as follows:</p><pre><code><span><span>string</span></span> authority <span>=</span> <span><span>$&#34;https://</span><span><span>{</span><span>Configuration<span>[</span><span>&#34;Auth0:Domain&#34;</span><span>]</span></span><span>}</span></span><span>/&#34;</span></span><span>;</span>
<span><span>string</span></span> audience <span>=</span> Configuration<span>[</span><span>&#34;Auth0:Audience&#34;</span><span>]</span><span>;</span>

services<span>.</span><span>AddAuthentication</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  options<span>.</span>DefaultAuthenticateScheme <span>=</span> JwtBearerDefaults<span>.</span>AuthenticationScheme<span>;</span>
  options<span>.</span>DefaultChallengeScheme <span>=</span> JwtBearerDefaults<span>.</span>AuthenticationScheme<span>;</span>
<span>}</span><span>)</span><span>.</span><span>AddJwtBearer</span><span>(</span>options <span>=&gt;</span>
<span>{</span>
  options<span>.</span>Authority <span>=</span> authority<span>;</span>
  options<span>.</span>Audience <span>=</span> audience<span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><p>In the body of the <code><span>Configure</span><span>(</span><span>)</span></code> method of the <code>Startup</code> class, you also need to add an invocation to <code>app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span></code> and <code>app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span></code> as shown below:</p><pre><code>app<span>.</span><span>UseRouting</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthentication</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseAuthorization</span><span>(</span><span>)</span><span>;</span>
app<span>.</span><span>UseEndpoints</span><span>(</span>endpoints <span>=&gt;</span>
<span>{</span>
    endpoints<span>.</span><span>MapControllers</span><span>(</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span></code></pre><blockquote><p>Make sure you invoke these methods in the order shown above. It is essential so that everything works properly.</p></blockquote><p>Finally, add the following element to the <code>appsettings<span>.</span>json</code> configuration file:</p><pre><code><span>{</span>
  <span>&#34;Logging&#34;</span><span>:</span> <span>{</span>
    <span>// ...</span>
  <span>}</span><span>,</span>
  <span>&#34;Auth0&#34;</span><span>:</span> <span>{</span>
    <span>&#34;Domain&#34;</span><span>:</span> <span>&#34;YOUR_DOMAIN&#34;</span><span>,</span>
    <span>&#34;Audience&#34;</span><span>:</span> <span>&#34;YOUR_AUDIENCE&#34;</span>
  <span>}</span>
<span>}</span></code></pre><blockquote><p><strong>Note</strong>: Replace the placeholders <code><span>YOUR_DOMAIN</span></code> and <code><span>YOUR_AUDIENCE</span></code> with the actual values for the domain that you specified when creating your Auth0 account and the <em>Identifier</em> you assigned to your API.</p></blockquote></div></div></div>]]></content:encoded>
      <pubDate>Mon, 23 Aug 2021 17:03:00 +0000</pubDate>
    </item>
    <item>
      <title>What Is LGPD? A Business Guide To Brazil&#39;s Data Protection Law</title>
      <link>https://auth0.com/blog/what-is-lgpd-a-business-guide-to-brazils-data-protection-law/</link>
      <description>LGPD carries implications for businesses beyond Brazil‚Äôs borders. Here‚Äôs what execs need to know.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Lei Geral de Prote√ß√£o de Dados Pessoais (LGPD or General Personal Data Protection Law) is Brazil‚Äôs data protection and privacy law that is closely modeled on the General Data Protection Regulation (GDPR) in the European Union. LGPD was passed by the National Congress of Brazil on July 10, 2018, in an effort to unify and enhance 40+ data privacy instruments within the country into a single piece of legislation. LGPD went into effect on September 18, 2020. Like the GDPR, the law impacts global organizations beyond Brazil‚Äôs borders.</p><p>The extent to which LGPD applies to your organization will depend on the specific nature of your business, so you should always seek skilled legal counsel to help you navigate compliance requirements. However, if your organization does business in Brazil or collects/processes the data of any individual within Brazil, you should familiarize yourself with LGPD‚Äôs requirements (summarized below) to understand what impact these regulations may have on you.</p><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"></path><path d="M22 4L12 14.01l-3-3"></path></svg><p><strong>Important Information</strong><br/><b></b></p><p>The following information is not intended as legal advice, and readers should consult with their attorneys about matters of compliance.<br/> </p></div><h2 id="Why-LGPD-Was-Passed">Why LGPD Was Passed</h2><p>LGPD was passed to demonstrate and protect individuals‚Äô right to privacy. Despite Brazil being <a href="https://www.launchwaymedia.com/blog/brazil-latin-americas-technology-leader" target="_blank" rel="noreferrer noopener">Latin America‚Äôs technology leader</a> and <a href="https://www.zdnet.com/article/it-investments-in-brazil-surpass-world-average/" target="_blank" rel="noreferrer noopener">one of the top 10 tech markets</a> in the world, its data protection laws have failed to keep pace with this technological growth. As a side-effect of that rapid growth, Brazil has experienced a number of recent <a href="https://portswigger.net/daily-swig/brazil-reaches-towards-cybersecurity-maturity" target="_blank" rel="noreferrer noopener">high-profile data breaches</a>. LGPD establishes a clear requirement for organizations to implement controls that protect individuals‚Äô personal data, with the end goal of reducing the impact of breaches on individuals.</p><p>In addition to introducing privacy regulations, the LGPD also established a separate national authority, the Autoridade Nacional de Prote√ß√£o de Dados (ANPD or National Data Protection Authority in English), which is responsible for enforcing the law, including issuing penalties and fines. The creation of the ANPD was originally vetoed by President Jair Bolsonaro but later reinstated via <a href="https://www.mondaq.com/brazil/data-protection/818496/provisional-measure-no-86918-creates-the-brazilian-data-protection-authority-and-amends-several-articles-of-the-brazilian-general-data-protection-law" target="_blank" rel="noreferrer noopener">executive order</a> in August of 2020.</p><h2 id="Who-LGPD-Applies-To">Who LGPD Applies To</h2><p>LGPD applies to any organization (or individual) regardless of size, industry, public or private status, or country of residence.</p><p>Any legal entity or natural person processing data collected from persons in Brazil (‚Äúdata controller‚Äù) is subject to LGPD if:</p><ul><li>The data collected/processed is about people in Brazil.</li><li>The processing is carried out <strong>inside Brazil;</strong> or</li><li>The processing is for the purposes of offering and selling goods or services to individuals in Brazil.</li><li>The processing is of personal data collected within Brazil.</li></ul><h3 id="Exceptions">Exceptions</h3><p>There are some limited exceptions to the applicability of LGPD. Exceptions include situations where the data is being collected and/or processed:</p><ul><li>By a natural person for private and non-commercial purposes.</li><li>For journalistic, artistic, or academic purposes, regardless of who does the collecting.</li><li>For the purposes of national security, defense, or public safety.</li><li>For investigating and prosecuting criminal offenses.</li><li>If the personal data originates in other countries and only passes through Brazil without any processing being carried out.</li></ul><h2 id="LGPD-Includes-a-Broad-Definition-of-Personal-Data">LGPD Includes a Broad Definition of Personal Data</h2><p><a href="https://iapp.org/resources/article/brazilian-data-protection-law-lgpd-english-translation/" target="_blank" rel="noreferrer noopener">LGPD defines</a> personal data broadly as any information that could be used to identify an individual. This includes any information that could be combined with other information to identify an individual. That means information such as email, IP addresses, phone numbers, geolocation, and credit card numbers can all be considered personal information under LGPD.</p><h3 id="Sensitive-Personal-Data">Sensitive Personal Data</h3><p>Brazil has a culturally and racially diverse population. Like Europe‚Äôs GDPR, LGPD recognizes that additional protections are sometimes needed to protect individuals against discrimination. These potentially higher-risk attributes are defined as ‚Äúsensitive personal data‚Äù under LGPD and include:</p><ul><li>Health information</li><li>Genetic information</li><li>Sexual information</li><li>Medical information</li><li>Biometric characteristics</li><li>Racial or ethnic origin information</li><li>Political affiliations</li><li>Religious affiliations</li></ul><h2 id="LGPD-Compliance-Obligations">LGPD Compliance Obligations</h2><p>LGPD is a significant enhancement and consolidation of Brazil‚Äôs previous data privacy laws, and the changes will affect organizations in every industry. Below are some of the key compliance considerations businesses will need to consider.</p><h3 id="1--Define-and-Document-Lawful-Basis-for-Processing-Personal-Data">1. Define and Document Lawful Basis for Processing Personal Data</h3><p>LGPD requires every organization that collects or processes personal data to have at least one of the following legally acceptable reasons for doing so, as well as to document those reasons for auditing purposes.</p><ul><li><strong>Consent from an individual to process their data.</strong> Any individual over the age of 18 can consent to the processing of their personal data.</li><li><strong>To follow applicable regulatory requirements and public policies.</strong> Organizations can collect and process data if it is required in order to follow laws and regulations that apply to them.</li><li><strong>For the purpose of conducting a study or research.</strong> Research is a legal basis for personal data processing, as long as organizations take reasonable steps to anonymize that data.</li><li><strong>To fulfill a contractual agreement.</strong> Processing an individual&#39;s personal data is acceptable if you‚Äôve signed a contract with that individual to deliver goods or services and need to process their data to provide it to them.</li><li><strong>Legal proceedings.</strong> Personal data may be processed for the sake of a court case, arbitration, or other legal proceedings.</li><li><strong>To protect the life or physical safety of an individual or a third party.</strong> For example, national security is a legally acceptable reason to process personal data.</li><li><strong>To protect an individual‚Äôs health in healthcare procedures.</strong> For example, it‚Äôs acceptable to process personal data to ensure you‚Äôre not putting a patient at risk during surgery.</li><li><strong>For the legitimate interests of your organization or a third party.</strong> Your organization‚Äôs interests are a legal basis for processing personal data, as long as those interests do not conflict with the rights, freedoms, or interests of an individual.</li><li><strong>For the sake of protecting an individual‚Äôs credit.</strong> Protecting an individual‚Äôs credit is an acceptable basis for processing data, as long as that processing is done in accordance with the provisions laid out in other relevant legislation in addition to LGPD.</li></ul><h3 id="2--Honor-the-Privacy-Rights-of-Individuals">2. Honor the Privacy Rights of Individuals</h3><p>Like GDPR, LGPD provides individuals with several rights that they can request organizations to recognize and uphold at any time. Organizations must have internal procedures and processes in place to respond to requests from individuals who exercise these rights, which include:</p><ul><li><strong>Confirmation of processing.</strong> Individuals have the right to confirm whether their personal data has been or is being processed.</li><li><strong>Access to personal data.</strong> Individuals may request access to any of their personal data that an organization processes.</li><li><strong>Data portability.</strong> Individuals may request that their personal data be transferred to another service or product provider, as long as that request is in accordance with other national regulations, doesn‚Äôt compromise any commercial or industrial secrets, and the data hasn‚Äôt already been anonymized.</li><li><strong>Rectification of inaccurate information.</strong> Individuals may request that inaccurate, outdated, or incomplete personal data be corrected or updated.</li><li><strong>Anonymization, blocking, or deletion of data.</strong> Individuals can request that unnecessary or excessive personal data, or personal data processed in a non-compliant manner, be anonymized, blocked, or deleted.</li><li><strong>Deletion of data.</strong> Individuals may request to have their personal data deleted at any time where processing is based on consent.</li><li><strong>Right to be informed.</strong> Individuals have the right to be informed about third parties granted access to their personal data. Individuals also have the right to be informed regarding their right to refuse consent.</li><li><strong>Withdrawal of consent.</strong> Individuals have the right to revoke their consent to process or collect data at any time.</li><li><strong>Review of automated decisions.</strong> Individuals have the right to request the review of decisions solely based on automated processing that affects their interests, including profiling.</li><li><strong>Filing complaints.</strong> Individuals may file a complaint against an organization with the ANPD if they feel that any of these rights have been violated.</li></ul><h3 id="3--Appoint-a-Data-Protection-Officer--DPO-">3. Appoint a Data Protection Officer (DPO)</h3><p>The LGPD requires every organization under its jurisdiction to appoint a data protection officer (DPO) to be their point person for data protection efforts. The DPO does not have to be an individual person; a committee can provide this service, as can an outside consultant. The DPO is responsible for ensuring that the organization takes appropriate action to protect personal data and for communicating with end-users and government authorities on matters related to data privacy. The identity and contact information of the DPO must be available to the public (preferably on your website).</p><h3 id="4--Prepare--Inventory--and-Conduct-Data-Protection-Impact-Assessments--DPIA-">4. Prepare, Inventory, and Conduct Data Protection Impact Assessments (DPIA)</h3><p>To comply with LGPD, you must document the types of data you‚Äôre collecting, the methods used, along the steps taken to secure that data. You must also identify potential risks and document what you‚Äôve done to mitigate them. Every organization that falls under LGPD‚Äôs jurisdiction should have these records on hand to show to a regulator upon request.</p><h3 id="5--Follow-Data-Security-Requirements-and-Data-Breach-Notification-Protocols">5. Follow Data Security Requirements and Data Breach Notification Protocols</h3><p>Organizations must implement adequate organizational and technical controls in order to secure personal data from unauthorized access, deletion, alteration, sharing, or processing. In the event that a breach occurs that presents a risk or causes damage to individuals, organizations must notify the ANPD and individuals affected by the breach within a reasonable time period and include the following information:</p><ul><li>The type of personal data that was exposed and the individuals affected</li><li>The risks associated with the exposure of that data</li><li>The security measures in place to protect personal data (unless sharing this information would disclose industrial or commercial secrets)</li><li>What your organization is doing to mitigate the effects of the breach on the individuals at risk</li></ul><p>The ANPD may require an organization to take further steps, such as alerting the media about the breach or taking specific steps to mitigate the effects of the breach on affected individuals. These actions are assessed on a case-by-case basis.</p><h3 id="6--Implement-Privacy-by-Design">6. Implement Privacy by Design</h3><p>Like GDPR, LGPD requires organizations under its jurisdiction to design their data processing systems and procedures so that privacy is the default setting (the approach known as privacy by design) rather than adding privacy controls to those systems as an afterthought. Organizations should also be prepared to demonstrate the effectiveness of their data protection measures to the ANPD, as an audit could be conducted at any time.</p><h3 id="7--Comply-with-Cross-Border-Data-Transfer-Requirements">7. Comply with Cross-Border Data Transfer Requirements</h3><p>LGPD allows organizations to transfer protected personal data outside of Brazil if the laws of the country the data is transferred to provide adequate protection for that data. Adequacy of protection is determined by the ANPD. In the event that the protections offered by the receiving country are deemed inadequate by the ANPD, transfers may still be allowed if <a href="https://iapp.org/resources/article/brazilian-data-protection-law-lgpd-english-translation/" target="_blank" rel="noreferrer noopener">certain conditions</a> are met.</p><h2 id="Penalties-for-Non-Compliance">Penalties for Non-Compliance</h2><p>Under LGPD, penalties for non-compliance are assessed by the ANPD and can include fines of up to 2% of a company‚Äôs annual revenue to a maximum of 50 million Brazilian reais per violation (approximately ‚Ç¨7.5 million or $9M USD at the time of writing). The ANPD also has the authority to block access to or delete personal data from related databases and to partially or fully prohibit data processing activities in the event that a violation occurs. Additionally, the LGPD provides individuals with the right to seek civil damages for violations of their privacy, meaning organizations could face legal action from consumers in addition to fines assessed by regulators.</p><h2 id="Go-Beyond-Compliance">Go Beyond Compliance</h2><p>Regulations like LGPD and GDPR are landmark steps toward the protection of individuals‚Äô right to privacy. But their similarities should also serve as a wake-up call to organizations everywhere that data privacy will require a lot more than plugging in a new set of controls for their existing systems in the future.</p><p>Instead, businesses should look to build privacy functionality into their systems from the outset, considering the well-being of the end-user rather than just the legal requirements. Not only will this help them earn the <a href="https://hbr.org/2020/01/do-you-care-about-privacy-as-much-as-your-customers-do" target="_blank" rel="noreferrer noopener">trust of consumers</a>, but it will also likely simplify the process of complying with new regulations as they emerge.</p></div></div>]]></content:encoded>
      <author>LGPD Establishes the National Data Protection Authority</author>
      <pubDate>Thu, 19 Aug 2021 14:55:00 +0000</pubDate>
    </item>
    <item>
      <title>Salesforce Powers Customer Identity Plus with Auth0</title>
      <link>https://auth0.com/blog/salesforce-powers-customer-identity-plus-with-auth0/</link>
      <description>Salesforce/Auth0 partnership to help bridge identity silos for Salesforce customers</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In July of 2020, <a href="https://auth0.com/blog/auth0-announces-120m-seriesf-funding/" target="_blank" rel="noreferrer noopener">Salesforce Ventures led Auth0‚Äôs Series F funding round</a> to fuel continued innovation and go-to-market expansion, responding to global demand for a simple, extensible identity platform that provides secure access to any application. Since that time, Auth0 worked in conjunction with Salesforce to explore ways to work together to better harness the power of both companies and bring additional value to our combined customer base and to the broader market.</p><p>Auth0 is proud to announce our partnership with Salesforce to power identity for Salesforce Customer Identity Plus, <a href="https://www.salesforce.com/news/stories/salesforce-customer-identity-plus-helps-eliminate-identity-silos/" target="_blank" rel="noreferrer noopener">a new offering announced by Salesforce</a> that is available starting July 20, 2021, to Salesforce customers.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3CxRl1pNZ0M6LMcWnY5bwY/36f1b84872a53900c0eedc5137ee788e/Salesforce.png" alt="Salesforce"/></p><p>With enterprises striving to meet the evolving demands of digital engagement, the companies who are winning will deliver frictionless, secure user identity. This Salesforce and Auth0 partnership will help bridge identity data silos across channels to provide a single view of the customer, with a developer-friendly, extensible identity solution that scales to meet the needs of the world‚Äôs largest companies.  </p><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúWe‚Äôre proud to be partnering with Auth0, the leader in consumer identity as a service, to deliver Salesforce Customer Identity Plus. This will enable our customers to accelerate their digital transformation and provide their customers with frictionless pixel-perfect login &amp; registration experiences.‚Äù</p><p>David Brossard</p><p>Senior Director of Product Management</p><p>Salesforce</p></div><p>Salesforce as organizations increase the number of digital touchpoints like mobile apps and web portals, customers are forced to create new logins for each, making it difficult for organizations to gain a single, 360-degree view of the customer. Customer Identity Plus enables developers to easily integrate an identity layer into existing apps, creating a consistent customer experience.</p><p>Building on Salesforce‚Äôs vision to be the <a href="https://www.salesforce.com/products/platform/features/single-source-of-truth/" target="_blank" rel="noreferrer noopener">single source of truth for customer data</a>, Customer Identity Plus is a next generation CIAM (customer identity and access management) solution that provides the services to manage customer identities, enabling businesses to connect to all of your customers, apps, and products.</p><p><a href="https://www.salesforce.com/products/platform/products/identity/" target="_blank" rel="noreferrer noopener">Customer Identity Plus</a> bridges data silos so you can build a unified view of the customer to enrich digital interactions. Customer identities and profile data including opportunities, and customer service cases, are stored and maintained in Salesforce, which allows you to create consistent experiences with customers and partners across all lines of business, marketing, mobile, and web properties. Companies can now build deeper, richer relationships with customers and partners by creating and maintaining a single identity for interactions across all channels ‚Äî sales, service, and marketing user journeys.</p><p>For companies looking to accelerate their digital transformation strategies and need B2C (business-to-consumer) and B2B (business-to-business) scale from day one, Customer Identity Plus enables maximum performance and scalability. With Customer Identity Plus, developers get a <a href="https://auth0.com/docs/libraries" target="_blank" rel="noreferrer noopener">variety of SDKs right out of the box</a>, providing the flexibility to seamlessly integrate an identity layer into existing applications.</p><p>Customer Identity Plus brings the power and flexibility of Auth0‚Äôs identity-as-a-service (IDaaS) to complement Salesforce‚Äôs customer-focused cloud offerings, including Sales Cloud, Experience Cloud, and Commerce Cloud.</p><p>Auth0 accelerates and extends customer identity for Salesforce customers, enabling you to:</p><ul><li>Create a Seamless Customer Experience ‚Äî Allow consumers to quickly register and log into your applications with <a href="https://auth0.com/docs/connections/passwordless" target="_blank" rel="noreferrer noopener">passwordless login</a> or <a href="https://auth0.com/docs/connections/identity-providers-social" target="_blank" rel="noreferrer noopener">social login</a>, all out of the box.</li><li>Enable a Single View of the Customer ‚Äî Unify digital identities from multiple sources so you can build a single view of the customer to enrich digital transactions and report on login activities.</li><li>Administer Contextual Security ‚Äî Balance great UX with adaptive security to <a href="https://auth0.com/docs/attack-protection" target="_blank" rel="noreferrer noopener">prevent automated threats</a> from bots, breached credentials, or brute force attacks.</li><li>Build a Developer Centric Framework that Scales ‚Äî Leverage support for multiple application types and an extensive library of SDKs for any language and platform and scale.</li></ul><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúPartnering with a CRM pioneer like Salesforce to integrate Auth0‚Äôs customer identity brings an incredible opportunity to deliver a one-stop solution for end-to-end CIAM. Auth0 is proud to power identity for Customer Identity Plus, and we look forward to continued collaboration and innovation together‚Äù</p><p>Randy Nasson</p><p>Director of Product Management</p><p>Auth0</p></div><h2 id="Partner-with-Auth0">Partner with Auth0</h2><p>Auth0 offers a range of partnership opportunities from strategic alliances and working independent software vendors (ISVs) through to system integrators and resellers. We are able to scale according to your need and opportunity. If you‚Äôd like to learn more about how you might partner with Auth0 to add value to your customer base and the broader market, please reach out to our <a href="https://auth0.com/partners" target="_blank" rel="noreferrer noopener">partner team</a>.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 18 Aug 2021 22:17:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Publishes Documentation to Help with New Standard Contractual Clauses</title>
      <link>https://auth0.com/blog/auth0-publishes-documentation-to-help-with-new-standard-contractual-clauses/</link>
      <description>Enabling Auth0 customers to comply with dynamic privacy requirements</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div id="post-content" itemprop="articleBody"><p>At Auth0, our continuing mission is to secure the world‚Äôs identities so innovators can innovate. The core to delivering this mission is trust, including Auth0‚Äôs commitment to security and privacy.</p><p>Following our post in June, we are pleased to announce we have updated our Data Processing Agreement (DPA) to include the new <a href="https://auth0.com/blog/auth0-statement-on-new-standard-contractual-clauses-issued-by-european-commission/" target="_blank" rel="noreferrer noopener">Standard Contractual Clauses</a> (‚Äúnew SCCs‚Äù) to support our customers with European users. We‚Äôve also made changes to our Subscription Agreement, including adding a direct reference to our updated DPA, and clarifying some of the language related to our personal data processing.</p><p>The new clauses and information about the changes can be found here <a href="http://auth0.com/legal" target="_blank" rel="noreferrer noopener">auth0.com/legal</a>.</p><p>All new customers can take advantage of these new terms immediately.</p><p>For existing customers ‚Äì your Tenant Administrators will receive a notification about how you can transition to the updated DPA and new SCCs. If you have any questions or have not received this notification, please contact your account manager, or if you are a self service customer, reach out to the Self Service Team at <a href="mailto:selfserviceteam@auth0.com" target="_blank" rel="noreferrer noopener">selfserviceteam@auth0.com</a>.</p><p>At Auth0, we know that privacy regulation is complex and changing rapidly. We are working to help our customers respond to this dynamic and fast-paced environment by continuously improving the resources and information we make available.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 18 Aug 2021 14:54:00 +0000</pubDate>
    </item>
    <item>
      <title>State Management in Svelte Applications</title>
      <link>https://auth0.com/blog/state-management-in-svelte-applications/</link>
      <description>A tutorial on how to use the Svelte state management store to manage state in Svelte applications.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> As a Front-end developer, one of the most crucial skills to possess is how to manage state in your applications. The ability to synchronize application state with data changes and manage shared state amongst different components is a strong requirement in building modern frontend applications. Several state management libraries have been developed with certain frameworks having a de-facto state management library that they naturally work well with (e.g., <a href="https://redux.js.org/" target="_blank" rel="noreferrer noopener">Redux</a> for <a href="https://reactjs.org/" target="_blank" rel="noreferrer noopener">Reactjs</a>).</p><p>In this tutorial, you will learn how to perform state management in <a href="https://svelte.dev/" target="_blank" rel="noreferrer noopener">Svelte</a> applications using Svelte&#39;s built-in state management <a href="https://svelte.dev/tutorial/writable-stores" target="_blank" rel="noreferrer noopener">Stores</a>.</p><h2 id="What-We-ll-Build">What We&#39;ll Build</h2><p>In this tutorial, you will be implementing state management in a shopping cart built with Svelte. You will begin with a pre-built e-commerce application that sells different types of wares. However, this application is not yet complete, as its shopping features for adding products to the cart and managing cart items have not been implemented. Using the Svelte store, you will be adding the following features to the application:</p><ul><li>Load the products from a central state store</li><li>Add items to the shopping cart</li><li>Display items added to the shopping cart</li><li>Calculate the total price of items in the cart</li><li>Increase and decrease the quantity of the items in the cart</li><li>Remove items from the cart</li></ul><h2 id="Prerequisites">Prerequisites</h2><p>There are a few requirements to follow along with this exercise:</p><ul><li><a href="https://nodejs.org" target="_blank" rel="noreferrer noopener">Node.js</a> installed on your system. You can visit the website and install a suitable version for your operating system <a href="https://nodejs.org/" target="_blank" rel="noreferrer noopener">here</a>.</li><li>Basic knowledge of <a href="https://svelte.dev" target="_blank" rel="noreferrer noopener">Svelte</a> and using <a href="https://svelte.dev/tutorial/nested-components" target="_blank" rel="noreferrer noopener">Svelte components</a>.</li></ul><p>With all these in place, you can proceed with the exercise.</p><h2 id="Cloning-the-Demo-E-commerce-Project">Cloning the Demo E-commerce Project</h2><p>To begin, you will clone the starting point for the project and run it. Run the following command to clone a copy of the e-commerce project unto your machine:</p><pre><code><span>git</span> clone --single-branch --branch base-project https://github.com/coderonfleek/svelte-store</code></pre><p>Once you have the project on your system, go into the root of the project and install the dependencies with the following commands:</p><pre><code><span>cd</span> svelte-store
<span>npm</span> <span>install</span></code></pre><p>With all dependencies installed, you can then run the project using the following command:</p><pre><code><span>npm</span> run dev</code></pre><p>This command will boot up a local development server at <a href="http://localhost:5000" target="_blank" rel="noreferrer noopener"><code>http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>5000</span></code></a>. Navigate to this address on your browser, and you will see the page displayed below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/nwLSAkqqjS7tFnYJhSUB5/eb8586b16288ada93d2c56fbf3fb00a2/svelte_01.jpg" alt="&#34;Homepage - E-commerce App&#34;"/></p><p>At the moment, when you click <code>Add to Cart</code> on any of the products, the button does nothing. The source code for the homepage is located in the file <code>src<span>/</span>views<span>/</span>Home<span>.</span>svelte</code>. The products are currently loaded from a <code>products</code> array on the page using a <code>Product</code> component to display the products:</p><pre><code><span><span><span>&lt;</span>main</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>home container<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>row<span>&#34;</span></span><span>&gt;</span></span>
      <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>col-md-9 pt-5<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>div</span>
          <span>class</span><span><span>=</span><span>&#34;</span>row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-3 row-cols-xl-3<span>&#34;</span></span>
        <span>&gt;</span></span>
          {#each products as product}
          <span><span><span>&lt;</span>Product</span> <span>{product}</span> <span>/&gt;</span></span>
          {/each}
        <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
      <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>col-md-3 pt-5<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>Cart</span> <span>/&gt;</span></span>
      <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>main</span><span>&gt;</span></span></code></pre><p>On the right column, a <code>Cart</code> component is used to display items that have been added to the cart and their respective quantities, which is also hard-coded into the component at the moment. The <code>Cart</code> component also consists of a <code>Checkout</code> button which will navigate to the full shopping cart details page shown below when clicked:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5sW3mmLvYraDwX9d71RZQY/0582cbbb68c9e9c1c697473e8779237e/svelte_02.jpg" alt="&#34;Cart details page - E-commerce App&#34;"/></p><p>The cart details page source code can be found in <code>src<span>/</span>views<span>/</span>ShoppingCart<span>.</span>svelte</code>. It uses a <code>CartItem</code> component to display any item added to the cart with buttons to increase or decrease the quantity of the item in the cart or remove it completely. The <code>Cart</code> component is also displayed on the right column, just as it was on the homepage. At the moment, these buttons do nothing when clicked.</p><pre><code><span><span><span>&lt;</span>main</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>home container<span>&#34;</span></span><span>&gt;</span></span>
    <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>row<span>&#34;</span></span><span>&gt;</span></span>
      <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>col-md-8 pt-5<span>&#34;</span></span><span>&gt;</span></span>
        {#each cart as product}
        <span><span><span>&lt;</span>CartItem</span> <span>{product}</span> <span>/&gt;</span></span>
        {/each}
      <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>div</span> <span>class</span><span><span>=</span><span>&#34;</span>col-md-4 pt-5<span>&#34;</span></span><span>&gt;</span></span>
        <span><span><span>&lt;</span>Cart</span> <span>/&gt;</span></span>
      <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
  <span><span><span>&lt;/</span>div</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>main</span><span>&gt;</span></span></code></pre><p>The cart items displayed on this page are loaded from a <code>cart</code> array and are currently hard-coded on the page. What&#39;s more, clicking any of the buttons does nothing at the moment. All components used in the application are contained in the <code>src<span>/</span>components</code> folder.</p><h2 id="Creating-the-State-Management-Store">Creating the State Management Store</h2><p>To begin implementing the features listed in the above section, you will need to set up a central state management store in the application. Create a <code>store<span>.</span>js</code> file inside the <code>src</code> folder, then add the following code:</p><pre><code><span>import</span> <span>{</span> writable<span>,</span> derived <span>}</span> <span>from</span> <span>&#34;svelte/store&#34;</span><span>;</span>

<span>export</span> <span>const</span> products <span>=</span> <span>writable</span><span>(</span><span>[</span>
  <span>{</span>
    id<span>:</span> <span>1</span><span>,</span>
    name<span>:</span> <span>&#34;Chelsea Shoes&#34;</span><span>,</span>
    price<span>:</span> <span>200</span><span>,</span>
    shortdesc<span>:</span> <span>&#34;Best Drip in the Market&#34;</span><span>,</span>
    url<span>:</span> <span>&#34;images/chelsea-shoes.png&#34;</span>
  <span>}</span><span>,</span>
  <span>{</span>
    id<span>:</span> <span>2</span><span>,</span>
    name<span>:</span> <span>&#34;Kimono&#34;</span><span>,</span>
    price<span>:</span> <span>50</span><span>,</span>
    shortdesc<span>:</span> <span>&#34;Classy, Stylish, Dope&#34;</span><span>,</span>
    url<span>:</span> <span>&#34;images/kimono.png&#34;</span>
  <span>}</span><span>,</span>
  <span>{</span>
    id<span>:</span> <span>3</span><span>,</span>
    name<span>:</span> <span>&#34;Watch&#34;</span><span>,</span>
    price<span>:</span> <span>2500</span><span>,</span>
    shortdesc<span>:</span> <span>&#34;Elegance built in&#34;</span><span>,</span>
    url<span>:</span> <span>&#34;images/rolex.png&#34;</span>
  <span>}</span><span>,</span>
  <span>{</span>
    id<span>:</span> <span>4</span><span>,</span>
    name<span>:</span> <span>&#34;Wallet&#34;</span><span>,</span>
    price<span>:</span> <span>80</span><span>,</span>
    shortdesc<span>:</span> <span>&#34;Sleek, Trendy, Clean&#34;</span><span>,</span>
    url<span>:</span> <span>&#34;images/wallet.png&#34;</span>
  <span>}</span><span>,</span>
  <span>{</span>
    id<span>:</span> <span>5</span><span>,</span>
    name<span>:</span> <span>&#34;Lady Handbags&#34;</span><span>,</span>
    price<span>:</span> <span>230</span><span>,</span>
    shortdesc<span>:</span> <span>&#34;Fabulous, Exotic, Classy&#34;</span><span>,</span>
    url<span>:</span> <span>&#34;images/handbag.png&#34;</span>
  <span>}</span><span>,</span>
  <span>{</span>
    id<span>:</span> <span>6</span><span>,</span>
    name<span>:</span> <span>&#34;Casual Shirts&#34;</span><span>,</span>
    price<span>:</span> <span>30</span><span>,</span>
    shortdesc<span>:</span> <span>&#34;Neat, Sleek, Smart&#34;</span><span>,</span>
    url<span>:</span> <span>&#34;images/shirt.png&#34;</span>
  <span>}</span>
<span>]</span><span>)</span><span>;</span>

<span>export</span> <span>const</span> cart <span>=</span> <span>writable</span><span>(</span><span>[</span><span>]</span><span>)</span><span>;</span></code></pre><p>The store above contains two writable properties:</p><ul><li>The <code>products</code> property holds all products contained in the e-commerce application. In a production scenario, you would want to load products from a remote API.</li><li>The <code>cart</code> property is an array that holds the items a user adds to their cart. This is empty by default.</li></ul><p>These properties are all that is needed to implement the features listed above.</p><h2 id="Loading-Products-to-the-Home-Page-from-the-Store">Loading Products to the Home Page from the Store</h2><p>The first task is to ensure that the products are loaded from the store instead of being hard-coded on the <code>Home<span>.</span>svelte</code> homepage. Locate <code>src<span>/</span>views<span>/</span>Home<span>.</span>svelte</code> and replace its content with the following code:</p><pre><code><span>&lt;</span>script<span>&gt;</span>
  <span>import</span> Product <span>from</span> <span>&#34;../components/Product.svelte&#34;</span><span>;</span>
  <span>import</span> Cart <span>from</span> <span>&#34;../components/Cart.svelte&#34;</span><span>;</span>
  <span>import</span> <span>{</span> products <span>}</span> <span>from</span> <span>&#34;../store&#34;</span><span>;</span>
<span>&lt;</span><span>/</span>script<span>&gt;</span>

<span>&lt;</span>main<span>&gt;</span>
  <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;home container&#34;</span><span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;row&#34;</span><span>&gt;</span>
      <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-9 pt-5&#34;</span><span>&gt;</span>
        <span>&lt;</span>div
          <span>class</span><span>=</span><span>&#34;row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-3 row-cols-xl-3&#34;</span>
        <span>&gt;</span>
          <span>{</span>#each $products <span>as</span> product<span>}</span>
            <span>&lt;</span>Product <span>{</span>product<span>}</span> <span>/</span><span>&gt;</span>
          <span>{</span><span>/</span>each<span>}</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>
      <span>&lt;</span><span>/</span>div<span>&gt;</span>
      <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-3 pt-5&#34;</span><span>&gt;</span>
        <span>&lt;</span>Cart <span>/</span><span>&gt;</span>
      <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
  <span>&lt;</span><span>/</span>div<span>&gt;</span>
<span>&lt;</span><span>/</span>main<span>&gt;</span></code></pre><p>In the update above, the <code>products</code> variable has now been replaced with store property <code>products</code> that references the store to load the products. Now refresh your homepage, and you will not see any change, but you know that your products are now being loaded from the store.</p><p>The next task is to implement the functionality that allows users to click <code>Add to Cart</code> on a product on the homepage and see it added to the cart widget on the right column. As mentioned earlier, products displayed on the page are managed using a <code>Product</code> component. Locate this component at <code>src<span>/</span>components<span>/</span>Product<span>.</span>svelte</code> and replace its content with the following code:</p><pre><code><span>&lt;</span>script<span>&gt;</span>
  <span>import</span> <span>{</span> cart <span>}</span> <span>from</span> <span>&#34;../store&#34;</span><span>;</span>
  <span>export</span> <span>let</span> product<span>;</span>

  <span>let</span> inCart <span>=</span> <span>false</span><span>;</span>

  $<span>:</span> <span>{</span>
    $cart<span>.</span><span>forEach</span><span>(</span><span>(</span><span>item</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span>item<span>.</span>id <span>==</span> product<span>.</span>id<span>)</span> <span>{</span>
        inCart <span>=</span> <span>true</span><span>;</span>
      <span>}</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>addToCart</span><span>(</span><span>)</span> <span>{</span>
    <span>if</span> <span>(</span><span>!</span>inCart<span>)</span> <span>{</span>
      <span>let</span> updatedCart <span>=</span> <span>[</span><span>...</span>$cart<span>,</span> <span>{</span> <span>...</span>product<span>,</span> quantity<span>:</span> <span>1</span> <span>}</span><span>]</span><span>;</span>

      cart<span>.</span><span>set</span><span>(</span>updatedCart<span>)</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>alert</span><span>(</span><span>&#34;Item already added to Cart&#34;</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>&lt;</span><span>/</span>script<span>&gt;</span>

<span>&lt;</span>main<span>&gt;</span>
  <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col mb-4&#34;</span><span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;card&#34;</span><span>&gt;</span>
      <span>&lt;</span>img src<span>=</span><span>{</span>product<span>.</span>url<span>}</span> <span>class</span><span>=</span><span>&#34;card-img-top&#34;</span> alt<span>=</span><span>&#34;...&#34;</span> <span>/</span><span>&gt;</span>
      <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;card-body&#34;</span><span>&gt;</span>
        <span>&lt;</span>h5 <span>class</span><span>=</span><span>&#34;card-title&#34;</span><span>&gt;</span><span>{</span>product<span>.</span>name<span>}</span><span>&lt;</span><span>/</span>h5<span>&gt;</span>
        <span>&lt;</span>p <span>class</span><span>=</span><span>&#34;card-text&#34;</span><span>&gt;</span>
          $<span>{</span>product<span>.</span>price<span>}</span>
          <span>&lt;</span>br <span>/</span><span>&gt;</span>
          <span>&lt;</span>small<span>&gt;</span>
            <span>{</span>product<span>.</span>shortdesc<span>}</span>
          <span>&lt;</span><span>/</span>small<span>&gt;</span>
        <span>&lt;</span><span>/</span>p<span>&gt;</span>
        <span>&lt;</span>button
          on<span>:</span>click<span>=</span><span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>addToCart</span><span>(</span><span>)</span><span>}</span>
          <span>class</span><span>=</span><span>&#34;btn btn-primary&#34;</span>
          disabled<span>=</span><span>{</span>inCart<span>}</span><span>&gt;</span><span>{</span>inCart <span>?</span> <span>&#34;Added&#34;</span> <span>:</span> <span>&#34;Add to Cart&#34;</span><span>}</span><span>&lt;</span><span>/</span>button
        <span>&gt;</span>
      <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
  <span>&lt;</span><span>/</span>div<span>&gt;</span>
<span>&lt;</span><span>/</span>main<span>&gt;</span></code></pre><p>The updates to this file add two properties to the component:</p><ul><li>A reference to the <code>cart</code> property in the store</li><li>The <code>inCart</code> checks if the product using this component has been added to the store or not</li></ul><p>The <code>addToCart</code> function adds an item to the cart when the <code>Add to Cart</code> button is clicked by updating the <code>cart</code> property in the store with the new item. This function first checks if the product is already in the cart. If so, an alert is displayed indicating that the product has already been added. If not, the product is added to the cart.</p><p>The <code>inCart</code> property is also used in the template to disable the <code>Add to Cart</code> button if the product has already been added.</p><p>Next, the <code>Cart</code> component needs to display the products that have been added to the cart and also the total price. Locate the <code>src<span>/</span>components<span>/</span>Cart<span>.</span>svelte</code> file and replace its content with the following code:</p><pre><code><span>&lt;</span>script<span>&gt;</span>
  <span>import</span> <span>{</span> link <span>}</span> <span>from</span> <span>&#34;svelte-spa-router&#34;</span><span>;</span>
  <span>import</span> <span>{</span> cart <span>}</span> <span>from</span> <span>&#34;../store&#34;</span><span>;</span>

  $<span>:</span> totalPrice <span>=</span> $cart<span>.</span><span>reduce</span><span>(</span><span>(</span><span>total<span>,</span> next</span><span>)</span> <span>=&gt;</span> <span>{</span>
    console<span>.</span><span>log</span><span>(</span>$cart<span>)</span><span>;</span>
    <span>return</span> total <span>+</span> next<span>.</span>quantity <span>*</span> next<span>.</span>price<span>;</span>
  <span>}</span><span>,</span> <span>0</span><span>)</span><span>;</span>
<span>&lt;</span><span>/</span>script<span>&gt;</span>

<span>&lt;</span>main<span>&gt;</span>
  <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;card&#34;</span><span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;card-body&#34;</span><span>&gt;</span>
      <span>&lt;</span>h5 <span>class</span><span>=</span><span>&#34;card-title&#34;</span><span>&gt;</span>Your Cart<span>&lt;</span><span>/</span>h5<span>&gt;</span>
      <span>{</span>#<span>if</span> $cart<span>.</span>length <span>==</span> <span>0</span><span>}</span>
        <span>&lt;</span>p<span>&gt;</span>Your Cart is Empty<span>&lt;</span><span>/</span>p<span>&gt;</span>
      <span>{</span><span>/</span><span>if</span><span>}</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span>ul <span>class</span><span>=</span><span>&#34;list-group list-group-flush&#34;</span><span>&gt;</span>
      <span>{</span>#each $cart <span>as</span> item<span>}</span>
        <span>&lt;</span>li
          <span>class</span><span>=</span><span>&#34;list-group-item d-flex justify-content-between align-items-center&#34;</span>
        <span>&gt;</span>
          <span>{</span>item<span>.</span>name<span>}</span>
          <span>&lt;</span>span <span>class</span><span>=</span><span>&#34;badge badge-primary badge-pill&#34;</span><span>&gt;</span><span>{</span>item<span>.</span>quantity<span>}</span><span>&lt;</span><span>/</span>span<span>&gt;</span>
        <span>&lt;</span><span>/</span>li<span>&gt;</span>
      <span>{</span><span>/</span>each<span>}</span>
      <span>&lt;</span>li
        <span>class</span><span>=</span><span>&#34;list-group-item d-flex justify-content-between align-items-center&#34;</span>
      <span>&gt;</span>
        Price <span>&lt;</span>b<span>&gt;</span>$<span>{</span>totalPrice<span>}</span><span>&lt;</span><span>/</span>b<span>&gt;</span>
      <span>&lt;</span><span>/</span>li<span>&gt;</span>
    <span>&lt;</span><span>/</span>ul<span>&gt;</span>

    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;card-body&#34;</span><span>&gt;</span>
      <span>&lt;</span>a use<span>:</span>link href<span>=</span><span>&#34;/shop&#34;</span> <span>class</span><span>=</span><span>&#34;btn btn-primary btn-block&#34;</span><span>&gt;</span>Checkout<span>&lt;</span><span>/</span>a<span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
  <span>&lt;</span><span>/</span>div<span>&gt;</span>
<span>&lt;</span><span>/</span>main<span>&gt;</span></code></pre><p>The update to this file first replaces the hard-coded cart items with reference to that <code>cart</code> state in the store. A <code>totalPrice</code> property is also used to evaluate the total cost of all items currently added to the shopping cart. In the template, the length of <code>cart</code> is used to display a message to the user to add items to the shopping cart when the cart is empty.</p><p>Return to the browser and reload the homepage if it hasn&#39;t been reloaded. You will see the view below. Notice the new look of the cart widget on the right column:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3OzDAoyWDYhkPpma41kAlK/34958e5b49a984b65df3857f763f9cc3/svelte_03.jpg" alt="&#34;Updated Cart - E-commerce App&#34;"/></p><p>Now click on <code>Add to Cart</code> to add at least 2 items to the cart and observe the cart widget update based on your selections like below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/UyhS5wLpRtIr7zRjiOXsT/cacc42d088fe9417a084e78e76a8f3e7/svelte_04.jpg" alt="&#34;Items selection - E-commerce App&#34;"/></p><h2 id="Changing-Items-Quantity-and-Removing-Items-from-the-Cart">Changing Items Quantity and Removing Items from the Cart</h2><p>Notice how the default quantity of each product added to the cart is set to one (1)? This is because every count has to start from 1. In a proper shopping cart application, users should be allowed to increase the quantity of each selected item.</p><p>The next task is to add features for increasing and decreasing the number of cart items. You will also add the ability to completely remove an item from the cart.</p><p>From the shopping cart details page shown earlier, each cart item displayed with buttons to manage its quantity uses the <code>CartItem</code> component. Locate this component at <code>src<span>/</span>components<span>/</span>CartItem<span>.</span>svelte</code> and replace the code in it with the following:</p><pre><code><span>&lt;</span>script<span>&gt;</span>
  <span>import</span> Product <span>from</span> <span>&#34;../components/Product.svelte&#34;</span><span>;</span>
  <span>import</span> <span>{</span> cart <span>}</span> <span>from</span> <span>&#34;../store&#34;</span><span>;</span>

  <span>export</span> <span>let</span> product<span>;</span>

  <span>let</span> itemQuantity <span>=</span> <span>0</span><span>;</span>

  $<span>:</span> <span>{</span>
    <span>let</span> get_product <span>=</span> $cart<span>.</span><span>filter</span><span>(</span><span>(</span><span>item</span><span>)</span> <span>=&gt;</span> item<span>.</span>id <span>==</span> product<span>.</span>id<span>)</span><span>;</span>

    itemQuantity <span>=</span> get_product<span>[</span><span>0</span><span>]</span><span>.</span>quantity<span>;</span>
  <span>}</span>

  <span>function</span> <span>changeQuantity</span><span>(</span>action <span>=</span> <span>&#34;add&#34;</span><span>)</span> <span>{</span>
    <span>if</span> <span>(</span>action <span>==</span> <span>&#34;add&#34;</span><span>)</span> <span>{</span>
      product<span>.</span>quantity <span>=</span> product<span>.</span>quantity <span>+</span> <span>1</span><span>;</span>

      <span>updateCart</span><span>(</span>product<span>)</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>if</span> <span>(</span>product<span>.</span>quantity <span>&gt;</span> <span>1</span><span>)</span> <span>{</span>
        product<span>.</span>quantity <span>=</span> product<span>.</span>quantity <span>-</span> <span>1</span><span>;</span>
        <span>updateCart</span><span>(</span>product<span>)</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>//Remove the item</span>

        <span>removeItem</span><span>(</span>product<span>)</span><span>;</span>
      <span>}</span>
    <span>}</span>
  <span>}</span>

  <span>function</span> <span>removeItem</span><span>(</span><span>product</span><span>)</span> <span>{</span>
    <span>let</span> removedItemCart <span>=</span> $cart<span>.</span><span>filter</span><span>(</span><span>(</span><span>cartItem</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>return</span> cartItem<span>.</span>id <span>!=</span> product<span>.</span>id<span>;</span>
    <span>}</span><span>)</span><span>;</span>

    cart<span>.</span><span>set</span><span>(</span>removedItemCart<span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>updateCart</span><span>(</span><span>product</span><span>)</span> <span>{</span>

    <span>let</span> updatedCart <span>=</span> $cart<span>.</span><span>map</span><span>(</span><span>(</span><span>cartItem</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span>cartItem<span>.</span>id <span>==</span> product<span>.</span>id<span>)</span> <span>{</span>
        <span>return</span> product<span>;</span>
      <span>}</span>

      <span>return</span> cartItem<span>;</span>
    <span>}</span><span>)</span><span>;</span>

    cart<span>.</span><span>set</span><span>(</span>updatedCart<span>)</span><span>;</span>
  <span>}</span>
<span>&lt;</span><span>/</span>script<span>&gt;</span>

<span>&lt;</span>main<span>&gt;</span>
  <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;row cart-item-row&#34;</span><span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-6&#34;</span><span>&gt;</span>
      <span>&lt;</span>Product <span>{</span>product<span>}</span> <span>/</span><span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-4&#34;</span><span>&gt;</span>
      <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;row&#34;</span><span>&gt;</span>
        <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-5&#34;</span><span>&gt;</span>
          <span>&lt;</span>button
            on<span>:</span>click<span>=</span><span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>changeQuantity</span><span>(</span><span>)</span><span>}</span>
            <span>class</span><span>=</span><span>&#34;btn btn-primary btn-block&#34;</span><span>&gt;</span><span>+</span><span>&lt;</span><span>/</span>button
          <span>&gt;</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>
        <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-2 text-center&#34;</span><span>&gt;</span><span>{</span>product<span>.</span>quantity<span>}</span><span>&lt;</span><span>/</span>div<span>&gt;</span>
        <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-5&#34;</span><span>&gt;</span>
          <span>&lt;</span>button
            on<span>:</span>click<span>=</span><span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>changeQuantity</span><span>(</span><span>&#34;remove&#34;</span><span>)</span><span>}</span>
            <span>class</span><span>=</span><span>&#34;btn btn-warning btn-block&#34;</span><span>&gt;</span><span>-</span><span>&lt;</span><span>/</span>button
          <span>&gt;</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>
      <span>&lt;</span><span>/</span>div<span>&gt;</span>
      <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;row cart-remove-button&#34;</span><span>&gt;</span>
        <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-12&#34;</span><span>&gt;</span>
          <span>&lt;</span>button on<span>:</span>click<span>=</span><span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>removeItem</span><span>(</span><span>)</span><span>}</span> <span>class</span><span>=</span><span>&#34;btn btn-danger btn-block&#34;</span>
            <span>&gt;</span>Remove Item<span>&lt;</span><span>/</span>button
          <span>&gt;</span>
        <span>&lt;</span><span>/</span>div<span>&gt;</span>
      <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
  <span>&lt;</span><span>/</span>div<span>&gt;</span>
<span>&lt;</span><span>/</span>main<span>&gt;</span>

<span>&lt;</span>style scoped<span>&gt;</span>
  <span>.</span>cart<span>-</span>item<span>-</span>row <span>{</span>
    border<span>-</span>bottom<span>:</span> <span>1</span>px solid #ccc<span>;</span>
    margin<span>-</span>top<span>:</span> <span>20</span>px<span>;</span>
  <span>}</span>
  <span>.</span>cart<span>-</span>remove<span>-</span>button <span>{</span>
    margin<span>-</span>top<span>:</span> <span>10</span>px<span>;</span>
  <span>}</span>
<span>&lt;</span><span>/</span>style<span>&gt;</span></code></pre><p>This update adds two computed properties, <code>cart</code>, which is a reference to the <code>cart</code> state property in the store, and <code>itemQuantity</code>, which gets the current quantity of the item in the shopping cart.</p><p>Three methods are also added which do the following:</p><ul><li><code>changeQuantity</code>: takes in an <code>action</code> argument that is either set to <code>add</code> or <code>decrease</code> to determine whether to increase or decrease the item quantity by 1. If the current quantity is 1 and the function is asked to decrease the item, the item would be removed completely.</li><li><code>removeItem</code>: completely removes an item from the shopping cart.</li><li><code>updateCart</code>: A utility function for reusing the update logic for <code>cart</code> in the store</li></ul><p>Next, locate the shopping cart details page at <code>src<span>/</span>views<span>/</span>ShoppingCart<span>.</span>svelte</code> and replace its content with the following code:</p><pre><code><span>&lt;</span>script<span>&gt;</span>
  <span>import</span> Cart <span>from</span> <span>&#34;../components/Cart.svelte&#34;</span><span>;</span>
  <span>import</span> CartItem <span>from</span> <span>&#34;../components/CartItem.svelte&#34;</span><span>;</span>

  <span>import</span> <span>{</span> cart <span>}</span> <span>from</span> <span>&#34;../store&#34;</span><span>;</span>
<span>&lt;</span><span>/</span>script<span>&gt;</span>

<span>&lt;</span>main<span>&gt;</span>
  <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;home container&#34;</span><span>&gt;</span>
    <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;row&#34;</span><span>&gt;</span>
      <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-8 pt-5&#34;</span><span>&gt;</span>
        <span>{</span>#each $cart <span>as</span> product<span>}</span>
          <span>&lt;</span>CartItem <span>{</span>product<span>}</span> <span>/</span><span>&gt;</span>
        <span>{</span><span>/</span>each<span>}</span>
      <span>&lt;</span><span>/</span>div<span>&gt;</span>
      <span>&lt;</span>div <span>class</span><span>=</span><span>&#34;col-md-4 pt-5&#34;</span><span>&gt;</span>
        <span>&lt;</span>Cart <span>/</span><span>&gt;</span>
      <span>&lt;</span><span>/</span>div<span>&gt;</span>
    <span>&lt;</span><span>/</span>div<span>&gt;</span>
  <span>&lt;</span><span>/</span>div<span>&gt;</span>
<span>&lt;</span><span>/</span>main<span>&gt;</span></code></pre><p>This update replaces the hard-coded cart items with reference to the <code>cart</code> property in the store.</p><h2 id="Running-the-Application">Running the Application</h2><p>With these changes, your app should be reloaded once again. Add a few items to the shopping cart if the reload has reset the cart back to being empty, then click &#34;Checkout&#34; to go to the shopping cart details page. On this page, increment and decrement some of the items in the cart and try removing one of them by clicking &#34;Remove&#34;. You will see the cart widget update accordingly on the right column like below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7xFFbT1x3IfKUxCFT7IDvl/b42328e5782e261ffb3d1a454eba2a8c/svelte_05.jpg" alt="&#34;Update Cart Items - E-commerce App&#34;"/></p><p>Perfect!</p><h2 id="Conclusion">Conclusion</h2><p>In this tutorial, you have been able to implement state management in a Svelte application using a shopping cart demo application.</p><p>State management involves a design thinking process where you have to decide which state properties are global (reside in the store) and which state properties are to be localized to the respective components that make use of them. Knowing which state should be local and which state properties should reside in the central store will help you make good design decisions.</p><p>If any part of your demonstration is not working as expected, I advise you to go through the article once again to see if there is any step you may have missed. If you need additional help, feel free to reach out in the comments.</p><p>Happy coding :)</p></div></div>]]></content:encoded>
      <pubDate>Tue, 17 Aug 2021 15:01:00 +0000</pubDate>
    </item>
    <item>
      <title>Auth0 Marketplace Now Offers netID Solution</title>
      <link>https://auth0.com/blog/auth0-marketplace-now-offers-netid-solution/</link>
      <description>Auth0 integrates netID to support customer privacy needs in Europe</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>London/Montabaur, Germany ‚Äì August 17, 2021 ‚Äì</strong> <a href="https://auth0.com/" target="_blank" rel="noreferrer noopener">Auth0</a>, the modern identity platform, and the <a href="https://enid.foundation/en/" target="_blank" rel="noreferrer noopener">European netID Foundation</a> today announced the availability of netID Single Sign-On on <a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a>, a catalog of trusted technology integrations to extend the functionality of Auth0‚Äôs identity management platform. </p><p><a href="https://marketplace.auth0.com/integrations/netid-single-sign-on" target="_blank" rel="noreferrer noopener">netID</a> enables users to sign into apps and websites with their netID account and to decide privately and transparently which data to share. As an independent European identity provider with more than 38 million active user accounts in Germany, netID provides the necessary infrastructure for <a href="https://auth0.com/blog/what-is-single-sign-on-a-non-developer-s-guide/" target="_blank" rel="noreferrer noopener">Single Sign-On (SSO)</a> but does not store any user data itself. Users can manage the consents they‚Äôve given at any time in netID‚Äôs Privacy Center.</p><p>‚ÄúWhether in finance, e-commerce, or online publishing, engaging with users in an all trusted and transparent way is key to driving success. We are excited about the partnership with Auth0 and the availability of the netID Single Sign-On integration. Joint customers can now seamlessly integrate our product and offer users a European alternative to U.S. social login providers,‚Äù says Achim Schlosser, board member, and chief technology officer of the European netID Foundation.</p><p>‚ÄúAfter speaking with many customers, we have identified the integrations that matter to them. The availability of netID on Auth0 Marketplace is a direct response to the growing need for privacy-enhancing technologies in Europe and part of our continued commitment to international markets,‚Äù said Cassio Sampaio, SVP of Product at Auth0. ‚ÄúWe are thrilled to have netID as a vetted and valuable vendor in Auth0 Marketplace.‚Äù </p><p>Auth0 reviews partner integration functionality and makes available integrations that are easy to discover and integrate for customers. Partners can participate in the growing demand for digital identity solutions and increase their visibility as part of the Auth0 Marketplace and can learn more here: <a href="https://auth0.com/partners" target="_blank" rel="noreferrer noopener">https://auth0.com/partners</a>.</p><p><a href="https://auth0.com/blog/okta-acquisition-announcement/" target="_blank" rel="noreferrer noopener">Auth0, recently acquired by Okta</a>, provides a modern identity platform that helps organizations meet the security, privacy, and convenience needs of their users. Please visit <a href="https://auth0.com/identity-os" target="_blank" rel="noreferrer noopener">Auth0 identity OS</a> to learn more.</p><h2 id="About-the-European-netID-Foundation">About the European netID Foundation</h2><p>The European netID Foundation was established in March 2018 by Mediengruppe RTL Deutschland, ProSiebenSat.1, and United Internet with its brands WEB.DE and GMX. With an independent market solution, the foundation supports Internet offerings from all industry sectors with the implementation of the new European data protection law and, for this purpose, has created the open login standard netID. The initiators of the foundation together reach around 50 million unique users every month and together have more than 38 million active accounts. The foundation is explicitly open to additional partners and initiatives. Further information is available at <a href="https://auth0.com/blog/auth0-marketplace-now-offers-netid-solution/www.enid.eu" target="_blank" rel="noreferrer noopener">www.enid.eu</a>.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>Auth0‚Äôs modern approach to identity enables organizations to provide secure access to any application, for any user. The Auth0 platform is a highly customizable identity operating system that is as simple as development teams want and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div><h3 id="Media-Contacts">Media Contacts</h3><p>Alexandra Roszkowski<br/><a href="mailto:presse@enid.eu" target="_blank" rel="noreferrer noopener">presse@enid.eu</a><br/>+49 162 25 27-188<br/></p><p>Sarah Konarski &amp; Nele Mascher<br/>Finn Partners for Auth0, DACH<br/><a href="mailto:auth0de@finnpartners.com" target="_blank" rel="noreferrer noopener">auth0de@finnpartners.com</a><br/></p></div></div>]]></content:encoded>
      <pubDate>Tue, 17 Aug 2021 01:20:00 +0000</pubDate>
    </item>
    <item>
      <title>The 7 Most Common Types of Cybersecurity Attacks in 2021</title>
      <link>https://auth0.com/blog/the-7-most-common-types-of-cybersecurity-attacks-in-2021/</link>
      <description>Learn which cybersecurity tactics and tools will help you combat today&#39;s common cyberattacks.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>With more people working remotely or online post-2020, the <a href="https://thehill.com/policy/cybersecurity/493198-fbi-sees-spike-in-cyber-crime-reports-during-coronavirus-pandemic" target="_blank" rel="noreferrer noopener">FBI reports</a> that cybercriminals are quadrupling the number of cyberattacks they use to disrupt online activities. Research also shows the impact to organizations and their users from a single successful cyberattack is growing each year.</p><p>For example, in 2017, nearly <a href="https://www.statista.com/statistics/273550/data-breaches-recorded-in-the-united-states-by-number-of-breaches-and-records-exposed/" target="_blank" rel="noreferrer noopener"><em>197 million records</em></a> were exposed due to data breaches. In 2020, that number <a href="https://pages.riskbasedsecurity.com/hubfs/Reports/2020/2020%20Year%20End%20Data%20Breach%20QuickView%20Report.pdf" target="_blank" rel="noreferrer noopener">grew to 37 billion</a>, even though the overall number of data breaches had decreased. And IBM reports that the costs are growing for organizations that fall victim to these attacks in countries like the United States, where the average cost of a data breach grew from $7.91M to $8.64M between <a href="https://www.ibm.com/downloads/cas/861MNWN2" target="_blank" rel="noreferrer noopener">2018</a> and <a href="https://www.ibm.com/security/data-breach" target="_blank" rel="noreferrer noopener">2020</a>.</p><p>Many of the methods cybercriminals use to breach organizations rely on human error. Even your sharpest employees can become your greatest weakness if they click on a malicious link without realizing it. However, other cyberattacks exploit gaps in your <a href="https://auth0.com/blog/what-is-data-security/" target="_blank" rel="noreferrer noopener">data security</a> efforts to gain access to sensitive data.</p><p>Below are seven of the most common cyberattacks your organization will face in 2021 and the ways to protect yourself against the data breaches they have the potential to cause.</p><h2 id="1--Malware-Attacks">1. Malware Attacks</h2><p>Malware refers to many different types of malicious software designed to infiltrate, spy on, or create a backdoor and control an organization‚Äôs systems or data. This includes ransomware, worms, trojans, adware, and spyware. <a href="https://monstercloud.com/blog/2020/03/23/coronavirus-alert-ransomware-attacks-up-by-800/" target="_blank" rel="noreferrer noopener">Experts report</a> that malware usage is up almost 800% since early 2020.</p><p>Malware has the potential to cause major data breaches and severely disrupt business operations. Microsoft was the victim of a major ransomware attack, where WannaCry <a href="https://en.wikipedia.org/wiki/WannaCry_ransomware_attack" target="_blank" rel="noreferrer noopener">took advantage of a weak spot in their operating system</a> and displayed the following message to banks, health care providers, manufacturers, and other businesses across the globe:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1eCk2eoRxo2dlqfakT2rLF/3d36517813cea24b63b795f7fe3a256c/Uploaded_from_The_7_Most_Common_Types_of_Cybersecurity_Attacks_in_2021" alt="image.png"/>
</p><p><i><a href="https://blog.malwarebytes.com/cybercrime/2017/05/wanacrypt0r-ransomware-hits-it-big-just-before-the-weekend/" target="_blank" rel="noreferrer noopener">Source</a></i></p><p>To regain access to their computers, along with any files that hadn‚Äôt been backed up, businesses had to pay a ransom to the creators of the WannaCry program in <a href="https://bitcoin.org/en/" target="_blank" rel="noreferrer noopener">Bitcoin</a>.</p><p>Malware is typically downloaded unwittingly by clicking a malicious link or by tricking a user into thinking they&#39;re downloading something legitimate when they‚Äôre not.</p><h3 id="How-to-Protect-Against-Malware-Attacks">How to Protect Against Malware Attacks</h3><p>Teaching your employees how to spot suspicious links and pop-ups that could contain malware will help reduce the chance that it could infect your systems.</p><p>Additional ways to protect against malware include keeping your operating systems up to date to ensure known security gaps are patched and using anti-virus software. For example, the <a href="https://www.wired.com/story/equifax-breach-no-excuse/" target="_blank" rel="noreferrer noopener">Equifax</a> data breach could have been prevented had a known patch been installed in time.</p><h2 id="2--Phishing-Attacks">2. Phishing Attacks</h2><p>Phishing attacks attempt to steal information from users or trick them into downloading malware by sending malicious emails or text messages (SMS) that look like real requests but are, in fact, a Scam. Here‚Äôs a Dropbox email asking users to verify their email address that‚Äôs actually a phishing attack:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2ISbM89J8qjqwVy4kUpgOf/a1b52597302c386ee8381bfd6f6948d9/Uploaded_from_The_7_Most_Common_Types_of_Cybersecurity_Attacks_in_2021" alt="image.png"/> 
</p><p><i><a href="https://www.bankinfosecurity.com/locky-returns-via-spam-dropbox-themed-phishing-attacks-a-10250" target="_blank" rel="noreferrer noopener">Source</a></i></p><p>According to <a href="https://enterprise.verizon.com/resources/reports/dbir/2020/results-and-analysis/" target="_blank" rel="noreferrer noopener">Verizon‚Äôs 2020 Data Breach Investigations Report</a>, phishing attacks are the most common cause of data breaches globally and have been the root cause of notable instances of cybercrime in the last decade.</p><p>The cybercriminals who breached the AP News Twitter account and falsely <a href="https://www.bbc.com/news/world-us-canada-21508660" target="_blank" rel="noreferrer noopener">tweeted</a> that the White House was under attack used a targeted phishing attack (spear-phishing) to gain access to the account, as did the bad actors who leaked sensitive emails from Hillary Clinton‚Äôs campaign chairman <a href="https://www.cbsnews.com/news/the-phishing-email-that-hacked-the-account-of-john-podesta/" target="_blank" rel="noreferrer noopener">before the 2016 election</a>.</p><h3 id="How-to-Protect-Against-Phishing-Attacks">How to Protect Against Phishing Attacks</h3><p>The best way to protect your organization against phishing attacks is to educate your employees on how to spot a questionable email or text message. The training programs below can help you do this:</p><ul><li><em>Digital Defense‚Äôs</em> <a href="https://www.digitaldefense.com/professional-services/secured-training/" target="_blank" rel="noreferrer noopener"><em>SecurED training program</em></a></li><li><em>Inspired eLearning‚Äôs</em> <a href="https://inspiredelearning.com/security-awareness/awareness-c-suite/" target="_blank" rel="noreferrer noopener"><em>Security Awareness</em></a></li></ul><p>Additionally, CSO has compiled a list of resources that can help you train your teams to spot phishing attacks <a href="https://www.csoonline.com/article/3225471/please-dont-send-me-to-cybersecurity-training.html" target="_blank" rel="noreferrer noopener">here</a>.</p><h2 id="3--Distributed-Denial-of-Service-Attacks">3. Distributed Denial of Service Attacks</h2><p>Distributed denial of service (DDoS) attacks disrupt the traffic to a website, application, server, service, or network by overwhelming it with a flood of traffic from compromised computer networks (<a href="https://usa.kaspersky.com/resource-center/threats/botnet-attacks" target="_blank" rel="noreferrer noopener">botnets</a>) that prevents real users from accessing it. In 2018, GitHub experienced the largest DDoS attack ever when it was hit with 1.35 terabits of traffic per second and was <a href="https://www.wired.com/story/github-ddos-memcached/" target="_blank" rel="noreferrer noopener">offline for almost 20 minutes as a result</a>.</p><p>DDoS attacks are common and increased by 50% in 2020 compared to 2019, with a large surge occurring in early 2020 during the pandemic, according to security company <a href="https://securelist.com/ddos-attacks-in-q3-2020/99171/" target="_blank" rel="noreferrer noopener">Kaspersky</a>.</p><h3 id="How-to-Protect-Against-DDoS-Attacks">How to Protect Against DDoS Attacks</h3><p>DDoS attacks are tricky to identify because they‚Äôre often hard to distinguish from legitimate traffic. Some <a href="https://www.cloudflare.com/learning/ddos/what-is-a-ddos-attack/" target="_blank" rel="noreferrer noopener">methods of protecting against DDoS attacks</a> include blocking all traffic for a short period of time, rate-limiting traffic to a website, using a web application firewall to detect suspicious traffic patterns, or scattering traffic across a network of servers to reduce the attack‚Äôs impact.</p><h2 id="4--Man-in-the-Middle-Attacks">4. Man-in-the-Middle Attacks</h2><p>Man-in-the-middle (MitM) attacks are when bad actors spy on or intercept communication between you and your users or employees. MitM attacks are most commonly used to steal personal or company information or to redirect that information to another destination or in espionage situations, such as when <a href="https://www.theguardian.com/world/2018/oct/04/how-russian-spies-bungled-cyber-attack-on-weapons-watchdog" target="_blank" rel="noreferrer noopener">Russian hackers</a> attempted to breach the Organisation for the Prohibition of Chemical Weapons (OPCW).</p><p>MitM attacks are <a href="https://www.csoonline.com/article/3340117/what-is-a-man-in-the-middle-attack-how-mitm-attacks-work-and-how-to-prevent-them.html" target="_blank" rel="noreferrer noopener">not the most common cyberattack</a> because many of the same objectives can be achieved using malware. However, MitM attacks do present a threat for organizations because they‚Äôre often hard to spot and because <a href="https://www.businesswire.com/news/home/20201215005287/en/Upwork-Study-Finds-22-of-American-Workforce-Will-Be-Remote-by-2025" target="_blank" rel="noreferrer noopener">more employees are working remotely</a> post-2020.</p><p>For example, fake WiFi networks are <a href="https://hackernoon.com/a-hacker-intercepted-your-wifi-traffic-stole-your-contacts-passwords-financial-data-heres-how-4fc0df9ff152" target="_blank" rel="noreferrer noopener">easy to deploy</a> in public places like coffee shops where remote employees often work. People often connect to these networks without realizing it, allowing bad actors to spy on them while they use the network.</p><h3 id="How-to-Protect-Against-MitM-Attacks">How to Protect Against MitM Attacks</h3><p>End-to-end encryption protocols like <a href="https://www.cloudflare.com/learning/ssl/transport-layer-security-tls/" target="_blank" rel="noreferrer noopener">Transport Layer Security</a> (TLS) are the best way to protect against MitM attacks. Additionally, requiring your employees to use a VPN to access company networks over public WiFi will ensure that any information shared during their session remains private, regardless of whether the network belongs to a bad actor or if their coffee shop‚Äôs WiFi is simply unsecured.</p><h2 id="5--Credential-Stuffing-Attacks">5. Credential Stuffing Attacks</h2><p><a href="https://auth0.com/blog/what-is-credential-stuffing/" target="_blank" rel="noreferrer noopener">Credential stuffing</a> is a type of brute-force cyber-attack where bad actors use stolen usernames and passwords from one data breach to access user accounts at another organization.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1WPDZfXKzHLheBp0XbP2em/6769d8d365597a77b9de207e48c303d8/Uploaded_from_The_7_Most_Common_Types_of_Cybersecurity_Attacks_in_2021" alt="image.png"/></p><p>Credential stuffing is possible because, statistically, <a href="https://services.google.com/fh/files/blogs/google_security_infographic.pdf" target="_blank" rel="noreferrer noopener">65% of all people</a> reuse the same password across multiple accounts. As a result, credential stuffing attacks are one of the <a href="https://enterprise.verizon.com/resources/reports/dbir/" target="_blank" rel="noreferrer noopener">most common</a> causes of data breaches globally.</p><h3 id="How-to-Protect-Against-Credential-Stuffing-Attacks">How to Protect Against Credential Stuffing Attacks</h3><p>The best way to protect against credential stuffing attacks is by either implementing <a href="https://auth0.com/passwordless/" target="_blank" rel="noreferrer noopener">passwordless authentication</a> or <a href="https://auth0.com/multifactor-authentication" target="_blank" rel="noreferrer noopener">multi-factor authentication</a> (MFA). Passwordless authentication prevents bad actors from using stolen credentials by eliminating them altogether, while MFA requires bad actors to verify their identity in one or more ways in addition to the stolen credentials they‚Äôre using to log in.</p><h2 id="6--Password-Spraying-Attacks">6. Password Spraying Attacks</h2><p>Password spraying is also a type of brute-force attack where bad actors attempt to guess a user‚Äôs password from a list of common passwords like ‚Äú123456‚Äù or ‚Äúpassword.‚Äù</p><p>Like credential stuffing, password spraying is quite common. For example, Verizon‚Äôs 2020 Data Breach Report showed that over <a href="https://enterprise.verizon.com/content/verizonenterprise/us/en/index/resources/reports/2020-data-breach-investigations-report.pdf" target="_blank" rel="noreferrer noopener">80% of all hacking-related data breaches</a> involved brute-force methods like password spraying.</p><h3 id="How-to-Protect-Against-Password-Spraying-Attacks">How to Protect Against Password Spraying Attacks</h3><p>Password spraying attacks can be prevented by using passwordless authentication or MFA, just like credential stuffing attacks can be. However, you can also reduce the risk and impact of a data breach via password spraying by following the <a href="https://auth0.com/blog/dont-pass-on-the-new-nist-password-guidelines/" target="_blank" rel="noreferrer noopener">NIST Password Guidelines</a>, which are considered the best password standards in the world.</p><h2 id="7--Mobile-Device-Attacks">7. Mobile Device Attacks</h2><p><a href="https://www.t-mobile.com/content/dam/tfb/pdf/T-Mobile-for-Business-2020-Workplace-Mobility-Report.pdf?icid=TFB_TMO_P_TFBFTRWRKS_7LCBNVDVYBXY27WF321599" target="_blank" rel="noreferrer noopener">Many organizations are working to increase the mobility</a> of their workforce because it improves operational efficiency and productivity. However, cybercriminals are well aware of this fact and are targeting mobile devices more frequently <a href="https://www.zdnet.com/article/mobile-malware-attacks-are-booming-in-2019-these-are-the-most-common-threats/" target="_blank" rel="noreferrer noopener">year</a> over <a href="https://www.mcafee.com/content/dam/consumer/en-us/docs/2020-Mobile-Threat-Report.pdf" target="_blank" rel="noreferrer noopener">year</a> with a variety of attacks on this list, which puts organizations at risk for a data breach through more devices than before.</p><p><a href="https://blog.lookout.com/lookout-trident-pegasus-enterprise-discovery" target="_blank" rel="noreferrer noopener">The Pegasus attack</a> on Apple‚Äôs iOS software is a prime example. Pegasus infected iPhones through phishing text messages that asked recipients to click on a link inside the text message. Clicking the link triggered the installation of spyware capable of monitoring people through their camera and microphone. And once infected, users had their login credentials stolen from WhatsApp, Gmail, and other sensitive communication applications.</p><h3 id="How-to-Protect-Against-Mobile-Device-Attacks">How to Protect Against Mobile Device Attacks</h3><p>Protecting your organization against mobile security threats requires a strong enterprise mobility management (EMM) program, as well as mobile device management (MDM) tools that help you protect any company data that may be on your employees‚Äô personal or work devices. Identity and access management tools like multi-factor authentication can also help secure any work applications that contain sensitive information from unauthorized access.</p><h2 id="Create-Additional-Layers-of-Security-at-the-Login-Stage">Create Additional Layers of Security at the Login Stage</h2><p>The impact of many cyberattacks on this list (as well as <a href="https://www.google.com/url?q=https://auth0.com/resources/whitepapers/state-of-security-identity-report&amp;sa=D&amp;source=editors&amp;ust=1624045583510000&amp;usg=AOvVaw0jtWJoRiARLi1pwCySdu1J" target="_blank" rel="noreferrer noopener">others that many companies face</a>) can be mitigated or prevented with strong authentication protocols.</p><p>First and foremost, this means good password policies and sound employee education. However, taking the next step to <a href="https://www.google.com/url?q=https://auth0.com/login-security&amp;sa=D&amp;source=editors&amp;ust=1624045583512000&amp;usg=AOvVaw2FeIurZ9Qr026LNUW7RDFZ" target="_blank" rel="noreferrer noopener">secure login procedures</a> with security functionality like multi-factor authentication, <a href="https://auth0.com/docs/attack-protection/brute-force-protection" target="_blank" rel="noreferrer noopener">brute-force protection</a>, or passwordless authentication can add a new dimension of safety to your system.</p><p>Auth0 makes it easy to build secure authentication for the right people without compromising on user experience ‚Äî <a href="https://auth0.com/resources/videos/platform-introduction-video-2020" target="_blank" rel="noreferrer noopener">learn more about Auth0‚Äôs platform here</a>.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>Auth0‚Äôs modern approach to identity enables organizations to provide secure access to any application, for any user. The Auth0 platform is a highly customizable identity operating system that is as simple as development teams want and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Mon, 16 Aug 2021 15:44:00 +0000</pubDate>
    </item>
    <item>
      <title>Async Await in Swift</title>
      <link>https://auth0.com/blog/async-await-in-swift/</link>
      <description>A guide to fully understand the new concurrency system in Swift.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>This year, WWDC came with a bunch of new features and updates. Maybe one of the most expected was the introduction of the new concurrency system by using async/await syntax. This is a huge improvement in the way that we write asynchronous code. </p><h2 id="Before-Async-Await">Before Async/Await</h2><p>Imagine that we are working on an app for a grocery store and, we want to display its list of products. We are probably going to have something like this:</p><pre><code><span>func</span> <span>fetchProducts</span><span>(</span><span>_</span> completion<span>:</span> @<span>escaping</span><span>(</span><span>[</span><span>Product</span><span>]</span><span>)</span> <span>-</span><span>&gt;</span> <span>Void</span><span>)</span> <span>{</span><span>.</span><span>.</span><span>.</span><span>}</span>

<span>var</span> products <span>=</span> <span>[</span><span>Product</span><span>]</span><span>(</span><span>)</span>
fetchProducts <span>{</span> <span>[</span><span>weak</span> <span>self</span><span>]</span> products <span>in</span>
    <span>guard</span> <span>let</span> strongSelf <span>=</span> <span>self</span> <span>else</span> <span>{</span> <span>return</span> <span>}</span>
    strongSelf<span>.</span>products<span>.</span><span>append</span><span>(</span>contentsOf<span>:</span> products<span>)</span>
<span>}</span></code></pre><p>A pretty standard and well-known code using completion blocks. Now suppose that the grocery store has, once in a while, some kind of offers for some products (e.g., &#34;Take 2, pay 1&#34;). And, we want to hold a list with these offers. Let&#39;s adjust our code by creating a new function to retrieve a String with the promotion text, given a specific product.</p><pre><code><span>func</span> <span>fetchProducts</span><span>(</span><span>_</span> completion<span>:</span> @<span>escaping</span><span>(</span><span>[</span><span>Product</span><span>]</span><span>)</span> <span>-</span><span>&gt;</span> <span>Void</span><span>)</span> <span>{</span><span>.</span><span>.</span><span>.</span><span>}</span>
<span>func</span> <span>getOffer</span><span>(</span><span>for</span> product<span>:</span> <span>Int</span><span>,</span> @<span>escaping</span><span>(</span><span>String</span><span>)</span> <span>-</span><span>&gt;</span> <span>Void</span><span>)</span> <span>{</span><span>.</span><span>.</span><span>.</span><span>}</span>

<span>typealias</span> <span>ProductOffer</span> <span>=</span> <span>(</span>productId<span>:</span> <span>Int</span><span>,</span> offer<span>:</span> <span>String</span><span>)</span>
<span>var</span> products <span>=</span> <span>[</span><span>Product</span><span>]</span><span>(</span><span>)</span>
<span>var</span> offers <span>=</span> <span>[</span><span>ProductOffer</span><span>]</span><span>(</span><span>)</span>

fetchProducts <span>{</span> <span>[</span><span>weak</span> <span>self</span><span>]</span> products <span>in</span>
    <span>guard</span> <span>let</span> strongSelf <span>=</span> <span>self</span> <span>else</span> <span>{</span> <span>return</span> <span>}</span>

    <span>for</span> product <span>in</span> products <span>{</span>
        strongSelf<span>.</span>products<span>.</span><span>append</span><span>(</span>product<span>)</span>

        <span>getOffer</span><span>(</span><span>for</span><span>:</span> product<span>.</span>id<span>)</span> <span>{</span> <span>[</span><span>weak</span> <span>self</span><span>]</span> offerText <span>in</span>
            <span>guard</span> <span>let</span> strongSelf <span>=</span> <span>self</span> <span>else</span> <span>{</span> <span>return</span> <span>}</span>
            <span>let</span> productOffer <span>=</span> <span>ProductOffer</span><span>(</span>productId<span>:</span> product<span>.</span>id<span>,</span> offer<span>:</span> offerText<span>)</span>
            strongSelf<span>.</span>offers<span>.</span><span>append</span><span>(</span>productOffer<span>)</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><p>We only have two nested closures for a simple feature, and you can see that our code starts to get a little messed up.</p><h2 id="Async-Await">Async/Await</h2><p>From Swift 5.5 onwards, we can start using async/await functions to write asynchronous code without using completion handlers to returns values. Instead, we are allowed to return the values in the return object directly.</p><p>To mark a function as asynchronous, we only have to put the keyword <strong>async</strong> before the return type.</p><pre><code><span>func</span> <span>fetchProducts</span><span>(</span><span>)</span> async <span>-</span><span>&gt;</span> <span>[</span><span>Product</span><span>]</span> <span>{</span><span>.</span><span>.</span><span>.</span><span>}</span>
<span>func</span> <span>getOffer</span><span>(</span><span>for</span> product<span>:</span> <span>Int</span><span>)</span> async <span>-</span><span>&gt;</span> <span>String</span> <span>{</span><span>.</span><span>.</span><span>.</span><span>}</span></code></pre><p>This is much easier and simple to read, but the best part comes from the caller&#39;s side. When we want to use the result of a function marked as <strong>async,</strong> we need to make sure that its execution is already completed. To make this possible, we need to write the <strong>await</strong> keyword in front of the function call. By doing this, the current execution will be paused until the result is available for its use.</p><pre><code><span>let</span> products <span>=</span> await <span>fetchProducts</span><span>(</span><span>)</span>

<span>for</span> product <span>in</span> products <span>{</span>
    <span>let</span> offerText <span>=</span> await <span>getOffer</span><span>(</span><span>for</span><span>:</span> product<span>.</span>id<span>)</span>

    <span>if</span> <span>!</span>offerText<span>.</span><span>isEmpty</span> <span>{</span>
        <span>let</span> productOffer <span>=</span> <span>ProductOffer</span><span>(</span>productId<span>:</span> product<span>.</span>id<span>,</span> offer<span>:</span> offerText<span>)</span>
        offers<span>.</span><span>append</span><span>(</span>productOffer<span>)</span>
    <span>}</span>
<span>}</span></code></pre><p>Although, if we want to execute other tasks while the async function is being executed, we should put the keyword <strong>async</strong> in front of the variable (or let) declaration. In this case, the <strong>await</strong> keyword will need to be placed in front of the variable (or let) where we are accessing the result of the async function.</p><pre><code>async <span>let</span> products <span>=</span> <span>fetchProducts</span><span>(</span><span>)</span>
<span>.</span><span>.</span><span>.</span>
<span>// Do some work</span>
<span>.</span><span>.</span><span>.</span>
<span>print</span><span>(</span>await products<span>)</span></code></pre><h3 id="Parallel-Asynchronous-Functions">Parallel Asynchronous Functions</h3><p>Now imagine that in our app, we want to fetch products by category‚Äîfor example, just the frozen products. Let&#39;s go ahead and make the adjustments to our code.</p><pre><code><span>enum</span> <span>ProductCategory</span> <span>{</span>
    <span>case</span> frozen
    <span>case</span> meat
    <span>case</span> vegetables
    <span>.</span><span>.</span><span>.</span>
<span>}</span>

<span>func</span> <span>fetchProducts</span><span>(</span>fromCategory category<span>:</span> <span>ProductCategory</span><span>)</span> async <span>-</span><span>&gt;</span> <span>[</span><span>Product</span><span>]</span> <span>{</span><span>.</span><span>.</span><span>.</span><span>}</span>

<span>let</span> frozenProducts <span>=</span> await <span>fetchProducts</span><span>(</span>fromCategory<span>:</span> <span>.</span>frozen<span>)</span>
<span>let</span> meatProducts <span>=</span> await <span>fetchProducts</span><span>(</span>fromCategory<span>:</span> <span>.</span>meat<span>)</span>
<span>let</span> vegetablesProducts <span>=</span> await <span>fetchProducts</span><span>(</span>fromCategory<span>:</span> <span>.</span>vegetals<span>)</span></code></pre><p>This is ok, but the code will run in serial mode,  which means that we won&#39;t start fetching the meat products until the frozen products are retrieved. Same for the vegetables. Remember, we write the <strong>await</strong> keyword if we want to pause our execution until the function completes its work. However, in this particular scenario, we could start fetching the three categories at the same time, running in parallel.</p><p>In order to accomplish this, we need to write the <strong>async</strong> keyword in front of the var (or let) declaration and use the <strong>await</strong> keyword when we want to use it.</p><pre><code>async <span>let</span> frozenProducts <span>=</span> await <span>fetchProducts</span><span>(</span>fromCategory<span>:</span> <span>.</span>frozen<span>)</span>
async <span>let</span> meatProducts <span>=</span> await <span>fetchProducts</span><span>(</span>fromCategory<span>:</span> <span>.</span>meat<span>)</span>
async <span>let</span> vegetablesProducts <span>=</span> await <span>fetchProducts</span><span>(</span>fromCategory<span>:</span> <span>.</span>vegetables<span>)</span> 

<span>.</span><span>.</span><span>.</span><span>.</span>

<span>let</span> products <span>=</span> await <span>[</span>frozenProducts<span>,</span> meatProducts<span>,</span> vegetablesProducts<span>]</span></code></pre><h3 id="Error-handlers">Error handlers</h3><p>Our fetching functions might have some errors that make it impossible to return the expected data values. How do we handle this in our async/await context?</p><p>We have a couple of options. The first one is to return the well-known Result object.</p><pre><code><span>func</span> <span>fetchProducts</span><span>(</span><span>)</span> async <span>-</span><span>&gt;</span> <span>Result</span><span>&lt;</span><span>[</span><span>Product</span><span>]</span><span>,</span> <span>Error</span><span>&gt;</span> <span>{</span><span>.</span><span>.</span><span>.</span><span>}</span>

<span>let</span> result <span>=</span> <span>try</span> await <span>fetchProducts</span><span>(</span><span>)</span>
<span>switch</span> result <span>{</span>
    <span>case</span> <span>.</span><span>success</span><span>(</span><span>let</span> products<span>)</span><span>:</span>
        <span>// Handle success</span>
    <span>case</span> <span>.</span><span>failure</span><span>(</span><span>let</span> error<span>)</span><span>:</span>
        <span>// Handle error</span>
<span>}</span></code></pre><p>Another one is to use the try/catch approach.</p><pre><code><span>func</span> <span>fetchProducts</span><span>(</span><span>)</span> async <span>throws</span> <span>-</span><span>&gt;</span> <span>[</span><span>Product</span><span>[</span> <span>{</span><span>.</span><span>.</span><span>.</span><span>}</span>
<span>.</span><span>.</span><span>.</span>
<span>do</span> <span>{</span>
    <span>let</span> products <span>=</span> <span>try</span> await <span>fetchProducts</span><span>(</span><span>)</span>
<span>}</span> <span>catch</span> <span>{</span>
    <span>// Handle the error</span>
<span>}</span></code></pre><p>The main benefit that we had when using the Result type was to improve our completion handlers. In addition to that, we got a cleaner code at the moment we used the result, being able to switch between success and failure cases.</p><p>On the other hand, the use of throw errors adds extra readability in the function&#39;s definition because we only need to put the result type that the function will return. The errors handling is hidden in the function&#39;s implementation.</p><h3 id="Asynchronous-Sequences">Asynchronous Sequences</h3><p>Let&#39;s say that we have a requirement to load a list of products from some .csv file. A traditional way to do this is to load all the lines at once and then start processing them. But, what happens if we want to start doing some work as soon as we have one of the lines available? We can now do this using an asynchronous sequence.</p><pre><code><span>let</span> url <span>=</span> <span>URL</span><span>(</span>string<span>:</span> <span>&#34;http://www.grocery.com/products.csv&#34;</span><span>)</span>
<span>for</span> <span>try</span> await <span>in</span> url<span>.</span>lines <span>{</span>
    <span>// Do some work</span>
<span>}</span></code></pre><p>Using this new feature also allows us to handle this particular case (reading a file) in a simpler way than before. You can check this <a href="https://stackoverflow.com/questions/24581517/read-a-file-url-line-by-line-in-swift" target="_blank" rel="noreferrer noopener">stackoverflow discussion</a> to see how we had to do this and see the advantages that this approach has over the previous one.</p><h3 id="Async-Await-vs--Completion-Handlers">Async/Await vs. Completion Handlers</h3><p>As we saw in the previous sections, the use of async/await syntax comes with a lot of improvements in contrast with using completion blocks. Let&#39;s make a quick recap.</p><h4 id="Advantages">Advantages</h4><ul><li>Avoid the Pyramid of Doom problem with nested closures</li><li>Reduction of code</li><li>Easier to read</li><li>Safety. With async/await, a result is guaranteed, while completion blocks might or might not be called.</li></ul><h4 id="Disadvantages">Disadvantages</h4><ul><li>It&#39;s only available from Swift 5.5 and iOS 15 onwards.</li></ul><h2 id="Actors">Actors</h2><p>Take a look at the following example, just a simple Order class in which we will be adding products and eventually make the checkout.</p><pre><code><span>class</span> <span>Order</span> <span>{</span>
    
    <span>var</span> products <span>=</span> <span>[</span><span>Product</span><span>]</span><span>(</span><span>)</span>
    <span>var</span> finalPrice <span>=</span> <span>0</span>

    <span>func</span> <span>addProduct</span><span>(</span><span>_</span> product<span>:</span> <span>Product</span><span>)</span> <span>{</span>
        products<span>.</span><span>append</span><span>(</span>product<span>)</span>
        finalPrice <span>+</span><span>=</span> product<span>.</span>price
    <span>}</span>
<span>}</span></code></pre><p>If we are in a single-thread application, this code is just fine. But what happens if we have multiple threads that can access our order&#39;s final price? </p><ol start="1"><li>We are on the product list and add some specific products to our order. The app will call the <strong>addProduct</strong> function.</li><li>The product is added to our order&#39;s product list</li><li>Before the final price gets updated, the user tries to checkout.</li><li>The app will read the final price of our order</li><li>The <strong>addProduct</strong> function completes and updates the final price. But the user already checkout and paid less than they should.</li></ol><p>This problem is known as <a href="https://en.wikipedia.org/wiki/Race_condition" target="_blank" rel="noreferrer noopener"><strong>Data Races</strong></a> when some particular resource could be accessed from multiple parts of the app&#39;s code.</p><p>Actors, also introduced in Swift 5.5 and iOS 15, resolve this problem for us. An Actor is basically like a class but with a few key differences that make them <em>thread-safe</em>:</p><ul><li>Only allow accessing their state by one task at a time</li><li>Stored properties and functions can only be access from outside the Actor if the operation is performed asynchronously.</li><li>Stored properties can&#39;t be written from outside the Actor.</li></ul><p>On the downside:</p><ul><li>Actors do not support inheritance</li></ul><p>You can think about the Actors like a similar solution of the <a href="https://en.wikipedia.org/wiki/Semaphore_(programming" target="_blank" rel="noreferrer noopener">semaphores</a>) concept.</p><p>To create one, we just need to use the <strong>actor</strong> keyword.</p><pre><code>actor <span>Order</span> <span>{</span>
    
    <span>var</span> products <span>=</span> <span>[</span><span>Product</span><span>]</span><span>(</span><span>)</span>
    <span>var</span> finalPrice <span>=</span> <span>0</span>

    <span>func</span> <span>addProduct</span><span>(</span><span>_</span> product<span>:</span> <span>Product</span><span>)</span> <span>{</span>
        products<span>.</span><span>append</span><span>(</span>product<span>)</span>
        finalPrice <span>+</span><span>=</span> product<span>.</span>price
    <span>}</span>
<span>}</span></code></pre><p>And we can create an instance using the same initializer syntax as structures and classes. If we want to access the final price, we must do it using the keyword await (because outside the actor&#39;s scope, we are only allowed to access the properties asynchronously).</p><pre><code><span>print</span><span>(</span>await order<span>.</span>finalPrice<span>)</span></code></pre><h2 id="Conclusion">Conclusion</h2><p>Definitely <strong>async/await</strong> brings to the table an easier way to write asynchronous code, removing the need to use completion blocks. In addition, we get more readable and flexible code if our application starts scaling up. </p><p>However, the minimum iOS deployment target will be an entry barrier for most of us unless you start a project from scratch, in which case is highly recommended to wait until the official release of iOS 15 + Xcode 13 + Swift 5.5  to take full advantage of the new concurrency system.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 12 Aug 2021 15:07:00 +0000</pubDate>
    </item>
    <item>
      <title>Build and Secure an API with Spring Boot and Kotlin</title>
      <link>https://auth0.com/blog/build-and-secure-an-api-with-spring-boot/</link>
      <description>See how easy it is to bootstrap a CRUD API with Spring Initializr, build it with Spring Boot and Kotlin, and secure it with Auth0.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> In this article, you‚Äôll learn how to quickly build a RESTful API using the Spring Boot framework and the Kotlin programming language. You‚Äôll then use Auth0 to secure the API so that only authorized parties can use its key functions. You can find the final code for the project developed throughout this article in <a href="https://github.com/AccordionGuy/HotSauces" target="_blank" rel="noreferrer noopener">this GitHub repository</a>.</p><blockquote><p><strong>Look for the üå∂ emoji if you‚Äôd like to skim through the content while focusing on the build and execution steps.</strong></p></blockquote><h2 id="Spring-Framework--Spring-Boot--and-Kotlin--An-Overview">Spring Framework, Spring Boot, and Kotlin: An Overview</h2><p>Before we start building the project, let‚Äôs look at the frameworks and language you‚Äôll use.</p><h3 id="Spring-Framework">Spring Framework</h3><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6WdgKiAbhNyVIQWDECzf48/fc4dd3f38700ba0f9a143bdaee8c9479/spring_icon.png" alt="Spring Framework icon"/></p><p><a href="https://spring.io/projects/spring-framework" target="_blank" rel="noreferrer noopener">Spring Framework</a>, often shortened to just ‚ÄúSpring‚Äù, is a popular open source application framework for the Java platform. It‚Äôs built on the principle of <a href="https://dzone.com/articles/understanding-inversion-of-control-and-dependency" target="_blank" rel="noreferrer noopener">inversion of control</a>, whose name implies that control of a Spring application is the opposite of how program control works in traditional applications. Instead of your code directing the application and calling on functionality from a library, the framework directs the application and calls on functionality from your code.</p><p>This approach makes it possible to write an application as a collection of components, with the connections between them maintained by Spring. Spring provides a lot of ready-built components called <em>dependencies</em> that provide functionality that applications commonly require. The end result is a system for building applications that are modular, flexible, quicker to write, and easy to maintain.</p><p>Spring is often described ‚Äî especially by Java developers, who‚Äôve grown used to working with unwieldy frameworks ‚Äî as lightweight. It provides a set of built-in often-needed capabilities such as MVC, caching, messaging, security, and data access. It significantly reduces the amount of code you have to write and lets you focus on the functionality specific to your application.</p><p>While Spring is often used for web and server-based applications, it‚Äôs a general application framework and it can be used to write desktop and mobile applications as well.</p><h3 id="Spring-Boot">Spring Boot</h3><p><img src="https://images.ctfassets.net/23aumh6u8s0i/17rXel2g1r2rxiGkpeHNSy/dd64d06b65c7e095b6bcdeffecbd0a9f/spring_boot_icon.png" alt="Spring Boot icon"/></p><p><a href="https://spring.io/projects/spring-boot" target="_blank" rel="noreferrer noopener">Spring Boot</a> is a framework built on top of Spring that simplifies Spring development. It does this by enforcing an <a href="https://www.quora.com/What-is-a-Opinionated-Framework" target="_blank" rel="noreferrer noopener">opinionated</a> approach to Spring application development through <a href="https://facilethings.com/blog/en/convention-over-configuration" target="_blank" rel="noreferrer noopener">‚Äúconvention over configuration‚Äù</a>, the use of default setups that applications are likely to use, and a standardized application structure created by a generator that goes by the decidedly ‚ÄúWeb 2.0‚Äù name of <a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noreferrer noopener">Spring Initializr</a>. Thanks to this ‚Äúit just works‚Äù approach, it‚Äôs the fastest way to develop applications with the Spring framework.</p><h3 id="Kotlin">Kotlin</h3><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1lE1Sn0pHAIa082QVEhJ0f/b4c6184a9387900f457d260d6e0aeb38/kotlin_icon.png" alt="Kotlin icon"/></p><p><a href="https://kotlinlang.org/" target="_blank" rel="noreferrer noopener">Kotlin</a> is part of the wave of programming languages that appeared in the 2010s, which includes <a href="https://dart.dev/" target="_blank" rel="noreferrer noopener">Dart</a>, <a href="https://golang.org/" target="_blank" rel="noreferrer noopener">Go</a>, <a href="https://www.rust-lang.org/" target="_blank" rel="noreferrer noopener">Rust</a>, and <a href="https://developer.apple.com/swift/" target="_blank" rel="noreferrer noopener">Swift</a>. These languages have a number of common traits including their own takes on object-oriented programming from the lessons of the 1990s and functional programming from the lessons of the 2000s, inferred strong static typing, and meteoric rises in popularity (all of them are in <a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noreferrer noopener">TIOBE‚Äôs index of popular programming languages</a>, and all of them except Kotlin are in the top 20).</p><p>As a programming language designed by <a href="https://developer.apple.com/swift/" target="_blank" rel="noreferrer noopener">a company that makes developer tools</a>, Kotlin is unique in its origin. It was designed to be an <a href="https://kotlinlang.org/docs/reference/comparison-to-java.html" target="_blank" rel="noreferrer noopener">improvement on Java</a>, with many of the language features of <a href="https://www.scala-lang.org/" target="_blank" rel="noreferrer noopener">Scala</a> (but faster compile times) and with the power and convenience that comes from interoperability with Java and the Java platform. It has grown to become the preferred language for Android app development; as of July 2021, <a href="https://developer.android.com/kotlin/stories?linkId=94116374" target="_blank" rel="noreferrer noopener">80% of the top 1,000 apps in Google Play were written in Kotlin.</a> According to JetBrains‚Äô <a href="https://www.jetbrains.com/lp/devecosystem-2020/" target="_blank" rel="noreferrer noopener"><em>State of Developer Ecosystem 2020</em> report,</a> Kotlin is also making serious inroads into web and enterprise development territory.</p><p>Since Spring and Spring Boot are based on the Java platform, you can use them to build applications using any JVM-based programming language, including Kotlin. If Java‚Äôs verbosity is bringing you down, or if you‚Äôre an Android developer who wants to write the back end for your app but don‚Äôt want to switch languages, Spring and Spring Boot development in Kotlin is for you!</p><h2 id="What-You-ll-Build--A-Hot-Sauce-API">What You‚Äôll Build: A Hot Sauce API</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5VZbuSuMi49Zp9x0bmAK7b/fdd5ca6bac1efdd66ce9e5984e62b0ae/a-hot-sauce-api.jpg" alt="A Hot Sauce API (A tray of hot sauce bottles, viewed from above))"/></p><p>You‚Äôll build an API that acts as a catalog of <a href="https://en.wikipedia.org/wiki/Hot_sauce" target="_blank" rel="noreferrer noopener">hot sauces</a>. It will be a simple one, exposing a single resource named <strong>hotsauces</strong>.</p><p>The API will provide endpoints for:</p><ul><li>Confirming that it is operational</li><li>Getting a list of all the hot sauces in the catalog</li><li>Getting the number of hot sauces in the catalog</li><li>Adding a hot sauce to the catalog</li><li>Editing any hot sauce in the catalog</li><li>Deleting a hot sauce from the catalog</li></ul><p>In the first part of the project, you‚Äôll build the API. Once built, you‚Äôll secure it so that the endpoints for CRUD operations will require authentication. The endpoint for testing to see if the API is operational will remain public.</p><h2 id="Prerequisites">Prerequisites</h2><p>To follow along with this article, you‚Äôll need the following installed on your local machine:</p><ul><li><strong><a href="https://www.oracle.com/java/technologies/javase-jdk11-downloads.html" target="_blank" rel="noreferrer noopener">JDK 11</a></strong></li><li>You‚Äôll need some command-line tool for issuing HTTP requests. The examples in this article will use the following:
<ul><li>For macOS and Linux, the <a href="https://curl.haxx.se/" target="_blank" rel="noreferrer noopener">curl</a> command line tool</li><li>For Windows, <a href="https://docs.microsoft.com/en-us/powershell/" target="_blank" rel="noreferrer noopener">PowerShell</a> and its <code>Invoke<span>-</span>RestMethod</code> and <code>Invoke<span>-</span>WebRequest</code> <a href="https://docs.microsoft.com/en-us/powershell/scripting/developer/cmdlet/cmdlet-overview?view=powershell-7.1" target="_blank" rel="noreferrer noopener">cmdlets</a>.</li></ul></li><li>Your favorite code editor</li></ul><p>You‚Äôll also need internet access, as you‚Äôll be using the Spring Initializr web page and the <a href="https://gradle.org/" target="_blank" rel="noreferrer noopener">Gradle</a> build tool, which goes online to download project dependencies.</p><h2 id="Building-the-API">Building the API</h2><h3 id="Scaffolding-with-Spring-Initializr">Scaffolding with Spring Initializr</h3><p>The preferred way to set up a new Spring Boot project is to use <strong><a href="https://start.spring.io" target="_blank" rel="noreferrer noopener">Spring Initializr</a></strong>, a web application that generates a basic Spring Boot project, complete with all the necessary configurations, your choice of dependencies, and Gradle or Maven build files. It‚Äôs available online at <a href="https://start.spring.io/" target="_blank" rel="noreferrer noopener">start.spring.io</a> and built into the Ultimate Edition of <a href="https://www.jetbrains.com/idea/" target="_blank" rel="noreferrer noopener">IntelliJ IDEA</a>.</p><p>You <em>could</em> create a new project manually using Spring Boot‚Äôs command-line interface, but Spring Initializr organizes its projects using a standardized directory layout for JVM-based projects. This makes your projects easier to maintain, and lets you focus on what your application actually <em>does</em>.</p><p>üå∂ Point your favorite browser at the <a href="https://start.spring.io/" target="_blank" rel="noreferrer noopener">Spring Initializr page</a>:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2Tay8vTcNWBA7HRyPUakuI/b2dbcee51217aff5aa7526ddc2d3724e/spring_initializr_blank.png" alt="The Spring Initializr webpage"/></p><p>Here‚Äôs how you should fill it out:</p><ul><li><em>Project:</em> Select <strong>Gradle Project</strong>.</li><li><em>Language:</em> Select <strong>Kotlin</strong>.</li><li><em>Spring Boot:</em> Select the latest stable version. At the time of writing, it‚Äôs version <strong>2.5.3</strong>.</li><li><em>Project Metadata:</em>
<ul><li><em>Group:</em> This should be something that uniquely identifies yourself or your organization. Typically, you‚Äôd enter your domain name in reverse notation (for example, if your domain is <strong>abc123.com</strong>, enter <strong>com.abc123</strong>. If you don‚Äôt have a domain name, just enter <strong>com.auth0</strong>.</li><li><em>Artifact:</em> This should be something that identifies the project. Enter <strong>hotsauces</strong>.</li><li><em>Name:</em> This will autofill based on what you entered for <em>Artifact</em>; just use the value in this field.</li><li><em>Description:</em> Enter <strong>A Spring Boot/Auth0 API project</strong> into this field.</li><li><em>Package name:</em> This will autofill based on what you entered for <em>Group</em> and <em>Artifact</em>; just use the value in this field.</li><li><em>Packaging:</em> Select <strong>Jar</strong>.</li><li><em>Java:</em> Select <strong>11</strong>.</li></ul></li><li><em>Dependencies:</em> Click the <strong>ADD DEPENDENCIES...</strong> button and choose the following:
<ul><li><strong>Spring Boot DevTools</strong>: A set of convenient tools for development.</li><li><strong>Spring Web</strong>: Provides a web server and facilities for building RESTful web applications and APIs.</li><li><strong>Spring Data JPA</strong>: Makes the process of building a data access layer almost trivial.</li><li><strong>H2 Database</strong>: This project will use the <a href="https://www.h2database.com/html/main.html" target="_blank" rel="noreferrer noopener">H2</a> in-memory database.</li><li><strong>Spring Boot Actuator</strong>: Adds a handy collection of diagnostic tools to a Spring Boot project.</li></ul></li></ul><p>Once filled out, the form should look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6kuJ07yRPE8vXdHRerx2ve/76fcdd422c6a1a9bdd8350277b53e40c/spring_initializr_filled.png" alt="The Spring Initializr webpage, filled out with this project&#39;s details"/></p><p>üå∂ With the form filled out, click the <strong>GENERATE</strong> button. The site will generate a .zip file, and it will automatically be downloaded to your local machine. Unzip the file to reveal the <strong>hotsauces</strong> project folder.</p><p>Within the <strong>hotsauces</strong> folder, you‚Äôll work in two specific areas for this exercise:</p><ul><li><strong>/src/main/kotlin/com/auth0/hotsauces/</strong>: The code for the project goes into this directory. At the moment, it contains a single file, <strong>HotSaucesApplication.kt</strong>. This contains a simple application class, which is the first code in the project that is executed when the application is run.</li><li><strong>/build.gradle.kts</strong>: This is the project‚Äôs Gradle build file. Among other things, it specifies which dependencies will be used by the project. You‚Äôll add some security-related dependencies to this file when securing the API.</li></ul><h3 id="Defining--HotSauces---the-Class-Behind-the-API-s-Resource">Defining <code>HotSauces</code>, the Class Behind the API‚Äôs Resource</h3><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2qejaKSqZDNvVhRZwUAHTH/ec35c47e1bdb1a910909e9ff097a91c8/wide-hot-sauces-tray.png" alt="A tray of different bottles of hot sauce"/></p><p>The first piece of code you‚Äôll write is the model behind the API‚Äôs only resource: hot sauces.</p><p>Each hot sauce has the following attributes:</p><ul><li><strong><code>id</code></strong> ‚Äî (number) The unique identifier for the hot sauce, and primary key.</li><li><strong><code>brandName</code></strong> ‚Äî (string) The name of the producer of the hot sauce.</li><li><strong><code>sauceName</code></strong> ‚Äî (string) The name of the hot sauce.</li><li><strong><code>description</code></strong> ‚Äî (string) A description of the hot sauce, with the appropriate keywords. This may be lengthy.</li><li><strong><code>url</code></strong> ‚Äî (number) The URL for the web page for the hot sauce.</li><li><strong><code>heat</code></strong> ‚Äî (number) The spiciness of the hot sauce, expressed in <a href="https://pepperheadsforlife.com/the-scoville-scale/" target="_blank" rel="noreferrer noopener">Scoville heat units (SHUs).</a></li></ul><p>üå∂ Create a new file named <strong>HotSauce.kt</strong> in the <strong>/src/main/kotlin/com/auth0/hotsauces/</strong> directory:</p><pre><code><span>// /src/main/kotlin/com/auth0/hotsauces/HotSauce.kt</span>

<span>package</span> com<span>.</span>auth0<span>.</span>hotsauces

<span>import</span> javax<span>.</span>persistence<span>.</span>Entity
<span>import</span> javax<span>.</span>persistence<span>.</span>GeneratedValue
<span>import</span> javax<span>.</span>persistence<span>.</span>GenerationType
<span>import</span> javax<span>.</span>persistence<span>.</span>Id
<span>import</span> javax<span>.</span>persistence<span>.</span>Lob

<span>@Entity</span>
<span>data</span> <span>class</span> <span>HotSauce</span><span>(</span>

    <span>// This property maps to the primary key in the database.</span>
    <span>@Id</span> <span>@GeneratedValue</span><span>(</span>strategy <span>=</span> GenerationType<span>.</span>AUTO<span>)</span>
    <span>val</span> id<span>:</span> Long <span>=</span> <span>0</span><span>,</span>

    <span>// These properties are NOT likely to be longer than 256 characters.</span>
    <span>var</span> brandName<span>:</span> String <span>=</span> <span>&#34;&#34;</span><span>,</span>
    <span>var</span> sauceName<span>:</span> String <span>=</span> <span>&#34;&#34;</span><span>,</span>

    <span>// These properties might be longer than 256 characters.</span>
    <span>@Lob</span>
    <span>var</span> description<span>:</span> String <span>=</span> <span>&#34;&#34;</span><span>,</span>
    <span>@Lob</span>
    <span>var</span> url<span>:</span> String <span>=</span> <span>&#34;&#34;</span><span>,</span>

    <span>var</span> heat<span>:</span> Int <span>=</span> <span>0</span>

<span>)</span></code></pre><p><code>HotSauce</code> is a Kotlin <strong><a href="https://kotlinlang.org/docs/reference/data-classes.html" target="_blank" rel="noreferrer noopener">data class</a></strong>, whose job is to hold data. Data classes are all properties and no methods ‚Äî or at least no <em>explicitly</em> defined methods, anyway. The compiler automatically provides a handful of ‚Äúbehind the scenes‚Äù methods to data classes, including <code><span>equals</span><span>(</span><span>)</span></code>, <code><span>hashCode</span><span>(</span><span>)</span></code>, and <code><span>toString</span><span>(</span><span>)</span></code>.</p><p>Kotlin classes, data classes included, have a constructor built into the class header. This constructor, called the <strong>primary constructor</strong>, takes its parameters in the parentheses that follow the class name. <code>HotSauce</code>, like many data classes, is just a class header and primary constructor, and nothing else.</p><p>Even though there isn‚Äôt much to the class, it uses some annotations to pull in a lot of extra functionality:</p><ul><li><code>HotSauce</code> is annotated with <code>@Entity</code>, which informs the Java Persistence API (JPA, one of the dependencies that you added in Spring Initializr) that its instances will be persisted in the database.</li><li>The <code>id</code> property is annotated with both <code>@Id</code> and <code>@GeneratedValue</code>, which makes sense, as it will map to the <code>id</code> field in the corresponding database table.</li><li>The <code>@Lob</code> annotation is short for ‚Äúlarge object‚Äù. It‚Äôs being used to annotate the <code>description</code> and <code>url</code> properties because they could contain strings longer than 256 characters. By default, JPA maps <code>String</code>s in entities to the <code><span>VARCHAR</span><span>(</span><span>256</span><span>)</span></code> type in the database; marking a <code>String</code> as <code>@Lob</code> tells JPA to map it to the <code><span>TEXT</span></code> type instead.</li></ul><p>If you‚Äôre new to Kotlin, make note of the keywords in the class‚Äô property declarations:</p><ul><li><code>val</code> is short for ‚Äúvalue‚Äù and declares a constant. A hot sauce‚Äôs <code>id</code> value shouldn‚Äôt be changed after it‚Äôs been created, so we‚Äôre declaring it with <code>val</code>.</li><li><code><span>var</span></code> is short for ‚Äúvariable‚Äù and that‚Äôs what it declares. All the other class properties should be editable, so we‚Äôre declaring them with <code><span>var</span></code>.</li></ul><p>You might be wondering about assigning the value <code><span>0</span></code> to <code>id</code>, which is a constant:</p><pre><code>@Id @<span>GeneratedValue</span><span>(</span>strategy <span>=</span> GenerationType<span>.</span><span>AUTO</span><span>)</span>
val id<span>:</span> Long <span>=</span> <span>0</span><span>,</span></code></pre><p>The line <code>val id<span>:</span> Long <span>=</span> <span>0</span><span>,</span></code> might make you think that every hot sauce will have an unchangeable <code>id</code> set to <code><span>0</span></code>. As a constant, the value of <code>id</code> can‚Äôt be changed by any code that <em>you</em> write, but the <code>@GeneratedValue</code> annotation allows Spring to use <a href="https://kotlinlang.org/docs/reflection.html" target="_blank" rel="noreferrer noopener">reflection</a> to get around that limitation and assign a unique <code>id</code> value for every sauce. Every modern application framework incorporates ‚Äúmagic‚Äù like this; I‚Äôve found that it‚Äôs simplest just to know where such instances are and to accept them.</p><p>With <code>HotSauce</code> defined, you have a <strong>model</strong> that represents hot sauces in the real world. By annotating it with <code>@Entity</code>, you‚Äôve specified that instances of <code>HotSauce</code> should be converted into <strong>entities</strong> ‚Äî that is, instances that have been saved to a database.</p><p>It‚Äôs time to set up something to save <code>HotSauce</code> instances.</p><h3 id="Adding-Data-Access-with-a--CrudRepository-">Adding Data Access with a <code>CrudRepository</code></h3><p>The <a href="https://deviq.com/repository-pattern/" target="_blank" rel="noreferrer noopener">Repository pattern</a> provides a layer of abstraction between an application‚Äôs models and the system used to store data. A repository provides a collection-style interface to the models, with methods for retrieving the whole collection, retrieving a specific item, and adding, editing, and deleting items. The repository insulates the models from the usual database concerns, such as connecting with it, setting up a reader, or worrying about things like cursors.</p><p>Spring provides a number of repository interfaces. In this project, you‚Äôll use the <a href="https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/repository/CrudRepository.html" target="_blank" rel="noreferrer noopener"><code>CrudRepository</code></a> interface to act as the intermediary between <code>HotSauce</code> and the H2 database (another one of the dependencies you added in Spring Initializr) as shown below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2CCk6CDxAKOrF7RJ6F05nw/8a14bb24936eaa0efc2364a31cb551bc/repository-pattern.png" alt="Repository Pattern"/></p><p>In this exercise, the underlying data store is the H2 in-memory database. The Repository pattern makes it so that changing the database doesn‚Äôt require you to make any changes to <code>HotSauce</code>, and Spring‚Äôs inversion of control architecture makes it so that such a change doesn‚Äôt even require a change to the <code>CrudRepository</code>.</p><p>üå∂ Create a new file named <strong>HotSauceRepository.kt</strong> in the <strong>/src/main/kotlin/com/auth0/hotsauces/</strong> directory:</p><pre><code><span>// /src/main/kotlin/com/auth0/hotsauces/HotSauceRepository.kt</span>

<span>package</span> com<span>.</span>auth0<span>.</span>hotsauces

<span>import</span> org<span>.</span>springframework<span>.</span>data<span>.</span>repository<span>.</span>CrudRepository

<span>interface</span> HotSauceRepository<span>:</span> CrudRepository<span>&lt;</span>HotSauce<span>,</span> Long<span>&gt;</span></code></pre><p>This code sets up an interface named <code>HotSauceRepository</code> that‚Äôs based on a <code>CrudRepository</code> of entities based on the <code>HotSauce</code> model, each of which is uniquely identified by a <code>Long</code> (namely, the <code>id</code> property of <code>HotSauce</code>).</p><p><code>CrudRepository</code> provides a set of methods for performing the standard set of CRUD operations. Here‚Äôs the subset that you‚Äôll use in this project:</p><ul><li><strong><code><span>count</span><span>(</span><span>)</span></code></strong> ‚Äî Returns the number of entities.</li><li><strong><code><span>deleteById</span><span>(</span><span>{</span>id<span>}</span><span>)</span></code></strong> ‚Äî Deletes the entity with the given id.</li><li><strong><code><span>existsById</span><span>(</span><span>{</span>id<span>}</span><span>)</span></code></strong> ‚Äî Returns <code><span>true</span></code> if the entity with the given id exists.</li><li><strong><code><span>findAll</span><span>(</span><span>)</span></code></strong> ‚Äî Retrieves all the entities.</li><li><strong><code><span>findById</span><span>(</span><span>{</span>id<span>}</span><span>)</span></code></strong> ‚Äî Retrieves the entity with the given id.</li><li><strong><code><span>save</span><span>(</span><span>)</span></code></strong> ‚Äî Saves the given entity.</li></ul><p>You‚Äôll use these methods in the controller, which you‚Äôll build next.</p><p>Note that you didn‚Äôt have to do anything to connect the repository to the database. Spring Boot‚Äôs inversion of control took care of that for you.</p><h3 id="Building-the-controller">Building the controller</h3><p>The controller should expose the following API endpoints:</p><ul><li><strong><code><span>GET</span> api<span>/</span>hotsauces</code></strong>: Returns the entire collection of hot sauces. Accepts these optional named parameters:
<ul><li><strong><code>brandname</code></strong>: Limits the results to only those sauces whose <code>brandName</code> contains the given string.</li><li><strong><code>saucename</code></strong> Limits the results to only those sauces whose <code>sauceName</code> contains the given string.</li><li><strong><code>desc</code></strong> Limits the results to only those sauces whose <code>description</code> contains the given string.</li><li><strong><code>minheat</code></strong> Limits the results to only those sauces whose <code>heat</code> rating is greater than or equal to the given number.</li><li><strong><code>maxheat</code></strong> Limits the results to only those sauces whose <code>heat</code> rating is less than or equal to the given number.</li></ul></li><li><strong><code><span>GET</span> api<span>/</span>hotsauces<span>/</span><span>{</span>id<span>}</span></code></strong>: Returns the hot sauce with the given id.</li><li><strong><code><span>GET</span> api<span>/</span>hotsauces<span>/</span>count</code></strong>: Returns the number of hot sauces.</li><li><strong><code><span>POST</span> api<span>/</span>hotsauce</code></strong>: Adds a hot sauce whose details are included in the request.</li><li><strong><code><span>PUT</span> api<span>/</span>hotsauces<span>/</span><span>{</span>id<span>}</span></code></strong>: Updates the hot sauce with the given id using the details included in the request.</li><li><strong><code><span>DELETE</span> api<span>/</span>hotsauces<span>/</span><span>{</span>id<span>}</span></code></strong>: Deletes the hot sauce with the given id.</li></ul><p>üå∂ Create a new file named <strong>HotSauceController.kt</strong> in the <strong>/src/main/kotlin/com/auth0/hotsauces/</strong> directory:</p><pre><code><span>// /src/main/kotlin/com/auth0/hotsauces/HotSauceController.kt</span>

<span>package</span> com<span>.</span>auth0<span>.</span>hotsauces

<span>import</span> org<span>.</span>springframework<span>.</span>http<span>.</span>HttpStatus
<span>import</span> org<span>.</span>springframework<span>.</span>http<span>.</span>ResponseEntity
<span>import</span> org<span>.</span>springframework<span>.</span>web<span>.</span>bind<span>.</span>annotation<span>.</span><span>*</span>
<span>import</span> java<span>.</span>util<span>.</span><span>*</span>

<span>@RestController</span>
<span>@RequestMapping</span><span>(</span><span>&#34;/api/hotsauces&#34;</span><span>)</span>
<span>class</span> <span>HotSauceController</span><span>(</span><span>private</span> <span>val</span> hotSauceRepository<span>:</span> HotSauceRepository<span>)</span> <span>{</span>

    <span>// GET api/hotsauces</span>
    <span>@GetMapping</span><span>(</span><span>&#34;&#34;</span><span>)</span>
    <span>fun</span> <span>getAll</span><span>(</span><span>@RequestParam</span><span>(</span>value<span>=</span><span>&#34;brandname&#34;</span><span>,</span> required <span>=</span> <span>false</span><span>,</span> defaultValue <span>=</span> <span>&#34;&#34;</span><span>)</span> brandNameFilter<span>:</span> String<span>,</span>
               <span>@RequestParam</span><span>(</span>value<span>=</span><span>&#34;saucename&#34;</span><span>,</span> required <span>=</span> <span>false</span><span>,</span> defaultValue <span>=</span> <span>&#34;&#34;</span><span>)</span> sauceNameFilter<span>:</span> String<span>,</span>
               <span>@RequestParam</span><span>(</span>value<span>=</span><span>&#34;desc&#34;</span><span>,</span> required <span>=</span> <span>false</span><span>,</span> defaultValue <span>=</span> <span>&#34;&#34;</span><span>)</span> descFilter<span>:</span> String<span>,</span>
               <span>@RequestParam</span><span>(</span>value<span>=</span><span>&#34;minheat&#34;</span><span>,</span> required <span>=</span> <span>false</span><span>,</span> defaultValue <span>=</span> <span>&#34;&#34;</span><span>)</span> minHeat<span>:</span> String<span>,</span>
               <span>@RequestParam</span><span>(</span>value<span>=</span><span>&#34;maxheat&#34;</span><span>,</span> required <span>=</span> <span>false</span><span>,</span> defaultValue <span>=</span> <span>&#34;&#34;</span><span>)</span> maxHeat<span>:</span> String<span>)</span><span>:</span> ResponseEntity<span>&lt;</span>List<span>&lt;</span>HotSauce<span>&gt;</span><span>&gt;</span> <span>{</span>
        <span>val</span> MAX_SCOVILLE <span>=</span> <span>3_000_000</span> <span>// At this point, it&#39;s no longer food, but a weapon</span>
        <span>val</span> minHeatFilter <span>=</span> <span>if</span> <span>(</span><span>!</span>minHeat<span>.</span><span>isNullOrBlank</span><span>(</span><span>)</span><span>)</span> minHeat<span>.</span><span>toInt</span><span>(</span><span>)</span> <span>else</span> <span>0</span>
        <span>val</span> maxHeatFilter <span>=</span> <span>if</span> <span>(</span><span>!</span>maxHeat<span>.</span><span>isNullOrBlank</span><span>(</span><span>)</span><span>)</span> maxHeat<span>.</span><span>toInt</span><span>(</span><span>)</span> <span>else</span> MAX_SCOVILLE
        <span>return</span> <span>ResponseEntity</span><span>(</span>hotSauceRepository<span>.</span><span>findAll</span><span>(</span><span>)</span>
            <span>.</span><span>filter</span> <span>{</span> it<span>.</span>brandName<span>.</span><span>contains</span><span>(</span>brandNameFilter<span>,</span> <span>true</span><span>)</span> <span>}</span>
            <span>.</span><span>filter</span> <span>{</span> it<span>.</span>sauceName<span>.</span><span>contains</span><span>(</span>sauceNameFilter<span>,</span> <span>true</span><span>)</span> <span>}</span>
            <span>.</span><span>filter</span> <span>{</span> it<span>.</span>description<span>.</span><span>contains</span><span>(</span>descFilter<span>,</span> <span>true</span><span>)</span> <span>}</span>
            <span>.</span><span>filter</span> <span>{</span> it<span>.</span>heat <span>&gt;=</span> minHeatFilter <span>}</span>
            <span>.</span><span>filter</span> <span>{</span> it<span>.</span>heat <span>&lt;=</span> maxHeatFilter <span>}</span><span>,</span>
            HttpStatus<span>.</span>OK
        <span>)</span>
    <span>}</span>

    <span>// GET api/hotsauces/{id}</span>
    <span>@GetMapping</span><span>(</span><span>&#34;/count&#34;</span><span>)</span>
    <span>fun</span> <span>getCount</span><span>(</span><span>)</span><span>:</span> ResponseEntity<span>&lt;</span>Long<span>&gt;</span> <span>=</span> <span>ResponseEntity</span><span>(</span>hotSauceRepository<span>.</span><span>count</span><span>(</span><span>)</span><span>,</span>
            HttpStatus<span>.</span>OK<span>)</span>

    <span>// GET api/hotsauces/count</span>
    <span>@GetMapping</span><span>(</span><span>&#34;/{id}&#34;</span><span>)</span>
    <span>fun</span> <span>getHotSauce</span><span>(</span><span>@PathVariable</span> id<span>:</span> Long<span>)</span><span>:</span> ResponseEntity<span>&lt;</span>Optional<span>&lt;</span>HotSauce<span>&gt;</span><span>&gt;</span> <span>{</span>
        <span>if</span> <span>(</span>hotSauceRepository<span>.</span><span>existsById</span><span>(</span>id<span>)</span><span>)</span> <span>{</span>
            <span>return</span> <span>ResponseEntity</span><span>(</span>hotSauceRepository<span>.</span><span>findById</span><span>(</span>id<span>)</span><span>,</span> HttpStatus<span>.</span>OK<span>)</span>
        <span>}</span> <span>else</span> <span>{</span>
            <span>return</span> <span>ResponseEntity</span><span>(</span>HttpStatus<span>.</span>NOT_FOUND<span>)</span>
        <span>}</span>
    <span>}</span>

    <span>// POST api/hotsauce</span>
    <span>@PostMapping</span><span>(</span><span>)</span>
    <span>fun</span> <span>createHotSauce</span><span>(</span><span>@RequestBody</span> hotSauce<span>:</span> HotSauce<span>)</span><span>:</span> ResponseEntity<span>&lt;</span>HotSauce<span>&gt;</span> <span>{</span>
        <span>return</span> <span>ResponseEntity</span><span>(</span>hotSauceRepository<span>.</span><span>save</span><span>(</span>hotSauce<span>)</span><span>,</span> HttpStatus<span>.</span>CREATED<span>)</span>
    <span>}</span>

    <span>// PUT api/hotsauces/{id}</span>
    <span>@PutMapping</span><span>(</span><span>&#34;/{id}&#34;</span><span>)</span>
    <span>fun</span> <span>updateHotSauce</span><span>(</span><span>@PathVariable</span> id<span>:</span> Long<span>,</span> <span>@RequestBody</span> sauceChanges<span>:</span> HotSauce<span>)</span><span>:</span> ResponseEntity<span>&lt;</span>HotSauce<span>?</span><span>&gt;</span> <span>{</span>
        <span>if</span> <span>(</span>hotSauceRepository<span>.</span><span>existsById</span><span>(</span>id<span>)</span><span>)</span> <span>{</span>
            <span>val</span> originalSauce <span>=</span> hotSauceRepository<span>.</span><span>findById</span><span>(</span>id<span>)</span><span>.</span><span>get</span><span>(</span><span>)</span>
            <span>val</span> updatedSauce <span>=</span> <span>HotSauce</span><span>(</span>
                id <span>=</span> id<span>,</span>
                brandName <span>=</span> <span>if</span> <span>(</span>sauceChanges<span>.</span>brandName <span>!=</span> <span>&#34;&#34;</span><span>)</span> sauceChanges<span>.</span>brandName <span>else</span> originalSauce<span>.</span>brandName<span>,</span>
                sauceName <span>=</span> <span>if</span> <span>(</span>sauceChanges<span>.</span>sauceName <span>!=</span> <span>&#34;&#34;</span><span>)</span> sauceChanges<span>.</span>sauceName <span>else</span> originalSauce<span>.</span>sauceName<span>,</span>
                description <span>=</span> <span>if</span> <span>(</span>sauceChanges<span>.</span>description <span>!=</span> <span>&#34;&#34;</span><span>)</span> sauceChanges<span>.</span>description <span>else</span> originalSauce<span>.</span>description<span>,</span>
                url <span>=</span> <span>if</span> <span>(</span>sauceChanges<span>.</span>url <span>!=</span> <span>&#34;&#34;</span><span>)</span> sauceChanges<span>.</span>url <span>else</span> originalSauce<span>.</span>url<span>,</span>
                heat <span>=</span> <span>if</span> <span>(</span>sauceChanges<span>.</span>heat <span>!=</span> <span>0</span><span>)</span> sauceChanges<span>.</span>heat <span>else</span> originalSauce<span>.</span>heat
            <span>)</span>
            <span>return</span> <span>ResponseEntity</span><span>(</span>hotSauceRepository<span>.</span><span>save</span><span>(</span>updatedSauce<span>)</span><span>,</span> HttpStatus<span>.</span>OK<span>)</span>
        <span>}</span> <span>else</span> <span>{</span>
            <span>return</span> <span>ResponseEntity</span><span>(</span>HttpStatus<span>.</span>NOT_FOUND<span>)</span>
        <span>}</span>
    <span>}</span>

    <span>// DELETE api/hotsauces/{id}</span>
    <span>@DeleteMapping</span><span>(</span><span>&#34;/{id}&#34;</span><span>)</span>
    <span>fun</span> <span>deleteHotSauce</span><span>(</span><span>@PathVariable</span> id<span>:</span> Long<span>)</span><span>:</span> ResponseEntity<span>&lt;</span>HotSauce<span>?</span><span>&gt;</span> <span>{</span>
        <span>if</span> <span>(</span>hotSauceRepository<span>.</span><span>existsById</span><span>(</span>id<span>)</span><span>)</span> <span>{</span>
            hotSauceRepository<span>.</span><span>deleteById</span><span>(</span>id<span>)</span>
            <span>return</span> <span>ResponseEntity</span><span>(</span>HttpStatus<span>.</span>NO_CONTENT<span>)</span>
        <span>}</span> <span>else</span> <span>{</span>
            <span>return</span> <span>ResponseEntity</span><span>(</span>HttpStatus<span>.</span>NOT_FOUND<span>)</span>
        <span>}</span>
    <span>}</span>

<span>}</span></code></pre><p>The code is considerably less complex than it could be, thanks to some annotations which take care of a lot of tedious REST work:</p><ul><li><code>HotSauceController</code> is annotated with <code>@RestController</code>, which informs Spring Web (yet another one of the dependencies that you added in Spring Initializr) that this class is a REST controller and that it should include the necessary underlying REST functionality.</li><li><code>HotSauceController</code> is also annotated with <code>@<span>RequestMapping</span><span>(</span><span>&#34;/api/hotsauces&#34;</span><span>)</span></code> which means that every method in the class that responds to a request responds to requests whose endpoint ends with <code>api<span>/</span>hotsauces</code>.</li><li>Any method annotated with <code>@<span>GetMapping</span><span>(</span><span>)</span></code> responds to <code><span>GET</span></code> requests. If <code>@<span>GetMapping</span><span>(</span><span>)</span></code> takes a parameter, it means that it responds to requests whose endpoint begins with that parameter. Parameters in braces (<code><span>{</span></code> and <code><span>}</span></code>) are variable parameters.</li><li>Any method annotated with <code>@<span>PostMapping</span><span>(</span><span>)</span></code>, <code>@<span>PutMapping</span><span>(</span><span>)</span></code>, and <code>@<span>DeleteMapping</span><span>(</span><span>)</span></code> is similar to a method annotated with <code>@<span>GetMapping</span><span>(</span><span>)</span></code> except that they respond to <code><span>POST</span></code>, <code><span>PUT</span></code>, and <code><span>DELETE</span></code> requests respectively.</li></ul><p>Every method in the class returns a <a href="https://www.baeldung.com/spring-response-entity" target="_blank" rel="noreferrer noopener"><code>ResponseEntity</code></a> object, which represents a complete HTTP response, complete with status code, headers, and body.</p><p>Take a look at each of these methods to see what kind of <code>ResponseEntity</code> they return. Sometimes, they‚Äôll simply return an HTTP status code, as is the case with <code><span>deleteHotSauce</span><span>(</span><span>)</span></code>, which returns either <code><span>NO_CONTENT</span></code> if the hot sauce was found and deleted or <code><span>NOT_FOUND</span></code> if the hot sauce requested for deletion was not in the database. Other methods may return a more complex <code>ResponseEntity</code>, such as <code><span>getHotSauce</span><span>(</span><span>)</span></code>, which returns an <code><span>OK</span></code> status code and a <code>HotSauce</code> object if the given <code>id</code> matches a hot sauce in the database.</p><p>You may have noticed the <code>@RequestParam</code> annotations in the signature of the <code><span>getAll</span><span>(</span><span>)</span></code> method. These map the parameters in the HTTP GET query string to <code><span>getAll</span><span>(</span><span>)</span></code>‚Äôs parameters. The first annotation declares that value in <code>brandname</code> query parameter is mapped to the <code><span>getAll</span><span>(</span><span>)</span></code> method‚Äôs <code>brandNameFilter</code> parameter, that <code>brandname</code> is an optional query parameter, and if it isn‚Äôt used, its value should default to the empty string. The other <code>@RequestParam</code> annotations work in a similar manner.</p><h3 id="Initializing-the-database">Initializing the database</h3><p>You could run the app right now and it would work. There‚Äôs just one problem: Since the database is in-memory and unitialized, you don‚Äôt have any data to work with! Let‚Äôs add a class to preload the database with some initial hot sauces.</p><p>üå∂ Create a new file named <strong>DataLoader.kt</strong> in the <strong>/src/main/kotlin/com/auth0/hotsauces/</strong> directory:</p><pre><code><span>// /src/main/kotlin/com/auth0/hotsauces/DataLoader.kt</span>

<span>package</span> com<span>.</span>auth0<span>.</span>hotsauces

<span>import</span> org<span>.</span>springframework<span>.</span>stereotype<span>.</span>Component
<span>import</span> javax<span>.</span>annotation<span>.</span>PostConstruct

<span>@Component</span>
<span>class</span> <span>DataLoader</span><span>(</span><span>var</span> hotSauceRepository<span>:</span> HotSauceRepository<span>)</span> <span>{</span>

    <span>fun</span> String<span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span> <span>=</span> <span>this</span><span>.</span><span>trimIndent</span><span>(</span><span>)</span><span>.</span><span>replace</span><span>(</span><span>&#34;\n&#34;</span><span>,</span> <span>&#34; &#34;</span><span>)</span>

    <span>@PostConstruct</span>
    <span>fun</span> <span>loadData</span><span>(</span><span>)</span> <span>{</span>
        hotSauceRepository<span>.</span><span>saveAll</span><span>(</span><span>listOf</span><span>(</span>
            <span>HotSauce</span><span>(</span>
                brandName <span>=</span> <span>&#34;Truff&#34;</span><span>,</span>
                sauceName <span>=</span> <span>&#34;Hot Sauce&#34;</span><span>,</span>
                description <span>=</span> <span>&#34;&#34;&#34;
                    Our sauce is a curated blend of ripe chili peppers, organic agave nectar, black truffle, and
                    savory spices. This combination of ingredients delivers a flavor profile unprecedented to hot sauce.
                    &#34;&#34;&#34;</span><span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span><span>,</span>
                url <span>=</span> <span>&#34;https://truffhotsauce.com/collections/sauce/products/truff&#34;</span><span>,</span>
                heat <span>=</span> <span>2_500</span>
            <span>)</span><span>,</span>
            <span>HotSauce</span><span>(</span>
                brandName <span>=</span> <span>&#34;Truff&#34;</span><span>,</span>
                sauceName <span>=</span> <span>&#34;Hotter Sauce&#34;</span><span>,</span>
                description <span>=</span> <span>&#34;&#34;&#34;
                    TRUFF Hotter Sauce is a jalape√±o rich blend of red chili peppers, Black Truffle and Black Truffle
                    Oil, Organic Agave Nectar, Red Habanero Powder, Organic Cumin and Organic Coriander. Perfectly
                    balanced and loaded with our same iconic flavor, TRUFF Hotter Sauce offers a ‚Äúless sweet, more heat‚Äù
                    rendition of the Flagship original.
                    &#34;&#34;&#34;</span><span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span><span>,</span>
                url <span>=</span> <span>&#34;https://truffhotsauce.com/collections/sauce/products/hotter-truff-hot-sauce&#34;</span><span>,</span>
                heat <span>=</span> <span>4_000</span>
            <span>)</span><span>,</span>
            <span>HotSauce</span><span>(</span>
                brandName <span>=</span> <span>&#34;Cholula&#34;</span><span>,</span>
                sauceName <span>=</span> <span>&#34;Original&#34;</span><span>,</span>
                description <span>=</span> <span>&#34;&#34;&#34;
                    Cholula Original Hot Sauce is created from a generations old recipe that features carefully-selected
                    arbol and piquin peppers and a blend of signature spices. We love it on burgers and chicken but have
                    heard it‚Äôs amazing on pizza. Uncap Real Flavor with Cholula Original.
                    &#34;&#34;&#34;</span><span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span><span>,</span>
                url <span>=</span> <span>&#34;https://www.cholula.com/original.html&#34;</span><span>,</span>
                heat <span>=</span> <span>3_600</span>
            <span>)</span><span>,</span>
            <span>HotSauce</span><span>(</span>
                brandName <span>=</span> <span>&#34;Mad Dog&#34;</span><span>,</span>
                sauceName <span>=</span> <span>&#34;357&#34;</span><span>,</span>
                description <span>=</span> <span>&#34;&#34;&#34;
                   Finally, a super hot sauce that tastes like real chile peppers. This sauce is blended
                   with ingredients that create a sauce fit to take your breath away. About five seconds after you
                   taste the recommended dose of one drop, prepare your mouth and mind for five to 20 minutes of agony
                   that all true chileheads fully understand and appreciate.
                   &#34;&#34;&#34;</span><span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span><span>,</span>
                url <span>=</span> <span>&#34;https://www.saucemania.com.au/mad-dog-357-hot-sauce-148ml/&#34;</span><span>,</span>
                heat <span>=</span> <span>357_000</span>
            <span>)</span><span>,</span>
            <span>HotSauce</span><span>(</span>
                brandName <span>=</span> <span>&#34;Hot Ones&#34;</span><span>,</span>
                sauceName <span>=</span> <span>&#34;Fiery Chipotle&#34;</span><span>,</span>
                description <span>=</span> <span>&#34;&#34;&#34;
                    This hot sauce was created with one goal in mind: to get celebrity interviewees on Hot Ones to say
                    &#34;damn that&#39;s tasty, and DAMN that&#39;s HOT!&#34; and then spill their deepest secrets to host Sean Evans.
                    The tongue tingling flavors of chipotle, pineapple and lime please the palate while the mix of ghost
                    and habanero peppers make this sauce a scorcher. Hot Ones Fiery Chipotle Hot Sauce is a spicy
                    masterpiece.
                    &#34;&#34;&#34;</span><span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span><span>,</span>
                url <span>=</span> <span>&#34;https://chillychiles.com/products/hot-ones-fiery-chipotle-hot-sauce&#34;</span><span>,</span>
                heat <span>=</span> <span>15_600</span>
            <span>)</span><span>,</span>
            <span>HotSauce</span><span>(</span>
                brandName <span>=</span> <span>&#34;Hot Ones&#34;</span><span>,</span>
                sauceName <span>=</span> <span>&#34;The Last Dab&#34;</span><span>,</span>
                description <span>=</span> <span>&#34;&#34;&#34;
                    More than simple mouth burn, Pepper X singes your soul. Starting with a pleasant burn in the mouth,
                    the heat passes quickly, lulling you into a false confidence. You take another bite, enjoying the
                    mustard and spice flavours. This would be great on jerk chicken, or Indian food! But then, WHAM!
                    All of a sudden your skin goes cold and your stomach goes hot, and you realize the power of X.
                    &#34;&#34;&#34;</span><span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span><span>,</span>
                url <span>=</span> <span>&#34;https://www.saucemania.com.au/hot-ones-the-last-dab-hot-sauce-148ml/&#34;</span><span>,</span>
                heat <span>=</span> <span>1_000_000</span>
            <span>)</span><span>,</span>
            <span>HotSauce</span><span>(</span>
                brandName <span>=</span> <span>&#34;Torchbearer&#34;</span><span>,</span>
                sauceName <span>=</span> <span>&#34;Zombie Apocalypse&#34;</span><span>,</span>
                description <span>=</span> <span>&#34;&#34;&#34;
                    The Zombie Apocalypse Hot Sauce lives up to its name, combining Ghost Peppers and Habaneros with a
                    mix of spices, vegetables, and vinegar to create a slow burning blow torch. Some people will feel
                    the heat right away, but others can take a few minutes for the full impact to set in. The heat can
                    last up to 20 minutes, creating a perfect match between very high heat and amazing flavor. Try it
                    on all your favorite foods - wings, chili, soups, steak or even a sandwich in need of a major kick.
                    &#34;&#34;&#34;</span><span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span><span>,</span>
                url <span>=</span> <span>&#34;https://heatonist.com/products/zombie-apocalypse&#34;</span><span>,</span>
                heat <span>=</span> <span>100_000</span>
            <span>)</span><span>,</span>
            <span>HotSauce</span><span>(</span>
                brandName <span>=</span> <span>&#34;Heartbeat&#34;</span><span>,</span>
                sauceName <span>=</span> <span>&#34;Pineapple Habanero&#34;</span><span>,</span>
                description <span>=</span> <span>&#34;&#34;&#34;
                    Pineapple Habanero is Heartbeat Hot Sauce‚Äôs most recent offering and their spiciest to date! They‚Äôve
                    yet again collaborated with an Ontario craft brewery, this time from their home town of Thunder Bay.
                    Made with the help of Sleeping Giant Brewery‚Äôs award winning Beaver Duck session IPA, this sauce has
                    a boldly pronounced fruitiness and a bright but savoury vibe from start to finish.
                    &#34;&#34;&#34;</span><span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span><span>,</span>
                url <span>=</span> <span>&#34;https://www.saucemania.com.au/heartbeat-pineapple-habanero-hot-sauce-177ml/&#34;</span><span>,</span>
                heat <span>=</span> <span>12_200</span>
            <span>)</span><span>,</span>
            <span>HotSauce</span><span>(</span>
                brandName <span>=</span> <span>&#34;Karma Sauce&#34;</span><span>,</span>
                sauceName <span>=</span> <span>&#34;Burn After Eating&#34;</span><span>,</span>
                description <span>=</span> <span>&#34;&#34;&#34;
                    Karma Sauce Burn After Eating Hot Sauce is imbued with a unique flavour thanks to green mango,
                    ajwain and hing powder. Forged with a top-secret blend of super hots that may or may not include
                    Bhut Jolokia (Ghost), Scorpion, Carolina Reaper, 7-Pot Brown and 7-Pot Primo. This isn‚Äôt a sauce you
                    eat, it‚Äôs one you survive.
                    &#34;&#34;&#34;</span><span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span><span>,</span>
                url <span>=</span> <span>&#34;https://www.saucemania.com.au/karma-sauce-burn-after-eating-hot-sauce-148ml/&#34;</span><span>,</span>
                heat <span>=</span> <span>669_000</span>
            <span>)</span>
        <span>)</span><span>)</span>
    <span>}</span>

<span>}</span></code></pre><p>This class has a couple of annotations:</p><ul><li><code>DataLoader</code> is annotated with <code>@Component</code>, which marks it so that Spring will autodetect the class when it‚Äôs needed. Since the code in this class references the application‚Äôs instance of <code>HotSauceRepository</code>, this class will be instantiated when an instance of <code>HotSauceRepository</code> is created.</li><li>The <code><span>loadData</span><span>(</span><span>)</span></code> method is annotated with <code>@PostConstruct</code>, which specifies that it should be called as soon as the class has been initialized. This annotation is often used to populate databases when a Spring application is launched.</li></ul><h4 id="Kotlin-Extensions">Kotlin Extensions</h4><p>This class also makes use of a handy Kotlin feature: <strong><a href="https://kotlinlang.org/docs/reference/extensions.html" target="_blank" rel="noreferrer noopener">Extensions</a></strong>. These are properties or functions that can be added to classes to extend their capabilities without having to access their code.</p><p>At the beginning of the class, you added an extension to the <code>String</code> class:</p><pre><code><span>fun</span> String<span>.</span><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span> <span>=</span> <span>this</span><span>.</span><span>trimIndent</span><span>(</span><span>)</span><span>.</span><span>replace</span><span>(</span><span>&#34;\n&#34;</span><span>,</span> <span>&#34; &#34;</span><span>)</span></code></pre><p>This adds the method <code><span>trimIndentsAndRemoveNewlines</span><span>(</span><span>)</span></code> to the <code>String</code> class, which removes indentations and newline characters from multiline strings. The assignments to each hot sauce‚Äôs <code>description</code> property is done using multiline strings (which are delimited with triple-quotes ‚Äî <code><span>&#34;&#34;</span>&#34;</code>) to make the code easier to read.</p><h4 id="What-s-With-the-Numbers-">What‚Äôs With the Numbers?</h4><p>You may have noticed that some of the numbers in the code contain underscore characters, such as on this line of code for the final sauce in the list:</p><pre><code>heat <span>=</span> <span>669_000</span></code></pre><p>Kotlin ‚Äî like some other languages, including Python, Ruby, and Swift ‚Äî ignores undescore characters in numbers. This allows you to use them the way we typically use ‚Äúseparator characters‚Äù to make numbers easier to read.</p><p>For example, in the U.S., we tend to write the number for ‚Äúone million‚Äù as <strong>1,000,000</strong>, which is easier to read than 1000000. In India, the preference is to write this number as <strong>10,00,000</strong>, and in some countries in Europe, it‚Äôs <strong>1.000.000</strong>. By allowing the underscore as the grouping character for numbers and ignoring it, Kotlin lets you group digits in numbers as you see fit.</p><h2 id="Trying-Out-the-API">Trying Out the API</h2><p>You‚Äôre now ready to take the API for a trial run!</p><p>üå∂ Run the application by opening a terminal if you‚Äôre on macOS of Linux or opening PowerShell if you‚Äôre on Windows), navigating to the the application‚Äôs directory, and entering the following command:</p><pre><code>./gradlew bootRun</code></pre><p>This command was included in the set of files that Spring Initilizr generated. It sets Gradle in motion, causing it to download any needed plugins and dependencies, after which it launches the application.</p><p>When it starts, you‚Äôll see a lot of status messages. Eventually, they‚Äôll end with this:</p><pre><code><span>&gt;</span> :bootRun</code></pre><p>If you don‚Äôt see an error message and the last line of the output is <code><span>&gt;</span> <span>:</span>bootRun</code>, it means that the project is running properly and listening to <strong>localhost:8080</strong> for incoming requests. You can now start making API calls.</p><h3 id="Is-this-thing-on-">Is this thing on?</h3><p>One of the dependencies that you included when setting up this project with Spring Initializr was Spring Boot Actuator. This automatically adds a number of endpoints to your application that let you monitor and interact with it.</p><p>Let‚Äôs use Actuator‚Äôs <code>health</code> endpoint to get client-side confirmation that your application is up and running.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this into Terminal:</p><pre><code><span>curl</span> <span>&#34;http://localhost:8080/actuator/health&#34;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this into PowerShell:</p><pre><code>Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/actuator/health&#34;</span></code></pre><p>macOS and Linux users should see this response...</p><pre><code><span>{</span><span>&#34;status&#34;</span><span>:</span><span>&#34;UP&#34;</span><span>}</span></code></pre><p>...while Windows users should see this:</p><pre><code>status
<span>--</span><span>--</span><span>--</span>
<span>UP</span></code></pre><p>The <code>health</code> endpoint is just one of of over 20 endpoints that a Spring Boot application provides when it includes the Actuator dependency. It‚Äôs indispensable for managing and monitoring apps during both development and production, as it provides logging, metrics, auditing, HTTP tracing, and process monitoring features, <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html" target="_blank" rel="noreferrer noopener">all of which are covered in the Spring documentation.</a></p><h3 id="Count-hot-sauces">Count hot sauces</h3><p>To get the number of hot sauces in the database, send a GET request to the <code><span>/</span>api<span>/</span>hotsauces<span>/</span>count</code> endpoint.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this into Terminal:</p><pre><code><span>curl</span> <span>&#34;http://localhost:8080/api/hotsauces/count&#34;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this into PowerShell:</p><pre><code>Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces/count&#34;</span></code></pre><p>If you haven‚Äôt added or removed any hot sauces since starting the application, the API should report that there are 9.</p><h3 id="List-hot-sauces">List hot sauces</h3><p>To get the complete list of hot sauces, send a GET request to the <code><span>/</span>api<span>/</span>hotsauces</code> endpoint.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this into Terminal:</p><pre><code><span>curl</span> <span>&#34;http://localhost:8080/api/hotsauces&#34;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this into PowerShell:</p><pre><code>Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces&#34;</span></code></pre><p>macOS and Linux users will be presented with a JSON array of dictionaries, with each dictionary representing a hot sauce. Windows users will see a nicely formatted list of hot sauces and their properties.</p><h3 id="Filtering-hot-sauces-with-parameters">Filtering hot sauces with parameters</h3><p>Try using the optional parameters to limit the results. In the example below, the <code>maxheat</code> parameter is being used to limit the response to only those hot sauces with a Scoville rating of 10,000 or less.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this into Terminal:</p><pre><code><span>curl</span> <span>&#34;http://localhost:8080/api/hotsauces?maxheat=10000&#34;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this into PowerShell:</p><pre><code>Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces?maxheat=10000&#34;</span></code></pre><p>If you haven‚Äôt added or removed any hot sauces since starting the application, the API should return three hot sauces: Truff Hot Sauce, Truff Hotter Sauce, and Cholula.</p><h3 id="Add-a-new-hot-sauce">Add a new hot sauce</h3><p>Add a new sauce to the database by sending a POST request to <code><span>/</span>api<span>/</span>hotsauces<span>/</span></code>, along with the attributes of the new sauce ‚Äî except <code>id</code>, which will automatically be assigned to the new sauce. The attributes should be in JSON dictionary form.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this command into the terminal:</p><pre><code><span>curl</span> --request POST <span>\</span>
    --url http://localhost:8080/api/hotsauces/ <span>\</span>
    -H <span>&#34;Content-Type: application/json&#34;</span> <span>\</span>
    --data <span>&#39;{&#34;brandName&#34;: &#34;Dave‚Äôs Gourmet&#34;, &#34;sauceName&#34;: &#34;Temporary Insanity&#34;, &#34;url&#34;: &#34;https://store.davesgourmet.com/ProductDetails.asp?ProductCode=DATE&#34;, &#34;description&#34;: &#34;This sauce has all the flavor of Dave‚Äôs Original Insanity with less heat. Finally, there‚Äôs sauce for when you only want to get a little crazy in the kitchen. Add to stews, burgers, burritos, and pizza, or any food that needs an insane boost. As with all super hot sauces, this sauce is best enjoyed one drop at a time!&#34;, &#34;heat&#34;: 57000}&#39;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this command into PowerShell:</p><pre><code>$body <span>=</span> @<span>{</span>
    brandName <span>=</span> <span>&#34;Dave\&#39;s Gourmet&#34;</span>
    sauceName <span>=</span> <span>&#34;Temporary Insanity&#34;</span>
    url <span>=</span> <span>&#34;https://store.davesgourmet.com/ProductDetails.asp?ProductCode=DATE&#34;</span>
    description <span>=</span> <span>&#34;This sauce has all the flavor of Dave\&#39;s Original Insanity with less heat. Finally, there&#39;s sauce for when you only want to get a little crazy in the kitchen. Add to stews, burgers, burritos, and pizza, or any food that needs an insane boost. As with all super hot sauces, this sauce is best enjoyed one drop at a time!&#34;</span>
    heat <span>=</span> <span>57000</span>
<span>}</span> <span>|</span> ConvertTo<span>-</span>Json
Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces/&#34;</span> <span><span>`</span><span>
    -Method POST </span><span>`</span></span>
    <span>-</span>ContentType <span>&#34;application/json&#34;</span> `
    <span>-</span>Body $body</code></pre><p>The hot sauce will be added to the database, and the API will respond with information about the newly added sauce.</p><p>You can confirm that the hot sauce has been added to the database by requesting the complete list, or by requesting it by id.</p><h3 id="Edit-a-hot-sauce">Edit a hot sauce</h3><p>Make changes to a hot sauce in the database by sending a PUT request to <code><span>/</span>api<span>/</span>hotsauces<span>/</span><span>{</span>id<span>}</span></code> where <code><span>{</span>id<span>}</span></code> is the hot sauce‚Äôs <code>id</code> value, along with the attributes you wish to change in JSON dictionary form.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this command into the terminal:</p><pre><code><span>curl</span> --request PUT <span>\</span>
    --url http://localhost:8080/api/hotsauces/10 <span>\</span>
    -H <span>&#34;Content-Type: application/json&#34;</span> <span>\</span>
    --data <span>&#39;{&#34;brandName&#34;: &#34;NewCo&#34;, &#34;sauceName&#34;: &#34;Generic Hot Sauce&#34;, &#34;description&#34;: &#34;It‚Äôs hot. It‚Äôs sauce. That‚Äôs it.&#34;, &#34;heat&#34;: 1000}&#39;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this command into PowerShell:</p><pre><code>$body <span>=</span> @<span>{</span>
    brandName <span>=</span> <span>&#34;NewCo&#34;</span>
    sauceName <span>=</span> <span>&#34;Generic Hot Sauce&#34;</span>
    url <span>=</span> <span>&#34;https://store.davesgourmet.com/ProductDetails.asp?ProductCode=DATE&#34;</span>
    description <span>=</span> <span>&#34;It&#39;s hot. It&#39;s sauce. That&#39;s it.&#34;</span>
    heat <span>=</span> <span>1000</span>
<span>}</span> <span>|</span> ConvertTo<span>-</span>Json
Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces/10&#34;</span> <span><span>`</span><span>
    -Method PUT </span><span>`</span></span>
    <span>-</span>ContentType <span>&#34;application/json&#34;</span> `
    <span>-</span>Body $body</code></pre><p>The hot sauce will be updated with your changes and the API will respond with information showing the changes you made.</p><h3 id="Delete-a-hot-sauce">Delete a hot sauce</h3><p>Delete a hot sauce by sending a DELETE request to <code><span>/</span>api<span>/</span>hotsauces<span>/</span><span>{</span>id<span>}</span></code> where <code><span>{</span>id<span>}</span></code> is the hot sauce‚Äôs <code>id</code> value.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this command into Terminal:</p><pre><code><span>curl</span> --request DELETE <span>\</span>
    --url http://localhost:8080/api/hotsauces/10</code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this command into PowerShell:</p><pre><code>Invoke-RestMethod <span>&#34;http://localhost:8080/api/hotsauces/10&#34;</span> `
    -Method DELETE</code></pre><p>You can confirm that the hot sauce has been removed from the database by requesting the complete list (using <code>curl http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>api<span>/</span>hotsauces<span>/</span></code>) or a count of hot sauces (using <code>curl http<span>:</span><span>/</span><span>/</span>localhost<span>:</span><span>8080</span><span>/</span>api<span>/</span>hotsauces<span>/</span>count</code>).</p><h2 id="Securing-the-API">Securing the API</h2><p>Right now, the entire API is unsecured. All its endpoints are available to anyone with the URL and the ability to send HTTP requests.</p><p>Suppose that we want to allow only authorized applications to have access to the endpoints of the API that allow accessing, adding, editing, and deleting hot sauces. The remaining endpoints ‚Äî the test endpoint and the one that reports the number of hot sauces ‚Äî can remain generally available.</p><p>You‚Äôll use Auth0 to secure the API‚Äôs CRUD endpoints, but before that happens, let‚Äôs take a look at how API authentication works.</p><h3 id="The-Nightclub-Metaphor">The Nightclub Metaphor</h3><p>There‚Äôs no shortage of essays and articles on the internet that try to explain API authentication. Let‚Äôs make it a little more fun and easier to grasp way by using The Nightclub Metaphor!</p><p>A number of nightclubs have a two-step process to control who gets in and who doesn‚Äôt. First, there‚Äôs an initial phase where the club-goer goes to a window and shows some ID...</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6oCWbsxHYlaAJXpelHJOS1/6d7fd315a5bb60f932be7c765f198106/mclovin_drivers_license.png" alt="A fake ID"/></p><p>...and if the ID passes inspection, the club-goer is given something that‚Äôs easy to see in a nightclub environment. Often, it‚Äôs a wristband:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3antgKjLDw9hqJ93J97thU/7199be675a2da2164ab71fc4532831ad/wristbands.png" alt="Club wristbands"/></p><p>The wristband is visible permission ‚Äî an <em>access token</em> ‚Äî that the club-goer wearing it has been cleared to enter the club. In order to be let into the club, the club-goer has to show their wristband to the bouncers guarding the entrance.</p><p>The better-run nightclubs change their wristbands every night. One night, it‚Äôll be blue, and on the next night, it‚Äôll be a different color. This prevents club-goers from reusing the previous night‚Äôs wristband to get in.</p><p>API security with Auth0 works in a similar way:</p><ul><li><strong>Showing ID at the window:</strong> You first assemble a set of credentials, which you submit to Auth0‚Äôs servers to obtain an access token.</li><li><strong>Showing your wristband to the bouncers:</strong> When accessing an API endpoint that requires authorization, you include the access token as part of your request. The API communicates with Auth0 to validate the access token, and if it‚Äôs valid, provides the response to your request.</li><li><strong>Changing wristbands every night:</strong> Like the wristbands at the better-run nightclubs, access tokens aren‚Äôt valid forever. By default, Auth0 access tokens expire 24 hours after they‚Äôre issued.</li></ul><p>It‚Äôs time to secure the API. This needs to be done both on the Auth0 side as well as in the application.</p><h2 id="Setting-Up-API-Authentication-on-the-Auth0-Side">Setting Up API Authentication on the Auth0 Side</h2><h3 id="Registering-the-API">Registering the API</h3><p>The first step in setting up API authentication is to register it.</p><p>üå∂ Log into Auth0.</p><blockquote><p>If you don‚Äôt have an Auth0 account yet, go ahead and <a href="https://auth0.com/signup" target="_blank" rel="noreferrer noopener">sign up for a free one.</a> You‚Äôll find it useful for prototyping logins and API security in your projects.</p></blockquote><p>üå∂ Once you‚Äôve logged in, <a href="https://manage.auth0.com/?&amp;_ga=2.55268258.821728906.1599742219-782382229.1597890849#/apis" target="_blank" rel="noreferrer noopener">navigate to the <em>APIs</em> page</a>...</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/48uwB1BEZbrHDz9zzeRWxO/4add50dd5a0b7317b991fd3fe1a413da/apis.png" alt="Auth0 dashboard APIs page"/></p><p>üå∂ ...and click the <strong>Create API</strong> button located near the upper right corner of the page. A form will appear, asking for basic information about the API:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4XmypcreWQ9C4HGTmKHkul/6dfbe34de3f0fd09464f3ae89440f533/new-api.png" alt="New API pop-up form"/></p><p>üå∂ Fill it out like so:</p><ul><li><em>Name:</em> Enter <strong>HotSauces</strong>.</li><li><em>Identifier:</em> Enter <strong><a href="http://hotsauces.demo" target="_blank" rel="noreferrer noopener">http://hotsauces.demo</a></strong>.</li><li><em>Signing Algorithm:</em> Select <strong>RS256</strong>.</li></ul><p>üå∂ When you‚Äôre done providing this information, click the <strong>Create</strong> button. The API will now be registered, which means that Auth0 can now be used to authorize access to it.</p><h3 id="Getting-the-Credentials">Getting the Credentials</h3><p>The next step is to gather the necessary Auth0 credentials that will be needed to request an access token from Auth0 and to validate any access tokens.</p><p>Immediately after registering your API, you were taken to the API‚Äôs newly-created <strong>Quick Start</strong> page, pictured below:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6Wr7wbTVoKREeDqP2PPccC/6e06c065b4bd2edbfb203cebf64ce3d3/hotsauces-quick-start-page.png" alt="Auth0 Quick Start page for the API"/></p><p>This is technically a machine-to-machine application, which means that the API you created (a machine) wouldn‚Äôt normally be accessed directly by a human, but by an application (another machine). You‚Äôll need to gather the credentials from the Machine to Machine Applications section.</p><p>üå∂ Click on <strong>Machine to Machine Applications</strong>, which will take you to this page:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6I4WwRBhedzzWiKaZL9Mry/b78eb788f07e9e3cf94a603fb45de80b/machine-to-machine.png" alt="Auth0 Settings page"/></p><p>This is the first of two pages that provide information that you need in order to get the access token.</p><p>üå∂ You‚Äôll be copying four items, and you may find it helpful to open a text editor so that you have some place in which to paste them.</p><p>üå∂ Copy the <em>API Identifier</em> value, which is located just below the page‚Äôs headline...</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5dyz7Uq4McFi1wk8hiLdMI/7131755fbdc21bf2797f98d7b1c78d4f/machine-to-machine_identifier.png" alt="Identifier"/></p><p>üå∂ ...and paste it into the text editor.</p><p>Your text editor should look something like this:</p><pre><code>API Identifier: <span>{</span>API Identifier<span>}</span></code></pre><p>If you‚Äôve been following the steps in this exercise, {API Identifier} will be <strong><a href="http://hotsauces.demo" target="_blank" rel="noreferrer noopener">http://hotsauces.demo</a></strong>.</p><p>There will be a list of applications at the bottom of the page. One of them will be <strong>HotSauces</strong>. Click on its name. You‚Äôll be taken to HotSauces‚Äô <strong>Machine to Machine ‚Üí Settings</strong> page, which contains information that you‚Äôll need to get the token:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/41YnIqmEdUcsVSYSNtCqmO/82596c6774a38590976f59ff61c538db/machine-to-machine_settings.png" alt="Auth0 Machine to Machine page"/></p><p>üå∂ Use the ‚Äúcopy‚Äù buttons on the right side of these fields to copy and paste their contents into the same text editor where you pasted the API Identifier:</p><ul><li>Domain</li><li>Client ID</li><li>Client Secret</li></ul><p>Your text editor should now look something like this:</p><pre><code>API Identifier: <span>{</span>API Identifier<span>}</span>
Domain: <span>{</span>Domain<span>}</span>
Client ID: <span>{</span>Client ID<span>}</span>
Client Secret: <span>{</span>Client Secret<span>}</span></code></pre><p>You‚Äôve done all the necessary setup on the Auth0 side. It‚Äôs now time to do the same on the application side.</p><h2 id="Setting-Up-API-Authentication-on-the-Application-Side">Setting Up API Authentication on the Application Side</h2><h3 id="Adding-Security-Dependencies">Adding Security Dependencies</h3><p>The first step is to add the necessary security dependencies to the Gradle build file.</p><p>üå∂ Update the <code>dependencies</code> block in <strong>/build.gradle.kts</strong> so that it looks like this:</p><pre><code><span>// /build.gradle.kts (excerpt)</span>

dependencies <span>{</span>
    <span>implementation</span><span>(</span><span>&#34;org.springframework.boot:spring-boot-starter-actuator&#34;</span><span>)</span>
    <span>implementation</span><span>(</span><span>&#34;org.springframework.boot:spring-boot-starter-data-jpa&#34;</span><span>)</span>
    <span>implementation</span><span>(</span><span>&#34;org.springframework.boot:spring-boot-starter-web&#34;</span><span>)</span>
    <span>implementation</span><span>(</span><span>&#34;com.fasterxml.jackson.module:jackson-module-kotlin&#34;</span><span>)</span>
    <span>implementation</span><span>(</span><span>&#34;org.jetbrains.kotlin:kotlin-reflect&#34;</span><span>)</span>
    <span>implementation</span><span>(</span><span>&#34;org.jetbrains.kotlin:kotlin-stdlib-jdk8&#34;</span><span>)</span>
    <span>developmentOnly</span><span>(</span><span>&#34;org.springframework.boot:spring-boot-devtools&#34;</span><span>)</span>
    <span>runtimeOnly</span><span>(</span><span>&#34;com.h2database:h2&#34;</span><span>)</span>
    <span>testImplementation</span><span>(</span><span>&#34;org.springframework.boot:spring-boot-starter-test&#34;</span><span>)</span>

    <span>implementation</span><span>(</span><span>&#34;org.springframework.boot:spring-boot-starter-security&#34;</span><span>)</span>
    <span>implementation</span><span>(</span><span>&#34;org.springframework.security:spring-security-oauth2-resource-server&#34;</span><span>)</span>
    <span>implementation</span><span>(</span><span>&#34;org.springframework.security:spring-security-oauth2-jose&#34;</span><span>)</span>
    <span>implementation</span><span>(</span><span>&#34;org.springframework.security:spring-security-config&#34;</span><span>)</span>
<span>}</span></code></pre><p>This adds four dependencies. Note that they all have ‚Äúsecurity‚Äù in their name and that two of them also include ‚Äúoauth2‚Äù, a reference to the OAuth2 protocol that Auth0 uses for authorization.</p><p>The first time you run the application after adding these lines to the Gradle build file, Gradle will download and install these dependencies.</p><h3 id="Adding-a-Configuration-File">Adding a Configuration File</h3><p>The next step is to create a file that configures the application to use the correct API identifier and domain when authenticating with Auth0.</p><p>üå∂ Create a new file named <strong>application.yml</strong> in the <strong>/src/main/resources/</strong> directory. It should contain the following:</p><pre><code><span># /src/main/resources/application.yml</span>

<span>auth0</span><span>:</span>
  <span>audience</span><span>:</span> <span>{</span> Domain <span>}</span>
<span>spring</span><span>:</span>
  <span>security</span><span>:</span>
    <span>oauth2</span><span>:</span>
      <span>resourceserver</span><span>:</span>
        <span>jwt</span><span>:</span>
          <span>issuer-uri</span><span>:</span> https<span>:</span>//<span>{</span>API Identifier<span>}</span>/</code></pre><blockquote><p>Indentation is important in this file: Don‚Äôt remove any indents, and use space characters to make the indents. <strong>Do NOT use tab characters!</strong></p></blockquote><p>üå∂ In the file shown above, replace <code><span>{</span><span>API</span> Identifier<span>}</span></code> and <code><span>{</span>Domain<span>}</span></code> with the values that you copied into your text editor. If you‚Äôve been following the steps in this exercise, <code><span>{</span><span>API</span> Identifier<span>}</span></code> will be <strong><a href="http://hotsauces.demo" target="_blank" rel="noreferrer noopener">http://hotsauces.demo</a></strong>.</p><p>The <code><span>{</span><span>API</span> Identifier<span>}</span></code> value will be used to tell Auth0 which API is asking for authentication, and the <code><span>{</span>Domain<span>}</span></code> value allows Spring‚Äôs security to get the authorization server‚Äôs public keys and validate the access token.</p><h3 id="Adding-Security-Classes">Adding Security Classes</h3><p>The final step in securing the API is adding a couple of security classes. These classes enable the application to make use of Auth0‚Äôs OAuth2 authorization.</p><p>Since these classes don‚Äôt directly have anything to do with the application‚Äôs main functionality, they‚Äôre often put into their own directory.</p><p>üå∂ Create a new directory, <strong>security</strong>, as a subdirectory of <strong>/src/main/kotlin/com/auth0/hotsauces/</strong>. The project‚Äôs directory structure should now look like this:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/OmSevxxVhzfafimLdeArh/c3228767798e5f33e0866f34011d8c63/hotsauces-project-structure-2.png" alt="Project structure, pointing out the security folder and application.yml"/></p><p>The first security class that you‚Äôll add is an audience validator. It confirms that the access token is actually the one for the API.</p><p>üå∂ Create a new file named <strong>AudienceValidator.kt</strong> in the <strong>/src/main/kotlin/com/auth0/hotsauces/security/</strong> directory:</p><pre><code><span>// /src/main/kotlin/com/auth0/hotsauces/security/AudienceValidator.kt</span>

<span>package</span> com<span>.</span>auth0<span>.</span>hotsauces<span>.</span>security

<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>core<span>.</span>OAuth2Error
<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>core<span>.</span>OAuth2TokenValidator
<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>core<span>.</span>OAuth2TokenValidatorResult
<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>jwt<span>.</span>Jwt

<span>class</span> <span>AudienceValidator</span><span>(</span><span>private</span> <span>val</span> audience<span>:</span> String<span>)</span> <span>:</span> OAuth2TokenValidator<span>&lt;</span>Jwt<span>&gt;</span> <span>{</span>

    <span>override</span> <span>fun</span> <span>validate</span><span>(</span>jwt<span>:</span> Jwt<span>)</span><span>:</span> OAuth2TokenValidatorResult <span>{</span>
        <span>val</span> error <span>=</span> <span>OAuth2Error</span><span>(</span><span>&#34;invalid_token&#34;</span><span>,</span> <span>&#34;The required audience is missing&#34;</span><span>,</span> <span>null</span><span>)</span>
        <span>return</span> <span>if</span> <span>(</span>jwt<span>.</span>audience<span>.</span><span>contains</span><span>(</span>audience<span>)</span><span>)</span> <span>{</span>
            OAuth2TokenValidatorResult<span>.</span><span>success</span><span>(</span><span>)</span>
        <span>}</span> <span>else</span> OAuth2TokenValidatorResult<span>.</span><span>failure</span><span>(</span>error<span>)</span>
    <span>}</span>

<span>}</span></code></pre><p>The second security class configures API security in two ways:</p><ul><li>It validates the access token, and</li><li>It specifies the levels of access you grant to the API endpoints.</li></ul><p>üå∂ Create a new file named <strong>SecurityConfig.kt</strong> in the <strong>/src/main/kotlin/com/auth0/hotsauces/security/</strong> directory:</p><pre><code><span>// /src/main/kotlin/com/auth0/hotsauces/security/SecurityConfig.kt</span>

<span>package</span> com<span>.</span>auth0<span>.</span>hotsauces<span>.</span>security

<span>import</span> org<span>.</span>springframework<span>.</span>beans<span>.</span>factory<span>.</span>annotation<span>.</span>Value
<span>import</span> org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span>Bean
<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>config<span>.</span>annotation<span>.</span>web<span>.</span>builders<span>.</span>HttpSecurity
<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>config<span>.</span>annotation<span>.</span>web<span>.</span>configuration<span>.</span>EnableWebSecurity
<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>config<span>.</span>annotation<span>.</span>web<span>.</span>configuration<span>.</span>WebSecurityConfigurerAdapter
<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>core<span>.</span>DelegatingOAuth2TokenValidator
<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>core<span>.</span>OAuth2TokenValidator
<span>import</span> org<span>.</span>springframework<span>.</span>security<span>.</span>oauth2<span>.</span>jwt<span>.</span><span>*</span>

<span>@EnableWebSecurity</span>
<span>class</span> SecurityConfig <span>:</span> <span>WebSecurityConfigurerAdapter</span><span>(</span><span>)</span> <span>{</span>

    <span>@Value</span><span>(</span><span>&#34;\<span><span>${</span>auth0<span>.</span>audience<span>}</span></span>&#34;</span><span>)</span>
    <span>private</span> <span>val</span> audience<span>:</span> String <span>=</span> <span>String</span><span>(</span><span>)</span>

    <span>@Value</span><span>(</span><span>&#34;\<span><span>${</span>spring<span>.</span>security<span>.</span>oauth2<span>.</span>resourceserver<span>.</span>jwt<span>.</span>issuer<span>-</span>uri<span>}</span></span>&#34;</span><span>)</span>
    <span>private</span> <span>val</span> issuer<span>:</span> String <span>=</span> <span>String</span><span>(</span><span>)</span>

    <span>@Bean</span>
    <span>fun</span> <span>jwtDecoder</span><span>(</span><span>)</span><span>:</span> JwtDecoder <span>{</span>
        <span>val</span> jwtDecoder <span>=</span> JwtDecoders<span>.</span><span>fromOidcIssuerLocation</span><span>(</span>issuer<span>)</span> <span>as</span> NimbusJwtDecoder
        <span>val</span> audienceValidator<span>:</span> OAuth2TokenValidator<span>&lt;</span>Jwt<span>&gt;</span> <span>=</span> <span>AudienceValidator</span><span>(</span>audience<span>)</span>
        <span>val</span> withIssuer<span>:</span> OAuth2TokenValidator<span>&lt;</span>Jwt<span>&gt;</span> <span>=</span> JwtValidators<span>.</span><span>createDefaultWithIssuer</span><span>(</span>issuer<span>)</span>
        <span>val</span> withAudience<span>:</span> OAuth2TokenValidator<span>&lt;</span>Jwt<span>&gt;</span> <span>=</span> <span>DelegatingOAuth2TokenValidator</span><span>(</span>withIssuer<span>,</span> audienceValidator<span>)</span>
        jwtDecoder<span>.</span><span>setJwtValidator</span><span>(</span>withAudience<span>)</span>
        <span>return</span> jwtDecoder
    <span>}</span>

    <span>@Throws</span><span>(</span>Exception<span>::</span><span>class</span><span>)</span>
    <span>override</span> <span>fun</span> <span>configure</span><span>(</span>http<span>:</span> HttpSecurity<span>)</span> <span>{</span>
        http<span>.</span><span>authorizeRequests</span><span>(</span><span>)</span>
            <span>.</span><span>mvcMatchers</span><span>(</span><span>&#34;/api/hotsauces/count&#34;</span><span>)</span><span>.</span><span>permitAll</span><span>(</span><span>)</span>
            <span>.</span><span>mvcMatchers</span><span>(</span><span>&#34;/api/hotsauces&#34;</span><span>)</span><span>.</span><span>authenticated</span><span>(</span><span>)</span>
            <span>.</span><span>mvcMatchers</span><span>(</span><span>&#34;/api/hotsauces/*&#34;</span><span>)</span><span>.</span><span>authenticated</span><span>(</span><span>)</span>
            <span>.</span><span>and</span><span>(</span><span>)</span>
            <span>.</span><span>oauth2ResourceServer</span><span>(</span><span>)</span><span>.</span><span>jwt</span><span>(</span><span>)</span>
    <span>}</span>

<span>}</span></code></pre><p>Take a closer look at the <code><span>configure</span><span>(</span><span>)</span></code> method you just entered:</p><pre><code><span>@Throws</span><span>(</span>Exception<span>::</span><span>class</span><span>)</span>
<span>override</span> <span>fun</span> <span>configure</span><span>(</span>http<span>:</span> HttpSecurity<span>)</span> <span>{</span>
    http<span>.</span><span>authorizeRequests</span><span>(</span><span>)</span>
        <span>.</span><span>mvcMatchers</span><span>(</span><span>&#34;/api/hotsauces/count&#34;</span><span>)</span><span>.</span><span>permitAll</span><span>(</span><span>)</span>
        <span>.</span><span>mvcMatchers</span><span>(</span><span>&#34;/api/hotsauces&#34;</span><span>)</span><span>.</span><span>authenticated</span><span>(</span><span>)</span>
        <span>.</span><span>mvcMatchers</span><span>(</span><span>&#34;/api/hotsauces/*&#34;</span><span>)</span><span>.</span><span>authenticated</span><span>(</span><span>)</span>
        <span>.</span><span>and</span><span>(</span><span>)</span>
        <span>.</span><span>oauth2ResourceServer</span><span>(</span><span>)</span><span>.</span><span>jwt</span><span>(</span><span>)</span>
<span>}</span></code></pre><p>These lines specify that the <code><span>/</span>api<span>/</span>hotsauces<span>/</span>count</code> endpoints will be accessible to everyone...</p><pre><code><span>.</span><span>mvcMatchers</span><span>(</span><span>&#34;/api/hotsauces/count&#34;</span><span>)</span><span>.</span><span>permitAll</span><span>(</span><span>)</span></code></pre><p>...while these specify that the <code><span>/</span>api<span>/</span>hotsauces</code> endpoint and any other endpoint beginning with <code><span>/</span>api<span>/</span>hotsauces<span>/</span></code> require authentication.</p><pre><code><span>.</span><span>mvcMatchers</span><span>(</span><span>&#34;/api/hotsauces&#34;</span><span>)</span><span>.</span><span>authenticated</span><span>(</span><span>)</span>
<span>.</span><span>mvcMatchers</span><span>(</span><span>&#34;/api/hotsauces/*&#34;</span><span>)</span><span>.</span><span>authenticated</span><span>(</span><span>)</span></code></pre><p>In other words, any request to these endpoints must include a valid access token in order to work. Otherwise, those requests will get an HTTP 401 ‚Äî Unauthorized ‚Äî response.</p><p>Here‚Äôs what the project‚Äôs final directory structure looks like:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4LJ2qRCHiTke0NprOsST7J/084c4abc7157d44c317b50158de1fef6/hotsauces-project-structure-3.png" alt="Project file structure, showing the newly-added AudienceValidator and SecurityConfig files"/></p><h2 id="Trying-Out-the-Secured-API">Trying Out the Secured API</h2><p>Now that you‚Äôve secured the API, it‚Äôs time to try it out!</p><h3 id="Acquiring-an-access-token">Acquiring an access token</h3><p>You now have the necessary pieces of information needed to request a token. You‚Äôll request the token by sending a POST request containing the information.</p><p>You might find it easier to assemble the POST request in the same text editor where you pasted the information.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> start with this cURL command, replacing the <code><span>{</span>Domain<span>}</span></code>, <code><span>{</span>Client <span>ID</span><span>}</span></code>, <code><span>{</span>Client Secret<span>}</span></code>, and <code><span>{</span><span>API</span> Identifier<span>}</span></code> with the corresponding values you copied.</p><pre><code><span>curl</span> --request POST <span>\</span>
    --url https://<span>{</span>Domain<span>}</span>/oauth/token <span>\</span>
    --header <span>&#39;content-type: application/json&#39;</span> <span>\</span>
    --data <span>&#39;{
        &#34;client_id&#34;: &#34;{Client ID}&#34;,
        &#34;client_secret&#34;: &#34;{Client Secret}&#34;,
        &#34;audience&#34;: &#34;{API Identifier}&#34;,
        &#34;grant_type&#34;: &#34;client_credentials&#34;
    }&#39;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> use this command instead. As with the macOS/Linux version, replace the <code><span>{</span>Domain<span>}</span></code>, <code><span>{</span>Client <span>ID</span><span>}</span></code>, <code><span>{</span>Client Secret<span>}</span></code>, and <code><span>{</span><span>API</span> Identifier<span>}</span></code> with the corresponding values you copied.</p><pre><code><span>$Body</span> <span>=</span> @<span>{</span>
    <span>&#34;client_id&#34;</span> <span>=</span> <span>&#34;{Client ID}&#34;</span>
    <span>&#34;client_secret&#34;</span> <span>=</span> <span>&#34;{Client Secret}&#34;</span>
    <span>&#34;audience&#34;</span> <span>=</span> <span>&#34;{API Identifier}&#34;</span>
    <span>&#34;grant_type&#34;</span> <span>=</span> <span>&#34;client_credentials&#34;</span>
<span>}</span>
<span>$response</span> <span>=</span> Invoke-RestMethod <span>&#34;https://{Domain}/oauth/token&#34;</span> <span><span>`</span>
    -Method POST <span>`</span></span>
    -Body <span>$Body</span>
<span>$response</span> <span>|</span> ConvertTo-Json</code></pre><p>In response, you should receive a JSON dictionary that looks like this:</p><pre><code><span>{</span>
  <span>&#34;access_token&#34;</span><span>:</span> <span>&#34;{Access Token (a 720-character string)}&#34;</span><span>,</span>
  <span>&#34;expires_in&#34;</span><span>:</span> <span>86400</span><span>,</span>
  <span>&#34;token_type&#34;</span><span>:</span> <span>&#34;Bearer&#34;</span>
<span>}</span></code></pre><p>Note that one of the dictionary keys is <code>expires_in</code>, which specifies that the token will expire in 86,400 seconds, or in more convenient units, 24 hours. After that time has elapsed, the token will be invalid and you‚Äôll have to request a new one following the same steps above.</p><p>Copy the <code><span>{</span>Access token<span>}</span></code> value and paste it into the text editor with the other values.</p><p>Your text editor should now look something like this:</p><pre><code>API Identifier: <span>{</span>API Identifier<span>}</span>
Domain: <span>{</span>Domain<span>}</span>
Client ID: <span>{</span>Client ID<span>}</span>
Client Secret: <span>{</span>Client Secret<span>}</span>

Access Token: <span>{</span>Access Token<span>}</span></code></pre><h3 id="Trying-the-Public-Endpoints">Trying the Public Endpoints</h3><p>üå∂ Open a terminal or PowerShell window, navigate to the project directory, and enter <code><span>.</span><span>/</span>gradlew bootRun</code>.</p><p>Start with the endpoint that remained public: The one that returns the number of hot sauces in the database.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this command into Terminal:</p><pre><code><span>curl</span> -i http://localhost:8080/api/hotsauces/count</code></pre><p>The <code><span>-</span>i</code> option tells cURL to <code>i</code>nclude the HTTP response headers in its output. By using it, you can see the HTTP status code for the API‚Äôs reponse.</p><p>The response should still be the number of hot sauces. It will be preceded by the response header, which should look like this:</p><pre><code>HTTP/1.1 <span>200</span>
X-Content-Type-Options: nosniff
X-XSS-Protection: <span>1</span><span>;</span> <span>mode</span><span>=</span>block
Cache-Control: no-cache, no-store, max-age<span>=</span><span>0</span>, must-revalidate
Pragma: no-cache
Expires: <span>0</span>
X-Frame-Options: DENY
Content-Type: application/json
Transfer-Encoding: chunked
Date: <span>{</span>Date and <span>time</span> when the response was issued<span>}</span></code></pre><p>The status code is the number at the end of the header‚Äôs first line: <strong>200</strong>, or ‚ÄúOK‚Äù.</p><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this command into PowerShell:</p><pre><code>Invoke<span>-</span>WebRequest <span>&#34;http://localhost:8080/api/hotsauces/count&#34;</span></code></pre><p>You&#39;re using PowerShell&#39;s <code>Invoke<span>-</span>WebRequest</code> this time, which means that the response will look like this:</p><pre><code>StatusCode        <span>:</span> <span>200</span>
StatusDescription <span>:</span>
Content           <span>:</span> <span>9</span>
RawContent        <span>:</span> <span>HTTP</span><span>/</span><span>1.1</span> <span>200</span>
                    Transfer<span>-</span>Encoding<span>:</span> chunked
                    Keep<span>-</span>Alive<span>:</span> timeout<span>=</span><span>60</span>
                    Connection<span>:</span> keep<span>-</span>alive
                    Content<span>-</span>Type<span>:</span> application<span>/</span>json
                    Date<span>:</span> Fri<span>,</span> <span>23</span> Jul <span>2021</span> <span>14</span><span>:</span><span>05</span><span>:</span><span>52</span> <span>GMT</span>

                    <span>9</span>
Forms             <span>:</span> <span>{</span><span>}</span>
Headers           <span>:</span> <span>{</span><span>[</span>Transfer<span>-</span>Encoding<span>,</span> chunked<span>]</span><span>,</span> <span>[</span>Keep<span>-</span>Alive<span>,</span> timeout<span>=</span><span>60</span><span>]</span><span>,</span> <span>[</span>Connection<span>,</span> keep<span>-</span>alive<span>]</span><span>,</span> <span>[</span>Content<span>-</span>Type<span>,</span>
                    application<span>/</span>json<span>]</span><span>...</span><span>}</span>
Images            <span>:</span> <span>{</span><span>}</span>
InputFields       <span>:</span> <span>{</span><span>}</span>
Links             <span>:</span> <span>{</span><span>}</span>
ParsedHtml        <span>:</span> System<span>.</span>__ComObject
RawContentLength  <span>:</span> <span>1</span></code></pre><p>The number of sauces is the value in the <code>Content</code> line, and as with the macOS/Linux version, the status code is the number at the end of the header‚Äôs first line: <strong>200</strong>, or ‚ÄúOK‚Äù.</p><h3 id="Trying-the-Protected-Endpoints">Trying the Protected Endpoints</h3><p>It‚Äôs time to try the endpoints that require authorization. Before using the token, try requesting a list of all the hot sauces without it.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this command into Terminal:</p><pre><code><span>curl</span> -i http://localhost:8080/api/hotsauces/</code></pre><p>Instead of a JSON list of dictionaries of hot sauces, you‚Äôll get an empty reply. The first line of the header should be your hint as to why:</p><pre><code><span>HTTP</span><span>/</span><span>1.1</span> <span>401</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this command into PowerShell:</p><pre><code><span>Invoke-WebRequest</span> <span>&#34;http://localhost:8080/api/hotsauces/&#34;</span></code></pre><p>You&#39;ll see this reply:</p><pre><code>Invoke<span>-</span>WebRequest <span>:</span> The remote server returned an error<span>:</span> <span>(</span><span>401</span><span>)</span> Unauthorized<span>.</span>
At line<span>:</span><span>1</span> char<span>:</span><span>1</span>
<span>+</span> Invoke<span>-</span>WebRequest <span>&#34;http://localhost:8080/api/hotsauces/&#34;</span>
<span>+</span> <span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span><span>~</span>
    <span>+</span> CategoryInfo          <span>:</span> InvalidOperation<span>:</span> <span>(</span>System<span>.</span>Net<span>.</span>HttpWebRequest<span>:</span>HttpWebRequest<span>)</span> <span>[</span>Invoke<span>-</span>WebRequest<span>]</span><span>,</span> WebExc
   eption
    <span>+</span> FullyQualifiedErrorId <span>:</span> WebCmdletWebResponseException<span>,</span>Microsoft<span>.</span>PowerShell<span>.</span>Commands<span>.</span>InvokeWebRequestCommand</code></pre><p>The <strong>401</strong> status code means ‚ÄúUnauthorized‚Äù. To refer back to the nightclub metaphor, you‚Äôre trying to get into the club without a wristband.</p><h4 id="Getting-a-list-of-all-the-hot-sauces-from-the-secured-API">Getting a list of all the hot sauces from the secured API</h4><p>Make the request again, this time including the access token.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this command into the terminal, making sure to replace <code><span>{</span>Access Token<span>}</span></code> with the value that you copied into your text editor:</p><pre><code><span>curl</span> -i --request GET <span>\</span>
     --url http://localhost:8080/api/hotsauces/ <span>\</span>
     -H <span>&#34;Content-Type: application/json&#34;</span> <span>\</span>
     -H <span>&#34;authorization: Bearer {Access Token}&#34;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this command into PowerShell, making sure to replace <code><span>{</span>Access Token<span>}</span></code> with the value that you copied into your text editor:</p><pre><code>$accessToken <span>=</span> <span>&#34;{Access Token}&#34;</span>
$headers <span>=</span> @<span>{</span>
    Authorization <span>=</span> <span>&#34;Bearer $accessToken&#34;</span>
<span>}</span>
$response <span>=</span> Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces/&#34;</span> `
    <span>-</span>Headers $headers
$response <span>|</span> ConvertTo<span>-</span>Json</code></pre><p>This time, when you make the request, you‚Äôll get the list of all the hot sauces.</p><h4 id="Adding-a-hot-sauce-using-the-secured-API">Adding a hot sauce using the secured API</h4><p>Try adding add a hot sauce using the access token.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this command into the terminal:</p><pre><code><span>curl</span> -i --request POST <span>\</span>
    --url http://localhost:8080/api/hotsauces/ <span>\</span>
    -H <span>&#34;Content-Type: application/json&#34;</span> <span>\</span>
    --data <span>&#39;{&#34;brandName&#34;: &#34;Dave‚Äôs Gourmet&#34;, &#34;sauceName&#34;: &#34;Temporary Insanity&#34;, &#34;url&#34;: &#34;https://store.davesgourmet.com/ProductDetails.asp?ProductCode=DATE&#34;, &#34;description&#34;: &#34;This sauce has all the flavor of Dave‚Äôs Original Insanity with less heat. Finally, there‚Äôs sauce for when you only want to get a little crazy in the kitchen. Add to stews, burgers, burritos, and pizza, or any food that needs an insane boost. As with all super hot sauces, this sauce is best enjoyed one drop at a time!&#34;, &#34;heat&#34;: 57000}&#39;</span> <span>\</span>
    -H <span>&#34;authorization: Bearer {Access Token}&#34;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this command into PowerShell:</p><pre><code>$body <span>=</span> @<span>{</span>
    brandName <span>=</span> <span>&#34;Dave&#39;s Gourmet&#34;</span>
    sauceName <span>=</span> <span>&#34;Temporary Insanity&#34;</span>
    url <span>=</span> <span>&#34;https://store.davesgourmet.com/ProductDetails.asp?ProductCode=DATE&#34;</span>
    description <span>=</span> <span>&#34;This sauce has all the flavor of Dave\&#39;s Original Insanity with less heat. Finally, there&#39;s sauce for when you only want to get a little crazy in the kitchen. Add to stews, burgers, burritos, and pizza, or any food that needs an insane boost. As with all super hot sauces, this sauce is best enjoyed one drop at a time!&#34;</span>
    heat <span>=</span> <span>57000</span>
<span>}</span> <span>|</span> ConvertTo<span>-</span>Json
$response <span>=</span> Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces/&#34;</span> <span><span>`</span><span>
    -Method POST </span><span>`</span></span>
    <span>-</span>ContentType <span>&#34;application/json&#34;</span> <span><span>`</span><span>
    -Headers $headers </span><span>`</span></span>
    <span>-</span>Body $body
$response <span>|</span> ConvertTo<span>-</span>Json</code></pre><h4 id="Editing-a-hot-sauce-using-the-secured-API">Editing a hot sauce using the secured API</h4><p>Try editing the hot sauce with <code>id</code> 10.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this command into the terminal:</p><pre><code><span>curl</span> -i --request PUT <span>\</span>
    --url http://localhost:8080/api/hotsauces/10 <span>\</span>
    -H <span>&#34;Content-Type: application/json&#34;</span> <span>\</span>
    --data <span>&#39;{&#34;brandName&#34;: &#34;NewCo&#34;, &#34;sauceName&#34;: &#34;Generic Hot Sauce&#34;, &#34;description&#34;: &#34;It‚Äôs hot. It‚Äôs sauce. That‚Äôs it.&#34;, &#34;heat&#34;: 1000}&#39;</span> <span>\</span>
    -H <span>&#34;authorization: Bearer {Access Token}&#34;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this command into PowerShell:</p><pre><code>$body <span>=</span> @<span>{</span>
    brandName <span>=</span> <span>&#34;NewCo&#34;</span>
    sauceName <span>=</span> <span>&#34;Generic Hot Sauce&#34;</span>
    description <span>=</span> <span>&#34;It‚Äôs hot. It‚Äôs sauce. That‚Äôs it.&#34;</span>
    heat <span>=</span> <span>1000</span>
<span>}</span> <span>|</span> ConvertTo<span>-</span>Json
$response <span>=</span> Invoke<span>-</span>RestMethod <span>&#34;http://localhost:8080/api/hotsauces/10&#34;</span> <span><span>`</span><span>
    -Method PUT </span><span>`</span></span>
    <span>-</span>ContentType <span>&#34;application/json&#34;</span> <span><span>`</span><span>
    -Headers $headers </span><span>`</span></span>
    <span>-</span>Body $body
$response <span>|</span> ConvertTo<span>-</span>Json</code></pre><p>Note that since you didn‚Äôt change the <code>url</code> property of the sauce, it remains the same.</p><h4 id="Deleting-a-hot-sauce-using-the-secured-API">Deleting a hot sauce using the secured API</h4><p>Then try deleting the hot sauce with <code>id</code> 10.</p><p>üå∂ <strong>If you‚Äôre on macOS or Linux,</strong> enter this command into the terminal:</p><pre><code><span>curl</span> -i --request DELETE <span>\</span>
    --ur l http://localhost:8080/api/hotsauces/10
    -H <span>&#34;authorization: Bearer {Access Token}&#34;</span></code></pre><p>üå∂ <strong>If you‚Äôre on Windows,</strong> enter this command into PowerShell:</p><pre><code>Invoke-RestMethod <span>&#34;http://localhost:8080/api/hotsauces/10&#34;</span> <span><span>`</span>
    -Method DELETE <span>`</span></span>
    -Headers <span>$headers</span></code></pre><p>List the hot sauces or get a count to confirm that the sauce is no longer in the list.</p><p>If you‚Äôve made it this far, congratulations! You‚Äôve just developed and secured an API with Spring Boot, Kotlin, and Auth0!</p></div></div>]]></content:encoded>
      <author>A closer look at the authorizations you just defined</author>
      <pubDate>Wed, 11 Aug 2021 22:32:00 +0000</pubDate>
    </item>
    <item>
      <title>Strategy Design Pattern in Python</title>
      <link>https://auth0.com/blog/strategy-design-pattern-in-python/</link>
      <description>Learn strategy design pattern to write better code in Python</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>While you are developing software applications, you might run into some problems implementing the feature you need. Software design patterns are typical solutions for some of these commonly occurring problems while developing software applications using Object-oriented design. In this article, let&#39;s learn about one of the popular design patterns, <strong>Strategy</strong> pattern, and its implementation in Python.</p><h2 id="Introduction">Introduction</h2><p>Before diving into the strategy pattern, you should be familiar with some of the basics concepts of <a href="https://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank" rel="noreferrer noopener">Object-Oriented Programming</a> (OOP). The entire concept of design patterns revolves around <em>classes</em> and <em>objects</em>. The design patterns are more high-level solutions for commonly occurring problems. They are like the blueprint to solve a specific problem. They are not confined to a single programming language. You can use design patterns in any programming language that supports object-oriented programming; the process will be the same while the syntax changes.
<img src="https://images.ctfassets.net/23aumh6u8s0i/4tPzU9nvm5jUwrXAeeHH3e/1badc171178aa953f7df05f08960f228/01_design-types.jpg" alt="design patterns"/>
There are several types of design patterns, including <strong>Creational</strong>, <strong>Structural</strong>, and <strong>Behavioral</strong> patterns. Creational patterns are about different ways to create objects that increase the flexibility of our code. Structural patterns are about relations between the objects, making larger structures flexible using objects and classes. Behavioral patterns are about effective communications and interactions between objects.</p><h2 id="Strategy">Strategy</h2><p><strong>Strategy Pattern</strong> is a design pattern that enables our application to select algorithms at runtime, making our application flexible. The original book on <a href="https://en.wikipedia.org/wiki/Design_Patterns" target="_blank" rel="noreferrer noopener">design patterns</a> written by <a href="http://wiki.c2.com/?GangOfFour" target="_blank" rel="noreferrer noopener">GoF</a> states that &#34;Strategy pattern intends to define a family of algorithms, <a href="https://auth0.com/blog/strategy-design-pattern-in-python/shorturl.at/rHJR7" target="_blank" rel="noreferrer noopener">encapsulates</a> each one, and
make them interchangeable.&#34; More specifically, it lets you define a set of algorithms that are interchangeable according to some factors at runtime. Strategy Pattern falls under the category of behavioral design patterns as it enables an algorithm&#39;s behavior to be selected at runtime.</p><h2 id="Usage">Usage</h2><p>While developing software applications, you may have a few alternatives to accomplish something in your code. Depending on your client choices, data sources, or other factors, you want to do something different without changing the code. You often tend to define algorithms using conditional statements for different situations in the main class of the code. But it is not an elegant way of writing better code. It makes the main class of your code quite long, and it becomes too hard to maintain the application.</p><p>In situations like these, the strategy pattern is an ideal solution. The strategy pattern suggests you define classes, called <em>strategies</em>, for your algorithms of different situations. The strategy is referenced inside the main class, called <em>context</em>, and the code works according to that situation. The context does not select an appropriate strategy for the case. Instead, the client passes the desired strategy to the context.</p><p>For example, if you have a chess application, you can select the difficulty level between easy, medium, or hard. The computer chooses an algorithm according to the level you choose. It is one of the best examples where the strategy pattern is used.</p><p>Strategy pattern follows the <a href="https://en.wikipedia.org/wiki/Open%E2%80%93closed_principle" target="_blank" rel="noreferrer noopener">Open/close principle</a>; a software application is open for extension but closed for modification. It means you can add any number of additional strategies without modifying the main class. It makes your code more flexible and easy to maintain.</p><h2 id="UML-Diagrams">UML Diagrams</h2><p>The following is the UML diagram of the Strategy pattern.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/21fvYspoS3Voqv7pKyDE4E/e89c3e5f81d51b3d15a436cd81e795f7/02_UML-Strategy.jpg" alt="UML Strategy"/></p><ol start="1"><li><strong>Context</strong> ‚Äî It is the primary class of our application. It maintains a reference to one of the concrete strategies.</li><li><strong>Strategy</strong> ‚Äî Strategy interface is common to all supported strategies. Context can communicate with other strategies only through the strategy interface.</li><li><strong>ConcreteStrategies</strong> ‚Äî These are the classes that implement the algorithm using the Strategy interface.</li></ol><h2 id="Implementation">Implementation</h2><p>Let&#39;s see the step-by-step process of implementing a strategy pattern.</p><ol start="1"><li>You should first identify algorithms you want to execute as concrete strategies in the primary class.</li><li>Define the <em>context</em> (primary class) and add a reference to the strategy, a method to set the strategy, and another method to execute the strategy. You may also define a default strategy to switch between strategies only if they do not like the default one.</li></ol><pre><code><span>## context - the primary class</span>
<span>class</span> <span>Context</span><span>:</span>
    strategy<span>:</span> Strategy  <span>## the strategy interface</span>

    <span>def</span> <span>setStrategy</span><span>(</span>self<span>,</span> strategy<span>:</span> Strategy <span>=</span> <span>None</span><span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>if</span> strategy <span>is</span> <span>not</span> <span>None</span><span>:</span>
            self<span>.</span>strategy <span>=</span> strategy
        <span>else</span><span>:</span>
            self<span>.</span>strategy <span>=</span> Default<span>(</span><span>)</span>

    <span>def</span> <span>executeStrategy</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>str</span><span>:</span>
        <span>print</span><span>(</span>self<span>.</span>strategy<span>.</span>execute<span>(</span><span>)</span><span>)</span></code></pre><p>First, we define the <code>strategy</code> field for storing a reference to a strategy object, and two methods, <code>setStrategy</code> and <code>executeStrategy</code>. The <code>setStrategy</code> sets the strategy selected if a user selects an option, or else the <code><span>default</span></code> one.</p><ol start="3"><li>Define the <em>Strategy Interface</em>, which is common to all the concrete strategies. The <code>Strategy</code> interface has an abstract method that you can alter in concrete strategies.</li></ol><pre><code><span>from</span> abc <span>import</span> ABC<span>,</span> abstractmethod

<span>## Strategy interface</span>
<span>class</span> <span>Strategy</span><span>(</span>ABC<span>)</span><span>:</span>
    <span>@abstractmethod</span>
    <span>def</span> <span>execute</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>str</span><span>:</span>
        <span>pass</span></code></pre><ol start="4"><li>Define the concrete strategies which should implement the <code>Strategy</code> interface. These concrete strategies must have a common method that overrides the <code>execute</code> method of the <code>Strategy</code> interface.</li></ol><pre><code><span>## Concrete strategies</span>
<span>class</span> <span>ConcreteStrategyA</span><span>(</span>Strategy<span>)</span><span>:</span>
    <span>def</span> <span>execute</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>str</span><span>:</span>
        <span>return</span> <span>&#34;ConcreteStrategy A&#34;</span>

<span>class</span> <span>ConcreteStrategyB</span><span>(</span>Strategy<span>)</span><span>:</span>
    <span>def</span> <span>execute</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>str</span><span>:</span>
        <span>return</span> <span>&#34;ConcreteStrategy B&#34;</span>

<span>class</span> <span>Default</span><span>(</span>Strategy<span>)</span><span>:</span>
    <span>def</span> <span>execute</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>str</span><span>:</span>
        <span>return</span> <span>&#34;Default&#34;</span></code></pre><ol start="5"><li>Now, users can select the strategy they want at the runtime. Create an object of <em>context</em> and pass a concrete strategy.</li></ol><pre><code><span>## Example application</span>
appA <span>=</span> Context<span>(</span><span>)</span>
appB <span>=</span> Context<span>(</span><span>)</span>
appC <span>=</span> Context<span>(</span><span>)</span>

<span>## selecting stratigies</span>
appA<span>.</span>setStrategy<span>(</span>ConcreteStrategyA<span>(</span><span>)</span><span>)</span>
appB<span>.</span>setStrategy<span>(</span>ConcreteStrategyB<span>(</span><span>)</span><span>)</span>
appC<span>.</span>setStrategy<span>(</span><span>)</span>    <span>## sets to default strategy</span>

<span>## each object below execute different strategy with same method</span>
appA<span>.</span>executeStrategy<span>(</span><span>)</span>
appB<span>.</span>executeStrategy<span>(</span><span>)</span>
appC<span>.</span>executeStrategy<span>(</span><span>)</span></code></pre><p>The output of the above code will be as follow:</p><pre><code>ConcreteStrategy <span>A</span>
ConcreteStrategy <span>B</span>
Default</code></pre><p>If you want to use another strategy, replace the ConcreteStrategy instance with the strategy you want. You can add a new concrete strategy without changing anything in the context.</p><h2 id="Example">Example</h2><p>Let&#39;s design a <a href="https://en.wikipedia.org/wiki/Rock_paper_scissors" target="_blank" rel="noreferrer noopener">rock paper scissors</a> game using strategy pattern. You can select any strategy among rock, paper, scissors, and random to play against the computer. The below example code uses the strategy pattern to implement various strategies.</p><pre><code><span>## Changing the strategy among Rock, Paper, Scissors, and Random</span>

<span>import</span> random
<span>from</span> abc <span>import</span> ABC<span>,</span> abstractmethod

<span>## Strategy interface </span>
<span>class</span> <span>Strategy</span><span>(</span>ABC<span>)</span><span>:</span>
    <span>@abstractmethod</span>
    <span>def</span> <span>selection</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>pass</span>

<span>## Concrete strategies</span>
<span>class</span> <span>Rock</span><span>(</span>Strategy<span>)</span><span>:</span>
    <span>## actual application will have the algorithm instead this method</span>
    <span>def</span> <span>selection</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>str</span><span>:</span>
        <span>return</span> <span>&#34;Rock&#34;</span>

<span>class</span> <span>Paper</span><span>(</span>Strategy<span>)</span><span>:</span>
    <span>def</span> <span>selection</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>str</span><span>:</span>
        <span>return</span> <span>&#34;Paper&#34;</span>

<span>class</span> <span>Scissors</span><span>(</span>Strategy<span>)</span><span>:</span>
    <span>def</span> <span>selection</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>str</span><span>:</span>
        <span>return</span> <span>&#34;Scissors&#34;</span>

<span>class</span> <span>Random</span><span>(</span>Strategy<span>)</span><span>:</span>
    <span>def</span> <span>selection</span><span>(</span>self<span>)</span> <span>-</span><span>&gt;</span> <span>str</span><span>:</span>
        options <span>=</span> <span>[</span><span>&#34;Rock&#34;</span><span>,</span> <span>&#34;Paper&#34;</span><span>,</span> <span>&#34;Scissors&#34;</span><span>]</span>
        <span>return</span> random<span>.</span>choice<span>(</span>options<span>)</span>

<span>## Context class</span>
<span>class</span> <span>Game</span><span>:</span>
    strategy<span>:</span> Strategy

    <span>def</span> <span>__init__</span><span>(</span>self<span>,</span> strategy<span>:</span> Strategy <span>=</span> <span>None</span><span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        <span>if</span> strategy <span>is</span> <span>not</span> <span>None</span><span>:</span>
            self<span>.</span>strategy <span>=</span> strategy
        <span>else</span><span>:</span>
            self<span>.</span>strategy <span>=</span> Random<span>(</span><span>)</span>

    <span>def</span> <span>play</span><span>(</span>self<span>,</span> sec<span>)</span> <span>-</span><span>&gt;</span> <span>None</span><span>:</span>
        s1 <span>=</span> self<span>.</span>strategy<span>.</span>selection<span>(</span><span>)</span>
        s2 <span>=</span> sec<span>.</span>strategy<span>.</span>selection<span>(</span><span>)</span>
        <span>if</span> s1 <span>==</span> s2<span>:</span>
            <span>print</span><span>(</span><span>&#34;It&#39;s a tie&#34;</span><span>)</span>
        <span>elif</span> s1 <span>==</span> <span>&#34;Rock&#34;</span><span>:</span>
            <span>if</span> s2 <span>==</span> <span>&#34;Scissors&#34;</span><span>:</span>
                <span>print</span><span>(</span><span>&#34;Player 1 wins!&#34;</span><span>)</span>
            <span>else</span><span>:</span>
                <span>print</span><span>(</span><span>&#34;Player 2 wins!&#34;</span><span>)</span>
        <span>elif</span> s1 <span>==</span> <span>&#34;Scissors&#34;</span><span>:</span>
            <span>if</span> s2 <span>==</span> <span>&#34;Paper&#34;</span><span>:</span>
                <span>print</span><span>(</span><span>&#34;Player 1 wins!&#34;</span><span>)</span>
            <span>else</span><span>:</span>
                <span>print</span><span>(</span><span>&#34;Player 2 wins!&#34;</span><span>)</span>
        <span>elif</span> s1 <span>==</span> <span>&#34;Paper&#34;</span><span>:</span>
            <span>if</span> s2 <span>==</span> <span>&#34;Rock&#34;</span><span>:</span>
                <span>print</span><span>(</span><span>&#34;Player 1 wins!&#34;</span><span>)</span>
            <span>else</span><span>:</span>
                <span>print</span><span>(</span><span>&#34;Player 2 wins!&#34;</span><span>)</span>

<span>## Example application</span>
<span>## PLayer 1 can select his strategy</span>
player1 <span>=</span> Game<span>(</span>Paper<span>(</span><span>)</span><span>)</span>

<span># Player 2 gets to select</span>
player2 <span>=</span> Game<span>(</span>Rock<span>(</span><span>)</span><span>)</span>

<span># After the second player choice, we call the play method</span>
player1<span>.</span>play<span>(</span>player2<span>)</span></code></pre><p>According to the strategies chosen by the two players, the expected output would be:</p><pre><code>Player <span>1</span> wins<span>!</span></code></pre><p>Test all the other cases of the game using all the other strategies. To add extra fun to the game, try creating two more strategies to the above example according to <a href="https://bigbangtheory.fandom.com/wiki/Rock,_Paper,_Scissors,_Lizard,_Spock" target="_blank" rel="noreferrer noopener">the Lizard-Spock expansion</a>.</p><h2 id="Conclusion">Conclusion</h2><p>In this article, you have seen where and how to use the strategy pattern in your code. You can build flexible and maintainable software applications using the strategy pattern. You can switch between algorithms at runtime according to the user&#39;s decision without changing the code. But if your code only has a couple of algorithms, there is no need to use strategy. It just makes your code look complex with numerous classes and objects. The Strategy pattern can work as an alternative for conditional statements for selecting the behavior of the application. But the potential drawback of strategy pattern is that the users must know how strategies differ from each other to select what they need. So it would be best if you use the strategy pattern only when the variation in behavior of the application is relevant to the users. So try to make your software applications flexible using the strategy pattern.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 10 Aug 2021 14:58:00 +0000</pubDate>
    </item>
    <item>
      <title>Developer Day Helps Developers Build the Future of Identity</title>
      <link>https://auth0.com/blog/developerday-helps-developers-build-the-future-of-identity/</link>
      <description>What is Developer Day? Developer Advocate, Ben Dechrai, explores the lineup and shares his thoughts from a delegate&#39;s perspective.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>You‚Äôve probably heard by now that <a href="https://auth0.com/blog/developers-explore-okta-auth0/" target="_blank" rel="noreferrer noopener">Okta and Auth0 have joined forces</a>. As a developer advocate for Auth0, I‚Äôm really excited to see how we can combine our forces to make identity even better for the developer community.</p><p>You might not be aware that I‚Äôm a huge fan of creating events that directly address the needs of developer communities. From the first conference I ran in 2004 to the user group meetings that are still going to this day, you can imagine my excitement when I heard we (Auth0 and Okta) were going to run an online event together!</p><p>This time, members of my team are taking the lead, so I&#39;ll be in the same boat as many of you experiencing Developer Day as it happens, so I thought it might be helpful to share my thoughts on the event and what I‚Äôm looking forward to the most.</p><p>Hit up the <a href="http://community.auth0.com/" target="_blank" rel="noreferrer noopener">community forum</a> if I miss something that‚Äôs important to you ‚Äî there‚Äôs so much for everyone, I‚Äôm sure you‚Äôll help others out too.</p><h2 id="What-Is-Developer-Day-">What Is Developer Day?</h2><p><a href="https://www.okta.com/developerday/" target="_blank" rel="noreferrer noopener">Developer Day</a> creates a space for all developers to discover how the identity space is evolving, learn best practices in privacy and security, and gain insights from developer experiences. It brings speakers from across these sectors right to your desktop, and best of all ‚Äî it‚Äôs free!</p><blockquote><p>Speaking of free, did you know you can also <a href="https://auth0.com/signup" data-amp-replace="CLIENT_ID" data-amp-addparams="anonId=CLIENT_ID(cid-scope-cookie-fallback-name)" target="_blank" rel="noreferrer noopener">sign up for a free Auth0 account</a> at any time? Why not try it out today?</p></blockquote><p><img src="https://images.ctfassets.net/23aumh6u8s0i/12g1Ga4gP8X04Xn0H0nnFt/5b4ae4b06847a028d9a784a46ec48b26/cassidy-alyssa-kapehe.png" alt="Developer Day speakers Cassidy Williams, Alyssa Miller, and Kapehe"/></p><p>More specifically, it‚Äôs a one-day, single-track, virtual event, and while I‚Äôm proud to see some of my colleagues‚Äô names in the speaker list, the lineup also features the likes of <strong>Cassidy Williams</strong> (Director of Developer Experience at Netlify), <strong>Alyssa Miller</strong> (Hacker, Researcher, and Security Advocate), and <strong>Kapehe</strong> (Developer Relations at Sanity.io, and yes, you might remember she used to <a href="https://auth0.com/blog/authors/kapehe-jorgenson/" target="_blank" rel="noreferrer noopener">work at Auth0</a> too).</p><h2 id="What-Can-I-Learn-">What Can I Learn?</h2><p>The first place I tend to go when looking at an event is the agenda, and skimming over this one, we‚Äôre in for a breadth and depth of information.</p><p>The keynote is where the day‚Äôs journey starts, and Alyssa‚Äôs <strong>updates from the world of cyber security</strong> are sure to offer a great insight that sets the foundation for the day. I‚Äôm a huge advocate for helping all developers understand security principles and states of play. Even if you never have to deal with part of it yourself, you‚Äôll always benefit from knowing why something is done and how you‚Äôre being protected.</p><h2 id="From-APIs-to-IoT--Live-Demos-and-Security-Fundamentals">From APIs to IoT: Live Demos and Security Fundamentals</h2><p>From there, we meander down a path from securing Python APIs to securing your Home Automation and IoT devices. Personally, I‚Äôm a sucker for anything IoT-related, so I‚Äôll be paying attention to this one.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/hd4kE3aQJFlX45nvwu3xF/6496580a2a7c7da50a6591f781035097/aaron-vittorio.png" alt="Developer Day speakers Aaron Parecki and Vittorio Bertocci"/></p><p>Having grown up on YouTube videos (okay, I‚Äôm not that young...) about identity from both Aaron Parecki (or as I like to call him, Mr OAuth, but don‚Äôt tell him I told you) and Vittorio Bertocci (the man whose identity knowledge is dwarfed only by his magnificent hair), what better than a talk from both of them? The talk will not only cover where we‚Äôve come from, but what the future of OAuth has in store for us.</p><h2 id="Advanced-Topics-like-Verifiable-Credentials-and-Integration-with-Third-Parties">Advanced Topics like Verifiable Credentials and Integration with Third Parties</h2><p>But identity isn‚Äôt just about logging in and loading your glamour shot from Gravatar. I just recently learned about verifiable credentials, and wow - it‚Äôs such a powerful concept with so many use cases, I just can‚Äôt even! The topic deserves its own article, but one example is around payments, and Uchi Uchibeke‚Äôs talk is going to be fascinating, to be sure.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/71FxWB7JqseFrDM9mF63Go/bd98bfcda1f9662b1c7de0bfab486599/uchi.png" alt="Developer Day speaker Uchi Uchibeke"/></p><p>Uchi is flanked by demos on integrating Auth0 with NextJS for securing your webapps and Okta with Kong for securing continuous integration, delivery, and deployment. I think this highlights that the team who worked on the agenda really put a lot of thought into the balance between talks that can have immediate benefit to us developers, as well as enough advanced topics to keep our creative juices flowing.</p><p>Talking of immediately applicable information, if you want to learn how to validate REST API authentication and authorization, the JFrog talk is for you.</p><h2 id="Authentication-in-Gaming-and-Extended-Realities">Authentication in Gaming and Extended Realities</h2><p>If you thought the IoT talk was a bit out of the box, the Gaming and XR talk might just be in a whole other room! Not literally. I mean ‚Äî it‚Äôs a virtual event. There aren‚Äôt any rooms. There aren‚Äôt any boxes either, for that matter. I digress.</p><p>I won‚Äôt admit to being a huge gamer. I load up Poly Bridge 2 every now and then. Does Minesweeper count? One thing I do know, though, is that the authentication experience in games can be awful, and when you get into any extended reality (XR), well. Let‚Äôs not go there.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2REEADn8ARvYmok2WNAt5O/9185928ac397dced701f3cb2d252e4b9/nick.png" alt="Developer Day speaker Nick Gamb"/></p><p>We‚Äôll let Okta&#39;s Nick Gamb go there instead, as he tells us about the propensity for this industry to be targeted by hackers. Follow his advice, and maybe we can all keep playing in the knowledge that our Minedimes are safe. (See ‚Äî I told you I‚Äôm not a huge gamer.)</p><h2 id="Adding-Pixie-Dust-to-Enhance-Security">Adding Pixie Dust to Enhance Security</h2><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2tBAGZHtBlb4Dt1P21WzAS/2cd4c6438265b64c39bb39b89e6945b9/milecia.png" alt="Developer Day speaker Milecia McGregor"/></p><p>With two talks left for the day, I‚Äôm personally keen to catch Milecia McGregor from Mediavine talk about pixies! Stop it, autocorrect. PKCE! While most SDKs magically hide away much of the implementation, it‚Äôs still worth understanding how authentication flows work and how they can be improved. The most common OAuth flow is debatably the Authcode flow, but PKCE makes it even better! Come along to find out how. I‚Äôll be at the front taking notes.</p><h2 id="Closing-Keynote">Closing Keynote</h2><p>It‚Äôs a packed event ‚Äî thank goodness there are a couple of breaks during the day ‚Äî and we finish with a closing keynote from Cassidy Williams. The agenda teases us with the mere existence of this session, and perhaps we‚Äôll find out more before the event. In any case, I‚Äôll not be missing it.</p><p>Tell us in the <a href="http://community.auth0.com/" target="_blank" rel="noreferrer noopener">community forum</a> what you‚Äôre looking forward to the most, and I hope to see some of you in the chat room on the day!</p></div></div>]]></content:encoded>
      <pubDate>Mon, 09 Aug 2021 16:30:00 +0000</pubDate>
    </item>
    <item>
      <title>Here‚Äôs Something New for You: Identity OS</title>
      <link>https://auth0.com/blog/here-s-something-new-for-you-identity-os/</link>
      <description>Introducing the new way to think about and build identity</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Authentication has become so much more than just a login box.</p><p>Sure, that‚Äôs still what consumers see when they are eagerly clicking towards whatever pizza, handbag, or Playstation pre-sale link they want to get to ASAP.</p><p>But it‚Äôs the expectation around what is happening when they click that has increased. Consumers demand the convenience of a seamless login but also want to know that their card details are secure and that their identity is protected against any breaches of privacy.</p><p>In the past, it was about trade-offs. But consumers don‚Äôt expect trade-offs, so that‚Äôs why we wanted to develop an identity operating system that lets everyone ‚Äî  from IT teams to devs ‚Äî build authentication that works now and with whatever the future throws at it.</p><p>Okay, So That‚Äôs Why We Need a New Way, but...</p><h2 id="What-Is-an-Identity-OS-">What Is an Identity OS?</h2><p>The Auth0 identity operating system (identity OS) is a cloud-native, adaptable platform for development teams. Built with extensible building blocks, the Auth0 identity OS enables organizations to manage the complexities of today‚Äôs identity management while also prioritizing the security, privacy, and convenience of their end-users. </p><p>Striking the perfect balance among these priorities requires identity to integrate a myriad of different services and creates a significant integration hurdle. Identity ecosystem operators can now manage these complex integration needs with the flexibility of full-spectrum code (pro-code, low-code, and no code solutions). </p><p>Customizing to the requirements of different development teams removes their need to focus on identity infrastructure when building differentiated applications. This level of adaptability is a huge benefit for enterprises that are confronted with converging use cases and managing the eroding lines between identity for employees, business partners, and consumers.</p><p>Sounds good, but...</p><h2 id="What-s-the-Three-Benefits-I-Should-Really-Care-About-">What‚Äôs the Three Benefits I Should Really Care About?</h2><h3 id="1--It-s-all-about-adaptability">1. It‚Äôs all about adaptability</h3><p>If anyone reading this has never had to change their product roadmap quickly, then you are one of the lucky ones. With the explosion of consumer-friendly services made possible through digital applications, consumer expectations are constantly changing. That beautiful Netflix UX is what they expect from everything (even public sector services these days are stepping their game up). So the Auth0 identity OS is built to be as adaptable as your business needs to be, without forcing you into clunky legacy features that you will take years to strip out.</p><h3 id="2--We-re-living-in-a-modular-world">2. We‚Äôre living in a modular world</h3><p>The best technology is the most open. There are so many amazing integrations and APIs being made by devs, so the Auth0 identity OS provides modular identity building blocks with integrations and industry blueprints.</p><h3 id="3--Breadth-rather-than-tiny-boxes">3. Breadth rather than tiny boxes</h3><p>Identity is converging, and the lines between ‚Äúuse cases‚Äù are collapsing. When we talk about use cases, we mean allowing employees secure access to files and apps through Single Sign On (SSO); or allowing a subscriber of a media service access via their social accounts.</p><blockquote><p>The Auth0 identity OS provides support for the full breadth of identity needs. </p></blockquote><p>Traditionally the identity industry has created single-purpose products for Workforce Identity, Business Identity, and Consumer Identity. But the company needs rarely fit into simple, separated boxes. The lines between identity use cases are eroding because rarely does a company only require one type. </p><h2 id="Anything-Else-I-Should-Know-">Anything Else I Should Know?</h2><p>If you‚Äôve made it this far, then you seem like the kind of person who would appreciate some of the more technical, finer points.</p><p>Here‚Äôs what the Auth0 identity OS offers:</p><ul><li><strong>A customizable cut-of-the-box login experience</strong> ‚Äî Universal Login is our first huge benefit to developers. It‚Äôs an embeddable client experience that requires zero custom code to set up while allowing developers to quickly add capabilities to it, including social login and multi-factor authentication (MFA), without making any changes to your app‚Äôs code.</li><li><strong>User management built-in</strong> ‚Äî Auth0 gives you a secure and intuitive way of managing your user identities, including password resets, creating, blocking, and deleting users via the Users Dashboard or via the Auth0 API.</li><li><strong>Control &amp; customization</strong> ‚Äî Extend with code: All applications and scenarios are different. Auth0‚Äôs Actions extend the functionality of Auth0‚Äôs base product to adapt it to your company needs and integrate it with other applications and services.</li><li><strong>Calling APIs and external resources</strong> ‚Äî Once your user authenticates, Auth0 will generate an ID Token and an Access Token that will be passed back to your application. The Access Token can then be used to call your API and/or any external resource.</li></ul><h2 id="And-That-s-It--Now-It-s-up-to-You-to-Build-Something-Awesome">And That‚Äôs It, Now It‚Äôs up to You to Build Something Awesome</h2><p>The Auth0 identity OS is here to give you the tools to build more convenient, secure, and private authentication experiences for your customers and employees. </p><p>Read more at <a href="https://auth0.com/identity-os" target="_blank" rel="noreferrer noopener">https://auth0.com/identity-os</a> </p><p>Or get in touch today to let us know what you think.</p></div></div>]]></content:encoded>
      <pubDate>Mon, 09 Aug 2021 14:54:00 +0000</pubDate>
    </item>
    <item>
      <title>Deployment Strategies In Kubernetes</title>
      <link>https://auth0.com/blog/deployment-strategies-in-kubernetes/</link>
      <description>Learn what are the different deployment strategies available in Kubernetes and how to use them.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> In this article, we will learn what are the deployment strategies while deploying containers using Kubernetes container-orchestration system. At the end of this article, we will have learned how to do deployment using different ways in Kubernetes cluster. If you find this topic interesting, keep reading! 
The code for this tutorial is available here on <a href="https://github.com/akhil90s/auth0/tree/main/Deployment%20Strategies%20In%20Kubernetes/Declarative%20Templates" target="_blank" rel="noreferrer noopener">Github</a></p><h2 id="Quick-Introduction-to-Kubernetes">Quick Introduction to Kubernetes</h2><p>With containerization gaining popularity over time and revolutionizing the process of building, shipping, and maintaining applications, there was a need to effectively manage these containers. Many container orchestration tools were introduced to manage the lifecycle of these containers in large-scale systems.</p><p>Kubernetes is one such orchestration tool that takes care of provisioning and deployment, allocation of resources, load balancing, service discovery, providing high availability, and other important aspects of any system. With this platform, we can decompose our applications into smaller systems (called microservices) while developing; then, we can compose (or orchestrate) these systems together while deploying. </p><p>The adoption of cloud-native approach has increased development of applications based on microservice architecture. For such applications, one of the biggest challenges organizations face is deployment. Having a proper strategy in terms of deployment is necessary. In Kubernetes, there are different ways to release an application; it is necessary to choose the right strategy to make your infrastructure reliable during an application deployment or update. For instance, in a production environment, it is always required to ensure that end-user shouldn&#39;t experience any downtime. In Kubernetes orchestration, right strategy ensures proper management of different versions of container images. To sum up, this article will mainly be around the different deployment strategies in Kubernetes.</p><h2 id="Prerequisites">Prerequisites</h2><p>To follow along with this article, we will need some previous experience with Kubernetes. If new to this platform, kindly check out the <a href="https://auth0.com/blog/kubernetes-tutorial-step-by-step-introduction-to-basic-concepts/" target="_blank" rel="noreferrer noopener">Step by Step Introduction to Basic Kubernetes Concepts</a> tutorial. There, you can learn everything you need to follow the instructions here. We would also recommend going through the <a href="https://kubernetes.io/docs/home/" target="_blank" rel="noreferrer noopener">Kubernetes documentation</a> if and when required.</p><p>Besides that, we will need kubectl, a Command-Line Interface (CLI) tool that will enable us to control your cluster from a terminal. If you don&#39;t have this tool, check the instructions on the <a href="https://auth0.com/blog/kubernetes-tutorial-step-by-step-introduction-to-basic-concepts/#Installing.Kube.Control..kubectl." target="_blank" rel="noreferrer noopener">Installing Kube Control (kubectl)</a>.We will also need a basic understanding of Linux and YAML.</p><h2 id="What-Is-A-Deployment-In-Kubernetes-">What Is A Deployment In Kubernetes?</h2><p>A Deployment is a resource object in Kubernetes that defines the desired state for our program. Deployments are declarative, meaning that we don&#39;t dictate how to achieve the state. Instead, we declare the desired state and allow the Deployment-controller to automatically reach that end goal in the most efficient way. A deployment allows us to describe an application&#39;s life cycle, such as which images to use for the app, the number of pods there should be, and the way in which they should be updated.</p><h2 id="Benefits-Of-Using-Kubernetes-Deployment">Benefits Of Using Kubernetes Deployment</h2><p>The process of manually updating containerized applications can be time consuming and tedious. A Kubernetes deployment makes this process automated and repeatable. Deployments are entirely managed by the Kubernetes backend, and the whole update process is performed on the server side without client interaction.</p><p>Moreover, the Kubernetes deployment controller is always monitoring the health of pods and nodes. It replaces a failed pod or bypass down nodes, ensuring continuity of critical applications.</p><h2 id="Deployment-Strategies">Deployment Strategies</h2><h3 id="Rolling-Update-Deployment">Rolling Update Deployment</h3><p>The rolling deployment is the default deployment strategy in Kubernetes. It replaces pods, one by one, of the previous version of our application with pods of the new version without any cluster downtime. A rolling deployment slowly replaces instances of the previous version of an application with instances of the new version of the application.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/LxDl5amQZC2znii0JLZuw/87f42c35b5ba35ac1550f572d23ba943/01_rolling-deployment.jpg" alt="Alt text"/></p><p>When using the RollingUpdate strategy, there are two more options that let us fine-tune the update process:</p><ol start="1"><li><p><strong>maxSurge</strong>: 
The number of pods that can be created above the desired amount of pods during an update. This can be an absolute number or percentage of the replicas count. The default is 25%.</p></li><li><p><strong>maxUnavailable</strong>: 
The number of pods that can be unavailable during the update process. This can be an absolute number or a percentage of the replicas count; the default is 25%.</p></li></ol><p>First, we create our <em>rollingupdate.yaml</em> deployment template. In the template below, we set <em>maxSurge</em> to 2 and <em>maxUnavailable</em> to 1.</p><pre><code><span>apiVersion</span><span>:</span> apps/v1
<span>kind</span><span>:</span> Deployment
<span>metadata</span><span>:</span>
  <span>name</span><span>:</span> rollingupdate<span>-</span>strategy
  <span>version</span><span>:</span> nanoserver<span>-</span><span>1709</span>
<span>spec</span><span>:</span>
  <span>strategy</span><span>:</span>
    <span>type</span><span>:</span> RollingUpdate
    <span>rollingUpdate</span><span>:</span>
      <span>maxSurge</span><span>:</span> <span>2</span>
      <span>maxUnavailable</span><span>:</span> <span>1</span>
  <span>selector</span><span>:</span>
    <span>matchLabels</span><span>:</span>
      <span>app</span><span>:</span> web<span>-</span>app<span>-</span>rollingupdate<span>-</span>strategy
      <span>version</span><span>:</span> nanoserver<span>-</span><span>1709</span>
  <span>replicas</span><span>:</span> <span>3</span>
  <span>template</span><span>:</span>
    <span>metadata</span><span>:</span>
      <span>labels</span><span>:</span>
        <span>app</span><span>:</span> web<span>-</span>app<span>-</span>rollingupdate<span>-</span>strategy
        <span>version</span><span>:</span> nanoserver<span>-</span><span>1709</span>
    <span>spec</span><span>:</span>
      <span>containers</span><span>:</span>
        <span>-</span> <span>name</span><span>:</span> web<span>-</span>app<span>-</span>rollingupdate<span>-</span>strategy
          <span>image</span><span>:</span> hello<span>-</span>world<span>:</span>nanoserver<span>-</span><span>1709</span></code></pre><p>We can then create the deployment using the kubectl command.</p><pre><code>$ kubectl apply <span>-</span>f rollingupdate<span>.</span>yaml</code></pre><p>Once we have a deployment template, we can provide a way to access the instances of the deployment by creating a Service. Note that we are deploying the image <em>hello-world</em> with version <em>nanoserver-1709</em>. So in this case we have two labels, &#39;name= <em>web-app-rollingupdate-strategy</em>&#39; and &#39;version=<em>nanoserver-1709</em>&#39;. We will set these as the label selector for the service below. Save this to &#39;<em>service.yaml</em>&#39; file.</p><pre><code><span>apiVersion</span><span>:</span> v1
<span>kind</span><span>:</span> Service
<span>metadata</span><span>:</span> 
  <span>name</span><span>:</span> web<span>-</span>app<span>-</span>rollingupdate<span>-</span>strategy
  <span>labels</span><span>:</span> 
    <span>name</span><span>:</span> web<span>-</span>app<span>-</span>rollingupdate<span>-</span>strategy
    <span>version</span><span>:</span> nanoserver<span>-</span><span>1709</span>
<span>spec</span><span>:</span>
  <span>ports</span><span>:</span>
    <span>-</span> <span>name</span><span>:</span> http
      <span>port</span><span>:</span> <span>80</span>
      <span>targetPort</span><span>:</span> <span>80</span>
  <span>selector</span><span>:</span> 
    <span>name</span><span>:</span> web<span>-</span>app<span>-</span>rollingupdate<span>-</span>strategy
    <span>version</span><span>:</span> nanoserver<span>-</span><span>1709</span>
  <span>type</span><span>:</span> LoadBalancer</code></pre><p>Now creating the service will create a load balancer that is accessible outside the cluster.</p><pre><code>$ kubectl apply <span>-</span>f service<span>.</span>yaml</code></pre><p>Run <em>kubectl get deployments</em> to check if the Deployment is created. If the Deployment is still being created, the output should be similar to the following:</p><pre><code>$ kubectl <span>get</span> deployments

<span>NAME</span>                             <span>READY</span>   <span>UP</span><span>-</span><span>TO</span><span>-</span><span>DATE</span>   <span>AVAILABLE</span>   <span>AGE</span>
rollingupdate<span>-</span>strategy   <span>0</span><span>/</span><span>3</span>     <span>0</span>            <span>0</span>           <span>1</span>s</code></pre><p>If we run the <em>kubectl get deployments</em> again a few seconds later. The output should be similar to this:</p><pre><code>$ kubectl <span>get</span> deployments

<span>NAME</span>                             <span>READY</span>   <span>UP</span><span>-</span><span>TO</span><span>-</span><span>DATE</span>   <span>AVAILABLE</span>   <span>AGE</span>
rollingupdate<span>-</span>strategy   <span>3</span><span>/</span><span>3</span>     <span>0</span>            <span>0</span>           <span>7</span>s</code></pre><p>To see the ReplicaSet (rs) created by the Deployment, run <em>kubectl get rs</em>. The output should be similar to this:</p><pre><code>$ kubectl <span>get</span> rs

<span>NAME</span>                                    <span>DESIRED</span>   <span>CURRENT</span>   <span>READY</span>   <span>AGE</span>
rollingupdate<span>-</span>strategy<span>-</span><span>87875</span>f5897   <span>3</span>         <span>3</span>         <span>3</span>       <span>18</span>s</code></pre><p>To see the 3 pods running for deployment, run <em>kubectl get pods</em>. The created ReplicaSet ensures that there are three Pods running. The output should be similar to the below.</p><pre><code>$ kubectl <span>get</span> pods

<span>NAME</span>                                      <span>READY</span>     <span>STATUS</span>    <span>RESTARTS</span>   <span>AGE</span>       
rollingupdate<span>-</span>strategy<span>-</span><span>87875</span>f5897<span>-</span><span>55</span>i7o   <span>1</span><span>/</span><span>1</span>       Running   <span>0</span>          <span>12</span>s       
rollingupdate<span>-</span>strategy<span>-</span><span>87875</span>f5897<span>-</span>abszs   <span>1</span><span>/</span><span>1</span>       Running   <span>0</span>          <span>12</span>s       
rollingupdate<span>-</span>strategy<span>-</span><span>87875</span>f5897<span>-</span>qazrt   <span>1</span><span>/</span><span>1</span>       Running   <span>0</span>          <span>12</span>s</code></pre><p>Let&#39;s update the <em>rollingupdate.yaml</em> deployment template to use the <em>hello-world:nanoserver-1809</em> image instead of the <em>hello-world:nanoserver-1709</em> image. Then update the image of the existing running deployment using the kubectl command.</p><pre><code>$ kubectl <span>set</span> image deployment<span>/</span>rollingupdate<span>-</span>strategy web<span>-</span>app<span>-</span>rollingupdate<span>-</span>strategy<span>=</span>hello<span>-</span>world<span>:</span>nanoserver<span>-</span><span>1809</span> <span>--</span>record</code></pre><p>The output is similar to the below.</p><pre><code>deployment<span>.</span>apps<span>/</span>rollingupdate<span>-</span>strategy image updated</code></pre><p>We are now deploying the image <em>hello-world</em> with version <em>nanoserver-1809</em>. So, in this case, we will have to update the labels in the &#39;<em>service.yaml</em>&#39;. The label will be updated to &#39;version=<em>nanoserver-1809</em>&#39;. We will run the below kubectl command again to update the service so that it can pick new pods running on the newer image.</p><pre><code>$ kubectl apply <span>-</span>f service<span>.</span>yaml</code></pre><p>To see the rollout status run the kubectl command below.</p><pre><code>$ kubectl rollout status deployment<span>/</span>rollingupdate<span>-</span>strategy

Waiting <span>for</span> rollout to finish<span>:</span> <span>2</span> out <span>of</span> <span>3</span> <span>new</span> <span>replicas</span> have been updated<span>...</span></code></pre><p>Run again to verify the rollout is successful.</p><pre><code>$ kubectl rollout status deployment<span>/</span>rollingupdate<span>-</span>strategy

deployment <span>&#34;rollingupdate-strategy&#34;</span> successfully rolled out</code></pre><p>After the rollout is successful, we can view the Deployment by running the command <em>kubectl get deployments</em>. The output is similar to this:</p><pre><code>$ kubectl <span>get</span> deployments

<span>NAME</span>                             <span>READY</span>   <span>UP</span><span>-</span><span>TO</span><span>-</span><span>DATE</span>   <span>AVAILABLE</span>   <span>AGE</span>
rollingupdate<span>-</span>strategy   <span>3</span><span>/</span><span>3</span>     <span>0</span>            <span>0</span>           <span>7</span>s</code></pre><p>Run <em>kubectl get rs</em> to see that the Deployment is updated. The new Pods are created in a new ReplicaSet and are scaled up to 3 replicas. The old ReplicaSet is scaled down to 0 replicas.</p><pre><code>$ kubectl <span>get</span> rs

<span>NAME</span>                                    <span>DESIRED</span>   <span>CURRENT</span>   <span>READY</span>   <span>AGE</span>
rollingupdate<span>-</span>strategy<span>-</span><span>87875</span>f5897   <span>3</span>         <span>3</span>         <span>3</span>       <span>55</span>s
rollingupdate<span>-</span>strategy<span>-</span><span>89999</span>f7895   <span>0</span>         <span>0</span>         <span>0</span>       <span>12</span>s</code></pre><p>Run <em>kubectl get pods</em> it should now show only the new Pods in the new ReplicaSet.</p><pre><code>$ kubectl <span>get</span> pods

<span>NAME</span>                                      <span>READY</span>     <span>STATUS</span>    <span>RESTARTS</span>   <span>AGE</span>       
rollingupdate<span>-</span>strategy<span>-</span><span>89999</span>f7895<span>-</span><span>55</span>i7o   <span>1</span><span>/</span><span>1</span>       Running   <span>0</span>          <span>12</span>s       
rollingupdate<span>-</span>strategy<span>-</span><span>89999</span>f7895<span>-</span>abszs   <span>1</span><span>/</span><span>1</span>       Running   <span>0</span>          <span>12</span>s       
rollingupdate<span>-</span>strategy<span>-</span><span>89999</span>f7895<span>-</span>qazrt   <span>1</span><span>/</span><span>1</span>       Running   <span>0</span>          <span>12</span>s</code></pre><p>The kubectl&#39;s rollout command is very useful here. We can use it to check how our deployment is doing. The command, by default, waits until all of the Pods in the deployment have been started successfully. When the deployment succeeds, the command exits with return code zero to indicate success. If the deployment fails, the command exits with a non-zero code.</p><pre><code>$ kubectl rollout status deployment rollingupdate<span>-</span>strategy

Waiting <span>for</span> deployment <span>&#34;rollingupdate-strategy&#34;</span> rollout to finish<span>:</span> <span>0</span> <span>of</span> <span>3</span> updated replicas are available‚Ä¶
Waiting <span>for</span> deployment <span>&#34;rollingupdate-strategy&#34;</span> rollout to finish<span>:</span> <span>1</span> <span>of</span> <span>3</span> updated replicas are available‚Ä¶
Waiting <span>for</span> deployment <span>&#34;rollingupdate-strategy&#34;</span> rollout to finish<span>:</span> <span>2</span> <span>of</span> <span>3</span> updated replicas are available‚Ä¶

deployment <span>&#34;rollingupdate-strategy&#34;</span> successfully rolled out</code></pre><p>If the deployment fails in Kubernetes, the deployment process stops, but the pods from the failed deployment are kept around. On deployment failure, our environment may contain pods from both the old and new deployments. To get back to a stable, working state, we can use the rollout undo command to bring back the working pods and clean up the failed deployment.</p><pre><code>$ kubectl rollout undo deployment rollingupdate<span>-</span>strategy

deployment<span>.</span>extensions<span>/</span>rollingupdate<span>-</span>strategy</code></pre><p>Then we will verify the status of the deployment again.</p><pre><code>$ kubectl rollout status deployment rollingupdate<span>-</span>strategy

deployment <span>&#34;rollingupdate-strategy&#34;</span> successfully rolled out</code></pre><p>In order for Kubernetes to know when an application is ready, it needs some help from the application. Kubernetes uses readiness probes to examine how the application is doing. Once an application instance starts responding to the readiness probe with a positive response, the instance is considered ready for use. Readiness probes tell Kubernetes when an application is ready, but not if the application will ever become ready. If the application keeps failing, it may never respond with a positive response to Kubernetes. </p><p>A rolling deployment typically waits for new pods to become ready via a readiness check before scaling down the old components. If a significant issue occurs, the rolling deployment can be aborted. If there is a problem, the rolling update or deployment can be aborted without bringing the whole cluster down.</p><h3 id="Recreate-Deployment">Recreate Deployment</h3><p>In recreate deployment, we fully scale down the existing application version before we scale up the new application version. In the below diagram, Version 1 represents the current application version, and Version 2 represents the new application version. When updating the current application version, we first scale down the existing replicas of Version 1 to zero and then concurrently deploy replicas with the new version.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1FVQm06ERSn67QJkI2zlfj/49ef78e46445aa7e6a7e54349e85e2b7/02_recreate-deployment.jpg" alt="Alt text"/></p><p>The below template shows deployment using the recreate strategy: First, we create our <em>recreate</em> deployment by saving the following yaml to a file recreate.yaml</p><pre><code><span>apiVersion</span><span>:</span> apps/v1
<span>kind</span><span>:</span> Deployment
<span>metadata</span><span>:</span>
  <span>name</span><span>:</span> recreate<span>-</span>strategy
<span>spec</span><span>:</span>
  <span>strategy</span><span>:</span>
    <span>type</span><span>:</span> Recreate
  <span>selector</span><span>:</span>
    <span>matchLabels</span><span>:</span>
      <span>app</span><span>:</span> web<span>-</span>app<span>-</span>recreate<span>-</span>strategy
      <span>version</span><span>:</span> nanoserver<span>-</span><span>1809</span>
  <span>replicas</span><span>:</span> <span>3</span>
  <span>template</span><span>:</span>
    <span>metadata</span><span>:</span>
      <span>labels</span><span>:</span>
        <span>app</span><span>:</span> web<span>-</span>app<span>-</span>recreate<span>-</span>strategy
    <span>spec</span><span>:</span>
      <span>containers</span><span>:</span>
        <span>-</span> <span>name</span><span>:</span> web<span>-</span>app<span>-</span>recreate<span>-</span>strategy
          <span>image</span><span>:</span> hello<span>-</span>world<span>:</span>nanoserver<span>-</span><span>1809</span></code></pre><p>We can then create the deployment using the kubectl command.</p><pre><code>$ kubectl apply <span>-</span>f recreate<span>.</span>yaml</code></pre><p>Once we have a deployment template, we can provide a way to access the instances of the deployment by creating a Service. Note that we are deploying the image <em>hello-world</em> with version <em>nanoserver-1809</em>. So in this case we have two labels, &#39;name= <em>web-app-recreate-strategy</em>&#39; and &#39;version=<em>nanoserver-1809</em>&#39;. We will set these as the label selector for the service below. Save this to <em>service.yaml</em> file.</p><pre><code><span>apiVersion</span><span>:</span> v1
<span>kind</span><span>:</span> Service
<span>metadata</span><span>:</span> 
  <span>name</span><span>:</span> web<span>-</span>app<span>-</span>recreate<span>-</span>strategy
  <span>labels</span><span>:</span> 
    <span>name</span><span>:</span> web<span>-</span>app<span>-</span>recreate<span>-</span>strategy
    <span>version</span><span>:</span> nanoserver<span>-</span><span>1809</span>
<span>spec</span><span>:</span>
  <span>ports</span><span>:</span>
    <span>-</span> <span>name</span><span>:</span> http
      <span>port</span><span>:</span> <span>80</span>
      <span>targetPort</span><span>:</span> <span>80</span>
  <span>selector</span><span>:</span> 
    <span>name</span><span>:</span> web<span>-</span>app<span>-</span>recreate<span>-</span>strategy
    <span>version</span><span>:</span> nanoserver<span>-</span><span>1809</span>
  <span>type</span><span>:</span> LoadBalancer</code></pre><p>Now creating the service will create a load balancer that is accessible outside the cluster.</p><pre><code>$ kubectl apply <span>-</span>f service<span>.</span>yaml</code></pre><p>The recreate method involves some downtime during the update process. Downtime is not an issue for applications that can handle maintenance windows or outages. However, if there is a mission-critical application with high service level agreements (SLAs) and availability requirements, choosing a different deployment strategy would be the right approach. Recreate deployment is generally used in the development stage by the developers as it is easy to set up, and the application state is entirely renewed with the new version. What&#39;s more, we don&#39;t have to manage more than one application version in parallel, and therefore we avoid backward compatibility challenges for data and applications. </p><h3 id="Blue-Green-Deployment">Blue-Green Deployment</h3><p>In a blue/green deployment strategy (sometimes also referred to as red/black), the blue represents the current application version, and green represents the new application version. In this, only one version is live at a time. Traffic is routed to the blue deployment while the green deployment is created and tested. After we are finished testing, we then route traffic to the new version.</p><p>After the deployment succeeds, we can either keep the blue deployment for a possible rollback or decommission it. Alternatively, it is possible to deploy a newer version of the application on these instances. In that case, the current (blue) environment serves as the staging area for the next release.</p><p>This technique can eliminate downtime as we faced in the recreate deployment strategy. In addition, blue-green deployment reduces risk: if something unexpected happens with our new version on Green, we can immediately roll back to the last version by switching back to Blue. There is instant rollout/rollback. We can also avoid versioning issues; the entire application state is changed in one deployment.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/5vHYgyomFFI2h4okBQyUTH/98d685900acef7c6c1abdea444b947e1/03_blue-green.jpg" alt="Alt text"/></p><p>The Blue-Green deployment is expensive as it requires double the resources. A proper test of the entire platform should be done before releasing it to production. Moreover, handling stateful applications is hard.</p><p>First, we create our <em>blue</em> deployment by saving the following yaml to a &#39;blue.yaml&#39; file:</p><pre><code><span>apiVersion</span><span>:</span> apps/v1
<span>kind</span><span>:</span> Deployment
<span>metadata</span><span>:</span>
  <span>name</span><span>:</span> blue<span>-</span>deployment
<span>spec</span><span>:</span>
  <span>selector</span><span>:</span>
    <span>matchLabels</span><span>:</span>
      <span>app</span><span>:</span> blue<span>-</span>deployment
      <span>version</span><span>:</span> nanoserver<span>-</span><span>1709</span>
  <span>replicas</span><span>:</span> <span>3</span>
  <span>template</span><span>:</span>
    <span>metadata</span><span>:</span>
      <span>labels</span><span>:</span>
        <span>app</span><span>:</span> blue<span>-</span>deployment
        <span>version</span><span>:</span> nanoserver<span>-</span><span>1709</span>
    <span>spec</span><span>:</span>
      <span>containers</span><span>:</span>
        <span>-</span> <span>name</span><span>:</span> blue<span>-</span>deployment
          <span>image</span><span>:</span> hello<span>-</span>world<span>:</span>nanoserver<span>-</span><span>1709</span></code></pre><p>We can then create the deployment using the kubectl command.</p><pre><code>$ kubectl apply <span>-</span>f blue<span>.</span>yaml</code></pre><p>Once we have a deployment template, we can provide a way to access the instances of the deployment by creating a Service. Note that we are deploying the image <em>hello-world</em> with version <em>nanoserver-1809</em>. So in this case we have two labels, &#39;name= <em>blue-deployment</em>&#39; and &#39;version=<em>nanoserver-1709</em>&#39;. We will set these as the label selector for the service below. Save this to <em>service.yaml</em> file.</p><pre><code><span>apiVersion</span><span>:</span> v1
<span>kind</span><span>:</span> Service
<span>metadata</span><span>:</span> 
  <span>name</span><span>:</span> blue<span>-</span>green<span>-</span>service
  <span>labels</span><span>:</span> 
    <span>name</span><span>:</span> blue<span>-</span>deployment
    <span>version</span><span>:</span> nanoserver<span>-</span><span>1709</span>
<span>spec</span><span>:</span>
  <span>ports</span><span>:</span>
    <span>-</span> <span>name</span><span>:</span> http
      <span>port</span><span>:</span> <span>80</span>
      <span>targetPort</span><span>:</span> <span>80</span>
  <span>selector</span><span>:</span> 
    <span>name</span><span>:</span> blue<span>-</span>deployment
    <span>version</span><span>:</span> nanoserver<span>-</span><span>1709</span>
  <span>type</span><span>:</span> LoadBalancer</code></pre><p>Now creating the service will create a load balancer that is accessible outside the cluster.</p><pre><code>$ kubectl apply <span>-</span>f service<span>.</span>yaml</code></pre><p>We now have the below setup in place.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/2mRPpKDjZb7W9UPlmh0dlF/eec0754c5c458b9017bda1ca7c863bc9/04_blue.jpg" alt="Alt text"/></p><p>For the <em>green</em> deployment we will deploy a new deployment in parallel with the <em>blue</em> deployment. The below template is a content of the <code>green<span>.</span>yaml</code> file:</p><pre><code><span>apiVersion</span><span>:</span> apps/v1
<span>kind</span><span>:</span> Deployment
<span>metadata</span><span>:</span>
  <span>name</span><span>:</span> green<span>-</span>deployment
<span>spec</span><span>:</span>
  <span>selector</span><span>:</span>
    <span>matchLabels</span><span>:</span>
      <span>app</span><span>:</span> green<span>-</span>deployment
      <span>version</span><span>:</span> nanoserver<span>-</span><span>1809</span>
  <span>replicas</span><span>:</span> <span>3</span>
  <span>template</span><span>:</span>
    <span>metadata</span><span>:</span>
      <span>labels</span><span>:</span>
        <span>app</span><span>:</span> green<span>-</span>deployment
        <span>version</span><span>:</span> nanoserver<span>-</span><span>1809</span>
    <span>spec</span><span>:</span>
      <span>containers</span><span>:</span>
        <span>-</span> <span>name</span><span>:</span> green<span>-</span>deployment
          <span>image</span><span>:</span> hello<span>-</span>world<span>:</span>nanoserver<span>-</span><span>1809</span></code></pre><p>Note that image <em>hello-world:nanoserver-1809</em> tag-name has changed to 2. So we have made a separate deployment with two labels, name= <em>green-deployment</em> and version=<em>nanoserver-1809</em>.</p><pre><code>$ kubectl apply <span>-</span>f green<span>.</span>yaml</code></pre><p>To cut over to the <em>green</em> deployment, we will update the selector for the existing service. Edit the service.yaml and change the selector version to <em>2</em> and name to <em>green-deployemnt</em>. That will make it so that it matches the pods on the <em>green</em>&#34; deployment.</p><pre><code><span>apiVersion</span><span>:</span> v1
<span>kind</span><span>:</span> Service
<span>metadata</span><span>:</span> 
  <span>name</span><span>:</span> blue<span>-</span>green<span>-</span>service
  <span>labels</span><span>:</span> 
    <span>name</span><span>:</span> green<span>-</span>deployment
    <span>version</span><span>:</span> nanoserver<span>-</span><span>1809</span>
<span>spec</span><span>:</span>
  <span>ports</span><span>:</span>
    <span>-</span> <span>name</span><span>:</span> http
      <span>port</span><span>:</span> <span>80</span>
      <span>targetPort</span><span>:</span> <span>80</span>
  <span>selector</span><span>:</span> 
    <span>name</span><span>:</span> green<span>-</span>deployment
    <span>version</span><span>:</span> nanoserver<span>-</span><span>1809</span>
  <span>type</span><span>:</span> LoadBalancer</code></pre><p>We create the service  again using the kubectl command:</p><pre><code>$ kubectl apply <span>-</span>f service<span>.</span>yaml</code></pre><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3vxIwBo5DZHGWoELo2khCL/aa6a898dcbc97234cc29f6bac6f31c52/05_green.jpg" alt="Alt text"/></p><p>Hence concluding, we can see the blue-green deployment is all-or-nothing, unlike a rolling update deployment, where we aren&#39;t able to gradually roll out the new version. All users will receive the update at the same time, although existing sessions will be allowed to finish their work on the old instances. Hence the stakes are a bit higher than everything should work once we initiate the change. It also requires allocating more server resources since we will need to run two copies of every pod.</p><p>Fortunately, the rollback procedure is just as easy: We simply have to flip the switch again, and the previous version is swapped back into place. That&#39;s because the old version is still running on the old pods. It is simply that traffic is no longer being routed to them. When we are confident that the new version is here to stay, we should decommission those pods.</p><h3 id="Canary-Deployment">Canary Deployment</h3><p>The canary update strategy is a partial update process that allows us to test our new program version on a real user base without a commitment to a full rollout. Similar to blue/green deployments, but they are more controlled, and they use a more progressive delivery where deployment is in a phased approach. There are a number of strategies that fall under the umbrella of canary, including dark launches or A/B testing.</p><p>In canary deployment, the new version of the application is gradually deployed to the Kubernetes cluster while getting a very small amount of live traffic (i.e., a subset of live users are connecting to the new version while the rest are still using the previous version).In this approach, we have two almost identical servers: one that goes to all the current active users and another with the new features that gets rolled out to a subset of users and then compared. When no errors are reported and the confidence increases, the new version can gradually roll out to the rest of the infrastructure. In the end, all live traffic goes to canaries, making the canary version the new <em>production version</em>.</p><p>The below picture shows the most straightforward and simple way to do a canary deployment. A new version is deployed to a subset of servers.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4thRldlIQuLdnmwSjEcmIq/85ed566fcaa6038e74de978112a79df0/06_canary-deployment-1.jpg" alt="Alt text"/></p><p>While this happens, we watch how the upgraded machines are doing. We check for errors and performance problems, and we listen for user feedback. As we grow confident in the canary, we continue installing it on the rest of the machines until they are all running the latest release.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4dsHDsWT30QXUL17T0uphC/5048ee861491e78ae2baa43682446a83/07_canary-deployment-2.png" alt="Alt text"/></p><p>We have to take into account various things when planning a canary deployment:</p><ol start="1"><li><strong>Stages</strong>: how many users will we send to the canary at first, and in how many stages.</li><li><strong>Duration</strong>: how long will we plan to run the canary? Canary releases are different, as we must wait for enough clients to be updated before we can assess the results. This can happen over several days or even weeks.</li><li><strong>Metrics</strong>: what are the metrics to record to analyze progress, including application performance and error reports? Well-chosen parameters are essential for a successful canary deployment. For instance, a very simple way to measure deployment is through HTTP status codes. We can have a simple ping service that returns 200 when the deployment is successful. It will return server end error (5xx) if there is an issue in the deployment.</li><li><strong>Evaluation</strong>: what criteria will we use to determine if the canary is successful</li></ol><p>A canary is used in scenarios where we have to test a new functionality typically on the backend of our application. Canary deployment should be used when we are not 100% confident in the new version; we predict we might have a low chance of failure. This strategy is usually used when we have a major update, like adding a new functionality or experimental feature.</p><h2 id="Summary-K8s-Deployments-Strategies">Summary K8s Deployments Strategies</h2><p>To sum up, there are different ways to deploy an application; when releasing to development/staging environments, a recreate or ramped deployment is usually a good choice. When it comes to production, a ramped or blue/green deployment is usually a good fit, but proper testing of the new platform is necessary. If we are not confident with the stability of the platform and what could be the impact of releasing a new software version, then a canary release should be the way to go. By doing so, we let the consumer test the application and its integration into the platform. In this article, we have only scratched the surface of the capabilities of Kubernetes deployments. By combining deployments with all the other Kubernetes features, users can create more robust containerized applications to suit any need.</p></div></div>]]></content:encoded>
      <pubDate>Fri, 06 Aug 2021 14:59:00 +0000</pubDate>
    </item>
    <item>
      <title>Spring Cloud Messaging With AWS and LocalStack</title>
      <link>https://auth0.com/blog/spring-cloud-messaging-with-aws-and-localstack/</link>
      <description>Learn how to simulate AWS services locally using LocalStack with a Spring Boot application.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p><strong>TL;DR:</strong> This article demonstrates the use of LocalStack and how it can simulate many of the AWS services locally. We will use Spring Cloud Messaging to create a publisher-subscriber sample application. We will use Amazon SNS and SQS to do that.</p><p>The sample app can be found <a href="https://github.com/maniish-jaiin/spring-cloud-messaging-sample" target="_blank" rel="noreferrer noopener">here</a>.</p><h2 id="Spring-Cloud-Messaging-With-AWS-and-LocalStack">Spring Cloud Messaging With AWS and LocalStack</h2><h3 id="Introduction">Introduction</h3><p>With an ever-growing demand for cloud services, Spring provides amazing support to integrate with Cloud providers and relevant services. <a href="https://spring.io/projects/spring-cloud-aws" target="_blank" rel="noreferrer noopener">Spring Cloud for Amazon Web Services</a> is one such project that makes it easy to integrate with AWS services using familiar Spring APIs.</p><p>In this article, we will look into a simple application that acts as a message producer and a consumer using Amazon SNS and SQS. On top of that, we will not create an AWS account or use AWS services directly from AWS. We will instead use LocalStack, which will allow us to create AWS resources locally.</p><p>The sample app can be found <a href="https://github.com/maniish-jaiin/spring-cloud-messaging-sample" target="_blank" rel="noreferrer noopener">here</a>.</p><h3 id="Pre-requisites-">Pre-requisites:</h3><ol start="1"><li>Basic knowledge of AWS, <a href="https://github.com/aws/aws-cli" target="_blank" rel="noreferrer noopener">AWS CLI</a>, and related services like Amazon SQS.</li><li>Basic knowledge of <a href="https://docs.oracle.com/en/java/javase/11/docs/api/index.html" target="_blank" rel="noreferrer noopener">Java 11</a> and Spring Boot <code><span>2.4</span><span>.7</span></code>.</li><li><a href="https://docs.docker.com/get-docker/" target="_blank" rel="noreferrer noopener">Docker</a> and <a href="https://docs.docker.com/compose/install/" target="_blank" rel="noreferrer noopener">Docker Compose</a> for the setup.</li></ol><h2 id="Introduction-to-Amazon-SNS-and-SQS">Introduction to Amazon SNS and SQS</h2><h3 id="Amazon-SNS">Amazon SNS</h3><p><a href="https://aws.amazon.com/sns/" target="_blank" rel="noreferrer noopener">Amazon SNS</a> is an acronym for Simple Notification Service. It provides developers with the highly scalable, cost-effective, and flexible capability to publish messages from an application and send them to other applications. It follows the pub-sub architecture to deliver messages from publishers to the subscribers. It is a highly decoupled service that can be linked to a variety of sources. It can be used to publish emails, messages to SQS, SMS, etc.</p><p>The Publisher (e.g., CloudWatch Alarm, S3 events, SNS, Micro-service) publishes the message on a Topic which is then published to all the Subscribers (web servers, email addresses, Amazon SQS queues, AWS Lambda)  of that particular topic.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/35P87aEWHIcpTOQxYTGWbz/03840ff6c13fdc4a94552ec8188c131e/sns_architecture.jpg" alt="SNS Architecture"/></p><h3 id="Amazon-SQS">Amazon SQS</h3><p><a href="https://aws.amazon.com/sqs/" target="_blank" rel="noreferrer noopener">Amazon SQS</a> is an acronym for Simple Queue Service, and the names convey a lot as it is really simple to use as it is a fully managed service from AWS. It follows similar messaging semantics of the producer putting a message on the queue and consumer reading from it.</p><p>Once consumed, the message has to be deleted from the queue. Deleting is important because SQS assumes that processing can fail. To prevent that, after the consumer receives a message, it is hidden from the queue for a defined period of time, and after that, if it is not deleted, the message shows up in the queue again.</p><p>Both SNS and SQS are fully managed lightweight, easy-to-use APIs. You can use Amazon SQS and SNS to decouple and scale microservices, distributed systems, and serverless applications and improve reliability.</p><h3 id="Introduction-to-LocalStack">Introduction to LocalStack</h3><p><a href="https://github.com/localstack/localstack" target="_blank" rel="noreferrer noopener">LocalStack</a> is an open-source mock of the real AWS services. It provides a testing environment on our local machine with the same APIs as the real AWS services. We switch to using the real AWS services only in the integration environment and beyond. There are plenty of reasons to use LocalStack, few out of which are more important than others, such as:</p><ol start="1"><li>The ability to play with AWS services without interacting with AWS. All developers love to get their hands dirty, and what better way to learn something than to try. Localstack allows you to play with S3, SQS, DynamoDB, SNS, and the list goes on.</li><li>The ability to test the applications in the local dev environment. You can write integration tests for your application using LocalStack, driving down your costs and increasing the confidence in your code.</li></ol><h3 id="Spring-Cloud-Messaging-app-linked-to-LocalStack">Spring Cloud Messaging app linked to LocalStack</h3><p>Spring Cloud AWS provides <a href="https://aws.amazon.com/sqs/" target="_blank" rel="noreferrer noopener">Amazon SQS</a> and <a href="https://aws.amazon.com/sns/" target="_blank" rel="noreferrer noopener">Amazon SNS</a> integration that simplifies the publication and consumption of messages. It reduces a lot of boilerplate code and does the heavy lifting for configuring and SNS and SQS. Let&#39;s set up a Spring boot project with support for SNS and SQS.</p><h4 id="Setting-up-Spring-Boot-app">Setting up Spring Boot app</h4><p>Let us first create a Spring Boot project with the help of the <a href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=2.4.5.RELEASE&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=io.pratik&amp;artifactId=springcloudsqs&amp;name=springcloudsqs&amp;description=Demo%20project%20for%20Spring%20cloud%20sqs&amp;packageName=io.pratik.springcloudsqs&amp;dependencies=web,lombok" target="_blank" rel="noreferrer noopener">Spring boot Initializr</a>, and then open the project in our favorite IDE. Select Maven project and Java language. Last but not least, select Spring boot version <code><span>2.4</span><span>.7</span></code>. Fill in the project metadata and click generate.</p><p>For Spring Cloud, We need to configure Spring Cloud AWS BOM in our <code>pom<span>.</span>xml</code> file using this dependencyManagement block:</p><pre><code><span><span><span>&lt;</span>dependencyManagement</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>dependencies</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>io.awspring.cloud<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>spring-cloud-aws-dependencies<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>version</span><span>&gt;</span></span>2.3.1<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>type</span><span>&gt;</span></span>pom<span><span><span>&lt;/</span>type</span><span>&gt;</span></span>
            <span><span><span>&lt;</span>scope</span><span>&gt;</span></span>import<span><span><span>&lt;/</span>scope</span><span>&gt;</span></span>
        <span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>dependencies</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>dependencyManagement</span><span>&gt;</span></span></code></pre><p>For adding the support for messaging, we need to include the module dependency for Spring Cloud AWS Messaging into our Maven configuration. We do this by adding the starter module <code>spring<span>-</span>cloud<span>-</span>starter<span>-</span>aws<span>-</span>messaging</code>:</p><pre><code><span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>io.awspring.cloud<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>spring-cloud-starter-aws-messaging<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span></code></pre><p>These are the dependencies required for Spring Cloud AWS. Next, we add some other dependencies such as Spring boot starter web and <a href="https://projectlombok.org/" target="_blank" rel="noreferrer noopener">Lombok</a>.</p><pre><code><span><span><span>&lt;</span>dependencies</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.springframework.boot<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>spring-boot-starter-web<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>version</span><span>&gt;</span></span>2.4.7<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span>
    <span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.projectlombok<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>lombok<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>version</span><span>&gt;</span></span>1.18.20<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
        <span><span><span>&lt;</span>scope</span><span>&gt;</span></span>provided<span><span><span>&lt;/</span>scope</span><span>&gt;</span></span>
    <span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>dependencies</span><span>&gt;</span></span></code></pre><p>This completes our setup process for the Spring boot project.</p><p>Let&#39;s jump into adding the SNS and SQS configs and start publishing our first message.</p><p>Amazon SNS Config:</p><pre><code><span>import</span> <span>com<span>.</span>amazonaws<span>.</span>auth<span>.</span></span><span>AWSStaticCredentialsProvider</span><span>;</span>
<span>import</span> <span>com<span>.</span>amazonaws<span>.</span>auth<span>.</span></span><span>BasicAWSCredentials</span><span>;</span>
<span>import</span> <span>com<span>.</span>amazonaws<span>.</span>client<span>.</span>builder<span>.</span></span><span>AwsClientBuilder</span><span>;</span>
<span>import</span> <span>com<span>.</span>amazonaws<span>.</span>services<span>.</span>sns<span>.</span></span><span>AmazonSNS</span><span>;</span>
<span>import</span> <span>com<span>.</span>amazonaws<span>.</span>services<span>.</span>sns<span>.</span></span><span>AmazonSNSClientBuilder</span><span>;</span>
<span>import</span> <span>io<span>.</span>awspring<span>.</span>cloud<span>.</span>messaging<span>.</span>core<span>.</span></span><span>NotificationMessagingTemplate</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Bean</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Configuration</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Primary</span><span>;</span>

<span>import</span> <span>static</span> <span>com<span>.</span>authga<span>.</span>springcloudaws<span>.</span>config<span>.</span></span><span>AWSConfigConstants</span><span>.</span>ACCESS_KEY<span>;</span>
<span>import</span> <span>static</span> <span>com<span>.</span>authga<span>.</span>springcloudaws<span>.</span>config<span>.</span></span><span>AWSConfigConstants</span><span>.</span>SECRET_KEY<span>;</span>

<span>@Configuration</span>
<span>public</span> <span>class</span> <span>SnsConfig</span> <span>{</span>

    <span>@Bean</span>
    <span>public</span> <span>NotificationMessagingTemplate</span> <span>notificationMessagingTemplate</span><span>(</span><span>AmazonSNS</span> amazonSNS<span>)</span> <span>{</span>
        <span>return</span> <span>new</span> <span>NotificationMessagingTemplate</span><span>(</span>amazonSNS<span>)</span><span>;</span>
    <span>}</span>

    <span>@Bean</span>
    <span>@Primary</span>
    <span>public</span> <span>AmazonSNS</span> <span>amazonSNS</span><span>(</span><span>final</span> <span>AwsClientBuilder<span>.</span>EndpointConfiguration</span> endpointConfiguration<span>)</span> <span>{</span>
        <span>BasicAWSCredentials</span> credentials <span>=</span> <span>new</span> <span>BasicAWSCredentials</span><span>(</span>ACCESS_KEY<span>,</span> SECRET_KEY<span>)</span><span>;</span>
        <span>return</span> <span>AmazonSNSClientBuilder</span>
                <span>.</span><span>standard</span><span>(</span><span>)</span>
                <span>.</span><span>withEndpointConfiguration</span><span>(</span>endpointConfiguration<span>)</span>
                <span>.</span><span>withCredentials</span><span>(</span><span>new</span> <span>AWSStaticCredentialsProvider</span><span>(</span>credentials<span>)</span><span>)</span>
                <span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>Here, we create a simple <code>AmazonSNSClient</code> with a custom endpoint and credentials. Spring has an auto-configured <code>AmazonSNSClient</code>, but that requires valid AWS credentials and actual resources. We instead want to run our service locally with AWS resources using LocalStack. More on this later. Let&#39;s finish this setup.</p><p>Amazon SQS Config:</p><pre><code><span>import</span> <span>com<span>.</span>amazonaws<span>.</span>auth<span>.</span></span><span>AWSStaticCredentialsProvider</span><span>;</span>
<span>import</span> <span>com<span>.</span>amazonaws<span>.</span>auth<span>.</span></span><span>BasicAWSCredentials</span><span>;</span>
<span>import</span> <span>com<span>.</span>amazonaws<span>.</span>client<span>.</span>builder<span>.</span></span><span>AwsClientBuilder</span><span>;</span>
<span>import</span> <span>com<span>.</span>amazonaws<span>.</span>services<span>.</span>sqs<span>.</span></span><span>AmazonSQSAsync</span><span>;</span>
<span>import</span> <span>com<span>.</span>amazonaws<span>.</span>services<span>.</span>sqs<span>.</span></span><span>AmazonSQSAsyncClientBuilder</span><span>;</span>
<span>import</span> <span>io<span>.</span>awspring<span>.</span>cloud<span>.</span>messaging<span>.</span>config<span>.</span></span><span>QueueMessageHandlerFactory</span><span>;</span>
<span>import</span> <span>io<span>.</span>awspring<span>.</span>cloud<span>.</span>messaging<span>.</span>support<span>.</span></span><span>NotificationMessageArgumentResolver</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Bean</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Configuration</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>context<span>.</span>annotation<span>.</span></span><span>Primary</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>messaging<span>.</span>converter<span>.</span></span><span>MappingJackson2MessageConverter</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>messaging<span>.</span>converter<span>.</span></span><span>MessageConverter</span><span>;</span>

<span>import</span> <span>java<span>.</span>util<span>.</span></span><span>List</span><span>;</span>

<span>import</span> <span>static</span> <span>com<span>.</span>authga<span>.</span>springcloudaws<span>.</span>config<span>.</span></span><span>AWSConfigConstants</span><span>.</span>*<span>;</span>

<span>@Configuration</span>
<span>public</span> <span>class</span> <span>SqsConfig</span> <span>{</span>

    <span>@Bean</span>
    <span>public</span> <span>AwsClientBuilder<span>.</span>EndpointConfiguration</span> <span>endpointConfiguration</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> <span>new</span> <span>AwsClientBuilder<span>.</span>EndpointConfiguration</span><span>(</span>ENDPOINT<span>,</span> EU_CENTRAL_1<span>)</span><span>;</span>
    <span>}</span>

    <span>@Bean</span>
    <span>@Primary</span>
    <span>public</span> <span>AmazonSQSAsync</span> <span>amazonSQSAsync</span><span>(</span><span>final</span> <span>AwsClientBuilder<span>.</span>EndpointConfiguration</span> endpointConfiguration<span>)</span> <span>{</span>
        <span>BasicAWSCredentials</span> credentials <span>=</span> <span>new</span> <span>BasicAWSCredentials</span><span>(</span>ACCESS_KEY<span>,</span> SECRET_KEY<span>)</span><span>;</span>
        <span>return</span> <span>AmazonSQSAsyncClientBuilder</span>
                <span>.</span><span>standard</span><span>(</span><span>)</span>
                <span>.</span><span>withEndpointConfiguration</span><span>(</span>endpointConfiguration<span>)</span>
                <span>.</span><span>withCredentials</span><span>(</span><span>new</span> <span>AWSStaticCredentialsProvider</span><span>(</span>credentials<span>)</span><span>)</span>
                <span>.</span><span>build</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>

    <span>@Bean</span>
    <span>public</span> <span>QueueMessageHandlerFactory</span> <span>queueMessageHandlerFactory</span><span>(</span><span>MessageConverter</span> messageConverter<span>)</span> <span>{</span>
        <span>var</span> factory <span>=</span> <span>new</span> <span>QueueMessageHandlerFactory</span><span>(</span><span>)</span><span>;</span>
        factory<span>.</span><span>setArgumentResolvers</span><span>(</span><span>List</span><span>.</span><span>of</span><span>(</span><span>new</span> <span>NotificationMessageArgumentResolver</span><span>(</span>messageConverter<span>)</span><span>)</span><span>)</span><span>;</span>
        <span>return</span> factory<span>;</span>
    <span>}</span>

    <span>@Bean</span>
    <span>protected</span> <span>MessageConverter</span> <span>messageConverter</span><span>(</span><span>)</span> <span>{</span>
        <span>var</span> converter <span>=</span> <span>new</span> <span>MappingJackson2MessageConverter</span><span>(</span><span>)</span><span>;</span>
        converter<span>.</span><span>setSerializedPayloadClass</span><span>(</span><span>String</span><span>.</span><span>class</span><span>)</span><span>;</span>
        converter<span>.</span><span>setStrictContentTypeMatch</span><span>(</span><span>false</span><span>)</span><span>;</span>
        <span>return</span> converter<span>;</span>
    <span>}</span>
<span>}</span></code></pre><p>In the code above, we did the following:</p><ul><li>Similar to the <code>AmazonSNSClient</code>, we create the <code>AmazonSQSClient</code> with a custom endpoint and credentials.</li><li>Setup <code>QueueMessageHandlerFactory</code> so it can convert incoming messages from SQS as String to the actual object we want, in this case, <code>Event</code>, using a <code>MessageConverter</code>.</li><li>The converter will take care of converting the <code>String</code> message to the actual <code>Event</code> object.</li></ul><p>The <code>Event</code> model is described below. I am using <a href="https://projectlombok.org/" target="_blank" rel="noreferrer noopener">Lombok</a> to reduce the boilerplate code.</p><p><code>Event<span>.</span>java</code></p><pre><code><span>import</span> <span>lombok<span>.</span></span><span>AllArgsConstructor</span><span>;</span>
<span>import</span> <span>lombok<span>.</span></span><span>Builder</span><span>;</span>
<span>import</span> <span>lombok<span>.</span></span><span>Data</span><span>;</span>
<span>import</span> <span>lombok<span>.</span></span><span>NoArgsConstructor</span><span>;</span>

<span>@Data</span>
<span>@AllArgsConstructor</span>
<span>@NoArgsConstructor</span>
<span>@Builder</span>
<span>public</span> <span>class</span> <span>Event</span> <span>implements</span> <span>Comparable</span><span><span>&lt;</span><span>Event</span><span>&gt;</span></span> <span>{</span>
    <span>private</span> <span>String</span> eventId<span>;</span>
    <span>private</span> <span>String</span> version<span>;</span>
    <span>private</span> <span>String</span> occurredAt<span>;</span>
    <span>private</span> <span>EventData</span> data<span>;</span>

    <span>@Override</span>
    <span>public</span> <span>int</span> <span>compareTo</span><span>(</span><span>Event</span> o<span>)</span> <span>{</span>
        <span>int</span> otherVersion <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span>o<span>.</span><span>getVersion</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>int</span> thisVersion <span>=</span> <span>Integer</span><span>.</span><span>parseInt</span><span>(</span><span>this</span><span>.</span><span>getVersion</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>return</span> <span>Integer</span><span>.</span><span>compare</span><span>(</span>thisVersion<span>,</span> otherVersion<span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><p><code>EventData<span>.</span>java</code></p><pre><code><span>import</span> <span>lombok<span>.</span></span><span>AllArgsConstructor</span><span>;</span>
<span>import</span> <span>lombok<span>.</span></span><span>Builder</span><span>;</span>
<span>import</span> <span>lombok<span>.</span></span><span>Data</span><span>;</span>
<span>import</span> <span>lombok<span>.</span></span><span>NoArgsConstructor</span><span>;</span>

<span>@Data</span>
<span>@AllArgsConstructor</span>
<span>@NoArgsConstructor</span>
<span>@Builder</span>
<span>public</span> <span>class</span> <span>EventData</span> <span>{</span>
    <span>private</span> <span>String</span> orderId<span>;</span>
    <span>private</span> <span>String</span> owner<span>;</span>
    <span>private</span> <span>EventType</span> eventType<span>;</span>
<span>}</span></code></pre><p><code>EventType<span>.</span>java</code></p><pre><code><span>import</span> <span>java<span>.</span>io<span>.</span></span><span>Serializable</span><span>;</span>

<span>public</span> <span>enum</span> <span>EventType</span> <span>implements</span> <span>Serializable</span> <span>{</span>
    ORDER_CREATED<span>,</span> ORDER_CANCELLED
<span>}</span></code></pre><p>Producer code:</p><pre><code><span>import</span> <span>com<span>.</span>authga<span>.</span>springcloudaws<span>.</span>model<span>.</span></span><span>Event</span><span>;</span>
<span>import</span> <span>io<span>.</span>awspring<span>.</span>cloud<span>.</span>messaging<span>.</span>core<span>.</span></span><span>NotificationMessagingTemplate</span><span>;</span>
<span>import</span> <span>lombok<span>.</span>extern<span>.</span>slf4j<span>.</span></span><span>Slf4j</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>beans<span>.</span>factory<span>.</span>annotation<span>.</span></span><span>Autowired</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>stereotype<span>.</span></span><span>Service</span><span>;</span>

<span>import</span> <span>static</span> <span>com<span>.</span>authga<span>.</span>springcloudaws<span>.</span>config<span>.</span></span><span>AWSConfigConstants</span><span>.</span>ORDER_CREATED_TOPIC<span>;</span>

<span>@Slf4j</span>
<span>@Service</span>
<span>public</span> <span>class</span> <span>SimpleMessageProducer</span> <span>{</span>

    <span>@Autowired</span>
    <span>private</span> <span>NotificationMessagingTemplate</span> notificationMessagingTemplate<span>;</span>

    <span>public</span> <span>void</span> <span>publish</span><span>(</span><span>Event</span> event<span>)</span> <span>{</span>
        notificationMessagingTemplate<span>.</span><span>convertAndSend</span><span>(</span>ORDER_CREATED_TOPIC<span>,</span> event<span>)</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><ul><li>We use the <code>NotificationMessagingTemplate</code> created in the config above. It gives us several methods to send messages on an SNS topic. We will use the default <code><span>convertAndSend</span><span>(</span><span>)</span></code> method that takes care of converting our object to a Message using the <code>MessageConverter</code> that we provide in the <code>SqsConfig</code> class.</li></ul><p>Consumer code:</p><pre><code><span>import</span> <span>com<span>.</span>authga<span>.</span>springcloudaws<span>.</span>model<span>.</span></span><span>Event</span><span>;</span>
<span>import</span> <span>io<span>.</span>awspring<span>.</span>cloud<span>.</span>messaging<span>.</span>config<span>.</span>annotation<span>.</span></span><span>NotificationMessage</span><span>;</span>
<span>import</span> <span>io<span>.</span>awspring<span>.</span>cloud<span>.</span>messaging<span>.</span>listener<span>.</span></span><span>SqsMessageDeletionPolicy</span><span>;</span>
<span>import</span> <span>io<span>.</span>awspring<span>.</span>cloud<span>.</span>messaging<span>.</span>listener<span>.</span>annotation<span>.</span></span><span>SqsListener</span><span>;</span>
<span>import</span> <span>lombok<span>.</span>extern<span>.</span>slf4j<span>.</span></span><span>Slf4j</span><span>;</span>
<span>import</span> <span>org<span>.</span>springframework<span>.</span>stereotype<span>.</span></span><span>Controller</span><span>;</span>

<span>import</span> <span>static</span> <span>com<span>.</span>authga<span>.</span>springcloudaws<span>.</span>config<span>.</span></span><span>AWSConfigConstants</span><span>.</span>ORDER_QUEUE<span>;</span>

<span>@Slf4j</span>
<span>@Controller</span>
<span>public</span> <span>class</span> <span>SimpleMessageConsumer</span> <span>implements</span> <span>MessageConsumer</span> <span>{</span>

    <span>@Override</span>
    <span>@SqsListener</span><span>(</span>value <span>=</span> ORDER_QUEUE<span>,</span> deletionPolicy <span>=</span> <span>SqsMessageDeletionPolicy</span><span>.</span>ON_SUCCESS<span>)</span>
    <span>public</span> <span>void</span> <span>consume</span><span>(</span><span>@NotificationMessage</span> <span>Event</span> event<span>)</span> <span>{</span>
        <span>if</span> <span>(</span>event <span>!=</span> <span>null</span><span>)</span> <span>{</span>
            log<span>.</span><span>info</span><span>(</span><span>&#34;Received order event for consumer 1: &#34;</span> <span>+</span> event<span>)</span><span>;</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><ul><li>We only need <code>@SqsListener</code> annotation that automatically makes our consume method get the messages from the queue.</li><li>We also add <code>@NotificationMessage</code> annotation to have the correct deserialization and extract our Event from the SNS message because the SNS message is wrapped inside a <code>Message</code> object.</li></ul><h3 id="Setup-LocalStack-and-create-resources">Setup LocalStack and create resources</h3><p>Setting up LocalStack is dead simple; you just need to use the docker-compose file below, and it will start SNS and SQS services locally. Add the <code>docker compose<span>.</span>yml</code> to the repository&#39;s root directory. Start the LocalStack using: <code>docker<span>-</span>compose up</code>.</p><pre><code><span>version</span><span>:</span> <span>&#39;3.0&#39;</span>

<span>services</span><span>:</span>

  <span>localstack</span><span>:</span>
    <span>image</span><span>:</span> localstack/localstack<span>:</span>latest
    <span>environment</span><span>:</span>
      <span>-</span> AWS_DEFAULT_REGION=eu<span>-</span>central<span>-</span><span>1</span>
      <span>-</span> EDGE_PORT=4566
      <span>-</span> SERVICES=sqs<span>,</span>sns
    <span>ports</span><span>:</span>
      <span>-</span> <span>&#39;4566:4566&#39;</span></code></pre><p>Once it is up and running, we can create the required AWS resources. We will create one SNS topic to which two SQS queues will be listening. The code to or publishing and listening is simple. Go to your command line, e.g., terminal, and execute the following commands.</p><p>To create the topic:</p><pre><code>aws --endpoint-url<span>=</span>http://localhost:4566  sns create-topic  --name  order-created-topic</code></pre><p>To create the queues:</p><pre><code>aws --endpoint-url<span>=</span>http://localhost:4566  sqs create-queue  --queue-name  order-queue
aws --endpoint-url<span>=</span>http://localhost:4566  sqs create-queue  --queue-name  order-queue-2</code></pre><p>To subscribe the queues to the topic:</p><pre><code>aws --endpoint-url<span>=</span>http://localhost:4566 sns subscribe
--topic-arn arn:aws:sns:eu-central-1:000000000000:order-created-topic
--protocol sqs
--notification-endpoint arn:aws:sqs:eu-central-1:000000000000:order-queue

aws --endpoint-url<span>=</span>http://localhost:4566 sns subscribe
--topic-arn arn:aws:sns:eu-central-1:000000000000:order-created-topic
--protocol sqs
--notification-endpoint arn:aws:sqs:eu-central-1:000000000000:order-queue-2</code></pre><p>To verify you can list queues and subscriptions:</p><pre><code>aws --endpoint-url<span>=</span>http://localhost:4566  sqs list-queues
aws --endpoint-url<span>=</span>http://localhost:4566  sns list-subscriptions</code></pre><p>That&#39;s it!</p><h3 id="Verify-sending-and-receiving-of-events">Verify sending and receiving of events</h3><p>Run the Spring Boot app:</p><ol start="1"><li>Clone the sample code from the repo. Go to the root directory.</li><li>Use Maven plugin to run your Spring Boot app using the command in the project directory.</li></ol><pre><code>mvn spring-boot:run</code></pre><p>The groundwork is complete now. With the app running, we can send messages to the Amazon SNS Topic and read those messages from the queues. In the repo, I have created a controller to trigger the publishing of events. If you download the sample app, you should be able to run it, and going to <a href="http://localhost:8080/create-order" target="_blank" rel="noreferrer noopener">http://localhost:8080/create-order</a> will trigger the publisher, which in turn will trigger the consumers. In the application logs, you should be able to see. This means that our producer code publishes the code to the SNS topic. The two queues that are subscribed to the topic receive those messages, and finally, the consumer receives those messages and prints the event.</p><pre><code>Received order event <span>for</span> consumer <span>1</span><span>:</span>
Event<span>{</span>eventId<span>=</span><span>&#39;386cca76-3669-4d36-b2db-01f388bbce5f&#39;</span><span>,</span> version<span>=</span><span>&#39;0&#39;</span><span>,</span>
occurredAt<span>=</span><span>&#39;2021-06-19T13:42:32.946781Z&#39;</span><span>,</span> data<span>=</span><span>EventData</span><span>(</span>orderId<span>=</span><span>9</span>a002b95<span>-</span>f10b<span>-</span><span>428e-8</span>d39<span>-</span>cae90d1e631d<span>,</span>
owner<span>=</span>SampleProducer<span>,</span> eventType<span>=</span><span>ORDER_CREATED</span><span>)</span><span>}</span>

Received order event <span>for</span> consumer <span>2</span><span>:</span>
Event<span>{</span>eventId<span>=</span><span>&#39;386cca76-3669-4d36-b2db-01f388bbce5f&#39;</span><span>,</span> version<span>=</span><span>&#39;0&#39;</span><span>,</span> occurredAt<span>=</span><span>&#39;2021-06-19T13:42:32.946781Z&#39;</span><span>,</span>
data<span>=</span><span>EventData</span><span>(</span>orderId<span>=</span><span>9</span>a002b95<span>-</span>f10b<span>-</span><span>428e-8</span>d39<span>-</span>cae90d1e631d<span>,</span> owner<span>=</span>SampleProducer<span>,</span> eventType<span>=</span><span>ORDER_CREATED</span><span>)</span><span>}</span></code></pre><h2 id="Conclusion">Conclusion</h2><p>LocalStack provides a simple and convenient way to simulate AWS services without having an actual AWS account. You can build applications using various AWS services like Amazon SNS, SQS, S3 DynamoDB, and many more.</p><p>In this article, we have learned how to build a Spring Cloud Messaging app that utilizes LocalStack. We saw how Spring Cloud Messaging provides a layer of abstraction to create an Amazon SQS listener and SNS publisher with just a few lines of code. Furthermore, we saw how to use Amazon SNS and SQS to create an event-driven application.</p><p>You can refer to the repository used in the article on <a href="https://github.com/maniish-jaiin/spring-cloud-messaging-sample" target="_blank" rel="noreferrer noopener">Github</a>.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 05 Aug 2021 14:53:00 +0000</pubDate>
    </item>
    <item>
      <title>Node 16 Support Now Available in Actions</title>
      <link>https://auth0.com/blog/node-16-support-now-available-in-actions/</link>
      <description>Starting Aug 4, 2021, we are rolling out Node 16 as the default runtime for Actions.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>As our next-generation extensibility platform, designed to replace Rules &amp; Hooks, our plan is to support every current and long-term supported Node version through Actions exclusively. </p><p>We recently introduced Node 16 support in Actions. Node 16 is the <em><a href="https://nodejs.org/en/about/releases/" target="_blank" rel="noreferrer noopener">current version published by Node</a></em>. This version does not introduce any breaking changes.  </p><h2 id="What-Does-This-Mean-for-Our-Developers-">What Does This Mean for Our Developers?</h2><p>We will continue to support Node 12 through the Long Term Support (LTS) end coming in April 2022 for all of our extensibility products - Actions, Rules, and Hooks.  However, we encourage developers to stay current in their Node version for security and compliance purposes.  </p><h3 id="Developers-using-Actions">Developers using Actions</h3><p>All new Actions will be set to the Node 16 runtime by default. However, you do not need to migrate every Action immediately to Node 16.  </p><p>Unlike Rules and Hooks, Actions is designed to run actions of varying Node runtimes side by side. With Actions, you no longer need to migrate all code to a single, tenant-level Node runtime. Existing Actions can be upgraded to Node 16 by creating and <a href="https://auth0.com/docs/actions/manage-versions" target="_blank" rel="noreferrer noopener">deploying a new version</a> to Node 16. If needed, existing Actions built on Node 12 can be upgraded to Node 16 and reverted to Node 12.</p><h3 id="Developers-using-legacy-extensibility-products">Developers using legacy extensibility products</h3><p>Our legacy extensibility products (Rules and Hooks) will continue to support Node 12. Node 16 will only roll out to Actions.</p><p>We strongly encourage developers using Rules and Hooks to migrate to Actions, wherever possible, to start taking advantage of the greatly <a href="https://auth0.com/blog/introducing-auth0-actions/" target="_blank" rel="noreferrer noopener">improved developer experience</a> that comes with Actions, such as an industry standard VS Code style editor, typescript, draft mode, version control, improved secret management, an expanded library of NPM modules, and more. </p><p>For developers using Node 8, if there are Rules and Hooks that cannot be immediately migrated to Actions Node 16, at a minimum, update your code to Node 12. Node 8 reached the end of LTS back in December 2019 and since then has not been updated to address critical bugs, security fixes, patches, or other important updates.</p><p>We want to hear from you. Please share any feedback on your experience with Actions and the Node 16 update in our <a href="https://community.auth0.com/c/actions/91" target="_blank" rel="noreferrer noopener">Developer Community</a>.</p></div></div>]]></content:encoded>
      <pubDate>Wed, 04 Aug 2021 16:02:00 +0000</pubDate>
    </item>
    <item>
      <title>Adding Auth0 RBAC Authorization to a Ktor API</title>
      <link>https://auth0.com/blog/adding-auth0-rbac-authorization-to-a-ktor-api/</link>
      <description>Learn how to add Auth0 RBAC authorization to Ktor HTTP API endpoints</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>In the previous post, we created an Auth0 API to represent the Ktor HTTP API and an Auth0 application to allow the frontend application to authenticate users. This allowed us to query the backend API from the frontend application with a valid access token. We also updated the backend API to require a valid access token for the <code><span>protected</span></code> and <code>admin</code> endpoints.</p><p>In this post, we&#39;ll complete the journey by enabling Role-Based Access Controls (RBAC) within Auth0 and restrict access to the <code>admin</code> endpoint in our backend API to those users with the correct permissions.</p><h2 id="RBAC-and-permissions">RBAC and permissions</h2><p>We start by enabling RBAC within our Auth0 API.</p><p>Under the <strong>Settings</strong> tab in the API, switch the <strong>Enable RBAC</strong> and <strong>Add permissions in the Access Token</strong> sliders to the on the setting. Doing so will ensure a <code>permissions</code> claim is added to the access token with any scopes that have been assigned to the logged-in user.</p><p>A detailed discussion on why scopes should not be used to grant permissions is presented in the post <a href="https://auth0.com/blog/on-the-nature-of-oauth2-scopes/" target="_blank" rel="noreferrer noopener">On The Nature of OAuth2&#39;s Scopes</a>. The summary is that a scope constrains the actions that an OAuth client <em>may</em> attempt to perform on behalf of a user, but <em>does not</em> imply that the user has the permission to access any particular resource.</p><p>This has some subtle but significant implications on the claims returned in an Auth0 access token.</p><p>Without enabling the RBAC settings, any scope requested by the OAuth client and consented to by the user will be returned in the <code>scope</code> claim. It doesn&#39;t matter if that scope has been assigned to the user or not - it is returned regardless. It is then the responsibility of the OAuth resource server to allow or deny access to a given resource based on the user&#39;s identity and the action being performed.</p><p>When RBAC is enabled, only scopes that have been requested by the client, <em>and</em> consented to by the user, <em>and</em> assigned to a user will be returned in the <code>scope</code> claim. In this scenario, the resource server can assume the absence of a scope means the client did not request it, the user did not consent to it, or it has not been assigned to the user, and so can quickly deny access.</p><p>By adding the <code>permissions</code> claim, each scope assigned to the user is calculated and included in the access token. The <code>permissions</code> claim is populated without asking for consent from the user, which supports more traditional RBAC style applications, where clients have delegated all the permissions of their users, and the users don&#39;t pick and choose scopes with each login.</p><p>Our sample application will make use of the scopes in the <code>permissions</code> claim to determine access to the API.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/4ZpaxCFDvKa7It8aToFSBP/06e7bd6600e3146032475a399a0d068a/01_build-a-ktor-api-pt-3.png" alt="RBAC"/>
<em>Enabling RBAC and permissions in the access token.</em></p><p>Under the <strong>Permissions</strong> tab, define a new <strong>Permission (Scope)</strong> of <code>read<span>:</span>admin<span>-</span>messages</code> and a <strong>Description</strong> of <strong>The ability to access the admin endpoint</strong>. Click the <strong>Add</strong> button to save the new permission:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1DJaaadYXA4vGKV9i9R8LK/4564b6449b1b1d190f2345638431b92d/02_build-a-ktor-api-pt-3.png" alt="API"/>
<em>Creating an API permission.</em></p><h3 id="Creating-the-role">Creating the role</h3><p>We now create a role to hold the permissions required by our API. Click the <strong>User Management -&gt; Roles</strong> option and click the <strong>Create Role</strong> button.</p><p>In the <strong>New Role</strong> dialog, enter a name of <strong>messages-admin</strong>, enter a description, and click the <strong>Create</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/7EQTp4sJS03bScEWno7kEa/a1c2586b32a480c4b166fb4ce5ba09b5/03_build-a-ktor-api-pt-3.png" alt="Roles"/>
<em>Creating a new role.</em></p><p>Under the <strong>Permissions</strong> tab click the <strong>Add Permissions</strong> button. In the <strong>Add Permissions</strong> dialog select the API we created earlier, select the <strong>read:admin-messages</strong> permission, and click the <strong>Add Permission</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/ZBB0FviUiLxmOzXoeDvJV/20ce7562521525551515e16e1c23bbe2/04_build-a-ktor-api-pt-3.png" alt="Permissions"/>
<em>Adding permissions to a role.</em></p><h3 id="Assigning-the-role-to-a-user">Assigning the role to a user</h3><p>For the purposes of this demo, I&#39;ll assume you have already <a href="https://auth0.com/docs/users/create-users" target="_blank" rel="noreferrer noopener">created an Auth0 user</a>. I&#39;ll also assume this user is linked to the application that was created earlier.</p><p>Select the user, click the <strong>Roles</strong> tab, and click the <strong>Assign Roles</strong> button.</p><p>In the <strong>Add Roles</strong> dialog, select the <strong>messages-admin</strong> role and click the <strong>Assign</strong> button:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/6X6s3poUPbop1eG6LShtqM/b8147045f0f291e2e853b6f8027a1e74/05_build-a-ktor-api-pt-3.png" alt="User"/>
<em>Assigning a role to a user.</em></p><p>Auth0 is now configured and ready to authenticate our frontend application. We can move on to updating our Ktor HTTP API to check for the presence of these permissions when accessing the <code>admin</code> endpoint.</p><h2 id="The-sample-application-code">The sample application code</h2><p>To build the backend application, you&#39;ll need to have JDK 11 or above, which is available from many sources, including <a href="https://openjdk.java.net/install/" target="_blank" rel="noreferrer noopener">OpenJDK</a>, <a href="https://adoptopenjdk.net/" target="_blank" rel="noreferrer noopener">AdoptOpenJDK</a>, <a href="https://www.azul.com/downloads/" target="_blank" rel="noreferrer noopener">Azul</a>, or <a href="https://www.oracle.com/au/java/technologies/javase-jdk11-downloads.html" target="_blank" rel="noreferrer noopener">Oracle</a>.</p><p>The final code for the Ktor application can be found <a href="https://github.com/mcasperson/Auth0Ktor" target="_blank" rel="noreferrer noopener">here</a>. The code discussed in each post is matched by a branch:</p><ul><li><a href="https://github.com/mcasperson/Auth0Ktor/tree/starter" target="_blank" rel="noreferrer noopener">starter</a> <ul><li>the base API with no authentication or authorization.</li></ul></li><li><a href="https://github.com/mcasperson/Auth0Ktor/tree/add-authorization" target="_blank" rel="noreferrer noopener">add-authorization</a> <ul><li>the API requiring a valid access token for the <code><span>protected</span></code> and <code>admin</code> endpoints.</li></ul></li><li><a href="https://github.com/mcasperson/Auth0Ktor/tree/add-rbac" target="_blank" rel="noreferrer noopener">add-rbac</a> <ul><li>the API requiring special permissions to access the <code>admin</code> endpoint. This branch is discussed in this post.</li></ul></li></ul><p>The frontend application code can be found <a href="https://github.com/auth0-sample-gallery/spa_react_javascript_hello-world" target="_blank" rel="noreferrer noopener">here</a>.</p><h2 id="Updating-the-API">Updating the API</h2><p>The backend API must now be updated to ensure the <code>admin</code> endpoint requires the access token, including the <code>read<span>:</span>admin<span>-</span>messages</code> permission. The complete code for the <code>src<span>/</span>Application<span>.</span>kt</code> file is shown below:</p><pre><code><span>package</span> com<span>.</span>matthewcasperson

<span>import</span> com<span>.</span>auth0<span>.</span>jwk<span>.</span>JwkProviderBuilder
<span>import</span> io<span>.</span>ktor<span>.</span>application<span>.</span><span>*</span>
<span>import</span> io<span>.</span>ktor<span>.</span>auth<span>.</span><span>*</span>
<span>import</span> io<span>.</span>ktor<span>.</span>auth<span>.</span>jwt<span>.</span><span>*</span>
<span>import</span> io<span>.</span>ktor<span>.</span>features<span>.</span><span>*</span>
<span>import</span> io<span>.</span>ktor<span>.</span>http<span>.</span><span>*</span>
<span>import</span> io<span>.</span>ktor<span>.</span>response<span>.</span><span>*</span>
<span>import</span> io<span>.</span>ktor<span>.</span>routing<span>.</span><span>*</span>
<span>import</span> java<span>.</span>util<span>.</span>concurrent<span>.</span>TimeUnit

<span>fun</span> <span>main</span><span>(</span>args<span>:</span> Array<span>&lt;</span>String<span>&gt;</span><span>)</span><span>:</span> Unit <span>=</span> io<span>.</span>ktor<span>.</span>server<span>.</span>netty<span>.</span>EngineMain<span>.</span><span>main</span><span>(</span>args<span>)</span>

<span>fun</span> <span>validateCreds</span><span>(</span>credential<span>:</span> JWTCredential<span>,</span> permission<span>:</span> String<span>?</span> <span>=</span> <span>null</span><span>)</span><span>:</span> JWTPrincipal<span>?</span> <span>{</span>
    <span>val</span> containsAudience <span>=</span> credential<span>.</span>payload<span>.</span>audience<span>.</span><span>contains</span><span>(</span>System<span>.</span><span>getenv</span><span>(</span><span>&#34;AUDIENCE&#34;</span><span>)</span><span>)</span>
    <span>val</span> containsScope <span>=</span> permission<span>.</span><span>isNullOrBlank</span><span>(</span><span>)</span> <span>||</span>
            credential<span>.</span>payload<span>.</span>claims<span>[</span><span>&#34;permissions&#34;</span><span>]</span><span>?</span><span>.</span><span>asArray</span><span>(</span>String<span>::</span><span>class</span><span>.</span>java<span>)</span><span>?</span><span>.</span><span>contains</span><span>(</span>permission<span>)</span> <span>==</span> <span>true</span>

    <span>if</span> <span>(</span>containsAudience <span>&amp;&amp;</span> containsScope<span>)</span> <span>{</span>
        <span>return</span> <span>JWTPrincipal</span><span>(</span>credential<span>.</span>payload<span>)</span>
    <span>}</span>

    <span>return</span> <span>null</span>
<span>}</span>

<span>fun</span> Application<span>.</span><span>module</span><span>(</span><span>)</span> <span>{</span>

    <span>val</span> jwkProvider <span>=</span> <span>JwkProviderBuilder</span><span>(</span>System<span>.</span><span>getenv</span><span>(</span><span>&#34;ISSUER&#34;</span><span>)</span><span>)</span>
        <span>.</span><span>cached</span><span>(</span><span>10</span><span>,</span> <span>24</span><span>,</span> TimeUnit<span>.</span>HOURS<span>)</span>
        <span>.</span><span>rateLimited</span><span>(</span><span>10</span><span>,</span> <span>1</span><span>,</span> TimeUnit<span>.</span>MINUTES<span>)</span>
        <span>.</span><span>build</span><span>(</span><span>)</span>

    <span>install</span><span>(</span>Authentication<span>)</span> <span>{</span>
        <span>jwt</span><span>(</span><span>&#34;auth0&#34;</span><span>)</span> <span>{</span>
            <span>verifier</span><span>(</span>jwkProvider<span>,</span> System<span>.</span><span>getenv</span><span>(</span><span>&#34;ISSUER&#34;</span><span>)</span><span>)</span>
            validate <span>{</span> credential <span>-&gt;</span> <span>validateCreds</span><span>(</span>credential<span>)</span> <span>}</span>
        <span>}</span>
        <span>jwt</span><span>(</span><span>&#34;auth0-admin&#34;</span><span>)</span> <span>{</span>
            <span>verifier</span><span>(</span>jwkProvider<span>,</span> System<span>.</span><span>getenv</span><span>(</span><span>&#34;ISSUER&#34;</span><span>)</span><span>)</span>
            validate <span>{</span> credential <span>-&gt;</span> <span>validateCreds</span><span>(</span>credential<span>,</span> <span>&#34;read:admin-messages&#34;</span><span>)</span> <span>}</span>
        <span>}</span>
    <span>}</span>
    <span>install</span><span>(</span>CORS<span>)</span> <span>{</span>
        <span>anyHost</span><span>(</span><span>)</span>
        <span>method</span><span>(</span>HttpMethod<span>.</span>Options<span>)</span>
        <span>method</span><span>(</span>HttpMethod<span>.</span>Get<span>)</span>
        <span>header</span><span>(</span><span>&#34;authorization&#34;</span><span>)</span>
        allowCredentials <span>=</span> <span>true</span>
        allowNonSimpleContentTypes <span>=</span> <span>true</span>

    <span>}</span>


    routing <span>{</span>
        <span>get</span><span>(</span><span>&#34;/api/messages/public&#34;</span><span>)</span> <span>{</span>
            call<span>.</span><span>respondText</span><span>(</span>
                <span>&#34;&#34;&#34;{&#34;message&#34;: &#34;The API doesn&#39;t require an access token to share this message.&#34;}&#34;&#34;&#34;</span><span>,</span>
                contentType <span>=</span> ContentType<span>.</span>Application<span>.</span>Json
            <span>)</span>
        <span>}</span>
    <span>}</span>

    routing <span>{</span>
        <span>authenticate</span><span>(</span><span>&#34;auth0&#34;</span><span>)</span> <span>{</span>
            <span>get</span><span>(</span><span>&#34;/api/messages/protected&#34;</span><span>)</span> <span>{</span>
                call<span>.</span><span>respondText</span><span>(</span>
                    <span>&#34;&#34;&#34;{&#34;message&#34;: &#34;The API successfully validated your access token.&#34;}&#34;&#34;&#34;</span><span>,</span>
                    contentType <span>=</span> ContentType<span>.</span>Application<span>.</span>Json
                <span>)</span>
            <span>}</span>
        <span>}</span>
    <span>}</span>

    routing <span>{</span>
        <span>authenticate</span><span>(</span><span>&#34;auth0-admin&#34;</span><span>)</span> <span>{</span>
            <span>get</span><span>(</span><span>&#34;/api/messages/admin&#34;</span><span>)</span> <span>{</span>
                call<span>.</span><span>respondText</span><span>(</span>
                    <span>&#34;&#34;&#34;{&#34;message&#34;: &#34;The API successfully recognized you as an admin.&#34;}&#34;&#34;&#34;</span><span>,</span>
                    contentType <span>=</span> ContentType<span>.</span>Application<span>.</span>Json
                <span>)</span>
            <span>}</span>
        <span>}</span>
    <span>}</span>
<span>}</span></code></pre><p>Let&#39;s highlight the changes required from the code presented in the previous blog post.</p><p>We&#39;ve updated the <code>validateCreds</code> function to include an optional <code>permission</code> parameter. If a permission has been supplied, we ensure it is present in the <code>permissions</code> claim on the access token:</p><pre><code><span>fun</span> <span>validateCreds</span><span>(</span>credential<span>:</span> JWTCredential<span>,</span> permission<span>:</span> String<span>?</span> <span>=</span> <span>null</span><span>)</span><span>:</span> JWTPrincipal<span>?</span> <span>{</span>
    <span>val</span> containsAudience <span>=</span> credential<span>.</span>payload<span>.</span>audience<span>.</span><span>contains</span><span>(</span>System<span>.</span><span>getenv</span><span>(</span><span>&#34;AUDIENCE&#34;</span><span>)</span><span>)</span>
    <span>val</span> containsScope <span>=</span> permission<span>.</span><span>isNullOrBlank</span><span>(</span><span>)</span> <span>||</span>
            credential<span>.</span>payload<span>.</span>claims<span>[</span><span>&#34;permissions&#34;</span><span>]</span><span>?</span><span>.</span><span>asArray</span><span>(</span>String<span>::</span><span>class</span><span>.</span>java<span>)</span><span>?</span><span>.</span><span>contains</span><span>(</span>permission<span>)</span> <span>==</span> <span>true</span>

    <span>if</span> <span>(</span>containsAudience <span>&amp;&amp;</span> containsScope<span>)</span> <span>{</span>
        <span>return</span> <span>JWTPrincipal</span><span>(</span>credential<span>.</span>payload<span>)</span>
    <span>}</span>

    <span>return</span> <span>null</span>
<span>}</span></code></pre><p>We then define a second authentication mechanism called <code>auth0<span>-</span>admin</code> requiring the permission <code>read<span>:</span>admin<span>-</span>messages</code> in order to pass validation:</p><pre><code>    <span>install</span><span>(</span>Authentication<span>)</span> <span>{</span>
        <span>// ...</span>
        <span>jwt</span><span>(</span><span>&#34;auth0-admin&#34;</span><span>)</span> <span>{</span>
            <span>verifier</span><span>(</span>jwkProvider<span>,</span> System<span>.</span><span>getenv</span><span>(</span><span>&#34;ISSUER&#34;</span><span>)</span><span>)</span>
            validate <span>{</span> credential <span>-&gt;</span> <span>validateCreds</span><span>(</span>credential<span>,</span> <span>&#34;read:admin-messages&#34;</span><span>)</span> <span>}</span>
        <span>}</span>
    <span>}</span></code></pre><p>Finally, the route exposing the <code>admin</code> endpoint is updated to use the new <code>auth0<span>-</span>admin</code> authentication mechanism:</p><pre><code>    routing <span>{</span>
        <span>authenticate</span><span>(</span><span>&#34;auth0-admin&#34;</span><span>)</span> <span>{</span>
            <span>get</span><span>(</span><span>&#34;/api/messages/admin&#34;</span><span>)</span> <span>{</span>
                call<span>.</span><span>respondText</span><span>(</span>
                    <span>&#34;&#34;&#34;{&#34;message&#34;: &#34;The API successfully recognized you as an admin.&#34;}&#34;&#34;&#34;</span><span>,</span>
                    contentType <span>=</span> ContentType<span>.</span>Application<span>.</span>Json
                <span>)</span>
            <span>}</span>
        <span>}</span>
    <span>}</span></code></pre><h2 id="Inspecting-the-access-token">Inspecting the access token</h2><p>By capturing the network traffic sent by the frontend (as we did in the previous post), we can copy the access token to <a href="https://jwt.io" target="_blank" rel="noreferrer noopener">jwt.io</a> to inspect the JWT contents.</p><p>Note that the token includes the <code>permissions</code> claim, which defines the <code>read<span>:</span>admin<span>-</span>messages</code> permission:</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/eFammxKcqhwLSKDPgfxRU/8b24e9b2c662143d983b4033aef61197/Assigning_the_role_to_a_user.jpg" alt="Inspecting the access token"/>
<em>A parsed JWT token.</em></p><h2 id="Conclusion">Conclusion</h2><p>In this post, we completed our three-part journey creating an HTTP API with Ktor, requiring authentication via Auth0, and finally enabling RBAC. By embedding the permissions assigned to a user in the <code>permissions</code> scope and verifying the presence of a known permission for any queries to the <code>admin</code> endpoint, we can be sure that only authorized users can access the restricted endpoints in our HTTP API.</p></div></div>]]></content:encoded>
      <pubDate>Tue, 03 Aug 2021 15:12:00 +0000</pubDate>
    </item>
    <item>
      <title>Time to Prepare: Be Ready to Scale Your Workforce and App</title>
      <link>https://auth0.com/blog/time-to-prepare-be-ready-to-scale-your-workforce-and-app/</link>
      <description>The consumer speaks ‚Äî how readiness to scale wins the security and privacy battle for the customer</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>If you sped through your digital road map during the pandemic and are looking to fill security and privacy gaps right now, go back and check out my earlier posts:</p><ul><li><a href="https://auth0.com/blog/accelerated-your-road-map-go-fix-workforce-and-app-security" target="_blank" rel="noreferrer noopener">Accelerated Your Road Map? Go Fix Workforce and App Security</a></li><li><a href="https://auth0.com/blog/workforce-and-app-privacy-have-changed-so-should-you" target="_blank" rel="noreferrer noopener">Workforce and App Privacy Have Changed, So Should You</a></li></ul><p>This post is about making the shift from reaction to preparation so that you are ready for the next moment that requires speed ‚Äì and set up to scale.</p><h2 id="Find-Your-Balance">Find Your Balance</h2><p>In all of these posts, we mention speed and imply pressure. There is always going to be a business reason to get an app to market as quickly as possible. You will discover vulnerabilities that require your immediate attention. And regulations will set deadlines for you. </p><p>So there is always going to be more you could do to improve security for your customers, your business, and the rest of the internet. Even for veteran security professionals, the pandemic was a reminder that we still need to pick and choose priorities. If you have an internal security team, lean into their expertise. Give them the time and space to guide you on priorities. Listen to their assessments of risk and let them set a pace that works for your business.</p><p>Longer-term security and privacy improvements can have big payoffs. Like the previous posts, these things require action. You‚Äôre also going to need to support your existing security team or create one. By support, I mean backing conversations about risks with budget for tools, external vendors, and hiring internal talent.</p><p>If you don‚Äôt currently have security or privacy teams, we‚Äôll cover a bit of advice on what to look for as well.</p><h2 id="Consumers-Expect-and-Deserve-Strong-Security-and-Privacy">Consumers Expect and Deserve Strong Security and Privacy</h2><p>Let‚Äôs also set some context.</p><p>There was a time when businesses leaned heavily into just shipping the product. Speed often won over security or privacy.</p><blockquote><p>Consumers are telling us that time is over.</p></blockquote><p>In a <a href="https://www.mckinsey.com/business-functions/risk/our-insights/the-consumer-data-opportunity-and-the-privacy-imperative" target="_blank" rel="noreferrer noopener">recent global survey</a>, McKinsey found that 87% of consumer respondents said security practice concerns would mean they wouldn‚Äôt do business with a company, and 71% would stop doing business if it gave away sensitive data without their permission. </p><blockquote><p>The more secure and private app is now the one that keeps and attracts customers. </p></blockquote><h2 id="Security--Longer-Term-Planning">Security: Longer-Term Planning</h2><p>If you‚Äôre looking to make a dramatic improvement in your cybersecurity, these best practices will help get you there.</p><ul><li><strong>Increase pen test frequency.</strong> Penetration testing (pen testing) includes hiring an external vendor to test your application and site for vulnerabilities and provide you with a report cataloged by severity. Many companies do this once a year and call it good. In today‚Äôs evolving threat environment, that‚Äôs not enough. If you can up your pen testing to every quarter ‚Äî and take action on what you learn ‚Äî you‚Äôll see a big increase in security. Adding a pen test after every major operating system upgrade, library update, or major code push will do even more.</li><li><strong>Improve your software development life cycle (SLDC).</strong> Many shops are still doing security after the product is completely coded, but this creates an automatic security backlog that can not only slow getting your product to market it can put pressure on your execs to allow unnecessary risks into the wild. Involving security and privacy teams as software is being developed allows them to raise questions that influence architecture before burning hours of engineering time. Few people like to put hours and hours into something only to have to take it apart, so your devs are rarely pleased to see this analysis tacked on at the end of the SLDC., which leads me to my next point.</li><li><strong>Encourage ownership and collaboration between devs and security.</strong> How you introduce the idea of static and dynamic code analysis as well as overall participation of security in the SLDC matters. Explaining that humans are fallible, so all code is going to have vulnerabilities, and there are going to be remote code executions (RCEs) is a good place to start. As a dev, they don‚Äôt want RCEs creating headaches, and they don‚Äôt want to get paged and work nights because problems have been discovered and exploited. You can encourage ownership by asking your dev team to review the security team handling analyses. Ultimately, this can go a long way towards establishing security-dev collaboration, leading to apps that get to market more securely as well quickly.</li><li><strong>Create a golden image.</strong> A <a href="https://www.cisecurity.org/cis-hardened-images/" target="_blank" rel="noreferrer noopener">golden Image</a>is a single machine image that has been tested and hardened. When there is an operating system or library update, the AMI gets updated and tested. This allows you to see how your customers might be impacted before you push that patch update out to thousands of users. It also provides an approved starting point for new business units or apps. The time it takes to create and maintain this image pays off in protected services and reduced downtimes. Using <a href="https://en.wikipedia.org/wiki/Hardening_(computing" target="_blank" rel="noreferrer noopener">hardened</a>) images also increases reliability and consistency.</li></ul><h2 id="Hiring-Security-Talent">Hiring Security Talent</h2><p>Security can seem like an area that is purely technical ‚Äî and your team does need to have a deep understanding of your product and how it works, but sooner or later, a human is going to touch or use your product. Strong security talent needs to understand human behavior from bad actors to customers. Your chief information security officer (CISO) also needs to be able to explain technical risks and benefits to non-technical executive teams.</p><p>There‚Äôs a cybersecurity talent shortage globally. According to an International Information System Security Certification Consortium (ISC)¬≤ <a href="https://www.isc2.org/Research/Workforce-Study#" target="_blank" rel="noreferrer noopener">report</a>, that shortage shrank slightly during the pandemic, from 4 million open jobs in 2019 to 3.1 million. You‚Äôre going to need to compete for talent.</p><p>Your new CISO also needs to understand your industry because threats are often industry-specific. Here are some questions to ask your hiring team when considering a potential candidate:</p><ul><li>Are they passionate about not only security but also your company?</li><li>Do they have experience in your industry? If not, how adept are they at cross-applying knowledge?</li><li>Areas of expertise? If you need them to be a generalist, do they understand how to source third-party support (and are you willing to fund that support)?</li><li>Do they welcome diversity?</li><li>Do they contribute to open source security?</li><li>Do they regularly attend and speak at conferences?</li><li>Can they explain the business case for your product?</li></ul><h2 id="Privacy--Longer-Term-Planning">Privacy: Longer-Term Planning</h2><p>Consumers are demanding a secure and contextual private experience ‚Äî and we‚Äôre seeing regulators back them up with a variety of data privacy regulations.</p><p>&#34;<em>By industry, consumers are most comfortable sharing data with providers in healthcare and financial services, though no industry reached a trust rating of 50 percent for data protection,</em>‚Äù notes <a href="https://www.mckinsey.com/business-functions/risk/our-insights/the-consumer-data-opportunity-and-the-privacy-imperative" target="_blank" rel="noreferrer noopener">McKinsey</a>.</p><p>This isn‚Äôt one of those things that is going away, says Auth0‚Äôs Vice President of Privacy Lucy McGrath. Globally, we‚Äôre seeing consumer groups becoming more vocal about data privacy concerns and violations with filings against companies like <a href="https://www.beuc.eu/publications/consumer-groups-file-complaint-against-whatsapp-unfairly-pressuring-users-accept-its/html" target="_blank" rel="noreferrer noopener">What‚ÄôsApp</a>. </p><p>‚Äú<em>Data privacy is going to continue to evolve with consumers‚Äô awareness and expectations,</em>‚Äù says Lucy. ‚Äú<em>To adapt, companies are going to have to think beyond just meeting the bare minimum of legal requirements. They need to ask themselves hard questions about what protections are appropriate given the context and the humans you‚Äôre interacting with and work through the answers. We need to be building proactive privacy programs that reflect these data privacy conversations. Creating consumer trust requires listening and deliberate action.</em>‚Äù</p><p>Start with these questions:</p><ul><li>Have I taken the time to understand the relationship my digital properties (app, site) create with my customers? How do I want them to feel at login? What about as they continue through my app or site?</li><li>Am I encouraging or discouraging trust by how I gather consent and data?</li><li>Have I created a transparent customer experience (CX) with clear consent and options?</li><li>If I am really honest with myself, do I need to change something? Do I really need this data?</li><li>Who are my customers? What does privacy mean to them in the context of my services?</li><li>Do I have appropriate basic security and data governance processes in place?</li><li>Have I invested extra resources and time to protect the most sensitive/high-risk data such as health, financial, religious, or sexual orientation information?</li><li>Do I have any customers in regulated jurisdictions such as the European Union (EU) or California? If so, when was the last time I checked in with my legal counsel to make sure I‚Äôm in line with current requirements?</li></ul><h2 id="Provide-Cues-for-Safety-and-Trust">Provide Cues for Safety and Trust</h2><p><a href="https://www.wired.com/story/apple-app-privacy-labels/" target="_blank" rel="noreferrer noopener">Apple‚Äôs nutrition labels for data privacy</a> make good on efforts that have been around since the 2010s. If your new app is going to be in the App Store, Apple requires that you report publicly on data you‚Äôre using to track your customers, data linked to them, and data gathered but not linked to them. Even though Apple is relying on app developers to self-report, the labels increase consumer awareness and expectation, says Lucy. Given Apple‚Äôs size ($274.5 billion reported revenue in 2020 makes it the world‚Äôs largest company), these nutrition labels signal that data privacy is now an everyday consumer concern.</p><p>‚Äú<em>Businesses who don‚Äôt respond could miss out</em>‚Äù, says Lucy. ‚Äú<em>The threats of data privacy fines and unhappy customers are real, but so is the opportunity to create customer experiences (CX) that drive brand loyalty. The entire tech industry is coming together to work on these data privacy challenges. Companies that act on the side of the consumer stand out.</em>‚Äù</p><h2 id="Hiring-Data-Privacy-Talent">Hiring Data Privacy Talent</h2><p>Like security, data privacy professionals need to understand and express the intersection of humans and technology. They need to be able to communicate risks and benefits across an entire organization, with an emphasis on engineering, marketing, and senior leadership. Critical and analytical thinking, empathy, and consideration of different motivations and perspectives are key. Technical knowledge around privacy laws can be taught, but an ability to engage, listen and understand the context of the business and their customers is essential. Privacy isn‚Äôt ‚Äúdone‚Äù by privacy professionals - they support all parts of the business to build privacy protections into their individual business processes.</p><p>Lucy recommends that you ask candidates questions to show how they think about privacy issues in the context of the businesses in which they work. Examples of such questions include: </p><ul><li>How would you demonstrate the value of good privacy practices to the chief financial officer (CFO)?</li><li>How do you respond to the statement: privacy slows the business down?</li><li>What can you do to support developers to integrate privacy controls into their development lifecycle?</li><li>Provide examples of when you have translated legal obligations into plain English requirements that the business can implement?</li><li>Which company does privacy well? Why? How would you implement similar standards here?</li><li>What are the key privacy risks that need to be prioritized? What actions are required to mitigate these risks?</li></ul><h2 id="You-re-Helping-Make-the-Internet-Safer">You‚Äôre Helping Make the Internet Safer</h2><p>Thank you for checking out this series. One of the things that came up while working on this content is how the pandemic has made everything even more connected. The <a href="https://auth0.com/resources/whitepapers/state-of-security-identity-report" target="_blank" rel="noreferrer noopener">threat landscape</a> and regulatory requirements can seem overwhelming, but taking the time to secure your personal data, your customer‚Äôs data, and your businesses make it harder for bad actors.</p><p>Identity can be a weak spot for both security and privacy if it‚Äôs not handled by experts. A strong Customer Identity Access Management (CIAM) solution like Auth0 can increase your security, support your data privacy strategy, and comes with certifications for various compliance requirements like <a href="https://auth0.com/blog/what-is-iso-27001-2013-a-guide-for-businesses/" target="_blank" rel="noreferrer noopener">ISO 27001:2013</a> and <a href="https://auth0.com/blog/what-is-iso-27018-2019-everything-executives-need-to-know/" target="_blank" rel="noreferrer noopener">ISO 27018:2019</a> and <a href="https://auth0.com/blog/the-csa-star-program-a-business-guide-to-certification/" target="_blank" rel="noreferrer noopener">CSA Star</a>. If you‚Äôd like to learn more about how Auth0 can help make your business more secure and stay ahead of your customers‚Äô evolving expectations, please <a href="https://auth0.com/contact-us?place=header&amp;type=button&amp;text=contact%20sales" target="_blank" rel="noreferrer noopener">reach out to the team at Auth0</a>.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>Auth0‚Äôs modern approach to identity enables organizations to provide secure access to any application, for any user. The Auth0 platform is a highly customizable identity operating system that is as simple as development teams want and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Fri, 30 Jul 2021 16:32:00 +0000</pubDate>
    </item>
    <item>
      <title>LATAM Response to Rapid Digital Change</title>
      <link>https://auth0.com/blog/latam-response-to-rapid-digital-change/</link>
      <description>Why Naranja and Wabi turned to Auth0 to ensure identity expertise and scaling</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>The market in Latin America is growing faster than ever, with new venture capital deals nearly doubling to 488 between 2017 and 2020, according to <a href="https://www.bloomberg.com/news/articles/2021-03-16/latin-american-startups-had-record-venture-capital-deals-in-2020" target="_blank" rel="noreferrer noopener">Bloomberg</a>. Beyond VC, a <a href="https://publications.iadb.org/publications/english/document/Tecnolatinas-2021-The-LAC-Startup-Ecosystem-Comes-of-Age.pdf" target="_blank" rel="noreferrer noopener">study by IDB lab</a> revealed that the tech-enabled startup market hit a valuation of more than $220 billion USD in 2020.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/Gz6t31FLxbPc7r8T996gE/caed742f057acf90192df17560dbf527/Latam11.jpg" alt="LATAM"/></p><p>Globally, the pandemic has <a href="https://auth0.com/blog/how-brick-and-mortar-approaches-improve-digital-experiences/" target="_blank" rel="noreferrer noopener">accelerated digital road maps across industries</a> and businesses now have to respond to changes in digital expectations and buying patterns.
</p><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúCompanies cannot predict exactly what their business and customers will need tomorrow, especially in response to today‚Äôs rapidly changing digital environment.‚Äù</p><p>Gabriel Camargo</p><p>Product Director</p><p>CLM</p></div><p>Partnering with <a href="https://auth0.com/blog/auth0-expands-global-partner-network-in-latin-america-with-clm/" target="_blank" rel="noreferrer noopener">CLM</a> on distribution in Latin America (LATAM) extends Auth0‚Äôs reach into Brazil, Colombia, Ecuador, and Peru.</p><p>Over the years of working within Latin America, we‚Äôve learned that <a href="https://auth0.com/blog/building-an-identity-solution-quantity-doesnt-equal-quality" target="_blank" rel="noreferrer noopener">identity expertise</a> and <a href="https://auth0.com/blog/can-your-identity-solution-grow-with-your-company" target="_blank" rel="noreferrer noopener">scalability</a> are two critical areas of concern for businesses in the region. You can check out our earlier posts in this series for details, but here, we wanted to look more closely at how we were able to help two companies within the region.</p><h2 id="Naranja---From-Leading-Credit-Card-Issuer-in-Argentina--To-Complete-Consumer-Ecosystem">Naranja ‚Äî From Leading Credit Card Issuer in Argentina, To Complete Consumer Ecosystem</h2><p><a href="https://auth0.com/case-studies/naranja/" target="_blank" rel="noreferrer noopener">Fintech leader Naranja</a> has been providing credit cards to the Argentinian market for over 30 years. In that time, they‚Äôve grown to cover over 5 million customers by keeping those customers‚Äô needs their top priority. As they grew, Naranja also began to integrate additional verticals into their business model. Pretty soon, they were offering payment services, financing, travel, media, and other services beyond their credit card programs.</p><p>As they added these verticals, Naranja‚Äôs head of engineering Javier Voos soon realized they would need to consolidate their identity solution to cover all aspects of their growing ecosystem. He knew that in order to continue putting the customer experience first, they would need to find the right IDaaS provider that would be able to scale along with their planned expansion.</p><p><a href="https://www.youtube.com/watch?v=kqouiuVk07Q&amp;feature=emb_imp_woyt" target="_blank" rel="noreferrer noopener">link to video</a></p><iframe width="560" height="315" src="https://www.youtube.com/embed/kqouiuVk07Q" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúThe main idea behind the Naranja ecosystem is to provide the best experience to our customers, making sure that our digital platform provides all the resources that an online business needs for success, and hence support the ecosystem evolution.‚Äù</p><p>Javier Voos</p><p>Head of Engineerin</p><p>Naranja</p></div><p>Voos‚Äô priority was to find a platform that provided secure APIs for identity so they could focus their expansion efforts on B2B services alongside their expanded consumer offerings. Finding Auth0 meant that his team could implement one identity solution that would allow both B2B and B2C customers access to the platforms they needed access to while ensuring data privacy and a low-friction user experience.
</p><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúAuth0 gave our company the tools to secure the access to our API for first- and third-party consumers, in a way that can scale through time and put us in a better position to ally with new partners and work our way to a fully functional Naranja API Market.‚Äù</p><p>Danilo Asis</p><p>Solution Architect</p><p>Naranja</p></div><h2 id="WABI---South-America-s-E-Commerce-Portal">WABI ‚Äî South America‚Äôs E-Commerce Portal</h2><p>With a half-dozen offerings already on offer, <a href="https://auth0.com/case-studies/wabipay/" target="_blank" rel="noreferrer noopener">WABI</a> is looking to the future. Their ambitious goal is to become Latin America‚Äôs go-to e-commerce portal. Their offerings already include WABI, a smartphone-based grocery service; Wabipay, an e-wallet app; and four additional applications. The end-goal WABI envisions is for customers to log in one time and have access to a complete, end-to-end e-commerce experience. They‚Äôll be able to shop, pay, and track delivery all in one place.</p><p>Juan Manuel Mingo, former WABI Business Manager, sums up the hurdle they faced when it came to identity and customer authentication, ‚ÄúWe had different platforms with different user registration processes,‚Äù he says. ‚ÄúOur aim was to unify all the user registration of the different platforms in order to get a better user experience and to have a more organized user database.‚Äù The disjointed customer experience was the first thing WABI knew they would have to solve before they could continue growing and expanding their e-commerce ecosystem. </p><div itemscope="" itemtype="http://schema.org/Person" itemprop="author"><p>‚ÄúOur endgame is that you enter the ecosystem through Wabi. You log in to Wabi, order your things, and when you want to pay, you simply go to WabiPay, and you‚Äôre already logged in.‚Äù</p><p>Frederico Galli</p><p>General Manager</p><p>WABI</p></div><p>Like Naranja, WABI has always had a customer-first attitude. That meant that customer-facing features like single sign-on were top priorities. As Frederico Galli stated, their endgame is for customers to sign in once and have access to the entire ecosystem of WABI offerings. Not only that, but with further expansion plans in the works, they needed an identity solution that was with them for the long haul. Juan Manual Mingo put it like this, ‚ÄúWABI is scalable, and we need a partner that is, too. We believe Auth0 will support us in getting there.‚Äù</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/P45m9X6Z8ag9oOTv8R4kW/cc92f6325cb89fd84f233aa6c6992218/Latam12.jpg" alt="LATAM"/></p><h2 id="Learn-how-Auth0-can-help-your-business">Learn how Auth0 can help your business</h2><p><a href="https://www.forbesargentina.com/editorial/la-increible-historia-auth0-cliente-us-27-quinto-unicornio-hoy-vale-us-1100-n1352" target="_blank" rel="noreferrer noopener">Argentinian talent Eugenio Pace and Matias Wolowski</a> founded Auth0, so we know the ins and outs of the South American market. When you‚Äôre ready to bring your identity solution in line with your broader organizational expansion goals, reach out to our <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">market experts</a> to start the discussion about how we can help.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>Auth0‚Äôs modern approach to identity enables organizations to provide secure access to any application, for any user. The Auth0 platform is a highly customizable identity operating system that is as simple as development teams want and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Fri, 30 Jul 2021 12:45:00 +0000</pubDate>
    </item>
    <item>
      <title>A Complete Guide to Lombok</title>
      <link>https://auth0.com/blog/a-complete-guide-to-lombok/</link>
      <description>Let‚Äôs see everything you should know to start using Project Lombok. We will have a look at how to integrate it into your IDE and use it to avoid boilerplate code.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Java is a great but verbose language. You may be ending up writing many lines of code even to achieve the most common goals. Plus, it definitely involves repetitive code, like getters and setters. This leads to a huge amount of boilerplate and avoidable code. Not only does this add nothing to the business logic of your application, but writing it is an unnecessarily boring and time-consuming process. This is why you should start employing tools and libraries to make you more productive by avoiding this. That‚Äôs where Lombok comes into play!</p><p>This Java library provides you with several annotations aimed at avoiding writing Java code known to be repetitive and/or boilerplate. Project Lombok works by plugging into your build process. Then, it will auto-generate the Java bytecode into your <em>.class</em> files required to implement the desired behavior, based on the annotations you used. Thus, each annotation offered by Project Lombok allows you to skip writing methods and logic you would like to avoid, like constructors, equals, and hash code functions. This will save you a lot of time and let you focus on the business logic of your project. Plus, you will be able to keep your codebase smaller, cleaner, and easier to be read and maintained.</p><p>First, we will see what Project Lombok is and how it works. Then, we will study the most common and relevant Lombok‚Äôs annotations, understanding what the most important ones are, where, and how to use them. Next, it will be time to see how to integrate it in your IDE (<a href="https://en.wikipedia.org/wiki/Integrated_development_environment" target="_blank" rel="noreferrer noopener">Integrated Development Environment</a>) and why you should not be afraid of using it.</p><h2 id="Prerequisites">Prerequisites</h2><p>This is the list of all the prerequisites to replicate the examples that will be shown next:</p><ul><li>Java &gt;= 1.8</li><li>Gradle &gt;= 4.x or Maven 3.6.x</li><li>Project Lombok &gt;= 1.18.20</li></ul><h2 id="What-is-Lombok">What is Lombok</h2><p><a href="https://projectlombok.org/" target="_blank" rel="noreferrer noopener">Project Lombok</a> (from now on, <em>Lombok</em>) is an annotation-based Java library that allows you to reduce boilerplate code. Lombok offers various annotations aimed at replacing Java code that is well known for being boilerplate, repetitive, or tedious to write. For example, by using Lombok, you can avoid writing constructors with no arguments, <code><span>toString</span><span>(</span><span>)</span></code>, <code><span>equals</span><span>(</span><span>)</span></code>, and <code><span>hashCode</span><span>(</span><span>)</span></code> methods by simply adding a few annotations. The magic happens during the compile-time when the library injects the bytecode representing the desired and boilerplate code into your <em>.class</em> files. Plus, as we will see, the library can be plugged into your IDE, letting you have the same experience as if you had written all the boilerplate code yourself.</p><p>You can easily install Lombok by adding <a href="https://mvnrepository.com/artifact/org.projectlombok/lombok/1.18.20" target="_blank" rel="noreferrer noopener"><code>lombok</code></a> to your dependencies.
If you are a <a href="https://projectlombok.org/setup/gradle" target="_blank" rel="noreferrer noopener">Gradle user</a>, add these two lines to the dependencies section of your <code>build<span>.</span>gradle</code> file:</p><pre><code>compileOnly <span>&#39;org.projectlombok:lombok:1.18.20&#39;</span>
annotationProcessor <span>&#39;org.projectlombok:lombok:1.18.20&#39;</span></code></pre><p>While if you are a <a href="https://projectlombok.org/setup/maven" target="_blank" rel="noreferrer noopener">Maven user</a>, add the following dependency to your <code>pom<span>.</span>xml</code> file:</p><pre><code><span><span><span>&lt;</span>dependency</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.projectlombok<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>lombok<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>version</span><span>&gt;</span></span>1.18.20<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>scope</span><span>&gt;</span></span>provided<span><span><span>&lt;/</span>scope</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>dependency</span><span>&gt;</span></span></code></pre><p>Plus, add the Lombok dependency to the <a href="https://maven.apache.org/plugins/maven-compiler-plugin/" target="_blank" rel="noreferrer noopener"><code>maven<span>-</span>compiler<span>-</span>plugin</code></a> configuration section as follows :</p><pre><code><span><span><span>&lt;</span>build</span><span>&gt;</span></span>
      <span><span><span>&lt;</span>plugins</span><span>&gt;</span></span>      
            
            <span><span><span>&lt;</span>plugin</span><span>&gt;</span></span>
                  <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.apache.maven.plugins<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
                  <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>maven-compiler-plugin<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
                  <span><span><span>&lt;</span>version</span><span>&gt;</span></span>3.5.1<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
                  <span><span><span>&lt;</span>configuration</span><span>&gt;</span></span>
                        <span><span><span>&lt;</span>source</span><span>&gt;</span></span>11<span><span><span>&lt;/</span>source</span><span>&gt;</span></span> <span>&lt;!-- depending on your project --&gt;</span>
                        <span><span><span>&lt;</span>target</span><span>&gt;</span></span>11<span><span><span>&lt;/</span>target</span><span>&gt;</span></span> <span>&lt;!-- depending on your project --&gt;</span>
                        <span><span><span>&lt;</span>annotationProcessorPaths</span><span>&gt;</span></span>
                              <span><span><span>&lt;</span>path</span><span>&gt;</span></span>
                                    <span><span><span>&lt;</span>groupId</span><span>&gt;</span></span>org.projectlombok<span><span><span>&lt;/</span>groupId</span><span>&gt;</span></span>
                                    <span><span><span>&lt;</span>artifactId</span><span>&gt;</span></span>lombok<span><span><span>&lt;/</span>artifactId</span><span>&gt;</span></span>
                                    <span><span><span>&lt;</span>version</span><span>&gt;</span></span>1.18.20<span><span><span>&lt;/</span>version</span><span>&gt;</span></span>
                              <span><span><span>&lt;/</span>path</span><span>&gt;</span></span>                              
                        <span><span><span>&lt;/</span>annotationProcessorPaths</span><span>&gt;</span></span>
                  <span><span><span>&lt;/</span>configuration</span><span>&gt;</span></span>
            <span><span><span>&lt;/</span>plugin</span><span>&gt;</span></span>
            
            <span>&lt;!-- ... --&gt;</span>  
            
      <span><span><span>&lt;/</span>plugins</span><span>&gt;</span></span>
<span><span><span>&lt;/</span>build</span><span>&gt;</span></span></code></pre><p>Now, you have all you need to start using Lombok.</p><h2 id="Most-Common-Lombok-Annotations">Most Common Lombok Annotations</h2><p>Here you can find the most common and important Lombok annotations. Each of them will be explained and then seen in use compared to the equivalent Java vanilla translation. To see examples and get more support, click on each annotation and visit its page on the <a href="https://projectlombok.org/features/all" target="_blank" rel="noreferrer noopener">Lombok official documentation</a>.</p><h3 id="---Getter---https---projectlombok-org-features-GetterSetter------Setter---https---projectlombok-org-features-GetterSetter-"><a href="https://projectlombok.org/features/GetterSetter" target="_blank" rel="noreferrer noopener"><code>@Getter</code></a>, <a href="https://projectlombok.org/features/GetterSetter" target="_blank" rel="noreferrer noopener"><code>@Setter</code></a></h3><p>When a field is annotated with <code>@Getter</code> and/or <code>@Setter</code>, Lombok will automatically generate the default getter and/or setter, respectively. The default implementation for getters simply takes care of returning the annotated field. Similarly, the default implementation for setters takes one parameter of the same type as the annotated field and simply sets it with the received value. When a field called <code>value</code> is annotated with both <code>@Getter</code> and <code>@Setter</code>, Lombok will define a <code><span>getValue</span><span>(</span><span>)</span></code> (or <code><span>isValue</span><span>(</span><span>)</span></code> if the field is <code>boolean</code>), and a <code><span>setValue</span><span>(</span><span>)</span></code> method. The generated getter/setter method will be <code><span>public</span></code>, unless a particular <code>AccessLevel</code> is specified. The allowed <code>AccessLevel</code> values are <code><span>PUBLIC</span></code>, <code><span>PROTECTED</span></code>, <code><span>PACKAGE</span></code>, and <code><span>PRIVATE</span></code>. Please, note that you can also annotate the entire class. In this case, this logic will be applied to each field.</p><h4 id="With-Lombok">With Lombok</h4><pre><code><span>@Getter</span>
<span>@Setter</span>
<span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>@Setter</span><span>(</span><span>AccessLevel</span><span>.</span>PROTECTED<span>)</span>
    <span>private</span> <span>String</span> surname<span>;</span>
<span>}</span></code></pre><h4 id="Java-Vanilla">Java Vanilla</h4><pre><code><span>public</span> <span>class</span> <span>User</span> <span>{</span>
    <span>private</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>

    <span>public</span> <span>int</span> <span>getId</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> id<span>;</span>
    <span>}</span>

    <span>public</span> <span>void</span> <span>setId</span><span>(</span><span>int</span> id<span>)</span> <span>{</span>
        <span>this</span><span>.</span>id <span>=</span> id<span>;</span>
    <span>}</span>

    <span>public</span> <span>String</span> <span>getName</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> name<span>;</span>
    <span>}</span>

    <span>public</span> <span>void</span> <span>setName</span><span>(</span><span>String</span> name<span>)</span> <span>{</span>
        <span>this</span><span>.</span>name <span>=</span> name<span>;</span>
    <span>}</span>

    <span>public</span> <span>String</span> <span>getSurname</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> surname<span>;</span>
    <span>}</span>

    <span>protected</span> <span>void</span> <span>setSurname</span><span>(</span><span>String</span> surname<span>)</span> <span>{</span>
        <span>this</span><span>.</span>surname <span>=</span> surname<span>;</span>
    <span>}</span>
<span>}</span></code></pre><h3 id="---NoArgsConstructor---https---projectlombok-org-features-constructor------RequiredArgsConstructor---https---projectlombok-org-features-constructor------AllArgsConstructor---https---projectlombok-org-features-constructor-"><a href="https://projectlombok.org/features/constructor" target="_blank" rel="noreferrer noopener"><code>@NoArgsConstructor</code></a>, <a href="https://projectlombok.org/features/constructor" target="_blank" rel="noreferrer noopener"><code>@RequiredArgsConstructor</code></a>, <a href="https://projectlombok.org/features/constructor" target="_blank" rel="noreferrer noopener"><code>@AllArgsConstructor</code></a></h3><p>When a class is annotated with <code>@NoArgsConstructor</code>, Lombok will take care of automatically generating a constructor with no parameters. Likewise, when annotated with <code>@AllArgsConstructor</code>, a constructor with one parameter for each field in your class will be generated. Similarly, <code>@RequiredArgsConstructor</code> leads to a constructor with a parameter for each field requiring special handling. In particular, this involves non-initialized <code>final</code> fields, as well as any fields marked as <code>@NonNull</code> that are not initialized where declared. Please, do not forget that static fields will be ignored by these annotations.</p><h4 id="With-Lombok">With Lombok</h4><pre><code><span>@NoArgsConstructor</span>
<span>@AllArgsConstructor</span>
<span>@RequiredArgsConstructor</span>
<span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>
    <span>private</span> <span>final</span> <span>String</span> birthPlace<span>;</span>
<span>}</span></code></pre><h4 id="Java-Vanilla">Java Vanilla</h4><pre><code><span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>
    <span>private</span> <span>final</span> <span>String</span> birthPlace<span>;</span>

    <span>// @NoArgsConstructor</span>
    <span>public</span> <span>Author</span><span>(</span><span>)</span> <span>{</span><span>}</span>

    <span>// @AllArgsConstructor</span>
    <span>public</span> <span>Author</span><span>(</span><span>int</span> id<span>,</span> <span>String</span> name<span>,</span> <span>String</span> surname<span>,</span> <span>String</span> birthPlace<span>)</span> <span>{</span>
      <span>this</span><span>.</span>id <span>=</span> id
      <span>this</span><span>.</span>name <span>=</span> name
      <span>this</span><span>.</span>surname <span>=</span> surname
      <span>this</span><span>.</span>birthPlace <span>=</span> birthPlace
    <span>}</span>

    <span>// @RequiredArgsConstructor</span>
    <span>public</span> <span>Author</span><span>(</span><span>String</span> birthPlace<span>)</span> <span>{</span>
      <span>this</span><span>.</span>birthPlace <span>=</span> birthPlace
    <span>}</span>
<span>}</span></code></pre><h3 id="---ToString---https---projectlombok-org-features-ToString-"><a href="https://projectlombok.org/features/ToString" target="_blank" rel="noreferrer noopener"><code>@ToString</code></a></h3><p>When a class is annotated with <code>@ToString</code>, Lombok will take care of generating a proper implementation of the <code><span>toString</span><span>(</span><span>)</span></code> method. By default, a String containing the class name, followed by each field&#39;s value separated by a comma, will be returned. By setting the <code>includeFieldNames</code> parameter to <em>true</em>, the name of each field will be placed before its value. By default, all non-static fields will be considered when generating the <code><span>toString</span><span>(</span><span>)</span></code> method. Annotate a field with <code>@ToString<span>.</span>Exclude</code> to make Lombok ignore it. Alternatively, you can specify which fields you wish to be taken into account by using <code>@<span>ToString</span><span>(</span>onlyExplicitlyIncluded <span>=</span> <span>true</span><span>)</span></code>. Then, mark each field you want to include with <code>@ToString<span>.</span>Include</code>.</p><h4 id="With-Lombok">With Lombok</h4><pre><code><span>@ToString</span><span>(</span>includeFieldNames<span>=</span><span>true</span><span>)</span>
<span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>
<span>}</span></code></pre><h4 id="Java-Vanilla">Java Vanilla</h4><pre><code><span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>

    <span>@Override</span> 
    <span>public</span> <span>String</span> <span>toString</span><span>(</span><span>)</span> <span>{</span>
      <span>return</span> <span>&#34;Author(id=&#34;</span> <span>+</span> <span>this</span><span>.</span>id <span>+</span> <span>&#34;, name=&#34;</span> <span>+</span> <span>this</span><span>.</span>name <span>+</span> <span>&#34;, surnname=&#34;</span> <span>+</span> <span>this</span><span>.</span>surname <span>+</span> <span>&#34;)&#34;</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><h3 id="---EqualsAndHashCode---https---projectlombok-org-features-EqualsAndHashCode-"><a href="https://projectlombok.org/features/EqualsAndHashCode" target="_blank" rel="noreferrer noopener"><code>@EqualsAndHashCode</code></a></h3><p>Annotate a class with <code>@EqualsAndHashCode</code>, and Lombok will automatically implement the <code><span>equals</span><span>(</span><span>)</span></code> and <code><span>hashCode</span><span>(</span><span>)</span></code> methods for you. By default, all non-static, non-transient fields will be taken into account. You can modify which fields are used by annotating them with <code>@EqualsAndHashCode<span>.</span>Include</code> or <code>@EqualsAndHashCode<span>.</span>Exclude</code>. Alternatively, you can annotate your class with <code>@<span>EqualsAndHashCode</span><span>(</span>onlyExplicitlyIncluded <span>=</span> <span>true</span><span>)</span></code> and then specify exactly which fields or methods you want to be used by marking them with <code>@EqualsAndHashCode<span>.</span>Include</code>. Please, note that the <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#equals(java.lang.Object" target="_blank" rel="noreferrer noopener"><code><span>equals</span><span>(</span><span>)</span></code></a>) and <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#hashCode(" target="_blank" rel="noreferrer noopener"><code><span>hashCode</span><span>(</span><span>)</span></code></a>) methods will be generated by Lombok without breaking the contract between them. Follow the link on the two methods to the official Java documentation to learn more about the contracts that <code><span>equals</span><span>(</span><span>)</span></code> and <code><span>hashCode</span><span>(</span><span>)</span></code> implementations should fulfill.</p><h4 id="With-Lombok">With Lombok</h4><pre><code><span>@Getter</span>
<span>@Setter</span>
<span>@EqualsAndHashCode</span>
<span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>
<span>}</span></code></pre><h4 id="Java-Vanilla">Java Vanilla</h4><pre><code><span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    
    <span>// gettes and setters ...</span>

    <span>@Override</span> 
    <span>public</span> <span>int</span> <span>hashCode</span><span>(</span><span>)</span> <span>{</span>
       <span>final</span> <span>int</span> PRIME <span>=</span> <span>31</span><span>;</span>
       <span>int</span> result <span>=</span> <span>1</span><span>;</span>
       result <span>=</span> prime <span>*</span> result <span>+</span> id<span>;</span>
       result <span>=</span> prime <span>*</span> result <span>+</span> <span>(</span><span>(</span>name <span>==</span> <span>null</span><span>)</span> <span>?</span> <span>0</span> <span>:</span> name<span>.</span><span>hashCode</span><span>(</span><span>)</span><span>)</span><span>;</span>
       result <span>=</span> prime <span>*</span> result <span>+</span> <span>(</span><span>(</span>surname <span>==</span> <span>null</span><span>)</span> <span>?</span> <span>0</span> <span>:</span> surname<span>.</span><span>hashCode</span><span>(</span><span>)</span><span>)</span><span>;</span>
       <span>return</span> result<span>;</span>
    <span>}</span>

    <span>@Override</span> 
    <span>public</span> <span>boolean</span> <span>equals</span><span>(</span><span>Object</span> o<span>)</span> <span>{</span>
       <span>if</span> <span>(</span>o <span>==</span> <span>this</span><span>)</span> <span>return</span> <span>true</span><span>;</span>
       <span>if</span> <span>(</span><span>!</span><span>(</span>o <span>instanceof</span> <span>Author</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>Author</span> other <span>=</span> <span>(</span><span>Author</span><span>)</span> o<span>;</span>
       <span>if</span> <span>(</span><span>!</span>other<span>.</span><span>canEqual</span><span>(</span><span>(</span><span>Object</span><span>)</span><span>this</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>if</span> <span>(</span><span>this</span><span>.</span><span>getId</span><span>(</span><span>)</span> <span>==</span> <span>null</span> <span>?</span> other<span>.</span><span>getId</span><span>(</span><span>)</span> <span>!=</span> <span>null</span> <span>:</span> <span>!</span><span>this</span><span>.</span><span>getId</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>other<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>if</span> <span>(</span><span>this</span><span>.</span><span>getName</span><span>(</span><span>)</span> <span>==</span> <span>null</span> <span>?</span> other<span>.</span><span>getName</span><span>(</span><span>)</span> <span>!=</span> <span>null</span> <span>:</span> <span>!</span><span>this</span><span>.</span><span>getName</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>other<span>.</span><span>getName</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>if</span> <span>(</span><span>this</span><span>.</span><span>getSurname</span><span>(</span><span>)</span> <span>==</span> <span>null</span> <span>?</span> other<span>.</span><span>getSurname</span><span>(</span><span>)</span> <span>!=</span> <span>null</span> <span>:</span> <span>!</span><span>this</span><span>.</span><span>getSurname</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>other<span>.</span><span>getSurname</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>return</span> <span>true</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><h3 id="---NonNull---https---projectlombok-org-features-NonNull-"><a href="https://projectlombok.org/features/NonNull" target="_blank" rel="noreferrer noopener"><code>@NonNull</code></a></h3><p>You can annotate with <code>@NonNull</code> a record component, a parameter of a method, or an entire constructor. This way, Lombok will generate null-check statements for you accordingly.</p><h4 id="With-Lombok">With Lombok</h4><pre><code><span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>

    <span>public</span> <span>Author</span><span>(</span>
      <span>@NonNull</span> <span>int</span> id<span>,</span>
      <span>@NonNull</span> <span>String</span> name<span>,</span>
      <span>String</span> surname
    <span>)</span> <span>{</span>
      <span>this</span><span>.</span>id <span>=</span> id<span>;</span>
      <span>this</span><span>.</span>name <span>=</span> name<span>;</span>
      <span>this</span><span>.</span>surname <span>=</span> surname<span>;</span> 
  <span>}</span>
<span>}</span></code></pre><h4 id="Java-Vanilla">Java Vanilla</h4><pre><code><span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>

    <span>public</span> <span>Author</span><span>(</span>
      <span>int</span> id<span>,</span>
      <span>String</span> name<span>,</span>
      <span>String</span> surname
    <span>)</span> <span>{</span>
        <span>if</span> <span>(</span>id <span>==</span> <span>null</span><span>)</span> <span>{</span>
          <span>throw</span> <span>new</span> <span>NullPointerException</span><span>(</span><span>&#34;id is marked @NonNull but is null&#34;</span><span>)</span><span>;</span>
        <span>}</span>
        <span>this</span><span>.</span>id <span>=</span> id<span>;</span>
        <span>if</span> <span>(</span>name <span>==</span> <span>null</span><span>)</span> <span>{</span>
          <span>throw</span> <span>new</span> <span>NullPointerException</span><span>(</span><span>&#34;name is marked @NonNull but is null&#34;</span><span>)</span><span>;</span>
        <span>}</span>
        <span>this</span><span>.</span>name <span>=</span> name<span>;</span>
        <span>this</span><span>.</span>surname <span>=</span> surname<span>;</span> 
  <span>}</span>
<span>}</span></code></pre><h3 id="---Data---https---projectlombok-org-features-Data-"><a href="https://projectlombok.org/features/Data" target="_blank" rel="noreferrer noopener"><code>@Data</code></a></h3><p><code>@Data</code> is a shortcut annotation that combines the features of <a href="https://projectlombok.org/features/ToString" target="_blank" rel="noreferrer noopener"><code>@ToString</code></a>, <a href="https://projectlombok.org/features/EqualsAndHashCode" target="_blank" rel="noreferrer noopener"><code>@EqualsAndHashCode</code></a>, <a href="https://projectlombok.org/features/GetterSetter" target="_blank" rel="noreferrer noopener"><code>@Getter</code></a> <a href="https://projectlombok.org/features/GetterSetter" target="_blank" rel="noreferrer noopener"><code>@Setter</code></a>, and <a href="https://projectlombok.org/features/constructor" target="_blank" rel="noreferrer noopener"><code>@RequiredArgsConstructor</code></a> together. So, <code>@Data</code> generates all the boilerplate involved in POJOs (<a href="https://en.wikipedia.org/wiki/Plain_old_Java_object" target="_blank" rel="noreferrer noopener">Plain Old Java Objects</a>). This means, in particular, getters for all fields, setters for all non-final fields, proper <code>toString</code>, <code>equals</code>, and <code>hashCode</code> implementations involving every field of the class, and a constructor for all final fields.</p><h4 id="With-Lombok">With Lombok</h4><pre><code><span>@Data</span>
<span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>final</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>
<span>}</span></code></pre><h4 id="Java-Vanilla">Java Vanilla</h4><pre><code><span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>final</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>String</span> surname<span>;</span>

    <span>public</span> <span>Author</span><span>(</span><span>int</span> id<span>)</span> <span>{</span>
        <span>this</span><span>.</span>id <span>=</span> id<span>;</span>
    <span>}</span>    

    <span>public</span> <span>int</span> <span>getId</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> id<span>;</span>
    <span>}</span>

    <span>public</span> <span>String</span> <span>getName</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> name<span>;</span>
    <span>}</span>

    <span>public</span> <span>void</span> <span>setName</span><span>(</span><span>String</span> name<span>)</span> <span>{</span>
        <span>this</span><span>.</span>name <span>=</span> name<span>;</span>
    <span>}</span>

    <span>public</span> <span>String</span> <span>getSurname</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> surname<span>;</span>
    <span>}</span>

    <span>public</span> <span>void</span> <span>setSurname</span><span>(</span><span>String</span> surname<span>)</span> <span>{</span>
        <span>this</span><span>.</span>surname <span>=</span> surname<span>;</span>
    <span>}</span>

    <span>@Override</span> 
    <span>public</span> <span>int</span> <span>hashCode</span><span>(</span><span>)</span> <span>{</span>
       <span>final</span> <span>int</span> PRIME <span>=</span> <span>31</span><span>;</span>
       <span>int</span> result <span>=</span> <span>1</span><span>;</span>
       result <span>=</span> prime <span>*</span> result <span>+</span> <span>getId</span><span>(</span><span>)</span><span>;</span>
       result <span>=</span> prime <span>*</span> result <span>+</span> <span>(</span><span>(</span><span>getName</span><span>(</span><span>)</span> <span>==</span> <span>null</span><span>)</span> <span>?</span> <span>0</span> <span>:</span> <span>getName</span><span>(</span><span>)</span><span>.</span><span>hashCode</span><span>(</span><span>)</span><span>)</span><span>;</span>
       result <span>=</span> prime <span>*</span> result <span>+</span> <span>(</span><span>(</span><span>getSurname</span><span>(</span><span>)</span> <span>==</span> <span>null</span><span>)</span> <span>?</span> <span>0</span> <span>:</span> <span>getSurname</span><span>(</span><span>)</span><span>.</span><span>hashCode</span><span>(</span><span>)</span><span>)</span><span>;</span>
       <span>return</span> result<span>;</span>
    <span>}</span>

    <span>@Override</span> 
    <span>public</span> <span>boolean</span> <span>equals</span><span>(</span><span>Object</span> o<span>)</span> <span>{</span>
       <span>if</span> <span>(</span>o <span>==</span> <span>this</span><span>)</span> <span>return</span> <span>true</span><span>;</span>
       <span>if</span> <span>(</span><span>!</span><span>(</span>o <span>instanceof</span> <span>Author</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>Author</span> other <span>=</span> <span>(</span><span>Author</span><span>)</span> o<span>;</span>
       <span>if</span> <span>(</span><span>!</span>other<span>.</span><span>canEqual</span><span>(</span><span>(</span><span>Object</span><span>)</span><span>this</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>if</span> <span>(</span><span>this</span><span>.</span><span>getId</span><span>(</span><span>)</span> <span>==</span> <span>null</span> <span>?</span> other<span>.</span><span>getId</span><span>(</span><span>)</span> <span>!=</span> <span>null</span> <span>:</span> <span>!</span><span>this</span><span>.</span><span>getId</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>other<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>if</span> <span>(</span><span>this</span><span>.</span><span>getName</span><span>(</span><span>)</span> <span>==</span> <span>null</span> <span>?</span> other<span>.</span><span>getName</span><span>(</span><span>)</span> <span>!=</span> <span>null</span> <span>:</span> <span>!</span><span>this</span><span>.</span><span>getName</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>other<span>.</span><span>getName</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>if</span> <span>(</span><span>this</span><span>.</span><span>getSurname</span><span>(</span><span>)</span> <span>==</span> <span>null</span> <span>?</span> other<span>.</span><span>getSurname</span><span>(</span><span>)</span> <span>!=</span> <span>null</span> <span>:</span> <span>!</span><span>this</span><span>.</span><span>getSurname</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>other<span>.</span><span>getSurname</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
       <span>return</span> <span>true</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><h3 id="---Value---https---projectlombok-org-features-Value-"><a href="https://projectlombok.org/features/Value" target="_blank" rel="noreferrer noopener"><code>@Value</code></a></h3><p><code>@Value</code> is the immutable variant of <a href="https://projectlombok.org/features/Data" target="_blank" rel="noreferrer noopener"><code>@Data</code></a>. This means that all fields are made <code><span>private</span></code> and <code>final</code> by Lombok by default. Plus, setters will not be generated, and the class itself will be marked as <code>final</code>. This way, the class will not be inheritable. Just like what happens with <code>@Data</code>, <code><span>toString</span><span>(</span><span>)</span></code>, <code><span>equals</span><span>(</span><span>)</span></code> and <code><span>hashCode</span><span>(</span><span>)</span></code> implementations are also created.</p><h4 id="With-Lombok">With Lombok</h4><pre><code><span>@Data</span>
<span>public</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>int</span> id<span>;</span>
    <span>String</span> name<span>;</span>
    <span>String</span> surname<span>;</span>
<span>}</span></code></pre><h4 id="Java-Vanilla">Java Vanilla</h4><pre><code><span>public</span> <span>final</span> <span>class</span> <span>Author</span> <span>{</span>
    <span>private</span> <span>final</span> <span>int</span> id<span>;</span>
    <span>private</span> <span>final</span> <span>String</span> name<span>;</span>
    <span>private</span> <span>final</span> <span>String</span> surname<span>;</span>

    <span>public</span> <span>Author</span><span>(</span><span>int</span> id<span>,</span> <span>String</span> name<span>,</span> <span>String</span> surname<span>)</span> <span>{</span>
      <span>this</span><span>.</span>id <span>=</span> id
      <span>this</span><span>.</span>name <span>=</span> name
      <span>this</span><span>.</span>surname <span>=</span> surname
    <span>}</span>  

    <span>public</span> <span>int</span> <span>getId</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> id<span>;</span>
    <span>}</span>

    <span>public</span> <span>String</span> <span>getName</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> name<span>;</span>
    <span>}</span>

    <span>public</span> <span>String</span> <span>getSurname</span><span>(</span><span>)</span> <span>{</span>
        <span>return</span> surname<span>;</span>
    <span>}</span>

    <span>@Override</span> 
    <span>public</span> <span>int</span> <span>hashCode</span><span>(</span><span>)</span> <span>{</span>
        <span>final</span> <span>int</span> PRIME <span>=</span> <span>31</span><span>;</span>
        <span>int</span> result <span>=</span> <span>1</span><span>;</span>
        result <span>=</span> prime <span>*</span> result <span>+</span> <span>getId</span><span>(</span><span>)</span><span>;</span>
        result <span>=</span> prime <span>*</span> result <span>+</span> <span>(</span><span>(</span><span>getName</span><span>(</span><span>)</span> <span>==</span> <span>null</span><span>)</span> <span>?</span> <span>0</span> <span>:</span> <span>getName</span><span>(</span><span>)</span><span>.</span><span>hashCode</span><span>(</span><span>)</span><span>)</span><span>;</span>
        result <span>=</span> prime <span>*</span> result <span>+</span> <span>(</span><span>(</span><span>getSurname</span><span>(</span><span>)</span> <span>==</span> <span>null</span><span>)</span> <span>?</span> <span>0</span> <span>:</span> <span>getSurname</span><span>(</span><span>)</span><span>.</span><span>hashCode</span><span>(</span><span>)</span><span>)</span><span>;</span>
        <span>return</span> result<span>;</span>
    <span>}</span>

    <span>@Override</span> 
    <span>public</span> <span>boolean</span> <span>equals</span><span>(</span><span>Object</span> o<span>)</span> <span>{</span>
        <span>if</span> <span>(</span>o <span>==</span> <span>this</span><span>)</span> <span>return</span> <span>true</span><span>;</span>
        <span>if</span> <span>(</span><span>!</span><span>(</span>o <span>instanceof</span> <span>Author</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
        <span>Author</span> other <span>=</span> <span>(</span><span>Author</span><span>)</span> o<span>;</span>
        <span>if</span> <span>(</span><span>!</span>other<span>.</span><span>canEqual</span><span>(</span><span>(</span><span>Object</span><span>)</span><span>this</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
        <span>if</span> <span>(</span><span>this</span><span>.</span><span>getId</span><span>(</span><span>)</span> <span>==</span> <span>null</span> <span>?</span> other<span>.</span><span>getId</span><span>(</span><span>)</span> <span>!=</span> <span>null</span> <span>:</span> <span>!</span><span>this</span><span>.</span><span>getId</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>other<span>.</span><span>getId</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
        <span>if</span> <span>(</span><span>this</span><span>.</span><span>getName</span><span>(</span><span>)</span> <span>==</span> <span>null</span> <span>?</span> other<span>.</span><span>getName</span><span>(</span><span>)</span> <span>!=</span> <span>null</span> <span>:</span> <span>!</span><span>this</span><span>.</span><span>getName</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>other<span>.</span><span>getName</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
        <span>if</span> <span>(</span><span>this</span><span>.</span><span>getSurname</span><span>(</span><span>)</span> <span>==</span> <span>null</span> <span>?</span> other<span>.</span><span>getSurname</span><span>(</span><span>)</span> <span>!=</span> <span>null</span> <span>:</span> <span>!</span><span>this</span><span>.</span><span>getSurname</span><span>(</span><span>)</span><span>.</span><span>equals</span><span>(</span>other<span>.</span><span>getSurname</span><span>(</span><span>)</span><span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>
        <span>return</span> <span>true</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre><h2 id="Advanced-Lombok-Annotations">Advanced Lombok Annotations</h2><p>Here you can find the most complex Lombok annotations. Each of them will be explained and then seen in use compared to the equivalent Java vanilla translation. To see examples and get more support, click on each annotation and visit its page on the <a href="https://projectlombok.org/features/all" target="_blank" rel="noreferrer noopener">Lombok official documentation</a>.</p><h3 id="---Cleanup---https---projectlombok-org-features-Cleanup-"><a href="https://projectlombok.org/features/Cleanup" target="_blank" rel="noreferrer noopener"><code>@Cleanup</code></a></h3><p><code>@Cleanup</code> can be used to ensure a given resource is automatically cleaned up before leaving the current scope. By default, the cleanup method of the annotated resource is assumed to be <code><span>close</span><span>(</span><span>)</span></code>, but you can specify the name of the desired method to be called instead. Note that this annotation works by harnessing the <a href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html" target="_blank" rel="noreferrer noopener">try-with-resources statement</a>.</p><h4 id="With-Lombok">With Lombok</h4><pre><code><span>public</span> <span>class</span> <span>CleanupDemo</span> <span>{</span>
  <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>
    <span>@Cleanup</span> 
    <span>InputStream</span> input <span>=</span> <span>new</span> <span>FileInputStream</span><span>(</span>args<span>[</span><span>0</span><span>]</span><span>)</span><span>;</span>

    <span>@Cleanup</span> 
    <span>OutputStream</span> output <span>=</span> <span>new</span> <span>FileOutputStream</span><span>(</span>args<span>[</span><span>1</span><span>]</span><span>)</span><span>;</span>

    <span>byte</span><span>[</span><span>]</span> b <span>=</span> <span>new</span> <span>byte</span><span>[</span><span>10000</span><span>]</span><span>;</span>

    <span>while</span> <span>(</span><span>true</span><span>)</span> <span>{</span>
      <span>int</span> r <span>=</span> input<span>.</span><span>read</span><span>(</span>b<span>)</span><span>;</span>

      <span>if</span> <span>(</span>r <span>==</span> <span>-</span><span>1</span><span>)</span> 
        <span>break</span><span>;</span>

      output<span>.</span><span>write</span><span>(</span>b<span>,</span> <span>0</span><span>,</span> r<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre><h4 id="Java-Vanilla">Java Vanilla</h4><pre><code><span>public</span> <span>class</span> <span>CleanupDemo</span> <span>{</span>
  <span>public</span> <span>static</span> <span>void</span> <span>main</span><span>(</span><span>String</span><span>[</span><span>]</span> args<span>)</span> <span>throws</span> <span>IOException</span> <span>{</span>
    <span>try</span> <span>(</span><span>OutputStream</span> output <span>=</span> <span>new</span> <span>FileOutputStream</span><span>(</span>args<span>[</span><span>1</span><span>]</span><span>)</span><span>)</span> <span>{</span>
      <span>try</span> <span>(</span><span>InputStream</span> input <span>=</span> <span>new</span> <span>FileInputStream</span><span>(</span>args<span>[</span><span>0</span><span>]</span><span>)</span><span>)</span> <span>{</span>
        <span>byte</span><span>[</span><span>]</span> b <span>=</span> <span>new</span> <span>byte</span><span>[</span><span>10000</span><span>]</span><span>;</span>

        <span>while</span> <span>(</span><span>true</span><span>)</span> <span>{</span>
          <span>int</span> r <span>=</span> input<span>.</span><span>read</span><span>(</span>b<span>)</span><span>;</span>

          <span>if</span> <span>(</span>r <span>==</span> <span>-</span><span>1</span><span>)</span> 
            <span>break</span><span>;</span>

          output<span>.</span><span>write</span><span>(</span>b<span>,</span> <span>0</span><span>,</span> r<span>)</span><span>;</span>
        <span>}</span>
      <span>}</span>       
    <span>}</span> 
  <span>}</span>
<span>}</span></code></pre><h3 id="---Synchronized---https---projectlombok-org-features-Synchronized-"><a href="https://projectlombok.org/features/Synchronized" target="_blank" rel="noreferrer noopener"><code>@Synchronized</code></a></h3><p><code>@Synchronized</code> allows you to achieve something similar to the <a href="https://docs.oracle.com/javase/tutorial/essential/concurrency/syncmeth.html" target="_blank" rel="noreferrer noopener"><code>synchronized</code></a> keyword, but locking on different objects. The keyword locks on <code><span>this</span></code>, while the annotation locks on a special private field named <code>$lock</code>. If this field does not exist, it will be created by Lombok. This is the default behavior, but you can also specify lock objects yourself. When dealing with <code><span>static</span></code> methods, the annotation will lock on a static field named <code>$<span>LOCK</span></code>. Please, consider that just like <code>synchronized</code>, the annotation can only be used on static and instance methods. </p><h4 id="With-Lombok">With Lombok</h4><pre><code><span>public</span> <span>class</span> <span>SynchronizedDemo</span> <span>{</span>
  <span>private</span> <span>final</span> <span>Object</span> objectToLock <span>=</span> <span>new</span> <span>Object</span><span>(</span><span>)</span><span>;</span>
  
  <span>@Synchronized</span>
  <span>public</span> <span>static</span> <span>void</span> <span>sayHello</span><span>(</span><span>)</span> <span>{</span>
    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>&#34;Hello!&#34;</span><span>)</span><span>;</span>
  <span>}</span>
  
  <span>@Synchronized</span>
  <span>public</span> <span>int</span> <span>getOne</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> <span>1</span><span>;</span>
  <span>}</span>
  
  <span>@Synchronized</span><span>(</span><span>&#34;objectToLock&#34;</span><span>)</span>
  <span>public</span> <span>void</span> <span>printObject</span><span>(</span><span>)</span> <span>{</span>
    <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>objectToLock<span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre><h4 id="Java-Vanilla">Java Vanilla</h4><pre><code><span>public</span> <span>class</span> <span>SynchronizedDemo</span> <span>{</span>
  <span>private</span> <span>static</span> <span>final</span> <span>Object</span> $LOCK <span>=</span> <span>new</span> <span>Object</span><span>[</span><span>0</span><span>]</span><span>;</span>
  <span>private</span> <span>final</span> <span>Object</span> $lock <span>=</span> <span>new</span> <span>Object</span><span>[</span><span>0</span><span>]</span><span>;</span>
  <span>private</span> <span>final</span> <span>Object</span> readLock <span>=</span> <span>new</span> <span>Object</span><span>(</span><span>)</span><span>;</span>
  
  <span>public</span> <span>static</span> <span>void</span> <span>sayHello</span><span>(</span><span>)</span> <span>{</span>
    <span>synchronized</span><span>(</span>$LOCK<span>)</span> <span>{</span>
      <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span><span>&#34;Hello&#34;</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
  
  <span>public</span> <span>int</span> <span>getOne</span><span>(</span><span>)</span> <span>{</span>
    <span>synchronized</span><span>(</span>$lock<span>)</span> <span>{</span>
      <span>return</span> <span>1</span><span>;</span>
    <span>}</span>
  <span>}</span>
  
  <span>public</span> <span>void</span> <span>printObject</span><span>(</span><span>)</span> <span>{</span>
    <span>synchronized</span><span>(</span>readLock<span>)</span> <span>{</span>
      <span>System</span><span>.</span>out<span>.</span><span>println</span><span>(</span>objectToLock<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre><h3 id="---SneakyThrows---https---projectlombok-org-features-SneakyThrows-"><a href="https://projectlombok.org/features/SneakyThrows" target="_blank" rel="noreferrer noopener"><code>@SneakyThrows</code></a></h3><p><code>@SneakyThrows</code> can be used to sneakily throw checked exceptions without actually declaring them in your method&#39;s <code>throws</code> clause, as you normally would. So, this annotation allows you to avoid the required <code><span>try</span><span>-</span>catch</code> blocks completely by handling all the checked exceptions quietly. Lombok will not ignore, wrap, replace, or modify the thrown checked exception. On the contrary, it will mislead the compiler. In fact, at the JVM (<a href="https://en.wikipedia.org/wiki/Java_virtual_machine" target="_blank" rel="noreferrer noopener">Java Virtual Machine</a>) class file level, all exceptions can be thrown regardless of the <code>throws</code> clause of your methods, which is why this works. This annotation can be dangerous and should be used carefully. This is why you should read <a href="https://projectlombok.org/features/SneakyThrows" target="_blank" rel="noreferrer noopener">this</a> page from the Lombok official documentation to learn more about when and how to use it.</p><h3 id="---Builder---https---projectlombok-org-features-Builder-"><a href="https://projectlombok.org/features/Builder" target="_blank" rel="noreferrer noopener"><code>@Builder</code></a></h3><p>You may need to develop a builder object allowing you to create objects by following a step-by-step construction pattern, such as <code>Author<span>.</span><span>builder</span><span>(</span><span>)</span><span>.</span><span>id</span><span>(</span><span>&#34;1&#34;</span><span>)</span><span>.</span><span>name</span><span>(</span><span>&#34;Maria&#34;</span><span>)</span><span>.</span><span>surname</span><span>(</span><span>&#34;Williams&#34;</span><span>)</span><span>.</span><span>build</span><span>(</span><span>)</span><span>;</span></code>. This is particularly useful when dealing with large classes with several fields. Instead of using a constructor with many parameters, you can use this more readable approach.
By using the <code>@Builder</code> annotation, you let Lombok generate the builders for you. By annotating a class with <code>@Builder</code>, Lombok will produce a class implementing the aforementioned builder pattern. For example, by annotating the <code>Author</code> class, an <code>AuthorBuilder</code> class will be automatically generated. Since the behavior of your builder may be complex or highly-tailored, Lombok offers many parameters to achieve the desired result. You can find out them all <a href="https://projectlombok.org/features/Builder" target="_blank" rel="noreferrer noopener">here</a>.</p><h3 id="---Log---https---projectlombok-org-features-log-"><a href="https://projectlombok.org/features/log" target="_blank" rel="noreferrer noopener"><code>@Log</code></a></h3><p>The majority of loggers require you to set up a logger instance in every class where you want to log. This definitely involves boilerplate code. By annotating a class with <code>@Log</code>, Lombok will automatically add a static final <code>log</code> field, initialized as required by your logging library. This is why Lombok provides developers with an annotation per each of the most popular logging frameworks. You can find the entire list <a href="https://projectlombok.org/features/log" target="_blank" rel="noreferrer noopener">here</a>.</p><h2 id="The-Lombok-Plugin">The Lombok Plugin</h2><p>The most popular and widely used IDEs come with an official Lombok plugin designed to help developers use Lombok. In particular, it supports you by offering shortcuts to the most common Lombok annotation. Plus, it suggests to you the annotations you may require or be looking for based on where you clicked. At the time of writing <a href="https://projectlombok.org/setup/intellij" target="_blank" rel="noreferrer noopener">IntelliJ IDEA</a>, <a href="https://projectlombok.org/setup/eclipse" target="_blank" rel="noreferrer noopener">Eclipse, Spring Tool Suite, (Red Hat) JBoss Developer Studio, MyEclipse</a>, <a href="https://projectlombok.org/setup/vscode" target="_blank" rel="noreferrer noopener">Microsoft Visual Studio Code</a>, and <a href="https://projectlombok.org/setup/netbeans" target="_blank" rel="noreferrer noopener">Netbeans</a> are officially supported. Follow the link related to your IDE to get support on how to install it.
Visit the <a href="https://projectlombok.org/" target="_blank" rel="noreferrer noopener">Lombok</a> website for the complete list of all supported IDEs.</p><h2 id="Is-Using-Lombok-A-Risk-">Is Using Lombok A Risk?</h2><p>You may be concerned about spreading Lombok annotations throughout your codebase. In fact, what would happen if you decided to avoid using it? You might be finding yourself stuck. Well, this is not a real problem because Lombok comes with a <em>delombok</em> tool. 
As stated <a href="https://projectlombok.org/features/delombok" target="_blank" rel="noreferrer noopener">in the official documentation</a>, although not covering all possible IDEs and cases, it makes the process of freeing your code from Lombok easier. What this tool does is auto-generate Java source code containing the same features contained in the bytecode Lombok would have injected. This way, your Lombok annotated codebase will be simply replaced with a standard, non-Lombok Java one. 
As a result, your entire project will no longer depend on Lombok. So, to answer the original question, no, not at all. Using Lombok does not represent a risk for the future or your project.</p><h2 id="Conclusion">Conclusion</h2><p>In this article, we looked at how to use Project Lombok, a Java library that automatically plugs into your editor and builds tools, to avoid writing boilerplate, boring, and repetitive code Java is well known for. As shown, this is an easy way to make you a more productive developer and do not waste your time on cumbersome activities. By starting to take advantage of its most relevant annotations, you can avoid writing thousand of lines of code with no real value from the business logic point of view of your project. Plus, there is always the possibility to make your project no longer depend on Project Lombok easily. So, it using it does not represent a risk of finding yourself locked in. In conclusion, every Java developer should use Project Lombok, and explaining everything you need to start using it is what this article was aimed at.</p><p>Thanks for reading! I hope that you found this article helpful. Feel free to reach out to me with any questions, comments, or suggestions.</p></div></div>]]></content:encoded>
      <pubDate>Thu, 29 Jul 2021 16:55:00 +0000</pubDate>
    </item>
    <item>
      <title>Workforce and App Privacy Have Changed, So Should You</title>
      <link>https://auth0.com/blog/workforce-and-app-privacy-have-changed-so-should-you/</link>
      <description>Go fast but not alone ‚Äî our leaders are here to help secure your workforce and app privacy.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>Accelerating digital road maps by seven to 10 years likely left you with some things to review from a security perspective. Please check out the <a href="https://auth0.com/blog/accelerated-your-road-map-go-fix-workforce-and-app-security" target="_blank" rel="noreferrer noopener">first post in this series</a> for what you might need to review to securely support your remote or hybrid workforce, as well as a checklist for consumer-facing apps.</p><p>Security isn‚Äôt the only thing that can get overlooked when we go fast.  As well as implementing technical protections ‚Äî we also need to understand what and how the data and how impacts the humans that use technology. This is where privacy comes in. Privacy is having a critical global impact on software development because consumers, businesses, and governments are demanding that technology operates in a way that complies with legislation like GDPR (General Data Privacy Regulation), CPRA (California Public Records Act), APPI (Act on the Protection of Personal Information), and LGPD (Lei Geral de Prote√ß√£o de Dados Pessoais). This is an opportunity to rethink exactly what and how much data is collected, how it‚Äôs used, and who gets to see it. It‚Äôs a turning point where individuals are no longer blithely accepting that massive amounts of data about them are being created, shared, and used.</p><p>At Auth0, I regularly collaborate with our vice president of privacy, Lucy McGrath, and she is a part of my organization. For this series, I asked Lucy for her perspective on data privacy mistakes companies can make when they move fast.</p><p>An integrated approach is essential for security and privacy. There‚Äôs a saying if you want to go fast, go alone, but if you want to go far, go together. This is changing ‚Äî you can‚Äôt protect privacy alone. If you go alone, you won‚Äôt go anywhere. ‚ÄúUltimately, data privacy is about trust,‚Äù says Lucy. ‚ÄúAnd it‚Äôs a collaborative effort. You can‚Äôt think about security or data governance, or privacy in isolation. You need to work across departments within your organization and also listen to your staff and your consumers/users. From a practical standpoint, you need to work with others even beyond your immediate business ‚Äî data privacy regulations are changing rapidly ‚Äîtechnical solutions are essential in order to scale privacy compliant technology. If you don‚Äôt collaborate, you‚Äôll be left behind.‚Äù</p><p>Lucy‚Äôs insights on remote/hybrid workforces and consumer-facing apps can improve your workplace culture and improve your relationships with your customers ‚Äî and keep you focused on your business rather than dealing with regulators and potentially incurring large fines.</p><h2 id="Put-Your-Focus-on-the-Human">Put Your Focus on the Human</h2><p>‚ÄúProbably the most important thing to remember when thinking through data privacy is that you‚Äôre delivering a service that impacts humans,‚Äù says Lucy. ‚ÄúWe can get dazzled by what technology can do, but the technology is really there to help the humans accomplish something. Centering on the human who needs to use or benefit from the technology helps you to focus.  ‚Äî and align with existing and emerging data privacy regulations.‚Äù</p><p>As always, this information is shared from the perspective of business impact and planning. For how data privacy regulations apply to your specific business situation, please reach out to your legal counsel.</p><blockquote><p>Auth0 recommends you always consult legal counsel for specific advice about compliance with legal requirements.</p></blockquote><p><strong>The workforce mix: remote, hybrid, in office</strong></p><p>If your company relies on a globally dispersed workforce (or acquired one during the pandemic), you‚Äôre likely dealing with a mix of employees who welcome some office quietly, some still struggling with lockdown requirements, and others who may not expect to see vaccines become available until fall. ‚ÄúAs you look at creating or reviewing policies, it‚Äôs especially important to remember that there‚Äôs a human on the other side of the Zoom screen‚Äù, says Lucy. ‚ÄúThis is a good time for your HR team to check back in with staff. Circumstances and perspectives have changed for many people as a result of the pandemic. One size definitely will not fit all.‚Äù</p><p>Understanding that worker privacy rights vary globally, here are some areas to review:</p><h3 id="1--How-you-measure-productivity">1. How you measure productivity</h3><p>For organizations used to seeing people in chairs, the shift to Zoom screens caused some anxiety. Interestingly, <a href="https://www.bcg.com/publications/2020/valuable-productivity-gains-covid-19" target="_blank" rel="noreferrer noopener">75% of 12,000 workers surveyed by BCG</a> in the United States, Germany, and India felt they were able to maintain or increase productivity on individual tasks during the pandemic. </p><p>Some of that may have been accomplished by blurring the lines between home and work, says Lucy. </p><p>Surveillance technologies like keyloggers, video monitoring, and attention tracking via biometrics have been rising in adoption even before the pandemic. We‚Äôre hearing this often says, Lucy: ‚ÄúI like my boss ‚Äî a lot ‚Äî  but I would find it a bit creepy if she was tracking every word I write, tracking when I popped off to the loo and listening to my family conversations. And it would make it harder to do my job because I would feel unnecessarily surveilled. It‚Äôs really important to assess the correct way to protect data and maintain trust with your employees as humans. Especially with workers working from home in potentially cramped situations, you could be gathering data you don‚Äôt need and shouldn‚Äôt have.</p><p>‚ÄúWorkers generally know that emails are subject to company oversight nearly everywhere, but it‚Äôs essential to be transparent about monitoring activities across all applications and devices. Transparency also encourages trust and increases the likelihood that individuals will report issues/mistakes they encounter. Tell them about how long you retain the data, and why and be sure to check local rules about internal and external data sharing ‚Äî they can vary by region and even by state in the United States. It‚Äôs important to only keep what you really need to perform a task,‚Äù says Lucy.</p><h3 id="2--How-do-you-encourage-collaboration-">2. How do you encourage collaboration?</h3><p>Nearly everyone became Zoom-literate in 2020. Many people were introduced to Slack or other collaboration tools, and some folks also mixed in personal texts. ‚ÄúAs great as these technologies are ‚Äî and I am speaking as someone who enjoys working with a globally distributed workforce ‚Äî they‚Äôre not going to replicate the physical space. From a privacy perspective, some small changes can mean a lot to employees,‚Äù says Lucy.</p><p>‚ÄúSome people enjoy having dogs and kids flow in and out of their workplace. Others prefer to keep things separated. Over the last several months, I‚Äôve noticed some colleagues making different choices.‚Äù</p><p>Things like Zoom backgrounds can protect employee privacy, but only if they know how to use the tools. If you‚Äôre using a collaboration tool like Zoom or Slack, document expected uses, alternatives on offer (as applicable) and make sure employees know how to use tools like Zoom backgrounds. </p><h3 id="3--Onboarding-can-protect-against-data-breaches">3. Onboarding can protect against data breaches</h3><p>Normally, we bring our new employees to our Bellevue, Wash. offices for onboarding. This in-person connection brings all kinds of benefits, including protecting data. ‚ÄúOnboarding may seem like an odd place to bring up data privacy, but people are more likely to feel comfortable reporting potential problems or even breaches when they have formed a connection to their colleagues,‚Äù says Lucy.</p><p>Establishing connections may mean creating social events (likely on Zoom) or connecting employees for non-work meetings. We have an app that randomly pairs employees for casual chat sessions we call ‚Äúdonuts.‚Äù It‚Äôs a surprisingly effective way to establish connection and get to know about the day-to-day work life of far-flung colleagues.</p><h3 id="4--Security-and-Privacy-of-Customers-is-Key">4. Security and Privacy of Customers is Key</h3><p>‚ÄúWe‚Äôve had workers who used to be home by themselves all day, suddenly have teenaged children pass through meetings on the way to the fridge,‚Äù says Lucy. ‚ÄúIt‚Äôs charming, but it also means that family members might see things they‚Äôre not meant to see. You need to recognize that not everyone has the luxury of a room with a door and a lock. Protecting customer security and privacy is key.‚Äù</p><p>To your security protocols, Lucy would also suggest adding:</p><ul><li>Headphones so you can control what can be overheard (and coaching that awareness with your teams)</li><li>Privacy screens for monitors</li><li>Printed material (and the printer) needs to be kept in a space that remains locked when not in use</li></ul><h2 id="Data-Privacy-Checklist-for-Consumer-Facing-Apps">Data Privacy Checklist for Consumer-Facing Apps</h2><p>COVID has brought populations that are used to trust in physical environments online, says Lucy. This is part of why in the UK we‚Äôre seeing <a href="https://www.theguardian.com/money/2021/may/18/delivery-text-scams-the-nasty-new-wave-sweeping-the-uk" target="_blank" rel="noreferrer noopener">increase in delivery text phishing scams</a> where additional funds are requested for delivery. Many of these ploys play on user trust and the expectation that information is being shared securely. We‚Äôll get deeper into how consumers are demanding a secure and contextual private experience in the final post. As preparation, here is a data privacy checklist. Please follow up with your legal counsel on your specifics.</p><ol start="1"><li><strong>Review what you‚Äôve got and why you‚Äôve got it and how you‚Äôre getting it.</strong> It‚Äôs not uncommon for apps to gather more information than is necessary to do the job. You need to know what data you have and why you‚Äôre collecting it as well how it‚Äôs stored to comply with regulations ‚Äî and to know how to safeguard your customers‚Äô data. <strong>This includes third-party vendors and your marketing teams.</strong></li><li><strong>Make sure your code only collects data you really need</strong>. The days of data gluttony are coming to an end. Individuals are rightly fed up with the attitude of ‚Äújust because you can collect as much data as possible, you do. Ask yourself: do you use all the data you collect? Don‚Äôt be afraid to reduce the amount of data you collect when you update your app or add new products. Look for opportunities to innovate by using privacy-enhancing technologies to mask or anonymize, or de-identify data. And safely delete the information you don‚Äôt use.</li><li><strong>Know where your customers are and check out the regulations.</strong> While the EU‚Äôs General Data Privacy Regulation (GDPR) has become the benchmark for data privacy, not every regulation is GDPR. There are differences. Children also often have extra protections. Once you‚Äôve identified where and who your customers are, work closely with your legal counsel to design the right approach.</li><li><strong>Securely delete info and keep a record.</strong> Maybe you‚Äôre deleting information due to a verified request or because you have data you actually don‚Äôt need; either way, you need to keep a record.</li><li><strong>Make sure you have someone responsible for privacy who respects the humans interacting with your app.</strong> This stuff is not simple. You need someone who looks after it.</li><li><strong>Look out for service departments or social media complaints.</strong> Complaints can show you how the public perceives their data is being used ‚Äî and identify areas that need your attention.</li><li><strong>Communicate clearly with your users.</strong> Users often need to know how to unsubscribe and other rights as part of data privacy regulations.</li><li><strong>Do as you would be done by.</strong> Think through how you‚Äôd like your data to be treated. That‚Äôs a good guideline. But also think about the specific customer base - what‚Äôs their perspective and might they require additional protections (e.g., if they are a vulnerable group).</li><li><strong>Consult your legal counsel.</strong> Data privacy is a rapidly evolving field. Lawyers really are your friends! Please check in with your legal counsel regularly, and especially if you‚Äôre thinking of expanding into a new region.</li></ol><h2 id="Learn-More-about-Identity-s-Role-in-Your-Data-Privacy-Strategy">Learn More about Identity‚Äôs Role in Your Data Privacy Strategy</h2><p>As Lucy says, you can have security without privacy, but you can‚Äôt have privacy without security if you‚Äôd like to learn more about how a robust identity solution can support your data privacy and security strategies, <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">please reach out to the team at Auth0</a>.</p><p>In the final post in the Acceleration Response Series, we‚Äôll look at how creating a long-term plan for security and privacy can help you meet consumers‚Äô demands.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>Auth0‚Äôs modern approach to identity enables organizations to provide secure access to any application, for any user. The Auth0 platform is a highly customizable identity operating system that is as simple as development teams want and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Thu, 29 Jul 2021 15:08:00 +0000</pubDate>
    </item>
    <item>
      <title>Can Your Identity Solution Grow With Your Company?</title>
      <link>https://auth0.com/blog/can-your-identity-solution-grow-with-your-company/</link>
      <description>The tech market in Latin America is growing; Auth0 can help you keep up with a scalable identity solution.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><div><p>The number of Venture Capital deals signed in Latin America hit a record high of 488 in 2020. That‚Äôs nearly double the 2017 number according to <a href="https://www.bloomberg.com/news/articles/2021-03-16/latin-american-startups-had-record-venture-capital-deals-in-2020" target="_blank" rel="noreferrer noopener">Bloomberg</a>. The growth in the tech market in LatAm isn‚Äôt only apparent in new startup deals; companies who already have a presence in the region are expanding both through mergers and acquisitions and by looking into new countries to grow their footprint in the region. </p><p>Each scenario brings its own challenges for your IT infrastructure, particularly your<a href="https://auth0.com/blog/how-to-scale-quickly-with-identity/" target="_blank" rel="noreferrer noopener"> identity solution</a>. If you‚Äôre expanding into a new country, there‚Äôs likely to be a different data privacy regulation you‚Äôll have to comply with. And that startup you‚Äôre eyeing probably has a vastly different infrastructure than yours, whether private or public cloud or even legacy on-prem. An Identity management solution has to be able to expand and flex in order to grow with your company, regardless of the specific scenario.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1HnNeEEQ4hCBb2M4y2ZerT/5b5a1de004ea8021fdc38d042a85a672/Latam05.jpg" alt="Business Expansion"/></p><h2 id="With-Business-Expansion-Come-Business-Questions">With Business Expansion Come Business Questions</h2><p>Let‚Äôs take a look at those two potential growth scenarios and what they mean for your business‚Äôs identity solution. First up is the acquisition of a competitor or related smaller entity. <a href="https://auth0.com/blog/why-your-ma-strategy-has-to-include-an-iam-solution/" target="_blank" rel="noreferrer noopener">Mergers and acquisitions</a> (M&amp;A) always bring an array of unique challenges, but for this article, we‚Äôre going to focus on the identity challenges associated with the merging of IT infrastructure.</p><p>Your web app may be hosted on a public cloud, but the company you just bought has been in business for a while and is still using on-prem hosting for theirs. In order for you to bring both properties together under one identity solution, you need one that can bridge the gap between the two, allowing your new audience access to both apps without managing multiple sets of credentials.</p><p>In our second scenario, your organization is considering an expansion into a neighboring country to take advantage of the easing of business restrictions and the growing market for your product that your marketing team has identified. You already comply with the privacy regulations in your country, but are you ready to comply with those abroad? </p><p>Is your organization ready to answer questions like these:</p><ul><li>Can our existing in-house identity platform scale to include our hybrid-cloud infrastructure and the legacy system our latest acquisition uses?</li><li>Is our identity solution ready to handle the influx of new user accounts and login requests when we roll out to our new market?</li><li>Is our consent gathering process in compliance with the regulations in the country we‚Äôre expanding into?</li></ul><p>If not, or if the answer to any of these questions is ‚Äúno,‚Äù it may be time to consult with an identity specialist. </p><blockquote><a href="https://twitter.com/intent/tweet?text=&#34;Auth0%20recommends%20you%20always%20consult%20legal%20counsel%20when%20it%20comes%20to%20complying%20with%20data%20privacy%20regulations.&#34; via @auth0 https://auth0.com/blog/can-your-identity-solution-grow-with-your-company" target="_blank" rel="noopener noreferrer"><p>&#34;Auth0 recommends you always consult legal counsel when it comes to complying with data privacy regulations.&#34;</p><div><p><img alt="Tweet" src="https://cdn.auth0.com/blog/resources/twitter.svg"/></p><h4>Tweet This</h4></div></a></blockquote><h2 id="Auth0-Is-the-Identity-Solution-That-Scales-With-You">Auth0 Is the Identity Solution That Scales With You</h2><p>Both of these scenarios mean you‚Äôre going to be scaling your infrastructure, adding users to existing web apps, and even adding new web apps. Having an identity solution in place that can easily expand to include controlling access to these new properties can help reign in costs and speed your time to market post-expansion. Our customers tell us that by using Auth0 for their authentication and identity needs, they took their time-to-value from months or years down to weeks or even days.</p><p>Credit card company <a href="https://www.marketwatch.com/story/visa-sees-massive-digital-acceleration-with-millions-trying-e-commerce-for-the-first-time-2020-05-13" target="_blank" rel="noreferrer noopener">Visa reported</a> that during just the first month of the COVID-19 pandemic, more than 13 million cardholders in Latin America made their very first e-commerce transaction. That‚Äôs 13 million new accounts being created, 13 million new logins, and 13 million opportunities for identity to go wrong if your solution isn‚Äôt scalable. There are many aspects to what makes something scalable. When it comes to identity, we see five as being the most important.</p><ol start="1"><li><strong>Bridging legacy and cloud systems</strong></li></ol><p>One of the downsides to M&amp;A is that your IT department inherits the backend infrastructure of the other company, for better or worse. Auth0‚Äôs extensive SDK libraries and robust APIs mean it‚Äôs a simple matter to bridge the gap between legacy systems and modern cloud-first ones. One login box can take your current and new customers to both web apps, no matter where they‚Äôre hosted. This ability also speeds your time to value because your developers can maintain focus on their core product delivery rather than piecing together connectivity solutions that may only work for a short time.</p><ol start="2"><li><strong>Single source of truth for customer data</strong></li></ol><p>Bringing all of your customer data together into one single source of truth (SSoT) makes it that much easier to protect. It also speeds access when a user logs in, as no matter which property they‚Äôre using, it has only one place to look to find their credentials, rather than scouring multiple data silos.</p><ol start="3"><li><strong>Single sign-on</strong></li></ol><p>Customers want low-friction experiences online, and being able to create an account using credentials they already have is a great way to win them over. Single sign-on (using account information from a provider like Apple, Facebook, or Twitter) allows a customer to create an account on your site quickly and easily, and without the need to create and remember a new password.</p><ol start="4"><li><strong>Breach protection</strong></li></ol><p>The issue of passwords brings us to a major sticking point for many identity solutions, protecting user information from data breaches. According to the most recent <a href="https://www.ibm.com/security/data-breach" target="_blank" rel="noreferrer noopener">IBM/Ponemon Cost of a Data Breach Study</a>, the global average cost of a breach is now $3.86 million (USD). And Verizon reports in their <a href="https://www.verizon.com/business/resources/reports/dbir/" target="_blank" rel="noreferrer noopener">2021 Data Breach Investigations Report</a> that 61% of breaches involve misuse of credentials. Put those together, and you see why protecting your customers‚Äô information is such a major piece of scaling your online business presence and why a robust identity solution needs to take this aspect into account.</p><ol start="5"><li><strong>Protection from staffing fluctuations</strong></li></ol><p>An often overlooked aspect of identity projects is the simple fact that people change jobs. If you have an identity tool that was developed in-house two years ago, there‚Äôs a good chance you won‚Äôt have anyone on staff who can expand it to cover your new properties. That will delay roll-out and extend your time-to-market. </p><p><a href="https://auth0.com/case-studies/wabipay/" target="_blank" rel="noreferrer noopener">Auth0 customer WABI</a> is modernizing e-commerce in Latin America. They‚Äôre currently active in 11 countries and have expansion plans to add four more in 2021. And they‚Äôre trusting Auth0 to scale their identity solution to match these ambitious plans. ‚ÄúWABI is scalable, and we need a partner that is, too. We believe Auth0 will support us in getting there.‚Äù Says WABI Business Manager Juan Manuel Mingo. With their planned expansion opening their market to millions of potential new customers, WABI knows they need a robust identity platform that‚Äôs ready to handle the influx of new users.</p><h2 id="Auth0-Brings-Global-Experience-to-Your-Latin-America-Growth-Plans">Auth0 Brings Global Experience to Your Latin America Growth Plans</h2><p>Our founders are from Argentina, the company was started in the United States, and we currently have people in 30+ countries with more being added every day. Our <a href="https://auth0.com/blog/auth0-expands-global-partner-network-in-latin-america-with-clm/" target="_blank" rel="noreferrer noopener">international team</a> of identity specialists can help you work out your identity needs and help get you set up with an identity as a service (IDaaS) platform that is ready to grow with your company, no matter what your expansion plans look like. We know that having an identity solution designed to be extensible and flexible to move with your business can mean the difference between a successful rollout or a failed acquisition attempt. </p><p>Auth0 is built on open standards, making it easy to connect with existing systems and varying infrastructure scenarios. Bridging the gap between a public cloud-based web app and an on-prem user database is only the beginning. Our extensive marketplace of integrations means you can connect with your existing business software solutions as well.</p><p>Our breach protection includes features such as <a href="https://auth0.com/docs/attack-protection/bot-detection" target="_blank" rel="noreferrer noopener">bot detection</a>, <a href="https://auth0.com/multifactor-authentication" target="_blank" rel="noreferrer noopener">adaptive MFA</a>, <a href="https://auth0.com/single-sign-on" target="_blank" rel="noreferrer noopener">single sign-on</a>, and <a href="https://auth0.com/passwordless" target="_blank" rel="noreferrer noopener">passwordless</a> flows. And the <a href="https://marketplace.auth0.com/" target="_blank" rel="noreferrer noopener">Auth0 Marketplace</a> has what you need to handle everything from consent management to business process software integrations. The protections and extensibility we offer is a key factor in our scalability. </p><p>When the time comes to expand across borders, Auth0 is ready. We‚Äôre certified by a third party as compliant with the International Standards Organization (ISO) standards <a href="https://www.iso.org/obp/ui/#iso:std:iso-iec:27001:ed-2:v1:en" target="_blank" rel="noreferrer noopener">ISO27001</a> and <a href="https://www.iso.org/standard/61498.html" target="_blank" rel="noreferrer noopener">ISO27018</a> for handling information security and personally identifiable information (PII) as a cloud provider.</p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/1sBMtrIri0sAw0OBkWE4QV/41d7fc8b0740ac05ec3c82145fd1478f/Latam06.jpg" alt="Growing"/></p><h2 id="Auth0-is-the-Identity-Solution-That-Can-Keep-Up-With-The-Growing-LatAm-Market">Auth0 is the Identity Solution That Can Keep Up With The Growing LatAm Market</h2><p>To provide your customers with a continuous, low-friction, and intuitive login flow requires a robust identity solution. Whether you‚Äôre scaling internationally or your growth plans call for staying closer to home, Auth0 can provide the IDaaS platform you need to maintain a great customer experience while ensuring the security and privacy of your customer data. And don‚Äôt worry if you‚Äôve already started an identity project and hit a stumbling block, <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">our experts can help</a>. </p><div><h2 id="About-Auth0">About Auth0 </h2><p>Auth0‚Äôs modern approach to identity enables organizations to provide secure access to any application, for any user. The Auth0 platform is a highly customizable identity operating system that is as simple as development teams want and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></div>]]></content:encoded>
      <pubDate>Thu, 29 Jul 2021 11:56:00 +0000</pubDate>
    </item>
    <item>
      <title>Accelerated Your Road Map? Go Fix Workforce and App Security</title>
      <link>https://auth0.com/blog/accelerated-your-road-map-go-fix-workforce-and-app-security/</link>
      <description>Rapid change introduces workforce and app risks. Auth0 Security team‚Äôs advice on what to fix now.</description>
      <content:encoded><![CDATA[<div id="readability-page-1" class="page"><section itemscope="" itemtype="http://schema.org/BlogPosting" itemprop="mainEntity"><header><div><div><p><span>ACCELERATION RESPONSE SERIES</span></p><p itemprop="description">Rapid change introduces workforce and app risks. Auth0 Security team‚Äôs advice on what to fix now.</p></div><p>Last Updated On: July 28, 2021</p><meta itemprop="datePublished" content="2021-07-28"/><meta itemprop="dateModified" content="2021-07-28"/></div></header><header><div><p><img src="https://images.ctfassets.net/23aumh6u8s0i/lpo0yom5xDZonfNzlOkHc/c55bd864b5d7360bf8a2c307f99c8e40/Security_and_Identity_4x.jpg"/></p><div><p><span>ACCELERATION RESPONSE SERIES</span></p><p itemprop="description">Rapid change introduces workforce and app risks. Auth0 Security team‚Äôs advice on what to fix now.</p><p>Last Updated On: July 28, 2021</p><meta itemprop="datePublished" content="2021-07-28"/><meta itemprop="dateModified" content="2021-07-28"/></div></div></header><article><main id="post-content" itemprop="articleBody"><div><p>Fast response allowed many organizations to survive and thrive in 2020. Orgs went remote overnight; businesses launched consumer-facing apps, and <a href="https://auth0.com/blog/how-brick-and-mortar-approaches-improve-digital-experiences/" target="_blank" rel="noreferrer noopener">consumers shifted buying patterns online</a>.</p><p>Going fast gets products to market, it gives consumers choices, and it helps companies scale. But when you jump ahead seven to 10 years in your digital road map, you risk leaving a few security and data privacy concerns behind. I reached out to key members of my security team, as well as our data privacy team, to put together this three-part series based on our industry experience and observations.</p><p>Each post will focus on protecting and securing two critical areas: your workforce and your consumer-facing apps. The first post will focus on security details to check and mitigate now. The second will focus on immediate data privacy concerns with the help of Auth0 Vice President, Privacy Lucy McGrath. And the third post will help you put together a plan for the future that will make it easier the next time you want to turn on the speed ‚Äî and to remain current in an ever-changing security landscape.</p><p>The thing is that security is a global team sport.  As more of us shift to working and living online, everything is more connected ‚Äî and that can be a good thing. Securing your personal identity, your business identity, and helping increase security at your business can actually make an impact. Here‚Äôs what you can do to help make the internet safer for everyone.</p><h2 id="Why-Remote-Work-Forced-a-Change-in-Security-Thinking">Why Remote Work Forced a Change in Security Thinking</h2><p>Before the world started working remotely, a lot of companies used a castle-and-moat approach to security. They relied on a combination of physical security and internal networks to ensure that employees and outsiders only accessed necessary information. They might even have relied on SaaS companies to provide some of their protections, but the thinking was still pretty much ‚Äúprotect the castle.‚Äù</p><p>Suddenly workers were working anywhere in the world, maybe on their own devices. Without remote experience, your security team might not have had time to think through all of the security issues inherent with having remote endpoints. For example, to ensure that they properly protect these assets against current threats like ransomware and malware, it would be appropriate to install leading next-gen antivirus on these machines.</p><p>Role-based privileges and policies also abruptly needed to follow the user. I know I work for an identity company, but it was identity and policy <a href="https://auth0.com/blog/why-identity-federation-matters/" target="_blank" rel="noreferrer noopener">federation</a> that anticipated this need and allowed for a rapid response.</p><p><a href="https://www.businessinsider.com/companies-asking-employees-to-work-from-home-due-to-coronavirus-2020" target="_blank" rel="noreferrer noopener">Now some companies are making work from home a permanent</a> part of their employee offering. Since Auth0 was built as a remote-friendly, globally dispersed company, we‚Äôve had some time to think through the security concerns. Here‚Äôs what you need to consider to protect your customers, your business, and your employees:</p><ol start="1"><li><strong>Secure the endpoints.</strong> Services like CarbonBlack or CrowdStrike can help prevent malware or breaches occurring from endpoints.</li><li><strong>Update bring your own device policies.</strong> Rethink how and where employees are accessing business and customer data. Do you need to restrict access in public spaces? Adjust policies?</li><li><strong>Update action policies</strong>. What do your employees do if a work computer is stolen? What steps do they need to take if the information is exposed at home? A <a href="https://www.darkreading.com/51--of-wfh-parents-say-children-have-accessed-work-accounts/d/d-id/1339754" target="_blank" rel="noreferrer noopener">1Password survey</a> found that 51% of work from home (WFH) parents surveyed said their children had accessed their work accounts, sometimes accidentally deleting necessary files.  How can you support your employees??</li><li><strong>Human risk is increased.</strong> Have a look at the next section.</li></ol><h2 id="The-Human-Element">The Human Element</h2><p>This is the critical part of this series ‚Äî <strong>the human element is the most important aspect of security and data privacy.</strong></p><blockquote><p>Security awareness training needs to happen at every single level of your organization.</p></blockquote><p>A malicious actor is going to use everything you need to do business ‚Äî email address patterns, information on your website, social media posts, and items gleaned from news articles all to try to gain entry to your system. While the attacks will vary, they usually follow this pattern: <strong>human factor</strong> + inject something into the code + lack of input validation + insufficient logging and monitoring.</p><p>If something looks like it‚Äôs coming from your CEO or payroll, an employee might fall for it and supply a way into your system. And once a bad actor is in, there‚Äôs lots they can do.</p><p>But if you train your entire team to watch out for phishing attacks, you can stop them at the first step. <a href="https://auth0.com/blog/protecting-against-phishing-attacks/" target="_blank" rel="noreferrer noopener">This post is a good place to start.</a></p><p>Attacks evolve, so even though security awareness is something you should pause and do now, it‚Äôs something you‚Äôre going to need to do regularly. Developing a security culture throughout your org provides great protection. To do business with some industries like finance or healthcare, the training will be required to cover specific areas and will need to be documented. The training you provide can also help protect your employees in their personal lives.</p><h2 id="Top-7-Things-to-Do-Now-to-Check-Your-App-s-Security">Top 7 Things to Do Now to Check Your App‚Äôs Security</h2><p>This can seem like a lot if you don‚Äôt have an in-house security team (and maybe if you do). One principle of security is encouraging diversity of thought not only because it‚Äôs the right thing to do but because studies show it makes teams more productive. In security, <a href="https://www.mckinsey.com/business-functions/strategy-and-corporate-finance/our-insights/innovation-in-a-crisis-why-it-is-more-critical-than-ever" target="_blank" rel="noreferrer noopener">diversity of thought</a> makes it easier to spot potential threats. This is part of why even large teams rely on external testing vendors and may even need to provide proof of outside testing for certifications like <a href="https://auth0.com/blog/the-csa-star-program-a-business-guide-to-certification/" target="_blank" rel="noreferrer noopener">CSA Star</a> and <a href="https://auth0.com/blog/what-is-pci-a-business-guide-to-compliance/" target="_blank" rel="noreferrer noopener">PCI</a>.</p><ol start="1"><li><strong>Get an external third-party pen test ‚Äî and implement the recommendations</strong>. A penetration test is where you hire a verified third party to attempt to find your app‚Äôs vulnerabilities. They will sign a non-disclosure agreement (NDA) and provide a detailed report outlining their findings and usually with recommended fixes cataloged by severity. Discovering vulnerabilities can be scary, and there is the temptation to use fear to drive organizational change, but we‚Äôve found that partnering and collaborating with other teams and leadership can often get changes implemented faster.</li><li><strong>Review best practices for your cloud-based services.</strong> When people go really fast, they may not take the time to fully understand the technology and security controls. This is a great time to go back and pay really close attention to the docs provided by your third-party vendors.</li></ol><blockquote><p>‚ÄúMany common AWS security issues, for example, happen as a result of not following AWS security best practice guidelines when setting up the infrastructure. This can lead to open and accessible EC2 security groups, public S3 buckets, unprotected EMR clusters, and more,‚Äù says Auth0 Detection and Response Security Engineer Troy Wegner (formerly of AWS and Amazon.com).</p></blockquote><ol start="3"><li><strong><a href="https://www.overops.com/blog/static-vs-dynamic-code-analysis-how-to-choose-between-them/" target="_blank" rel="noreferrer noopener">Perform static</a> and <a href="https://www.overops.com/blog/static-vs-dynamic-code-analysis-how-to-choose-between-them/" target="_blank" rel="noreferrer noopener">dynamic code analysis</a></strong>. Static analysis reviews the code as it exists. Dynamic analysis looks for vulnerabilities while the code is being executed and for unexpected outcomes. Ideally, you want to move towards baking both into your Software Development Lifecycle (SDLC). Devs may not always enjoy adding this to part of their process‚Äîmore on how to add this analysis to your long-term software development plans in the final post.</li><li><strong>Think through vulnerability management and updates</strong>. Since humans are fallible and it‚Äôs humans who make code, it‚Äôs inevitable that you‚Äôre going to run into vulnerabilities. If you don‚Äôt have a plan for pushing updates, now‚Äôs the time to make one so you don‚Äôt hear about something BIG like the <a href="https://www.vox.com/2014/6/19/18076318/heartbleed" target="_blank" rel="noreferrer noopener">Heartbleed Bug</a> and find yourself painfully updating ad-hoc.</li></ol><blockquote><p>In general, you‚Äôre going to need to test every time your devs update something and whenever your tech stack libraries or any of the main operating systems updates. Services like Chef, Puppet and Terraform can make this easier by pushing updates from a central server to connected servers. In the final post, we‚Äôll get into longer-term strategies for updates, like maintaining a Golden Amazon Machine Image (AMI) if you‚Äôre on AWS. For now, just document how and when you‚Äôre going to update and test.</p></blockquote><ol start="5"><li><strong>Threat model</strong>. A lot of security is determining risks. Ideally, you‚Äôve threat modeled before building your app, but in some ways, it‚Äôs easier to model after it‚Äôs live. Yes, you can hire a trusted third party to do this for you. To give you a sense of the thought process, I asked Troy to threat model this restaurant scenario. Security engineers often diagram vulnerabilities, so we also include Troy‚Äôs whiteboard as a reference.</li></ol><p>Let‚Äôs say you‚Äôre a local restaurant who responded to COVID by offering the ingredients to make your tastiest dishes and recipes to your customers via curbside pickup. You hired someone to put the app together quickly, but now your region is opening up, and you‚Äôve decided this channel of operations should continue contributing to your bottom line. </p><p><img src="https://images.ctfassets.net/23aumh6u8s0i/3qWEruezG4YZw2AwS2w4Nf/ccb3121e94d794c8baa0ec470e4b084d/diagram.jpg" alt="Whiteboard"/>
<strong>Figure 1:</strong> <em>Auth0 Senior Security Engineer - Detection and Response Troy Wegner‚Äôs whiteboard of our restaurant scenario.</em></p><ul><li>Start with authentication because you know customers need to authenticate in order to interact with your app. How are they authenticating? Are they only using a username and password? If they are only using a username and password for authentication, then you have just hit on your first major risk (user compromise/phishing/user impersonation).</li><li>As a way to address the first risk identified, you have chosen to go with two-factor authentication for your users. But here is where things get interesting; which 2-factor options do you want to support? There are authenticator apps, FIDO U2F, Push-based 2FA, and SMS (the weakest available option). Each option has its own pros and cons to consider.</li><li>Since this is a restaurant, you‚Äôre also somehow connecting the app to the food supply. How are you measuring and validating your existing ingredients inventory to ensure you do not oversell based on your total ingredients available? Are you using a database to store this information? If so, where does this database live, is it protected or hardened information security wise, and if so, how is it hardened? How do you authenticate to the database, is it updated regularly, do you perform backups, etc.</li><li>If your service has gotten really popular, too many people might try to order at once, and that could overwhelm the app‚Äôs limits. The app could go down due to resource constraints based on how it is architected. This is basically the risk a DOS/DDOS would present in bringing your app down and making it no longer available to your customers. In order to mitigate a DDOS risk, you might have a plan to make your app more fault tolerant and highly available by using load balancing, increasing back-end servers to handle the load, or using a front-end CDN to help distribute load across various edge locations.</li><li>Most likely, your app is taking payment and processing it in order to fulfill orders; how are customer payment and other sensitive information being handled/stored? If you accept credit cards or debit cards, PCI compliance is a concern you should address.</li><li>Here is where you would now want to think through and fully diagram out the rest of how the app works and uncover any other risks or bottlenecks that currently exist with your app, place a severity on those risks, and determine by severity which risks you want to fix, and which ones you are ok accepting.</li></ul><ol start="6"><li><strong>Turn on your logs ‚Äî and make sure they‚Äôre monitored</strong>. Turning on logs can seem like common sense, but because there‚Äôs often an expense attached to logging and getting the data analyzed, the logs might not always be turned on. It‚Äôs really hard to know what to fix after a malware outbreak or other issues occur, especially if your logs aren‚Äôt turned on and are being actively analyzed.</li></ol><p>So this is where we tell you to turn on the logs for all the services you‚Äôre using. You should also make sure that a trusted third-party vendor or trained security engineer is watching your logs and building actionable detections based on those log sources to look for suspicious or anomalous activity.</p><ol start="7"><li><strong>Take action</strong>. Logs, vulnerability assessments, pen tests ‚Äî these things can help you identify what needs to be fixed, but you still need to fix it. Breaches and ransomware are the obvious security problems you want to avoid. How your security challenges impact consumer behavior might not be as clear. Lost conversions, abandoned shopping carts, and low time on site are all indications that your target audience may not feel comfortable sharing their data with you. Our customers tell us that an app or site that feels secure (think smooth login, logical and smooth payment process) supports their business goals.</li></ol><h2 id="If-You-Need-More-Help">If You Need More Help</h2><p>Authentication is often a critical part of securing an app or workplace. If you‚Äôd like to understand how Auth0‚Äôs solutions might help make your app more secure, please reach out to the <a href="https://auth0.com/contact-us" target="_blank" rel="noreferrer noopener">team at Auth0</a>.</p><p>My next post will focus on immediate data privacy concerns with the help of Auth0 Vice President of Privacy Lucy McGrath.</p><div><h2 id="About-Auth0">About Auth0 </h2><p>Auth0‚Äôs modern approach to identity enables organizations to provide secure access to any application, for any user. The Auth0 platform is a highly customizable identity operating system that is as simple as development teams want and as flexible as they need. Safeguarding billions of login transactions each month, Auth0 delivers convenience, privacy, and security so customers can focus on innovation. For more information, visit <a href="https://auth0.com/" target="_blank" rel="noopener noreferrer">https://auth0.com</a>.</p></div></div></main></article></section></div>]]></content:encoded>
      <pubDate>Wed, 28 Jul 2021 16:05:00 +0000</pubDate>
    </item>
  </channel>
</rss>